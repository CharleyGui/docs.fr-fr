---
title: Création, évolution et version des contrats et des API de microservices
description: Créez des API et des contrats de microservices en tenant compte de l’évolution et de la gestion de versions, car les besoins changent.
ms.date: 09/20/2018
ms.openlocfilehash: 1972d02d8bf7935c71bfd383707ae19ea2baded9
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/14/2020
ms.locfileid: "68672896"
---
# <a name="creating-evolving-and-versioning-microservice-apis-and-contracts"></a><span data-ttu-id="eb0da-103">Création, évolution et version des contrats et des API de microservices</span><span class="sxs-lookup"><span data-stu-id="eb0da-103">Creating, evolving, and versioning microservice APIs and contracts</span></span>

<span data-ttu-id="eb0da-104">Une API de microservice est un contrat entre le service et ses clients.</span><span class="sxs-lookup"><span data-stu-id="eb0da-104">A microservice API is a contract between the service and its clients.</span></span> <span data-ttu-id="eb0da-105">Vous ne pouvez pas faire évoluer indépendamment un microservice si son contrat d’API est rompu. C’est pourquoi le contrat est si important.</span><span class="sxs-lookup"><span data-stu-id="eb0da-105">You'll be able to evolve a microservice independently only if you do not break its API contract, which is why the contract is so important.</span></span> <span data-ttu-id="eb0da-106">Tout changement apporté au contrat impacte vos applications clientes ou votre passerelle API.</span><span class="sxs-lookup"><span data-stu-id="eb0da-106">If you change the contract, it will impact your client applications or your API Gateway.</span></span>

<span data-ttu-id="eb0da-107">La nature de la définition de l’API dépend du protocole que vous utilisez.</span><span class="sxs-lookup"><span data-stu-id="eb0da-107">The nature of the API definition depends on which protocol you're using.</span></span> <span data-ttu-id="eb0da-108">Par exemple, si vous utilisez une messagerie telle qu’[AMQP](https://www.amqp.org/), l’API comprend les types de message.</span><span class="sxs-lookup"><span data-stu-id="eb0da-108">For instance, if you're using messaging (like [AMQP](https://www.amqp.org/)), the API consists of the message types.</span></span> <span data-ttu-id="eb0da-109">Si vous utilisez des services HTTP et RESTful, l’API comprend les URL et les formats JSON de requête et de réponse.</span><span class="sxs-lookup"><span data-stu-id="eb0da-109">If you're using HTTP and RESTful services, the API consists of the URLs and the request and response JSON formats.</span></span>

<span data-ttu-id="eb0da-110">Toutefois, même si votre contrat initial est l’aboutissement d’une réflexion, une API de service doit changer au fil du temps.</span><span class="sxs-lookup"><span data-stu-id="eb0da-110">However, even if you're thoughtful about your initial contract, a service API will need to change over time.</span></span> <span data-ttu-id="eb0da-111">Quand cela se produit, vous ne pouvez généralement pas forcer tous les clients à effectuer une mise à niveau vers votre nouveau contrat d’API, surtout s’il s’agit d’une API publique consommée par plusieurs applications clientes.</span><span class="sxs-lookup"><span data-stu-id="eb0da-111">When that happens—and especially if your API is a public API consumed by multiple client applications — you typically can't force all clients to upgrade to your new API contract.</span></span> <span data-ttu-id="eb0da-112">Dans la plupart des cas, vous devez déployer par incrément les nouvelles versions d’un service en faisant en sorte que les anciennes et les nouvelles versions du contrat de service s’exécutent simultanément.</span><span class="sxs-lookup"><span data-stu-id="eb0da-112">You usually need to incrementally deploy new versions of a service in a way that both old and new versions of a service contract are running simultaneously.</span></span> <span data-ttu-id="eb0da-113">Il est donc important de disposer d’une stratégie pour la gestion de versions de votre service.</span><span class="sxs-lookup"><span data-stu-id="eb0da-113">Therefore, it's important to have a strategy for your service versioning.</span></span>

<span data-ttu-id="eb0da-114">Si vous apportez des changements minimes à l’API, comme l’ajout d’attributs ou de paramètres, il est recommandé que les clients qui utilisent une API antérieure passent à la nouvelle version du service.</span><span class="sxs-lookup"><span data-stu-id="eb0da-114">When the API changes are small, like if you add attributes or parameters to your API, clients that use an older API should switch and work with the new version of the service.</span></span> <span data-ttu-id="eb0da-115">Il est possible que vous puissiez fournir des valeurs par défaut pour tous les attributs obligatoires manquants et que les clients ignorent les attributs de réponse en trop.</span><span class="sxs-lookup"><span data-stu-id="eb0da-115">You might be able to provide default values for any missing attributes that are required, and the clients might be able to ignore any extra response attributes.</span></span>

<span data-ttu-id="eb0da-116">Toutefois, vous pouvez parfois être amené à apporter des changements majeurs à une API de service qui débouchent sur des incompatibilités.</span><span class="sxs-lookup"><span data-stu-id="eb0da-116">However, sometimes you need to make major and incompatible changes to a service API.</span></span> <span data-ttu-id="eb0da-117">Dans l’éventualité où vous ne pourriez pas forcer les applications ou services clients à passer tout de suite à la nouvelle version, un service doit prendre en charge les anciennes versions de l’API pendant un certain temps.</span><span class="sxs-lookup"><span data-stu-id="eb0da-117">Because you might not be able to force client applications or services to upgrade immediately to the new version, a service must support older versions of the API for some period.</span></span> <span data-ttu-id="eb0da-118">Si vous utilisez un mécanisme HTTP, par exemple REST, il existe une approche qui consiste à incorporer le numéro de version de l’API dans l’URL ou dans un en-tête HTTP.</span><span class="sxs-lookup"><span data-stu-id="eb0da-118">If you're using an HTTP-based mechanism such as REST, one approach is to embed the API version number in the URL or into an HTTP header.</span></span> <span data-ttu-id="eb0da-119">Vous pouvez ensuite soit implémenter simultanément les deux versions du service dans la même instance de service, soit déployer des instances distinctes gérant des versions différentes de l’API.</span><span class="sxs-lookup"><span data-stu-id="eb0da-119">Then you can decide between implementing both versions of the service simultaneously within the same service instance, or deploying different instances that each handle a version of the API.</span></span> <span data-ttu-id="eb0da-120">Une bonne approche consiste à utiliser le [modèle Médiateur](https://en.wikipedia.org/wiki/Mediator_pattern) (par exemple, la [bibliothèque MediatR](https://github.com/jbogard/MediatR)) pour découpler les versions de l’implémentation en gestionnaires indépendants.</span><span class="sxs-lookup"><span data-stu-id="eb0da-120">A good approach for this is the [Mediator pattern](https://en.wikipedia.org/wiki/Mediator_pattern) (for example, [MediatR library](https://github.com/jbogard/MediatR)) to decouple the different implementation versions into independent handlers.</span></span>

<span data-ttu-id="eb0da-121">Enfin, si vous utilisez une architecture REST, [Hypermedia](https://www.infoq.com/articles/mark-baker-hypermedia) constitue la meilleure solution pour la gestion de versions de vos services et la prise en charge d’API évolutives.</span><span class="sxs-lookup"><span data-stu-id="eb0da-121">Finally, if you're using a REST architecture, [Hypermedia](https://www.infoq.com/articles/mark-baker-hypermedia) is the best solution for versioning your services and allowing evolvable APIs.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="eb0da-122">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="eb0da-122">Additional resources</span></span>

- <span data-ttu-id="eb0da-123">**Scott Hanselman. ASP.NET version WEB API RESTful de base facilitée** </span><span class="sxs-lookup"><span data-stu-id="eb0da-123">**Scott Hanselman. ASP.NET Core RESTful Web API versioning made easy** </span></span>\
  <https://www.hanselman.com/blog/ASPNETCoreRESTfulWebAPIVersioningMadeEasy.aspx>

- <span data-ttu-id="eb0da-124">**Version d’une API Web RESTful** </span><span class="sxs-lookup"><span data-stu-id="eb0da-124">**Versioning a RESTful web API** </span></span>\
  <https://docs.microsoft.com/azure/architecture/best-practices/api-design#versioning-a-restful-web-api>

- <span data-ttu-id="eb0da-125">**Roy Fielding. Version, Hypermedia, et REST** </span><span class="sxs-lookup"><span data-stu-id="eb0da-125">**Roy Fielding. Versioning, Hypermedia, and REST** </span></span>\
  <https://www.infoq.com/articles/roy-fielding-on-versioning>

>[!div class="step-by-step"]
><span data-ttu-id="eb0da-126">[Suivant précédent](asynchronous-message-based-communication.md)
>[Next](microservices-addressability-service-registry.md)</span><span class="sxs-lookup"><span data-stu-id="eb0da-126">[Previous](asynchronous-message-based-communication.md)
[Next](microservices-addressability-service-registry.md)</span></span>

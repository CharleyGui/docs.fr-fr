---
title: Problématiques et solutions pour la gestion des données distribuées
description: Découvrez les défis et les solutions spécifiques à la gestion des données distribuée dans le monde des microservices.
ms.date: 09/20/2018
ms.openlocfilehash: 7733a4523e147591151cd0dda26c43992dbe9a41
ms.sourcegitcommit: f20dd18dbcf2275513281f5d9ad7ece6a62644b4
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/30/2019
ms.locfileid: "68673136"
---
# <a name="challenges-and-solutions-for-distributed-data-management"></a><span data-ttu-id="6ceba-103">Problématiques et solutions pour la gestion des données distribuées</span><span class="sxs-lookup"><span data-stu-id="6ceba-103">Challenges and solutions for distributed data management</span></span>

## <a name="challenge-1-how-to-define-the-boundaries-of-each-microservice"></a><span data-ttu-id="6ceba-104">Défi \#1 : Comment définir les limites de chaque microservice</span><span class="sxs-lookup"><span data-stu-id="6ceba-104">Challenge \#1: How to define the boundaries of each microservice</span></span>

<span data-ttu-id="6ceba-105">Définir les limites d’un microservice est sans doute la première problématique à laquelle tout le monde est confronté.</span><span class="sxs-lookup"><span data-stu-id="6ceba-105">Defining microservice boundaries is probably the first challenge anyone encounters.</span></span> <span data-ttu-id="6ceba-106">Chaque microservice doit être un composant de votre application et chaque microservice doit être autonome, avec tous les avantages et les défis induits.</span><span class="sxs-lookup"><span data-stu-id="6ceba-106">Each microservice has to be a piece of your application and each microservice should be autonomous with all the benefits and challenges that it conveys.</span></span> <span data-ttu-id="6ceba-107">Mais comment identifier ces limites ?</span><span class="sxs-lookup"><span data-stu-id="6ceba-107">But how do you identify those boundaries?</span></span>

<span data-ttu-id="6ceba-108">Vous devez d’abord vous concentrer sur les modèles de domaine logique de l’application et les données associées.</span><span class="sxs-lookup"><span data-stu-id="6ceba-108">First, you need to focus on the application's logical domain models and related data.</span></span> <span data-ttu-id="6ceba-109">Essayez d’identifier les îlots de données découplés et les différents contextes au sein d’une même application.</span><span class="sxs-lookup"><span data-stu-id="6ceba-109">Try to identify decoupled islands of data and different contexts within the same application.</span></span> <span data-ttu-id="6ceba-110">Chaque contexte peut avoir un langage métier différent (des termes métier différents).</span><span class="sxs-lookup"><span data-stu-id="6ceba-110">Each context could have a different business language (different business terms).</span></span> <span data-ttu-id="6ceba-111">Les contextes doivent être définis et gérés indépendamment.</span><span class="sxs-lookup"><span data-stu-id="6ceba-111">The contexts should be defined and managed independently.</span></span> <span data-ttu-id="6ceba-112">Les termes et entités utilisés dans ces différents contextes peuvent sembler similaires, mais vous pouvez découvrir que dans un contexte spécifique, un concept métier d’un contexte est utilisé à des fins différentes dans un autre contexte, et qu’il peut même porter un autre nom.</span><span class="sxs-lookup"><span data-stu-id="6ceba-112">The terms and entities that are used in those different contexts might sound similar, but you might discover that in a particular context, a business concept with one is used for a different purpose in another context, and might even have a different name.</span></span> <span data-ttu-id="6ceba-113">Par exemple, un utilisateur peut s’appeler un utilisateur dans un contexte d’identité ou d’appartenance, un client dans un contexte de gestion de la relation clientèle, un acheteur dans un contexte de prise de commande, etc.</span><span class="sxs-lookup"><span data-stu-id="6ceba-113">For instance, a user can be referred as a user in the identity or membership context, as a customer in a CRM context, as a buyer in an ordering context, and so forth.</span></span>

<span data-ttu-id="6ceba-114">La façon dont vous identifiez les limites entre plusieurs contextes d’application avec un domaine différent pour chaque contexte correspond exactement à la façon dont vous pouvez identifier les limites pour chaque microservice métier, et son modèle de domaine et ses données associés.</span><span class="sxs-lookup"><span data-stu-id="6ceba-114">The way you identify boundaries between multiple application contexts with a different domain for each context is exactly how you can identify the boundaries for each business microservice and its related domain model and data.</span></span> <span data-ttu-id="6ceba-115">Vous essayez toujours de minimiser le couplage entre ces microservices.</span><span class="sxs-lookup"><span data-stu-id="6ceba-115">You always attempt to minimize the coupling between those microservices.</span></span> <span data-ttu-id="6ceba-116">Ce guide présente plus en détails cette identification et cette conception du modèle de domaine plus loin dans la section [Identification des limites du modèle de domaine pour chaque microservice](identify-microservice-domain-model-boundaries.md).</span><span class="sxs-lookup"><span data-stu-id="6ceba-116">This guide goes into more detail about this identification and domain model design in the section [Identifying domain-model boundaries for each microservice](identify-microservice-domain-model-boundaries.md) later.</span></span>

## <a name="challenge-2-how-to-create-queries-that-retrieve-data-from-several-microservices"></a><span data-ttu-id="6ceba-117">Défi \#2 : Comment créer des requêtes qui récupèrent des données de plusieurs microservices</span><span class="sxs-lookup"><span data-stu-id="6ceba-117">Challenge \#2: How to create queries that retrieve data from several microservices</span></span>

<span data-ttu-id="6ceba-118">Une deuxième problématique est la façon d’implémenter des requêtes qui extraient des données de plusieurs microservices, tout en évitant des communication intensives entre les microservices et les applications clientes distantes.</span><span class="sxs-lookup"><span data-stu-id="6ceba-118">A second challenge is how to implement queries that retrieve data from several microservices, while avoiding chatty communication to the microservices from remote client apps.</span></span> <span data-ttu-id="6ceba-119">Par exemple, un écran d’une application mobile a besoin d’afficher les informations utilisateur détenues par des microservices distincts gérant respectivement le panier d’achat, le catalogue et l’identité des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="6ceba-119">An example could be a single screen from a mobile app that needs to show user information that's owned by the basket, catalog, and user identity microservices.</span></span> <span data-ttu-id="6ceba-120">Un autre exemple est un rapport complexe impliquant plusieurs tables qui se trouvent dans plusieurs microservices.</span><span class="sxs-lookup"><span data-stu-id="6ceba-120">Another example would be a complex report involving many tables located in multiple microservices.</span></span> <span data-ttu-id="6ceba-121">La bonne solution dépend de la complexité des requêtes.</span><span class="sxs-lookup"><span data-stu-id="6ceba-121">The right solution depends on the complexity of the queries.</span></span> <span data-ttu-id="6ceba-122">Dans tous les cas, il vous faut un moyen d’agréger les informations pour améliorer l’efficacité des communications de votre système.</span><span class="sxs-lookup"><span data-stu-id="6ceba-122">But in any case, you'll need a way to aggregate information if you want to improve the efficiency in the communications of your system.</span></span> <span data-ttu-id="6ceba-123">Les solutions les plus répandues sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="6ceba-123">The most popular solutions are the following.</span></span>

<span data-ttu-id="6ceba-124">**Passerelle d’API.**</span><span class="sxs-lookup"><span data-stu-id="6ceba-124">**API Gateway.**</span></span> <span data-ttu-id="6ceba-125">Pour une agrégation de données simples provenant de plusieurs microservices qui ont des bases de données différentes, l’approche recommandée est un microservice d’agrégation, connu sous le nom de passerelle d’API.</span><span class="sxs-lookup"><span data-stu-id="6ceba-125">For simple data aggregation from multiple microservices that own different databases, the recommended approach is an aggregation microservice referred to as an API Gateway.</span></span> <span data-ttu-id="6ceba-126">Vous devez cependant être prudent dans l’implémentation de ce modèle, car il peut être un goulot d’étranglement dans votre système, et il peut violer le principe d’autonomie des microservices.</span><span class="sxs-lookup"><span data-stu-id="6ceba-126">However, you need to be careful about implementing this pattern, because it can be a choke point in your system, and it can violate the principle of microservice autonomy.</span></span> <span data-ttu-id="6ceba-127">Pour atténuer ce risque, vous pouvez avoir plusieurs passerelles d’API réduites, chacune étant consacrée à une « section » verticale ou un domaine d’activité du système.</span><span class="sxs-lookup"><span data-stu-id="6ceba-127">To mitigate this possibility, you can have multiple fined-grained API Gateways each one focusing on a vertical "slice" or business area of the system.</span></span> <span data-ttu-id="6ceba-128">Le modèle de passerelle d’API est détaillé plus loin dans la [section relative à la passerelle d’API](direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md#why-consider-api-gateways-instead-of-direct-client-to-microservice-communication).</span><span class="sxs-lookup"><span data-stu-id="6ceba-128">The API Gateway pattern is explained in more detail in the [API Gateway section](direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md#why-consider-api-gateways-instead-of-direct-client-to-microservice-communication) later.</span></span>

<span data-ttu-id="6ceba-129">**CQRS avec des tables de requêtes/lectures.**</span><span class="sxs-lookup"><span data-stu-id="6ceba-129">**CQRS with query/reads tables.**</span></span> <span data-ttu-id="6ceba-130">Une autre solution pour agréger des données provenant de plusieurs microservices est le [modèle de vue matérialisée](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span><span class="sxs-lookup"><span data-stu-id="6ceba-130">Another solution for aggregating data from multiple microservices is the [Materialized View pattern](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span></span> <span data-ttu-id="6ceba-131">Dans cette approche, vous générez à l’avance (vous préparez des données dénormalisées avant que les requêtes réelles ne soient effectuées) une table en lecture seule avec les données détenues par plusieurs microservices.</span><span class="sxs-lookup"><span data-stu-id="6ceba-131">In this approach, you generate, in advance (prepare denormalized data before the actual queries happen), a read-only table with the data that's owned by multiple microservices.</span></span> <span data-ttu-id="6ceba-132">La table a un format adapté aux besoins de l’application cliente.</span><span class="sxs-lookup"><span data-stu-id="6ceba-132">The table has a format suited to the client app's needs.</span></span>

<span data-ttu-id="6ceba-133">Considérons par exemple l’écran d’une application mobile.</span><span class="sxs-lookup"><span data-stu-id="6ceba-133">Consider something like the screen for a mobile app.</span></span> <span data-ttu-id="6ceba-134">Si vous avez une seule base de données, vous pouvez extraire en une seule fois les données pour cet écran en utilisant une requête SQL qui effectue une jointure complexe impliquant plusieurs tables.</span><span class="sxs-lookup"><span data-stu-id="6ceba-134">If you have a single database, you might pull together the data for that screen using a SQL query that performs a complex join involving multiple tables.</span></span> <span data-ttu-id="6ceba-135">Cependant, quand vous avez plusieurs bases de données et que chaque base de données est détenue par un microservice différent, vous ne pouvez pas interroger ces bases de données et créer une jointure SQL.</span><span class="sxs-lookup"><span data-stu-id="6ceba-135">However, when you have multiple databases, and each database is owned by a different microservice, you cannot query those databases and create a SQL join.</span></span> <span data-ttu-id="6ceba-136">Votre requête complexe devient un vrai défi.</span><span class="sxs-lookup"><span data-stu-id="6ceba-136">Your complex query becomes a challenge.</span></span> <span data-ttu-id="6ceba-137">Vous pouvez répondre à cette exigence à l’aide d’une approche CQRS : vous créez une table dénormalisée dans une autre base de données, utilisée seulement pour les requêtes.</span><span class="sxs-lookup"><span data-stu-id="6ceba-137">You can address the requirement using a CQRS approach—you create a denormalized table in a different database that's used just for queries.</span></span> <span data-ttu-id="6ceba-138">La table peut être conçue spécifiquement pour les données dont vous avez besoin pour la requête complexe, avec une relation un-à-un entre les champs nécessaires à l’écran de votre application et les colonnes de la table de requête.</span><span class="sxs-lookup"><span data-stu-id="6ceba-138">The table can be designed specifically for the data you need for the complex query, with a one-to-one relationship between fields needed by your application's screen and the columns in the query table.</span></span> <span data-ttu-id="6ceba-139">Elle peut également servir pour la création de rapports.</span><span class="sxs-lookup"><span data-stu-id="6ceba-139">It could also serve for reporting purposes.</span></span>

<span data-ttu-id="6ceba-140">Cette approche résout non seulement le problème d’origine (comment faire des requêtes et des jointures entre des microservices), mais elle améliore également considérablement les performances en comparaison d’une jointure complexe, car vous avez déjà les données nécessaires à l’application dans la table de requête.</span><span class="sxs-lookup"><span data-stu-id="6ceba-140">This approach not only solves the original problem (how to query and join across microservices), but it also improves performance considerably when compared with a complex join, because you already have the data that the application needs in the query table.</span></span> <span data-ttu-id="6ceba-141">Bien sûr, l’utilisation de CQRS (séparation des responsabilités en matière de commande et de requête) avec des tables de requêtes/lectures signifie davantage de travail de développement et l’application d’une cohérence à terme.</span><span class="sxs-lookup"><span data-stu-id="6ceba-141">Of course, using Command and Query Responsibility Segregation (CQRS) with query/reads tables means additional development work, and you'll need to embrace eventual consistency.</span></span> <span data-ttu-id="6ceba-142">Néanmoins, les exigences de performances et de haute scalabilité dans les [scénarios collaboratifs](http://udidahan.com/2011/10/02/why-you-should-be-using-cqrs-almost-everywhere/) (ou les scénarios de concurrence, selon le point de vue) doivent vous inciter à appliquer CQRS à plusieurs bases de données.</span><span class="sxs-lookup"><span data-stu-id="6ceba-142">Nonetheless, requirements on performance and high scalability in [collaborative scenarios](http://udidahan.com/2011/10/02/why-you-should-be-using-cqrs-almost-everywhere/) (or competitive scenarios, depending on the point of view) are where you should apply CQRS with multiple databases.</span></span>

<span data-ttu-id="6ceba-143">**« Données froides » dans des bases de données centrales.**</span><span class="sxs-lookup"><span data-stu-id="6ceba-143">**"Cold data" in central databases.**</span></span> <span data-ttu-id="6ceba-144">Pour les rapports et les requêtes complexes ne nécessitant pas de données en temps réel, une approche courante consiste à exporter vos « données chaudes » (données transactionnelles des microservices) en tant que « données froides » dans des bases de données volumineuses utilisées seulement pour la création de rapports.</span><span class="sxs-lookup"><span data-stu-id="6ceba-144">For complex reports and queries that might not require real-time data, a common approach is to export your "hot data" (transactional data from the microservices) as "cold data" into large databases that are used only for reporting.</span></span> <span data-ttu-id="6ceba-145">Ce système de base de données centrale peut être un système basé sur le Big Data, comme Hadoop, un entrepôt de données basé sur Azure SQL Data Warehouse, ou même une base de données SQL utilisée seulement pour les rapports (si la taille n’est pas un problème).</span><span class="sxs-lookup"><span data-stu-id="6ceba-145">That central database system can be a Big Data-based system, like Hadoop, a data warehouse like one based on Azure SQL Data Warehouse, or even a single SQL database that's used just for reports (if size won't be an issue).</span></span>

<span data-ttu-id="6ceba-146">Gardez à l’esprit que cette base de données centralisée doit être utilisée seulement pour les requêtes et les rapports qui n’ont pas besoin de données en temps réel.</span><span class="sxs-lookup"><span data-stu-id="6ceba-146">Keep in mind that this centralized database would be used only for queries and reports that do not need real-time data.</span></span> <span data-ttu-id="6ceba-147">Les mises à jour et les transactions d’origine, qui constituent votre source de référence, doivent être effectuées dans les données de vos microservices.</span><span class="sxs-lookup"><span data-stu-id="6ceba-147">The original updates and transactions, as your source of truth, have to be in your microservices data.</span></span> <span data-ttu-id="6ceba-148">Vous allez synchroniser les données via une communication pilotée par les événements (traitée dans les sections suivantes) ou via d’autres outils d’importation/exportation de l’infrastructure de base de données.</span><span class="sxs-lookup"><span data-stu-id="6ceba-148">The way you would synchronize data would be either by using event-driven communication (covered in the next sections) or by using other database infrastructure import/export tools.</span></span> <span data-ttu-id="6ceba-149">Si vous utilisez une communication pilotée par les événements, ce processus d’intégration est similaire à la façon dont vous propagez les données comme cela a été décrit précédemment pour les tables de requête CQRS.</span><span class="sxs-lookup"><span data-stu-id="6ceba-149">If you use event-driven communication, that integration process would be similar to the way you propagate data as described earlier for CQRS query tables.</span></span>

<span data-ttu-id="6ceba-150">Toutefois, si la conception de votre application implique d’agréger constamment les informations provenant de plusieurs microservices pour des requêtes complexes, cela peut être le symptôme d’une mauvaise conception : un microservice doit être aussi isolé que possible des autres microservices.</span><span class="sxs-lookup"><span data-stu-id="6ceba-150">However, if your application design involves constantly aggregating information from multiple microservices for complex queries, it might be a symptom of a bad design -a microservice should be as isolated as possible from other microservices.</span></span> <span data-ttu-id="6ceba-151">(Ceci exclut les rapports/analyses qui doivent toujours utiliser des bases de données centrales contenant des données froides.) Le fait que ce problème se pose souvent peut être une raison pour fusionner des microservices.</span><span class="sxs-lookup"><span data-stu-id="6ceba-151">(This excludes reports/analytics that always should use cold-data central databases.) Having this problem often might be a reason to merge microservices.</span></span> <span data-ttu-id="6ceba-152">Vous devez équilibrer l’autonomie de l’évolution et du déploiement de chaque microservice avec des dépendances fortes, la cohésion et l’agrégation des données.</span><span class="sxs-lookup"><span data-stu-id="6ceba-152">You need to balance the autonomy of evolution and deployment of each microservice with strong dependencies, cohesion, and data aggregation.</span></span>

## <a name="challenge-3-how-to-achieve-consistency-across-multiple-microservices"></a><span data-ttu-id="6ceba-153">Défi \#3 : Comment garantir la cohérence entre plusieurs microservices</span><span class="sxs-lookup"><span data-stu-id="6ceba-153">Challenge \#3: How to achieve consistency across multiple microservices</span></span>

<span data-ttu-id="6ceba-154">Comme indiqué précédemment, les données détenues par chaque microservice sont privées pour ce microservice et sont accessibles seulement via son API de microservice.</span><span class="sxs-lookup"><span data-stu-id="6ceba-154">As stated previously, the data owned by each microservice is private to that microservice and can only be accessed using its microservice API.</span></span> <span data-ttu-id="6ceba-155">Ainsi, le problème est de savoir comment implémenter des processus métier de bout en bout tout en conservant la cohérence entre plusieurs microservices.</span><span class="sxs-lookup"><span data-stu-id="6ceba-155">Therefore, a challenge presented is how to implement end-to-end business processes while keeping consistency across multiple microservices.</span></span>

<span data-ttu-id="6ceba-156">Pour analyser ce problème, prenons l’exemple de l’[application de référence eShopOnContainers](https://aka.ms/eshoponcontainers).</span><span class="sxs-lookup"><span data-stu-id="6ceba-156">To analyze this problem, let's look at an example from the [eShopOnContainers reference application](https://aka.ms/eshoponcontainers).</span></span> <span data-ttu-id="6ceba-157">Le microservice Catalog (Catalogue) gère les informations relatives à tous les produits, notamment leur prix.</span><span class="sxs-lookup"><span data-stu-id="6ceba-157">The Catalog microservice maintains information about all the products, including the product price.</span></span> <span data-ttu-id="6ceba-158">Le microservice Basket (Panier) gère les données temporelles relatives aux articles que les utilisateurs ajoutent à leurs paniers d’achat, notamment le prix des articles au moment où ils ont été ajoutés au panier.</span><span class="sxs-lookup"><span data-stu-id="6ceba-158">The Basket microservice manages temporal data about product items that users are adding to their shopping baskets, which includes the price of the items at the time they were added to the basket.</span></span> <span data-ttu-id="6ceba-159">Quand le prix d’un produit est mis à jour dans le catalogue, ce prix doit l’être également dans les paniers actifs qui contiennent le produit correspondant. De plus, le système doit en principe avertir l’utilisateur en lui indiquant que le prix d’un article particulier a changé depuis son ajout au panier.</span><span class="sxs-lookup"><span data-stu-id="6ceba-159">When a product's price is updated in the catalog, that price should also be updated in the active baskets that hold that same product, plus the system should probably warn the user saying that a particular item's price has changed since they added it to their basket.</span></span>

<span data-ttu-id="6ceba-160">Dans une hypothétique version monolithique de cette application, quand le prix change dans la table des produits, le sous-système de catalogue peut simplement utiliser une transaction ACID pour mettre à jour le prix actuel dans la table Basket (Panier).</span><span class="sxs-lookup"><span data-stu-id="6ceba-160">In a hypothetical monolithic version of this application, when the price changes in the products table, the catalog subsystem could simply use an ACID transaction to update the current price in the Basket table.</span></span>

<span data-ttu-id="6ceba-161">Toutefois, dans une application basée sur les microservices, les tables Order (Commande) et Product (Produit) appartiennent à leurs microservices respectifs.</span><span class="sxs-lookup"><span data-stu-id="6ceba-161">However, in a microservices-based application, the Product and Basket tables are owned by their respective microservices.</span></span> <span data-ttu-id="6ceba-162">Aucun microservice ne doit jamais inclure de tables/stockage appartenant à un autre microservice dans ses propres transactions, pas même dans les requêtes directes, comme indiqué sur la figure 4-9.</span><span class="sxs-lookup"><span data-stu-id="6ceba-162">No microservice should ever include tables/storage owned by another microservice in its own transactions, not even in direct queries, as shown in Figure 4-9.</span></span>

![Un microservice ne peut pas accéder directement à une table d’un autre microservice. Vous devez utiliser une cohérence à terme pour synchroniser les données.](./media/image9.png)

<span data-ttu-id="6ceba-164">**Figure 4-9**.</span><span class="sxs-lookup"><span data-stu-id="6ceba-164">**Figure 4-9**.</span></span> <span data-ttu-id="6ceba-165">Un microservice ne peut pas accéder directement à une table dans un autre microservice</span><span class="sxs-lookup"><span data-stu-id="6ceba-165">A microservice can't directly access a table in another microservice</span></span>

<span data-ttu-id="6ceba-166">Le microservice Catalog ne doit pas mettre à jour directement la table Basket, car elle est détenue par le microservice Basket.</span><span class="sxs-lookup"><span data-stu-id="6ceba-166">The Catalog microservice shouldn't update the Basket table directly, because the Basket table is owned by the Basket microservice.</span></span> <span data-ttu-id="6ceba-167">Pour permettre une mise à jour du microservice Basket, le microservice Catalog doit utiliser une cohérence à terme probablement basée sur une communication asynchrone, par exemple celle des événements d’intégration (communication basée sur des messages et des événements).</span><span class="sxs-lookup"><span data-stu-id="6ceba-167">To make an update to the Basket microservice, the Catalog microservice should use eventual consistency probably based on asynchronous communication such as integration events (message and event-based communication).</span></span> <span data-ttu-id="6ceba-168">Voici comment l’application de référence [eShopOnContainers](https://aka.ms/eshoponcontainers) effectue ce type de cohérence parmi plusieurs microservices.</span><span class="sxs-lookup"><span data-stu-id="6ceba-168">This is how the [eShopOnContainers](https://aka.ms/eshoponcontainers) reference application performs this type of consistency across microservices.</span></span>

<span data-ttu-id="6ceba-169">Comme le montre le [théorème CAP](https://en.wikipedia.org/wiki/CAP_theorem), vous devez choisir entre la disponibilité et la cohérence forte d’ACID.</span><span class="sxs-lookup"><span data-stu-id="6ceba-169">As stated by the [CAP theorem](https://en.wikipedia.org/wiki/CAP_theorem), you need to choose between availability and ACID strong consistency.</span></span> <span data-ttu-id="6ceba-170">La plupart des scénarios basés sur des microservices demandent la disponibilité et une haute scalabilité, plutôt qu’une cohérence forte.</span><span class="sxs-lookup"><span data-stu-id="6ceba-170">Most microservice-based scenarios demand availability and high scalability as opposed to strong consistency.</span></span> <span data-ttu-id="6ceba-171">Les applications critiques doivent rester opérationnelles, et les développeurs peuvent contourner les problèmes liés à la cohérence forte en utilisant des techniques permettant de travailler avec une cohérence faible ou à terme.</span><span class="sxs-lookup"><span data-stu-id="6ceba-171">Mission-critical applications must remain up and running, and developers can work around strong consistency by using techniques for working with weak or eventual consistency.</span></span> <span data-ttu-id="6ceba-172">Il s’agit de l’approche adoptée par la plupart des architectures basée sur les microservices.</span><span class="sxs-lookup"><span data-stu-id="6ceba-172">This is the approach taken by most microservice-based architectures.</span></span>

<span data-ttu-id="6ceba-173">De plus, les transactions de style ACID ou avec validation en deux phases ne sont pas seulement en opposition avec les principes des microservices : la plupart des bases de données NoSQL (par exemple Azure Cosmos DB, MongoDB, etc.) ne prennent pas en charge les transactions avec validation en deux phases, ce qui est typique des scénarios de bases de données distribuées.</span><span class="sxs-lookup"><span data-stu-id="6ceba-173">Moreover, ACID-style or two-phase commit transactions are not just against microservices principles; most NoSQL databases (like Azure Cosmos DB, MongoDB, etc.) do not support two-phase commit transactions, typical in distributed databases scenarios.</span></span> <span data-ttu-id="6ceba-174">Cependant, conserver la cohérence des données entre les services et les bases de données est fondamental.</span><span class="sxs-lookup"><span data-stu-id="6ceba-174">However, maintaining data consistency across services and databases is essential.</span></span> <span data-ttu-id="6ceba-175">Cette problématique concerne aussi la façon de propager les changements parmi plusieurs microservices quand certaines données doivent être redondantes, par exemple quand vous devez avoir le nom ou la description du produit dans le microservice Catalog et dans le microservice Basket.</span><span class="sxs-lookup"><span data-stu-id="6ceba-175">This challenge is also related to the question of how to propagate changes across multiple microservices when certain data needs to be redundant—for example, when you need to have the product's name or description in the Catalog microservice and the Basket microservice.</span></span>

<span data-ttu-id="6ceba-176">Une bonne solution pour résoudre ce problème est d’utiliser la cohérence à terme entre les microservices, articulée autour d’une communication pilotée par les événements et d’un système de publication-abonnement.</span><span class="sxs-lookup"><span data-stu-id="6ceba-176">A good solution for this problem is to use eventual consistency between microservices articulated through event-driven communication and a publish-and-subscribe system.</span></span> <span data-ttu-id="6ceba-177">Ces rubriques sont traitées dans la section [Communication asynchrone pilotée par les événements](asynchronous-message-based-communication.md#asynchronous-event-driven-communication) plus loin dans ce guide.</span><span class="sxs-lookup"><span data-stu-id="6ceba-177">These topics are covered in the section [Asynchronous event-driven communication](asynchronous-message-based-communication.md#asynchronous-event-driven-communication) later in this guide.</span></span>

## <a name="challenge-4-how-to-design-communication-across-microservice-boundaries"></a><span data-ttu-id="6ceba-178">Défi \#4 : Comment concevoir la communication entre les limites des microservices</span><span class="sxs-lookup"><span data-stu-id="6ceba-178">Challenge \#4: How to design communication across microservice boundaries</span></span>

<span data-ttu-id="6ceba-179">La communication entre les limites des microservices est une vraie problématique.</span><span class="sxs-lookup"><span data-stu-id="6ceba-179">Communicating across microservice boundaries is a real challenge.</span></span> <span data-ttu-id="6ceba-180">Dans ce contexte, la communication ne fait pas référence au protocole à utiliser (HTTP et REST, AMQP, messagerie, etc.).</span><span class="sxs-lookup"><span data-stu-id="6ceba-180">In this context, communication doesn't refer to what protocol you should use (HTTP and REST, AMQP, messaging, and so on).</span></span> <span data-ttu-id="6ceba-181">Au lieu de cela, elle concerne le style de communication que vous devez utiliser, et en particulier comment vos microservices doivent être couplés.</span><span class="sxs-lookup"><span data-stu-id="6ceba-181">Instead, it addresses what communication style you should use, and especially how coupled your microservices should be.</span></span> <span data-ttu-id="6ceba-182">Selon le niveau de couplage, l’impact d’une défaillance sur votre système varie considérablement.</span><span class="sxs-lookup"><span data-stu-id="6ceba-182">Depending on the level of coupling, when failure occurs, the impact of that failure on your system will vary significantly.</span></span>

<span data-ttu-id="6ceba-183">Dans un système distribué comme une application basée sur des microservices, avec un si grand nombre d’artefacts concernés et avec des services distribués sur plusieurs serveurs ou plusieurs hôtes, certains composants finissent à leur tour par connaître une défaillance.</span><span class="sxs-lookup"><span data-stu-id="6ceba-183">In a distributed system like a microservices-based application, with so many artifacts moving around and with distributed services across many servers or hosts, components will eventually fail.</span></span> <span data-ttu-id="6ceba-184">Une défaillance partielle et même des interruptions plus importantes vont se produire. Vous devez donc concevoir les microservices et leur mode de communication en tenant compte des risques courants liés à ce type de système distribué.</span><span class="sxs-lookup"><span data-stu-id="6ceba-184">Partial failure and even larger outages will occur, so you need to design your microservices and the communication across them considering the common risks in this type of distributed system.</span></span>

<span data-ttu-id="6ceba-185">Une approche courante consiste à implémenter des microservices basés sur HTTP (REST), en raison de leur simplicité.</span><span class="sxs-lookup"><span data-stu-id="6ceba-185">A popular approach is to implement HTTP (REST)-based microservices, due to their simplicity.</span></span> <span data-ttu-id="6ceba-186">Une approche basée sur HTTP est parfaitement acceptable ; le problème est ici la façon dont vous l’utilisez.</span><span class="sxs-lookup"><span data-stu-id="6ceba-186">An HTTP-based approach is perfectly acceptable; the issue here is related to how you use it.</span></span> <span data-ttu-id="6ceba-187">Si vous utilisez des requêtes et des réponses HTTP simplement pour interagir avec vos microservices à partir d’applications clientes ou de passerelles d’API, cela convient.</span><span class="sxs-lookup"><span data-stu-id="6ceba-187">If you use HTTP requests and responses just to interact with your microservices from client applications or from API Gateways, that's fine.</span></span> <span data-ttu-id="6ceba-188">Mais si vous créez de longues chaînes d’appels HTTP synchrones entre des microservices, en communiquant entre leurs limites comme si les microservices étaient des objets dans une application monolithique, votre application finira par rencontrer des problèmes.</span><span class="sxs-lookup"><span data-stu-id="6ceba-188">But if you create long chains of synchronous HTTP calls across microservices, communicating across their boundaries as if the microservices were objects in a monolithic application, your application will eventually run into problems.</span></span>

<span data-ttu-id="6ceba-189">Par exemple, supposons que votre application cliente effectue un appel d’API HTTP à un microservice individuel, comme le microservice Ordering.</span><span class="sxs-lookup"><span data-stu-id="6ceba-189">For instance, imagine that your client application makes an HTTP API call to an individual microservice like the Ordering microservice.</span></span> <span data-ttu-id="6ceba-190">Si le microservice Ordering appelle à son tour d’autres microservices en utilisant le protocole HTTP dans le même cycle de requête-réponse, vous créez une chaîne d’appels HTTP.</span><span class="sxs-lookup"><span data-stu-id="6ceba-190">If the Ordering microservice in turn calls additional microservices using HTTP within the same request/response cycle, you're creating a chain of HTTP calls.</span></span> <span data-ttu-id="6ceba-191">Cela peut initialement sembler raisonnable.</span><span class="sxs-lookup"><span data-stu-id="6ceba-191">It might sound reasonable initially.</span></span> <span data-ttu-id="6ceba-192">Des points importants sont cependant à prendre en compte si vous suivez cette voie :</span><span class="sxs-lookup"><span data-stu-id="6ceba-192">However, there are important points to consider when going down this path:</span></span>

- <span data-ttu-id="6ceba-193">Blocage et faibles performances.</span><span class="sxs-lookup"><span data-stu-id="6ceba-193">Blocking and low performance.</span></span> <span data-ttu-id="6ceba-194">En raison de la nature synchrone du protocole HTTP, la requête d’origine n’obtient pas de réponse tant que tous les appels HTTP internes ne sont pas achevés.</span><span class="sxs-lookup"><span data-stu-id="6ceba-194">Due to the synchronous nature of HTTP, the original request doesn't get a response until all the internal HTTP calls are finished.</span></span> <span data-ttu-id="6ceba-195">Imaginez dès lors que le nombre de ces appels augmente considérablement et qu’en même temps, un des appels HTTP intermédiaires à un microservice soit bloqué.</span><span class="sxs-lookup"><span data-stu-id="6ceba-195">Imagine if the number of these calls increases significantly and at the same time one of the intermediate HTTP calls to a microservice is blocked.</span></span> <span data-ttu-id="6ceba-196">Le résultat est que les performances sont impactées et que la scalabilité globale est affectée de façon exponentielle avec l’augmentation du nombre de requêtes HTTP.</span><span class="sxs-lookup"><span data-stu-id="6ceba-196">The result is that performance is impacted, and the overall scalability will be exponentially affected as additional HTTP requests increase.</span></span>

- <span data-ttu-id="6ceba-197">Couplage des microservices avec HTTP.</span><span class="sxs-lookup"><span data-stu-id="6ceba-197">Coupling microservices with HTTP.</span></span> <span data-ttu-id="6ceba-198">Vous ne devez pas coupler des microservices métier avec d’autres microservices métier.</span><span class="sxs-lookup"><span data-stu-id="6ceba-198">Business microservices shouldn't be coupled with other business microservices.</span></span> <span data-ttu-id="6ceba-199">Dans l’idéal, ils ne doivent rien « savoir » sur l’existence d’autres microservices.</span><span class="sxs-lookup"><span data-stu-id="6ceba-199">Ideally, they shouldn't "know" about the existence of other microservices.</span></span> <span data-ttu-id="6ceba-200">Si votre application s’appuie sur le couplage de microservices comme dans l’exemple, parvenir à une autonomie des microservices est pratiquement impossible.</span><span class="sxs-lookup"><span data-stu-id="6ceba-200">If your application relies on coupling microservices as in the example, achieving autonomy per microservice will be almost impossible.</span></span>

- <span data-ttu-id="6ceba-201">Défaillance dans un des microservices.</span><span class="sxs-lookup"><span data-stu-id="6ceba-201">Failure in any one microservice.</span></span> <span data-ttu-id="6ceba-202">Si vous avez implémenté une chaîne de microservices liés par des appels HTTP, quand un des microservices connaît une défaillance (et ce sera le cas pour tous au final), la chaîne entière des microservices échoue.</span><span class="sxs-lookup"><span data-stu-id="6ceba-202">If you implemented a chain of microservices linked by HTTP calls, when any of the microservices fails (and eventually they will fail) the whole chain of microservices will fail.</span></span> <span data-ttu-id="6ceba-203">Un système basé sur des microservices doit être conçu pour continuer à fonctionner aussi bien que possible en cas de défaillances partielles.</span><span class="sxs-lookup"><span data-stu-id="6ceba-203">A microservice-based system should be designed to continue to work as well as possible during partial failures.</span></span> <span data-ttu-id="6ceba-204">Même si vous implémentez une logique cliente qui utilise les nouvelles tentatives avec des mécanismes de backoff exponentiel ou de disjoncteur, plus les chaînes d’appels HTTP sont complexes, plus l’implémentation d’une stratégie de défaillance basée sur le protocole HTTP est complexe.</span><span class="sxs-lookup"><span data-stu-id="6ceba-204">Even if you implement client logic that uses retries with exponential backoff or circuit breaker mechanisms, the more complex the HTTP call chains are, the more complex it is to implement a failure strategy based on HTTP.</span></span>

<span data-ttu-id="6ceba-205">En fait, si vos microservices internes communiquent en créant des chaînes de requêtes HTTP comme indiqué auparavant, cela signifie que vous avez une application monolithique. Toutefois, celle-ci est basée plutôt sur le protocole HTTP entre processus et non sur des mécanismes de communication intraprocessus.</span><span class="sxs-lookup"><span data-stu-id="6ceba-205">In fact, if your internal microservices are communicating by creating chains of HTTP requests as described, it could be argued that you have a monolithic application, but one based on HTTP between processes instead of intra-process communication mechanisms.</span></span>

<span data-ttu-id="6ceba-206">Par conséquent, pour atteindre à l’autonomie des microservices et avoir une meilleure résilience, vous devez minimiser l’utilisation de chaînes de communication de demande/réponse entre les microservices.</span><span class="sxs-lookup"><span data-stu-id="6ceba-206">Therefore, in order to enforce microservice autonomy and have better resiliency, you should minimize the use of chains of request/response communication across microservices.</span></span> <span data-ttu-id="6ceba-207">Il est recommandé d’utiliser seulement une interaction asynchrone pour la communication entre les microservices, via une communication asynchrone basée sur des messages et des événements, ou via une interrogation HTTP (asynchrone) indépendante du cycle de requête-réponse HTTP d’origine.</span><span class="sxs-lookup"><span data-stu-id="6ceba-207">It's recommended that you use only asynchronous interaction for inter-microservice communication, either by using asynchronous message- and event-based communication, or by using (asynchronous) HTTP polling independently of the original HTTP request/response cycle.</span></span>

<span data-ttu-id="6ceba-208">L’utilisation d’une communication asynchrone est détaillée plus loin dans ce guide, dans les sections [L’intégration de microservices asynchrones implique l’autonomie des microservices](communication-in-microservice-architecture.md#asynchronous-microservice-integration-enforces-microservices-autonomy) et [Communication asynchrone basée sur des messages](asynchronous-message-based-communication.md).</span><span class="sxs-lookup"><span data-stu-id="6ceba-208">The use of asynchronous communication is explained with additional details later in this guide in the sections [Asynchronous microservice integration enforces microservice's autonomy](communication-in-microservice-architecture.md#asynchronous-microservice-integration-enforces-microservices-autonomy) and [Asynchronous message-based communication](asynchronous-message-based-communication.md).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="6ceba-209">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="6ceba-209">Additional resources</span></span>

- <span data-ttu-id="6ceba-210">**Théorème CAP** </span><span class="sxs-lookup"><span data-stu-id="6ceba-210">**CAP theorem** </span></span>\
  <https://en.wikipedia.org/wiki/CAP_theorem>

- <span data-ttu-id="6ceba-211">**Cohérence à terme** </span><span class="sxs-lookup"><span data-stu-id="6ceba-211">**Eventual consistency** </span></span>\
  <https://en.wikipedia.org/wiki/Eventual_consistency>

- <span data-ttu-id="6ceba-212">**Data Consistency Primer** </span><span class="sxs-lookup"><span data-stu-id="6ceba-212">**Data Consistency Primer** </span></span>\
  <https://docs.microsoft.com/previous-versions/msp-n-p/dn589800(v=pandp.10)>

- <span data-ttu-id="6ceba-213">**Martin Fowler. CQRS (séparation des responsabilités en matière de commande et de requête)**  </span><span class="sxs-lookup"><span data-stu-id="6ceba-213">**Martin Fowler. CQRS (Command and Query Responsibility Segregation)** </span></span>\
  <https://martinfowler.com/bliki/CQRS.html>

- <span data-ttu-id="6ceba-214">**Vue matérialisée** </span><span class="sxs-lookup"><span data-stu-id="6ceba-214">**Materialized View** </span></span>\
  <https://docs.microsoft.com/azure/architecture/patterns/materialized-view>

- <span data-ttu-id="6ceba-215">**Charles Row. ACID vs. BASE: The Shifting pH of Database Transaction Processing** </span><span class="sxs-lookup"><span data-stu-id="6ceba-215">**Charles Row. ACID vs. BASE: The Shifting pH of Database Transaction Processing** </span></span>\
  <https://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/>

- <span data-ttu-id="6ceba-216">**Transaction de compensation** </span><span class="sxs-lookup"><span data-stu-id="6ceba-216">**Compensating Transaction** </span></span>\
  <https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction>

- <span data-ttu-id="6ceba-217">**Udi Dahan. Service Oriented Composition** </span><span class="sxs-lookup"><span data-stu-id="6ceba-217">**Udi Dahan. Service Oriented Composition** </span></span>\
  <http://udidahan.com/2014/07/30/service-oriented-composition-with-video/>

>[!div class="step-by-step"]
><span data-ttu-id="6ceba-218">[Précédent](logical-versus-physical-architecture.md)
>[Suivant](identify-microservice-domain-model-boundaries.md)</span><span class="sxs-lookup"><span data-stu-id="6ceba-218">[Previous](logical-versus-physical-architecture.md)
[Next](identify-microservice-domain-model-boundaries.md)</span></span>

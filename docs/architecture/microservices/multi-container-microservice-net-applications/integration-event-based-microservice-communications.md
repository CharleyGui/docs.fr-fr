---
title: Implémentation de la communication basée sur les événements entre les microservices (événements d’intégration)
description: Architecture des microservices .NET pour les applications .NET conteneurisées | Comprendre les événements d’intégration pour implémenter la communication basée sur les événements entre les microservices.
ms.date: 10/02/2018
ms.openlocfilehash: cbc9d28f9fbcaea528eabc4930476545cb919bb4
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/15/2020
ms.locfileid: "90539344"
---
# <a name="implementing-event-based-communication-between-microservices-integration-events"></a><span data-ttu-id="a10bb-103">Implémentation de la communication basée sur les événements entre les microservices (événements d’intégration)</span><span class="sxs-lookup"><span data-stu-id="a10bb-103">Implementing event-based communication between microservices (integration events)</span></span>

<span data-ttu-id="a10bb-104">Comme décrit précédemment, quand vous utilisez la communication basée sur les événements, un microservice publie un événement chaque fois qu’une chose notable se produit (par exemple, lorsqu’une entité commerciale est mise à jour).</span><span class="sxs-lookup"><span data-stu-id="a10bb-104">As described earlier, when you use event-based communication, a microservice publishes an event when something notable happens, such as when it updates a business entity.</span></span> <span data-ttu-id="a10bb-105">Les autres microservices s’abonnent à ces événements.</span><span class="sxs-lookup"><span data-stu-id="a10bb-105">Other microservices subscribe to those events.</span></span> <span data-ttu-id="a10bb-106">Lorsqu’un microservice reçoit un événement, il peut mettre à jour ses propres entités commerciales, ce qui peut générer la publication d’autres événements.</span><span class="sxs-lookup"><span data-stu-id="a10bb-106">When a microservice receives an event, it can update its own business entities, which might lead to more events being published.</span></span> <span data-ttu-id="a10bb-107">Il s’agit de l’essence même du concept de cohérence éventuelle.</span><span class="sxs-lookup"><span data-stu-id="a10bb-107">This is the essence of the eventual consistency concept.</span></span> <span data-ttu-id="a10bb-108">Ce système de publication/abonnement est généralement obtenu à l’aide de l’implémentation d’un bus d’événements.</span><span class="sxs-lookup"><span data-stu-id="a10bb-108">This publish/subscribe system is usually performed by using an implementation of an event bus.</span></span> <span data-ttu-id="a10bb-109">Le bus d’événements peut être conçu comme l’interface de l’API nécessaire pour s’abonner aux événements et s’en désabonner, ainsi que pour les publier.</span><span class="sxs-lookup"><span data-stu-id="a10bb-109">The event bus can be designed as an interface with the API needed to subscribe and unsubscribe to events and to publish events.</span></span> <span data-ttu-id="a10bb-110">Il peut également avoir une ou plusieurs implémentations basées sur une communication entre processus ou une communication de messagerie, telle qu’une file d’attente de messagerie ou un bus de service prenant en charge la communication asynchrone, ainsi qu’un modèle de publication/abonnement.</span><span class="sxs-lookup"><span data-stu-id="a10bb-110">It can also have one or more implementations based on any inter-process or messaging communication, such as a messaging queue or a service bus that supports asynchronous communication and a publish/subscribe model.</span></span>

<span data-ttu-id="a10bb-111">Vous pouvez utiliser des événements pour implémenter des transactions commerciales concernant plusieurs services, et ainsi obtenir une cohérence à terme entre ces services.</span><span class="sxs-lookup"><span data-stu-id="a10bb-111">You can use events to implement business transactions that span multiple services, which gives you eventual consistency between those services.</span></span> <span data-ttu-id="a10bb-112">Une transaction cohérente à terme se compose d’une série d’actions distribuées.</span><span class="sxs-lookup"><span data-stu-id="a10bb-112">An eventually consistent transaction consists of a series of distributed actions.</span></span> <span data-ttu-id="a10bb-113">À chaque action, le microservice met à jour une entité commerciale et publie un événement qui déclenche l’action suivante.</span><span class="sxs-lookup"><span data-stu-id="a10bb-113">At each action, the microservice updates a business entity and publishes an event that triggers the next action.</span></span> <span data-ttu-id="a10bb-114">La figure 6-18 ci-dessous montre un événement PriceUpdated publié par le biais d’un bus d’événements, ce qui signifie que la mise à jour du prix est propagée vers le panier et d’autres microservices.</span><span class="sxs-lookup"><span data-stu-id="a10bb-114">Figure 6-18 below, shows a PriceUpdated event published through an event bus, so the price update is propagated to the Basket and other microservices.</span></span>

![Diagramme de communication asynchrone pilotée par les événements avec un bus d’événements.](./media/integration-event-based-microservice-communications/event-driven-communication.png)

<span data-ttu-id="a10bb-116">**Figure 6-18.**</span><span class="sxs-lookup"><span data-stu-id="a10bb-116">**Figure 6-18**.</span></span> <span data-ttu-id="a10bb-117">Communication pilotée par les événements et basée sur un bus d’événements</span><span class="sxs-lookup"><span data-stu-id="a10bb-117">Event-driven communication based on an event bus</span></span>

<span data-ttu-id="a10bb-118">Cette section explique comment implémenter ce type de communication avec .NET à l’aide d’une interface de bus d’événements générique, comme indiqué dans la figure 6-18.</span><span class="sxs-lookup"><span data-stu-id="a10bb-118">This section describes how you can implement this type of communication with .NET by using a generic event bus interface, as shown in Figure 6-18.</span></span> <span data-ttu-id="a10bb-119">Il existe plusieurs implémentations possibles, qui utilisent chacune leur propre technologie ou infrastructure, telles que RabbitMQ, Azure Service Bus ou tout autre Service Bus tiers open source ou commercial.</span><span class="sxs-lookup"><span data-stu-id="a10bb-119">There are multiple potential implementations, each using a different technology or infrastructure such as RabbitMQ, Azure Service Bus, or any other third-party open-source or commercial service bus.</span></span>

## <a name="using-message-brokers-and-services-buses-for-production-systems"></a><span data-ttu-id="a10bb-120">Utilisation de répartiteurs de messages et de bus de services pour les systèmes de production</span><span class="sxs-lookup"><span data-stu-id="a10bb-120">Using message brokers and services buses for production systems</span></span>

<span data-ttu-id="a10bb-121">Comme indiqué dans la section relative à l’architecture, vous pouvez choisir parmi plusieurs technologies de messagerie pour l’implémentation de votre bus d’événements abstraits.</span><span class="sxs-lookup"><span data-stu-id="a10bb-121">As noted in the architecture section, you can choose from multiple messaging technologies for implementing your abstract event bus.</span></span> <span data-ttu-id="a10bb-122">Toutefois, ces technologies sont situées à des niveaux différents.</span><span class="sxs-lookup"><span data-stu-id="a10bb-122">But these technologies are at different levels.</span></span> <span data-ttu-id="a10bb-123">Par exemple, le répartiteur de messages RabbitMQ se trouve à un niveau inférieur à celui des produits commerciaux tels qu’Azure Service Bus, NServiceBus, MassTransit ou Brighter.</span><span class="sxs-lookup"><span data-stu-id="a10bb-123">For instance, RabbitMQ, a messaging broker transport, is at a lower level than commercial products like Azure Service Bus, NServiceBus, MassTransit, or Brighter.</span></span> <span data-ttu-id="a10bb-124">La plupart de ces produits peuvent fonctionner par-dessus RabbitMQ ou Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="a10bb-124">Most of these products can work on top of either RabbitMQ or Azure Service Bus.</span></span> <span data-ttu-id="a10bb-125">Vous devez choisir le produit en fonction du nombre de fonctionnalités et du niveau de scalabilité prête à l’emploi dont vous avez besoin pour votre application.</span><span class="sxs-lookup"><span data-stu-id="a10bb-125">Your choice of product depends on how many features and how much out-of-the-box scalability you need for your application.</span></span>

<span data-ttu-id="a10bb-126">Si vous souhaitez uniquement implémenter une preuve de concept de bus d’événements pour votre environnement de développement, comme dans l’exemple eShopOnContainers, une simple implémentation par-dessus RabbitMQ exécutée dans un conteneur peut être suffisante.</span><span class="sxs-lookup"><span data-stu-id="a10bb-126">For implementing just an event bus proof-of-concept for your development environment, as in the eShopOnContainers sample, a simple implementation on top of RabbitMQ running as a container might be enough.</span></span> <span data-ttu-id="a10bb-127">Toutefois, pour les systèmes stratégiques et les systèmes de production qui nécessitent un haut niveau de scalabilité, il peut être utile d’évaluer et d’utiliser Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="a10bb-127">But for mission-critical and production systems that need high scalability, you might want to evaluate and use Azure Service Bus.</span></span>

<span data-ttu-id="a10bb-128">Si vous avez besoin d’un haut niveau d’abstraction et de fonctionnalités plus riches telles que [Sagas](https://docs.particular.net/nservicebus/sagas/) pour les processus longs qui facilitent le développement distribué, d’autres bus de services commerciaux et open source comme NServiceBus, MassTransit et Brighter méritent d’être évalués.</span><span class="sxs-lookup"><span data-stu-id="a10bb-128">If you require high-level abstractions and richer features like [Sagas](https://docs.particular.net/nservicebus/sagas/) for long-running processes that make distributed development easier, other commercial and open-source service buses like NServiceBus, MassTransit, and Brighter are worth evaluating.</span></span> <span data-ttu-id="a10bb-129">Dans ce cas, les abstractions et l’API à utiliser sont généralement celles fournies par ces bus de services de haut niveau, et non vos propres abstractions (comme les [abstractions de bus d’événements simples fournies dans eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers/blob/dev/src/BuildingBlocks/EventBus/EventBus/Abstractions/IEventBus.cs)).</span><span class="sxs-lookup"><span data-stu-id="a10bb-129">In this case, the abstractions and API to use would usually be directly the ones provided by those high-level service buses instead of your own abstractions (like the [simple event bus abstractions provided at eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers/blob/dev/src/BuildingBlocks/EventBus/EventBus/Abstractions/IEventBus.cs)).</span></span> <span data-ttu-id="a10bb-130">Pour ce faire, vous pouvez rechercher les [eShopOnContainers dupliqués à l’aide de NServiceBus](https://go.particular.net/eShopOnContainers) (exemple dérivé supplémentaire implémenté par un logiciel particulier).</span><span class="sxs-lookup"><span data-stu-id="a10bb-130">For that matter, you can research the [forked eShopOnContainers using NServiceBus](https://go.particular.net/eShopOnContainers) (additional derived sample implemented by Particular Software).</span></span>

<span data-ttu-id="a10bb-131">Bien sûr, vous pourriez toujours créer vos propres fonctionnalités service bus sur des technologies de niveau inférieur telles que RabbitMQ et docker, mais le travail nécessaire pour « réinventer la roue » peut être trop coûteux pour une application d’entreprise personnalisée.</span><span class="sxs-lookup"><span data-stu-id="a10bb-131">Of course, you could always build your own service bus features on top of lower-level technologies like RabbitMQ and Docker, but the work needed to "reinvent the wheel" might be too costly for a custom enterprise application.</span></span>

<span data-ttu-id="a10bb-132">Pour réitérer : les exemples d’abstractions de bus d’événements et d’implémentation présentés dans l’exemple eShopOnContainers sont destinés à être utilisés uniquement comme preuve de concept.</span><span class="sxs-lookup"><span data-stu-id="a10bb-132">To reiterate: the sample event bus abstractions and implementation showcased in the eShopOnContainers sample are intended to be used only as a proof of concept.</span></span> <span data-ttu-id="a10bb-133">Une fois que vous avez décidé que vous souhaitez établir une communication asynchrone et pilotée par les événements, comme expliqué dans la section actuelle, vous devez choisir le produit Service Bus qui convient le mieux à vos besoins pour la production.</span><span class="sxs-lookup"><span data-stu-id="a10bb-133">Once you have decided that you want to have asynchronous and event-driven communication, as explained in the current section, you should choose the service bus product that best fits your needs for production.</span></span>

## <a name="integration-events"></a><span data-ttu-id="a10bb-134">Événements d’intégration</span><span class="sxs-lookup"><span data-stu-id="a10bb-134">Integration events</span></span>

<span data-ttu-id="a10bb-135">Les événements d’intégration sont utilisés pour synchroniser l’état du domaine sur plusieurs microservices ou systèmes externes.</span><span class="sxs-lookup"><span data-stu-id="a10bb-135">Integration events are used for bringing domain state in sync across multiple microservices or external systems.</span></span> <span data-ttu-id="a10bb-136">Pour cela, vous devez publier les événements d’intégration en dehors du microservice.</span><span class="sxs-lookup"><span data-stu-id="a10bb-136">This is done by publishing integration events outside the microservice.</span></span> <span data-ttu-id="a10bb-137">Lorsqu’un événement est publié sur plusieurs microservices récepteurs (sur tous les microservices abonnés à l’événement d’intégration), le gestionnaire d’événements de chaque microservice récepteur gère l’événement.</span><span class="sxs-lookup"><span data-stu-id="a10bb-137">When an event is published to multiple receiver microservices (to as many microservices as are subscribed to the integration event), the appropriate event handler in each receiver microservice handles the event.</span></span>

<span data-ttu-id="a10bb-138">Un événement d’intégration est essentiellement une classe conteneur de données, comme le montre l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="a10bb-138">An integration event is basically a data-holding class, as in the following example:</span></span>

```csharp
public class ProductPriceChangedIntegrationEvent : IntegrationEvent
{
    public int ProductId { get; private set; }
    public decimal NewPrice { get; private set; }
    public decimal OldPrice { get; private set; }

    public ProductPriceChangedIntegrationEvent(int productId, decimal newPrice,
        decimal oldPrice)
    {
        ProductId = productId;
        NewPrice = newPrice;
        OldPrice = oldPrice;
    }
}
```

<span data-ttu-id="a10bb-139">Les événements d’intégration peuvent être définis au niveau de l’application de chaque microservice. De cette façon, ils sont dissociés des autres microservices, d’une manière comparable à la façon dont les ViewModels sont définis sur le serveur et sur le client.</span><span class="sxs-lookup"><span data-stu-id="a10bb-139">The integration events can be defined at the application level of each microservice, so they are decoupled from other microservices, in a way comparable to how ViewModels are defined in the server and client.</span></span> <span data-ttu-id="a10bb-140">Cependant, il n’est pas recommandé de partager une bibliothèque d’événements d’intégration entre plusieurs microservices, car cela aurait pour effet de coupler ces microservices avec une seule bibliothèque de données de définition d’événements.</span><span class="sxs-lookup"><span data-stu-id="a10bb-140">What is not recommended is sharing a common integration events library across multiple microservices; doing that would be coupling those microservices with a single event definition data library.</span></span> <span data-ttu-id="a10bb-141">Un tel partage est déconseillé, tout comme le partage d’un modèle de domaine entre plusieurs microservices, car les microservices doivent être complètement autonomes.</span><span class="sxs-lookup"><span data-stu-id="a10bb-141">You do not want to do that for the same reasons that you do not want to share a common domain model across multiple microservices: microservices must be completely autonomous.</span></span>

<span data-ttu-id="a10bb-142">Seules certaines bibliothèques peuvent être partagées entre plusieurs microservices.</span><span class="sxs-lookup"><span data-stu-id="a10bb-142">There are only a few kinds of libraries you should share across microservices.</span></span> <span data-ttu-id="a10bb-143">Parmi elles figurent les bibliothèques qui sont des blocs d’application finale, comme [l’API cliente Event Bus](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/BuildingBlocks/EventBus) de l’exemple eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="a10bb-143">One is libraries that are final application blocks, like the [Event Bus client API](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/BuildingBlocks/EventBus), as in eShopOnContainers.</span></span> <span data-ttu-id="a10bb-144">Vous avez également les bibliothèques qui constituent des outils pouvant être partagés en tant que composants NuGet, comme les sérialiseurs JSON.</span><span class="sxs-lookup"><span data-stu-id="a10bb-144">Another is libraries that constitute tools that could also be shared as NuGet components, like JSON serializers.</span></span>

## <a name="the-event-bus"></a><span data-ttu-id="a10bb-145">Le bus d’événements</span><span class="sxs-lookup"><span data-stu-id="a10bb-145">The event bus</span></span>

<span data-ttu-id="a10bb-146">Un bus d’événements permet une communication de type publication/abonnement entre les microservices, sans nécessiter que les composants soient explicitement informés de la présence des uns des autres, comme le montre la figure 6-19.</span><span class="sxs-lookup"><span data-stu-id="a10bb-146">An event bus allows publish/subscribe-style communication between microservices without requiring the components to explicitly be aware of each other, as shown in Figure 6-19.</span></span>

![Diagramme montrant le modèle de publication/d’abonnement de base.](./media/integration-event-based-microservice-communications/publish-subscribe-basics.png)

<span data-ttu-id="a10bb-148">**Figure 6-19.**</span><span class="sxs-lookup"><span data-stu-id="a10bb-148">**Figure 6-19**.</span></span> <span data-ttu-id="a10bb-149">Principes de base de la communication de type publication/abonnement avec un bus d’événements</span><span class="sxs-lookup"><span data-stu-id="a10bb-149">Publish/subscribe basics with an event bus</span></span>

<span data-ttu-id="a10bb-150">Le diagramme ci-dessus montre que le microservice A effectue une publication sur le bus d’événements, qui distribue aux microservices B et C d’abonnement, sans que le serveur de publication doive connaître les abonnés.</span><span class="sxs-lookup"><span data-stu-id="a10bb-150">The above diagram shows that microservice A publishes to Event Bus, which distributes to subscribing microservices B and C, without the publisher needing to know the subscribers.</span></span> <span data-ttu-id="a10bb-151">Le bus d’événements est lié au modèle Observateur et au modèle Publication/Abonnement.</span><span class="sxs-lookup"><span data-stu-id="a10bb-151">The event bus is related to the Observer pattern and the publish-subscribe pattern.</span></span>

### <a name="observer-pattern"></a><span data-ttu-id="a10bb-152">Modèle Observateur</span><span class="sxs-lookup"><span data-stu-id="a10bb-152">Observer pattern</span></span>

<span data-ttu-id="a10bb-153">Dans le [modèle Observateur](https://en.wikipedia.org/wiki/Observer_pattern), votre objet principal (l’observable) envoie aux autres objets intéressés (les observateurs) des informations pertinentes (des événements).</span><span class="sxs-lookup"><span data-stu-id="a10bb-153">In the [Observer pattern](https://en.wikipedia.org/wiki/Observer_pattern), your primary object (known as the Observable) notifies other interested objects (known as Observers) with relevant information (events).</span></span>

### <a name="publishsubscribe-pubsub-pattern"></a><span data-ttu-id="a10bb-154">Modèle Publication/Abonnement</span><span class="sxs-lookup"><span data-stu-id="a10bb-154">Publish/Subscribe (Pub/Sub) pattern</span></span>

<span data-ttu-id="a10bb-155">L’objectif du [modèle Publication/Abonnement](https://docs.microsoft.com/previous-versions/msp-n-p/ff649664(v=pandp.10)) est le même que celui du modèle Observateur, c’est-à-dire que vous souhaitez informer les autres services de certains événements.</span><span class="sxs-lookup"><span data-stu-id="a10bb-155">The purpose of the [Publish/Subscribe pattern](https://docs.microsoft.com/previous-versions/msp-n-p/ff649664(v=pandp.10)) is the same as the Observer pattern: you want to notify other services when certain events take place.</span></span> <span data-ttu-id="a10bb-156">Toutefois, il existe une différence importante entre ces deux modèles.</span><span class="sxs-lookup"><span data-stu-id="a10bb-156">But there is an important difference between the Observer and Pub/Sub patterns.</span></span> <span data-ttu-id="a10bb-157">Dans le modèle d’observateur, la diffusion est effectuée directement à partir de l’observable vers les observateurs, de sorte qu’ils se « identifient » les uns les autres.</span><span class="sxs-lookup"><span data-stu-id="a10bb-157">In the observer pattern, the broadcast is performed directly from the observable to the observers, so they "know" each other.</span></span> <span data-ttu-id="a10bb-158">En revanche, lorsque vous utilisez un modèle Publication/Abonnement, un troisième élément est impliqué. Il s’agit du répartiteur (de messages) ou du bus d’événements, qui est connu à la fois de celui qui publie et de celui qui s’abonne.</span><span class="sxs-lookup"><span data-stu-id="a10bb-158">But when using a Pub/Sub pattern, there is a third component, called broker or message broker or event bus, which is known by both the publisher and subscriber.</span></span> <span data-ttu-id="a10bb-159">Par conséquent, lorsque vous utilisez le modèle Publication/Abonnement, celui qui publie et ses abonnés sont dissociés grâce au bus d’événements ou au répartiteur de messages.</span><span class="sxs-lookup"><span data-stu-id="a10bb-159">Therefore, when using the Pub/Sub pattern the publisher and the subscribers are precisely decoupled thanks to the mentioned event bus or message broker.</span></span>

### <a name="the-middleman-or-event-bus"></a><span data-ttu-id="a10bb-160">L’intermédiaire ou le bus d’événements</span><span class="sxs-lookup"><span data-stu-id="a10bb-160">The middleman or event bus</span></span>

<span data-ttu-id="a10bb-161">Comment permettre l’anonymat entre celui qui publie les événements et ses abonnés ?</span><span class="sxs-lookup"><span data-stu-id="a10bb-161">How do you achieve anonymity between publisher and subscriber?</span></span> <span data-ttu-id="a10bb-162">Un moyen simple consiste à laisser un intermédiaire s’occuper de toutes les communications.</span><span class="sxs-lookup"><span data-stu-id="a10bb-162">An easy way is let a middleman take care of all the communication.</span></span> <span data-ttu-id="a10bb-163">Un bus d’événements joue le rôle de cet intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="a10bb-163">An event bus is one such middleman.</span></span>

<span data-ttu-id="a10bb-164">Un bus d’événements est généralement constitué de deux parties :</span><span class="sxs-lookup"><span data-stu-id="a10bb-164">An event bus is typically composed of two parts:</span></span>

- <span data-ttu-id="a10bb-165">L’abstraction ou interface</span><span class="sxs-lookup"><span data-stu-id="a10bb-165">The abstraction or interface.</span></span>

- <span data-ttu-id="a10bb-166">Une ou plusieurs implémentations</span><span class="sxs-lookup"><span data-stu-id="a10bb-166">One or more implementations.</span></span>

<span data-ttu-id="a10bb-167">Dans la figure 6-19, vous pouvez voir que, du point de vue d’une application, le bus d’événements n’est autre qu’un canal de publication/abonnement.</span><span class="sxs-lookup"><span data-stu-id="a10bb-167">In Figure 6-19 you can see how, from an application point of view, the event bus is nothing more than a Pub/Sub channel.</span></span> <span data-ttu-id="a10bb-168">La façon dont vous implémentez cette communication asynchrone peut varier.</span><span class="sxs-lookup"><span data-stu-id="a10bb-168">The way you implement this asynchronous communication can vary.</span></span> <span data-ttu-id="a10bb-169">Plusieurs implémentations sont possibles, de sorte que vous pouvez passer de l’une à l’autre, selon les exigences de votre environnement (par exemple, s’il s’agit d’un environnement de production ou d’un environnement de développement).</span><span class="sxs-lookup"><span data-stu-id="a10bb-169">It can have multiple implementations so that you can swap between them, depending on the environment requirements (for example, production versus development environments).</span></span>

<span data-ttu-id="a10bb-170">Dans la figure 6-20, vous pouvez voir une abstraction d’un bus d’événements avec plusieurs implémentations basées sur des technologies de messagerie d’infrastructure, telles que RabbitMQ, Azure Service Bus ou un autre répartiteur de messages/événements.</span><span class="sxs-lookup"><span data-stu-id="a10bb-170">In Figure 6-20 you can see an abstraction of an event bus with multiple implementations based on infrastructure messaging technologies like RabbitMQ, Azure Service Bus, or another event/message broker.</span></span>

![Diagramme montrant l’ajout d’une couche d’abstraction de bus d’événements.](./media/integration-event-based-microservice-communications/multiple-implementations-event-bus.png)

<span data-ttu-id="a10bb-172">**Figure 6-20.**</span><span class="sxs-lookup"><span data-stu-id="a10bb-172">**Figure 6- 20.**</span></span> <span data-ttu-id="a10bb-173">Les différentes implémentations d’un bus d’événements</span><span class="sxs-lookup"><span data-stu-id="a10bb-173">Multiple implementations of an event bus</span></span>

<span data-ttu-id="a10bb-174">Il est judicieux de définir le bus d’événements par le biais d’une interface, pour pouvoir l’implémenter avec plusieurs technologies comme RabbitMQ Azure Service Bus ou autre.</span><span class="sxs-lookup"><span data-stu-id="a10bb-174">It's good to have the event bus defined through an interface so it can be implemented with several technologies, like RabbitMQ Azure Service bus or others.</span></span> <span data-ttu-id="a10bb-175">Toutefois, comme mentionné précédemment, l’utilisation de vos propres abstractions (l’interface du bus d’événements) convient uniquement si vous avez besoin de fonctionnalités de bus d’événements de base, prises en charge par vos abstractions.</span><span class="sxs-lookup"><span data-stu-id="a10bb-175">However, and as mentioned previously, using your own abstractions (the event bus interface) is good only if you need basic event bus features supported by your abstractions.</span></span> <span data-ttu-id="a10bb-176">Si vous avez besoin de fonctionnalités de bus de services plus riches, utilisez l’API et les abstractions fournies par votre bus de services commercial préféré, plutôt que vos propres abstractions.</span><span class="sxs-lookup"><span data-stu-id="a10bb-176">If you need richer service bus features, you should probably use the API and abstractions provided by your preferred commercial service bus instead of your own abstractions.</span></span>

### <a name="defining-an-event-bus-interface"></a><span data-ttu-id="a10bb-177">Définition de l’interface d’un bus d’événements</span><span class="sxs-lookup"><span data-stu-id="a10bb-177">Defining an event bus interface</span></span>

<span data-ttu-id="a10bb-178">Commençons par un code d’implémentation pour l’interface du bus d’événements et des implémentations possibles à des fins d’exploration.</span><span class="sxs-lookup"><span data-stu-id="a10bb-178">Let's start with some implementation code for the event bus interface and possible implementations for exploration purposes.</span></span> <span data-ttu-id="a10bb-179">L’interface doit être générique et simple, comme celle qui suit.</span><span class="sxs-lookup"><span data-stu-id="a10bb-179">The interface should be generic and straightforward, as in the following interface.</span></span>

```csharp
public interface IEventBus
{
    void Publish(IntegrationEvent @event);

    void Subscribe<T, TH>()
        where T : IntegrationEvent
        where TH : IIntegrationEventHandler<T>;

    void SubscribeDynamic<TH>(string eventName)
        where TH : IDynamicIntegrationEventHandler;

    void UnsubscribeDynamic<TH>(string eventName)
        where TH : IDynamicIntegrationEventHandler;

    void Unsubscribe<T, TH>()
        where TH : IIntegrationEventHandler<T>
        where T : IntegrationEvent;
}
```

<span data-ttu-id="a10bb-180">La méthode `Publish` est simple.</span><span class="sxs-lookup"><span data-stu-id="a10bb-180">The `Publish` method is straightforward.</span></span> <span data-ttu-id="a10bb-181">Le bus d’événements va diffuser l’événement d’intégration qui lui a été passé à tous les microservices, et même aux applications externes, abonnées à cet événement.</span><span class="sxs-lookup"><span data-stu-id="a10bb-181">The event bus will broadcast the integration event passed to it to any microservice, or even an external application, subscribed to that event.</span></span> <span data-ttu-id="a10bb-182">Cette méthode est utilisée par le microservice qui publie l’événement.</span><span class="sxs-lookup"><span data-stu-id="a10bb-182">This method is used by the microservice that is publishing the event.</span></span>

<span data-ttu-id="a10bb-183">Les méthodes `Subscribe` (vous pouvez avoir plusieurs implémentations selon les arguments) sont utilisées par les microservices qui souhaitent recevoir des événements.</span><span class="sxs-lookup"><span data-stu-id="a10bb-183">The `Subscribe` methods (you can have several implementations depending on the arguments) are used by the microservices that want to receive events.</span></span> <span data-ttu-id="a10bb-184">Cette méthode a deux arguments.</span><span class="sxs-lookup"><span data-stu-id="a10bb-184">This method has two arguments.</span></span> <span data-ttu-id="a10bb-185">Le premier est l’événement d’intégration auquel s’abonner (`IntegrationEvent`).</span><span class="sxs-lookup"><span data-stu-id="a10bb-185">The first is the integration event to subscribe to (`IntegrationEvent`).</span></span> <span data-ttu-id="a10bb-186">Le deuxième argument est le gestionnaire d’événements d’intégration (ou méthode de rappel) nommé `IIntegrationEventHandler<T>`, qui doit être exécuté lorsque le microservice récepteur obtient le message d’événement d’intégration.</span><span class="sxs-lookup"><span data-stu-id="a10bb-186">The second argument is the integration event handler (or callback method), named `IIntegrationEventHandler<T>`, to be executed when the receiver microservice gets that integration event message.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="a10bb-187">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="a10bb-187">Additional resources</span></span>

<span data-ttu-id="a10bb-188">Certaines solutions de messagerie prêtes pour la production :</span><span class="sxs-lookup"><span data-stu-id="a10bb-188">Some production-ready messaging solutions:</span></span>

- <span data-ttu-id="a10bb-189">**Azure Service Bus** </span><span class="sxs-lookup"><span data-stu-id="a10bb-189">**Azure Service Bus** </span></span>\
  <https://docs.microsoft.com/azure/service-bus-messaging/>
  
- <span data-ttu-id="a10bb-190">**NServiceBus** </span><span class="sxs-lookup"><span data-stu-id="a10bb-190">**NServiceBus** </span></span>\
  <https://particular.net/nservicebus>
  
- <span data-ttu-id="a10bb-191">**MassTransit** </span><span class="sxs-lookup"><span data-stu-id="a10bb-191">**MassTransit** </span></span>\
  <https://masstransit-project.com/>

> [!div class="step-by-step"]
> <span data-ttu-id="a10bb-192">[Précédent](database-server-container.md) 
>  [Suivant](rabbitmq-event-bus-development-test-environment.md)</span><span class="sxs-lookup"><span data-stu-id="a10bb-192">[Previous](database-server-container.md)
[Next](rabbitmq-event-bus-development-test-environment.md)</span></span>

---
title: Fonctions Azure durables - Applications sans serveur
description: Les fonctions Azure durables prolongent le temps d’exécution azure Functions pour activer les flux de travail majestueux dans le code.
author: cecilphillip
ms.author: cephilli
ms.date: 06/26/2018
ms.openlocfilehash: 2c0ad086640409ac187c3aa882add4d6b39b6ff9
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/14/2020
ms.locfileid: "72522864"
---
# <a name="durable-azure-functions"></a><span data-ttu-id="2dcd7-103">Fonctions Azure durables</span><span class="sxs-lookup"><span data-stu-id="2dcd7-103">Durable Azure functions</span></span>

<span data-ttu-id="2dcd7-104">Lors de la création d’applications sans serveur avec Azure Functions, vos opérations sont généralement conçues pour fonctionner de manière apatride.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-104">When creating serverless applications with Azure Functions, your operations will typically be designed to run in a stateless manner.</span></span> <span data-ttu-id="2dcd7-105">La raison de ce choix de conception est parce que comme la plate-forme échelles, il devient difficile de savoir quels serveurs le code est en cours d’exécution sur.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-105">The reason for this design choice is because as the platform scales, it becomes difficult to know what servers the code is running on.</span></span> <span data-ttu-id="2dcd7-106">Il devient également difficile de savoir combien de cas sont actifs à un moment donné.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-106">It also becomes difficult to know how many instances are active at any given point.</span></span> <span data-ttu-id="2dcd7-107">Cependant, il existe des catégories de demandes qui exigent que l’état actuel d’un processus soit connu.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-107">However, there are classes of applications that require the current state of a process to be known.</span></span> <span data-ttu-id="2dcd7-108">Considérez le processus de soumission d’une commande à une boutique en ligne.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-108">Consider the process of submitting an order to an online store.</span></span> <span data-ttu-id="2dcd7-109">L’opération de caisse peut être un flux de travail qui est composé de multiples opérations qui ont besoin de connaître l’état du processus.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-109">The checkout operation might be a workflow that is composed of multiple operations that need to know the state of the process.</span></span> <span data-ttu-id="2dcd7-110">Ces informations peuvent inclure l’inventaire du produit, si le client a des crédits sur son compte, ainsi que les résultats du traitement de la carte de crédit.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-110">Such information may include the product inventory, if the customer has any credits on their account, and also the results of processing the credit card.</span></span> <span data-ttu-id="2dcd7-111">Ces opérations pourraient facilement être leurs propres flux de travail internes ou même des services à partir de systèmes tiers.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-111">These operations could easily be their own internal workflows or even services from third-party systems.</span></span>

<span data-ttu-id="2dcd7-112">Il existe aujourd’hui divers modèles qui aident à la coordination de l’état d’application entre les systèmes internes et externes.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-112">Various patterns exist today that assist with the coordination of application state between internal and external systems.</span></span> <span data-ttu-id="2dcd7-113">Il est courant de trouver des solutions qui reposent sur des systèmes de file d’attente centralisés, des magasins à valeur clé distribués ou des bases de données partagées pour gérer cet état.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-113">It's common to come across solutions that rely on centralized queuing systems, distributed key-value stores, or shared databases to manage that state.</span></span> <span data-ttu-id="2dcd7-114">Cependant, il s’agit là de ressources supplémentaires qui doivent maintenant être mises à disposition et gérées.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-114">However, these are all additional resources that now need to be provisioned and managed.</span></span> <span data-ttu-id="2dcd7-115">Dans un environnement sans serveur, votre code pourrait devenir lourd en essayant de coordonner avec ces ressources manuellement.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-115">In a serverless environment, your code could become cumbersome trying to coordinate with these resources manually.</span></span> <span data-ttu-id="2dcd7-116">Azure Functions offre une alternative pour créer des fonctions étatiques appelées Fonctions durables.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-116">Azure Functions offers an alternative for creating stateful functions called Durable Functions.</span></span>

<span data-ttu-id="2dcd7-117">Fonctions durables est une extension de l’exécution Azure Functions qui permet la définition des flux de travail majestueux dans le code.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-117">Durable Functions is an extension to the Azure Functions runtime that enables the definition of stateful workflows in code.</span></span> <span data-ttu-id="2dcd7-118">En décomposant les flux de travail en activités, l’extension des fonctions durables peut gérer l’état, créer des points de contrôle de progression et gérer la distribution des appels de fonctions entre les serveurs.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-118">By breaking down workflows into activities, the Durable Functions extension can manage state, create progress checkpoints, and handle the distribution of function calls across servers.</span></span> <span data-ttu-id="2dcd7-119">En arrière-plan, il utilise un compte De stockage Azure pour poursuivre l’historique d’exécution, planifier les fonctions d’activité et récupérer les réponses.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-119">In the background, it makes use of an Azure Storage account to persist execution history, schedule activity functions and retrieve responses.</span></span> <span data-ttu-id="2dcd7-120">Votre code sans serveur ne doit jamais interagir avec des informations persistantes dans ce compte de stockage, et n’est généralement pas quelque chose avec lequel les développeurs ont besoin d’interagir.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-120">Your serverless code should never interact with persisted information in that storage account, and is typically not something with which developers need to interact.</span></span>

## <a name="triggering-a-stateful-workflow"></a><span data-ttu-id="2dcd7-121">Déclenchement d’un flux de travail étatique</span><span class="sxs-lookup"><span data-stu-id="2dcd7-121">Triggering a stateful workflow</span></span>

<span data-ttu-id="2dcd7-122">Les flux de travail d’état dans les fonctions durables peuvent être décomposés en deux composants intrinsèques ; l’orchestration et les déclencheurs d’activité.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-122">Stateful workflows in Durable Functions can be broken down into two intrinsic components; orchestration and activity triggers.</span></span> <span data-ttu-id="2dcd7-123">Les déclencheurs et les fixations sont des composants de base utilisés par Azure Functions pour permettre à vos fonctions sans serveur d’être notifiées au moment de démarrer, de recevoir des entrées et de retourner les résultats.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-123">Triggers and bindings are core components used by Azure Functions to enable your serverless functions to be notified when to start, receive input, and return results.</span></span>

### <a name="working-with-the-orchestration-client"></a><span data-ttu-id="2dcd7-124">Travailler avec le client Orchestration</span><span class="sxs-lookup"><span data-stu-id="2dcd7-124">Working with the Orchestration client</span></span>

<span data-ttu-id="2dcd7-125">Les orchestrations sont uniques par rapport à d’autres styles d’opérations déclenchées dans Azure Functions.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-125">Orchestrations are unique when compared to other styles of triggered operations in Azure Functions.</span></span> <span data-ttu-id="2dcd7-126">Les fonctions durables permettent l’exécution de fonctions qui peuvent prendre des heures, voire des jours.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-126">Durable Functions enables the execution of functions that may take hours or even days to complete.</span></span> <span data-ttu-id="2dcd7-127">Ce type de comportement vient avec la nécessité de vérifier l’état d’une orchestration en cours d’exécution, de manière préventive, ou d’envoyer des notifications d’événements externes.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-127">That type of behavior comes with the need to able to check the status of a running orchestration, preemptively terminate, or send notifications of external events.</span></span>

<span data-ttu-id="2dcd7-128">Dans de tels cas, l’extension Des fonctions durables fournit la `DurableOrchestrationClient` classe qui vous permet d’interagir avec des fonctions orchestrées.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-128">For such cases, the Durable Functions extension provides the `DurableOrchestrationClient` class that allows you to interact with orchestrated functions.</span></span> <span data-ttu-id="2dcd7-129">Vous avez accès au client d’orchestration en utilisant la `OrchestrationClientAttribute` liaison.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-129">You get access to the orchestration client by using the `OrchestrationClientAttribute` binding.</span></span> <span data-ttu-id="2dcd7-130">Généralement, vous incluriez cet attribut avec un `HttpTrigger` `ServiceBusTrigger`autre type de déclenchement, tel qu’un ou .</span><span class="sxs-lookup"><span data-stu-id="2dcd7-130">Generally, you would include this attribute with another trigger type, such as an `HttpTrigger` or `ServiceBusTrigger`.</span></span> <span data-ttu-id="2dcd7-131">Une fois que la fonction source a été déclenchée, le client d’orchestration peut être utilisé pour démarrer une fonction d’orchestrateur.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-131">Once the source function has been triggered, the orchestration client can be used to start an orchestrator function.</span></span>

```csharp
[FunctionName("KickOff")]
public static async Task<HttpResponseMessage> Run(
    [HttpTrigger(AuthorizationLevel.Function, "POST")]HttpRequestMessage req,
    [OrchestrationClient ] DurableOrchestrationClient<orchestrationClient>)
{
    OrderRequestData data = await req.Content.ReadAsAsync<OrderRequestData>();

    string instanceId = await orchestrationClient.StartNewAsync("PlaceOrder", data);

    return orchestrationClient.CreateCheckStatusResponse(req, instanceId);
}
```

### <a name="the-orchestrator-function"></a><span data-ttu-id="2dcd7-132">La fonction orchestrateur</span><span class="sxs-lookup"><span data-stu-id="2dcd7-132">The orchestrator function</span></span>

<span data-ttu-id="2dcd7-133">Annoter une fonction avec l’OrchestrationTriggerAttribute dans Azure Functions marque qui fonctionnent comme une fonction d’orchestrateur.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-133">Annotating a function with the OrchestrationTriggerAttribute in Azure Functions marks that function as an orchestrator function.</span></span> <span data-ttu-id="2dcd7-134">Il est responsable de la gestion des différentes activités qui composent votre flux de travail majestueux.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-134">It's responsible for managing the various activities that make up your stateful workflow.</span></span>

<span data-ttu-id="2dcd7-135">Les fonctions d’orchestrateur ne peuvent pas utiliser des fixations autres que l’OrchestrationTriggerAttribute.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-135">Orchestrator functions are unable to make use of bindings other than the OrchestrationTriggerAttribute.</span></span> <span data-ttu-id="2dcd7-136">Cet attribut ne peut être utilisé qu’avec un type de paramètre durableOrchestrationContexte.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-136">This attribute can only be used with a parameter type of DurableOrchestrationContext.</span></span> <span data-ttu-id="2dcd7-137">Aucune autre entrée ne peut être utilisée puisque la désétérialisation des entrées dans la signature de la fonction n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-137">No other inputs can be used since deserialization of inputs in the function signature isn't supported.</span></span> <span data-ttu-id="2dcd7-138">Pour obtenir des entrées fournies par le client\<\> d’orchestration, la méthode GetInput T doit être utilisée.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-138">To get inputs provided by the orchestration client, the GetInput\<T\> method must be used.</span></span>

<span data-ttu-id="2dcd7-139">En outre, les types de retour des fonctions d’orchestration doivent être soit vide, tâche, ou une valeur sérialisable JSON.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-139">Also, the return types of orchestration functions must be either void, Task, or a JSON serializable value.</span></span>

> <span data-ttu-id="2dcd7-140">*Le code de traitement des erreurs a été laissé de côté pour la brièveté*</span><span class="sxs-lookup"><span data-stu-id="2dcd7-140">*Error handling code has been left out for brevity*</span></span>

```csharp
[FunctionName("PlaceOrder")]
public static async Task<string> PlaceOrder([OrchestrationTrigger] DurableOrchestrationContext context)
{
    OrderRequestData orderData = context.GetInput<OrderRequestData>();

    await context.CallActivityAsync<bool>("CheckAndReserveInventory", orderData);
    await context.CallActivityAsync<string>("ProcessPayment", orderData);

    string trackingNumber = await context.CallActivityAsync<string>("ScheduleShipping", orderData);
    await context.CallActivityAsync<string>("EmailCustomer", trackingNumber);

    return trackingNumber;
}
```

<span data-ttu-id="2dcd7-141">De multiples cas d’orchestration peuvent être lancés et en cours d’exécution en même temps.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-141">Multiple instances of an orchestration can be started and running at the same time.</span></span> <span data-ttu-id="2dcd7-142">Appeler `StartNewAsync` la méthode `DurableOrchestrationClient` sur les lancements d’une nouvelle instance de l’orchestration.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-142">Calling the `StartNewAsync` method on the `DurableOrchestrationClient` launches a new instance of the orchestration.</span></span> <span data-ttu-id="2dcd7-143">La méthode `Task<string>` renvoie un qui se termine lorsque l’orchestration a commencé.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-143">The method returns a `Task<string>` that completes when the orchestration has started.</span></span> <span data-ttu-id="2dcd7-144">Une exception `TimeoutException` de type est lancée si l’orchestration n’a pas commencé dans les 30 secondes.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-144">An exception of type `TimeoutException` gets thrown if the orchestration hasn't started within 30 seconds.</span></span>

<span data-ttu-id="2dcd7-145">Le `Task<string>` devait `StartNewAsync` contenir l’ID unique de l’instance d’orchestration.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-145">The completed `Task<string>` from `StartNewAsync` should contain the unique ID of the orchestration instance.</span></span> <span data-ttu-id="2dcd7-146">Cette pièce d’identité d’instance peut être utilisée pour invoquer des opérations sur cette orchestration spécifique.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-146">This instance ID can be used to invoke operations on that specific orchestration.</span></span> <span data-ttu-id="2dcd7-147">L’orchestration peut être demandée pour l’état ou envoyé des notifications d’événement.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-147">The orchestration can be queried for the status or sent event notifications.</span></span>

### <a name="the-activity-functions"></a><span data-ttu-id="2dcd7-148">Les fonctions d’activité</span><span class="sxs-lookup"><span data-stu-id="2dcd7-148">The activity functions</span></span>

<span data-ttu-id="2dcd7-149">Les fonctions d’activité sont les opérations discrètes qui se sont composées au sein d’une fonction d’orchestration pour créer le flux de travail.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-149">Activity functions are the discrete operations that get composed together within an orchestration function to create the workflow.</span></span> <span data-ttu-id="2dcd7-150">Voici où la plupart des travaux réels auraient lieu.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-150">Here is where most of actual work would take place.</span></span> <span data-ttu-id="2dcd7-151">Ils représentent la logique d’affaires, les processus de longue durée, et les pièces de puzzle à une solution plus grande.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-151">They represent the business logic, long running processes, and the puzzle pieces to a larger solution.</span></span>

<span data-ttu-id="2dcd7-152">Le `ActivityTriggerAttribute` est utilisé pour annoter `DurableActivityContext`un paramètre de fonction de type .</span><span class="sxs-lookup"><span data-stu-id="2dcd7-152">The `ActivityTriggerAttribute` is used to annotate a function parameter of type `DurableActivityContext`.</span></span> <span data-ttu-id="2dcd7-153">L’utilisation de l’annotation informe le temps d’exécution que la fonction est destinée à être utilisée comme fonction d’activité.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-153">Using the annotation informs the runtime that the function is intended to be used as an activity function.</span></span> <span data-ttu-id="2dcd7-154">Les valeurs d’entrée aux fonctions d’activité sont récupérées à l’aide de la `GetInput<T>` méthode du `DurableActivityContext` paramètre.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-154">Input values to activity functions are retrieved using the `GetInput<T>` method of the `DurableActivityContext` parameter.</span></span>

<span data-ttu-id="2dcd7-155">Semblable aux fonctions d’orchestration, les types de fonctions d’activité de retour doivent être soit nuls, tâche, ou une valeur sérialisable JSON.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-155">Similar to orchestration functions, the return types of activity functions must be either void, Task, or a JSON serializable value.</span></span>

<span data-ttu-id="2dcd7-156">Toutes les exceptions non gérées qui sont jetés dans les fonctions d’activité seront envoyés à la fonction d’orchestrateur d’appel et présentés comme un `TaskFailedException`.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-156">Any unhandled exceptions that get thrown within activity functions will get sent up to the calling orchestrator function and presented as a `TaskFailedException`.</span></span> <span data-ttu-id="2dcd7-157">À ce stade, l’erreur peut être attrapée et enregistrée dans l’orchestrateur, et l’activité peut être rejugée.</span><span class="sxs-lookup"><span data-stu-id="2dcd7-157">At this point, the error can be caught and logged in the orchestrator, and the activity can be retried.</span></span>

```csharp
[FunctionName("CheckAndReserveInventory")]
public static bool CheckAndReserveInventory([ActivityTrigger] DurableActivityContext context)
{
    OrderRequestData orderData = context.GetInput<OrderRequestData>();

    // Connect to inventory system and try to reserve items
    return true;
}
```

## <a name="recommended-resources"></a><span data-ttu-id="2dcd7-158">Ressources recommandées</span><span class="sxs-lookup"><span data-stu-id="2dcd7-158">Recommended resources</span></span>

- [<span data-ttu-id="2dcd7-159">Fonctions durables</span><span class="sxs-lookup"><span data-stu-id="2dcd7-159">Durable Functions</span></span>](https://docs.microsoft.com/azure/azure-functions/durable-functions-overview)
- [<span data-ttu-id="2dcd7-160">Liaisons pour les fonctions durables</span><span class="sxs-lookup"><span data-stu-id="2dcd7-160">Bindings for Durable Functions</span></span>](https://docs.microsoft.com/azure/azure-functions/durable-functions-bindings)
- [<span data-ttu-id="2dcd7-161">Gérer les instances dans les fonctions durables</span><span class="sxs-lookup"><span data-stu-id="2dcd7-161">Manage instances in Durable Functions</span></span>](https://docs.microsoft.com/azure/azure-functions/durable-functions-instance-management)

>[!div class="step-by-step"]
><span data-ttu-id="2dcd7-162">[Suivant précédent](event-grid.md)
>[Next](orchestration-patterns.md)</span><span class="sxs-lookup"><span data-stu-id="2dcd7-162">[Previous](event-grid.md)
[Next](orchestration-patterns.md)</span></span>

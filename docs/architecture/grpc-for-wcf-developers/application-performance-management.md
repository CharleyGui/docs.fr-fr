---
title: Gestion des performances des applications-gRPC pour les développeurs WCF
description: La journalisation, les métriques et le suivi pour les applications ASP.NET Core gRPC.
author: markrendle
ms.date: 09/02/2019
ms.openlocfilehash: 6e4c32d057c1ac143e18a4a3ddc83dd8b1f62800
ms.sourcegitcommit: 55f438d4d00a34b9aca9eedaac3f85590bb11565
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/23/2019
ms.locfileid: "71184609"
---
# <a name="application-performance-management"></a><span data-ttu-id="a0449-103">Gestion des performances des applications</span><span class="sxs-lookup"><span data-stu-id="a0449-103">Application Performance Management</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="a0449-104">Dans les environnements de production modernes comme Kubernetes, il est très important de pouvoir surveiller les applications pour s’assurer qu’elles s’exécutent de manière optimale.</span><span class="sxs-lookup"><span data-stu-id="a0449-104">In modern production environments like Kubernetes, it's very important to be able to monitor applications to ensure they're running optimally.</span></span> <span data-ttu-id="a0449-105">Les problèmes tels que la journalisation et les métriques n’ont jamais été plus importants.</span><span class="sxs-lookup"><span data-stu-id="a0449-105">Concerns like logging and metrics have never been more important.</span></span> <span data-ttu-id="a0449-106">ASP.NET Core, y compris gRPC, offre une prise en charge de première classe pour la production et la gestion des messages de journaux et des données de métriques, ainsi que *le suivi* des données.</span><span class="sxs-lookup"><span data-stu-id="a0449-106">ASP.NET Core, including gRPC, has first-class support for producing and managing log messages and metrics data, as well as *tracing* data.</span></span> <span data-ttu-id="a0449-107">Cette section aborde ces sujets plus en détail.</span><span class="sxs-lookup"><span data-stu-id="a0449-107">This section will explore these areas in more details.</span></span>

## <a name="logging-vs-metrics"></a><span data-ttu-id="a0449-108">Journalisation vs métriques</span><span class="sxs-lookup"><span data-stu-id="a0449-108">Logging vs Metrics</span></span>

<span data-ttu-id="a0449-109">Avant de consulter les détails de l’implémentation, il est nécessaire de comprendre la différence entre la journalisation et les métriques.</span><span class="sxs-lookup"><span data-stu-id="a0449-109">Before looking at the implementation details, it's necessary to understand the difference between logging and metrics.</span></span>

<span data-ttu-id="a0449-110">La journalisation s’attache à des messages texte qui enregistrent des informations détaillées sur les événements qui se sont produits dans le système.</span><span class="sxs-lookup"><span data-stu-id="a0449-110">Logging is concerned with text messages that record detailed information about things that have happened in the system.</span></span> <span data-ttu-id="a0449-111">Les messages de journal peuvent inclure des données d’exception telles que des traces de la pile ou des données structurées qui fournissent le contexte relatif au message.</span><span class="sxs-lookup"><span data-stu-id="a0449-111">Log messages may include exception data like stack traces, or structured data that provides context about the message.</span></span> <span data-ttu-id="a0449-112">La sortie de journalisation est généralement écrite dans un magasin de texte pouvant faire l’objet d’une recherche.</span><span class="sxs-lookup"><span data-stu-id="a0449-112">Logging output is commonly written to a searchable text store.</span></span>

<span data-ttu-id="a0449-113">Les métriques font référence à des données numériques conçues pour être agrégées et présentées à l’aide de graphiques et de graphiques dans un tableau de bord qui fournit une vue de l’intégrité et des performances globales d’une application.</span><span class="sxs-lookup"><span data-stu-id="a0449-113">Metrics refers to numeric data that is designed to be aggregated and presented using charts and graphs in a dashboard that provides a view of the overall health and performance of an application.</span></span> <span data-ttu-id="a0449-114">Les données de métriques peuvent également être utilisées pour déclencher des alertes automatisées lorsqu’un seuil est dépassé.</span><span class="sxs-lookup"><span data-stu-id="a0449-114">Metrics data can also be used to trigger automated alerts when a threshold is exceeded.</span></span> <span data-ttu-id="a0449-115">La liste suivante présente quelques exemples de données de métriques :</span><span class="sxs-lookup"><span data-stu-id="a0449-115">The following list shows some examples of metrics data:</span></span>

- <span data-ttu-id="a0449-116">Temps nécessaire pour traiter les demandes.</span><span class="sxs-lookup"><span data-stu-id="a0449-116">Time taken to process requests.</span></span>
- <span data-ttu-id="a0449-117">Nombre de demandes par seconde traitées par une instance d’un service.</span><span class="sxs-lookup"><span data-stu-id="a0449-117">The number of requests per second being handled by an instance of a service.</span></span>
- <span data-ttu-id="a0449-118">Nombre de demandes ayant échoué sur une instance.</span><span class="sxs-lookup"><span data-stu-id="a0449-118">The number of failed requests on an instance.</span></span>

## <a name="logging-in-aspnet-core-grpc"></a><span data-ttu-id="a0449-119">Connexion ASP.NET Core gRPC</span><span class="sxs-lookup"><span data-stu-id="a0449-119">Logging in ASP.NET Core gRPC</span></span>

<span data-ttu-id="a0449-120">ASP.NET Core fournit une prise en charge intégrée de la journalisation, sous la forme du package NuGet [Microsoft. extensions. Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) .</span><span class="sxs-lookup"><span data-stu-id="a0449-120">ASP.NET Core provides built-in support for logging, in the form of the [Microsoft.Extensions.Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) NuGet package.</span></span> <span data-ttu-id="a0449-121">Les principales parties de cette bibliothèque sont incluses dans le kit de développement logiciel (SDK) Web. il n’est donc pas nécessaire de l’installer manuellement.</span><span class="sxs-lookup"><span data-stu-id="a0449-121">The core parts of this library are included with the Web SDK, so there's no need to install it manually.</span></span> <span data-ttu-id="a0449-122">Par défaut, les messages de journal sont écrits dans la sortie standard (« console ») et dans tout débogueur attaché.</span><span class="sxs-lookup"><span data-stu-id="a0449-122">By default, log messages are written to the standard output (the "console") and to any attached debugger.</span></span> <span data-ttu-id="a0449-123">Pour écrire des journaux dans des magasins de données externes persistants, vous devrez peut-être importer des [packages de récepteur de journalisation facultatifs](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span><span class="sxs-lookup"><span data-stu-id="a0449-123">To write logs to persistent external data stores, you may need to import [optional logging sink packages](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span></span>

<span data-ttu-id="a0449-124">Le ASP.NET Core Framework gRPC écrit des messages de journalisation de diagnostic détaillés dans cette structure de journalisation pour qu’ils puissent être traités/stockés avec les messages de votre application.</span><span class="sxs-lookup"><span data-stu-id="a0449-124">The ASP.NET Core gRPC framework writes detailed diagnostic logging messages to this logging framework so they can be processed/stored along with your application's own messages.</span></span>

### <a name="produce-log-messages"></a><span data-ttu-id="a0449-125">Produire des messages de journal</span><span class="sxs-lookup"><span data-stu-id="a0449-125">Produce log messages</span></span>

<span data-ttu-id="a0449-126">L’extension de journalisation est automatiquement inscrite auprès du système d’injection de dépendances de ASP.NET Core, ce qui vous permet de spécifier des journaux en tant que paramètre de constructeur sur les types de service gRPC.</span><span class="sxs-lookup"><span data-stu-id="a0449-126">The logging extension is automatically registered with ASP.NET Core's dependency injection system, so you can specify loggers as a constructor parameter on gRPC service types.</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private readonly ILogger<StockData> _logger;

    public StockData(ILogger<StockData> logger)
    {
        _logger = logger;
    }
}
```

<span data-ttu-id="a0449-127">De nombreux messages de journal concernant les demandes, les exceptions, etc., sont fournis par les composants de l’infrastructure ASP.NET Core et gRPC.</span><span class="sxs-lookup"><span data-stu-id="a0449-127">Many log messages around requests, exceptions, and so on, are provided by the ASP.NET Core and gRPC framework components.</span></span> <span data-ttu-id="a0449-128">Ajoutez vos propres messages de journalisation pour fournir des détails et du contexte sur la logique d’application plutôt que sur des problèmes de niveau inférieur.</span><span class="sxs-lookup"><span data-stu-id="a0449-128">Add your own log messages to provide detail and context about application logic rather than lower-level concerns.</span></span>

<span data-ttu-id="a0449-129">Pour plus d’informations sur l’écriture de messages de journal et sur les récepteurs de journalisation et les cibles disponibles, consultez l’article [journalisation dans .net Core et ASP.net Core](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0) .</span><span class="sxs-lookup"><span data-stu-id="a0449-129">For more information about writing log messages and available logging sinks and targets, see the [Logging in .NET Core and ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0) article.</span></span>

## <a name="metrics-in-aspnet-core-grpc"></a><span data-ttu-id="a0449-130">Mesures dans ASP.NET Core gRPC</span><span class="sxs-lookup"><span data-stu-id="a0449-130">Metrics in ASP.NET Core gRPC</span></span>

<span data-ttu-id="a0449-131">Le Runtime .net Core fournit un ensemble de composants pour émettre et observer des métriques qui incluent des API telles que <xref:System.Diagnostics.Tracing.EventSource> les <xref:System.Diagnostics.Tracing.EventCounter> classes et.</span><span class="sxs-lookup"><span data-stu-id="a0449-131">The .NET Core runtime provides a set of components for emitting and observing metrics that includes APIs such as the <xref:System.Diagnostics.Tracing.EventSource> and <xref:System.Diagnostics.Tracing.EventCounter> classes.</span></span> <span data-ttu-id="a0449-132">Ces API peuvent être utilisées pour émettre des données numériques de base qui peuvent être consommées par des processus externes tels que l' [outil Global dotnet-Counters](https://github.com/dotnet/diagnostics/blob/master/documentation/dotnet-counters-instructions.md), ou suivi d’v nements pour Windows.</span><span class="sxs-lookup"><span data-stu-id="a0449-132">These APIs can be used to emit basic numeric data that can be consumed by external processes like the [dotnet-counters global tool](https://github.com/dotnet/diagnostics/blob/master/documentation/dotnet-counters-instructions.md), or Event Tracing for Windows.</span></span> <span data-ttu-id="a0449-133">Pour plus d’informations sur `EventCounter` l’utilisation de dans votre propre code, consultez le didacticiel de [Présentation de EventCounter](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md) .</span><span class="sxs-lookup"><span data-stu-id="a0449-133">For more information about using `EventCounter` in your own code, see the [EventCounter Introduction](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md) tutorial.</span></span>

<span data-ttu-id="a0449-134">Pour les métriques plus avancées et l’écriture de données de métriques dans un plus grand nombre de magasins de données, il existe un excellent projet open source appelé [métriques](https://www.app-metrics.io)de l’application.</span><span class="sxs-lookup"><span data-stu-id="a0449-134">For more advanced metrics and for writing metric data to a wider range of data stores, there's an excellent open-source project called [App Metrics](https://www.app-metrics.io).</span></span> <span data-ttu-id="a0449-135">Cette suite de bibliothèques fournit un ensemble complet de types pour instrumenter votre code.</span><span class="sxs-lookup"><span data-stu-id="a0449-135">This suite of libraries provides an extensive set of types to instrument your code.</span></span> <span data-ttu-id="a0449-136">Il offre également des packages pour écrire des mesures dans différents types de cibles qui incluent des bases de données de série chronologique, telles que Prometheus et InfluxDB, [Azure application Insights](https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview), et bien plus encore.</span><span class="sxs-lookup"><span data-stu-id="a0449-136">It also offers packages to write metrics to different kinds of targets that include time-series databases, such as Prometheus and InfluxDB, [Azure Application Insights](https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview), and more.</span></span> <span data-ttu-id="a0449-137">Le package NuGet [app. Metrics. AspNetCore. Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) ajoute même un ensemble complet de métriques de base qui sont générées automatiquement par le biais de l’intégration avec l’infrastructure ASP.net Core, et le site Web fournit des [modèles](https://www.app-metrics.io/samples/grafana/) pour l’affichage de ces métriques. avec la plateforme de visualisation [Grafana](https://grafana.com/) .</span><span class="sxs-lookup"><span data-stu-id="a0449-137">The [App.Metrics.AspNetCore.Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) NuGet package even adds a comprehensive set of basic metrics that are automatically generated via integration with the ASP.NET Core framework, and the web site provides [templates](https://www.app-metrics.io/samples/grafana/) for displaying those metrics with the [Grafana](https://grafana.com/) visualization platform.</span></span>

<span data-ttu-id="a0449-138">Pour plus d’informations et pour obtenir de la documentation sur les métriques d’application, consultez le site Web [app-Metrics.IO](https://app-metrics.io) .</span><span class="sxs-lookup"><span data-stu-id="a0449-138">For more information and documentation about App Metrics, see the [app-metrics.io](https://app-metrics.io) website.</span></span>

### <a name="produce-metrics"></a><span data-ttu-id="a0449-139">Produire des métriques</span><span class="sxs-lookup"><span data-stu-id="a0449-139">Produce metrics</span></span>

<span data-ttu-id="a0449-140">La plupart des plateformes de métriques prennent en charge cinq types de métriques de base, décrits dans le tableau suivant :</span><span class="sxs-lookup"><span data-stu-id="a0449-140">Most metrics platforms support five basic types of metric, outlined in the following table:</span></span>

| <span data-ttu-id="a0449-141">Type de métrique</span><span class="sxs-lookup"><span data-stu-id="a0449-141">Metric type</span></span> | <span data-ttu-id="a0449-142">Description</span><span class="sxs-lookup"><span data-stu-id="a0449-142">Description</span></span> |
| ----------- | ----------- |
| <span data-ttu-id="a0449-143">Counter</span><span class="sxs-lookup"><span data-stu-id="a0449-143">Counter</span></span>     | <span data-ttu-id="a0449-144">Effectue le suivi de la fréquence des événements, tels que les demandes, les erreurs, etc.</span><span class="sxs-lookup"><span data-stu-id="a0449-144">Tracks how often something happens, such as requests, errors, and so on.</span></span> |
| <span data-ttu-id="a0449-145">Gabarit</span><span class="sxs-lookup"><span data-stu-id="a0449-145">Gauge</span></span>       | <span data-ttu-id="a0449-146">Enregistre une valeur unique qui change au fil du temps, par exemple des connexions actives.</span><span class="sxs-lookup"><span data-stu-id="a0449-146">Records a single value that changes over time, such as active connections.</span></span> |
| <span data-ttu-id="a0449-147">Histogramme</span><span class="sxs-lookup"><span data-stu-id="a0449-147">Histogram</span></span>   | <span data-ttu-id="a0449-148">Mesure une distribution de valeurs à travers des limites arbitraires.</span><span class="sxs-lookup"><span data-stu-id="a0449-148">Measures a distribution of values across arbitrary limits.</span></span> <span data-ttu-id="a0449-149">Par exemple, un histogramme peut suivre la taille du jeu de données, en comptant le nombre d’enregistrements contenus < 10, le nombre de 11-100 et 101-1000, ainsi que les enregistrements > 1 000.</span><span class="sxs-lookup"><span data-stu-id="a0449-149">For example, a histogram could track data set size, counting how many contained <10 records, how many 11-100 and 101-1000, and >1000 records.</span></span> |
| <span data-ttu-id="a0449-150">Tswtclmt</span><span class="sxs-lookup"><span data-stu-id="a0449-150">Meter</span></span>       | <span data-ttu-id="a0449-151">Mesure le taux auquel un événement se produit dans différents intervalles de temps.</span><span class="sxs-lookup"><span data-stu-id="a0449-151">Measures the rate at which an event occurs in various time spans.</span></span> |
| <span data-ttu-id="a0449-152">Minuterie</span><span class="sxs-lookup"><span data-stu-id="a0449-152">Timer</span></span>       | <span data-ttu-id="a0449-153">Effectue le suivi de la durée des événements et de la vitesse à laquelle ils se produisent, stockés sous la forme d’un histogramme.</span><span class="sxs-lookup"><span data-stu-id="a0449-153">Tracks the duration of events and the rate at which it occurs, stored as a histogram.</span></span> |

<span data-ttu-id="a0449-154">À l’aide des *métriques*de l’application, une `IMetrics` interface peut être obtenue via l’injection de dépendances et utilisée pour enregistrer l’une de ces métriques pour un service gRPC.</span><span class="sxs-lookup"><span data-stu-id="a0449-154">Using *App Metrics*, an `IMetrics` interface can be obtained via dependency injection and used to record any of these metrics for a gRPC service.</span></span> <span data-ttu-id="a0449-155">L’exemple suivant montre comment compter le nombre de `Get` demandes effectuées dans le temps :</span><span class="sxs-lookup"><span data-stu-id="a0449-155">The following example shows how to count the number of `Get` requests made over time:</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private static readonly CounterOptions GetRequestCounter = new CounterOptions
    {
        Name = "StockData_Get_Requests",
        MeasurementUnit = Unit.Calls
    };

    private readonly IStockRepository _repository;
    private readonly IMetrics _metrics;

    public StockData(IStockRepository repository, IMetrics metrics)
    {
        _repository = repository;
        _metrics = metrics;
    }

    public override async Task<GetResponse> Get(GetRequest request, ServerCallContext context)
    {
        _metrics.Measure.Counter.Increment(GetRequestCounter);

        // Serve request...
    }
}
```

### <a name="store-and-visualize-metrics-data"></a><span data-ttu-id="a0449-156">Stocker et visualiser les données de métriques</span><span class="sxs-lookup"><span data-stu-id="a0449-156">Store and visualize metrics data</span></span>

<span data-ttu-id="a0449-157">La meilleure façon de stocker les données de métriques se trouve dans une *base de données de série chronologique*, une banque de données spécialisée conçue pour enregistrer des séries de données numériques marquées avec des horodateurs.</span><span class="sxs-lookup"><span data-stu-id="a0449-157">The best way to store metrics data is in a *time-series database*, a specialized data store designed to record numerical data series marked with timestamps.</span></span> <span data-ttu-id="a0449-158">Les bases de données les plus populaires sont [Prometheus](https://prometheus.io/) et [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span><span class="sxs-lookup"><span data-stu-id="a0449-158">The most popular of these databases are [Prometheus](https://prometheus.io/) and [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span></span> <span data-ttu-id="a0449-159">Microsoft Azure fournit également un stockage de métriques dédié par le biais du service [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview) .</span><span class="sxs-lookup"><span data-stu-id="a0449-159">Microsoft Azure also provides dedicated metrics storage through the [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview) service.</span></span>

<span data-ttu-id="a0449-160">La solution actuelle de visualisation des données de métriques est [Grafana](https://grafana.com), qui fonctionne avec un large éventail de fournisseurs de stockage, y compris Azure Monitor, InfluxDB et Prometheus.</span><span class="sxs-lookup"><span data-stu-id="a0449-160">The current go-to solution for visualizing metrics data is [Grafana](https://grafana.com), which works with a wide range of storage providers including Azure Monitor, InfluxDB and Prometheus.</span></span> <span data-ttu-id="a0449-161">L’image suivante montre un exemple de tableau de bord Grafana qui affiche les métriques de la maille du service Linkerd exécutant l’exemple StockData :</span><span class="sxs-lookup"><span data-stu-id="a0449-161">The following image shows an example Grafana dashboard that displays metrics from the Linkerd service mesh running the StockData sample:</span></span>

![Tableau de bord Grafana](media/application-performance-management/grafana-screenshot.png)

### <a name="metrics-based-alerting"></a><span data-ttu-id="a0449-163">Alertes basées sur les métriques</span><span class="sxs-lookup"><span data-stu-id="a0449-163">Metrics-based alerting</span></span>

<span data-ttu-id="a0449-164">La nature numérique des données de métriques signifie qu’elle est idéalement adaptée aux systèmes d’alerte, en avertissant les développeurs ou les ingénieurs du support technique lorsqu’une valeur se situe en dehors d’une tolérance définie.</span><span class="sxs-lookup"><span data-stu-id="a0449-164">The numerical nature of metrics data means that it's ideally suited to drive alerting systems, notifying developers or support engineers when a value falls outside of some defined tolerance.</span></span> <span data-ttu-id="a0449-165">Les plateformes déjà mentionnées prennent en charge l’alerte par le biais d’une gamme d’options, notamment les e-mails, les SMS ou les visualisations dans le tableau de bord.</span><span class="sxs-lookup"><span data-stu-id="a0449-165">The platforms already mentioned all provide support for alerting via a range of options, including emails, text messages, or in-dashboard visualizations.</span></span>

## <a name="distributed-tracing"></a><span data-ttu-id="a0449-166">Traçage distribué</span><span class="sxs-lookup"><span data-stu-id="a0449-166">Distributed tracing</span></span>

<span data-ttu-id="a0449-167">Le *traçage distribué* est un développement relativement récent dans le monitoring, qui vient de l’utilisation accrue des microservices et des architectures distribuées.</span><span class="sxs-lookup"><span data-stu-id="a0449-167">*Distributed tracing* is a relatively recent development in monitoring, which has arisen from the increasing use of microservices and distributed architectures.</span></span> <span data-ttu-id="a0449-168">Une seule demande provenant d’un navigateur client, d’une application ou d’un appareil peut être divisée en plusieurs étapes et sous-requêtes, et impliquer l’utilisation de nombreux services sur un réseau.</span><span class="sxs-lookup"><span data-stu-id="a0449-168">A single request from a client browser, application, or device may be broken down into many steps and sub-requests, and involve the use of many services across a network.</span></span> <span data-ttu-id="a0449-169">Cela complique la mise en corrélation des messages du journal et des métriques avec la demande spécifique qui les a déclenchés.</span><span class="sxs-lookup"><span data-stu-id="a0449-169">This makes it difficult to correlate log messages and metrics with the specific request that triggered them.</span></span> <span data-ttu-id="a0449-170">Le traçage distribué applique des identificateurs aux demandes qui autorisent la mise en corrélation des journaux et des métriques avec une opération particulière.</span><span class="sxs-lookup"><span data-stu-id="a0449-170">Distributed tracing applies identifiers to requests that allow logs and metrics to be correlated with a particular operation.</span></span> <span data-ttu-id="a0449-171">Cela est similaire au [suivi de bout en bout de WCF](https://docs.microsoft.com/dotnet/framework/wcf/diagnostics/tracing/end-to-end-tracing), mais appliqué sur plusieurs plateformes.</span><span class="sxs-lookup"><span data-stu-id="a0449-171">This is similar to [WCF's end-to-end tracing](https://docs.microsoft.com/dotnet/framework/wcf/diagnostics/tracing/end-to-end-tracing), but applied across multiple platforms.</span></span>

<span data-ttu-id="a0449-172">Bien qu’il s’agisse toujours d’un domaine technologique balbutiante, le suivi distribué a augmenté rapidement en popularité et passe maintenant par un processus de normalisation.</span><span class="sxs-lookup"><span data-stu-id="a0449-172">Although it's still a nascent technology area, distributed tracing has grown quickly in popularity and is now going through a standardization process.</span></span> <span data-ttu-id="a0449-173">La Fondation Cloud Native Computing a créé la [norme Open Tracing](https://opentracing.io), qui tente de fournir des bibliothèques indépendantes du fournisseur pour travailler avec des serveurs principaux tels que [Jaeger](https://www.jaegertracing.io/) et l' [APM élastique](https://www.elastic.co/products/apm).</span><span class="sxs-lookup"><span data-stu-id="a0449-173">The Cloud Native Computing Foundation created the [the Open Tracing standard](https://opentracing.io), attempting to provide vendor-neutral libraries for working with backends like [Jaeger](https://www.jaegertracing.io/) and [Elastic APM](https://www.elastic.co/products/apm).</span></span> <span data-ttu-id="a0449-174">En même temps, Google a créé le [projet OpenCensus](https://opencensus.io/) pour résoudre le même ensemble de problèmes.</span><span class="sxs-lookup"><span data-stu-id="a0449-174">At the same time, Google created the [OpenCensus project](https://opencensus.io/) to address the same set of problems.</span></span> <span data-ttu-id="a0449-175">Ces deux projets sont maintenant fusionnés dans un nouveau projet, [OpenTelemetry](https://opentelemetry.io), qui a pour but d’être la norme du secteur.</span><span class="sxs-lookup"><span data-stu-id="a0449-175">These two projects are now being merged into a new project, [OpenTelemetry](https://opentelemetry.io), which aims to be the future industry standard.</span></span>

### <a name="how-distributed-tracing-works"></a><span data-ttu-id="a0449-176">Fonctionnement du traçage distribué</span><span class="sxs-lookup"><span data-stu-id="a0449-176">How distributed tracing works</span></span>

<span data-ttu-id="a0449-177">Le traçage distribué est basé sur le concept d' *étendues*: les opérations chronométrées qui font partie d’une seule *trace*, ce qui peut impliquer le traitement sur plusieurs nœuds d’un système.</span><span class="sxs-lookup"><span data-stu-id="a0449-177">Distributed tracing is based on the concept of *Spans*: named, timed operations that are part of a single *Trace*, which may involve processing on multiple nodes of a system.</span></span> <span data-ttu-id="a0449-178">Lorsqu’une nouvelle opération est lancée, une trace est créée avec un identificateur unique.</span><span class="sxs-lookup"><span data-stu-id="a0449-178">When a new operation is initiated, a trace is created with a unique identifier.</span></span> <span data-ttu-id="a0449-179">Pour chaque sous-opération, une étendue est créée avec son propre identificateur et identificateur de suivi.</span><span class="sxs-lookup"><span data-stu-id="a0449-179">For each sub-operation, a span is created with its own identifier and trace identifier.</span></span> <span data-ttu-id="a0449-180">À mesure que la demande passe par le système, plusieurs composants peuvent créer des étendues *enfants* incluant l’identificateur de leur *parent*.</span><span class="sxs-lookup"><span data-stu-id="a0449-180">As the request passes around the system, various components can create *child* spans that include the identifier of their *parent*.</span></span> <span data-ttu-id="a0449-181">Une étendue a un *contexte*, qui contient les identificateurs de trace et d’étendue, ainsi que des données utiles sous la forme de paires clé/valeur (appelées *bagages*).</span><span class="sxs-lookup"><span data-stu-id="a0449-181">A span has a *context*, which contains the trace and span identifiers, as well as useful data in the form of key/value pairs (called *baggage*).</span></span>

### <a name="distributed-tracing-with-diagnosticsource"></a><span data-ttu-id="a0449-182">Traçage distribué avec DiagnosticSource</span><span class="sxs-lookup"><span data-stu-id="a0449-182">Distributed tracing with DiagnosticSource</span></span>

<span data-ttu-id="a0449-183">.NET Core possède un module interne qui s’adapte bien aux traces et aux étendues distribuées : [DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span><span class="sxs-lookup"><span data-stu-id="a0449-183">.NET Core has an internal module that maps well to distributed traces and spans: [DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span></span> <span data-ttu-id="a0449-184">En plus de fournir un moyen simple de produire et de consommer les Diagnostics au sein d' `DiagnosticSource` un processus, le module a le concept d’une *activité*, qui est en fait une implémentation d’une trace distribuée ou d’une étendue dans une trace.</span><span class="sxs-lookup"><span data-stu-id="a0449-184">As well as providing a simple way to produce and consume diagnostics within a process, the `DiagnosticSource` module has the concept of an *Activity*, which is effectively an implementation of a distributed trace, or a span within a trace.</span></span> <span data-ttu-id="a0449-185">Les éléments internes du module prennent en charge les activités parent/enfant, y compris l’allocation des identificateurs.</span><span class="sxs-lookup"><span data-stu-id="a0449-185">The internals of the module take care of parent/child activities, including allocating identifiers.</span></span> <span data-ttu-id="a0449-186">Pour plus d’informations sur l' `Activity` utilisation du type, consultez le [Guide de l’utilisateur de l’activité sur GitHub](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide)</span><span class="sxs-lookup"><span data-stu-id="a0449-186">For more information about using the `Activity` type, see the [Activity User Guide on GitHub](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide)</span></span>

<span data-ttu-id="a0449-187">Étant donné que DiagnosticSource fait partie de l’infrastructure de base, il est pris en charge par plusieurs <xref:System.Net.Http.HttpClient>composants principaux, y compris, Entity Framework Core et ASP.net Core, notamment la prise en charge explicite dans l’infrastructure gRPC.</span><span class="sxs-lookup"><span data-stu-id="a0449-187">Because DiagnosticSource is a part of the core framework, it's supported by several core components, including <xref:System.Net.Http.HttpClient>, Entity Framework Core and ASP.NET Core, including explicit support in the gRPC framework.</span></span> <span data-ttu-id="a0449-188">Lorsque ASP.NET Core reçoit une demande, il recherche une paire d’en-têtes HTTP correspondant à la norme du [contexte de trace W3C](https://www.w3.org/TR/trace-context) .</span><span class="sxs-lookup"><span data-stu-id="a0449-188">When ASP.NET Core receives a request, it  checks for a pair of HTTP headers matching the [W3C Trace Context](https://www.w3.org/TR/trace-context) standard.</span></span> <span data-ttu-id="a0449-189">Si les en-têtes sont trouvés, une activité est démarrée à l’aide des valeurs d’identité et du contexte des en-têtes.</span><span class="sxs-lookup"><span data-stu-id="a0449-189">If the headers are found, an Activity is started using the identity values and context from the headers.</span></span> <span data-ttu-id="a0449-190">Si aucun en-tête n’est trouvé, une activité est démarrée avec des valeurs d’identité générées qui correspondent au format standard.</span><span class="sxs-lookup"><span data-stu-id="a0449-190">If no headers are found, an Activity is started with generated identity values that match the standard format.</span></span> <span data-ttu-id="a0449-191">Les diagnostics générés par l’infrastructure ou par le code d’application pendant la durée de vie de cette activité peuvent être marqués avec les identificateurs de trace et d’étendue.</span><span class="sxs-lookup"><span data-stu-id="a0449-191">Any diagnostics generated by the framework or by application code during the lifetime of this Activity can be tagged with the trace and span identifiers.</span></span> <span data-ttu-id="a0449-192">La `HttpClient` prise en charge s’étend davantage en vérifiant une activité en cours à chaque demande et en ajoutant automatiquement les en-têtes de trace à la demande sortante.</span><span class="sxs-lookup"><span data-stu-id="a0449-192">The `HttpClient` support extends this further by checking for a current Activity on every request and automatically adding the trace headers to the outgoing request.</span></span>

<span data-ttu-id="a0449-193">Les bibliothèques clientes et serveur de ASP.NET Core gRPC incluent une prise en charge explicite des DiagnosticSource et de l’activité, et vont créer des activités et appliquer et utiliser automatiquement les informations d’en-tête.</span><span class="sxs-lookup"><span data-stu-id="a0449-193">The ASP.NET Core gRPC client and server libraries include explicit support for DiagnosticSource and Activity, and will create activities and apply and use header information automatically.</span></span>

> [!NOTE]
> <span data-ttu-id="a0449-194">Tout cela se produit uniquement si un *écouteur* utilise les informations de diagnostic.</span><span class="sxs-lookup"><span data-stu-id="a0449-194">All of this only happens if a *listener* is consuming the diagnostic information.</span></span> <span data-ttu-id="a0449-195">S’il n’y a pas d’écouteur, aucun diagnostic n’est écrit et aucune activité n’est créée.</span><span class="sxs-lookup"><span data-stu-id="a0449-195">If there's no listener, no diagnostics are written and no activities are created.</span></span>

### <a name="add-your-own-diagnosticsources-and-activities"></a><span data-ttu-id="a0449-196">Ajouter vos propres DiagnosticSources et activités</span><span class="sxs-lookup"><span data-stu-id="a0449-196">Add your own DiagnosticSources and Activities</span></span>

<span data-ttu-id="a0449-197">Bien qu’une bonne quantité de données soit générée automatiquement par ASP.net Core, y compris gRPC, ainsi que Entity Framework Core `HttpClient`et, vous souhaiterez peut-être ajouter vos propres Diagnostics ou créer des étendues explicites dans le code de votre application.</span><span class="sxs-lookup"><span data-stu-id="a0449-197">Although a good quantity of data is automatically generated by ASP.NET Core, including gRPC, as well as Entity Framework Core and `HttpClient`, you may wish to add your own diagnostics or create explicit spans within your application code.</span></span> <span data-ttu-id="a0449-198">Pour plus d’informations sur l’implémentation de vos propres Diagnostics, reportez-vous au Guide de l' [utilisateur DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) et au Guide de l’utilisateur de l' [activité](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage) .</span><span class="sxs-lookup"><span data-stu-id="a0449-198">Refer to the [DiagnosticSource User Guide](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) and [Activity User Guide](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage) for details on how to implement your own diagnostics.</span></span>

### <a name="store-distributed-trace-data"></a><span data-ttu-id="a0449-199">Stocker les données de trace distribuées</span><span class="sxs-lookup"><span data-stu-id="a0449-199">Store distributed trace data</span></span>

<span data-ttu-id="a0449-200">Au moment de l’écriture, le projet OpenTelemetry est toujours en phase précoce et seuls les packages de qualité alpha sont disponibles pour les applications .NET.</span><span class="sxs-lookup"><span data-stu-id="a0449-200">At the time of writing the OpenTelemetry project is still in the early stages, and only alpha-quality packages are available for .NET applications.</span></span> <span data-ttu-id="a0449-201">Le projet OpenTracing offre des bibliothèques plus matures, mais celles-ci seront remplacées par les bibliothèques OpenTelemetry à l’avenir.</span><span class="sxs-lookup"><span data-stu-id="a0449-201">The OpenTracing project offers more mature libraries, but these will be superseded by the OpenTelemetry libraries in the future.</span></span>

<span data-ttu-id="a0449-202">L’API OpenTracing est décrite ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="a0449-202">The OpenTracing API is described below.</span></span> <span data-ttu-id="a0449-203">Si vous préférez utiliser l’API OpenTelemetry plus récente dans votre application, reportez-vous au [référentiel du kit de développement logiciel (SDK) OpenTelemetry .net sur GitHub](https://github.com/open-telemetry/opentelemetry-dotnet).</span><span class="sxs-lookup"><span data-stu-id="a0449-203">If you would prefer to use the newer OpenTelemetry API in your application, refer to the [OpenTelemetry .NET SDK repository on GitHub](https://github.com/open-telemetry/opentelemetry-dotnet).</span></span>

#### <a name="use-the-opentracing-package-to-store-distributed-trace-data"></a><span data-ttu-id="a0449-204">Utiliser le package OpenTracing pour stocker les données de trace distribuées</span><span class="sxs-lookup"><span data-stu-id="a0449-204">Use the OpenTracing package to store distributed trace data</span></span>

<span data-ttu-id="a0449-205">[Un package NuGet OpenTracing](https://www.nuget.org/packages/OpenTracing/) qui prend en charge tous les serveurs principaux conformes à OpenTracing (qui peuvent être utilisés indépendamment de `DiagnosticSource`).</span><span class="sxs-lookup"><span data-stu-id="a0449-205">The [an OpenTracing NuGet package](https://www.nuget.org/packages/OpenTracing/) that supports all OpenTracing-compliant back-ends (which can be used independently of `DiagnosticSource`).</span></span> <span data-ttu-id="a0449-206">Il existe un package supplémentaire du projet contributions de l’API OpenTracing, [OpenTracing. contrib. Netcore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/), qui ajoute `DiagnosticSource` un écouteur et écrit automatiquement des événements et des activités sur un serveur principal.</span><span class="sxs-lookup"><span data-stu-id="a0449-206">There's an additional package from the OpenTracing API Contributions project, [OpenTracing.Contrib.NetCore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/), which adds a `DiagnosticSource` listener and writes events and activities to a back-end automatically.</span></span> <span data-ttu-id="a0449-207">L’activation de ce package est aussi simple que son installation à partir de NuGet et son ajout en `Startup` tant que service dans votre classe.</span><span class="sxs-lookup"><span data-stu-id="a0449-207">Enabling this package is as simple as installing it from NuGet and adding it as a service in your `Startup` class.</span></span>

```csharp
public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddOpenTracing();
    }
}
```

<span data-ttu-id="a0449-208">Le package OpenTracing est une couche d’abstraction et, en tant que tel, il requiert une implémentation propre à un serveur principal.</span><span class="sxs-lookup"><span data-stu-id="a0449-208">The OpenTracing package is an abstraction layer and as such it requires a back-end-specific implementation.</span></span> <span data-ttu-id="a0449-209">Les implémentations de l’API OpenTracing sont disponibles pour les serveurs principaux Open source suivants.</span><span class="sxs-lookup"><span data-stu-id="a0449-209">OpenTracing API implementations are available for the following open source back-ends.</span></span>

| <span data-ttu-id="a0449-210">Name</span><span class="sxs-lookup"><span data-stu-id="a0449-210">Name</span></span> | <span data-ttu-id="a0449-211">Package</span><span class="sxs-lookup"><span data-stu-id="a0449-211">Package</span></span> | <span data-ttu-id="a0449-212">Site Web</span><span class="sxs-lookup"><span data-stu-id="a0449-212">Web site</span></span> |
| ---- | ------- | -------- |
| <span data-ttu-id="a0449-213">Jaeger</span><span class="sxs-lookup"><span data-stu-id="a0449-213">Jaeger</span></span> | [<span data-ttu-id="a0449-214">Jaeger</span><span class="sxs-lookup"><span data-stu-id="a0449-214">Jaeger</span></span>](https://www.nuget.org/packages/Jaeger/) | [<span data-ttu-id="a0449-215">jaegertracing.io</span><span class="sxs-lookup"><span data-stu-id="a0449-215">jaegertracing.io</span></span>](https://jaegertracing.io) |
| <span data-ttu-id="a0449-216">APM élastique</span><span class="sxs-lookup"><span data-stu-id="a0449-216">Elastic APM</span></span> | [<span data-ttu-id="a0449-217">Élastique. APM. NetCoreAll</span><span class="sxs-lookup"><span data-stu-id="a0449-217">Elastic.Apm.NetCoreAll</span></span>](https://www.nuget.org/packages/Elastic.Apm.NetCoreAll/) | [<span data-ttu-id="a0449-218">elastic.co/products/apm</span><span class="sxs-lookup"><span data-stu-id="a0449-218">elastic.co/products/apm</span></span>](https://www.elastic.co/products/apm) |

<span data-ttu-id="a0449-219">Pour plus d’informations sur l’API OpenTracing pour .net, consultez les référentiels [OpenTracing pour C# ](https://github.com/opentracing/opentracing-csharp) et [OpenTracing C#contrib/.net Core](https://github.com/opentracing-contrib/csharp-netcore) sur GitHub.</span><span class="sxs-lookup"><span data-stu-id="a0449-219">For more information on the OpenTracing API for .NET, see the [OpenTracing for C#](https://github.com/opentracing/opentracing-csharp) and the [OpenTracing Contrib C#/.NET Core](https://github.com/opentracing-contrib/csharp-netcore) repositories on GitHub.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="a0449-220">[Précédent](load-balancing.md)
>[Suivant](appendix.md)</span><span class="sxs-lookup"><span data-stu-id="a0449-220">[Previous](load-balancing.md)
[Next](appendix.md)</span></span>

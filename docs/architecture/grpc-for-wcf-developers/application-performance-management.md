---
title: Gestion des performances des applications-gRPC pour les développeurs WCF
description: La journalisation, les métriques et le suivi des applications ASP.NET Core gRPC.
ms.date: 09/02/2019
ms.openlocfilehash: 8a13d1c4df95768e55c90ac491150bfc78ec2bab
ms.sourcegitcommit: 6d1ae17e60384f3b5953ca7b45ac859ec6d4c3a0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/20/2020
ms.locfileid: "94982340"
---
# <a name="application-performance-management"></a><span data-ttu-id="d8029-103">Gestion des performances des applications</span><span class="sxs-lookup"><span data-stu-id="d8029-103">Application Performance Management</span></span>

<span data-ttu-id="d8029-104">Dans les environnements de production tels que Kubernetes, il est important de surveiller les applications pour s’assurer qu’elles s’exécutent de manière optimale.</span><span class="sxs-lookup"><span data-stu-id="d8029-104">In production environments like Kubernetes, it's important to monitor applications to ensure they're running optimally.</span></span> <span data-ttu-id="d8029-105">La journalisation et les métriques sont particulièrement importantes.</span><span class="sxs-lookup"><span data-stu-id="d8029-105">Logging and metrics are particularly important.</span></span> <span data-ttu-id="d8029-106">ASP.NET Core, y compris gRPC, offre une prise en charge intégrée de la production et de la gestion des messages de journaux et des données de métriques, ainsi que du *suivi* des données.</span><span class="sxs-lookup"><span data-stu-id="d8029-106">ASP.NET Core, including gRPC, provides built-in support for producing and managing log messages and metrics data, as well as *tracing* data.</span></span>

## <a name="the-difference-between-logging-and-metrics"></a><span data-ttu-id="d8029-107">Différence entre la journalisation et les métriques</span><span class="sxs-lookup"><span data-stu-id="d8029-107">The difference between logging and metrics</span></span>

<span data-ttu-id="d8029-108">La *journalisation* s’attache à des messages texte qui enregistrent des informations détaillées sur les événements qui se sont produits dans le système.</span><span class="sxs-lookup"><span data-stu-id="d8029-108">*Logging* is concerned with text messages that record detailed information about things that have happened in the system.</span></span> <span data-ttu-id="d8029-109">Les messages de journal peuvent inclure des données d’exception, telles que des traces de la pile ou des données structurées qui fournissent le contexte relatif au message.</span><span class="sxs-lookup"><span data-stu-id="d8029-109">Log messages might include exception data, like stack traces, or structured data that provides context about the message.</span></span> <span data-ttu-id="d8029-110">La sortie de journalisation est généralement écrite dans un magasin de texte pouvant faire l’objet d’une recherche.</span><span class="sxs-lookup"><span data-stu-id="d8029-110">Logging output is commonly written to a searchable text store.</span></span>

<span data-ttu-id="d8029-111">Les *métriques* font référence à des données numériques conçues pour être agrégées et présentées à l’aide de graphiques et de graphiques dans un tableau de bord.</span><span class="sxs-lookup"><span data-stu-id="d8029-111">*Metrics* refers to numeric data designed to be aggregated and presented by using charts and graphs in a dashboard.</span></span> <span data-ttu-id="d8029-112">Le tableau de bord fournit une vue de l’intégrité globale et des performances d’une application.</span><span class="sxs-lookup"><span data-stu-id="d8029-112">The dashboard provides a view of the overall health and performance of an application.</span></span> <span data-ttu-id="d8029-113">Les données de métriques peuvent également être utilisées pour déclencher des alertes automatisées lorsqu’un seuil est dépassé.</span><span class="sxs-lookup"><span data-stu-id="d8029-113">Metrics data can also be used to trigger automated alerts when a threshold is exceeded.</span></span> <span data-ttu-id="d8029-114">Voici quelques exemples de données de métriques :</span><span class="sxs-lookup"><span data-stu-id="d8029-114">Here are some examples of metrics data:</span></span>

- <span data-ttu-id="d8029-115">Temps nécessaire pour traiter les demandes.</span><span class="sxs-lookup"><span data-stu-id="d8029-115">Time taken to process requests.</span></span>
- <span data-ttu-id="d8029-116">Nombre de demandes par seconde traitées par une instance d’un service.</span><span class="sxs-lookup"><span data-stu-id="d8029-116">The number of requests per second being handled by an instance of a service.</span></span>
- <span data-ttu-id="d8029-117">Nombre de demandes ayant échoué sur une instance.</span><span class="sxs-lookup"><span data-stu-id="d8029-117">The number of failed requests on an instance.</span></span>

## <a name="logging-in-aspnet-core-grpc"></a><span data-ttu-id="d8029-118">Connexion ASP.NET Core gRPC</span><span class="sxs-lookup"><span data-stu-id="d8029-118">Logging in ASP.NET Core gRPC</span></span>

<span data-ttu-id="d8029-119">ASP.NET Core fournit une prise en charge intégrée de la journalisation, sous la forme du package NuGet [Microsoft. extensions. Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) .</span><span class="sxs-lookup"><span data-stu-id="d8029-119">ASP.NET Core provides built-in support for logging, in the form of the [Microsoft.Extensions.Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) NuGet package.</span></span> <span data-ttu-id="d8029-120">Les principales parties de cette bibliothèque sont incluses dans le kit de développement logiciel (SDK) Web. il n’est donc pas nécessaire de l’installer manuellement.</span><span class="sxs-lookup"><span data-stu-id="d8029-120">The core parts of this library are included with the Web SDK, so there's no need to install it manually.</span></span> <span data-ttu-id="d8029-121">Par défaut, les messages de journal sont écrits dans la sortie standard (« console ») et dans tout débogueur attaché.</span><span class="sxs-lookup"><span data-stu-id="d8029-121">By default, log messages are written to the standard output (the "console") and to any attached debugger.</span></span> <span data-ttu-id="d8029-122">Pour écrire des journaux dans des magasins de données externes persistants, vous devrez peut-être importer des [packages de récepteur de journalisation facultatifs](/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span><span class="sxs-lookup"><span data-stu-id="d8029-122">To write logs to persistent external data stores, you might need to import [optional logging sink packages](/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span></span>

<span data-ttu-id="d8029-123">Le ASP.NET Core Framework gRPC écrit des messages de journalisation de diagnostic détaillés dans cette infrastructure de journalisation, afin qu’ils puissent être traités et stockés avec les messages de votre application.</span><span class="sxs-lookup"><span data-stu-id="d8029-123">The ASP.NET Core gRPC framework writes detailed diagnostic logging messages to this logging framework, so they can be processed and stored along with your application's own messages.</span></span>

### <a name="produce-log-messages"></a><span data-ttu-id="d8029-124">Produire des messages de journal</span><span class="sxs-lookup"><span data-stu-id="d8029-124">Produce log messages</span></span>

<span data-ttu-id="d8029-125">L’extension de journalisation est automatiquement inscrite auprès du système d’injection de dépendances de ASP.NET Core, ce qui vous permet de spécifier des journaux en tant que paramètre de constructeur sur les types de service gRPC.</span><span class="sxs-lookup"><span data-stu-id="d8029-125">The logging extension is automatically registered with ASP.NET Core's dependency injection system, so you can specify loggers as a constructor parameter on gRPC service types.</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private readonly ILogger<StockData> _logger;

    public StockData(ILogger<StockData> logger)
    {
        _logger = logger;
    }
}
```

<span data-ttu-id="d8029-126">De nombreux messages de journal, tels que les demandes et les exceptions, sont fournis par les composants de l’infrastructure ASP.NET Core et gRPC.</span><span class="sxs-lookup"><span data-stu-id="d8029-126">Many log messages, such as requests and exceptions, are provided by the ASP.NET Core and gRPC framework components.</span></span> <span data-ttu-id="d8029-127">Ajoutez vos propres messages de journalisation pour fournir des détails et du contexte sur la logique d’application, plutôt que sur des problèmes de niveau inférieur.</span><span class="sxs-lookup"><span data-stu-id="d8029-127">Add your own log messages to provide detail and context about application logic, rather than lower-level concerns.</span></span>

<span data-ttu-id="d8029-128">Pour plus d’informations sur l’écriture de messages de journal et sur les récepteurs de journalisation et les cibles disponibles, consultez  [journalisation dans .net Core et ASP.net Core](/aspnet/core/fundamentals/logging/).</span><span class="sxs-lookup"><span data-stu-id="d8029-128">For more information about writing log messages and available logging sinks and targets, see  [Logging in .NET Core and ASP.NET Core](/aspnet/core/fundamentals/logging/).</span></span>

## <a name="metrics-in-aspnet-core-grpc"></a><span data-ttu-id="d8029-129">Mesures dans ASP.NET Core gRPC</span><span class="sxs-lookup"><span data-stu-id="d8029-129">Metrics in ASP.NET Core gRPC</span></span>

<span data-ttu-id="d8029-130">Le Runtime .NET Core fournit un ensemble de composants pour émettre et observer les métriques.</span><span class="sxs-lookup"><span data-stu-id="d8029-130">The .NET Core runtime provides a set of components for emitting and observing metrics.</span></span> <span data-ttu-id="d8029-131">Celles-ci incluent des API telles que les <xref:System.Diagnostics.Tracing.EventSource> <xref:System.Diagnostics.Tracing.EventCounter> classes et.</span><span class="sxs-lookup"><span data-stu-id="d8029-131">These include APIs such as the <xref:System.Diagnostics.Tracing.EventSource> and <xref:System.Diagnostics.Tracing.EventCounter> classes.</span></span> <span data-ttu-id="d8029-132">Ces API peuvent émettre des données numériques de base qui peuvent être consommées par des processus externes, par exemple l' [outil Global dotnet-Counters](../../core/diagnostics/dotnet-counters.md), ou suivi d’v nements pour Windows.</span><span class="sxs-lookup"><span data-stu-id="d8029-132">These APIs can emit basic numeric data that can be consumed by external processes, like the [dotnet-counters global tool](../../core/diagnostics/dotnet-counters.md), or Event Tracing for Windows.</span></span> <span data-ttu-id="d8029-133">Pour plus d’informations sur l’utilisation `EventCounter` de dans votre propre code, consultez [Introduction à EventCounter](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md).</span><span class="sxs-lookup"><span data-stu-id="d8029-133">For more information about using `EventCounter` in your own code, see [EventCounter introduction](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md).</span></span>

<span data-ttu-id="d8029-134">Pour obtenir des métriques plus avancées et pour écrire des données de métriques dans un plus grand nombre de magasins de données, vous pouvez essayer un projet open source appelé [métriques](https://www.app-metrics.io)de l’application.</span><span class="sxs-lookup"><span data-stu-id="d8029-134">For more advanced metrics and for writing metric data to a wider range of data stores, you might try an open-source project called [App Metrics](https://www.app-metrics.io).</span></span> <span data-ttu-id="d8029-135">Cette suite de bibliothèques fournit un ensemble complet de types pour instrumenter votre code.</span><span class="sxs-lookup"><span data-stu-id="d8029-135">This suite of libraries provides an extensive set of types to instrument your code.</span></span> <span data-ttu-id="d8029-136">Il offre également des packages pour écrire des métriques sur différents types de cibles qui incluent des bases de données de séries chronologiques, telles que Prometheus et InfluxDB, et [application Insights](/azure/azure-monitor/app/app-insights-overview).</span><span class="sxs-lookup"><span data-stu-id="d8029-136">It also offers packages to write metrics to different kinds of targets that include time-series databases, such as Prometheus and InfluxDB, and [Application Insights](/azure/azure-monitor/app/app-insights-overview).</span></span> <span data-ttu-id="d8029-137">Le package NuGet [app. Metrics. AspNetCore. Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) ajoute même un ensemble complet de métriques de base qui sont générées automatiquement par le biais de l’intégration avec l’infrastructure ASP.net core.</span><span class="sxs-lookup"><span data-stu-id="d8029-137">The [App.Metrics.AspNetCore.Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) NuGet package even adds a comprehensive set of basic metrics that are automatically generated via integration with the ASP.NET Core framework.</span></span> <span data-ttu-id="d8029-138">Le site Web du projet fournit des [modèles](https://www.app-metrics.io/samples/grafana/) pour l’affichage de ces métriques avec la plateforme de visualisation [Grafana](https://grafana.com/) .</span><span class="sxs-lookup"><span data-stu-id="d8029-138">The project website provides [templates](https://www.app-metrics.io/samples/grafana/) for displaying those metrics with the [Grafana](https://grafana.com/) visualization platform.</span></span>

### <a name="produce-metrics"></a><span data-ttu-id="d8029-139">Produire des métriques</span><span class="sxs-lookup"><span data-stu-id="d8029-139">Produce metrics</span></span>

<span data-ttu-id="d8029-140">La plupart des plateformes de métriques prennent en charge les types suivants :</span><span class="sxs-lookup"><span data-stu-id="d8029-140">Most metrics platforms support the following types:</span></span>

| <span data-ttu-id="d8029-141">Type de métrique</span><span class="sxs-lookup"><span data-stu-id="d8029-141">Metric type</span></span> | <span data-ttu-id="d8029-142">Description</span><span class="sxs-lookup"><span data-stu-id="d8029-142">Description</span></span> |
| ----------- | ----------- |
| <span data-ttu-id="d8029-143">Compteur</span><span class="sxs-lookup"><span data-stu-id="d8029-143">Counter</span></span>     | <span data-ttu-id="d8029-144">Effectue le suivi du nombre de fois où un événement se produit, par exemple les demandes et les erreurs.</span><span class="sxs-lookup"><span data-stu-id="d8029-144">Tracks how often something happens, such as requests and errors.</span></span> |
| <span data-ttu-id="d8029-145">Jauge</span><span class="sxs-lookup"><span data-stu-id="d8029-145">Gauge</span></span>       | <span data-ttu-id="d8029-146">Enregistre une valeur unique qui change au fil du temps, par exemple des connexions actives.</span><span class="sxs-lookup"><span data-stu-id="d8029-146">Records a single value that changes over time, such as active connections.</span></span> |
| <span data-ttu-id="d8029-147">Histogramme</span><span class="sxs-lookup"><span data-stu-id="d8029-147">Histogram</span></span>   | <span data-ttu-id="d8029-148">Mesure une distribution de valeurs à travers des limites arbitraires.</span><span class="sxs-lookup"><span data-stu-id="d8029-148">Measures a distribution of values across arbitrary limits.</span></span> <span data-ttu-id="d8029-149">Par exemple, un histogramme peut suivre la taille d’un jeu de données, compter le nombre d’enregistrements contenus <10, le nombre d’enregistrements 11-100, le nombre d’enregistrements 101-1000 contenus et le nombre d’enregistrements contenus >1000.</span><span class="sxs-lookup"><span data-stu-id="d8029-149">For example, a histogram can track dataset size, counting how many contained <10 records, how many contained 11-100 records, how many contained 101-1000 records, and how many contained >1000 records.</span></span> |
| <span data-ttu-id="d8029-150">Compteur</span><span class="sxs-lookup"><span data-stu-id="d8029-150">Meter</span></span>       | <span data-ttu-id="d8029-151">Mesure le taux auquel un événement se produit dans différents intervalles de temps.</span><span class="sxs-lookup"><span data-stu-id="d8029-151">Measures the rate at which an event occurs in various time spans.</span></span> |
| <span data-ttu-id="d8029-152">Minuteur</span><span class="sxs-lookup"><span data-stu-id="d8029-152">Timer</span></span>       | <span data-ttu-id="d8029-153">Effectue le suivi de la durée des événements et de la vitesse à laquelle ils se produisent, stockés sous la forme d’un histogramme.</span><span class="sxs-lookup"><span data-stu-id="d8029-153">Tracks the duration of events and the rate at which it occurs, stored as a histogram.</span></span> |

<span data-ttu-id="d8029-154">En utilisant des *métriques d’application*, une `IMetrics` interface peut être obtenue via l’injection de dépendances et utilisée pour enregistrer l’une de ces métriques pour un service gRPC.</span><span class="sxs-lookup"><span data-stu-id="d8029-154">By using *App Metrics*, an `IMetrics` interface can be obtained via dependency injection, and used to record any of these metrics for a gRPC service.</span></span> <span data-ttu-id="d8029-155">L’exemple suivant montre comment compter le nombre de `Get` demandes effectuées dans le temps :</span><span class="sxs-lookup"><span data-stu-id="d8029-155">The following example shows how to count the number of `Get` requests made over time:</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private static readonly CounterOptions GetRequestCounter = new CounterOptions
    {
        Name = "StockData_Get_Requests",
        MeasurementUnit = Unit.Calls
    };

    private readonly IStockRepository _repository;
    private readonly IMetrics _metrics;

    public StockData(IStockRepository repository, IMetrics metrics)
    {
        _repository = repository;
        _metrics = metrics;
    }

    public override async Task<GetResponse> Get(GetRequest request, ServerCallContext context)
    {
        _metrics.Measure.Counter.Increment(GetRequestCounter);

        // Serve request...
    }
}
```

### <a name="store-and-visualize-metrics-data"></a><span data-ttu-id="d8029-156">Stocker et visualiser les données de métriques</span><span class="sxs-lookup"><span data-stu-id="d8029-156">Store and visualize metrics data</span></span>

<span data-ttu-id="d8029-157">La meilleure façon de stocker les données de métriques se trouve dans une *base de données de série chronologique*, une banque de données spécialisée conçue pour enregistrer des séries de données numériques marquées avec des horodateurs.</span><span class="sxs-lookup"><span data-stu-id="d8029-157">The best way to store metrics data is in a *time-series database*, a specialized data store designed to record numerical data series marked with timestamps.</span></span> <span data-ttu-id="d8029-158">Les bases de données les plus populaires sont [Prometheus](https://prometheus.io/) et [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span><span class="sxs-lookup"><span data-stu-id="d8029-158">The most popular of these databases are [Prometheus](https://prometheus.io/) and [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span></span> <span data-ttu-id="d8029-159">Microsoft Azure fournit également un stockage de métriques dédié par le biais du service [Azure Monitor](/azure/azure-monitor/overview) .</span><span class="sxs-lookup"><span data-stu-id="d8029-159">Microsoft Azure also provides dedicated metrics storage through the [Azure Monitor](/azure/azure-monitor/overview) service.</span></span>

<span data-ttu-id="d8029-160">La solution actuelle de visualisation des données de métriques est [Grafana](https://grafana.com), qui fonctionne avec un large éventail de fournisseurs de stockage.</span><span class="sxs-lookup"><span data-stu-id="d8029-160">The current go-to solution for visualizing metrics data is [Grafana](https://grafana.com), which works with a wide range of storage providers.</span></span> <span data-ttu-id="d8029-161">L’image suivante montre un exemple de tableau de bord Grafana qui affiche les métriques de la maille du service Linkerd exécutant l’exemple StockData :</span><span class="sxs-lookup"><span data-stu-id="d8029-161">The following image shows an example Grafana dashboard that displays metrics from the Linkerd service mesh running the StockData sample:</span></span>

![Capture d’écran du tableau de bord Grafana](media/application-performance-management/grafana-screenshot.png)

### <a name="metrics-based-alerting"></a><span data-ttu-id="d8029-163">Alertes basées sur les métriques</span><span class="sxs-lookup"><span data-stu-id="d8029-163">Metrics-based alerting</span></span>

<span data-ttu-id="d8029-164">La nature numérique des données de métriques signifie qu’elle est idéalement adaptée aux systèmes d’alerte, en avertissant les développeurs ou les ingénieurs du support technique lorsqu’une valeur se situe en dehors d’une tolérance définie.</span><span class="sxs-lookup"><span data-stu-id="d8029-164">The numerical nature of metrics data means that it's ideally suited to drive alerting systems, notifying developers or support engineers when a value falls outside of some defined tolerance.</span></span> <span data-ttu-id="d8029-165">Les plateformes déjà mentionnées prennent en charge l’alerte par le biais d’une gamme d’options, notamment les e-mails, les SMS ou les visualisations dans le tableau de bord.</span><span class="sxs-lookup"><span data-stu-id="d8029-165">The platforms already mentioned all provide support for alerting via a range of options, including emails, text messages, or in-dashboard visualizations.</span></span>

## <a name="distributed-tracing"></a><span data-ttu-id="d8029-166">Traçage distribué</span><span class="sxs-lookup"><span data-stu-id="d8029-166">Distributed tracing</span></span>

<span data-ttu-id="d8029-167">Le traçage distribué est un développement relativement récent dans le monitoring, qui vient de l’utilisation accrue des microservices et des architectures distribuées.</span><span class="sxs-lookup"><span data-stu-id="d8029-167">Distributed tracing is a relatively recent development in monitoring, which has arisen from the increasing use of microservices and distributed architectures.</span></span> <span data-ttu-id="d8029-168">Une demande unique d’un navigateur client, d’une application ou d’un appareil peut être divisée en plusieurs étapes et sous-requêtes, et impliquer l’utilisation de nombreux services sur un réseau.</span><span class="sxs-lookup"><span data-stu-id="d8029-168">A single request from a client browser, application, or device can be broken down into many steps and sub-requests, and involve the use of many services across a network.</span></span> <span data-ttu-id="d8029-169">Cela complique la mise en corrélation des messages du journal et des métriques avec la demande spécifique qui les a déclenchés.</span><span class="sxs-lookup"><span data-stu-id="d8029-169">This makes it difficult to correlate log messages and metrics with the specific request that triggered them.</span></span> <span data-ttu-id="d8029-170">Le traçage distribué applique des identificateurs aux requêtes, ce qui permet de corréler les journaux et les métriques avec une opération particulière.</span><span class="sxs-lookup"><span data-stu-id="d8029-170">Distributed tracing applies identifiers to requests, and this allows logs and metrics to be correlated with a particular operation.</span></span> <span data-ttu-id="d8029-171">Cela est similaire au [suivi de bout en bout de WCF](../../framework/wcf/diagnostics/tracing/end-to-end-tracing.md), mais il est appliqué sur plusieurs plateformes.</span><span class="sxs-lookup"><span data-stu-id="d8029-171">This is similar to [WCF's end-to-end tracing](../../framework/wcf/diagnostics/tracing/end-to-end-tracing.md), but it's applied across multiple platforms.</span></span>

<span data-ttu-id="d8029-172">Le suivi distribué a augmenté rapidement et commence à normaliser.</span><span class="sxs-lookup"><span data-stu-id="d8029-172">Distributed tracing has grown quickly in popularity and is beginning to standardize.</span></span> <span data-ttu-id="d8029-173">La Fondation Cloud Native Computing a créé la [norme Open Tracing](https://opentracing.io), en tentant de fournir des bibliothèques indépendantes du fournisseur pour travailler avec des serveurs back end comme [Jaeger](https://www.jaegertracing.io/) et l' [APM élastique](https://www.elastic.co/products/apm).</span><span class="sxs-lookup"><span data-stu-id="d8029-173">The Cloud Native Computing Foundation created the [Open Tracing standard](https://opentracing.io), attempting to provide vendor-neutral libraries for working with back ends like [Jaeger](https://www.jaegertracing.io/) and [Elastic APM](https://www.elastic.co/products/apm).</span></span> <span data-ttu-id="d8029-174">En même temps, Google a créé le [projet OpenCensus](https://opencensus.io/) pour résoudre le même ensemble de problèmes.</span><span class="sxs-lookup"><span data-stu-id="d8029-174">At the same time, Google created the [OpenCensus project](https://opencensus.io/) to address the same set of problems.</span></span> <span data-ttu-id="d8029-175">Ces deux projets sont fusionnés dans un nouveau projet, [OpenTelemetry](https://opentelemetry.io), qui a pour but d’être la norme du secteur.</span><span class="sxs-lookup"><span data-stu-id="d8029-175">These two projects are merging into a new project, [OpenTelemetry](https://opentelemetry.io), which aims to be the industry standard of the future.</span></span>

### <a name="how-distributed-tracing-works"></a><span data-ttu-id="d8029-176">Fonctionnement du traçage distribué</span><span class="sxs-lookup"><span data-stu-id="d8029-176">How distributed tracing works</span></span>

<span data-ttu-id="d8029-177">Le traçage distribué est basé sur le concept d' *étendues*: les opérations chronométrées qui font partie d’une seule *trace*, ce qui peut impliquer le traitement sur plusieurs nœuds d’un système.</span><span class="sxs-lookup"><span data-stu-id="d8029-177">Distributed tracing is based on the concept of *spans*: named, timed operations that are part of a single *trace*, which can involve processing on multiple nodes of a system.</span></span> <span data-ttu-id="d8029-178">Lorsqu’une nouvelle opération est lancée, une trace est créée avec un identificateur unique.</span><span class="sxs-lookup"><span data-stu-id="d8029-178">When a new operation is initiated, a trace is created with a unique identifier.</span></span> <span data-ttu-id="d8029-179">Pour chaque sous-opération, une étendue est créée avec son propre identificateur et identificateur de suivi.</span><span class="sxs-lookup"><span data-stu-id="d8029-179">For each sub-operation, a span is created with its own identifier and trace identifier.</span></span> <span data-ttu-id="d8029-180">À mesure que la demande passe par le système, plusieurs composants peuvent créer des étendues *enfants* incluant l’identificateur de leur *parent*.</span><span class="sxs-lookup"><span data-stu-id="d8029-180">As the request passes around the system, various components can create *child* spans that include the identifier of their *parent*.</span></span> <span data-ttu-id="d8029-181">Une étendue a un *contexte*, qui contient les identificateurs de trace et d’étendue, ainsi que des données utiles sous la forme de paires clé/valeur (appelées *bagages*).</span><span class="sxs-lookup"><span data-stu-id="d8029-181">A span has a *context*, which contains the trace and span identifiers, as well as useful data in the form of key and value pairs (called *baggage*).</span></span>

### <a name="distributed-tracing-with-diagnosticsource"></a><span data-ttu-id="d8029-182">Traçage distribué avec `DiagnosticSource`</span><span class="sxs-lookup"><span data-stu-id="d8029-182">Distributed tracing with `DiagnosticSource`</span></span>

<span data-ttu-id="d8029-183">.NET Core possède un module interne qui s’adapte bien aux traces et aux étendues distribuées : [DiagnosticSource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span><span class="sxs-lookup"><span data-stu-id="d8029-183">.NET Core has an internal module that maps well to distributed traces and spans: [DiagnosticSource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span></span> <span data-ttu-id="d8029-184">En plus de fournir un moyen simple de produire et de consommer les Diagnostics au sein d’un processus, le `DiagnosticSource` module a le concept d' *activité*.</span><span class="sxs-lookup"><span data-stu-id="d8029-184">As well as providing a simple way to produce and consume diagnostics within a process, the `DiagnosticSource` module has the concept of an *activity*.</span></span> <span data-ttu-id="d8029-185">Une activité est effectivement une implémentation d’une trace distribuée ou d’une étendue dans une trace.</span><span class="sxs-lookup"><span data-stu-id="d8029-185">An activity is effectively an implementation of a distributed trace, or a span within a trace.</span></span> <span data-ttu-id="d8029-186">Les éléments internes du module prennent en charge les activités parent/enfant, y compris l’allocation des identificateurs.</span><span class="sxs-lookup"><span data-stu-id="d8029-186">The internals of the module take care of parent/child activities, including allocating identifiers.</span></span> <span data-ttu-id="d8029-187">Pour plus d’informations sur l’utilisation du `Activity` type, consultez le [Guide de l’utilisateur de l’activité sur GitHub](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide).</span><span class="sxs-lookup"><span data-stu-id="d8029-187">For more information about using the `Activity` type, see the [Activity User Guide on GitHub](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide).</span></span>

<span data-ttu-id="d8029-188">Étant donné que `DiagnosticSource` fait partie de l’infrastructure de base, il est pris en charge par plusieurs composants de base.</span><span class="sxs-lookup"><span data-stu-id="d8029-188">Because `DiagnosticSource` is a part of the core framework, it's supported by several core components.</span></span> <span data-ttu-id="d8029-189">Ces derniers incluent <xref:System.Net.Http.HttpClient> , Entity Framework Core et ASP.net Core, notamment la prise en charge explicite dans l’infrastructure gRPC.</span><span class="sxs-lookup"><span data-stu-id="d8029-189">These include <xref:System.Net.Http.HttpClient>, Entity Framework Core, and ASP.NET Core, including explicit support in the gRPC framework.</span></span> <span data-ttu-id="d8029-190">Lorsque ASP.NET Core reçoit une demande, il recherche une paire d’en-têtes HTTP correspondant à la norme du [contexte de trace W3C](https://www.w3.org/TR/trace-context) .</span><span class="sxs-lookup"><span data-stu-id="d8029-190">When ASP.NET Core receives a request, it checks for a pair of HTTP headers matching the [W3C Trace Context](https://www.w3.org/TR/trace-context) standard.</span></span> <span data-ttu-id="d8029-191">Si les en-têtes sont trouvés, une activité est démarrée à l’aide des valeurs d’identité et du contexte des en-têtes.</span><span class="sxs-lookup"><span data-stu-id="d8029-191">If the headers are found, an activity is started by using the identity values and context from the headers.</span></span> <span data-ttu-id="d8029-192">Si aucun en-tête n’est trouvé, une activité est démarrée avec des valeurs d’identité générées qui correspondent au format standard.</span><span class="sxs-lookup"><span data-stu-id="d8029-192">If no headers are found, an activity is started with generated identity values that match the standard format.</span></span> <span data-ttu-id="d8029-193">Les diagnostics générés par l’infrastructure ou par le code d’application pendant la durée de vie de cette activité peuvent être marqués avec les identificateurs de trace et d’étendue.</span><span class="sxs-lookup"><span data-stu-id="d8029-193">Any diagnostics generated by the framework or by application code during the lifetime of this activity can be tagged with the trace and span identifiers.</span></span> <span data-ttu-id="d8029-194">La `HttpClient` prise en charge s’étend davantage en vérifiant une activité en cours à chaque demande et en ajoutant automatiquement les en-têtes de trace à la demande sortante.</span><span class="sxs-lookup"><span data-stu-id="d8029-194">The `HttpClient` support extends this further by checking for a current activity on every request, and automatically adding the trace headers to the outgoing request.</span></span>

<span data-ttu-id="d8029-195">Les bibliothèques clientes et serveur ASP.NET Core gRPC incluent une prise en charge explicite de `DiagnosticSource` et `Activity` , et créent des activités et appliquent et utilisent automatiquement les informations d’en-tête.</span><span class="sxs-lookup"><span data-stu-id="d8029-195">The ASP.NET Core gRPC client and server libraries include explicit support for `DiagnosticSource` and `Activity`, and create activities and apply and use header information automatically.</span></span>

> [!NOTE]
> <span data-ttu-id="d8029-196">Tout cela se produit uniquement si un écouteur utilise les informations de diagnostic.</span><span class="sxs-lookup"><span data-stu-id="d8029-196">All of this happens only if a listener is consuming the diagnostic information.</span></span> <span data-ttu-id="d8029-197">S’il n’y a pas d’écouteur, aucun diagnostic n’est écrit et aucune activité n’est créée.</span><span class="sxs-lookup"><span data-stu-id="d8029-197">If there's no listener, no diagnostics are written and no activities are created.</span></span>

### <a name="add-your-own-diagnosticsource-and-activity"></a><span data-ttu-id="d8029-198">Ajoutez vos propres `DiagnosticSource` et `Activity`</span><span class="sxs-lookup"><span data-stu-id="d8029-198">Add your own `DiagnosticSource` and `Activity`</span></span>

<span data-ttu-id="d8029-199">Pour ajouter vos propres Diagnostics ou créer des étendues explicites dans le code de votre application, consultez le Guide de l' [utilisateur DiagnosticSource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) et le Guide de l’utilisateur de l' [activité](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage).</span><span class="sxs-lookup"><span data-stu-id="d8029-199">To add your own diagnostics or create explicit spans within your application code, see the [DiagnosticSource User Guide](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) and [Activity User Guide](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage).</span></span>

### <a name="store-distributed-trace-data"></a><span data-ttu-id="d8029-200">Stocker les données de trace distribuées</span><span class="sxs-lookup"><span data-stu-id="d8029-200">Store distributed trace data</span></span>

<span data-ttu-id="d8029-201">Au moment de la rédaction du présent article, le projet OpenTelemetry est toujours en phase précoce et seuls les packages de qualité alpha sont disponibles pour les applications .NET.</span><span class="sxs-lookup"><span data-stu-id="d8029-201">At the time of writing, the OpenTelemetry project is still in the early stages, and only alpha-quality packages are available for .NET applications.</span></span> <span data-ttu-id="d8029-202">Le projet OpenTracing offre actuellement des bibliothèques plus matures.</span><span class="sxs-lookup"><span data-stu-id="d8029-202">The OpenTracing project currently offers more mature libraries.</span></span>

<span data-ttu-id="d8029-203">L’API OpenTracing est décrite dans la section suivante.</span><span class="sxs-lookup"><span data-stu-id="d8029-203">The OpenTracing API is described in the following section.</span></span> <span data-ttu-id="d8029-204">Si vous souhaitez utiliser l’API OpenTelemetry dans votre application, reportez-vous au [référentiel du kit de développement logiciel (SDK) OpenTelemetry .net](https://github.com/open-telemetry/opentelemetry-dotnet) sur GitHub.</span><span class="sxs-lookup"><span data-stu-id="d8029-204">If you want to use the OpenTelemetry API in your application instead, refer to the [OpenTelemetry .NET SDK repository](https://github.com/open-telemetry/opentelemetry-dotnet) on GitHub.</span></span>

#### <a name="use-the-opentracing-package-to-store-distributed-trace-data"></a><span data-ttu-id="d8029-205">Utiliser le package OpenTracing pour stocker les données de trace distribuées</span><span class="sxs-lookup"><span data-stu-id="d8029-205">Use the OpenTracing package to store distributed trace data</span></span>

<span data-ttu-id="d8029-206">Le [package NuGet OpenTracing](https://www.nuget.org/packages/OpenTracing/) prend en charge tous les back-end conformes à OpenTracing (qui peuvent être utilisés indépendamment de `DiagnosticSource` ).</span><span class="sxs-lookup"><span data-stu-id="d8029-206">The [OpenTracing NuGet package](https://www.nuget.org/packages/OpenTracing/) supports all OpenTracing-compliant back ends (which can be used independently of `DiagnosticSource`).</span></span> <span data-ttu-id="d8029-207">Il existe un package supplémentaire du projet contributions de l’API OpenTracing, [OpenTracing. satrib. Netcore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/).</span><span class="sxs-lookup"><span data-stu-id="d8029-207">There's an additional package from the OpenTracing API Contributions project, [OpenTracing.Contrib.NetCore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/).</span></span> <span data-ttu-id="d8029-208">Ce package ajoute un `DiagnosticSource` écouteur et écrit automatiquement des événements et des activités dans un back end.</span><span class="sxs-lookup"><span data-stu-id="d8029-208">This package adds a `DiagnosticSource` listener, and writes events and activities to a back end automatically.</span></span> <span data-ttu-id="d8029-209">L’activation de ce package est aussi simple que son installation à partir de NuGet et son ajout en tant que service dans votre `Startup` classe.</span><span class="sxs-lookup"><span data-stu-id="d8029-209">Enabling this package is as simple as installing it from NuGet and adding it as a service in your `Startup` class.</span></span>

```csharp
public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddOpenTracing();
    }
}
```

<span data-ttu-id="d8029-210">Le package OpenTracing est une couche d’abstraction, et en tant que tel, il requiert une implémentation spécifique à l’back end.</span><span class="sxs-lookup"><span data-stu-id="d8029-210">The OpenTracing package is an abstraction layer, and as such it requires implementation specific to the back end.</span></span> <span data-ttu-id="d8029-211">Les implémentations de l’API OpenTracing sont disponibles pour les back-end Open source suivants.</span><span class="sxs-lookup"><span data-stu-id="d8029-211">OpenTracing API implementations are available for the following open source back ends.</span></span>

| <span data-ttu-id="d8029-212">Nom</span><span class="sxs-lookup"><span data-stu-id="d8029-212">Name</span></span> | <span data-ttu-id="d8029-213">Package</span><span class="sxs-lookup"><span data-stu-id="d8029-213">Package</span></span> | <span data-ttu-id="d8029-214">Site web</span><span class="sxs-lookup"><span data-stu-id="d8029-214">Website</span></span> |
| ---- | ------- | -------- |
| <span data-ttu-id="d8029-215">Jaeger</span><span class="sxs-lookup"><span data-stu-id="d8029-215">Jaeger</span></span> | [<span data-ttu-id="d8029-216">Jaeger</span><span class="sxs-lookup"><span data-stu-id="d8029-216">Jaeger</span></span>](https://www.nuget.org/packages/Jaeger/) | [<span data-ttu-id="d8029-217">jaegertracing.io</span><span class="sxs-lookup"><span data-stu-id="d8029-217">jaegertracing.io</span></span>](https://jaegertracing.io) |
| <span data-ttu-id="d8029-218">APM élastique</span><span class="sxs-lookup"><span data-stu-id="d8029-218">Elastic APM</span></span> | [<span data-ttu-id="d8029-219">Élastique. APM. NetCoreAll</span><span class="sxs-lookup"><span data-stu-id="d8029-219">Elastic.Apm.NetCoreAll</span></span>](https://www.nuget.org/packages/Elastic.Apm.NetCoreAll/) | [<span data-ttu-id="d8029-220">elastic.co/products/apm</span><span class="sxs-lookup"><span data-stu-id="d8029-220">elastic.co/products/apm</span></span>](https://www.elastic.co/products/apm) |

<span data-ttu-id="d8029-221">Pour plus d’informations sur l’API OpenTracing pour .NET, consultez [OpenTracing for c#](https://github.com/opentracing/opentracing-csharp) and the [OpenTracing contrib c#/.net Core](https://github.com/opentracing-contrib/csharp-netcore) dépôts sur GitHub.</span><span class="sxs-lookup"><span data-stu-id="d8029-221">For more information on the OpenTracing API for .NET, see the [OpenTracing for C#](https://github.com/opentracing/opentracing-csharp) and the [OpenTracing Contrib C#/.NET Core](https://github.com/opentracing-contrib/csharp-netcore) repositories on GitHub.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="d8029-222">[Précédent](load-balancing.md) 
> [Suivant](appendix.md)</span><span class="sxs-lookup"><span data-stu-id="d8029-222">[Previous](load-balancing.md)
[Next](appendix.md)</span></span>

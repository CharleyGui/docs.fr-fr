---
title: Gestion de l’état
description: Découvrez les différentes approches de la gestion de l’État dans ASP.NET Web Forms et éblouissant.
author: csharpfritz
ms.author: jefritz
ms.date: 05/15/2020
ms.openlocfilehash: 2ca811f886c6a245ac16c2bd66a68ff16e5bfc44
ms.sourcegitcommit: 0100be20fcf23f61dab672deced70059ed71bb2e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/17/2020
ms.locfileid: "88267722"
---
# <a name="state-management"></a><span data-ttu-id="e26af-103">Gestion de l’état</span><span class="sxs-lookup"><span data-stu-id="e26af-103">State management</span></span>

<span data-ttu-id="e26af-104">La gestion d’État est un concept clé des applications Web Forms, facilitant l’état d’affichage, l’état de session, l’état de l’application et les fonctionnalités de publication (postback).</span><span class="sxs-lookup"><span data-stu-id="e26af-104">State management is a key concept of Web Forms applications, facilitated through View State, Session State, Application State, and Postback features.</span></span> <span data-ttu-id="e26af-105">Ces fonctionnalités avec état de l’infrastructure ont permis de masquer la gestion des États requise pour une application et permettent aux développeurs d’applications de se concentrer sur la prestation de leurs fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="e26af-105">These stateful features of the framework helped to hide the state management required for an application and allow application developers to focus on delivering their functionality.</span></span> <span data-ttu-id="e26af-106">Avec ASP.NET Core et éblouissant, certaines de ces fonctionnalités ont été déplacées et d’autres ont été supprimées entièrement.</span><span class="sxs-lookup"><span data-stu-id="e26af-106">With ASP.NET Core and Blazor, some of these features have been relocated and some have been removed altogether.</span></span> <span data-ttu-id="e26af-107">Ce chapitre passe en revue la façon de maintenir l’État et de fournir les mêmes fonctionnalités avec les nouvelles fonctionnalités de éblouissant.</span><span class="sxs-lookup"><span data-stu-id="e26af-107">This chapter reviews how to maintain state and deliver the same functionality with the new features in Blazor.</span></span>

## <a name="request-state-management-with-viewstate"></a><span data-ttu-id="e26af-108">Demander la gestion de l’état avec ViewState</span><span class="sxs-lookup"><span data-stu-id="e26af-108">Request state management with ViewState</span></span>

<span data-ttu-id="e26af-109">Lorsque vous aborderez la gestion des États dans Web Forms application, de nombreux développeurs pensent immédiatement à ViewState.</span><span class="sxs-lookup"><span data-stu-id="e26af-109">When discussing state management in Web Forms application, many developers will immediately think of ViewState.</span></span> <span data-ttu-id="e26af-110">Dans Web Forms, ViewState gère l’état du contenu entre les requêtes HTTP en envoyant un grand bloc de texte encodé dans le navigateur.</span><span class="sxs-lookup"><span data-stu-id="e26af-110">In Web Forms, ViewState manages the state of the content between HTTP requests by sending a large encoded block of text back and forth to the browser.</span></span> <span data-ttu-id="e26af-111">Le champ ViewState peut être submergé par le contenu d’une page contenant de nombreux éléments, ce qui peut s’étendre à plusieurs mégaoctets.</span><span class="sxs-lookup"><span data-stu-id="e26af-111">The ViewState field could be overwhelmed with content from a page containing many elements, potentially expanding to several megabytes in size.</span></span>

<span data-ttu-id="e26af-112">Avec le serveur éblouissant, l’application maintient une connexion continue avec le serveur.</span><span class="sxs-lookup"><span data-stu-id="e26af-112">With Blazor Server, the app maintains an ongoing connection with the server.</span></span> <span data-ttu-id="e26af-113">L’état de l’application, appelé *circuit*, est conservé dans la mémoire du serveur pendant que la connexion est considérée comme active.</span><span class="sxs-lookup"><span data-stu-id="e26af-113">The app's state, called a *circuit*, is held in server memory while the connection is considered active.</span></span> <span data-ttu-id="e26af-114">L’État est supprimé uniquement lorsque l’utilisateur quitte l’application ou une page particulière de l’application.</span><span class="sxs-lookup"><span data-stu-id="e26af-114">State will only be disposed when the user navigates away from the app or a particular page in the app.</span></span> <span data-ttu-id="e26af-115">Tous les membres des composants actifs sont disponibles entre les interactions avec le serveur.</span><span class="sxs-lookup"><span data-stu-id="e26af-115">All members of the active components are available between interactions with the server.</span></span>

<span data-ttu-id="e26af-116">Cette fonctionnalité présente plusieurs avantages :</span><span class="sxs-lookup"><span data-stu-id="e26af-116">There are several advantages of this feature:</span></span>

- <span data-ttu-id="e26af-117">L’état du composant est immédiatement disponible et n’est pas régénéré entre les interactions.</span><span class="sxs-lookup"><span data-stu-id="e26af-117">Component state is readily available and not rebuilt between interactions.</span></span>
- <span data-ttu-id="e26af-118">L’État n’est pas transmis au navigateur.</span><span class="sxs-lookup"><span data-stu-id="e26af-118">State isn't transmitted to the browser.</span></span>

<span data-ttu-id="e26af-119">Toutefois, il existe quelques inconvénients à la persistance de l’état des composants en mémoire à connaître :</span><span class="sxs-lookup"><span data-stu-id="e26af-119">However, there are some disadvantages to in-memory component state persistence to be aware of:</span></span>

- <span data-ttu-id="e26af-120">Si le serveur redémarre entre les demandes, l’État est perdu.</span><span class="sxs-lookup"><span data-stu-id="e26af-120">If the server restarts between request, state is lost.</span></span>
- <span data-ttu-id="e26af-121">La solution d’équilibrage de charge de votre serveur Web d’application doit inclure des sessions rémanentes pour s’assurer que toutes les demandes du même navigateur reviennent au même serveur.</span><span class="sxs-lookup"><span data-stu-id="e26af-121">Your application web server load-balancing solution must include sticky sessions to ensure that all requests from the same browser return to the same server.</span></span> <span data-ttu-id="e26af-122">Si une demande est envoyée à un autre serveur, l’État sera perdu.</span><span class="sxs-lookup"><span data-stu-id="e26af-122">If a request goes to a different server, state will be lost.</span></span>
- <span data-ttu-id="e26af-123">La persistance de l’état des composants sur le serveur peut entraîner une sollicitation de la mémoire sur le serveur Web.</span><span class="sxs-lookup"><span data-stu-id="e26af-123">Persistence of component state on the server can lead to memory pressure on the web server.</span></span>

<span data-ttu-id="e26af-124">Pour les raisons précédentes, ne vous fiez pas uniquement à l’état du composant pour qu’il se trouve en mémoire sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="e26af-124">For the preceding reasons, don't rely on just the state of the component to reside in-memory on the server.</span></span> <span data-ttu-id="e26af-125">Votre application doit également inclure un magasin de données de stockage pour les données entre les demandes.</span><span class="sxs-lookup"><span data-stu-id="e26af-125">Your application should also include some backing data store for data between requests.</span></span> <span data-ttu-id="e26af-126">Voici quelques exemples simples de cette stratégie :</span><span class="sxs-lookup"><span data-stu-id="e26af-126">Some simple examples of this strategy:</span></span>

- <span data-ttu-id="e26af-127">Dans une application de panier d’achat, conserver le contenu des nouveaux éléments ajoutés au panier dans un enregistrement de base de données.</span><span class="sxs-lookup"><span data-stu-id="e26af-127">In a shopping cart application, persist the content of new items added to the cart in a database record.</span></span> <span data-ttu-id="e26af-128">Si l’État sur le serveur est perdu, vous pouvez le reconstituer à partir des enregistrements de la base de données.</span><span class="sxs-lookup"><span data-stu-id="e26af-128">If the state on the server is lost, you can reconstitute it from the database records.</span></span>
- <span data-ttu-id="e26af-129">Dans un formulaire Web en plusieurs parties, vos utilisateurs s’attendent à ce que votre application mémorise les valeurs entre chaque requête.</span><span class="sxs-lookup"><span data-stu-id="e26af-129">In a multi-part web form, your users will expect your application to remember values between each request.</span></span> <span data-ttu-id="e26af-130">Écrivez les données entre chacune des publications de votre utilisateur dans un magasin de données afin qu’elles puissent être extraites et assemblées dans la structure de réponse finale du formulaire lorsque le formulaire en plusieurs parties est terminé.</span><span class="sxs-lookup"><span data-stu-id="e26af-130">Write the data between each of your user's posts to a data store so that they can be fetched and assembled into the final form response structure when the multi-part form is completed.</span></span>

<span data-ttu-id="e26af-131">Pour plus d’informations sur la gestion de l’État dans les applications éblouissantes, consultez ASP.NET Core la gestion de l' [État éblouissant](/aspnet/core/blazor/state-management).</span><span class="sxs-lookup"><span data-stu-id="e26af-131">For additional details on managing state in Blazor apps, see [ASP.NET Core Blazor state management](/aspnet/core/blazor/state-management).</span></span>

## <a name="maintain-state-with-session"></a><span data-ttu-id="e26af-132">Conserver l’état avec la session</span><span class="sxs-lookup"><span data-stu-id="e26af-132">Maintain state with Session</span></span>

<span data-ttu-id="e26af-133">Web Forms les développeurs peuvent conserver des informations sur l’utilisateur en cours d’utilisation avec l' <xref:Microsoft.AspNetCore.Http.ISession?displayProperty=nameWithType> objet Dictionary.</span><span class="sxs-lookup"><span data-stu-id="e26af-133">Web Forms developers could maintain information about the currently acting user with the <xref:Microsoft.AspNetCore.Http.ISession?displayProperty=nameWithType> dictionary object.</span></span> <span data-ttu-id="e26af-134">Il est assez simple d’ajouter un objet avec une clé de chaîne à la `Session` , et cet objet sera disponible ultérieurement pendant les interactions de l’utilisateur avec l’application.</span><span class="sxs-lookup"><span data-stu-id="e26af-134">It's easy enough to add an object with a string key to the `Session`, and that object would be available at a later time during the user's interactions with the application.</span></span> <span data-ttu-id="e26af-135">Pour tenter d’éliminer la gestion de l’interaction avec HTTP, l’objet a facilité la `Session` conservation de l’État.</span><span class="sxs-lookup"><span data-stu-id="e26af-135">In an attempt to eliminate managing interacting with HTTP, the `Session` object made it easy to maintain state.</span></span>

<span data-ttu-id="e26af-136">La signature de l' `Session` objet .NET Framework n’est pas la même que l' `Session` objet ASP.net core.</span><span class="sxs-lookup"><span data-stu-id="e26af-136">The signature of the .NET Framework `Session` object isn't the same as the ASP.NET Core `Session` object.</span></span> <span data-ttu-id="e26af-137">Examinez [la documentation relative à la nouvelle session de ASP.net Core](/dotnet/api/microsoft.aspnetcore.http.isession) avant de décider de migrer et d’utiliser la nouvelle fonctionnalité d’état de session.</span><span class="sxs-lookup"><span data-stu-id="e26af-137">Consider [the documentation for the new ASP.NET Core Session](/dotnet/api/microsoft.aspnetcore.http.isession) before deciding to migrate and use the new session state feature.</span></span>

<span data-ttu-id="e26af-138">La session est disponible dans ASP.NET Core et le serveur éblouissant, mais il est déconseillé de l’utiliser en faveur du stockage des données dans un référentiel de données de manière appropriée.</span><span class="sxs-lookup"><span data-stu-id="e26af-138">Session is available in ASP.NET Core and Blazor Server, but is discouraged from use in favor of storing data in a data repository appropriately.</span></span> <span data-ttu-id="e26af-139">L’état de session ne fonctionne pas non plus si les visiteurs refusent l’utilisation de cookies HTTP dans votre application en raison de problèmes de confidentialité.</span><span class="sxs-lookup"><span data-stu-id="e26af-139">Session state is also not functional if visitors decline the use HTTP cookies in your application due to privacy concerns.</span></span>

<span data-ttu-id="e26af-140">La configuration de ASP.NET Core et de l’état de session est disponible dans l' [article gestion de session et d’État dans ASP.net Core](/aspnet/core/fundamentals/app-state#session-state).</span><span class="sxs-lookup"><span data-stu-id="e26af-140">Configuration for ASP.NET Core and Session state is available in the [Session and state management in ASP.NET Core article](/aspnet/core/fundamentals/app-state#session-state).</span></span>

## <a name="application-state"></a><span data-ttu-id="e26af-141">État de l’application</span><span class="sxs-lookup"><span data-stu-id="e26af-141">Application state</span></span>

<span data-ttu-id="e26af-142">L' `Application` objet dans le Web Forms Framework fournit un référentiel de requête massive pour interagir avec l’État et la configuration de l’étendue de l’application.</span><span class="sxs-lookup"><span data-stu-id="e26af-142">The `Application` object in the Web Forms framework provides a massive, cross-request repository for interacting with application-scope configuration and state.</span></span> <span data-ttu-id="e26af-143">L’état de l’application était idéal pour stocker diverses propriétés de configuration de l’application qui seraient référencées par toutes les demandes, quel que soit l’utilisateur qui a effectué la demande.</span><span class="sxs-lookup"><span data-stu-id="e26af-143">Application state was an ideal place to store various application configuration properties that would be referenced by all requests, regardless of the user making the request.</span></span> <span data-ttu-id="e26af-144">Le problème avec l' `Application` objet était que les données n’étaient pas conservées sur plusieurs serveurs.</span><span class="sxs-lookup"><span data-stu-id="e26af-144">The problem with the `Application` object was that data didn't persist across multiple servers.</span></span> <span data-ttu-id="e26af-145">L’état de l’objet d’application a été perdu entre les redémarrages.</span><span class="sxs-lookup"><span data-stu-id="e26af-145">The state of the application object was lost between restarts.</span></span>

<span data-ttu-id="e26af-146">Comme avec `Session` , il est recommandé de déplacer les données vers un magasin de stockage persistant accessible par plusieurs instances de serveur.</span><span class="sxs-lookup"><span data-stu-id="e26af-146">As with `Session`, it's recommended that data move to a persistent backing store that could be accessed by multiple server instances.</span></span> <span data-ttu-id="e26af-147">S’il existe des données volatiles auxquelles vous souhaitez pouvoir accéder entre les demandes et les utilisateurs, vous pouvez facilement les stocker dans un service singleton qui peut être injecté dans des composants qui requièrent ces informations ou cette interaction.</span><span class="sxs-lookup"><span data-stu-id="e26af-147">If there is volatile data that you would like to be able to access across requests and users, you could easily store it in a singleton service that can be injected into components that require this information or interaction.</span></span>

<span data-ttu-id="e26af-148">La construction d’un objet pour conserver l’état de l’application et sa consommation peuvent ressembler à l’implémentation suivante :</span><span class="sxs-lookup"><span data-stu-id="e26af-148">The construction of an object to maintain application state and its consumption could resemble the following implementation:</span></span>

```csharp
public class MyApplicationState
{
    public int VisitorCounter { get; private set; } = 0;

    public void IncrementCounter() => VisitorCounter += 1;
}
```

```csharp
app.AddSingleton<MyApplicationState>();
```

```razor
@inject MyApplicationState AppState

<label>Total Visitors: @AppState.VisitorCounter</label>
```

<span data-ttu-id="e26af-149">L' `MyApplicationState` objet n’est créé qu’une seule fois sur le serveur, et la valeur `VisitorCounter` est extraite et sortie dans l’étiquette du composant.</span><span class="sxs-lookup"><span data-stu-id="e26af-149">The `MyApplicationState` object is created only once on the server, and the value `VisitorCounter` is fetched and output in the component's label.</span></span> <span data-ttu-id="e26af-150">La `VisitorCounter` valeur doit être conservée et récupérée à partir d’un magasin de données de sauvegarde pour des fins de durabilité et d’évolutivité.</span><span class="sxs-lookup"><span data-stu-id="e26af-150">The `VisitorCounter` value should be persisted and retrieved from a backing data store for durability and scalability.</span></span>

## <a name="in-the-browser"></a><span data-ttu-id="e26af-151">Dans le navigateur</span><span class="sxs-lookup"><span data-stu-id="e26af-151">In the browser</span></span>

<span data-ttu-id="e26af-152">Les données d’application peuvent également être stockées côté client sur l’appareil de l’utilisateur afin d’être disponibles ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="e26af-152">Application data can also be stored client-side on the user's device so that is available later.</span></span> <span data-ttu-id="e26af-153">Il existe deux fonctionnalités de navigateur qui permettent la persistance des données dans différentes étendues du navigateur de l’utilisateur :</span><span class="sxs-lookup"><span data-stu-id="e26af-153">There are two browser features that allow for persistence of data in different scopes of the user's browser:</span></span>

- <span data-ttu-id="e26af-154">`localStorage` -étendue au navigateur entier de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e26af-154">`localStorage` - scoped to the user's entire browser.</span></span> <span data-ttu-id="e26af-155">Si la page est rechargée, le navigateur est fermé, rouvert, ou un autre onglet est ouvert avec la même URL, alors le même `localStorage` est fourni par le navigateur.</span><span class="sxs-lookup"><span data-stu-id="e26af-155">If the page is reloaded, the browser is closed and reopened, or another tab is opened with the same URL then the same `localStorage` is provided by the browser</span></span>
- <span data-ttu-id="e26af-156">`sessionStorage` -étendue à l’onglet de navigateur actuel de l’utilisateur. Si l’onglet est rechargé, l’état persiste.</span><span class="sxs-lookup"><span data-stu-id="e26af-156">`sessionStorage` - scoped to the user's current browser tab. If the tab is reloaded, the state persists.</span></span> <span data-ttu-id="e26af-157">Toutefois, si l’utilisateur ouvre un autre onglet pour votre application ou ferme et ouvre à nouveau le navigateur, l’État est perdu.</span><span class="sxs-lookup"><span data-stu-id="e26af-157">However, if the user opens another tab to your application or closes and reopens the browser the state is lost.</span></span>

<span data-ttu-id="e26af-158">Vous pouvez écrire du code JavaScript personnalisé pour interagir avec ces fonctionnalités, ou il existe un certain nombre de packages NuGet que vous pouvez utiliser pour fournir cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="e26af-158">You can write some custom JavaScript code to interact with these features, or there are a number of NuGet packages that you can use that provide this functionality.</span></span> <span data-ttu-id="e26af-159">L’un de ces packages est [Microsoft. AspNetCore. ProtectedBrowserStorage](https://www.nuget.org/packages/Microsoft.AspNetCore.ProtectedBrowserStorage).</span><span class="sxs-lookup"><span data-stu-id="e26af-159">One such package is [Microsoft.AspNetCore.ProtectedBrowserStorage](https://www.nuget.org/packages/Microsoft.AspNetCore.ProtectedBrowserStorage).</span></span>

<span data-ttu-id="e26af-160">Pour obtenir des instructions sur l’utilisation de ce package pour interagir avec `localStorage` et `sessionStorage` , consultez l’article sur la gestion de l' [État éblouissant](/aspnet/core/blazor/state-management#protected-browser-storage-experimental-package) .</span><span class="sxs-lookup"><span data-stu-id="e26af-160">For instructions on utilizing this package to interact with `localStorage` and `sessionStorage`, see the [Blazor State Management](/aspnet/core/blazor/state-management#protected-browser-storage-experimental-package) article.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="e26af-161">[Précédent](pages-routing-layouts.md) 
> [Suivant](forms-validation.md)</span><span class="sxs-lookup"><span data-stu-id="e26af-161">[Previous](pages-routing-layouts.md)
[Next](forms-validation.md)</span></span>

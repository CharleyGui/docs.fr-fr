---
title: Déploiement d’eShopOnContainers sur Azure
description: Déploiement de l’application eShopOnContainers à l’aide du service Azure Kubernetes, Helm et DevSpaces.
ms.date: 04/20/2020
ms.openlocfilehash: a3eacedac946cb25cf3cced305d7921e29f0d204
ms.sourcegitcommit: 957c49696eaf048c284ef8f9f8ffeb562357ad95
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/07/2020
ms.locfileid: "82895593"
---
# <a name="deploying-eshoponcontainers-to-azure"></a><span data-ttu-id="eecd3-103">Déploiement d’eShopOnContainers sur Azure</span><span class="sxs-lookup"><span data-stu-id="eecd3-103">Deploying eShopOnContainers to Azure</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="eecd3-104">L’application eShopOnContainers peut être déployée sur une variété de plateformes Azure.</span><span class="sxs-lookup"><span data-stu-id="eecd3-104">The eShopOnContainers application can be deployed to a variety of Azure platforms.</span></span> <span data-ttu-id="eecd3-105">L’approche recommandée consiste à déployer l’application sur Azure Kubernetes services (AKS).</span><span class="sxs-lookup"><span data-stu-id="eecd3-105">The recommended approach is to deploy the application to Azure Kubernetes Services (AKS).</span></span> <span data-ttu-id="eecd3-106">Helm, un outil de déploiement Kubernetes, est disponible pour réduire la complexité du déploiement.</span><span class="sxs-lookup"><span data-stu-id="eecd3-106">Helm, a Kubernetes deployment tool, is available to reduce deployment complexity.</span></span> <span data-ttu-id="eecd3-107">Si vous le souhaitez, les développeurs peuvent implémenter Azure Dev Spaces pour Kubernetes afin de simplifier leur processus de développement.</span><span class="sxs-lookup"><span data-stu-id="eecd3-107">Optionally, developers may implement Azure Dev Spaces for Kubernetes to streamline their development process.</span></span>

## <a name="azure-kubernetes-service"></a><span data-ttu-id="eecd3-108">Azure Kubernetes Service</span><span class="sxs-lookup"><span data-stu-id="eecd3-108">Azure Kubernetes Service</span></span>

<span data-ttu-id="eecd3-109">Pour héberger eShop dans AKS, la première étape consiste à créer un cluster AKS.</span><span class="sxs-lookup"><span data-stu-id="eecd3-109">To host eShop in AKS, the first step is to create an AKS cluster.</span></span> <span data-ttu-id="eecd3-110">Pour ce faire, vous pouvez utiliser le Portail Azure, qui vous guidera tout au long des étapes requises.</span><span class="sxs-lookup"><span data-stu-id="eecd3-110">To do so, you might use the Azure portal, which will walk you through the required steps.</span></span> <span data-ttu-id="eecd3-111">Vous pouvez également créer un cluster à partir de la Azure CLI, en veillant à activer la Access Control basée sur les rôles (RBAC) et le routage des applications.</span><span class="sxs-lookup"><span data-stu-id="eecd3-111">You could also create a cluster from the Azure CLI, taking care to enable Role-Based Access Control (RBAC) and application routing.</span></span> <span data-ttu-id="eecd3-112">La documentation de eShopOnContainers décrit les étapes de création de votre propre cluster AKS.</span><span class="sxs-lookup"><span data-stu-id="eecd3-112">The eShopOnContainers' documentation details the steps for creating your own AKS cluster.</span></span> <span data-ttu-id="eecd3-113">Une fois créé, vous pouvez accéder au cluster et le gérer à partir du tableau de bord Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="eecd3-113">Once created, you can access and manage the cluster from the Kubernetes dashboard.</span></span>

<span data-ttu-id="eecd3-114">Vous pouvez maintenant déployer l’application eShop sur le cluster en tirant parti de Helm et de la caisse.</span><span class="sxs-lookup"><span data-stu-id="eecd3-114">You can now deploy the eShop application to the cluster leveraging Helm and Tiller.</span></span>

## <a name="deploying-to-azure-kubernetes-service-using-helm"></a><span data-ttu-id="eecd3-115">Déploiement sur le service Azure Kubernetes à l’aide de Helm</span><span class="sxs-lookup"><span data-stu-id="eecd3-115">Deploying to Azure Kubernetes Service using Helm</span></span>

<span data-ttu-id="eecd3-116">Helm est un outil du gestionnaire de package d’application qui fonctionne directement avec Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="eecd3-116">Helm is an application package manager tool that works directly with Kubernetes.</span></span> <span data-ttu-id="eecd3-117">Il vous aide à définir, installer et mettre à niveau des applications Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="eecd3-117">It helps you define, install, and upgrade Kubernetes applications.</span></span> <span data-ttu-id="eecd3-118">Bien que les applications simples puissent être déployées sur AKS avec des scripts CLI personnalisés ou des fichiers de déploiement simples, les applications complexes peuvent contenir de nombreux objets Kubernetes et tirer parti de Helm.</span><span class="sxs-lookup"><span data-stu-id="eecd3-118">While simple apps can be deployed to AKS with custom CLI scripts or simple deployment files, complex apps can contain many Kubernetes objects and benefit from Helm.</span></span>

<span data-ttu-id="eecd3-119">À l’aide de Helm, les applications incluent des fichiers de configuration textuels, appelés graphiques Helm, qui décrivent de façon déclarative l’application et la configuration dans les packages Helm.</span><span class="sxs-lookup"><span data-stu-id="eecd3-119">Using Helm, applications include text-based configuration files, called Helm charts, which declaratively describe the application and configuration in Helm packages.</span></span> <span data-ttu-id="eecd3-120">Les graphiques utilisent des fichiers au format YAML standard pour décrire un ensemble connexe de ressources Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="eecd3-120">Charts use standard YAML-formatted files to describe a related set of Kubernetes resources.</span></span> <span data-ttu-id="eecd3-121">Elles sont gérées avec le code d’application qu’elles décrivent.</span><span class="sxs-lookup"><span data-stu-id="eecd3-121">They're versioned alongside the application code they describe.</span></span> <span data-ttu-id="eecd3-122">Les graphiques Helm vont du plus simple au plus complexe selon les exigences de l’installation qu’ils décrivent.</span><span class="sxs-lookup"><span data-stu-id="eecd3-122">Helm Charts range from simple to complex depending on the requirements of the installation they describe.</span></span>

<span data-ttu-id="eecd3-123">Helm se compose d’un outil client de ligne de commande, qui consomme des graphiques Helm et lance des commandes sur un composant serveur nommé, jusqu’à ce que le soit.</span><span class="sxs-lookup"><span data-stu-id="eecd3-123">Helm is composed of a command-line client tool, which consumes helm charts and launches commands to a server component named, Tiller.</span></span> <span data-ttu-id="eecd3-124">Jusqu’à la communication avec l’API Kubernetes pour garantir la bonne configuration de vos charges de travail en conteneur.</span><span class="sxs-lookup"><span data-stu-id="eecd3-124">Tiller communicates with the Kubernetes API to ensure the correct provisioning of your containerized workloads.</span></span> <span data-ttu-id="eecd3-125">Helm est géré par la Fondation Cloud-Native Computing.</span><span class="sxs-lookup"><span data-stu-id="eecd3-125">Helm is maintained by the Cloud-native Computing Foundation.</span></span>

<span data-ttu-id="eecd3-126">Le fichier YAML suivant présente un modèle Helm :</span><span class="sxs-lookup"><span data-stu-id="eecd3-126">The following yaml file presents a Helm template:</span></span>

```yaml
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.app.svc.marketing }}
  labels:
    app: {{ template "marketing-api.name" . }}
    chart: {{ template "marketing-api.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
spec:
  type: {{ .Values.service.type }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app: {{ template "marketing-api.name" . }}
    release: {{ .Release.Name }}
```

<span data-ttu-id="eecd3-127">Notez comment le modèle décrit un ensemble dynamique de paires clé/valeur.</span><span class="sxs-lookup"><span data-stu-id="eecd3-127">Note how the template describes a dynamic set of key/value pairs.</span></span> <span data-ttu-id="eecd3-128">Lorsque le modèle est appelé, les valeurs qui sont placées entre accolades sont extraites à partir d’autres fichiers de configuration basés sur YAML.</span><span class="sxs-lookup"><span data-stu-id="eecd3-128">When the template is invoked, values that enclosed in curly braces are pulled in from other yaml-based configuration files.</span></span>

<span data-ttu-id="eecd3-129">Vous trouverez les graphiques eShopOnContainers Helm dans le dossier/K8S/Helm.</span><span class="sxs-lookup"><span data-stu-id="eecd3-129">You'll find the eShopOnContainers helm charts in the /k8s/helm folder.</span></span> <span data-ttu-id="eecd3-130">La figure 2-6 montre comment les différents composants de l’application sont organisés dans une structure de dossiers utilisée par Helm pour définir et gérer des déploiements.</span><span class="sxs-lookup"><span data-stu-id="eecd3-130">Figure 2-6 shows how the different components of the application are organized into a folder structure used by helm to define and managed deployments.</span></span>

<span data-ttu-id="eecd3-131">![eShopOnContainers architecture](./media/eshoponcontainers-helm-folder.png)
de la**figure 2-6**.</span><span class="sxs-lookup"><span data-stu-id="eecd3-131">![eShopOnContainers Architecture](./media/eshoponcontainers-helm-folder.png)
**Figure 2-6**.</span></span> <span data-ttu-id="eecd3-132">Dossier eShopOnContainers Helm.</span><span class="sxs-lookup"><span data-stu-id="eecd3-132">The eShopOnContainers helm folder.</span></span>

<span data-ttu-id="eecd3-133">Chaque composant individuel est installé à l' `helm install` aide d’une commande.</span><span class="sxs-lookup"><span data-stu-id="eecd3-133">Each individual component is installed using a `helm install` command.</span></span> <span data-ttu-id="eecd3-134">eShop inclut un script « déployer tout » qui parcourt et installe les composants à l’aide de leurs graphiques Helm respectifs.</span><span class="sxs-lookup"><span data-stu-id="eecd3-134">eShop includes a "deploy all" script that loops through and installs the components using their respective helm charts.</span></span> <span data-ttu-id="eecd3-135">Le résultat est un processus reproductible, avec version avec l’application dans le contrôle de code source, que tous les membres de l’équipe peuvent déployer sur un cluster AKS à l’aide d’une commande de script d’une ligne.</span><span class="sxs-lookup"><span data-stu-id="eecd3-135">The result is a repeatable process, versioned with the application in source control, that anyone on the team can deploy to an AKS cluster with a one-line script command.</span></span>

> <span data-ttu-id="eecd3-136">Notez que la version 3 de Helm supprime officiellement le besoin du composant serveur de l’écran de veille.</span><span class="sxs-lookup"><span data-stu-id="eecd3-136">Note that version 3 of Helm officially removes the need for the Tiller server component.</span></span> <span data-ttu-id="eecd3-137">Vous trouverez plus d’informations sur cette amélioration [ici](https://medium.com/better-programming/why-is-tiller-missing-in-helm-3-2347c446714).</span><span class="sxs-lookup"><span data-stu-id="eecd3-137">More information on this enhancement can be found [here](https://medium.com/better-programming/why-is-tiller-missing-in-helm-3-2347c446714).</span></span>

## <a name="azure-dev-spaces"></a><span data-ttu-id="eecd3-138">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="eecd3-138">Azure Dev Spaces</span></span>

<span data-ttu-id="eecd3-139">Les applications Cloud natives peuvent rapidement devenir volumineuses et complexes, ce qui nécessite des ressources de calcul importantes pour s’exécuter.</span><span class="sxs-lookup"><span data-stu-id="eecd3-139">Cloud-native applications can quickly grow large and complex, requiring significant compute resources to run.</span></span> <span data-ttu-id="eecd3-140">Dans ces scénarios, l’ensemble de l’application ne peut pas être hébergé sur un ordinateur de développement (en particulier un ordinateur portable).</span><span class="sxs-lookup"><span data-stu-id="eecd3-140">In these scenarios, the entire application can't be hosted on a development machine (especially a laptop).</span></span> <span data-ttu-id="eecd3-141">Azure Dev Spaces est conçu pour résoudre ce problème à l’aide de AKS.</span><span class="sxs-lookup"><span data-stu-id="eecd3-141">Azure Dev Spaces is designed to address this problem using AKS.</span></span> <span data-ttu-id="eecd3-142">Il permet aux développeurs de travailler avec une version locale de leurs services tout en hébergeant le reste de l’application dans un cluster de développement AKS.</span><span class="sxs-lookup"><span data-stu-id="eecd3-142">It enables developers to work with a local version of their services while hosting the rest of the application in an AKS development cluster.</span></span>

<span data-ttu-id="eecd3-143">Les développeurs partagent une instance en cours d’exécution (développement) dans un cluster AKS qui contient l’application en conteneur entière.</span><span class="sxs-lookup"><span data-stu-id="eecd3-143">Developers share a running (development) instance in an AKS cluster that contains the entire containerized application.</span></span> <span data-ttu-id="eecd3-144">Mais ils utilisent des espaces personnels configurés sur leur ordinateur pour développer localement leurs services.</span><span class="sxs-lookup"><span data-stu-id="eecd3-144">But they use personal spaces set up on their machine to locally develop their services.</span></span> <span data-ttu-id="eecd3-145">Lorsqu’ils sont prêts, ils testent de bout en bout dans le cluster AKS, sans répliquer les dépendances.</span><span class="sxs-lookup"><span data-stu-id="eecd3-145">When ready, they test from end-to-end in the AKS cluster - without replicating dependencies.</span></span> <span data-ttu-id="eecd3-146">Azure Dev Spaces fusionne le code à partir de l’ordinateur local avec les services dans AKS.</span><span class="sxs-lookup"><span data-stu-id="eecd3-146">Azure Dev Spaces merges code from the local machine with services in AKS.</span></span> <span data-ttu-id="eecd3-147">Les membres de l’équipe peuvent voir comment leurs modifications se comporteront dans un environnement AKS réel.</span><span class="sxs-lookup"><span data-stu-id="eecd3-147">Team members can see how their changes will behave in a real AKS environment.</span></span> <span data-ttu-id="eecd3-148">Les développeurs peuvent rapidement itérer et déboguer du code directement dans Kubernetes à l’aide de Visual Studio 2017 ou Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="eecd3-148">Developers can rapidly iterate and debug code directly in Kubernetes using Visual Studio 2017 or Visual Studio Code.</span></span>

<span data-ttu-id="eecd3-149">Dans la figure 2-7, vous pouvez voir que Developer Julie a déployé une version mise à jour du microservice Bikes dans son espace de développement.</span><span class="sxs-lookup"><span data-stu-id="eecd3-149">In Figure 2-7, you can see that Developer Susie has deployed an updated version of the Bikes microservice into her dev space.</span></span> <span data-ttu-id="eecd3-150">Elle est ensuite en mesure de tester ses modifications à l’aide d’une URL personnalisée commençant par le nom de son espace (susie.s.dev.myapp.eus.azds.io).</span><span class="sxs-lookup"><span data-stu-id="eecd3-150">She's then able to test her changes using a custom URL starting with the name of her space (susie.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="eecd3-151">![eShopOnContainers architecture](./media/azure-devspaces-one.png)
de la**figure 2-7**.</span><span class="sxs-lookup"><span data-stu-id="eecd3-151">![eShopOnContainers Architecture](./media/azure-devspaces-one.png)
**Figure 2-7**.</span></span> <span data-ttu-id="eecd3-152">Developer Julie déploie sa propre version du microservice Bikes et le teste.</span><span class="sxs-lookup"><span data-stu-id="eecd3-152">Developer Susie deploys her own version of the Bikes microservice and tests it.</span></span>

<span data-ttu-id="eecd3-153">En même temps, le développeur John souhaite personnaliser le microservice de réservations et doit tester ses modifications.</span><span class="sxs-lookup"><span data-stu-id="eecd3-153">At the same time, developer John is customizing the Reservations microservice and needs to test his changes.</span></span> <span data-ttu-id="eecd3-154">Il déploie ses modifications dans son propre espace de développement sans entrer en conflit avec les modifications apportées à Julie, comme illustré dans la figure 2-8.</span><span class="sxs-lookup"><span data-stu-id="eecd3-154">He deploys his changes to his own dev space without conflicting with Susie's changes as shown in Figure 2-8.</span></span> <span data-ttu-id="eecd3-155">John teste ensuite ses modifications à l’aide de sa propre URL, précédée du nom de son espace (john.s.dev.myapp.eus.azds.io).</span><span class="sxs-lookup"><span data-stu-id="eecd3-155">John then tests his changes using his own URL that is prefixed with the name of his space (john.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="eecd3-156">![eShopOnContainers architecture](./media/azure-devspaces-two.png)
de la**figure 2-8**.</span><span class="sxs-lookup"><span data-stu-id="eecd3-156">![eShopOnContainers Architecture](./media/azure-devspaces-two.png)
**Figure 2-8**.</span></span> <span data-ttu-id="eecd3-157">Le développeur John déploie sa propre version du microservice de réservations et le teste sans conflit avec d’autres développeurs.</span><span class="sxs-lookup"><span data-stu-id="eecd3-157">Developer John deploys his own version of the Reservations microservice and tests it without conflicting with other developers.</span></span>

<span data-ttu-id="eecd3-158">À l’aide de Azure Dev Spaces, les équipes peuvent travailler directement avec AKS tout en modifiant, déployant et testant leurs modifications de manière indépendante.</span><span class="sxs-lookup"><span data-stu-id="eecd3-158">Using Azure Dev Spaces, teams can work directly with AKS while independently changing, deploying, and testing their changes.</span></span> <span data-ttu-id="eecd3-159">Cette approche réduit le besoin d’environnements hébergés dédiés distincts, car chaque développeur a son propre environnement AKS.</span><span class="sxs-lookup"><span data-stu-id="eecd3-159">This approach reduces the need for separate dedicated hosted environments since every developer effectively has their own AKS environment.</span></span> <span data-ttu-id="eecd3-160">Les développeurs peuvent travailler avec Azure Dev Spaces à l’aide de l’interface CLI ou lancer leur application pour Azure Dev Spaces directement à partir de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="eecd3-160">Developers can work with Azure Dev Spaces using its CLI or launch their application to Azure Dev Spaces directly from Visual Studio.</span></span> [<span data-ttu-id="eecd3-161">En savoir plus sur le fonctionnement de Azure Dev Spaces et sur la configuration.</span><span class="sxs-lookup"><span data-stu-id="eecd3-161">Learn more about how Azure Dev Spaces works and is configured.</span></span>](https://docs.microsoft.com/azure/dev-spaces/how-dev-spaces-works)

## <a name="azure-functions-and-logic-apps-serverless"></a><span data-ttu-id="eecd3-162">Azure Functions et Logic Apps (sans serveur)</span><span class="sxs-lookup"><span data-stu-id="eecd3-162">Azure Functions and Logic Apps (Serverless)</span></span>

<span data-ttu-id="eecd3-163">L’exemple eShopOnContainers comprend la prise en charge du suivi des campagnes marketing en ligne.</span><span class="sxs-lookup"><span data-stu-id="eecd3-163">The eShopOnContainers sample includes support for tracking online marketing campaigns.</span></span> <span data-ttu-id="eecd3-164">Une fonction Azure est utilisée pour suivre les détails d’une campagne marketing pour un ID de campagne donné.</span><span class="sxs-lookup"><span data-stu-id="eecd3-164">An Azure Function is used to track marketing campaign details for a given campaign ID.</span></span> <span data-ttu-id="eecd3-165">Au lieu de créer un microservice complet, une seule fonction Azure est plus simple et suffisante.</span><span class="sxs-lookup"><span data-stu-id="eecd3-165">Rather than creating a full microservice, a single Azure Function is simpler and sufficient.</span></span> <span data-ttu-id="eecd3-166">Azure Functions avoir un modèle de génération et de déploiement simple, surtout lorsqu’il est configuré pour s’exécuter dans Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="eecd3-166">Azure Functions have a simple build and deployment model, especially when configured to run in Kubernetes.</span></span> <span data-ttu-id="eecd3-167">Le déploiement de la fonction est un script à l’aide de modèles ARM (Azure Resource Manager) et du Azure CLI.</span><span class="sxs-lookup"><span data-stu-id="eecd3-167">Deploying the function is scripted using Azure Resource Manager (ARM) templates and the Azure CLI.</span></span> <span data-ttu-id="eecd3-168">Ce service de campagne n’est pas orienté client et appelle une seule opération, ce qui en fait un bon candidat pour Azure Functions.</span><span class="sxs-lookup"><span data-stu-id="eecd3-168">This campaign service isn't customer-facing and invokes a single operation, making it a great candidate for Azure Functions.</span></span> <span data-ttu-id="eecd3-169">La fonction nécessite une configuration minimale, y compris des données de chaîne de connexion à la base de données et des paramètres d’URI de base d’image.</span><span class="sxs-lookup"><span data-stu-id="eecd3-169">The function requires minimal configuration, including a database connection string data and image base URI settings.</span></span> <span data-ttu-id="eecd3-170">Vous configurez Azure Functions dans le Portail Azure.</span><span class="sxs-lookup"><span data-stu-id="eecd3-170">You configure Azure Functions in the Azure portal.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="eecd3-171">[Précédent](map-eshoponcontainers-azure-services.md)
>[suivant](centralized-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="eecd3-171">[Previous](map-eshoponcontainers-azure-services.md)
[Next](centralized-configuration.md)</span></span>

---
title: Configuration centralisée
description: Centralisation de la configuration des applications Cloud natives à l’aide de Azure App configuration et du coffre AzureKey.
ms.date: 05/13/2020
ms.openlocfilehash: d389d29dcdb1db5162d95370d181ab5a85d72dc8
ms.sourcegitcommit: 27db07ffb26f76912feefba7b884313547410db5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/19/2020
ms.locfileid: "83614225"
---
# <a name="centralized-configuration"></a><span data-ttu-id="ac16e-103">Configuration centralisée</span><span class="sxs-lookup"><span data-stu-id="ac16e-103">Centralized configuration</span></span>

<span data-ttu-id="ac16e-104">Contrairement à une application monolithique dans laquelle tous les éléments s’exécutent au sein d’une instance unique, une application Cloud Native se compose de services indépendants répartis sur des machines virtuelles, des conteneurs et des régions géographiques.</span><span class="sxs-lookup"><span data-stu-id="ac16e-104">Unlike a monolithic app in which everything runs within a single instance, a cloud-native application consists of independent services distributed across virtual machines, containers, and geographic regions.</span></span> <span data-ttu-id="ac16e-105">La gestion des paramètres de configuration pour des dizaines de services interdépendants peut être difficile.</span><span class="sxs-lookup"><span data-stu-id="ac16e-105">Managing configuration settings for dozens of interdependent services can be challenging.</span></span> <span data-ttu-id="ac16e-106">Les copies dupliquées des paramètres de configuration dans différents emplacements sont sujettes aux erreurs et difficiles à gérer.</span><span class="sxs-lookup"><span data-stu-id="ac16e-106">Duplicate copies of configuration settings across different locations is error prone and difficult to manage.</span></span> <span data-ttu-id="ac16e-107">La configuration centralisée est une condition essentielle pour les applications Cloud natives distribuées.</span><span class="sxs-lookup"><span data-stu-id="ac16e-107">Centralized configuration is a critical requirement for distributed cloud-native applications.</span></span>

<span data-ttu-id="ac16e-108">Comme indiqué dans le [Chapitre 1](introduction.md), les recommandations relatives aux applications à douze facteurs requièrent une séparation stricte entre le code et la configuration.</span><span class="sxs-lookup"><span data-stu-id="ac16e-108">As discussed in [Chapter 1](introduction.md), the Twelve-Factor App recommendations require strict separation between code and configuration.</span></span> <span data-ttu-id="ac16e-109">La configuration doit être stockée en externe à partir de l’application et lue en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="ac16e-109">Configuration must be stored externally from the application and read-in as needed.</span></span> <span data-ttu-id="ac16e-110">Le stockage des valeurs de configuration en tant que constantes ou valeurs littérales dans le code est une violation.</span><span class="sxs-lookup"><span data-stu-id="ac16e-110">Storing configuration values as constants or literal values in code is a violation.</span></span> <span data-ttu-id="ac16e-111">Les mêmes valeurs de configuration sont souvent utilisées par de nombreux services dans la même application.</span><span class="sxs-lookup"><span data-stu-id="ac16e-111">The same configuration values are often be used by many services in the same application.</span></span> <span data-ttu-id="ac16e-112">En outre, nous devons prendre en charge les mêmes valeurs dans plusieurs environnements, tels que le développement, les tests et la production.</span><span class="sxs-lookup"><span data-stu-id="ac16e-112">Additionally, we must support the same values across multiple environments, such as dev, testing, and production.</span></span> <span data-ttu-id="ac16e-113">La meilleure pratique consiste à les stocker dans un magasin de configuration centralisé.</span><span class="sxs-lookup"><span data-stu-id="ac16e-113">The best practice is store them in a centralized configuration store.</span></span>

<span data-ttu-id="ac16e-114">Le Cloud Azure présente plusieurs options intéressantes.</span><span class="sxs-lookup"><span data-stu-id="ac16e-114">The Azure cloud presents several great options.</span></span>

## <a name="azure-app-configuration"></a><span data-ttu-id="ac16e-115">Azure App Configuration</span><span class="sxs-lookup"><span data-stu-id="ac16e-115">Azure App Configuration</span></span>

<span data-ttu-id="ac16e-116">[Azure App configuration](https://docs.microsoft.com/azure/azure-app-configuration/overview) est un service Azure entièrement géré qui stocke les paramètres de configuration non-secret dans un emplacement centralisé et sécurisé.</span><span class="sxs-lookup"><span data-stu-id="ac16e-116">[Azure App Configuration](https://docs.microsoft.com/azure/azure-app-configuration/overview) is a fully managed Azure service that stores non-secret configuration settings in a secure, centralized location.</span></span> <span data-ttu-id="ac16e-117">Les valeurs stockées peuvent être partagées entre plusieurs services et applications.</span><span class="sxs-lookup"><span data-stu-id="ac16e-117">Stored values can be shared among multiple services and applications.</span></span>

<span data-ttu-id="ac16e-118">Le service est simple à utiliser et offre plusieurs avantages :</span><span class="sxs-lookup"><span data-stu-id="ac16e-118">The service is simple to use and provides several benefits:</span></span>

- <span data-ttu-id="ac16e-119">Représentations et mappages de clé/valeur flexibles</span><span class="sxs-lookup"><span data-stu-id="ac16e-119">Flexible key/value representations and mappings</span></span>
- <span data-ttu-id="ac16e-120">Balisage avec des étiquettes Azure</span><span class="sxs-lookup"><span data-stu-id="ac16e-120">Tagging with Azure labels</span></span>
- <span data-ttu-id="ac16e-121">Interface utilisateur dédiée pour la gestion</span><span class="sxs-lookup"><span data-stu-id="ac16e-121">Dedicated UI for management</span></span>
- <span data-ttu-id="ac16e-122">Chiffrement des informations sensibles</span><span class="sxs-lookup"><span data-stu-id="ac16e-122">Encryption of sensitive information</span></span>
- <span data-ttu-id="ac16e-123">Interrogation et récupération par lots</span><span class="sxs-lookup"><span data-stu-id="ac16e-123">Querying and batch retrieval</span></span>

<span data-ttu-id="ac16e-124">Azure App configuration conserve les modifications apportées aux paramètres de clé-valeur pendant sept jours.</span><span class="sxs-lookup"><span data-stu-id="ac16e-124">Azure App Configuration maintains changes made to key-value settings for seven days.</span></span> <span data-ttu-id="ac16e-125">La fonctionnalité d’instantané à un point dans le temps vous permet de reconstruire l’historique d’un paramètre et même de revenir en arrière pour un déploiement qui a échoué.</span><span class="sxs-lookup"><span data-stu-id="ac16e-125">The point-in-time snapshot feature enables you to reconstruct the history of a setting and even rollback for a failed deployment.</span></span>

<span data-ttu-id="ac16e-126">La configuration d’application met automatiquement en cache chaque paramètre pour éviter des appels excessifs au magasin de configurations.</span><span class="sxs-lookup"><span data-stu-id="ac16e-126">App Configuration automatically caches each setting to avoid excessive calls to the configuration store.</span></span> <span data-ttu-id="ac16e-127">L’opération d’actualisation attend que la valeur mise en cache d’un paramètre ait expiré avant de mettre ce dernier à jour, même si sa valeur change dans le magasin de configuration.</span><span class="sxs-lookup"><span data-stu-id="ac16e-127">The refresh operation waits until the cached value of a setting expires to update that setting, even when its value changes in the configuration store.</span></span> <span data-ttu-id="ac16e-128">Le délai d’expiration du cache par défaut est de 30 secondes.</span><span class="sxs-lookup"><span data-stu-id="ac16e-128">The default cache expiration time is 30 seconds.</span></span> <span data-ttu-id="ac16e-129">Vous pouvez remplacer le délai d’expiration.</span><span class="sxs-lookup"><span data-stu-id="ac16e-129">You can override the expiration time.</span></span>

<span data-ttu-id="ac16e-130">La configuration d’application chiffre toutes les valeurs de configuration en transit et au repos.</span><span class="sxs-lookup"><span data-stu-id="ac16e-130">App Configuration encrypts all configuration values in transit and at rest.</span></span> <span data-ttu-id="ac16e-131">Les noms de clés et les étiquettes sont utilisés comme index pour la récupération des données de configuration et ne sont pas chiffrés.</span><span class="sxs-lookup"><span data-stu-id="ac16e-131">Key names and labels are used as indexes for retrieving configuration data and aren't encrypted.</span></span>

<span data-ttu-id="ac16e-132">Bien que la configuration des applications offre une sécurité renforcée, Azure Key Vault est toujours le meilleur emplacement pour le stockage des secrets d’application.</span><span class="sxs-lookup"><span data-stu-id="ac16e-132">Although App Configuration provides hardened security, Azure Key Vault is still the best place for storing application secrets.</span></span> <span data-ttu-id="ac16e-133">Key Vault fournit un chiffrement au niveau matériel, des stratégies d’accès granulaires et des opérations de gestion telles que la rotation des certificats.</span><span class="sxs-lookup"><span data-stu-id="ac16e-133">Key Vault provides hardware-level encryption, granular access policies, and management operations such as certificate rotation.</span></span> <span data-ttu-id="ac16e-134">Vous pouvez créer des valeurs de configuration d’application qui font référence à des secrets stockés dans un Key Vault.</span><span class="sxs-lookup"><span data-stu-id="ac16e-134">You can create App Configuration values that reference secrets stored in a Key Vault.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="ac16e-135">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="ac16e-135">Azure Key Vault</span></span>

<span data-ttu-id="ac16e-136">Key Vault est un service géré pour stocker et accéder en toute sécurité aux secrets.</span><span class="sxs-lookup"><span data-stu-id="ac16e-136">Key Vault is a managed service for securely storing and accessing secrets.</span></span> <span data-ttu-id="ac16e-137">Un secret est un élément pour lequel vous voulez contrôler étroitement l’accès. Il peut s’agir de clés d’API, de mots de passe ou de certificats.</span><span class="sxs-lookup"><span data-stu-id="ac16e-137">A secret is anything that you want to tightly control access to, such as API keys, passwords, or certificates.</span></span> <span data-ttu-id="ac16e-138">Un coffre est un groupe logique de secrets.</span><span class="sxs-lookup"><span data-stu-id="ac16e-138">A vault is a logical group of secrets.</span></span>

<span data-ttu-id="ac16e-139">Key Vault réduit considérablement les risques de fuite accidentelle des secrets.</span><span class="sxs-lookup"><span data-stu-id="ac16e-139">Key Vault greatly reduces the chances that secrets may be accidentally leaked.</span></span> <span data-ttu-id="ac16e-140">Grâce à Key Vault, les développeurs d’applications n’ont plus besoin de stocker les informations de sécurité dans leur application.</span><span class="sxs-lookup"><span data-stu-id="ac16e-140">When using Key Vault, application developers no longer need to store security information in their application.</span></span> <span data-ttu-id="ac16e-141">Cette pratique élimine la nécessité de stocker ces informations dans votre code.</span><span class="sxs-lookup"><span data-stu-id="ac16e-141">This practice eliminates the need to store this information inside your code.</span></span> <span data-ttu-id="ac16e-142">Considérons l’exemple d’une application ayant besoin de se connecter à une base de données.</span><span class="sxs-lookup"><span data-stu-id="ac16e-142">For example, an application may need to connect to a database.</span></span> <span data-ttu-id="ac16e-143">Dans ce cas, plutôt que d’inclure la chaîne de connexion dans le code de l’application, vous pouvez simplement la stocker en toute sécurité dans Key Vault.</span><span class="sxs-lookup"><span data-stu-id="ac16e-143">Instead of storing the connection string in the app's code, you can store it securely in Key Vault.</span></span>

<span data-ttu-id="ac16e-144">Vos applications peuvent accéder en toute sécurité aux informations nécessaires en utilisant des URI.</span><span class="sxs-lookup"><span data-stu-id="ac16e-144">Your applications can securely access the information they need by using URIs.</span></span> <span data-ttu-id="ac16e-145">Ces URI permettent aux applications de récupérer des versions spécifiques d’un secret.</span><span class="sxs-lookup"><span data-stu-id="ac16e-145">These URIs allow the applications to retrieve specific versions of a secret.</span></span> <span data-ttu-id="ac16e-146">Il n’est pas nécessaire d’écrire du code personnalisé pour protéger les informations secrètes stockées dans Key Vault.</span><span class="sxs-lookup"><span data-stu-id="ac16e-146">There's no need to write custom code to protect any of the secret information stored in Key Vault.</span></span>

<span data-ttu-id="ac16e-147">L’accès à Key Vault nécessite une authentification et une autorisation appropriées de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="ac16e-147">Access to Key Vault requires proper caller authentication and authorization.</span></span> <span data-ttu-id="ac16e-148">En règle générale, chaque microservice Cloud natif utilise une combinaison ClientId/ClientSecret.</span><span class="sxs-lookup"><span data-stu-id="ac16e-148">Typically, each cloud-native microservice uses a ClientId/ClientSecret combination.</span></span> <span data-ttu-id="ac16e-149">Il est important de conserver ces informations d’identification en dehors du contrôle de code source.</span><span class="sxs-lookup"><span data-stu-id="ac16e-149">It's important to keep these credentials outside source control.</span></span> <span data-ttu-id="ac16e-150">Une bonne pratique consiste à les définir dans l’environnement de l’application.</span><span class="sxs-lookup"><span data-stu-id="ac16e-150">A best practice is to set them in  the application's environment.</span></span> <span data-ttu-id="ac16e-151">L’accès direct aux Key Vault à partir de AKS peut être obtenu à l’aide de [Key Vault FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol).</span><span class="sxs-lookup"><span data-stu-id="ac16e-151">Direct access to Key Vault from AKS can be achieved using [Key Vault FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol).</span></span>

## <a name="configuration-in-eshop"></a><span data-ttu-id="ac16e-152">Configuration dans eShop</span><span class="sxs-lookup"><span data-stu-id="ac16e-152">Configuration in eShop</span></span>

<span data-ttu-id="ac16e-153">L’application eShopOnContainers comprend des fichiers de paramètres d’application locaux avec chaque microservice.</span><span class="sxs-lookup"><span data-stu-id="ac16e-153">The eShopOnContainers application includes local application settings files with each microservice.</span></span> <span data-ttu-id="ac16e-154">Ces fichiers sont archivés dans le contrôle de code source, mais n’incluent pas les secrets de production tels que les chaînes de connexion ou les clés API.</span><span class="sxs-lookup"><span data-stu-id="ac16e-154">These files are checked into source control, but don't include production secrets such as connection strings or API keys.</span></span> <span data-ttu-id="ac16e-155">En production, des paramètres individuels peuvent être remplacés par des variables d’environnement par service.</span><span class="sxs-lookup"><span data-stu-id="ac16e-155">In production, individual settings may be overwritten with per-service environment variables.</span></span> <span data-ttu-id="ac16e-156">L’injection de secrets dans les variables d’environnement est une pratique courante pour les applications hébergées, mais elle ne fournit pas de magasin de configuration centralisé.</span><span class="sxs-lookup"><span data-stu-id="ac16e-156">Injecting secrets in environment variables is a common practice for hosted applications, but doesn't provide a central configuration store.</span></span> <span data-ttu-id="ac16e-157">Pour prendre en charge la gestion centralisée des paramètres de configuration, chaque microservice comprend un paramètre permettant de basculer entre l’utilisation des paramètres locaux et des paramètres de Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="ac16e-157">To support centralized management of configuration settings, each microservice includes a setting to toggle between its use of local settings or Azure Key Vault settings.</span></span>

## <a name="references"></a><span data-ttu-id="ac16e-158">References</span><span class="sxs-lookup"><span data-stu-id="ac16e-158">References</span></span>

- [<span data-ttu-id="ac16e-159">Architecture eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="ac16e-159">The eShopOnContainers Architecture</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Architecture)
- [<span data-ttu-id="ac16e-160">Orchestration des microservices et des applications à plusieurs conteneurs pour une grande scalabilité et une haute disponibilité</span><span class="sxs-lookup"><span data-stu-id="ac16e-160">Orchestrating microservices and multi-container applications for high scalability and availability</span></span>](https://docs.microsoft.com/dotnet/architecture/microservices/architect-microservice-container-applications/scalable-available-multi-container-microservice-applications)
- [<span data-ttu-id="ac16e-161">Gestion des API Azure</span><span class="sxs-lookup"><span data-stu-id="ac16e-161">Azure API Management</span></span>](https://docs.microsoft.com/azure/api-management/api-management-key-concepts)
- [<span data-ttu-id="ac16e-162">Présentation de Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="ac16e-162">Azure SQL Database Overview</span></span>](https://docs.microsoft.com/azure/sql-database/sql-database-technical-overview)
- [<span data-ttu-id="ac16e-163">Cache Azure pour Redis</span><span class="sxs-lookup"><span data-stu-id="ac16e-163">Azure Cache for Redis</span></span>](https://azure.microsoft.com/services/cache/)
- [<span data-ttu-id="ac16e-164">API pour MongoDB d’Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="ac16e-164">Azure Cosmos DB's API for MongoDB</span></span>](https://docs.microsoft.com/azure/cosmos-db/mongodb-introduction)
- [<span data-ttu-id="ac16e-165">Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="ac16e-165">Azure Service Bus</span></span>](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview)
- [<span data-ttu-id="ac16e-166">Vue d’ensemble d’Azure Monitor</span><span class="sxs-lookup"><span data-stu-id="ac16e-166">Azure Monitor overview</span></span>](https://docs.microsoft.com/azure/azure-monitor/overview)
- <span data-ttu-id="ac16e-167">[eShopOnContainers : créer un cluster Kubernetes dans AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span><span class="sxs-lookup"><span data-stu-id="ac16e-167">[eShopOnContainers: Create Kubernetes cluster in AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span></span>
- [<span data-ttu-id="ac16e-168">eShopOnContainers : Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="ac16e-168">eShopOnContainers: Azure Dev Spaces</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Azure-Dev-Spaces)
- [<span data-ttu-id="ac16e-169">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="ac16e-169">Azure Dev Spaces</span></span>](https://docs.microsoft.com/azure/dev-spaces/about)

>[!div class="step-by-step"]
><span data-ttu-id="ac16e-170">[Précédent](deploy-eshoponcontainers-azure.md) 
> [Suivant](scale-applications.md)</span><span class="sxs-lookup"><span data-stu-id="ac16e-170">[Previous](deploy-eshoponcontainers-azure.md)
[Next](scale-applications.md)</span></span>

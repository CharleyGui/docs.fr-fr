---
title: Communication résiliente
description: Architecture des applications .NET natives Cloud pour Azure | Communication résiliente
ms.date: 06/30/2019
ms.openlocfilehash: 324f5426af1c892db73aa6fc2336a19b7a8e499e
ms.sourcegitcommit: 628e8147ca10187488e6407dab4c4e6ebe0cac47
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/15/2019
ms.locfileid: "72315802"
---
# <a name="resilient-communications"></a><span data-ttu-id="e51d2-103">Communications résilientes</span><span class="sxs-lookup"><span data-stu-id="e51d2-103">Resilient communications</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="e51d2-104">Tout au long de ce document, nous avons regroupé les mérites d’aller au-delà de la conception d’applications monolithiques traditionnelles et d’adopter une architecture basée sur des microservices où un ensemble de services distribués et autonomes s’exécutent de manière indépendante et communiquent avec chacun autre utilisation de protocoles de communication standard tels que HTTP et HTTPs.</span><span class="sxs-lookup"><span data-stu-id="e51d2-104">Throughout this book, we've evangelized the merits of moving beyond traditional monolithic application design and embracing a microservice-based architecture where a set of distributed, self-contained services run independently and communicate with each other using standard communication protocols such as HTTP and HTTPS.</span></span> <span data-ttu-id="e51d2-105">Bien qu’une telle architecture achète de nombreux avantages importants, elle présente également de nombreux défis.</span><span class="sxs-lookup"><span data-stu-id="e51d2-105">While such an architecture buys you many important benefits, it also presents many challenges.</span></span> <span data-ttu-id="e51d2-106">Prenez par exemple en compte les problèmes suivants :</span><span class="sxs-lookup"><span data-stu-id="e51d2-106">Consider, for example, the following concerns:</span></span>

- <span data-ttu-id="e51d2-107">*Communication réseau hors processus.*</span><span class="sxs-lookup"><span data-stu-id="e51d2-107">*Out-of-process network communication.*</span></span> <span data-ttu-id="e51d2-108">Chaque service communique sur un protocole réseau qui introduit une congestion du réseau, une latence et des erreurs temporaires.</span><span class="sxs-lookup"><span data-stu-id="e51d2-108">Each service communicates over a network protocol that introduces network congestion, latency, and transient faults.</span></span>
- <span data-ttu-id="e51d2-109">*Détection du service.*</span><span class="sxs-lookup"><span data-stu-id="e51d2-109">*Service discovery.*</span></span> <span data-ttu-id="e51d2-110">Chaque service s’exécutant sur un cluster de machines avec sa propre adresse IP et son propre port, comment les services découvrent et communiquent les uns avec les autres ?</span><span class="sxs-lookup"><span data-stu-id="e51d2-110">With each service running across a cluster of machines with its own IP address and port, how do services discover and communicate with each other?</span></span>
- <span data-ttu-id="e51d2-111">*Résilience.*</span><span class="sxs-lookup"><span data-stu-id="e51d2-111">*Resiliency.*</span></span> <span data-ttu-id="e51d2-112">Comment gérer les défaillances de courte durée de vie et assurer la stabilité du système ?</span><span class="sxs-lookup"><span data-stu-id="e51d2-112">How do you manage short-lived failures and keep the system stable?</span></span>
- <span data-ttu-id="e51d2-113">*Équilibrage de charge.*</span><span class="sxs-lookup"><span data-stu-id="e51d2-113">*Load balancing.*</span></span> <span data-ttu-id="e51d2-114">Comment le trafic entrant est-il distribué entre plusieurs instances d’un service ?</span><span class="sxs-lookup"><span data-stu-id="e51d2-114">How does inbound traffic get distributed across multiple instances of a service?</span></span>
- <span data-ttu-id="e51d2-115">*Sécurité* :</span><span class="sxs-lookup"><span data-stu-id="e51d2-115">*Security.*</span></span> <span data-ttu-id="e51d2-116">Comment les problèmes de sécurité tels que le chiffrement au niveau du transport et la gestion des certificats sont-ils appliqués ?</span><span class="sxs-lookup"><span data-stu-id="e51d2-116">How are security concerns such as transport-level encryption and certificate management enforced?</span></span>
- <span data-ttu-id="e51d2-117">*Analyse distribuée.*</span><span class="sxs-lookup"><span data-stu-id="e51d2-117">*Distributed Monitoring.*</span></span> <span data-ttu-id="e51d2-118">-Comment mettre en corrélation et capturer la traçabilité et la surveillance d’une seule requête sur plusieurs services de consommation ?</span><span class="sxs-lookup"><span data-stu-id="e51d2-118">- How do you correlate and capture traceability and monitoring for a single request across multiple consuming services?</span></span>

<span data-ttu-id="e51d2-119">Bien que ces problèmes puissent être résolus avec différentes bibliothèques et frameworks, leur mise en œuvre dans votre base de code peut s’avérer coûteuse, complexe et fastidieuse.</span><span class="sxs-lookup"><span data-stu-id="e51d2-119">While these concerns can be addressed with various libraries and frameworks, implementing them inside your codebase can be expensive, complex, and time-consuming.</span></span> <span data-ttu-id="e51d2-120">En outre, vous vous retrouvez avec une solution dans laquelle les problèmes d’infrastructure sont associés à la logique métier.</span><span class="sxs-lookup"><span data-stu-id="e51d2-120">Moreover, you end up with a solution where infrastructure concerns are coupled to business logic.</span></span>

## <a name="service-mesh"></a><span data-ttu-id="e51d2-121">Maille de service</span><span class="sxs-lookup"><span data-stu-id="e51d2-121">Service mesh</span></span>

<span data-ttu-id="e51d2-122">Une meilleure approche consiste à prendre en compte une technologie nouvelle et évoluant rapidement, intitulée *service Mesh*.</span><span class="sxs-lookup"><span data-stu-id="e51d2-122">A better approach is to consider a new and rapidly evolving technology entitled *Service Mesh*.</span></span> <span data-ttu-id="e51d2-123">Une [maille de service](https://www.nginx.com/blog/what-is-a-service-mesh/) est une couche d’infrastructure configurable avec des fonctionnalités intégrées permettant de gérer la communication de service et de nombreuses difficultés mentionnées ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="e51d2-123">A [service mesh](https://www.nginx.com/blog/what-is-a-service-mesh/) is a configurable infrastructure layer with built-in capabilities to handle service communication and many of the challenges mentioned above.</span></span> <span data-ttu-id="e51d2-124">Il dissocie ces problèmes de votre code d’entreprise et les déplace dans un proxy de service, une instance de qui accompagne chacun de vos services.</span><span class="sxs-lookup"><span data-stu-id="e51d2-124">It decouples these concerns from your business code and moves them into a service proxy, an instance of which accompanies each of your services.</span></span> <span data-ttu-id="e51d2-125">Souvent appelé [modèle de side-car](https://docs.microsoft.com/azure/architecture/patterns/sidecar), le proxy de maille de service est déployé dans un processus distinct pour assurer l’isolation et l’encapsulation à partir de votre code d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="e51d2-125">Often referred to as the [Sidecar pattern](https://docs.microsoft.com/azure/architecture/patterns/sidecar), the service mesh proxy is deployed into a separate process to provide isolation and encapsulation from your business code.</span></span> <span data-ttu-id="e51d2-126">Toutefois, le proxy est étroitement lié au service en cours de création, ainsi qu’au partage de son cycle de vie.</span><span class="sxs-lookup"><span data-stu-id="e51d2-126">However, the proxy is closely linked to the service being created along with it and sharing its lifecycle.</span></span> <span data-ttu-id="e51d2-127">La figure 6-9 illustre ce scénario.</span><span class="sxs-lookup"><span data-stu-id="e51d2-127">Figure 6-9 shows this scenario.</span></span>

![Maille de service avec une voiture latérale](./media/service-mesh-with-side-car.png)

<span data-ttu-id="e51d2-129">**Figure 6-9.**</span><span class="sxs-lookup"><span data-stu-id="e51d2-129">**Figure 6-9**.</span></span> <span data-ttu-id="e51d2-130">Maille de service avec une voiture latérale</span><span class="sxs-lookup"><span data-stu-id="e51d2-130">Service mesh with a side car</span></span>

<span data-ttu-id="e51d2-131">Dans la figure précédente, Notez comment le proxy intercepte et gère la communication entre les microservices et le cluster.</span><span class="sxs-lookup"><span data-stu-id="e51d2-131">In the previous figure, note how the proxy intercepts and manages communication among the microservices and the cluster.</span></span>

<span data-ttu-id="e51d2-132">Un maillage de service est logiquement divisé en deux composants disparates : un [plan de données](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc) et un [plan de contrôle](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc).</span><span class="sxs-lookup"><span data-stu-id="e51d2-132">A service mesh is logically split into two disparate components: A [data plane](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc) and [control plane](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc).</span></span> <span data-ttu-id="e51d2-133">La figure 6-10 montre ces composants et leurs responsabilités.</span><span class="sxs-lookup"><span data-stu-id="e51d2-133">Figure 6-10 shows these components and their responsibilities.</span></span>

![Contrôle de maillage de service et plan de données](./media/istio-control-and-data-plane.png)

<span data-ttu-id="e51d2-135">**Figure 6-10.**</span><span class="sxs-lookup"><span data-stu-id="e51d2-135">**Figure 6-10.**</span></span> <span data-ttu-id="e51d2-136">Contrôle de maillage de service et plan de données</span><span class="sxs-lookup"><span data-stu-id="e51d2-136">Service mesh control and data plane</span></span>

<span data-ttu-id="e51d2-137">Une fois configuré, un maillage de service est très fonctionnel.</span><span class="sxs-lookup"><span data-stu-id="e51d2-137">Once configured, a service mesh is highly functional.</span></span> <span data-ttu-id="e51d2-138">Il peut récupérer un pool d’instances correspondant à partir d’un point de terminaison de découverte de service.</span><span class="sxs-lookup"><span data-stu-id="e51d2-138">It can retrieve a corresponding pool of instances from a service discovery endpoint.</span></span> <span data-ttu-id="e51d2-139">Il peut ensuite envoyer une requête à une instance spécifique, en enregistrant la latence et le type de réponse du résultat.</span><span class="sxs-lookup"><span data-stu-id="e51d2-139">It can then send a request to a specific instance, recording the latency and response type of the result.</span></span> <span data-ttu-id="e51d2-140">Une maille peut choisir l’instance la plus susceptible de retourner une réponse rapide en fonction de nombreux facteurs, y compris la latence observée pour les demandes récentes.</span><span class="sxs-lookup"><span data-stu-id="e51d2-140">A mesh can choose the instance most likely to return a fast response based on many factors, including its observed latency for recent requests.</span></span>

<span data-ttu-id="e51d2-141">Si une instance ne répond pas ou échoue, la maille peut retenter la demande sur une autre instance.</span><span class="sxs-lookup"><span data-stu-id="e51d2-141">If an instance is unresponsive or fails, the mesh can retry the request on another instance.</span></span> <span data-ttu-id="e51d2-142">Si un pool retourne des erreurs de manière cohérente, un maillage peut le supprimer du pool d’équilibrage de charge pour qu’il soit retenté régulièrement après sa réparation.</span><span class="sxs-lookup"><span data-stu-id="e51d2-142">If a pool consistently returns errors, a mesh can evict it from the load-balancing pool to be retried periodically later after it heals.</span></span> <span data-ttu-id="e51d2-143">Si une demande expire, une maille peut échouer, puis retenter la demande.</span><span class="sxs-lookup"><span data-stu-id="e51d2-143">If a request times out, a mesh can fail and then retry the request.</span></span> <span data-ttu-id="e51d2-144">Une maille capture le comportement sous forme de métriques et de traçage distribué, qui peut ensuite être émis vers un système de mesures centralisé.</span><span class="sxs-lookup"><span data-stu-id="e51d2-144">A mesh captures behavior in the form of metrics and distributed tracing, which then can be emitted to a centralized metrics system.</span></span>

## <a name="istio-and-envoy"></a><span data-ttu-id="e51d2-145">Istio et Envoy</span><span class="sxs-lookup"><span data-stu-id="e51d2-145">Istio and Envoy</span></span>

<span data-ttu-id="e51d2-146">Bien qu’il existe actuellement quelques options de maillage de service, [Istio](https://istio.io/docs/concepts/what-is-istio/) est le plus populaire au moment de la rédaction de cet article.</span><span class="sxs-lookup"><span data-stu-id="e51d2-146">While a few service mesh options currently exist, [Istio](https://istio.io/docs/concepts/what-is-istio/) is the most popular as of the time of this writing.</span></span> <span data-ttu-id="e51d2-147">Une entreprise conjointe d’IBM, Google et LYFT, il s’agit d’une offre Open source qui peut être intégrée dans une application distribuée nouvelle ou existante.</span><span class="sxs-lookup"><span data-stu-id="e51d2-147">A joint venture from IBM, Google, and Lyft, it's an open-source offering that can be integrated into a new or existing distributed application.</span></span> <span data-ttu-id="e51d2-148">Il fournit une solution cohérente et complète pour sécuriser, connecter et surveiller les microservices.</span><span class="sxs-lookup"><span data-stu-id="e51d2-148">It provides a consistent and complete solution to secure, connect, and monitor microservices.</span></span> <span data-ttu-id="e51d2-149">Ses fonctionnalités sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="e51d2-149">Its features include:</span></span>

- <span data-ttu-id="e51d2-150">Sécuriser les communications de service à service dans un cluster avec une authentification et une autorisation puissantes basées sur l’identité.</span><span class="sxs-lookup"><span data-stu-id="e51d2-150">Secure service-to-service communication in a cluster with strong identity-based authentication and authorization.</span></span>
- <span data-ttu-id="e51d2-151">Équilibrage de charge automatique pour le trafic HTTP, [gRPC](https://grpc.io/), WebSocket et TCP.</span><span class="sxs-lookup"><span data-stu-id="e51d2-151">Automatic load balancing for HTTP, [gRPC](https://grpc.io/), WebSocket, and TCP traffic.</span></span>
- <span data-ttu-id="e51d2-152">Contrôle affiné du comportement du trafic avec des règles de routage riches, des nouvelles tentatives, des basculements et une injection d’erreurs.</span><span class="sxs-lookup"><span data-stu-id="e51d2-152">Fine-grained control of traffic behavior with rich routing rules, retries, failovers, and fault injection.</span></span>
- <span data-ttu-id="e51d2-153">Une couche de stratégie enfichable et une API de configuration prennent en charge les contrôles d’accès, les limites de taux et les quotas.</span><span class="sxs-lookup"><span data-stu-id="e51d2-153">A pluggable policy layer and configuration API supporting access controls, rate limits, and quotas.</span></span>
- <span data-ttu-id="e51d2-154">Mesures automatiques, journaux et traces pour tout le trafic au sein d’un cluster, y compris l’entrée et la sortie du cluster.</span><span class="sxs-lookup"><span data-stu-id="e51d2-154">Automatic metrics, logs, and traces for all traffic within a cluster, including cluster ingress and egress.</span></span>

<span data-ttu-id="e51d2-155">Un composant clé pour une implémentation de Istio est un service proxy ayant le [proxy Envoy](https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy).</span><span class="sxs-lookup"><span data-stu-id="e51d2-155">A key component for an Istio implementation is a proxy service entitled the [Envoy proxy](https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy).</span></span> <span data-ttu-id="e51d2-156">En provenance de LYFT et par la suite contribué à la [Fondation Cloud Native Computing](https://www.cncf.io/) (décrite dans le chapitre 1), le proxy Envoy s’exécute à côté de chaque service et fournit une base de plateforme agnostique pour les fonctionnalités suivantes :</span><span class="sxs-lookup"><span data-stu-id="e51d2-156">Originating from Lyft and subsequently contributed to the [Cloud Native Computing Foundation](https://www.cncf.io/) (discussed in chapter 1), the Envoy proxy runs alongside each service and provides a platform-agnostic foundation for the following features:</span></span>

- <span data-ttu-id="e51d2-157">Découverte de service dynamique.</span><span class="sxs-lookup"><span data-stu-id="e51d2-157">Dynamic service discovery.</span></span>
- <span data-ttu-id="e51d2-158">Équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="e51d2-158">Load balancing.</span></span>
- <span data-ttu-id="e51d2-159">Arrêt TLS.</span><span class="sxs-lookup"><span data-stu-id="e51d2-159">TLS termination.</span></span>
- <span data-ttu-id="e51d2-160">Proxys HTTP et gRPC.</span><span class="sxs-lookup"><span data-stu-id="e51d2-160">HTTP and gRPC proxies.</span></span>
- <span data-ttu-id="e51d2-161">Résilience de disjoncteur.</span><span class="sxs-lookup"><span data-stu-id="e51d2-161">Circuit breaker resiliency.</span></span>
- <span data-ttu-id="e51d2-162">Contrôles d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="e51d2-162">Health checks.</span></span>
- <span data-ttu-id="e51d2-163">Mises à jour propagées avec des déploiements de [Canaries](https://martinfowler.com/bliki/CanaryRelease.html) .</span><span class="sxs-lookup"><span data-stu-id="e51d2-163">Rolling updates with [canary](https://martinfowler.com/bliki/CanaryRelease.html) deployments.</span></span>

<span data-ttu-id="e51d2-164">Comme indiqué précédemment, Envoy est déployé en tant que side-car pour chaque microservice du cluster.</span><span class="sxs-lookup"><span data-stu-id="e51d2-164">As previously discussed, Envoy is deployed as a sidecar to each microservice in the cluster.</span></span>

## <a name="integration-with-azure-kubernetes-services"></a><span data-ttu-id="e51d2-165">Intégration avec les services Azure Kubernetes</span><span class="sxs-lookup"><span data-stu-id="e51d2-165">Integration with Azure Kubernetes Services</span></span>

<span data-ttu-id="e51d2-166">Le Cloud Azure prend en charge Istio et fournit un support direct pour celui-ci dans les services Azure Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="e51d2-166">The Azure cloud embraces Istio and provides direct support for it within Azure Kubernetes Services.</span></span> <span data-ttu-id="e51d2-167">Les liens suivants peuvent vous aider à vous lancer :</span><span class="sxs-lookup"><span data-stu-id="e51d2-167">The following links can help you get started:</span></span>

- [<span data-ttu-id="e51d2-168">Installation de Istio dans AKS</span><span class="sxs-lookup"><span data-stu-id="e51d2-168">Installing Istio in AKS</span></span>](https://docs.microsoft.com/azure/aks/istio-install)
- [<span data-ttu-id="e51d2-169">Utilisation de AKS et Istio</span><span class="sxs-lookup"><span data-stu-id="e51d2-169">Using AKS and Istio</span></span>](https://docs.microsoft.com/azure/aks/istio-scenario-routing)

>[!div class="step-by-step"]
><span data-ttu-id="e51d2-170">[Précédent](infrastructure-resiliency-azure.md)
>[Suivant](monitoring-health.md)</span><span class="sxs-lookup"><span data-stu-id="e51d2-170">[Previous](infrastructure-resiliency-azure.md)
[Next](monitoring-health.md)</span></span>

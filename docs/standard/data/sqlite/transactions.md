---
title: Transactions
ms.date: 09/08/2020
description: Découvrez comment utiliser des transactions.
ms.openlocfilehash: 50c4cd1023eac892cafc3ae4395e9168bd8e9f36
ms.sourcegitcommit: aa6d8a90a4f5d8fe0f6e967980b8c98433f05a44
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2020
ms.locfileid: "90678860"
---
# <a name="transactions"></a><span data-ttu-id="80bf1-103">Transactions</span><span class="sxs-lookup"><span data-stu-id="80bf1-103">Transactions</span></span>

<span data-ttu-id="80bf1-104">Les transactions vous permettent de regrouper plusieurs instructions SQL en une seule unité de travail qui est validée dans la base de données comme une seule unité atomique.</span><span class="sxs-lookup"><span data-stu-id="80bf1-104">Transactions let you group multiple SQL statements into a single unit of work that is committed to the database as one atomic unit.</span></span> <span data-ttu-id="80bf1-105">Si une instruction de la transaction échoue, les modifications apportées par les instructions précédentes peuvent être annulées.</span><span class="sxs-lookup"><span data-stu-id="80bf1-105">If any statement in the transaction fails, changes made by the previous statements can be rolled back.</span></span> <span data-ttu-id="80bf1-106">L’état initial de la base de données au moment du démarrage de la transaction est préservé.</span><span class="sxs-lookup"><span data-stu-id="80bf1-106">The initial state of the database when the transaction was started is preserved.</span></span> <span data-ttu-id="80bf1-107">L’utilisation d’une transaction peut également améliorer les performances sur SQLite lorsque de nombreuses modifications sont apportées à la base de données en même temps.</span><span class="sxs-lookup"><span data-stu-id="80bf1-107">Using a transaction can also improve performance on SQLite when making numerous changes to the database at once.</span></span>

## <a name="concurrency"></a><span data-ttu-id="80bf1-108">Accès concurrentiel</span><span class="sxs-lookup"><span data-stu-id="80bf1-108">Concurrency</span></span>

<span data-ttu-id="80bf1-109">Dans SQLite, une seule transaction peut avoir des modifications en attente dans la base de données à la fois.</span><span class="sxs-lookup"><span data-stu-id="80bf1-109">In SQLite, only one transaction is allowed to have changes pending in the database at a time.</span></span> <span data-ttu-id="80bf1-110">Pour cette raison, les appels à <xref:Microsoft.Data.Sqlite.SqliteConnection.BeginTransaction%2A> et aux `Execute` méthodes sur <xref:Microsoft.Data.Sqlite.SqliteCommand> peuvent expirer si une autre transaction prend trop de temps pour s’exécuter.</span><span class="sxs-lookup"><span data-stu-id="80bf1-110">Because of this, calls to <xref:Microsoft.Data.Sqlite.SqliteConnection.BeginTransaction%2A> and the `Execute` methods on <xref:Microsoft.Data.Sqlite.SqliteCommand> may time out if another transaction takes too long to complete.</span></span>

<span data-ttu-id="80bf1-111">Pour plus d’informations sur le verrouillage, les nouvelles tentatives et les délais d’attente, consultez [Erreurs de base de données](database-errors.md).</span><span class="sxs-lookup"><span data-stu-id="80bf1-111">For more information about locking, retries, and timeouts, see [Database errors](database-errors.md).</span></span>

## <a name="isolation-levels"></a><span data-ttu-id="80bf1-112">Niveaux d'isolement</span><span class="sxs-lookup"><span data-stu-id="80bf1-112">Isolation levels</span></span>

<span data-ttu-id="80bf1-113">Les transactions sont **sérialisables** par défaut dans sqlite.</span><span class="sxs-lookup"><span data-stu-id="80bf1-113">Transactions are **serializable** by default in SQLite.</span></span> <span data-ttu-id="80bf1-114">Ce niveau d’isolation garantit que toutes les modifications apportées dans une transaction sont complètement isolées.</span><span class="sxs-lookup"><span data-stu-id="80bf1-114">This isolation level guarantees that any changes made within a transaction are completely isolated.</span></span> <span data-ttu-id="80bf1-115">Les autres instructions exécutées en dehors de la transaction ne sont pas affectées par les modifications de la transaction.</span><span class="sxs-lookup"><span data-stu-id="80bf1-115">Other statements executed outside of the transaction aren't affected by the transaction's changes.</span></span>

<span data-ttu-id="80bf1-116">SQLite prend également en charge la **lecture non validée** lors de l’utilisation d’un cache partagé.</span><span class="sxs-lookup"><span data-stu-id="80bf1-116">SQLite also supports **read uncommitted** when using a shared cache.</span></span> <span data-ttu-id="80bf1-117">Ce niveau autorise les lectures erronées, les lectures non reproductibles et les fantômes :</span><span class="sxs-lookup"><span data-stu-id="80bf1-117">This level allows dirty reads, nonrepeatable reads, and phantoms:</span></span>

- <span data-ttu-id="80bf1-118">Une *lecture incorrecte* se produit lorsque des modifications en attente dans une transaction sont retournées par une requête en dehors de la transaction, mais que les modifications de la transaction sont annulées.</span><span class="sxs-lookup"><span data-stu-id="80bf1-118">A *dirty read* occurs when changes pending in one transaction are returned by a query outside of the transaction, but the changes in the transaction are rolled back.</span></span> <span data-ttu-id="80bf1-119">Les résultats contiennent des données qui n’ont jamais été réellement validées dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="80bf1-119">The results contain data that was never actually committed to the database.</span></span>

- <span data-ttu-id="80bf1-120">Une *lecture non renouvelable* se produit lorsqu’une transaction interroge la même ligne à deux reprises, mais les résultats sont différents parce qu’ils ont été modifiés entre les deux requêtes par une autre transaction.</span><span class="sxs-lookup"><span data-stu-id="80bf1-120">A *nonrepeatable read* occurs when a transaction queries same row twice, but the results are different because it was changed between the two queries by another transaction.</span></span>

- <span data-ttu-id="80bf1-121">Les *fantômes* sont des lignes qui ont été modifiées ou ajoutées pour respecter la clause WHERE d’une requête au cours d’une transaction.</span><span class="sxs-lookup"><span data-stu-id="80bf1-121">*Phantoms* are rows that get changed or added to meet the where clause of a query during a transaction.</span></span> <span data-ttu-id="80bf1-122">Si elle est autorisée, la même requête peut retourner des lignes différentes lorsqu’elle est exécutée deux fois dans la même transaction.</span><span class="sxs-lookup"><span data-stu-id="80bf1-122">If allowed, the same query could return different rows when executed twice in the same transaction.</span></span>

<span data-ttu-id="80bf1-123">Microsoft. Data. sqlite traite la valeur IsolationLevel transmise à <xref:Microsoft.Data.Sqlite.SqliteConnection.BeginTransaction%2A> comme un niveau minimal.</span><span class="sxs-lookup"><span data-stu-id="80bf1-123">Microsoft.Data.Sqlite treats the IsolationLevel passed to <xref:Microsoft.Data.Sqlite.SqliteConnection.BeginTransaction%2A> as a minimum level.</span></span> <span data-ttu-id="80bf1-124">Le niveau d’isolation réel sera promu en lecture non validée ou sérialisable.</span><span class="sxs-lookup"><span data-stu-id="80bf1-124">The actual isolation level will be promoted to either read uncommitted or serializable.</span></span>

<span data-ttu-id="80bf1-125">Le code suivant simule une lecture incorrecte.</span><span class="sxs-lookup"><span data-stu-id="80bf1-125">The following code simulates a dirty read.</span></span> <span data-ttu-id="80bf1-126">Notez que la chaîne de connexion doit inclure `Cache=Shared` .</span><span class="sxs-lookup"><span data-stu-id="80bf1-126">Note, the connection string must include `Cache=Shared`.</span></span>

[!code-csharp[](../../../../samples/snippets/standard/data/sqlite/DirtyReadSample/Program.cs?name=snippet_DirtyRead)]

## <a name="deferred-transactions"></a><span data-ttu-id="80bf1-127">Transactions différées</span><span class="sxs-lookup"><span data-stu-id="80bf1-127">Deferred transactions</span></span>

<span data-ttu-id="80bf1-128">À compter de Microsoft. Data. SQLite version 5,0, les transactions peuvent être différées.</span><span class="sxs-lookup"><span data-stu-id="80bf1-128">Starting with Microsoft.Data.Sqlite version 5.0, transactions can be deferred.</span></span> <span data-ttu-id="80bf1-129">Cela diffère la création de la transaction réelle dans la base de données jusqu’à ce que la première commande soit exécutée.</span><span class="sxs-lookup"><span data-stu-id="80bf1-129">This defers the creation of the actual transaction in the database until the first command is executed.</span></span> <span data-ttu-id="80bf1-130">Cela entraîne également la mise à niveau progressive de la transaction d’une transaction de lecture vers une transaction d’écriture en fonction des besoins de ses commandes.</span><span class="sxs-lookup"><span data-stu-id="80bf1-130">It also causes the transaction to gradually upgrade from a read transaction to a write transaction as needed by its commands.</span></span> <span data-ttu-id="80bf1-131">Cela peut être utile pour permettre l’accès simultané à la base de données pendant la transaction.</span><span class="sxs-lookup"><span data-stu-id="80bf1-131">This can be useful for enabling concurrent access to the database during the transaction.</span></span>

[!code-csharp[](../../../../samples/snippets/standard/data/sqlite/DeferredTransactionSample/Program.cs?name=snippet_DeferredTransaction)]

> [!WARNING]
> <span data-ttu-id="80bf1-132">Les commandes à l’intérieur d’une transaction différée peuvent échouer si elles provoquent la mise à niveau de la transaction d’une transaction de lecture vers une transaction d’écriture alors que la base de données est verrouillée.</span><span class="sxs-lookup"><span data-stu-id="80bf1-132">Commands inside a deferred transaction can fail if they cause the transaction to be upgraded from a read transaction to a write transaction while the database is locked.</span></span> <span data-ttu-id="80bf1-133">Dans ce cas, l’application doit retenter l’intégralité de la transaction.</span><span class="sxs-lookup"><span data-stu-id="80bf1-133">When this happens, the application will need to retry the entire transaction.</span></span>

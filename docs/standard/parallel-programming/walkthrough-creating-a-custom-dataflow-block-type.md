---
title: "Procédure pas à pas : création d'un type de bloc de flux de données personnalisé"
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Task Parallel Library, dataflows
- TPL dataflow library, creating custom dataflow blocks
- dataflow blocks, creating custom in TPL
ms.assetid: a6147146-0a6a-4d9b-ab0f-237b3c1ac691
ms.openlocfilehash: cb953952bbed90edd2db799e92d44ec9f062babf
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/30/2019
ms.locfileid: "73139883"
---
# <a name="walkthrough-creating-a-custom-dataflow-block-type"></a><span data-ttu-id="86586-102">Procédure pas à pas : création d'un type de bloc de flux de données personnalisé</span><span class="sxs-lookup"><span data-stu-id="86586-102">Walkthrough: Creating a Custom Dataflow Block Type</span></span>
<span data-ttu-id="86586-103">Bien que la bibliothèque de flux de données TPL fournisse plusieurs types de blocs de flux de données offrant une large gamme de fonctionnalités, vous pouvez aussi créer des types de blocs personnalisés.</span><span class="sxs-lookup"><span data-stu-id="86586-103">Although the TPL Dataflow Library provides several dataflow block types that enable a variety of functionality, you can also create custom block types.</span></span> <span data-ttu-id="86586-104">Ce document décrit comment créer un type de bloc de flux de données qui implémente un comportement personnalisé.</span><span class="sxs-lookup"><span data-stu-id="86586-104">This document describes how to create a dataflow block type that implements custom behavior.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="86586-105">Configuration requise</span><span class="sxs-lookup"><span data-stu-id="86586-105">Prerequisites</span></span>  
 <span data-ttu-id="86586-106">Consultez [Flux de données](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) avant de lire ce document.</span><span class="sxs-lookup"><span data-stu-id="86586-106">Read [Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) before you read this document.</span></span>  

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]
  
## <a name="defining-the-sliding-window-dataflow-block"></a><span data-ttu-id="86586-107">Définition du bloc de flux de données d’une fenêtre coulissante</span><span class="sxs-lookup"><span data-stu-id="86586-107">Defining the Sliding Window Dataflow Block</span></span>  
 <span data-ttu-id="86586-108">Imaginez une application de flux de données qui exige que les valeurs d’entrée soient mises en mémoire tampon, puis affichées sous la forme d’une fenêtre coulissante.</span><span class="sxs-lookup"><span data-stu-id="86586-108">Consider a dataflow application that requires that input values be buffered and then output in a sliding window manner.</span></span> <span data-ttu-id="86586-109">Par exemple, pour les valeurs d’entrée {0, 1, 2, 3, 4, 5} et une taille de fenêtre de 3, un bloc de flux de données de fenêtre coulissante génère les tableaux de sortie {0, 1, 2}, {1, 2, 3}, {2, 3, 4,} et {3, 4, 5}.</span><span class="sxs-lookup"><span data-stu-id="86586-109">For example, for the input values {0, 1, 2, 3, 4, 5} and a window size of three, a sliding window dataflow block produces the output arrays {0, 1, 2}, {1, 2, 3}, {2, 3, 4}, and {3, 4, 5}.</span></span> <span data-ttu-id="86586-110">Les sections suivantes décrivent deux façons de créer un type de bloc de flux de données qui implémente ce comportement personnalisé.</span><span class="sxs-lookup"><span data-stu-id="86586-110">The following sections describe two ways to create a dataflow block type that implements this custom behavior.</span></span> <span data-ttu-id="86586-111">La première technique utilise la méthode <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Encapsulate%2A> pour combiner la fonctionnalité d’un objet <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> et d’un objet <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> dans un bloc propagateur.</span><span class="sxs-lookup"><span data-stu-id="86586-111">The first technique uses the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Encapsulate%2A> method to combine the functionality of an <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> object and an <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> object into one propagator block.</span></span> <span data-ttu-id="86586-112">La seconde technique définit une classe dérivée de <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> et combine la fonctionnalité existante pour générer le comportement personnalisé.</span><span class="sxs-lookup"><span data-stu-id="86586-112">The second technique defines a class that derives from <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> and combines existing functionality to perform custom behavior.</span></span>  
  
## <a name="using-the-encapsulate-method-to-define-the-sliding-window-dataflow-block"></a><span data-ttu-id="86586-113">Utilisation de la méthode d’encapsulage pour définir le bloc de flux d’une fenêtre coulissante</span><span class="sxs-lookup"><span data-stu-id="86586-113">Using the Encapsulate Method to Define the Sliding Window Dataflow Block</span></span>  
 <span data-ttu-id="86586-114">L’exemple suivant utilise la méthode <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Encapsulate%2A> pour créer un bloc propagateur à partir d’une source et d’une cible.</span><span class="sxs-lookup"><span data-stu-id="86586-114">The following example uses the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Encapsulate%2A> method to create a propagator block from a target and a source.</span></span> <span data-ttu-id="86586-115">Un bloc propagateur permet à un bloc source et à un bloc cible d’agir en tant que destinataire et expéditeur des données.</span><span class="sxs-lookup"><span data-stu-id="86586-115">A propagator block enables a source block and a target block to act as a receiver and sender of data.</span></span>  
  
 <span data-ttu-id="86586-116">Cette technique est utile lorsque vous avez besoin d’une fonctionnalité de flux de données personnalisée, mais pas d’un type qui fournit d’autres méthodes, propriétés ou champs.</span><span class="sxs-lookup"><span data-stu-id="86586-116">This technique is useful when you require custom dataflow functionality, but you do not require a type that provides additional methods, properties, or fields.</span></span>  
  
 [!code-csharp[TPLDataflow_SlidingWindowBlock#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_slidingwindowblock/cs/slidingwindowblock.cs#1)]
 [!code-vb[TPLDataflow_SlidingWindowBlock#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_slidingwindowblock/vb/slidingwindowblock.vb#1)]  
  
## <a name="deriving-from-ipropagatorblock-to-define-the-sliding-window-dataflow-block"></a><span data-ttu-id="86586-117">Dérivation d’IPropagatorBlock pour définir le bloc de flux de données d’une fenêtre coulissante</span><span class="sxs-lookup"><span data-stu-id="86586-117">Deriving from IPropagatorBlock to Define the Sliding Window Dataflow Block</span></span>  
 <span data-ttu-id="86586-118">L’exemple suivant montre la classe `SlidingWindowBlock`.</span><span class="sxs-lookup"><span data-stu-id="86586-118">The following example shows the `SlidingWindowBlock` class.</span></span> <span data-ttu-id="86586-119">Cette classe est dérivée <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> pour pouvoir agir à la fois comme une source et une cible de données.</span><span class="sxs-lookup"><span data-stu-id="86586-119">This class derives from <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> so that it can act as both a source and a target of data.</span></span> <span data-ttu-id="86586-120">Comme dans l’exemple précédent, la classe `SlidingWindowBlock` s’appuie sur des types de blocs de flux de données existants.</span><span class="sxs-lookup"><span data-stu-id="86586-120">As in the previous example, the `SlidingWindowBlock` class is built on existing dataflow block types.</span></span> <span data-ttu-id="86586-121">Cependant, la classe `SlidingWindowBlock` implémente également les méthodes requises par les interfaces <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601>, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> et <xref:System.Threading.Tasks.Dataflow.IDataflowBlock>.</span><span class="sxs-lookup"><span data-stu-id="86586-121">However, the `SlidingWindowBlock` class also implements the methods that are required by the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601>, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>, and <xref:System.Threading.Tasks.Dataflow.IDataflowBlock> interfaces.</span></span> <span data-ttu-id="86586-122">Toutes ces méthodes transfèrent le travail aux membres du type de bloc de flux de données prédéfini.</span><span class="sxs-lookup"><span data-stu-id="86586-122">These methods all forward work to the predefined dataflow block type members.</span></span> <span data-ttu-id="86586-123">Par exemple, la méthode `Post` transmet le travail au membre de données `m_target`, qui est également un objet <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.</span><span class="sxs-lookup"><span data-stu-id="86586-123">For example, the `Post` method defers work to the `m_target` data member, which is also an <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> object.</span></span>  
  
 <span data-ttu-id="86586-124">Cette technique est utile lorsque vous avez besoin d’une fonctionnalité de flux de données personnalisée, mais également d’un type qui fournit d’autres méthodes, propriétés ou champs.</span><span class="sxs-lookup"><span data-stu-id="86586-124">This technique is useful when you require custom dataflow functionality, and also require a type that provides additional methods, properties, or fields.</span></span> <span data-ttu-id="86586-125">Par exemple, la classe `SlidingWindowBlock` est également dérivée de <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601> afin de fournir les méthodes <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601.TryReceive%2A> et <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601.TryReceiveAll%2A>.</span><span class="sxs-lookup"><span data-stu-id="86586-125">For example, the `SlidingWindowBlock` class also derives from <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601> so that it can provide the <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601.TryReceive%2A> and <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601.TryReceiveAll%2A> methods.</span></span> <span data-ttu-id="86586-126">La classe `SlidingWindowBlock` apporte également une extensibilité en fournissant la propriété `WindowSize`, qui récupère le nombre d’éléments dans la fenêtre coulissante.</span><span class="sxs-lookup"><span data-stu-id="86586-126">The `SlidingWindowBlock` class also demonstrates extensibility by providing the `WindowSize` property, which retrieves the number of elements in the sliding window.</span></span>  
  
 [!code-csharp[TPLDataflow_SlidingWindowBlock#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_slidingwindowblock/cs/slidingwindowblock.cs#2)]
 [!code-vb[TPLDataflow_SlidingWindowBlock#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_slidingwindowblock/vb/slidingwindowblock.vb#2)]  
  
## <a name="the-complete-example"></a><span data-ttu-id="86586-127">Exemple complet</span><span class="sxs-lookup"><span data-stu-id="86586-127">The Complete Example</span></span>  
 <span data-ttu-id="86586-128">L'exemple suivant présente le code complet pour cette visite.</span><span class="sxs-lookup"><span data-stu-id="86586-128">The following example shows the complete code for this walkthrough.</span></span> <span data-ttu-id="86586-129">Il montre également comment utiliser les deux blocs de fenêtre coulissante dans une méthode qui écrit dans le bloc, lit à partir de celui-ci, puis imprime les résultats dans la console.</span><span class="sxs-lookup"><span data-stu-id="86586-129">It also demonstrates how to use the both sliding window blocks in a method that writes to the block, reads from it, and prints the results to the console.</span></span>  
  
 [!code-csharp[TPLDataflow_SlidingWindowBlock#100](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_slidingwindowblock/cs/slidingwindowblock.cs#100)]
 [!code-vb[TPLDataflow_SlidingWindowBlock#100](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_slidingwindowblock/vb/slidingwindowblock.vb#100)]  
  
## <a name="see-also"></a><span data-ttu-id="86586-130">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="86586-130">See also</span></span>

- [<span data-ttu-id="86586-131">Le flux de données</span><span class="sxs-lookup"><span data-stu-id="86586-131">Dataflow</span></span>](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)

---
title: Flux de données (bibliothèque parallèle de tâches)
description: Apprenez à utiliser les composants de flux de données dans la bibliothèque parallèle de tâches (TPL) pour améliorer la robustesse des applications prenant en charge l’accès concurrentiel.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Task Parallel Library, dataflows
- TPL dataflow library
ms.assetid: 643575d0-d26d-4c35-8de7-a9c403e97dd6
ms.openlocfilehash: 67b5cfaa987b3f37d68597d22ad5f87e8d1bd018
ms.sourcegitcommit: d8020797a6657d0fbbdff362b80300815f682f94
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/24/2020
ms.locfileid: "95728691"
---
# <a name="dataflow-task-parallel-library"></a><span data-ttu-id="2de07-103">Flux de données (bibliothèque parallèle de tâches)</span><span class="sxs-lookup"><span data-stu-id="2de07-103">Dataflow (Task Parallel Library)</span></span>

<span data-ttu-id="2de07-104">La bibliothèque parallèle de tâches (TPL) fournit des composants de flux de données destinés à augmenter la robustesse des applications prenant en charge l’accès concurrentiel.</span><span class="sxs-lookup"><span data-stu-id="2de07-104">The Task Parallel Library (TPL) provides dataflow components to help increase the robustness of concurrency-enabled applications.</span></span> <span data-ttu-id="2de07-105">Ces composants de flux de données sont regroupés sous le nom de *bibliothèque de flux de données TPL*.</span><span class="sxs-lookup"><span data-stu-id="2de07-105">These dataflow components are collectively referred to as the *TPL Dataflow Library*.</span></span> <span data-ttu-id="2de07-106">Ce modèle de flux de données favorise la programmation basée sur les acteurs en fournissant une transmission de messages in-process pour les flux de données à granularité grossière et les tâches de traitement "pipeline".</span><span class="sxs-lookup"><span data-stu-id="2de07-106">This dataflow model promotes actor-based programming by providing in-process message passing for coarse-grained dataflow and pipelining tasks.</span></span> <span data-ttu-id="2de07-107">Les composants de flux de données reposent sur les types et l'infrastructure de planification de la bibliothèque parallèle de tâches, et s'intègrent à la prise en charge des langages C#, Visual Basic et F# de la programmation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="2de07-107">The dataflow components build on the types and scheduling infrastructure of the TPL and integrate with the C#, Visual Basic, and F# language support for asynchronous programming.</span></span> <span data-ttu-id="2de07-108">Ces composants de flux de données sont utiles quand vous avez plusieurs opérations qui doivent communiquer entre elles de façon asynchrone ou quand vous voulez traiter les données à mesure qu'elles deviennent disponibles.</span><span class="sxs-lookup"><span data-stu-id="2de07-108">These dataflow components are useful when you have multiple operations that must communicate with one another asynchronously or when you want to process data as it becomes available.</span></span> <span data-ttu-id="2de07-109">Prenons par exemple une application qui traite les données d'image d'une webcam.</span><span class="sxs-lookup"><span data-stu-id="2de07-109">For example, consider an application that processes image data from a web camera.</span></span> <span data-ttu-id="2de07-110">En utilisant le modèle de flux de données, l'application peut traiter les trames d'images à mesure qu'elles deviennent disponibles.</span><span class="sxs-lookup"><span data-stu-id="2de07-110">By using the dataflow model, the application can process image frames as they become available.</span></span> <span data-ttu-id="2de07-111">Si l’application améliore les trames d’images, par exemple, en effectuant la correction de la lumière ou des yeux rouges, vous pouvez créer un *pipeline* de composants de flux de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-111">If the application enhances image frames, for example, by performing light correction or red-eye reduction, you can create a *pipeline* of dataflow components.</span></span> <span data-ttu-id="2de07-112">Chaque étape du pipeline peut utiliser plusieurs fonctionnalités de parallélisme à granularité grossière, telles que les fonctionnalités fournies par la bibliothèque TPL qui permettent de transformer les images.</span><span class="sxs-lookup"><span data-stu-id="2de07-112">Each stage of the pipeline might use more coarse-grained parallelism functionality, such as the functionality that is provided by the TPL, to transform the image.</span></span>  
  
 <span data-ttu-id="2de07-113">Ce document fournit une vue d'ensemble de la bibliothèque de flux de données TPL.</span><span class="sxs-lookup"><span data-stu-id="2de07-113">This document provides an overview of the TPL Dataflow Library.</span></span> <span data-ttu-id="2de07-114">Il décrit le modèle de programmation et les types de blocs de flux de données prédéfinis, et explique comment configurer des blocs de flux de données pour répondre aux besoins de vos applications.</span><span class="sxs-lookup"><span data-stu-id="2de07-114">It describes the programming model, the predefined dataflow block types, and how to configure dataflow blocks to meet the specific requirements of your applications.</span></span>  

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="programming-model"></a><span data-ttu-id="2de07-115">Modèle de programmation</span><span class="sxs-lookup"><span data-stu-id="2de07-115">Programming Model</span></span>

 <span data-ttu-id="2de07-116">La bibliothèque de flux de données TPL constitue une base pour la transmission de messages et la parallélisation des applications nécessitant une utilisation importante du processeur et des E/S, et ayant un débit élevé et une faible latence.</span><span class="sxs-lookup"><span data-stu-id="2de07-116">The TPL Dataflow Library provides a foundation for message passing and parallelizing CPU-intensive and I/O-intensive applications that have high throughput and low latency.</span></span> <span data-ttu-id="2de07-117">Elle permet également de contrôler explicitement la manière dont les données sont mises en mémoire tampon et se déplacent sur le système.</span><span class="sxs-lookup"><span data-stu-id="2de07-117">It also gives you explicit control over how data is buffered and moves around the system.</span></span> <span data-ttu-id="2de07-118">Pour mieux comprendre le modèle de programmation de flux de données, imaginez une application qui charge des images à partir du disque de manière asynchrone et crée un composite de ces images.</span><span class="sxs-lookup"><span data-stu-id="2de07-118">To better understand the dataflow programming model, consider an application that asynchronously loads images from disk and creates a composite of those images.</span></span> <span data-ttu-id="2de07-119">Les modèles de programmation traditionnels requièrent généralement l'utilisation de rappels et d'objets de synchronisation, tels que des verrous, pour coordonner les tâches et accéder aux données partagées.</span><span class="sxs-lookup"><span data-stu-id="2de07-119">Traditional programming models typically require that you use callbacks and synchronization objects, such as locks, to coordinate tasks and access to shared data.</span></span> <span data-ttu-id="2de07-120">À l'aide du modèle de programmation de flux de données, vous pouvez créer des objets de flux de données qui traitent les images à mesure qu'elles sont lues à partir du disque.</span><span class="sxs-lookup"><span data-stu-id="2de07-120">By using the dataflow programming model, you can create dataflow objects that process images as they are read from disk.</span></span> <span data-ttu-id="2de07-121">Sous le modèle de flux de données, vous déclarez la manière dont sont traitées les données quand elles deviennent disponibles, ainsi que les éventuelles dépendances qui existent entre les données.</span><span class="sxs-lookup"><span data-stu-id="2de07-121">Under the dataflow model, you declare how data is handled when it becomes available, and also any dependencies between data.</span></span> <span data-ttu-id="2de07-122">Le runtime gère les dépendances entre les données, ce qui vous évite d'avoir à synchroniser l'accès aux données partagées.</span><span class="sxs-lookup"><span data-stu-id="2de07-122">Because the runtime manages dependencies between data, you can often avoid the requirement to synchronize access to shared data.</span></span> <span data-ttu-id="2de07-123">De plus, étant donné que le runtime planifie les tâches en fonction de l'arrivée asynchrone des données, le flux de données peut améliorer la réactivité et le débit grâce à une gestion efficace des threads sous-jacents.</span><span class="sxs-lookup"><span data-stu-id="2de07-123">In addition, because the runtime schedules work based on the asynchronous arrival of data, dataflow can improve responsiveness and throughput by efficiently managing the underlying threads.</span></span> <span data-ttu-id="2de07-124">Vous trouverez un exemple d’utilisation du modèle de programmation de flux de données pour implémenter le traitement d’image dans une application Windows Forms sur la page [Procédure pas à pas : utiliser les flux de données dans une application Windows Forms](walkthrough-using-dataflow-in-a-windows-forms-application.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-124">For an example that uses the dataflow programming model to implement image processing in a Windows Forms application, see [Walkthrough: Using Dataflow in a Windows Forms Application](walkthrough-using-dataflow-in-a-windows-forms-application.md).</span></span>  
  
### <a name="sources-and-targets"></a><span data-ttu-id="2de07-125">Sources et cibles</span><span class="sxs-lookup"><span data-stu-id="2de07-125">Sources and Targets</span></span>  

 <span data-ttu-id="2de07-126">La bibliothèque de flux de données TPL comprend des *blocs de flux de données*, structures de données qui mettent les données en mémoire tampon et les traitent.</span><span class="sxs-lookup"><span data-stu-id="2de07-126">The TPL Dataflow Library consists of *dataflow blocks*, which are data structures that buffer and process data.</span></span> <span data-ttu-id="2de07-127">La bibliothèque parallèle de tâches définit trois types de blocs de flux de données : les *blocs sources*, les *blocs cibles* et les *blocs propagateurs*.</span><span class="sxs-lookup"><span data-stu-id="2de07-127">The TPL defines three kinds of dataflow blocks: *source blocks*, *target blocks*, and *propagator blocks*.</span></span> <span data-ttu-id="2de07-128">Un bloc source agit comme une source de données et peut donc être lu.</span><span class="sxs-lookup"><span data-stu-id="2de07-128">A source block acts as a source of data and can be read from.</span></span> <span data-ttu-id="2de07-129">Un bloc cible joue le rôle de récepteur de données, il est donc possible d'y écrire.</span><span class="sxs-lookup"><span data-stu-id="2de07-129">A target block acts as a receiver of data and can be written to.</span></span> <span data-ttu-id="2de07-130">Un bloc propagateur agit à la fois comme un bloc source et un bloc cible, et peut donc faire l'objet d'une lecture et d'une écriture.</span><span class="sxs-lookup"><span data-stu-id="2de07-130">A propagator block acts as both a source block and a target block, and can be read from and written to.</span></span> <span data-ttu-id="2de07-131">La bibliothèque parallèle de tâches définit l'interface <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601?displayProperty=nameWithType> pour représenter les sources, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601?displayProperty=nameWithType> pour représenter les cibles, et <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602?displayProperty=nameWithType> pour représenter les propagateurs.</span><span class="sxs-lookup"><span data-stu-id="2de07-131">The TPL defines the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601?displayProperty=nameWithType> interface to represent sources, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601?displayProperty=nameWithType> to represent targets, and <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602?displayProperty=nameWithType> to represent propagators.</span></span> <span data-ttu-id="2de07-132"><xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> hérite des deux <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> et de <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.</span><span class="sxs-lookup"><span data-stu-id="2de07-132"><xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> inherits from both <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601>, and <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.</span></span>  
  
 <span data-ttu-id="2de07-133">La bibliothèque de flux de données TPL fournit plusieurs types de blocs de flux de données prédéfinis qui implémentent les interfaces <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601>, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> et <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602>.</span><span class="sxs-lookup"><span data-stu-id="2de07-133">The TPL Dataflow Library provides several predefined dataflow block types that implement the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601>, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>, and <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> interfaces.</span></span> <span data-ttu-id="2de07-134">Ces types de blocs de flux de données sont décrits dans ce document dans la section [Types de blocs de flux de données prédéfinis](#predefined-dataflow-block-types).</span><span class="sxs-lookup"><span data-stu-id="2de07-134">These dataflow block types are described in this document in the section [Predefined Dataflow Block Types](#predefined-dataflow-block-types).</span></span>  
  
### <a name="connecting-blocks"></a><span data-ttu-id="2de07-135">Connexion des blocs</span><span class="sxs-lookup"><span data-stu-id="2de07-135">Connecting Blocks</span></span>  

 <span data-ttu-id="2de07-136">Vous pouvez aussi connecter des blocs de flux de données pour former des *pipelines*, qui sont des séquences linéaires de blocs de flux de données, ou bien des *réseaux*, qui sont des graphiques de blocs de flux de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-136">You can connect dataflow blocks to form *pipelines*, which are linear sequences of dataflow blocks, or *networks*, which are graphs of dataflow blocks.</span></span> <span data-ttu-id="2de07-137">Un pipeline est une forme de réseau.</span><span class="sxs-lookup"><span data-stu-id="2de07-137">A pipeline is one form of network.</span></span> <span data-ttu-id="2de07-138">Dans un pipeline ou un réseau, les sources propagent des données de manière asynchrone vers les cibles à mesure que les données deviennent disponibles.</span><span class="sxs-lookup"><span data-stu-id="2de07-138">In a pipeline or network, sources asynchronously propagate data to targets as that data becomes available.</span></span> <span data-ttu-id="2de07-139">La méthode <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A?displayProperty=nameWithType> lie un bloc de flux de données source à un bloc cible.</span><span class="sxs-lookup"><span data-stu-id="2de07-139">The <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A?displayProperty=nameWithType> method links a source dataflow block to a target block.</span></span> <span data-ttu-id="2de07-140">Une source peut être liée à zéro, une ou plusieurs cibles. Une cible peut être liée à zéro, une ou plusieurs sources.</span><span class="sxs-lookup"><span data-stu-id="2de07-140">A source can be linked to zero or more targets; targets can be linked from zero or more sources.</span></span> <span data-ttu-id="2de07-141">Vous pouvez ajouter des blocs de flux de données à un pipeline ou en supprimer de manière simultanée.</span><span class="sxs-lookup"><span data-stu-id="2de07-141">You can add or remove dataflow blocks to or from a pipeline or network concurrently.</span></span> <span data-ttu-id="2de07-142">Les types de blocs de flux de données prédéfinis gèrent tous les aspects liés à la sécurité des threads pour les liaisons et les annulations de liaison.</span><span class="sxs-lookup"><span data-stu-id="2de07-142">The predefined dataflow block types handle all thread-safety aspects of linking and unlinking.</span></span>  
  
 <span data-ttu-id="2de07-143">Vous trouverez un exemple de connexion de blocs de flux de données permettant de former un pipeline de base sur la page [Procédure pas à pas : créer un pipeline de flux de données](walkthrough-creating-a-dataflow-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-143">For an example that connects dataflow blocks to form a basic pipeline, see [Walkthrough: Creating a Dataflow Pipeline](walkthrough-creating-a-dataflow-pipeline.md).</span></span> <span data-ttu-id="2de07-144">Vous trouverez un exemple de connexion de blocs de flux de données permettant de former un réseau plus complexe sur la page [Procédure pas à pas : utiliser les flux de données dans une application Windows Forms](walkthrough-using-dataflow-in-a-windows-forms-application.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-144">For an example that connects dataflow blocks to form a more complex network, see [Walkthrough: Using Dataflow in a Windows Forms Application](walkthrough-using-dataflow-in-a-windows-forms-application.md).</span></span> <span data-ttu-id="2de07-145">Vous trouverez un exemple de dissociation d’une cible et d’une source après que la source a envoyé un message à la cible sur la page [Guide pratique : dissocier des blocs de flux de données](how-to-unlink-dataflow-blocks.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-145">For an example that unlinks a target from a source after the source offers the target a message, see [How to: Unlink Dataflow Blocks](how-to-unlink-dataflow-blocks.md).</span></span>  
  
#### <a name="filtering"></a><span data-ttu-id="2de07-146">Filtrage</span><span class="sxs-lookup"><span data-stu-id="2de07-146">Filtering</span></span>  

 <span data-ttu-id="2de07-147">Quand vous appelez la méthode <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A?displayProperty=nameWithType> pour lier une source à une cible, vous pouvez fournir un délégué qui détermine si le bloc cible accepte ou rejette les messages en fonction de la valeur de ce message.</span><span class="sxs-lookup"><span data-stu-id="2de07-147">When you call the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A?displayProperty=nameWithType> method to link a source to a target, you can supply a delegate that determines whether the target block accepts or rejects a message based on the value of that message.</span></span> <span data-ttu-id="2de07-148">Ce mécanisme de filtrage permet de garantir qu'un bloc de flux de données recevra uniquement certaines valeurs.</span><span class="sxs-lookup"><span data-stu-id="2de07-148">This filtering mechanism is a useful way to guarantee that a dataflow block receives only certain values.</span></span> <span data-ttu-id="2de07-149">Pour la plupart des types de blocs de flux de données prédéfinis, si un bloc source est connecté à plusieurs blocs cibles, quand un bloc cible rejette un message, la source envoie le message à la cible suivante.</span><span class="sxs-lookup"><span data-stu-id="2de07-149">For most of the predefined dataflow block types, if a source block is connected to multiple target blocks, when a target block rejects a message, the source offers that message to the next target.</span></span> <span data-ttu-id="2de07-150">L'ordre dans lequel une source envoie des messages aux cibles est défini par la source et peut varier en fonction du type de la source.</span><span class="sxs-lookup"><span data-stu-id="2de07-150">The order in which a source offers messages to targets is defined by the source and can vary according to the type of the source.</span></span> <span data-ttu-id="2de07-151">La plupart des types de blocs sources arrêtent d'envoyer un message une fois celui-ci accepté par une cible.</span><span class="sxs-lookup"><span data-stu-id="2de07-151">Most source block types stop offering a message after one target accepts that message.</span></span> <span data-ttu-id="2de07-152">La classe <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> est une exception. En effet, celle-ci envoie chaque message à l'ensemble des cibles, même si celles-ci le rejettent.</span><span class="sxs-lookup"><span data-stu-id="2de07-152">One exception to this rule is the <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> class, which offers each message to all targets, even if some targets reject the message.</span></span> <span data-ttu-id="2de07-153">Vous trouverez un exemple d’utilisation du filtrage permettant de traiter uniquement certains messages sur la page [Procédure pas à pas : utiliser les flux de données dans une application Windows Forms](walkthrough-using-dataflow-in-a-windows-forms-application.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-153">For an example that uses filtering to process only certain messages, see [Walkthrough: Using Dataflow in a Windows Forms Application](walkthrough-using-dataflow-in-a-windows-forms-application.md).</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="2de07-154">Étant donné que chaque type de bloc de flux de données source prédéfini garantit la propagation des messages dans l'ordre où ils sont reçus, tous les messages doivent être lus depuis le bloc source avant que celui-ci ne puisse traiter le message suivant.</span><span class="sxs-lookup"><span data-stu-id="2de07-154">Because each predefined source dataflow block type guarantees that messages are propagated out in the order in which they are received, every message must be read from the source block before the source block can process the next message.</span></span> <span data-ttu-id="2de07-155">Par conséquent, quand vous utilisez le filtrage pour connecter plusieurs cibles à une source, assurez-vous que chaque message soit reçu par au moins un bloc cible.</span><span class="sxs-lookup"><span data-stu-id="2de07-155">Therefore, when you use filtering to connect multiple targets to a source, make sure that at least one target block receives each message.</span></span> <span data-ttu-id="2de07-156">Sinon, votre application peut se bloquer.</span><span class="sxs-lookup"><span data-stu-id="2de07-156">Otherwise, your application might deadlock.</span></span>  
  
### <a name="message-passing"></a><span data-ttu-id="2de07-157">Transmission de messages</span><span class="sxs-lookup"><span data-stu-id="2de07-157">Message Passing</span></span>  

 <span data-ttu-id="2de07-158">Le modèle de programmation de flux de données est lié au concept de *transmission de messages*, durant laquelle les composants indépendants d’un programme communiquent entre eux à l’aide de messages.</span><span class="sxs-lookup"><span data-stu-id="2de07-158">The dataflow programming model is related to the concept of *message passing*, where independent components of a program communicate with one another by sending messages.</span></span> <span data-ttu-id="2de07-159">Pour propager des messages entre composants d'application, vous pouvez appeler les méthodes <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> et <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A?displayProperty=nameWithType> afin d’envoyer des messages aux blocs de flux de données cibles (<xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> agit de façon synchrone et <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A> de façon asynchrone), et les méthodes <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A>, <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A> et <xref:System.Threading.Tasks.Dataflow.DataflowBlock.TryReceive%2A> afin de recevoir des messages provenant de blocs sources.</span><span class="sxs-lookup"><span data-stu-id="2de07-159">One way to propagate messages among application components is to call the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> and <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A?displayProperty=nameWithType> methods to send messages to target dataflow blocks post (<xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> acts synchronously; <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A> acts asynchronously) and the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A>, <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A>, and <xref:System.Threading.Tasks.Dataflow.DataflowBlock.TryReceive%2A> methods to receive messages from source blocks.</span></span> <span data-ttu-id="2de07-160">Vous pouvez combiner ces méthodes à des pipelines ou réseaux de flux de données en envoyant des données d'entrée au nœud principal (bloc cible) et en recevant des données de sortie de la part du nœud terminal du pipeline ou des nœuds terminaux du réseau (un ou plusieurs blocs sources).</span><span class="sxs-lookup"><span data-stu-id="2de07-160">You can combine these methods with dataflow pipelines or networks by sending input data to the head node (a target block), and receiving output data from the terminal node of the pipeline or the terminal nodes of the network (one or more source blocks).</span></span> <span data-ttu-id="2de07-161">Vous pouvez également utiliser la méthode <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Choose%2A> pour lire la première des sources fournies qui contient des données et effectuer des actions sur ces données.</span><span class="sxs-lookup"><span data-stu-id="2de07-161">You can also use the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Choose%2A> method to read from the first of the provided sources that has data available and perform action on that data.</span></span>  
  
 <span data-ttu-id="2de07-162">Les blocs sources envoient des données aux blocs cibles en appelant la méthode <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2de07-162">Source blocks offer data to target blocks by calling the <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="2de07-163">Le bloc cible peut répondre à un message envoyé de trois manières : il peut accepter le message, le refuser ou le différer.</span><span class="sxs-lookup"><span data-stu-id="2de07-163">The target block responds to an offered message in one of three ways: it can accept the message, decline the message, or postpone the message.</span></span> <span data-ttu-id="2de07-164">Quand la cible accepte le message, la méthode <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> retourne <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Accepted>.</span><span class="sxs-lookup"><span data-stu-id="2de07-164">When the target accepts the message, the <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> method returns <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Accepted>.</span></span> <span data-ttu-id="2de07-165">Quand la cible refuse le message, la méthode <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> retourne <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Declined>.</span><span class="sxs-lookup"><span data-stu-id="2de07-165">When the target declines the message, the <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> method returns <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Declined>.</span></span> <span data-ttu-id="2de07-166">Quand la cible décide de ne plus recevoir de messages de la source, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> renvoie <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.DecliningPermanently>.</span><span class="sxs-lookup"><span data-stu-id="2de07-166">When the target requires that it no longer receives any messages from the source, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> returns <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.DecliningPermanently>.</span></span> <span data-ttu-id="2de07-167">Les types de blocs sources prédéfinis n'envoient plus de messages aux cibles liées après réception d'une telle valeur et sont automatiquement dissociés de ces cibles.</span><span class="sxs-lookup"><span data-stu-id="2de07-167">The predefined source block types do not offer messages to linked targets after such a return value is received, and they automatically unlink from such targets.</span></span>  
  
 <span data-ttu-id="2de07-168">Quand un bloc cible diffère le message pour une utilisation ultérieure, la méthode <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> retourne <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Postponed>.</span><span class="sxs-lookup"><span data-stu-id="2de07-168">When a target block postpones the message for later use, the <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> method returns <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Postponed>.</span></span> <span data-ttu-id="2de07-169">Un bloc cible qui diffère un message peut appeler par la suite la méthode <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ReserveMessage%2A?displayProperty=nameWithType> pour tenter de réserver le message envoyé.</span><span class="sxs-lookup"><span data-stu-id="2de07-169">A target block that postpones a message can later call the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ReserveMessage%2A?displayProperty=nameWithType> method to try to reserve the offered message.</span></span> <span data-ttu-id="2de07-170">À ce stade, soit le message est toujours disponible et peut être utilisé par le bloc cible, soit le message a été utilisé par une autre cible.</span><span class="sxs-lookup"><span data-stu-id="2de07-170">At this point, the message is either still available and can be used by the target block, or the message has been taken by another target.</span></span> <span data-ttu-id="2de07-171">Si, par la suite, le bloc cible demande le message ou n'en a plus besoin, il appellera respectivement la méthode <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ConsumeMessage%2A?displayProperty=nameWithType> ou la méthode <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ReleaseReservation%2A>.</span><span class="sxs-lookup"><span data-stu-id="2de07-171">When the target block later requires the message or no longer needs the message, it calls the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ConsumeMessage%2A?displayProperty=nameWithType> or <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ReleaseReservation%2A> method, respectively.</span></span> <span data-ttu-id="2de07-172">La réservation de messages est généralement utilisée par les types de blocs de flux de données qui fonctionnent en mode non gourmand.</span><span class="sxs-lookup"><span data-stu-id="2de07-172">Message reservation is typically used by the dataflow block types that operate in non-greedy mode.</span></span> <span data-ttu-id="2de07-173">Le mode non gourmand est expliqué plus loin dans ce document.</span><span class="sxs-lookup"><span data-stu-id="2de07-173">Non-greedy mode is explained later in this document.</span></span> <span data-ttu-id="2de07-174">Plutôt que de réserver un message différé, un bloc cible peut également utiliser la méthode <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ConsumeMessage%2A?displayProperty=nameWithType> pour tenter d'utiliser directement le message différé.</span><span class="sxs-lookup"><span data-stu-id="2de07-174">Instead of reserving a postponed message, a target block can also use the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ConsumeMessage%2A?displayProperty=nameWithType> method to attempt to directly consume the postponed message.</span></span>  
  
### <a name="dataflow-block-completion"></a><span data-ttu-id="2de07-175">Achèvement des blocs de flux de données</span><span class="sxs-lookup"><span data-stu-id="2de07-175">Dataflow Block Completion</span></span>  

 <span data-ttu-id="2de07-176">Les blocs de flux de données prennent également en charge le concept *d’achèvement*.</span><span class="sxs-lookup"><span data-stu-id="2de07-176">Dataflow blocks also support the concept of *completion*.</span></span> <span data-ttu-id="2de07-177">Un bloc de flux de données qui est achevé n'effectue plus aucune tâche.</span><span class="sxs-lookup"><span data-stu-id="2de07-177">A dataflow block that is in the completed state does not perform any further work.</span></span> <span data-ttu-id="2de07-178">Chaque bloc de flux de données est associé à un objet <xref:System.Threading.Tasks.Task?displayProperty=nameWithType>, appelé *tâche d'achèvement*, qui représente l'état d'achèvement du bloc.</span><span class="sxs-lookup"><span data-stu-id="2de07-178">Each dataflow block has an associated <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> object, known as a *completion task*, that represents the completion status of the block.</span></span> <span data-ttu-id="2de07-179">Étant donné que vous pouvez attendre qu'un objet <xref:System.Threading.Tasks.Task> soit terminé, vous pouvez, à l'aide de tâches d'achèvement, attendre l'achèvement d'un ou plusieurs nœuds terminaux d'un réseau de flux de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-179">Because you can wait for a <xref:System.Threading.Tasks.Task> object to finish, by using completion tasks, you can wait for one or more terminal nodes of a dataflow network to finish.</span></span> <span data-ttu-id="2de07-180">L'interface <xref:System.Threading.Tasks.Dataflow.IDataflowBlock> définit la méthode <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> qui informe le bloc de flux de données qu'une requête exige son achèvement, ainsi que la propriété <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> qui retourne la tâche d'achèvement pour le bloc de flux de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-180">The <xref:System.Threading.Tasks.Dataflow.IDataflowBlock> interface defines the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> method, which informs the dataflow block of a request for it to complete, and the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> property, which returns the completion task for the dataflow block.</span></span> <span data-ttu-id="2de07-181"><xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> et <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> héritent de l'interface <xref:System.Threading.Tasks.Dataflow.IDataflowBlock>.</span><span class="sxs-lookup"><span data-stu-id="2de07-181">Both <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> and <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> inherit the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock> interface.</span></span>  
  
 <span data-ttu-id="2de07-182">Il existe deux façons de déterminer si un bloc de flux de données s'est terminé sans erreur, si une ou plusieurs erreurs se sont produites ou s'il a été annulé.</span><span class="sxs-lookup"><span data-stu-id="2de07-182">There are two ways to determine whether a dataflow block completed without error, encountered one or more errors, or was canceled.</span></span> <span data-ttu-id="2de07-183">La première consiste à appeler la méthode <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> sur la tâche d'achèvement dans un bloc `try`-`catch` (`Try`-`Catch` en Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="2de07-183">The first way is to call the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method on the completion task in a `try`-`catch` block (`Try`-`Catch` in Visual Basic).</span></span> <span data-ttu-id="2de07-184">Dans l'exemple suivant, un <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> objet lève une exception <xref:System.ArgumentOutOfRangeException> si sa valeur d'entrée est inférieure à zéro.</span><span class="sxs-lookup"><span data-stu-id="2de07-184">The following example creates an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object that throws <xref:System.ArgumentOutOfRangeException> if its input value is less than zero.</span></span> <span data-ttu-id="2de07-185">L’exception <xref:System.AggregateException> est levée quand cet exemple appelle <xref:System.Threading.Tasks.Task.Wait%2A> sur la tâche d’achèvement.</span><span class="sxs-lookup"><span data-stu-id="2de07-185"><xref:System.AggregateException> is thrown when this example calls <xref:System.Threading.Tasks.Task.Wait%2A> on the completion task.</span></span> <span data-ttu-id="2de07-186"><xref:System.ArgumentOutOfRangeException> est accessible via la propriété <xref:System.AggregateException.InnerExceptions%2A> de l'objet <xref:System.AggregateException>.</span><span class="sxs-lookup"><span data-stu-id="2de07-186">The <xref:System.ArgumentOutOfRangeException> is accessed through the <xref:System.AggregateException.InnerExceptions%2A> property of the <xref:System.AggregateException> object.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#10](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#10)]
 [!code-vb[TPLDataflow_Overview#10](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#10)]  
  
 <span data-ttu-id="2de07-187">Dans cet exemple, une exception n'est pas gérée dans le délégué d'un bloc de flux de données d'exécution.</span><span class="sxs-lookup"><span data-stu-id="2de07-187">This example demonstrates the case in which an exception goes unhandled in the delegate of an execution dataflow block.</span></span> <span data-ttu-id="2de07-188">Nous vous recommandons de gérer les exceptions dans le corps des blocs.</span><span class="sxs-lookup"><span data-stu-id="2de07-188">We recommend that you handle exceptions in the bodies of such blocks.</span></span> <span data-ttu-id="2de07-189">Toutefois, si vous ne parvenez pas à le faire, le bloc se comportera comme s'il avait été annulé et ne traitera pas les messages entrants.</span><span class="sxs-lookup"><span data-stu-id="2de07-189">However, if you are unable to do so, the block behaves as though it was canceled and does not process incoming messages.</span></span>  
  
 <span data-ttu-id="2de07-190">Quand un bloc de flux de données est annulé de manière explicite, l'objet <xref:System.AggregateException> contient <xref:System.OperationCanceledException> dans la propriété <xref:System.AggregateException.InnerExceptions%2A>.</span><span class="sxs-lookup"><span data-stu-id="2de07-190">When a dataflow block is canceled explicitly, the <xref:System.AggregateException> object contains <xref:System.OperationCanceledException> in the <xref:System.AggregateException.InnerExceptions%2A> property.</span></span> <span data-ttu-id="2de07-191">Pour plus d’informations sur l’annulation de flux de données, consultez la section [Permettre les annulations](#enabling-cancellation).</span><span class="sxs-lookup"><span data-stu-id="2de07-191">For more information about dataflow cancellation, see [Enabling Cancellation](#enabling-cancellation) section.</span></span>  
  
 <span data-ttu-id="2de07-192">La deuxième méthode permettant de déterminer l’état d’achèvement d’un bloc de flux de données est d’utiliser une continuation de la tâche d’achèvement, ou d’utiliser les fonctionnalités de langage asynchrones de C# et de Visual Basic pour attendre la tâche d’achèvement de manière asynchrone.</span><span class="sxs-lookup"><span data-stu-id="2de07-192">The second way to determine the completion status of a dataflow block is to use a continuation of the completion task, or to use the asynchronous language features of C# and Visual Basic to asynchronously wait for the completion task.</span></span> <span data-ttu-id="2de07-193">Le délégué que vous fournissez à la méthode <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> prend un objet <xref:System.Threading.Tasks.Task> qui représente la tâche précédente.</span><span class="sxs-lookup"><span data-stu-id="2de07-193">The delegate that you provide to the <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> method takes a <xref:System.Threading.Tasks.Task> object that represents the antecedent task.</span></span> <span data-ttu-id="2de07-194">Dans le cas de la propriété <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A>, le délégué de la continuation prend la tâche d'achèvement.</span><span class="sxs-lookup"><span data-stu-id="2de07-194">In the case of the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> property, the delegate for the continuation takes the completion task itself.</span></span> <span data-ttu-id="2de07-195">L’exemple suivant ressemble au précédent, mais il utilise également la méthode <xref:System.Threading.Tasks.Task.ContinueWith%2A> pour créer une tâche de continuation qui imprime l’état de l’opération globale de flux de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-195">The following example resembles the previous one, except that it also uses the <xref:System.Threading.Tasks.Task.ContinueWith%2A> method to create a continuation task that prints the status of the overall dataflow operation.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#11](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#11)]
 [!code-vb[TPLDataflow_Overview#11](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#11)]  
  
 <span data-ttu-id="2de07-196">Vous pouvez également utiliser des propriétés telles que <xref:System.Threading.Tasks.Task.IsCanceled%2A> dans le corps de la tâche de continuation pour obtenir des informations supplémentaires sur l'état d'achèvement d'un bloc de flux de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-196">You can also use properties such as <xref:System.Threading.Tasks.Task.IsCanceled%2A> in the body of the continuation task to determine additional information about the completion status of a dataflow block.</span></span> <span data-ttu-id="2de07-197">Pour plus d’informations sur les tâches de continuation et leur rôle dans les annulations et la gestion des erreurs, consultez [Chaînage des tâches à l’aide de tâches de continuation](chaining-tasks-by-using-continuation-tasks.md), [Annulation de tâches](task-cancellation.md) et [Gestion des exceptions](exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-197">For more information about continuation tasks and how they relate to cancellation and error handling, see [Chaining Tasks by Using Continuation Tasks](chaining-tasks-by-using-continuation-tasks.md), [Task Cancellation](task-cancellation.md), and [Exception Handling](exception-handling-task-parallel-library.md).</span></span>  

## <a name="predefined-dataflow-block-types"></a><span data-ttu-id="2de07-198">Types de blocs de flux de données prédéfinis</span><span class="sxs-lookup"><span data-stu-id="2de07-198">Predefined Dataflow Block Types</span></span>  

 <span data-ttu-id="2de07-199">La bibliothèque de flux de données TPL fournit plusieurs types de blocs de flux de données prédéfinis.</span><span class="sxs-lookup"><span data-stu-id="2de07-199">The TPL Dataflow Library provides several predefined dataflow block types.</span></span> <span data-ttu-id="2de07-200">Ces types sont répartis en trois catégories : *blocs de mise en mémoire tampon*, *blocs d’exécution* et *blocs de regroupement*.</span><span class="sxs-lookup"><span data-stu-id="2de07-200">These types are divided into three categories: *buffering blocks*, *execution blocks*, and *grouping blocks*.</span></span> <span data-ttu-id="2de07-201">Les sections suivantes décrivent les types de blocs qui composent ces catégories.</span><span class="sxs-lookup"><span data-stu-id="2de07-201">The following sections describe the block types that make up these categories.</span></span>  
  
### <a name="buffering-blocks"></a><span data-ttu-id="2de07-202">Blocs de mise en mémoire tampon</span><span class="sxs-lookup"><span data-stu-id="2de07-202">Buffering Blocks</span></span>  

 <span data-ttu-id="2de07-203">Les blocs de mise en mémoire tampon contiennent des données destinées aux consommateurs de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-203">Buffering blocks hold data for use by data consumers.</span></span> <span data-ttu-id="2de07-204">La bibliothèque de flux de données TPL fournit trois types de blocs de mise en mémoire tampon : <xref:System.Threading.Tasks.Dataflow.BufferBlock%601?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601?displayProperty=nameWithType> et <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2de07-204">The TPL Dataflow Library provides three buffering block types: <xref:System.Threading.Tasks.Dataflow.BufferBlock%601?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601?displayProperty=nameWithType>, and <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601?displayProperty=nameWithType>.</span></span>  
  
#### <a name="bufferblockt"></a><span data-ttu-id="2de07-205">BufferBlock(T)</span><span class="sxs-lookup"><span data-stu-id="2de07-205">BufferBlock(T)</span></span>  

 <span data-ttu-id="2de07-206">La classe <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> représente une structure de messagerie asynchrone à usage général.</span><span class="sxs-lookup"><span data-stu-id="2de07-206">The <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> class represents a general-purpose asynchronous messaging structure.</span></span> <span data-ttu-id="2de07-207">Cette classe stocke une file d'attente de messages de type premier entré, premier sorti (FIFO). Plusieurs cibles peuvent lire ces messages et plusieurs sources peuvent y écrire.</span><span class="sxs-lookup"><span data-stu-id="2de07-207">This class stores a first in, first out (FIFO) queue of messages that can be written to by multiple sources or read from by multiple targets.</span></span> <span data-ttu-id="2de07-208">Quand une cible reçoit un message d'un objet <xref:System.Threading.Tasks.Dataflow.BufferBlock%601>, ce message est supprimé de la file d'attente.</span><span class="sxs-lookup"><span data-stu-id="2de07-208">When a target receives a message from a <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> object, that message is removed from the message queue.</span></span> <span data-ttu-id="2de07-209">Par conséquent, même si un objet <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> peut avoir plusieurs cibles, seule une cible reçoit chaque message.</span><span class="sxs-lookup"><span data-stu-id="2de07-209">Therefore, although a <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> object can have multiple targets, only one target will receive each message.</span></span> <span data-ttu-id="2de07-210">La classe <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> est utile quand vous voulez transmettre plusieurs messages à un autre composant et que ce composant doit recevoir chaque message.</span><span class="sxs-lookup"><span data-stu-id="2de07-210">The <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> class is useful when you want to pass multiple messages to another component, and that component must receive each message.</span></span>  
  
 <span data-ttu-id="2de07-211">Dans l'exemple simple qui suit, plusieurs valeurs <xref:System.Int32> sont publiées sur un objet <xref:System.Threading.Tasks.Dataflow.BufferBlock%601>, puis sont lues depuis l'objet.</span><span class="sxs-lookup"><span data-stu-id="2de07-211">The following basic example posts several <xref:System.Int32> values to a <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> object and then reads those values back from that object.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#1)]
 [!code-vb[TPLDataflow_Overview#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#1)]  
  
 <span data-ttu-id="2de07-212">Vous trouverez un exemple complet montrant comment écrire et lire des messages dans un objet <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> sur la page [Guide pratique : écrire et lire des messages dans un bloc de flux de données](how-to-write-messages-to-and-read-messages-from-a-dataflow-block.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-212">For a complete example that demonstrates how to write messages to and read messages from a <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> object, see [How to: Write Messages to and Read Messages from a Dataflow Block](how-to-write-messages-to-and-read-messages-from-a-dataflow-block.md).</span></span>  
  
#### <a name="broadcastblockt"></a><span data-ttu-id="2de07-213">BroadcastBlock(T)</span><span class="sxs-lookup"><span data-stu-id="2de07-213">BroadcastBlock(T)</span></span>  

 <span data-ttu-id="2de07-214">La classe <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> est utile quand vous devez transmettre plusieurs messages à un autre composant, mais que ce composant nécessite uniquement la valeur la plus récente.</span><span class="sxs-lookup"><span data-stu-id="2de07-214">The <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> class is useful when you must pass multiple messages to another component, but that component needs only the most recent value.</span></span> <span data-ttu-id="2de07-215">Cette classe est également utile quand vous voulez diffuser un message vers plusieurs composants.</span><span class="sxs-lookup"><span data-stu-id="2de07-215">This class is also useful when you want to broadcast a message to multiple components.</span></span>  
  
 <span data-ttu-id="2de07-216">Dans l'exemple simple qui suit, une valeur <xref:System.Double> est publiée sur un objet <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601>, puis est lue plusieurs fois depuis l'objet.</span><span class="sxs-lookup"><span data-stu-id="2de07-216">The following basic example posts a <xref:System.Double> value to a <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> object and then reads that value back from that object several times.</span></span> <span data-ttu-id="2de07-217">Étant donné que les valeurs ne sont pas supprimées des objets <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> après leur lecture, la même valeur est disponible à chaque fois.</span><span class="sxs-lookup"><span data-stu-id="2de07-217">Because values are not removed from <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> objects after they are read, the same value is available every time.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#2)]
 [!code-vb[TPLDataflow_Overview#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#2)]  
  
 <span data-ttu-id="2de07-218">Vous trouverez un exemple complet montrant comment utiliser <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> pour diffuser un message vers plusieurs blocs cibles sur la page [Guide pratique : spécifier un Planificateur de tâches dans un bloc de flux de données](how-to-specify-a-task-scheduler-in-a-dataflow-block.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-218">For a complete example that demonstrates how to use <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> to broadcast a message to multiple target blocks, see [How to: Specify a Task Scheduler in a Dataflow Block](how-to-specify-a-task-scheduler-in-a-dataflow-block.md).</span></span>  
  
#### <a name="writeonceblockt"></a><span data-ttu-id="2de07-219">WriteOnceBlock(T)</span><span class="sxs-lookup"><span data-stu-id="2de07-219">WriteOnceBlock(T)</span></span>  

 <span data-ttu-id="2de07-220">La classe <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> est similaire à la classe <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601>, à ceci près qu'il n'est possible d'écrire qu'une seule fois dans un objet <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601>.</span><span class="sxs-lookup"><span data-stu-id="2de07-220">The <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> class resembles the <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> class, except that a <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> object can be written to one time only.</span></span> <span data-ttu-id="2de07-221">Vous pouvez assimiler <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> au mot clé [readonly](../../csharp/language-reference/keywords/readonly.md) en C# ([ReadOnly](../../visual-basic/language-reference/modifiers/readonly.md) en Visual Basic). Toutefois, la différence se trouve dans le fait qu'un objet <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> devient immuable après avoir reçu une valeur, et non à la construction.</span><span class="sxs-lookup"><span data-stu-id="2de07-221">You can think of <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> as being similar to the C# [readonly](../../csharp/language-reference/keywords/readonly.md) ([ReadOnly](../../visual-basic/language-reference/modifiers/readonly.md) in Visual Basic) keyword, except that a <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> object becomes immutable after it receives a value instead of at construction.</span></span> <span data-ttu-id="2de07-222">Comme pour la classe <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601>, quand une cible reçoit un message d'un objet <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601>, le message n'est pas supprimé de l'objet.</span><span class="sxs-lookup"><span data-stu-id="2de07-222">Like the <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> class, when a target receives a message from a <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> object, that message is not removed from that object.</span></span> <span data-ttu-id="2de07-223">Par conséquent, plusieurs cibles reçoivent une copie du message.</span><span class="sxs-lookup"><span data-stu-id="2de07-223">Therefore, multiple targets receive a copy of the message.</span></span> <span data-ttu-id="2de07-224">La classe <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> est utile quand vous voulez propager uniquement le premier d'une liste de messages.</span><span class="sxs-lookup"><span data-stu-id="2de07-224">The <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> class is useful when you want to propagate only the first of multiple messages.</span></span>  
  
 <span data-ttu-id="2de07-225">Dans l'exemple simple qui suit, plusieurs valeurs <xref:System.String> sont publiées sur un objet <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601>, puis sont lues depuis l'objet.</span><span class="sxs-lookup"><span data-stu-id="2de07-225">The following basic example posts multiple <xref:System.String> values to a <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> object and then reads the value back from that object.</span></span> <span data-ttu-id="2de07-226">Étant donné qu'il n'est possible d'écrire dans un objet <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> qu'une seule fois, une fois qu'un objet <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> reçoit un message, il rejette les messages suivants.</span><span class="sxs-lookup"><span data-stu-id="2de07-226">Because a <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> object can be written to one time only, after a <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> object receives a message, it discards subsequent messages.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#3)]
 [!code-vb[TPLDataflow_Overview#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#3)]  
  
 <span data-ttu-id="2de07-227">Vous trouverez un exemple complet montrant comment utiliser <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> pour recevoir la valeur de la première opération terminée sur la page [Guide pratique : dissocier des blocs de flux de données](how-to-unlink-dataflow-blocks.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-227">For a complete example that demonstrates how to use <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> to receive the value of the first operation that finishes, see [How to: Unlink Dataflow Blocks](how-to-unlink-dataflow-blocks.md).</span></span>  
  
### <a name="execution-blocks"></a><span data-ttu-id="2de07-228">Blocs d'exécution</span><span class="sxs-lookup"><span data-stu-id="2de07-228">Execution Blocks</span></span>  

 <span data-ttu-id="2de07-229">Les blocs d'exécution appellent un délégué fourni par l'utilisateur pour chaque donnée reçue.</span><span class="sxs-lookup"><span data-stu-id="2de07-229">Execution blocks call a user-provided delegate for each piece of received data.</span></span> <span data-ttu-id="2de07-230">La bibliothèque de flux de données TPL fournit trois types de blocs d'exécution : <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602?displayProperty=nameWithType> et <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2de07-230">The TPL Dataflow Library provides three execution block types: <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602?displayProperty=nameWithType>, and <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602?displayProperty=nameWithType>.</span></span>  
  
#### <a name="actionblockt"></a><span data-ttu-id="2de07-231">ActionBlock(T)</span><span class="sxs-lookup"><span data-stu-id="2de07-231">ActionBlock(T)</span></span>  

 <span data-ttu-id="2de07-232">La classe <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> est un bloc cible qui appelle un délégué quand il reçoit des données.</span><span class="sxs-lookup"><span data-stu-id="2de07-232">The <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> class is a target block that calls a delegate when it receives data.</span></span> <span data-ttu-id="2de07-233">Imaginez un objet <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> utilisé comme un délégué qui s'exécute de façon asynchrone quand des données deviennent disponibles.</span><span class="sxs-lookup"><span data-stu-id="2de07-233">Think of a <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object as a delegate that runs asynchronously when data becomes available.</span></span> <span data-ttu-id="2de07-234">Le délégué que vous fournissez à un objet <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> peut être de type <xref:System.Action%601> ou `System.Func<TInput, Task>`.</span><span class="sxs-lookup"><span data-stu-id="2de07-234">The delegate that you provide to an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object can be of type <xref:System.Action%601> or type `System.Func<TInput, Task>`.</span></span> <span data-ttu-id="2de07-235">Quand vous utilisez un objet <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> avec <xref:System.Action%601>, le traitement de chaque élément d'entrée est considéré comme terminé quand le délégué est retourné.</span><span class="sxs-lookup"><span data-stu-id="2de07-235">When you use an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object with <xref:System.Action%601>, processing of each input element is considered completed when the delegate returns.</span></span> <span data-ttu-id="2de07-236">Quand vous utilisez un objet <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> avec `System.Func<TInput, Task>`, le traitement de chaque élément d'entrée n'est considéré comme terminé que quand l'objet <xref:System.Threading.Tasks.Task> retourné est à l'état achevé.</span><span class="sxs-lookup"><span data-stu-id="2de07-236">When you use an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object with `System.Func<TInput, Task>`, processing of each input element is considered completed only when the returned <xref:System.Threading.Tasks.Task> object is completed.</span></span> <span data-ttu-id="2de07-237">À l'aide de ces deux mécanismes, vous pouvez utiliser <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> pour le traitement synchrone et asynchrone de chaque élément d'entrée.</span><span class="sxs-lookup"><span data-stu-id="2de07-237">By using these two mechanisms, you can use <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> for both synchronous and asynchronous processing of each input element.</span></span>  
  
 <span data-ttu-id="2de07-238">Dans l'exemple simple qui suit, plusieurs valeurs <xref:System.Int32> sont publiées sur un objet <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>.</span><span class="sxs-lookup"><span data-stu-id="2de07-238">The following basic example posts multiple <xref:System.Int32> values to an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object.</span></span> <span data-ttu-id="2de07-239">L'objet <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> imprime ces valeurs dans la console.</span><span class="sxs-lookup"><span data-stu-id="2de07-239">The <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object prints those values to the console.</span></span> <span data-ttu-id="2de07-240">Cet exemple attribue ensuite au bloc l'état achevé, puis attend que toutes les tâches de flux de données soient terminées.</span><span class="sxs-lookup"><span data-stu-id="2de07-240">This example then sets the block to the completed state and waits for all dataflow tasks to finish.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#4)]
 [!code-vb[TPLDataflow_Overview#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#4)]  
  
 <span data-ttu-id="2de07-241">Vous trouverez des exemples complets montrant comment utiliser des délégués avec la classe <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> sur la page [Guide pratique : exécuter des actions lorsqu'un bloc de flux de données reçoit des données](how-to-perform-action-when-a-dataflow-block-receives-data.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-241">For complete examples that demonstrate how to use delegates with the <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> class, see [How to: Perform Action When a Dataflow Block Receives Data](how-to-perform-action-when-a-dataflow-block-receives-data.md).</span></span>  
  
#### <a name="transformblocktinput-toutput"></a><span data-ttu-id="2de07-242">TransformBlock(TInput, TOutput)</span><span class="sxs-lookup"><span data-stu-id="2de07-242">TransformBlock(TInput, TOutput)</span></span>  

 <span data-ttu-id="2de07-243">La classe <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> est similaire à la classe <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, à ceci près qu'elle joue à la fois le rôle de source et le rôle de cible.</span><span class="sxs-lookup"><span data-stu-id="2de07-243">The <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> class resembles the <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> class, except that it acts as both a source and as a target.</span></span> <span data-ttu-id="2de07-244">Le délégué que vous passez à un objet <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> renvoie une valeur de type `TOutput`.</span><span class="sxs-lookup"><span data-stu-id="2de07-244">The delegate that you pass to a <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> object returns a value of type `TOutput`.</span></span> <span data-ttu-id="2de07-245">Le délégué que vous fournissez à un objet <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> peut être de type `System.Func<TInput, TOutput>` ou `System.Func<TInput, Task<TOutput>>`.</span><span class="sxs-lookup"><span data-stu-id="2de07-245">The delegate that you provide to a <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> object can be of type `System.Func<TInput, TOutput>` or type `System.Func<TInput, Task<TOutput>>`.</span></span> <span data-ttu-id="2de07-246">Quand vous utilisez un objet <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> avec `System.Func<TInput, TOutput>`, le traitement de chaque élément d'entrée est considéré comme terminé quand le délégué est retourné.</span><span class="sxs-lookup"><span data-stu-id="2de07-246">When you use a <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> object with `System.Func<TInput, TOutput>`, processing of each input element is considered completed when the delegate returns.</span></span> <span data-ttu-id="2de07-247">Quand vous utilisez un objet <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> utilisé avec `System.Func<TInput, Task<TOutput>>`, le traitement de chaque élément d'entrée n'est considéré comme terminé que quand l'objet <xref:System.Threading.Tasks.Task%601> retourné est à l'état achevé.</span><span class="sxs-lookup"><span data-stu-id="2de07-247">When you use a <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> object used with `System.Func<TInput, Task<TOutput>>`, processing of each input element is considered completed only when the returned <xref:System.Threading.Tasks.Task%601> object is completed.</span></span> <span data-ttu-id="2de07-248">Comme pour <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, ces deux mécanismes vous permettent d'utiliser <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> pour le traitement synchrone et asynchrone de chaque élément d'entrée.</span><span class="sxs-lookup"><span data-stu-id="2de07-248">As with <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, by using these two mechanisms, you can use <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> for both synchronous and asynchronous processing of each input element.</span></span>  
  
 <span data-ttu-id="2de07-249">Dans l'exemple simple qui suit, l'objet <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> créé calcule la racine carrée de son entrée.</span><span class="sxs-lookup"><span data-stu-id="2de07-249">The following basic example creates a <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> object that computes the square root of its input.</span></span> <span data-ttu-id="2de07-250">L'objet <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> prend des valeurs <xref:System.Int32> comme entrée et produit des valeurs <xref:System.Double> comme sortie.</span><span class="sxs-lookup"><span data-stu-id="2de07-250">The <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> object takes <xref:System.Int32> values as input and produces <xref:System.Double> values as output.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#5)]
 [!code-vb[TPLDataflow_Overview#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#5)]  
  
 <span data-ttu-id="2de07-251">Vous trouverez des exemples complets utilisant <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> dans un réseau de blocs de flux de données qui réalise un traitement d’image dans une application Windows Forms sur la page [Procédure pas à pas : utiliser un flux de données dans une application Windows Forms](walkthrough-using-dataflow-in-a-windows-forms-application.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-251">For complete examples that uses <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> in a network of dataflow blocks that performs image processing in a Windows Forms application, see [Walkthrough: Using Dataflow in a Windows Forms Application](walkthrough-using-dataflow-in-a-windows-forms-application.md).</span></span>  
  
#### <a name="transformmanyblocktinput-toutput"></a><span data-ttu-id="2de07-252">TransformManyBlock(TInput, TOutput)</span><span class="sxs-lookup"><span data-stu-id="2de07-252">TransformManyBlock(TInput, TOutput)</span></span>  

 <span data-ttu-id="2de07-253">La classe <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> est similaire à la classe <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>, à ceci près que <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> produit zéro, une ou plusieurs valeurs de sortie pour chaque valeur d'entrée, au lieu d'une seule valeur de sortie pour chaque valeur d'entrée.</span><span class="sxs-lookup"><span data-stu-id="2de07-253">The <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> class resembles the <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> class, except that <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> produces zero or more output values for each input value, instead of only one output value for each input value.</span></span> <span data-ttu-id="2de07-254">Le délégué que vous fournissez à un objet <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> peut être de type `System.Func<TInput, IEnumerable<TOutput>>` ou `System.Func<TInput, Task<IEnumerable<TOutput>>>`.</span><span class="sxs-lookup"><span data-stu-id="2de07-254">The delegate that you provide to a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object can be of type `System.Func<TInput, IEnumerable<TOutput>>` or type `System.Func<TInput, Task<IEnumerable<TOutput>>>`.</span></span> <span data-ttu-id="2de07-255">Quand vous utilisez un objet <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> avec `System.Func<TInput, IEnumerable<TOutput>>`, le traitement de chaque élément d'entrée est considéré comme terminé quand le délégué est retourné.</span><span class="sxs-lookup"><span data-stu-id="2de07-255">When you use a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object with `System.Func<TInput, IEnumerable<TOutput>>`, processing of each input element is considered completed when the delegate returns.</span></span> <span data-ttu-id="2de07-256">Quand vous utilisez un objet <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> avec `System.Func<TInput, Task<IEnumerable<TOutput>>>`, le traitement de chaque élément d'entrée n'est considéré comme terminé que quand l'objet `System.Threading.Tasks.Task<IEnumerable<TOutput>>` retourné est à l'état achevé.</span><span class="sxs-lookup"><span data-stu-id="2de07-256">When you use a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object with `System.Func<TInput, Task<IEnumerable<TOutput>>>`, processing of each input element is considered complete only when the returned `System.Threading.Tasks.Task<IEnumerable<TOutput>>` object is completed.</span></span>  
  
 <span data-ttu-id="2de07-257">Dans l'exemple simple qui suit, l'objet <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> créé fractionne les chaînes en séquences de caractères.</span><span class="sxs-lookup"><span data-stu-id="2de07-257">The following basic example creates a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object that splits strings into their individual character sequences.</span></span> <span data-ttu-id="2de07-258">L'objet <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> prend des valeurs <xref:System.String> comme entrée et produit des valeurs <xref:System.Char> comme sortie.</span><span class="sxs-lookup"><span data-stu-id="2de07-258">The <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object takes <xref:System.String> values as input and produces <xref:System.Char> values as output.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#6)]
 [!code-vb[TPLDataflow_Overview#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#6)]  
  
 <span data-ttu-id="2de07-259">Vous trouverez des exemples complets utilisant <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> pour produire plusieurs sorties indépendantes pour chaque entrée dans un pipeline de flux de données sur la page [Procédure pas à pas : créer un pipeline de flux de données](walkthrough-creating-a-dataflow-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-259">For complete examples that use <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> to produce multiple independent outputs for each input in a dataflow pipeline, see [Walkthrough: Creating a Dataflow Pipeline](walkthrough-creating-a-dataflow-pipeline.md).</span></span>  
  
#### <a name="degree-of-parallelism"></a><span data-ttu-id="2de07-260">Degré de parallélisme</span><span class="sxs-lookup"><span data-stu-id="2de07-260">Degree of Parallelism</span></span>  

 <span data-ttu-id="2de07-261">Chaque objet <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> et <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> met en mémoire tampon les messages entrants jusqu'à ce que le bloc soit prêt à les traiter.</span><span class="sxs-lookup"><span data-stu-id="2de07-261">Every <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>, and <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object buffers input messages until the block is ready to process them.</span></span> <span data-ttu-id="2de07-262">Par défaut, ces classes de traitent les messages un par un, dans l'ordre dans lequel ils sont reçus.</span><span class="sxs-lookup"><span data-stu-id="2de07-262">By default, these classes process messages in the order in which they are received, one message at a time.</span></span> <span data-ttu-id="2de07-263">Vous pouvez également spécifier le degré de parallélisme permettant aux objets <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> et <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> de traiter plusieurs messages simultanément.</span><span class="sxs-lookup"><span data-stu-id="2de07-263">You can also specify the degree of parallelism to enable <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> and <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> objects to process multiple messages concurrently.</span></span> <span data-ttu-id="2de07-264">Pour plus d'informations sur l'exécution simultanée, consultez la section "Spécification du degré de parallélisme" plus loin dans ce document.</span><span class="sxs-lookup"><span data-stu-id="2de07-264">For more information about concurrent execution, see the section Specifying the Degree of Parallelism later in this document.</span></span> <span data-ttu-id="2de07-265">Vous trouverez un exemple dans lequel un degré de parallélisme est défini pour permettre à un bloc de flux de données d’exécution de traiter plusieurs messages à la fois sur la page [Guide pratique : spécifier le degré de parallélisme dans un bloc de flux de données](how-to-specify-the-degree-of-parallelism-in-a-dataflow-block.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-265">For an example that sets the degree of parallelism to enable an execution dataflow block to process more than one message at a time, see [How to: Specify the Degree of Parallelism in a Dataflow Block](how-to-specify-the-degree-of-parallelism-in-a-dataflow-block.md).</span></span>  
  
#### <a name="summary-of-delegate-types"></a><span data-ttu-id="2de07-266">Récapitulation des types délégués</span><span class="sxs-lookup"><span data-stu-id="2de07-266">Summary of Delegate Types</span></span>  

 <span data-ttu-id="2de07-267">Le tableau suivant récapitule les types délégués que vous pouvez fournir aux objets <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> et <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>.</span><span class="sxs-lookup"><span data-stu-id="2de07-267">The following table summarizes the delegate types that you can provide to <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>, and <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> objects.</span></span> <span data-ttu-id="2de07-268">Le tableau indique également si le type délégué fonctionne de façon synchrone ou asynchrone.</span><span class="sxs-lookup"><span data-stu-id="2de07-268">This table also specifies whether the delegate type operates synchronously or asynchronously.</span></span>  
  
|<span data-ttu-id="2de07-269">Type</span><span class="sxs-lookup"><span data-stu-id="2de07-269">Type</span></span>|<span data-ttu-id="2de07-270">Type délégué synchrone</span><span class="sxs-lookup"><span data-stu-id="2de07-270">Synchronous Delegate Type</span></span>|<span data-ttu-id="2de07-271">Type délégué asynchrone</span><span class="sxs-lookup"><span data-stu-id="2de07-271">Asynchronous Delegate Type</span></span>|  
|----------|-------------------------------|--------------------------------|  
|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|`System.Action`|`System.Func<TInput, Task>`|  
|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|`System.Func<TInput, TOutput>`|`System.Func<TInput, Task<TOutput>>`|  
|<xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>|`System.Func<TInput, IEnumerable<TOutput>>`|`System.Func<TInput, Task<IEnumerable<TOutput>>>`|  
  
 <span data-ttu-id="2de07-272">Vous pouvez également utiliser des expressions lambda quand vous utilisez des types de blocs d'exécution.</span><span class="sxs-lookup"><span data-stu-id="2de07-272">You can also use lambda expressions when you work with execution block types.</span></span> <span data-ttu-id="2de07-273">Vous trouverez un exemple qui montre comment utiliser une expression lambda avec un bloc d’exécution sur la page [Guide pratique : exécuter des actions lorsqu’un bloc de flux de données reçoit des données](how-to-perform-action-when-a-dataflow-block-receives-data.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-273">For an example that shows how to use a lambda expression with an execution block, see [How to: Perform Action When a Dataflow Block Receives Data](how-to-perform-action-when-a-dataflow-block-receives-data.md).</span></span>  
  
### <a name="grouping-blocks"></a><span data-ttu-id="2de07-274">Blocs de regroupement</span><span class="sxs-lookup"><span data-stu-id="2de07-274">Grouping Blocks</span></span>  

 <span data-ttu-id="2de07-275">Les blocs de regroupement combinent les données d'une ou plusieurs sources, sous diverses contraintes.</span><span class="sxs-lookup"><span data-stu-id="2de07-275">Grouping blocks combine data from one or more sources and under various constraints.</span></span> <span data-ttu-id="2de07-276">La bibliothèque de flux de données TPL fournit trois types de blocs de regroupement : <xref:System.Threading.Tasks.Dataflow.BatchBlock%601>, <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> et <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602>.</span><span class="sxs-lookup"><span data-stu-id="2de07-276">The TPL Dataflow Library provides three join block types: <xref:System.Threading.Tasks.Dataflow.BatchBlock%601>, <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>, and <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602>.</span></span>  
  
#### <a name="batchblockt"></a><span data-ttu-id="2de07-277">BatchBlock(T)</span><span class="sxs-lookup"><span data-stu-id="2de07-277">BatchBlock(T)</span></span>  

 <span data-ttu-id="2de07-278">La classe <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> combine des jeux de données d'entrée (ou lots), dans des tableaux de données de sortie.</span><span class="sxs-lookup"><span data-stu-id="2de07-278">The <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> class combines sets of input data, which are known as batches, into arrays of output data.</span></span> <span data-ttu-id="2de07-279">Vous spécifiez la taille de chaque lot quand vous créez un objet <xref:System.Threading.Tasks.Dataflow.BatchBlock%601>.</span><span class="sxs-lookup"><span data-stu-id="2de07-279">You specify the size of each batch when you create a <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object.</span></span> <span data-ttu-id="2de07-280">Quand l'objet <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> reçoit le nombre spécifié d'éléments d'entrée, il propage de manière asynchrone un tableau contenant ces éléments.</span><span class="sxs-lookup"><span data-stu-id="2de07-280">When the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object receives the specified count of input elements, it asynchronously propagates out an array that contains those elements.</span></span> <span data-ttu-id="2de07-281">Si un objet <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> est à l'état achevé, mais ne contient pas suffisamment d'éléments pour former un lot, il propage un tableau final contenant les éléments d'entrée restants.</span><span class="sxs-lookup"><span data-stu-id="2de07-281">If a <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object is set to the completed state but does not contain enough elements to form a batch, it propagates out a final array that contains the remaining input elements.</span></span>  
  
 <span data-ttu-id="2de07-282">La classe <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> peut fonctionner en mode *gourmand* ou *non gourmand*.</span><span class="sxs-lookup"><span data-stu-id="2de07-282">The <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> class operates in either *greedy* or *non-greedy* mode.</span></span> <span data-ttu-id="2de07-283">En mode gourmand, qui est le mode par défaut, un objet <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> accepte tous les messages qui lui sont envoyés et propage un tableau après avoir reçu le nombre spécifié d'éléments.</span><span class="sxs-lookup"><span data-stu-id="2de07-283">In greedy mode, which is the default, a <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object accepts every message that it is offered and propagates out an array after it receives the specified count of elements.</span></span> <span data-ttu-id="2de07-284">En mode non gourmand, un objet <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> diffère tous les messages entrants jusqu'à ce que suffisamment de sources aient envoyé au bloc un nombre de messages permettant de former un lot.</span><span class="sxs-lookup"><span data-stu-id="2de07-284">In non-greedy mode, a <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object postpones all incoming messages until enough sources have offered messages to the block to form a batch.</span></span> <span data-ttu-id="2de07-285">Le mode gourmand est généralement plus performant que le mode non gourmand, car il nécessite une charge de traitement moindre.</span><span class="sxs-lookup"><span data-stu-id="2de07-285">Greedy mode typically performs better than non-greedy mode because it requires less processing overhead.</span></span> <span data-ttu-id="2de07-286">Toutefois, vous pouvez utiliser le mode non gourmand quand vous devez coordonner la consommation de plusieurs sources de façon atomique.</span><span class="sxs-lookup"><span data-stu-id="2de07-286">However, you can use non-greedy mode when you must coordinate consumption from multiple sources in an atomic fashion.</span></span> <span data-ttu-id="2de07-287">Pour spécifier le mode non gourmand, définissez <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> sur `False` dans le paramètre `dataflowBlockOptions` du constructeur <xref:System.Threading.Tasks.Dataflow.BatchBlock%601.%23ctor%2A>.</span><span class="sxs-lookup"><span data-stu-id="2de07-287">Specify non-greedy mode by setting <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> to `False` in the `dataflowBlockOptions` parameter in the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601.%23ctor%2A> constructor.</span></span>  
  
 <span data-ttu-id="2de07-288">Dans l'exemple simple qui suit, plusieurs valeurs <xref:System.Int32> sont publiées sur un objet <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> qui contient un lot de dix éléments.</span><span class="sxs-lookup"><span data-stu-id="2de07-288">The following basic example posts several <xref:System.Int32> values to a <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object that holds ten elements in a batch.</span></span> <span data-ttu-id="2de07-289">Pour garantir que toutes les valeurs de <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> soient propagées, cet exemple appelle la méthode <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A>.</span><span class="sxs-lookup"><span data-stu-id="2de07-289">To guarantee that all values propagate out of the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601>, this example calls the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> method.</span></span> <span data-ttu-id="2de07-290">La méthode <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> définit l'objet <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> sur l'état achevé. L'objet <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> propage donc les éléments restants dans un dernier lot.</span><span class="sxs-lookup"><span data-stu-id="2de07-290">The <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> method sets the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object to the completed state, and therefore, the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object propagates out any remaining elements as a final batch.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#7)]
 [!code-vb[TPLDataflow_Overview#7](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#7)]  
  
 <span data-ttu-id="2de07-291">Vous trouverez un exemple complet utilisant <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> pour améliorer l'efficacité des opérations d'insertion en base de données sur la page [Procédure pas à pas : utiliser BatchBlock et BatchedJoinBlock pour améliorer l'efficacité](walkthrough-using-batchblock-and-batchedjoinblock-to-improve-efficiency.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-291">For a complete example that uses <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> to improve the efficiency of database insert operations, see [Walkthrough: Using BatchBlock and BatchedJoinBlock to Improve Efficiency](walkthrough-using-batchblock-and-batchedjoinblock-to-improve-efficiency.md).</span></span>  
  
#### <a name="joinblockt1-t2-"></a><span data-ttu-id="2de07-292">JoinBlock(T1, T2,...)</span><span class="sxs-lookup"><span data-stu-id="2de07-292">JoinBlock(T1, T2, ...)</span></span>  

 <span data-ttu-id="2de07-293">Les classes <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> et <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> collectent des éléments d'entrée et propagent les objets <xref:System.Tuple%602?displayProperty=nameWithType> ou <xref:System.Tuple%603?displayProperty=nameWithType> qui contiennent ces éléments.</span><span class="sxs-lookup"><span data-stu-id="2de07-293">The <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> and <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> classes collect input elements and propagate out <xref:System.Tuple%602?displayProperty=nameWithType> or <xref:System.Tuple%603?displayProperty=nameWithType> objects that contain those elements.</span></span> <span data-ttu-id="2de07-294">Les classes <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> et <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> n'héritent pas de <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.</span><span class="sxs-lookup"><span data-stu-id="2de07-294">The <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> and <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> classes do not inherit from <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.</span></span> <span data-ttu-id="2de07-295">Au lieu de cela, elles fournissent les propriétés <xref:System.Threading.Tasks.Dataflow.JoinBlock%602.Target1%2A>, <xref:System.Threading.Tasks.Dataflow.JoinBlock%602.Target2%2A> et <xref:System.Threading.Tasks.Dataflow.JoinBlock%603.Target3%2A> qui implémentent <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.</span><span class="sxs-lookup"><span data-stu-id="2de07-295">Instead, they provide properties, <xref:System.Threading.Tasks.Dataflow.JoinBlock%602.Target1%2A>, <xref:System.Threading.Tasks.Dataflow.JoinBlock%602.Target2%2A>, and <xref:System.Threading.Tasks.Dataflow.JoinBlock%603.Target3%2A>, that implement <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.</span></span>  
  
 <span data-ttu-id="2de07-296">Comme <xref:System.Threading.Tasks.Dataflow.BatchBlock%601>, <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> et <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> peuvent fonctionner en mode gourmand ou non gourmand.</span><span class="sxs-lookup"><span data-stu-id="2de07-296">Like <xref:System.Threading.Tasks.Dataflow.BatchBlock%601>, <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> and <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> operate in either greedy or non-greedy mode.</span></span> <span data-ttu-id="2de07-297">En mode gourmand, qui est le mode par défaut, un objet <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> ou <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> accepte tous les messages qui lui sont envoyés et propage un tuple chaque fois que l'une de ses cibles reçoit au moins un message.</span><span class="sxs-lookup"><span data-stu-id="2de07-297">In greedy mode, which is the default, a <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> or <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> object accepts every message that it is offered and propagates out a tuple after each of its targets receives at least one message.</span></span> <span data-ttu-id="2de07-298">En mode non gourmand, un objet <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> ou <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> diffère tous les messages entrants jusqu'à ce que toutes les cibles aient reçu les données requises pour créer un tuple.</span><span class="sxs-lookup"><span data-stu-id="2de07-298">In non-greedy mode, a <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> or <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> object postpones all incoming messages until all targets have been offered the data that is required to create a tuple.</span></span> <span data-ttu-id="2de07-299">À ce stade, le bloc s'engage dans un protocole de validation en deux phases pour récupérer atomiquement tous les éléments requis à partir des sources.</span><span class="sxs-lookup"><span data-stu-id="2de07-299">At this point, the block engages in a two-phase commit protocol to atomically retrieve all required items from the sources.</span></span> <span data-ttu-id="2de07-300">Ce report permet à une autre entité de consommer les données pendant ce temps, pour que l'ensemble du système puisse progresser.</span><span class="sxs-lookup"><span data-stu-id="2de07-300">This postponement makes it possible for another entity to consume the data in the meantime, to allow the overall system to make forward progress.</span></span>  
  
 <span data-ttu-id="2de07-301">Dans l'exemple simple qui suit, un objet <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> nécessite plusieurs données pour calculer une valeur.</span><span class="sxs-lookup"><span data-stu-id="2de07-301">The following basic example demonstrates a case in which a <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> object requires multiple data to compute a value.</span></span> <span data-ttu-id="2de07-302">Dans cet exemple, l'objet <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> créé nécessite deux valeurs <xref:System.Int32> et une valeur <xref:System.Char> pour effectuer une opération arithmétique.</span><span class="sxs-lookup"><span data-stu-id="2de07-302">This example creates a <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> object that requires two <xref:System.Int32> values and a <xref:System.Char> value to perform an arithmetic operation.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#8](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#8)]
 [!code-vb[TPLDataflow_Overview#8](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#8)]  
  
 <span data-ttu-id="2de07-303">Vous trouverez un exemple complet utilisant des objets <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> en mode non gourmand pour partager une ressource de manière coopérative sur la page [Guide pratique : utiliser JoinBlock pour lire des données issues de plusieurs sources](how-to-use-joinblock-to-read-data-from-multiple-sources.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-303">For a complete example that uses <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects in non-greedy mode to cooperatively share a resource, see [How to: Use JoinBlock to Read Data From Multiple Sources](how-to-use-joinblock-to-read-data-from-multiple-sources.md).</span></span>  
  
#### <a name="batchedjoinblockt1-t2-"></a><span data-ttu-id="2de07-304">BatchedJoinBlock(T1, T2, ...)</span><span class="sxs-lookup"><span data-stu-id="2de07-304">BatchedJoinBlock(T1, T2, ...)</span></span>  

 <span data-ttu-id="2de07-305">Les classes <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> et <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%603> collectent des lots d'éléments d'entrée et propagent les objets `System.Tuple(IList(T1), IList(T2))` ou `System.Tuple(IList(T1), IList(T2), IList(T3))` qui contiennent ces éléments.</span><span class="sxs-lookup"><span data-stu-id="2de07-305">The <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> and <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%603> classes collect batches of input elements and propagate out `System.Tuple(IList(T1), IList(T2))` or `System.Tuple(IList(T1), IList(T2), IList(T3))` objects that contain those elements.</span></span> <span data-ttu-id="2de07-306"><xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> est un mélange entre <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> et <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>.</span><span class="sxs-lookup"><span data-stu-id="2de07-306">Think of <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> as a combination of <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> and <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>.</span></span> <span data-ttu-id="2de07-307">Vous spécifiez la taille de chaque lot quand vous créez un objet <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602>.</span><span class="sxs-lookup"><span data-stu-id="2de07-307">Specify the size of each batch when you create a <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> object.</span></span> <span data-ttu-id="2de07-308"><xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> fournit également les propriétés <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target1%2A> et <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target2%2A> qui implémentent <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.</span><span class="sxs-lookup"><span data-stu-id="2de07-308"><xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> also provides properties, <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target1%2A> and <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target2%2A>, that implement <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.</span></span> <span data-ttu-id="2de07-309">Quand le nombre spécifié d'éléments d'entrée est reçu par l'ensemble des cibles, l'objet <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> propage de manière asynchrone un objet `System.Tuple(IList(T1), IList(T2))` qui contient ces éléments.</span><span class="sxs-lookup"><span data-stu-id="2de07-309">When the specified count of input elements are received from across all targets, the <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> object asynchronously propagates out a `System.Tuple(IList(T1), IList(T2))` object that contains those elements.</span></span>  
  
 <span data-ttu-id="2de07-310">Dans l'exemple simple qui suit, l'objet <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> créé contient des résultats, des valeurs <xref:System.Int32> et des erreurs qui sont des objets <xref:System.Exception>.</span><span class="sxs-lookup"><span data-stu-id="2de07-310">The following basic example creates a <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> object that holds results, <xref:System.Int32> values, and errors that are <xref:System.Exception> objects.</span></span> <span data-ttu-id="2de07-311">Dans cet exemple, plusieurs opérations sont effectuées. Les résultats sont écrits dans la propriété <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target1%2A> et les erreurs dans la propriété <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target2%2A> de l'objet <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602>.</span><span class="sxs-lookup"><span data-stu-id="2de07-311">This example performs multiple operations and writes results to the <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target1%2A> property, and errors to the <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target2%2A> property, of the <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> object.</span></span> <span data-ttu-id="2de07-312">Étant donné que le nombre d'opérations ayant réussi et ayant échoué n'est pas connu à l'avance, les objets <xref:System.Collections.Generic.IList%601> permettent à chaque cible de recevoir zéro, une ou plusieurs valeurs.</span><span class="sxs-lookup"><span data-stu-id="2de07-312">Because the count of successful and failed operations is unknown in advance, the <xref:System.Collections.Generic.IList%601> objects enable each target to receive zero or more values.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#9](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#9)]
 [!code-vb[TPLDataflow_Overview#9](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#9)]  
  
 <span data-ttu-id="2de07-313">Vous trouverez un exemple complet utilisant <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> pour capturer les résultats et toutes les exceptions qui se produisent quand le programme lit les données d'une base de données sur la page [Procédure pas à pas : utiliser BatchBlock et BatchedJoinBlock pour améliorer l'efficacité](walkthrough-using-batchblock-and-batchedjoinblock-to-improve-efficiency.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-313">For a complete example that uses <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> to capture both the results and any exceptions that occur while the program reads from a database, see [Walkthrough: Using BatchBlock and BatchedJoinBlock to Improve Efficiency](walkthrough-using-batchblock-and-batchedjoinblock-to-improve-efficiency.md).</span></span>  

## <a name="configuring-dataflow--block-behavior"></a><span data-ttu-id="2de07-314">Configuration du comportement des blocs de flux de données</span><span class="sxs-lookup"><span data-stu-id="2de07-314">Configuring Dataflow  Block Behavior</span></span>  

 <span data-ttu-id="2de07-315">Vous pouvez activer des options supplémentaires en fournissant un objet <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions?displayProperty=nameWithType> au constructeur de types de blocs de flux de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-315">You can enable additional options by providing a <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions?displayProperty=nameWithType> object to the constructor of dataflow block types.</span></span> <span data-ttu-id="2de07-316">Ces options permettent de contrôler le comportement, comme celui du planificateur qui gère la tâche sous-jacente et le degré de parallélisme.</span><span class="sxs-lookup"><span data-stu-id="2de07-316">These options control behavior such the scheduler that manages the underlying task and the degree of parallelism.</span></span> <span data-ttu-id="2de07-317"><xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions> possède également des types dérivés qui spécifient le comportement spécifique à certains types de blocs de flux de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-317">The <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions> also has derived types that specify behavior that is specific to certain dataflow block types.</span></span> <span data-ttu-id="2de07-318">Le tableau suivant récapitule les types d'options qui sont associés à chaque type de bloc de flux de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-318">The following table summarizes which options type is associated with each dataflow block type.</span></span>  
  
|<span data-ttu-id="2de07-319">Type de bloc de flux de données</span><span class="sxs-lookup"><span data-stu-id="2de07-319">Dataflow Block Type</span></span>|<span data-ttu-id="2de07-320">Type<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions></span><span class="sxs-lookup"><span data-stu-id="2de07-320"><xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions> type</span></span>|  
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|  
|<xref:System.Threading.Tasks.Dataflow.BufferBlock%601>|<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601>|<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601>|<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>|<xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.BatchBlock%601>|<xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.JoinBlock%602>|<xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602>|<xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions>|  
  
 <span data-ttu-id="2de07-321">Les sections suivantes fournissent des informations supplémentaires sur les types importants d'options de blocs de flux de données qui sont disponibles via les classes <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions?displayProperty=nameWithType> et <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2de07-321">The following sections provide additional information about the important kinds of dataflow block options that are available through the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions?displayProperty=nameWithType>, and <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions?displayProperty=nameWithType> classes.</span></span>  
  
### <a name="specifying-the-task-scheduler"></a><span data-ttu-id="2de07-322">Spécification du planificateur de tâches</span><span class="sxs-lookup"><span data-stu-id="2de07-322">Specifying the Task Scheduler</span></span>  

 <span data-ttu-id="2de07-323">Chaque bloc de flux de données prédéfini utilise le mécanisme de planification des tâches TPL pour effectuer des activités, telles que la propagation de données vers une cible, la réception de données à partir d'une source et l'exécution de délégués définis par l'utilisateur quand des données deviennent disponibles.</span><span class="sxs-lookup"><span data-stu-id="2de07-323">Every predefined dataflow block uses the TPL task scheduling mechanism to perform activities such as propagating data to a target, receiving data from a source, and running user-defined delegates when data becomes available.</span></span> <span data-ttu-id="2de07-324"><xref:System.Threading.Tasks.TaskScheduler> est une classe abstraite qui représente un planificateur de tâches qui place des tâches en attente dans des threads.</span><span class="sxs-lookup"><span data-stu-id="2de07-324"><xref:System.Threading.Tasks.TaskScheduler> is an abstract class that represents a task scheduler that queues tasks onto threads.</span></span> <span data-ttu-id="2de07-325">Le planificateur de tâches par défaut, <xref:System.Threading.Tasks.TaskScheduler.Default%2A>, utilise la classe <xref:System.Threading.ThreadPool> pour placer des tâches en file d’attente et les exécuter.</span><span class="sxs-lookup"><span data-stu-id="2de07-325">The default task scheduler, <xref:System.Threading.Tasks.TaskScheduler.Default%2A>, uses the <xref:System.Threading.ThreadPool> class to queue and execute work.</span></span> <span data-ttu-id="2de07-326">Vous pouvez remplacer le planificateur de tâches par défaut en définissant la propriété <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> quand vous créez un objet de bloc de flux de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-326">You can override the default task scheduler by setting the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property when you construct a dataflow block object.</span></span>  
  
 <span data-ttu-id="2de07-327">Quand un même planificateur de tâches gère plusieurs blocs de flux de données, il peut appliquer les mêmes stratégies à chacune d'elles.</span><span class="sxs-lookup"><span data-stu-id="2de07-327">When the same task scheduler manages multiple dataflow blocks, it can enforce policies across them.</span></span> <span data-ttu-id="2de07-328">Par exemple, si plusieurs blocs de flux de données sont configurés de manière à cibler le planificateur exclusif du même objet <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair>, toutes les tâches qui sont exécutées dans ces blocs seront sérialisées.</span><span class="sxs-lookup"><span data-stu-id="2de07-328">For example, if multiple dataflow blocks are each configured to target the exclusive scheduler of the same <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> object, all work that runs across these blocks is serialized.</span></span> <span data-ttu-id="2de07-329">De même, si ces blocs sont configurés de manière à cibler le planificateur simultané du même objet <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> et que le planificateur est configuré avec un niveau d'accès concurrentiel maximal, toutes les tâches de ces blocs seront limitées au nombre d'opérations simultanées.</span><span class="sxs-lookup"><span data-stu-id="2de07-329">Similarly, if these blocks are configured to target the concurrent scheduler of the same <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> object, and that scheduler is configured to have a maximum concurrency level, all work from these blocks is limited to that number of concurrent operations.</span></span> <span data-ttu-id="2de07-330">Vous trouverez un exemple utilisant la classe <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> pour permettre que des opérations de lecture s’effectuent en parallèle, tout en imposant que chaque opération d’écriture soit réalisée de manière exclusive sur la page [Guide pratique : spécifier un Planificateur de tâches dans un bloc de flux de données](how-to-specify-a-task-scheduler-in-a-dataflow-block.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-330">For an example that uses the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> class to enable read operations to occur in parallel, but write operations to occur exclusively of all other operations, see [How to: Specify a Task Scheduler in a Dataflow Block](how-to-specify-a-task-scheduler-in-a-dataflow-block.md).</span></span> <span data-ttu-id="2de07-331">Pour plus d’informations sur les planificateurs de tâches dans la bibliothèque parallèle de tâches, consultez la rubrique sur la classe <xref:System.Threading.Tasks.TaskScheduler>.</span><span class="sxs-lookup"><span data-stu-id="2de07-331">For more information about task schedulers in the TPL, see the <xref:System.Threading.Tasks.TaskScheduler> class topic.</span></span>  
  
### <a name="specifying-the-degree-of-parallelism"></a><span data-ttu-id="2de07-332">Spécification du degré de parallélisme</span><span class="sxs-lookup"><span data-stu-id="2de07-332">Specifying the Degree of Parallelism</span></span>  

 <span data-ttu-id="2de07-333">Par défaut, les trois types de blocs d'exécution fournis par la bibliothèque de flux de données TPL (<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> et <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>) traitent les messages un par un.</span><span class="sxs-lookup"><span data-stu-id="2de07-333">By default, the three execution block types that the TPL Dataflow Library provides, <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>, and <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>, process one message at a time.</span></span> <span data-ttu-id="2de07-334">Ces types de blocs de flux de données traitent également les messages dans l'ordre dans lequel ils sont reçus.</span><span class="sxs-lookup"><span data-stu-id="2de07-334">These dataflow block types also process messages in the order in which they are received.</span></span> <span data-ttu-id="2de07-335">Pour permettre aux blocs de flux de données de traiter simultanément les messages, définissez la propriété <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A?displayProperty=nameWithType> au moment de créer l'objet de bloc de flux de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-335">To enable these dataflow blocks to process messages concurrently, set the <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A?displayProperty=nameWithType> property when you construct the dataflow block object.</span></span>  
  
 <span data-ttu-id="2de07-336">La valeur par défaut de <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> est 1, ce qui signifie que le bloc de flux de données traitera les messages un par un.</span><span class="sxs-lookup"><span data-stu-id="2de07-336">The default value of <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> is 1, which guarantees that the dataflow block processes one message at a time.</span></span> <span data-ttu-id="2de07-337">En définissant cette propriété sur une valeur supérieure à 1, vous permettez au bloc de flux de données de traiter plusieurs messages simultanément.</span><span class="sxs-lookup"><span data-stu-id="2de07-337">Setting this property to a value that is larger than 1 enables the dataflow block to process multiple messages concurrently.</span></span> <span data-ttu-id="2de07-338">Si vous définissez cette propriété sur <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded?displayProperty=nameWithType>, vous permettez au planificateur de tâches sous-jacentes de gérer le degré maximal de concurrence.</span><span class="sxs-lookup"><span data-stu-id="2de07-338">Setting this property to <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded?displayProperty=nameWithType> enables the underlying task scheduler to manage the maximum degree of concurrency.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="2de07-339">Quand vous spécifiez un degré maximal de parallélisme supérieur à 1, plusieurs messages sont traités simultanément. Il se peut donc que les messages ne soient pas traités dans l’ordre dans lequel ils sont reçus.</span><span class="sxs-lookup"><span data-stu-id="2de07-339">When you specify a maximum degree of parallelism that is larger than 1, multiple messages are processed simultaneously, and therefore messages might not be processed in the order in which they are received.</span></span> <span data-ttu-id="2de07-340">Toutefois, les messages sont renvoyés du bloc dans le même ordre qu’ils ont été reçus.</span><span class="sxs-lookup"><span data-stu-id="2de07-340">The order in which the messages are output from the block is, however, the same one in which they are received.</span></span>  
  
 <span data-ttu-id="2de07-341">Étant donné que la propriété <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> représente le degré maximal de parallélisme, le bloc de flux de données peut s'exécuter avec un degré de parallélisme moindre spécifié par vos soins.</span><span class="sxs-lookup"><span data-stu-id="2de07-341">Because the <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> property represents the maximum degree of parallelism, the dataflow block might execute with a lesser degree of parallelism than you specify.</span></span> <span data-ttu-id="2de07-342">Le bloc de flux de données peut utiliser un degré de parallélisme moindre pour satisfaire ses exigences fonctionnelles ou en cas de manque de ressources système disponibles.</span><span class="sxs-lookup"><span data-stu-id="2de07-342">The dataflow block might use a lesser degree of parallelism to meet its functional requirements or because there is a lack of available system resources.</span></span> <span data-ttu-id="2de07-343">Un bloc de flux de données n'utilisera jamais un niveau de parallélisme supérieur à celui que vous spécifiez.</span><span class="sxs-lookup"><span data-stu-id="2de07-343">A dataflow block never chooses more parallelism than you specify.</span></span>  
  
 <span data-ttu-id="2de07-344">La valeur de la propriété <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> est exclusive à chaque objet de bloc de flux de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-344">The value of the <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> property is exclusive to each dataflow block object.</span></span> <span data-ttu-id="2de07-345">Par exemple, si chacun des quatre objets de blocs de flux de données spécifie la valeur 1 comme degré maximal de parallélisme, les quatre objets de bloc de flux de données peuvent être exécutés en parallèle.</span><span class="sxs-lookup"><span data-stu-id="2de07-345">For example, if four dataflow block objects each specify 1 for the maximum degree of parallelism, all four dataflow block objects can potentially run in parallel.</span></span>  
  
 <span data-ttu-id="2de07-346">Vous trouverez un exemple dans lequel est défini le degré maximal de parallélisme permettant à des opérations de longue durée d’être exécutées en parallèle sur la page [Guide pratique : spécifier le degré de parallélisme dans un bloc de flux de données](how-to-specify-the-degree-of-parallelism-in-a-dataflow-block.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-346">For an example that sets the maximum degree of parallelism to enable lengthy operations to occur in parallel, see [How to: Specify the Degree of Parallelism in a Dataflow Block](how-to-specify-the-degree-of-parallelism-in-a-dataflow-block.md).</span></span>  
  
### <a name="specifying-the-number-of-messages-per-task"></a><span data-ttu-id="2de07-347">Spécification du nombre de messages par tâche</span><span class="sxs-lookup"><span data-stu-id="2de07-347">Specifying the Number of Messages per Task</span></span>  

 <span data-ttu-id="2de07-348">Les types de blocs de flux de données prédéfinis utilisent des tâches pour traiter plusieurs éléments d'entrée.</span><span class="sxs-lookup"><span data-stu-id="2de07-348">The predefined dataflow block types use tasks to process multiple input elements.</span></span> <span data-ttu-id="2de07-349">Cela aide à réduire le nombre d'objets de tâches requis pour traiter les données, ce qui permet aux applications de s'exécuter plus efficacement.</span><span class="sxs-lookup"><span data-stu-id="2de07-349">This helps minimize the number of task objects that are required to process data, which enables applications to run more efficiently.</span></span> <span data-ttu-id="2de07-350">Toutefois, quand les tâches d'un ensemble de blocs de flux de données traitent des données, il est possible que les tâches des autres blocs de flux de données doivent attendre d'être traitées et placer leurs messages dans la file d'attente.</span><span class="sxs-lookup"><span data-stu-id="2de07-350">However, when the tasks from one set of dataflow blocks are processing data, the tasks from other dataflow blocks might need to wait for processing time by queuing messages.</span></span> <span data-ttu-id="2de07-351">Pour un meilleur respect de l'ordre des tâches de flux de données, définissez la propriété <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A>.</span><span class="sxs-lookup"><span data-stu-id="2de07-351">To enable better fairness among dataflow tasks, set the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> property.</span></span> <span data-ttu-id="2de07-352">Quand <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> a la valeur <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded?displayProperty=nameWithType>, qui est la valeur par défaut, la tâche utilisée par un bloc de flux de données traite tous les messages disponibles.</span><span class="sxs-lookup"><span data-stu-id="2de07-352">When <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> is set to <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded?displayProperty=nameWithType>, which is the default, the task used by a dataflow block processes as many messages as are available.</span></span> <span data-ttu-id="2de07-353">Quand <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> est défini sur une valeur autre que <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded>, le bloc de flux de données traite au maximum le nombre défini de messages par objet <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="2de07-353">When <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> is set to a value other than <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded>, the dataflow block processes at most this number of messages per <xref:System.Threading.Tasks.Task> object.</span></span> <span data-ttu-id="2de07-354">Même si la configuration de la propriété <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> peut améliorer le respect de l'ordre des tâches, elle peut aussi entraîner la création par le système de davantage de tâches que nécessaire, réduisant ainsi les performances.</span><span class="sxs-lookup"><span data-stu-id="2de07-354">Although setting the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> property can increase fairness among tasks, it can cause the system to create more tasks than are necessary, which can decrease performance.</span></span>  
  
### <a name="enabling-cancellation"></a><span data-ttu-id="2de07-355">Permettre les annulations</span><span class="sxs-lookup"><span data-stu-id="2de07-355">Enabling Cancellation</span></span>  

 <span data-ttu-id="2de07-356">La bibliothèque parallèle de tâches (TPL) fournit un mécanisme qui permet aux tâches de coordonner l'annulation de manière coopérative.</span><span class="sxs-lookup"><span data-stu-id="2de07-356">The TPL provides a mechanism that enables tasks to coordinate cancellation in a cooperative manner.</span></span> <span data-ttu-id="2de07-357">Pour permettre aux blocs de flux de données de participer à ce mécanisme d'annulation, définissez la propriété <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A>.</span><span class="sxs-lookup"><span data-stu-id="2de07-357">To enable dataflow blocks to participate in this cancellation mechanism, set the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property.</span></span> <span data-ttu-id="2de07-358">Quand l'objet <xref:System.Threading.CancellationToken> est à l'état annulé, tous les blocs de flux de données qui contrôlent ce jeton terminent l'exécution de l'élément actuel, mais ne démarrent pas le traitement des éléments suivants.</span><span class="sxs-lookup"><span data-stu-id="2de07-358">When this <xref:System.Threading.CancellationToken> object is set to the canceled state, all dataflow blocks that monitor this token finish execution of their current item but do not start processing subsequent items.</span></span> <span data-ttu-id="2de07-359">De plus, ces blocs de flux de données effacent les messages mis en mémoire tampon, libèrent les connexions aux blocs sources et cibles, et passent à l'état annulé.</span><span class="sxs-lookup"><span data-stu-id="2de07-359">These dataflow blocks also clear any buffered messages, release connections to any source and target blocks, and transition to the canceled state.</span></span> <span data-ttu-id="2de07-360">Lors du passage à l'état annulé, la propriété <xref:System.Threading.Tasks.Task.Status%2A> de la propriété <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> est définie sur <xref:System.Threading.Tasks.TaskStatus.Canceled>, sauf si une exception s'est produite lors du traitement.</span><span class="sxs-lookup"><span data-stu-id="2de07-360">By transitioning to the canceled state, the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> property has the <xref:System.Threading.Tasks.Task.Status%2A> property set to <xref:System.Threading.Tasks.TaskStatus.Canceled>, unless an exception occurred during processing.</span></span> <span data-ttu-id="2de07-361">Dans ce cas, <xref:System.Threading.Tasks.Task.Status%2A> est défini sur <xref:System.Threading.Tasks.TaskStatus.Faulted>.</span><span class="sxs-lookup"><span data-stu-id="2de07-361">In that case, <xref:System.Threading.Tasks.Task.Status%2A> is set to <xref:System.Threading.Tasks.TaskStatus.Faulted>.</span></span>  
  
 <span data-ttu-id="2de07-362">Vous trouverez un exemple qui montre comment utiliser l’annulation dans une application Windows Forms sur la page [Guide pratique : annuler un bloc de flux de données](how-to-cancel-a-dataflow-block.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-362">For an example that demonstrates how to use cancellation in a Windows Forms application, see [How to: Cancel a Dataflow Block](how-to-cancel-a-dataflow-block.md).</span></span> <span data-ttu-id="2de07-363">Pour plus d’informations sur les annulations dans la bibliothèque parallèle de tâches, consultez la page [Annulation de tâches](task-cancellation.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-363">For more information about cancellation in the TPL, see [Task Cancellation](task-cancellation.md).</span></span>  
  
### <a name="specifying-greedy-versus-non-greedy-behavior"></a><span data-ttu-id="2de07-364">Spécification des comportements gourmand et non gourmand</span><span class="sxs-lookup"><span data-stu-id="2de07-364">Specifying Greedy Versus Non-Greedy Behavior</span></span>  

 <span data-ttu-id="2de07-365">Plusieurs types de blocs de flux de données de regroupement peuvent fonctionner en mode *gourmand* ou en mode *non gourmand*.</span><span class="sxs-lookup"><span data-stu-id="2de07-365">Several grouping dataflow block types can operate in either *greedy* or *non-greedy* mode.</span></span> <span data-ttu-id="2de07-366">Par défaut, les types de blocs de flux de données prédéfinis fonctionnent en mode gourmand.</span><span class="sxs-lookup"><span data-stu-id="2de07-366">By default, the predefined dataflow block types operate in greedy mode.</span></span>  
  
 <span data-ttu-id="2de07-367">Pour les types de blocs de regroupement tels que <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>, le mode gourmand signifie que le bloc accepte immédiatement les données, même si les données correspondantes avec lesquelles effectuer le regroupement ne sont pas encore disponibles.</span><span class="sxs-lookup"><span data-stu-id="2de07-367">For join block types such as <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>, greedy mode means that the block immediately accepts data even if the corresponding data with which to join is not yet available.</span></span> <span data-ttu-id="2de07-368">Le mode non gourmand signifie que le bloc diffère tous les messages entrants jusqu'à ce que chacune de ses cibles ait reçu un message, permettant ainsi le regroupement.</span><span class="sxs-lookup"><span data-stu-id="2de07-368">Non-greedy mode means that the block postpones all incoming messages until one is available on each of its targets to complete the join.</span></span> <span data-ttu-id="2de07-369">Si l'un des messages différés n'est plus disponible, le bloc de regroupement libère tous les messages différés et redémarre le processus.</span><span class="sxs-lookup"><span data-stu-id="2de07-369">If any of the postponed messages are no longer available, the join block releases all postponed messages and restarts the process.</span></span> <span data-ttu-id="2de07-370">Pour la classe <xref:System.Threading.Tasks.Dataflow.BatchBlock%601>, les comportements gourmand et non gourmand sont similaires, à ceci près qu'en mode non gourmand, un objet <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> diffère tous les messages entrants jusqu'à ce que suffisamment de messages soient disponibles dans plusieurs sources distinctes pour former un lot.</span><span class="sxs-lookup"><span data-stu-id="2de07-370">For the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> class, greedy and non-greedy behavior is similar, except that under non-greedy mode, a <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object postpones all incoming messages until enough are available from distinct sources to complete a batch.</span></span>  
  
 <span data-ttu-id="2de07-371">Pour spécifier le mode non gourmand pour un bloc de flux de données, définissez <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> sur `False`.</span><span class="sxs-lookup"><span data-stu-id="2de07-371">To specify non-greedy mode for a dataflow block, set <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> to `False`.</span></span> <span data-ttu-id="2de07-372">Vous trouverez un exemple qui montre comment utiliser le mode non gourmand pour permettre à plusieurs blocs de regroupement de partager une source de données plus efficacement sur la page [Guide pratique : utiliser JoinBlock pour lire des données issues de plusieurs sources](how-to-use-joinblock-to-read-data-from-multiple-sources.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-372">For an example that demonstrates how to use non-greedy mode to enable multiple join blocks to share a data source more efficiently, see [How to: Use JoinBlock to Read Data From Multiple Sources](how-to-use-joinblock-to-read-data-from-multiple-sources.md).</span></span>

## <a name="custom-dataflow-blocks"></a><span data-ttu-id="2de07-373">Blocs de flux de données personnalisés</span><span class="sxs-lookup"><span data-stu-id="2de07-373">Custom Dataflow Blocks</span></span>  

 <span data-ttu-id="2de07-374">Même si la bibliothèque de flux de données TPL fournit de nombreux types de blocs prédéfinis, vous pouvez créer d'autres types de blocs ayant un comportement personnalisé.</span><span class="sxs-lookup"><span data-stu-id="2de07-374">Although the TPL Dataflow Library provides many predefined block types, you can create additional block types that perform custom behavior.</span></span> <span data-ttu-id="2de07-375">Implémentez directement les interfaces <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> ou <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>, ou utilisez la méthode <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Encapsulate%2A> pour créer un bloc complexe qui encapsule le comportement des types de blocs existants.</span><span class="sxs-lookup"><span data-stu-id="2de07-375">Implement the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> or <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> interfaces directly or use the  <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Encapsulate%2A> method to build a complex block that encapsulates the behavior of existing block types.</span></span> <span data-ttu-id="2de07-376">Vous trouverez des exemples qui montrent comment implémenter la fonctionnalité de bloc de flux de données personnalisé sur la page [Procédure pas à pas : créer un type de bloc de flux de données personnalisé](walkthrough-creating-a-custom-dataflow-block-type.md).</span><span class="sxs-lookup"><span data-stu-id="2de07-376">For examples that show how to implement custom dataflow block functionality, see [Walkthrough: Creating a Custom Dataflow Block Type](walkthrough-creating-a-custom-dataflow-block-type.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="2de07-377">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="2de07-377">Related Topics</span></span>  
  
|<span data-ttu-id="2de07-378">Titre</span><span class="sxs-lookup"><span data-stu-id="2de07-378">Title</span></span>|<span data-ttu-id="2de07-379">Description</span><span class="sxs-lookup"><span data-stu-id="2de07-379">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="2de07-380">Procédure : Écrire et lire des messages dans un bloc de flux de données</span><span class="sxs-lookup"><span data-stu-id="2de07-380">How to: Write Messages to and Read Messages from a Dataflow Block</span></span>](how-to-write-messages-to-and-read-messages-from-a-dataflow-block.md)|<span data-ttu-id="2de07-381">Montre comment écrire des messages dans un objet <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> et les lire.</span><span class="sxs-lookup"><span data-stu-id="2de07-381">Demonstrates how to write messages to and read messages from a <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> object.</span></span>|  
|[<span data-ttu-id="2de07-382">Procédure : implémenter un modèle de flux de données producteur-consommateur</span><span class="sxs-lookup"><span data-stu-id="2de07-382">How to: Implement a Producer-Consumer Dataflow Pattern</span></span>](how-to-implement-a-producer-consumer-dataflow-pattern.md)|<span data-ttu-id="2de07-383">Explique comment utiliser le modèle de flux de données pour implémenter un modèle producteur-consommateur, où le producteur envoie des messages à un bloc de flux de données et le consommateur lit les messages de ce bloc.</span><span class="sxs-lookup"><span data-stu-id="2de07-383">Describes how to use the dataflow model to implement a producer-consumer pattern, where the producer sends messages to a dataflow block, and the consumer reads messages from that block.</span></span>|  
|[<span data-ttu-id="2de07-384">Procédure : Exécuter des actions quand un bloc de flux de données reçoit des données</span><span class="sxs-lookup"><span data-stu-id="2de07-384">How to: Perform Action When a Dataflow Block Receives Data</span></span>](how-to-perform-action-when-a-dataflow-block-receives-data.md)|<span data-ttu-id="2de07-385">Explique comment fournir des délégués aux types de blocs de flux de données d'exécution <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> et <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>.</span><span class="sxs-lookup"><span data-stu-id="2de07-385">Describes how to provide delegates to the execution dataflow block types, <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>, and <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>.</span></span>|  
|[<span data-ttu-id="2de07-386">Procédure pas à pas : création d’un pipeline de dataflow</span><span class="sxs-lookup"><span data-stu-id="2de07-386">Walkthrough: Creating a Dataflow Pipeline</span></span>](walkthrough-creating-a-dataflow-pipeline.md)|<span data-ttu-id="2de07-387">Explique comment créer un pipeline de flux de données qui télécharge du texte à partir du web et effectue des opérations sur ce texte.</span><span class="sxs-lookup"><span data-stu-id="2de07-387">Describes how to create a dataflow pipeline that downloads text from the web and performs operations on that text.</span></span>|  
|[<span data-ttu-id="2de07-388">Procédure : Dissocier des blocs de flux de données</span><span class="sxs-lookup"><span data-stu-id="2de07-388">How to: Unlink Dataflow Blocks</span></span>](how-to-unlink-dataflow-blocks.md)|<span data-ttu-id="2de07-389">Montre comment utiliser la méthode <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> pour dissocier un bloc cible de sa source après que celle-ci lui a envoyé un message.</span><span class="sxs-lookup"><span data-stu-id="2de07-389">Demonstrates how to use the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method to unlink a target block from its source after the source offers a message to the target.</span></span>|  
|[<span data-ttu-id="2de07-390">Procédure pas à pas : utilisation d’un dataflow dans une application Windows Forms</span><span class="sxs-lookup"><span data-stu-id="2de07-390">Walkthrough: Using Dataflow in a Windows Forms Application</span></span>](walkthrough-using-dataflow-in-a-windows-forms-application.md)|<span data-ttu-id="2de07-391">Montre comment créer un réseau de blocs de flux de données qui effectuent un traitement des images dans une application Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="2de07-391">Demonstrates how to create a network of dataflow blocks that perform image processing in a Windows Forms application.</span></span>|  
|[<span data-ttu-id="2de07-392">Procédure : annuler un bloc de dataflow</span><span class="sxs-lookup"><span data-stu-id="2de07-392">How to: Cancel a Dataflow Block</span></span>](how-to-cancel-a-dataflow-block.md)|<span data-ttu-id="2de07-393">Montre comment utiliser l'annulation dans une application Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="2de07-393">Demonstrates how to use cancellation in a Windows Forms application.</span></span>|  
|[<span data-ttu-id="2de07-394">Procédure : Utiliser JoinBlock pour lire des données de plusieurs sources</span><span class="sxs-lookup"><span data-stu-id="2de07-394">How to: Use JoinBlock to Read Data From Multiple Sources</span></span>](how-to-use-joinblock-to-read-data-from-multiple-sources.md)|<span data-ttu-id="2de07-395">Explique comment utiliser la classe <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> pour effectuer une opération quand des données sont disponibles dans plusieurs sources, et comment utiliser le mode non gourmand pour permettre à plusieurs blocs de regroupement de partager une source de données plus efficacement.</span><span class="sxs-lookup"><span data-stu-id="2de07-395">Explains how to use the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class to perform an operation when data is available from multiple sources, and how to use non-greedy mode to enable multiple join blocks to share a data source more efficiently.</span></span>|  
|[<span data-ttu-id="2de07-396">Procédure : Spécifier le degré de parallélisme dans un bloc de flux de données</span><span class="sxs-lookup"><span data-stu-id="2de07-396">How to: Specify the Degree of Parallelism in a Dataflow Block</span></span>](how-to-specify-the-degree-of-parallelism-in-a-dataflow-block.md)|<span data-ttu-id="2de07-397">Explique comment définir la propriété <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> pour permettre à un bloc de flux de données d'exécution de traiter plusieurs messages à la fois.</span><span class="sxs-lookup"><span data-stu-id="2de07-397">Describes how to set the <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> property to enable an execution dataflow block to process more than one message at a time.</span></span>|  
|[<span data-ttu-id="2de07-398">Procédure : spécifier un planificateur de tâches dans un bloc de dataflow</span><span class="sxs-lookup"><span data-stu-id="2de07-398">How to: Specify a Task Scheduler in a Dataflow Block</span></span>](how-to-specify-a-task-scheduler-in-a-dataflow-block.md)|<span data-ttu-id="2de07-399">Montre comment associer un planificateur de tâches spécifique quand vous utilisez un flux de données dans votre application.</span><span class="sxs-lookup"><span data-stu-id="2de07-399">Demonstrates how to associate a specific task scheduler when you use dataflow in your application.</span></span>|  
|[<span data-ttu-id="2de07-400">Procédure pas à pas : Utiliser BatchBlock et BatchedJoinBlock pour améliorer l’efficacité</span><span class="sxs-lookup"><span data-stu-id="2de07-400">Walkthrough: Using BatchBlock and BatchedJoinBlock to Improve Efficiency</span></span>](walkthrough-using-batchblock-and-batchedjoinblock-to-improve-efficiency.md)|<span data-ttu-id="2de07-401">Explique comment utiliser la classe <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> pour améliorer l'efficacité des opérations d'insertion de bases de données, et comment utiliser la classe <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> pour capturer les résultats et les exceptions qui se produisent quand le programme lit les données d'une base de données.</span><span class="sxs-lookup"><span data-stu-id="2de07-401">Describes how to use the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> class to improve the efficiency of database insert operations, and how to use the <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> class to capture both the results and any exceptions that occur while the program reads from a database.</span></span>|  
|[<span data-ttu-id="2de07-402">Procédure pas à pas : Créer un type de bloc de flux de données personnalisé</span><span class="sxs-lookup"><span data-stu-id="2de07-402">Walkthrough: Creating a Custom Dataflow Block Type</span></span>](walkthrough-creating-a-custom-dataflow-block-type.md)|<span data-ttu-id="2de07-403">Montre deux façons de créer un type de bloc de flux de données qui implémente un comportement personnalisé.</span><span class="sxs-lookup"><span data-stu-id="2de07-403">Demonstrates two ways to create a dataflow block type that implements custom behavior.</span></span>|  
|[<span data-ttu-id="2de07-404">Bibliothèque parallèle de tâches</span><span class="sxs-lookup"><span data-stu-id="2de07-404">Task Parallel Library (TPL)</span></span>](task-parallel-library-tpl.md)|<span data-ttu-id="2de07-405">Présente la bibliothèque parallèle de tâches (TPL), qui simplifie la programmation parallèle et simultanée dans les applications .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="2de07-405">Introduces the TPL, a library that simplifies parallel and concurrent programming in .NET Framework applications.</span></span>|

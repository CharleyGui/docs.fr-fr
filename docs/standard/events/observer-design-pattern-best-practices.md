---
title: Meilleures pratiques du modèle de design observateur
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- observer design pattern [.NET], best practices
- best practices [.NET], observer design pattern
ms.assetid: c834760f-ddd4-417f-abb7-a059679d5b8c
ms.openlocfilehash: 8e75343e1ca1c7f69306ee45148f2dc0eec3585f
ms.sourcegitcommit: b1442669f1982d3a1cb18ea35b5acfb0fc7d93e4
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/30/2020
ms.locfileid: "93064078"
---
# <a name="observer-design-pattern-best-practices"></a><span data-ttu-id="08ad4-102">Meilleures pratiques du modèle de design observateur</span><span class="sxs-lookup"><span data-stu-id="08ad4-102">Observer Design Pattern Best Practices</span></span>

<span data-ttu-id="08ad4-103">Dans .NET, le modèle de conception observateur est implémenté comme un ensemble d’interfaces.</span><span class="sxs-lookup"><span data-stu-id="08ad4-103">In .NET, the observer design pattern is implemented as a set of interfaces.</span></span> <span data-ttu-id="08ad4-104">L'interface <xref:System.IObservable%601?displayProperty=nameWithType> représente le fournisseur de données, qui est également chargé de fournir une implémentation <xref:System.IDisposable> permettant aux observateurs d'annuler leur abonnement aux notifications.</span><span class="sxs-lookup"><span data-stu-id="08ad4-104">The <xref:System.IObservable%601?displayProperty=nameWithType> interface represents the data provider, which is also responsible for providing an <xref:System.IDisposable> implementation that lets observers unsubscribe from notifications.</span></span> <span data-ttu-id="08ad4-105">L'interface <xref:System.IObserver%601?displayProperty=nameWithType> représente l'observateur.</span><span class="sxs-lookup"><span data-stu-id="08ad4-105">The <xref:System.IObserver%601?displayProperty=nameWithType> interface represents the observer.</span></span> <span data-ttu-id="08ad4-106">Cette rubrique décrit les meilleures pratiques que les développeurs doivent suivre quand ils implémentent le modèle de conception observateur à l'aide de ces interfaces.</span><span class="sxs-lookup"><span data-stu-id="08ad4-106">This topic describes the best practices that developers should follow when implementing the observer design pattern using these interfaces.</span></span>  
  
## <a name="threading"></a><span data-ttu-id="08ad4-107">Thread</span><span class="sxs-lookup"><span data-stu-id="08ad4-107">Threading</span></span>  
 <span data-ttu-id="08ad4-108">En général, un fournisseur implémente la méthode <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> en ajoutant un observateur à une liste d’abonnés représentée par un objet de collection, puis il implémente la méthode <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> en supprimant un observateur de la liste des abonnés.</span><span class="sxs-lookup"><span data-stu-id="08ad4-108">Typically, a provider implements the <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> method by adding a particular observer to a subscriber list that is represented by some collection object, and it implements the <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> method by removing a particular observer from the subscriber list.</span></span> <span data-ttu-id="08ad4-109">Un observateur peut appeler ces méthodes à tout moment.</span><span class="sxs-lookup"><span data-stu-id="08ad4-109">An observer can call these methods at any time.</span></span> <span data-ttu-id="08ad4-110">De plus, étant donné que le contrat fournisseur/observateur ne spécifie pas qui est responsable de l'annulation d'abonnement après la méthode de rappel <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType>, il est possible que le fournisseur et l'observateur tentent de supprimer le même membre de la liste.</span><span class="sxs-lookup"><span data-stu-id="08ad4-110">In addition, because the provider/observer contract does not specify who is responsible for unsubscribing after the <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> callback method, the provider and observer may both try to remove the same member from the list.</span></span> <span data-ttu-id="08ad4-111">En raison de cette éventualité, les méthodes <xref:System.IObservable%601.Subscribe%2A> et <xref:System.IDisposable.Dispose%2A> doivent être thread-safe.</span><span class="sxs-lookup"><span data-stu-id="08ad4-111">Because of this possibility, both the <xref:System.IObservable%601.Subscribe%2A> and <xref:System.IDisposable.Dispose%2A> methods should be thread-safe.</span></span> <span data-ttu-id="08ad4-112">En général, cela implique l’utilisation d’une [collection simultanée](../parallel-programming/data-structures-for-parallel-programming.md) ou d’un verrou.</span><span class="sxs-lookup"><span data-stu-id="08ad4-112">Typically, this involves using a [concurrent collection](../parallel-programming/data-structures-for-parallel-programming.md) or a lock.</span></span> <span data-ttu-id="08ad4-113">Les implémentations qui ne sont pas thread-safe doivent indiquer explicitement qu'elles ne le sont pas.</span><span class="sxs-lookup"><span data-stu-id="08ad4-113">Implementations that are not thread-safe should explicitly document that they are not.</span></span>  
  
 <span data-ttu-id="08ad4-114">Les garanties supplémentaires doivent être spécifiées dans une couche supérieure au contrat fournisseur/observateur.</span><span class="sxs-lookup"><span data-stu-id="08ad4-114">Any additional guarantees have to be specified in a layer on top of the provider/observer contract.</span></span> <span data-ttu-id="08ad4-115">Les implémenteurs doivent indiquer clairement lorsqu'ils imposent des conditions supplémentaires afin d'éviter la confusion des utilisateurs concernant le contrat observateur.</span><span class="sxs-lookup"><span data-stu-id="08ad4-115">Implementers should clearly call out when they impose additional requirements to avoid user confusion about the observer contract.</span></span>  
  
## <a name="handling-exceptions"></a><span data-ttu-id="08ad4-116">Gestion des exceptions</span><span class="sxs-lookup"><span data-stu-id="08ad4-116">Handling Exceptions</span></span>  
 <span data-ttu-id="08ad4-117">En raison du couplage faible entre un fournisseur de données et un observateur, les exceptions du modèle de conception observateur ont un but informatif.</span><span class="sxs-lookup"><span data-stu-id="08ad4-117">Because of the loose coupling between a data provider and an observer, exceptions in the observer design pattern are intended to be informational.</span></span> <span data-ttu-id="08ad4-118">Cela affecte la façon dont les observateurs et les fournisseurs gèrent les exceptions dans le modèle de conception observateur.</span><span class="sxs-lookup"><span data-stu-id="08ad4-118">This affects how providers and observers handle exceptions in the observer design pattern.</span></span>  
  
### <a name="the-provider----calling-the-onerror-method"></a><span data-ttu-id="08ad4-119">Le fournisseur – Appel de la méthode OnError</span><span class="sxs-lookup"><span data-stu-id="08ad4-119">The Provider -- Calling the OnError Method</span></span>  
 <span data-ttu-id="08ad4-120">La méthode <xref:System.IObserver%601.OnError%2A> a pour but d'informer les observateurs, tout comme la méthode <xref:System.IObserver%601.OnNext%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="08ad4-120">The <xref:System.IObserver%601.OnError%2A> method is intended as an informational message to observers, much like the <xref:System.IObserver%601.OnNext%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="08ad4-121">Toutefois, la méthode <xref:System.IObserver%601.OnNext%2A> sert à fournir aux observateurs des données actuelles ou mises à jour, alors que la méthode <xref:System.IObserver%601.OnError%2A> sert à indiquer que le fournisseur ne peut pas fournir de données valides.</span><span class="sxs-lookup"><span data-stu-id="08ad4-121">However, the <xref:System.IObserver%601.OnNext%2A> method is designed to provide an observer with current or updated data, whereas the <xref:System.IObserver%601.OnError%2A> method is designed to indicate that the provider is unable to provide valid data.</span></span>  
  
 <span data-ttu-id="08ad4-122">Le fournisseur doit suivre ces meilleures pratiques lors de la gestion des exceptions et de l'appel de la méthode <xref:System.IObserver%601.OnError%2A> :</span><span class="sxs-lookup"><span data-stu-id="08ad4-122">The provider should follow these best practices when handling exceptions and calling the <xref:System.IObserver%601.OnError%2A> method:</span></span>  
  
- <span data-ttu-id="08ad4-123">Le fournisseur doit gérer ses propres exceptions s’il a des exigences spécifiques.</span><span class="sxs-lookup"><span data-stu-id="08ad4-123">The provider must handle its own exceptions if it has any specific requirements.</span></span>  
  
- <span data-ttu-id="08ad4-124">Le fournisseur ne doit pas exiger ni s'attendre à ce que les observateurs gèrent les exceptions.</span><span class="sxs-lookup"><span data-stu-id="08ad4-124">The provider should not expect or require that observers handle exceptions in any particular way.</span></span>  
  
- <span data-ttu-id="08ad4-125">Le fournisseur doit appeler la méthode <xref:System.IObserver%601.OnError%2A> quand il gère une exception qui compromet sa capacité à fournir des mises à jour.</span><span class="sxs-lookup"><span data-stu-id="08ad4-125">The provider should call the <xref:System.IObserver%601.OnError%2A> method when it handles an exception that compromises its ability to provide updates.</span></span> <span data-ttu-id="08ad4-126">Les informations sur ces exceptions peuvent être passées à l'observateur.</span><span class="sxs-lookup"><span data-stu-id="08ad4-126">Information on such exceptions can be passed to the observer.</span></span> <span data-ttu-id="08ad4-127">Dans les autres cas, il est inutile d'informer les observateurs des exceptions.</span><span class="sxs-lookup"><span data-stu-id="08ad4-127">In other cases, there is no need to notify observers of an exception.</span></span>  
  
 <span data-ttu-id="08ad4-128">Une fois que le fournisseur a appelé la méthode <xref:System.IObserver%601.OnError%2A> ou <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType>, il ne doit y avoir aucune autre notification et le fournisseur peut annuler l'abonnement de ses observateurs.</span><span class="sxs-lookup"><span data-stu-id="08ad4-128">Once the provider calls the <xref:System.IObserver%601.OnError%2A> or <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> method, there should be no further notifications, and the provider can unsubscribe its observers.</span></span> <span data-ttu-id="08ad4-129">Toutefois, les observateurs peuvent également annuler leur abonnement à tout moment, y compris avant et après la réception d'une notification <xref:System.IObserver%601.OnError%2A> ou <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="08ad4-129">However, the observers can also unsubscribe themselves at any time, including both before and after they receive an <xref:System.IObserver%601.OnError%2A> or <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> notification.</span></span> <span data-ttu-id="08ad4-130">Le modèle de conception observateur ne détermine pas qui du fournisseur ou de l’observateur est responsable de l’annulation d’abonnement. Par conséquent, il est possible que les deux tentent de se désabonner.</span><span class="sxs-lookup"><span data-stu-id="08ad4-130">The observer design pattern does not dictate whether the provider or the observer is responsible for unsubscribing; therefore, there is a possibility that both may attempt to unsubscribe.</span></span> <span data-ttu-id="08ad4-131">En règle générale, quand les observateurs annulent un abonnement, ils sont supprimés de la collection d’abonnés.</span><span class="sxs-lookup"><span data-stu-id="08ad4-131">Typically, when observers unsubscribe, they are removed from a subscribers collection.</span></span> <span data-ttu-id="08ad4-132">Dans une application à thread unique, l’implémentation <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> doit s’assurer qu’une référence d’objet est valide et que l’objet est membre de la collection d’abonnés avant d’essayer de le supprimer.</span><span class="sxs-lookup"><span data-stu-id="08ad4-132">In a single-threaded application, the <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation should ensure that an object reference is valid and that the object is a member of the subscribers collection before attempting to remove it.</span></span> <span data-ttu-id="08ad4-133">Dans une application multithread, un objet de collection thread-safe, tel qu’un objet <xref:System.Collections.Concurrent.BlockingCollection%601?displayProperty=nameWithType>, doit être utilisé.</span><span class="sxs-lookup"><span data-stu-id="08ad4-133">In a multithreaded application, a thread-safe collection object, such as a <xref:System.Collections.Concurrent.BlockingCollection%601?displayProperty=nameWithType> object, should be used.</span></span>  
  
### <a name="the-observer----implementing-the-onerror-method"></a><span data-ttu-id="08ad4-134">L'observateur – Implémentation de la méthode OnError</span><span class="sxs-lookup"><span data-stu-id="08ad4-134">The Observer -- Implementing the OnError Method</span></span>  
 <span data-ttu-id="08ad4-135">Quand un observateur reçoit une notification d'erreur provenant du fournisseur, celle-ci lui est fournie à titre indicatif et ne l'oblige pas à effectuer d'action particulière.</span><span class="sxs-lookup"><span data-stu-id="08ad4-135">When an observer receives an error notification from a provider, the observer should treat the exception as informational and should not be required to take any particular action.</span></span>  
  
 <span data-ttu-id="08ad4-136">L'observateur doit utiliser ces meilleures pratiques quand il répond à un appel de méthode <xref:System.IObserver%601.OnError%2A> provenant du fournisseur :</span><span class="sxs-lookup"><span data-stu-id="08ad4-136">The observer should follow these best practices when responding to an <xref:System.IObserver%601.OnError%2A> method call from a provider:</span></span>  
  
- <span data-ttu-id="08ad4-137">L'observateur ne doit pas lever d'exceptions depuis ses implémentations d'interface, telles que <xref:System.IObserver%601.OnNext%2A> ou <xref:System.IObserver%601.OnError%2A>.</span><span class="sxs-lookup"><span data-stu-id="08ad4-137">The observer should not throw exceptions from its interface implementations, such as <xref:System.IObserver%601.OnNext%2A> or <xref:System.IObserver%601.OnError%2A>.</span></span> <span data-ttu-id="08ad4-138">Si l'observateur lève des exceptions, il doit s'attendre à ce qu'elles ne soient pas gérées.</span><span class="sxs-lookup"><span data-stu-id="08ad4-138">However, if the observer does throw exceptions, it should expect these exceptions to go unhandled.</span></span>  
  
- <span data-ttu-id="08ad4-139">Pour conserver la pile des appels, un observateur qui souhaite lever un objet <xref:System.Exception> passé à sa méthode <xref:System.IObserver%601.OnError%2A> doit encapsuler l'exception avant de la lever.</span><span class="sxs-lookup"><span data-stu-id="08ad4-139">To preserve the call stack, an observer that wishes to throw an <xref:System.Exception> object that was passed to its <xref:System.IObserver%601.OnError%2A> method should wrap the exception before throwing it.</span></span> <span data-ttu-id="08ad4-140">Un objet d'exception standard doit être utilisé à cet effet.</span><span class="sxs-lookup"><span data-stu-id="08ad4-140">A standard exception object should be used for this purpose.</span></span>  
  
## <a name="additional-best-practices"></a><span data-ttu-id="08ad4-141">Autres meilleures pratiques</span><span class="sxs-lookup"><span data-stu-id="08ad4-141">Additional Best Practices</span></span>  
 <span data-ttu-id="08ad4-142">Dans la méthode <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType>, une tentative d'annulation d'abonnement peut entraîner une référence null.</span><span class="sxs-lookup"><span data-stu-id="08ad4-142">Attempting to unregister in the <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> method may result in a null reference.</span></span> <span data-ttu-id="08ad4-143">Par conséquent, nous vous recommandons d'éviter cette pratique.</span><span class="sxs-lookup"><span data-stu-id="08ad4-143">Therefore, we recommend that you avoid this practice.</span></span>  
  
 <span data-ttu-id="08ad4-144">Même s’il est possible d’attacher un observateur à plusieurs fournisseurs, le modèle recommandé consiste à attacher une instance <xref:System.IObserver%601> à une seule et même instance <xref:System.IObservable%601>.</span><span class="sxs-lookup"><span data-stu-id="08ad4-144">Although it is possible to attach an observer to multiple providers, the recommended pattern is to attach an <xref:System.IObserver%601> instance to only one <xref:System.IObservable%601> instance.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="08ad4-145">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="08ad4-145">See also</span></span>

- [<span data-ttu-id="08ad4-146">Modèle de conception observateur</span><span class="sxs-lookup"><span data-stu-id="08ad4-146">Observer Design Pattern</span></span>](observer-design-pattern.md)
- [<span data-ttu-id="08ad4-147">Comment : implémenter un observateur</span><span class="sxs-lookup"><span data-stu-id="08ad4-147">How to: Implement an Observer</span></span>](how-to-implement-an-observer.md)
- [<span data-ttu-id="08ad4-148">Comment : implémenter un fournisseur</span><span class="sxs-lookup"><span data-stu-id="08ad4-148">How to: Implement a Provider</span></span>](how-to-implement-a-provider.md)

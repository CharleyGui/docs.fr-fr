---
title: Le pool de threads managés
description: Découvrez plus d’informations sur le pool de threads .NET qui fournit des threads de travail en arrière-plan
ms.date: 08/02/2018
helpviewer_keywords:
- thread pooling [.NET]
- thread pools [.NET]
- threading [.NET], thread pool
- threading [.NET], pooling
ms.assetid: 2be05b06-a42e-4c9d-a739-96c21d673927
ms.openlocfilehash: 9bc90acd6d7e1bef81e767ce8c257fed78322554
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/18/2020
ms.locfileid: "94826181"
---
# <a name="the-managed-thread-pool"></a><span data-ttu-id="3619b-103">Le pool de threads managés</span><span class="sxs-lookup"><span data-stu-id="3619b-103">The managed thread pool</span></span>

<span data-ttu-id="3619b-104">La classe <xref:System.Threading.ThreadPool?displayProperty=nameWithType> fournit à votre application un pool de threads de travail qui sont gérés par le système, ce qui vous permet de vous concentrer sur les tâches d’application plutôt que sur la gestion des threads.</span><span class="sxs-lookup"><span data-stu-id="3619b-104">The <xref:System.Threading.ThreadPool?displayProperty=nameWithType> class provides your application with a pool of worker threads that are managed by the system, allowing you to concentrate on application tasks rather than thread management.</span></span> <span data-ttu-id="3619b-105">Si vous avez des tâches courtes qui nécessitent un traitement en arrière-plan, le pool de threads managés est un moyen simple de tirer parti de plusieurs threads.</span><span class="sxs-lookup"><span data-stu-id="3619b-105">If you have short tasks that require background processing, the managed thread pool is an easy way to take advantage of multiple threads.</span></span> <span data-ttu-id="3619b-106">L’utilisation du pool de threads est beaucoup plus facile dans Framework 4 et ultérieur, car vous pouvez créer des objets <xref:System.Threading.Tasks.Task> et <xref:System.Threading.Tasks.Task%601> qui effectuent des tâches asynchrones sur les threads de pool.</span><span class="sxs-lookup"><span data-stu-id="3619b-106">Use of the thread pool is significantly easier in Framework 4 and later, since you can create <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> objects that perform asynchronous tasks on thread pool threads.</span></span>  
  
<span data-ttu-id="3619b-107">.NET utilise des threads de pool pour de nombreux scénarios, notamment les opérations de [bibliothèque parallèle de tâches (TPL)](../parallel-programming/task-parallel-library-tpl.md), l’achèvement des E/S asynchrones, les rappels de [timer](timers.md), les opérations d’attente inscrites, les appels de méthodes asynchrones utilisant des délégués et les connexions de sockets <xref:System.Net?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="3619b-107">.NET uses thread pool threads for many purposes, including [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md) operations, asynchronous I/O completion, [timer](timers.md) callbacks, registered wait operations, asynchronous method calls using delegates, and <xref:System.Net?displayProperty=nameWithType> socket connections.</span></span>  

## <a name="thread-pool-characteristics"></a><span data-ttu-id="3619b-108">Caractéristiques du pool de threads</span><span class="sxs-lookup"><span data-stu-id="3619b-108">Thread pool characteristics</span></span>

<span data-ttu-id="3619b-109">Les threads de pool sont des threads [d’arrière-plan](foreground-and-background-threads.md).</span><span class="sxs-lookup"><span data-stu-id="3619b-109">Thread pool threads are [background](foreground-and-background-threads.md) threads.</span></span> <span data-ttu-id="3619b-110">Chaque thread utilise la taille de pile par défaut, s'exécute avec la priorité par défaut et se trouve dans le multithread cloisonné.</span><span class="sxs-lookup"><span data-stu-id="3619b-110">Each thread uses the default stack size, runs at the default priority, and is in the multithreaded apartment.</span></span> <span data-ttu-id="3619b-111">Une fois qu’un thread du pool de threads a terminé sa tâche, il est retourné à une file d’attente de threads en attente.</span><span class="sxs-lookup"><span data-stu-id="3619b-111">Once a thread in the thread pool completes its task, it's returned to a queue of waiting threads.</span></span> <span data-ttu-id="3619b-112">À partir de ce moment, il peut être réutilisé.</span><span class="sxs-lookup"><span data-stu-id="3619b-112">From this moment it can be reused.</span></span> <span data-ttu-id="3619b-113">Cette réutilisation permet aux applications d’éviter le coût lié à la création d’un nouveau thread pour chaque tâche.</span><span class="sxs-lookup"><span data-stu-id="3619b-113">This reuse enables applications to avoid the cost of creating a new thread for each task.</span></span>
  
<span data-ttu-id="3619b-114">Il n'y a qu'un seul pool de threads par processus.</span><span class="sxs-lookup"><span data-stu-id="3619b-114">There is only one thread pool per process.</span></span>  
  
### <a name="exceptions-in-thread-pool-threads"></a><span data-ttu-id="3619b-115">Exceptions dans les threads de pool</span><span class="sxs-lookup"><span data-stu-id="3619b-115">Exceptions in thread pool threads</span></span>

<span data-ttu-id="3619b-116">Les exceptions non gérées dans les threads de pool entraînent la fin du processus.</span><span class="sxs-lookup"><span data-stu-id="3619b-116">Unhandled exceptions in thread pool threads terminate the process.</span></span> <span data-ttu-id="3619b-117">Il y a trois exceptions à cette règle :</span><span class="sxs-lookup"><span data-stu-id="3619b-117">There are three exceptions to this rule:</span></span>  
  
- <span data-ttu-id="3619b-118">Une <xref:System.Threading.ThreadAbortException?displayProperty=nameWithType> est levée dans un thread de pool, car <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> a été appelée.</span><span class="sxs-lookup"><span data-stu-id="3619b-118">A <xref:System.Threading.ThreadAbortException?displayProperty=nameWithType> is thrown in a thread pool thread because <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> was called.</span></span>  
- <span data-ttu-id="3619b-119">Une <xref:System.AppDomainUnloadedException?displayProperty=nameWithType> est levée dans un thread de pool, car le domaine d’application est en cours de déchargement.</span><span class="sxs-lookup"><span data-stu-id="3619b-119">A <xref:System.AppDomainUnloadedException?displayProperty=nameWithType> is thrown in a thread pool thread because the application domain is being unloaded.</span></span>  
- <span data-ttu-id="3619b-120">Le common language runtime ou un processus hôte met fin au thread.</span><span class="sxs-lookup"><span data-stu-id="3619b-120">The common language runtime or a host process terminates the thread.</span></span>  
  
<span data-ttu-id="3619b-121">Pour plus d'informations, voir [Exceptions dans les threads managés](exceptions-in-managed-threads.md).</span><span class="sxs-lookup"><span data-stu-id="3619b-121">For more information, see [Exceptions in Managed Threads](exceptions-in-managed-threads.md).</span></span>  
  
### <a name="maximum-number-of-thread-pool-threads"></a><span data-ttu-id="3619b-122">Nombre maximal de threads dans un pool</span><span class="sxs-lookup"><span data-stu-id="3619b-122">Maximum number of thread pool threads</span></span>

<span data-ttu-id="3619b-123">Le nombre d’opérations qui peuvent être mises en file d’attente pour le pool de threads est limité seulement par la mémoire disponible.</span><span class="sxs-lookup"><span data-stu-id="3619b-123">The number of operations that can be queued to the thread pool is limited only by available memory.</span></span> <span data-ttu-id="3619b-124">Cependant, le pool de threads limite le nombre de threads qui peuvent être actifs simultanément dans le processus.</span><span class="sxs-lookup"><span data-stu-id="3619b-124">However, the thread pool limits the number of threads that can be active in the process simultaneously.</span></span> <span data-ttu-id="3619b-125">Si tous les threads du pool sont occupés, les éléments de travail supplémentaires sont mis en file d’attente jusqu’à ce que des threads soient disponibles pour les exécuter.</span><span class="sxs-lookup"><span data-stu-id="3619b-125">If all thread pool threads are busy, additional work items are queued until threads to execute them become available.</span></span> <span data-ttu-id="3619b-126">La taille par défaut du pool de threads pour un processus dépend de plusieurs facteurs, tels que la taille de l’espace d’adressage virtuel.</span><span class="sxs-lookup"><span data-stu-id="3619b-126">The default size of the thread pool for a process depends on several factors, such as the size of the virtual address space.</span></span> <span data-ttu-id="3619b-127">Un processus peut appeler la méthode <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> pour déterminer le nombre de threads.</span><span class="sxs-lookup"><span data-stu-id="3619b-127">A process can call the <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> method to determine the number of threads.</span></span>  
  
<span data-ttu-id="3619b-128">Vous pouvez contrôler le nombre maximal de threads à l'aide des méthodes <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> et <xref:System.Threading.ThreadPool.SetMaxThreads%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="3619b-128">You can control the maximum number of threads by using the <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> and <xref:System.Threading.ThreadPool.SetMaxThreads%2A?displayProperty=nameWithType> methods.</span></span>  

> [!NOTE]
> <span data-ttu-id="3619b-129">Le code qui héberge l’common language runtime peut définir la taille à l’aide de la [`ICorThreadpool::CorSetMaxThreads`](../../framework/unmanaged-api/hosting/icorthreadpool-corsetmaxthreads-method.md) méthode.</span><span class="sxs-lookup"><span data-stu-id="3619b-129">Code that hosts the common language runtime can set the size using the [`ICorThreadpool::CorSetMaxThreads`](../../framework/unmanaged-api/hosting/icorthreadpool-corsetmaxthreads-method.md) method.</span></span>  
  
### <a name="thread-pool-minimums"></a><span data-ttu-id="3619b-130">Valeurs minimales d’un pool de threads</span><span class="sxs-lookup"><span data-stu-id="3619b-130">Thread pool minimums</span></span>

<span data-ttu-id="3619b-131">Le pool de threads fournit de nouveaux threads de travail ou des threads de terminaison d'E/S à la demande jusqu'à ce qu'il atteigne la valeur minimale spécifiée pour chaque catégorie.</span><span class="sxs-lookup"><span data-stu-id="3619b-131">The thread pool provides new worker threads or I/O completion threads on demand until it reaches a specified minimum for each category.</span></span> <span data-ttu-id="3619b-132">Vous pouvez utiliser la méthode <xref:System.Threading.ThreadPool.GetMinThreads%2A?displayProperty=nameWithType> pour obtenir ces valeurs minimales.</span><span class="sxs-lookup"><span data-stu-id="3619b-132">You can use the <xref:System.Threading.ThreadPool.GetMinThreads%2A?displayProperty=nameWithType> method to obtain these minimum values.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="3619b-133">Quand la demande est faible, le nombre réel de threads du pool peut être inférieur aux valeurs minimales.</span><span class="sxs-lookup"><span data-stu-id="3619b-133">When demand is low, the actual number of thread pool threads can fall below the minimum values.</span></span>  
  
<span data-ttu-id="3619b-134">Quand une valeur minimale est atteinte, le pool de threads peut créer des threads supplémentaires ou attendre que certaines tâches soient terminées.</span><span class="sxs-lookup"><span data-stu-id="3619b-134">When a minimum is reached, the thread pool can create additional threads or wait until some tasks complete.</span></span> <span data-ttu-id="3619b-135">Le pool de threads crée et détruit les threads de travail afin d’optimiser le débit, qui est défini comme le nombre de tâches qui se terminent par unité de temps.</span><span class="sxs-lookup"><span data-stu-id="3619b-135">The thread pool creates and destroys worker threads in order to optimize throughput, which is defined as the number of tasks that complete per unit of time.</span></span> <span data-ttu-id="3619b-136">Un nombre trop bas de threads peut ne pas permettre une utilisation optimale des ressources disponibles, tandis qu'un nombre trop élevé de threads peut augmenter les conflits de ressources.</span><span class="sxs-lookup"><span data-stu-id="3619b-136">Too few threads might not make optimal use of available resources, whereas too many threads could increase resource contention.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="3619b-137">Vous pouvez utiliser la méthode <xref:System.Threading.ThreadPool.SetMinThreads%2A?displayProperty=nameWithType> pour augmenter le nombre minimal de threads inactifs.</span><span class="sxs-lookup"><span data-stu-id="3619b-137">You can use the <xref:System.Threading.ThreadPool.SetMinThreads%2A?displayProperty=nameWithType> method to increase the minimum number of idle threads.</span></span> <span data-ttu-id="3619b-138">Toutefois, une augmentation non nécessaire de ces valeurs peut entraîner des problèmes de performances.</span><span class="sxs-lookup"><span data-stu-id="3619b-138">However, unnecessarily increasing these values can cause performance problems.</span></span> <span data-ttu-id="3619b-139">Si vous démarrez trop de tâches en même temps, celles-ci seront lentes.</span><span class="sxs-lookup"><span data-stu-id="3619b-139">If too many tasks start at the same time, all of them might appear to be slow.</span></span> <span data-ttu-id="3619b-140">Dans la plupart des cas, le pool de threads sera plus performant avec son propre algorithme d'allocation de threads.</span><span class="sxs-lookup"><span data-stu-id="3619b-140">In most cases the thread pool will perform better with its own algorithm for allocating threads.</span></span>  

## <a name="using-the-thread-pool"></a><span data-ttu-id="3619b-141">Utilisation du pool de threads</span><span class="sxs-lookup"><span data-stu-id="3619b-141">Using the thread pool</span></span>

<span data-ttu-id="3619b-142">Le moyen le plus simple d’utiliser le pool de threads consiste à utiliser la [bibliothèque parallèle de tâches (TPL)](../parallel-programming/task-parallel-library-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="3619b-142">The easiest way to use the thread pool is to use the [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md).</span></span> <span data-ttu-id="3619b-143">Par défaut, les types de la bibliothèque parallèle de tâches, comme <xref:System.Threading.Tasks.Task> et <xref:System.Threading.Tasks.Task%601>, utilisent des threads de pool pour exécuter des tâches.</span><span class="sxs-lookup"><span data-stu-id="3619b-143">By default, TPL types like <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> use thread pool threads to run tasks.</span></span>

<span data-ttu-id="3619b-144">Vous pouvez également utiliser le pool de threads en appelant <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> à partir du code managé (ou [`ICorThreadpool::CorQueueUserWorkItem`](../../framework/unmanaged-api/hosting/icorthreadpool-corqueueuserworkitem-method.md) à partir du code non managé) et en passant un <xref:System.Threading.WaitCallback?displayProperty=nameWithType> délégué représentant la méthode qui exécute la tâche.</span><span class="sxs-lookup"><span data-stu-id="3619b-144">You can also use the thread pool by calling <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> from managed code (or [`ICorThreadpool::CorQueueUserWorkItem`](../../framework/unmanaged-api/hosting/icorthreadpool-corqueueuserworkitem-method.md) from unmanaged code) and passing a <xref:System.Threading.WaitCallback?displayProperty=nameWithType> delegate representing the method that performs the task.</span></span>

<span data-ttu-id="3619b-145">Une autre façon d’utiliser le pool de threads est de mettre en file d’attente des éléments de travail associés à une opération d’attente en utilisant la méthode <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> et en passant un <xref:System.Threading.WaitHandle?displayProperty=nameWithType> qui, quand il est signalé ou quand il a expiré, appelle la méthode représentée par le délégué <xref:System.Threading.WaitOrTimerCallback?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="3619b-145">Another way to use the thread pool is to queue work items that are related to a wait operation by using the <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> method and passing a <xref:System.Threading.WaitHandle?displayProperty=nameWithType> that, when signaled or when timed out, calls the method represented by the <xref:System.Threading.WaitOrTimerCallback?displayProperty=nameWithType> delegate.</span></span> <span data-ttu-id="3619b-146">Les threads de pool sont utilisés pour appeler les méthodes de rappel.</span><span class="sxs-lookup"><span data-stu-id="3619b-146">Thread pool threads are used to invoke callback methods.</span></span>  

<span data-ttu-id="3619b-147">Pour obtenir des exemples, consultez les pages des API référencées.</span><span class="sxs-lookup"><span data-stu-id="3619b-147">For the examples, check the referenced API pages.</span></span>
  
## <a name="skipping-security-checks"></a><span data-ttu-id="3619b-148">Ignorer les vérifications de sécurité</span><span class="sxs-lookup"><span data-stu-id="3619b-148">Skipping security checks</span></span>

<span data-ttu-id="3619b-149">Le pool de threads fournit également les méthodes <xref:System.Threading.ThreadPool.UnsafeQueueUserWorkItem%2A?displayProperty=nameWithType> et <xref:System.Threading.ThreadPool.UnsafeRegisterWaitForSingleObject%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="3619b-149">The thread pool also provides the <xref:System.Threading.ThreadPool.UnsafeQueueUserWorkItem%2A?displayProperty=nameWithType> and <xref:System.Threading.ThreadPool.UnsafeRegisterWaitForSingleObject%2A?displayProperty=nameWithType> methods.</span></span> <span data-ttu-id="3619b-150">Ces méthodes ne doivent être utilisées que si vous êtes certain que la pile de l'appelant n'a pas fait l'objet de vérifications de sécurité effectuées pendant l'exécution de la tâche mise en file d'attente.</span><span class="sxs-lookup"><span data-stu-id="3619b-150">Use these methods only when you are certain that the caller's stack is irrelevant to any security checks performed during the execution of the queued task.</span></span> <span data-ttu-id="3619b-151"><xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> et <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> capturent la pile de l'appelant, qui est fusionnée avec la pile du thread de pool quand le thread commence à exécuter une tâche.</span><span class="sxs-lookup"><span data-stu-id="3619b-151"><xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> and <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> both capture the caller's stack, which is merged into the stack of the thread pool thread when the thread begins to execute a task.</span></span> <span data-ttu-id="3619b-152">Si une vérification de sécurité est requise, la pile entière doit être vérifiée.</span><span class="sxs-lookup"><span data-stu-id="3619b-152">If a security check is required, the entire stack must be checked.</span></span> <span data-ttu-id="3619b-153">Même si elle garantit une sécurité, cette vérification a un impact sur les performances.</span><span class="sxs-lookup"><span data-stu-id="3619b-153">Although the check provides safety, it also has a performance cost.</span></span>  

## <a name="when-not-to-use-thread-pool-threads"></a><span data-ttu-id="3619b-154">Quand ne pas utiliser les threads de pool</span><span class="sxs-lookup"><span data-stu-id="3619b-154">When not to use thread pool threads</span></span>

<span data-ttu-id="3619b-155">Il existe plusieurs scénarios dans lesquels il est préférable de créer et de gérer vos propres threads au lieu d’utiliser des threads de pool :</span><span class="sxs-lookup"><span data-stu-id="3619b-155">There are several scenarios in which it's appropriate to create and manage your own threads instead of using thread pool threads:</span></span>  
  
- <span data-ttu-id="3619b-156">Si vous devez utiliser un thread de premier plan.</span><span class="sxs-lookup"><span data-stu-id="3619b-156">You require a foreground thread.</span></span>  
- <span data-ttu-id="3619b-157">Si un thread doit avoir une priorité particulière.</span><span class="sxs-lookup"><span data-stu-id="3619b-157">You require a thread to have a particular priority.</span></span>  
- <span data-ttu-id="3619b-158">Si vous avez des tâches qui entraînent le blocage du thread pendant une longue durée.</span><span class="sxs-lookup"><span data-stu-id="3619b-158">You have tasks that cause the thread to block for long periods of time.</span></span> <span data-ttu-id="3619b-159">Le pool de threads possède un nombre maximal de threads. Un grand nombre de threads de pool bloqués pourrait donc empêcher le démarrage des tâches.</span><span class="sxs-lookup"><span data-stu-id="3619b-159">The thread pool has a maximum number of threads, so a large number of blocked thread pool threads might prevent tasks from starting.</span></span>  
- <span data-ttu-id="3619b-160">Vous devez placer les threads dans un thread unique cloisonné.</span><span class="sxs-lookup"><span data-stu-id="3619b-160">You need to place threads into a single-threaded apartment.</span></span> <span data-ttu-id="3619b-161">Tous les threads <xref:System.Threading.ThreadPool> se trouvent dans le multithread cloisonné.</span><span class="sxs-lookup"><span data-stu-id="3619b-161">All <xref:System.Threading.ThreadPool> threads are in the multithreaded apartment.</span></span>  
- <span data-ttu-id="3619b-162">Vous avez besoin d'une identité stable associée au thread ou avez besoin de dédier un thread à une tâche.</span><span class="sxs-lookup"><span data-stu-id="3619b-162">You need to have a stable identity associated with the thread, or to dedicate a thread to a task.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3619b-163">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="3619b-163">See also</span></span>

- <xref:System.Threading.ThreadPool?displayProperty=nameWithType>
- <xref:System.Threading.Tasks.Task?displayProperty=nameWithType>
- <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>
- [<span data-ttu-id="3619b-164">Bibliothèque parallèle de tâches</span><span class="sxs-lookup"><span data-stu-id="3619b-164">Task Parallel Library (TPL)</span></span>](../parallel-programming/task-parallel-library-tpl.md)
- [<span data-ttu-id="3619b-165">Procédure : retourner une valeur à partir d’une tâche</span><span class="sxs-lookup"><span data-stu-id="3619b-165">How to: Return a Value from a Task</span></span>](../parallel-programming/how-to-return-a-value-from-a-task.md)
- [<span data-ttu-id="3619b-166">Fonctionnalités et objets de threading</span><span class="sxs-lookup"><span data-stu-id="3619b-166">Threading Objects and Features</span></span>](threading-objects-and-features.md)
- [<span data-ttu-id="3619b-167">Threads et threading</span><span class="sxs-lookup"><span data-stu-id="3619b-167">Threads and Threading</span></span>](threads-and-threading.md)
- [<span data-ttu-id="3619b-168">E/s de fichier asynchrones</span><span class="sxs-lookup"><span data-stu-id="3619b-168">Asynchronous File I/O</span></span>](../io/asynchronous-file-i-o.md)
- [<span data-ttu-id="3619b-169">Minuteurs</span><span class="sxs-lookup"><span data-stu-id="3619b-169">Timers</span></span>](timers.md)

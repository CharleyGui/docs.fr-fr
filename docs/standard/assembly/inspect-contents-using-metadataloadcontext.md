---
title: 'Comment : inspecter le contenu d’un assembly à l’aide de MetadataLoadContext'
description: Découvrez comment utiliser MetadataLoadContext, une API qui vous permet de charger des assemblys .NET à des fins d’inspection.
author: MSDN-WhiteKnight
ms.date: 03/10/2020
ms.technology: dotnet-standard
ms.openlocfilehash: 7f90149a98632ea57e8d241a0ccdf4b50264ac5c
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/15/2020
ms.locfileid: "90552022"
---
# <a name="how-to-inspect-assembly-contents-using-metadataloadcontext"></a><span data-ttu-id="b2a71-103">Comment : inspecter le contenu d’un assembly à l’aide de MetadataLoadContext</span><span class="sxs-lookup"><span data-stu-id="b2a71-103">How to: Inspect assembly contents using MetadataLoadContext</span></span>

<span data-ttu-id="b2a71-104">L’API de réflexion dans .NET par défaut permet aux développeurs d’inspecter le contenu des assemblys chargés dans le contexte d’exécution principal.</span><span class="sxs-lookup"><span data-stu-id="b2a71-104">The reflection API in .NET by default enables developers to inspect the contents of assemblies loaded into the main execution context.</span></span> <span data-ttu-id="b2a71-105">Toutefois, il est parfois impossible de charger un assembly dans le contexte d’exécution, par exemple parce qu’il a été compilé pour une autre architecture de plateforme ou de processeur, ou s’il s’agit d’un [assembly de référence](reference-assemblies.md).</span><span class="sxs-lookup"><span data-stu-id="b2a71-105">However, sometimes it isn't possible to load an assembly into the execution context, for example, because it was compiled for another platform or processor architecture, or it's a [reference assembly](reference-assemblies.md).</span></span> <span data-ttu-id="b2a71-106">L' <xref:System.Reflection.MetadataLoadContext?displayProperty=fullName> API vous permet de charger et d’inspecter de tels assemblys.</span><span class="sxs-lookup"><span data-stu-id="b2a71-106">The <xref:System.Reflection.MetadataLoadContext?displayProperty=fullName> API allows you to load and inspect such assemblies.</span></span> <span data-ttu-id="b2a71-107">Les assemblys chargés dans le <xref:System.Reflection.MetadataLoadContext> sont traités uniquement comme des métadonnées, autrement dit, vous pouvez examiner les types dans l’assembly, mais vous ne pouvez pas exécuter le code qu’il contient.</span><span class="sxs-lookup"><span data-stu-id="b2a71-107">Assemblies loaded into the <xref:System.Reflection.MetadataLoadContext> are treated only as metadata, that is, you can examine types in the assembly, but you can't execute any code contained in it.</span></span> <span data-ttu-id="b2a71-108">Contrairement au contexte d’exécution principal, le <xref:System.Reflection.MetadataLoadContext> ne charge pas automatiquement les dépendances à partir du répertoire actif ; à la place, il utilise la logique de liaison personnalisée fournie par le <xref:System.Reflection.MetadataAssemblyResolver> passé.</span><span class="sxs-lookup"><span data-stu-id="b2a71-108">Unlike the main execution context, the <xref:System.Reflection.MetadataLoadContext> doesn't automatically load dependencies from the current directory; instead it uses the custom binding logic provided by the <xref:System.Reflection.MetadataAssemblyResolver> passed to it.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="b2a71-109">Prérequis</span><span class="sxs-lookup"><span data-stu-id="b2a71-109">Prerequisites</span></span>

<span data-ttu-id="b2a71-110">Pour utiliser <xref:System.Reflection.MetadataLoadContext> , installez le package NuGet [System. Reflection. MetadataLoadContext](https://www.nuget.org/packages/System.Reflection.MetadataLoadContext) .</span><span class="sxs-lookup"><span data-stu-id="b2a71-110">To use <xref:System.Reflection.MetadataLoadContext>, install the [System.Reflection.MetadataLoadContext](https://www.nuget.org/packages/System.Reflection.MetadataLoadContext) NuGet package.</span></span> <span data-ttu-id="b2a71-111">Il est pris en charge sur n’importe quel Framework cible conforme à la norme de .NET Standard 2,0, par exemple, .NET Core 2,0 ou .NET Framework 4.6.1.</span><span class="sxs-lookup"><span data-stu-id="b2a71-111">It is supported on any .NET Standard 2.0-compliant target framework, for example, .NET Core 2.0 or .NET Framework 4.6.1.</span></span>

## <a name="create-metadataassemblyresolver-for-metadataloadcontext"></a><span data-ttu-id="b2a71-112">Créer MetadataAssemblyResolver pour MetadataLoadContext</span><span class="sxs-lookup"><span data-stu-id="b2a71-112">Create MetadataAssemblyResolver for MetadataLoadContext</span></span>

<span data-ttu-id="b2a71-113">La création du <xref:System.Reflection.MetadataLoadContext> requiert la fourniture de l’instance du <xref:System.Reflection.MetadataAssemblyResolver> .</span><span class="sxs-lookup"><span data-stu-id="b2a71-113">Creating the <xref:System.Reflection.MetadataLoadContext> requires providing the instance of the <xref:System.Reflection.MetadataAssemblyResolver>.</span></span> <span data-ttu-id="b2a71-114">La façon la plus simple d’en fournir une consiste à utiliser <xref:System.Reflection.PathAssemblyResolver> , qui résout les assemblys à partir de la collection donnée de chaînes de chemin d’accès d’assembly.</span><span class="sxs-lookup"><span data-stu-id="b2a71-114">The simplest way to provide one is to use the <xref:System.Reflection.PathAssemblyResolver>, which resolves assemblies from the given collection of assembly path strings.</span></span> <span data-ttu-id="b2a71-115">Cette collection, outre les assemblys que vous souhaitez inspecter directement, doit également inclure toutes les dépendances nécessaires.</span><span class="sxs-lookup"><span data-stu-id="b2a71-115">This collection, besides assemblies you want to inspect directly, should also include all needed dependencies.</span></span> <span data-ttu-id="b2a71-116">Par exemple, pour lire l’attribut personnalisé situé dans un assembly externe, vous devez inclure cet assembly, sans quoi une exception sera levée.</span><span class="sxs-lookup"><span data-stu-id="b2a71-116">For example, to read the custom attribute located in an external assembly, you should include that assembly or an exception will be thrown.</span></span> <span data-ttu-id="b2a71-117">Dans la plupart des cas, vous devez inclure au moins l' *assembly principal*, autrement dit, l’assembly contenant les types de système intégrés, tels que <xref:System.Object?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="b2a71-117">In most cases, you should include at least the *core assembly*, that is, the assembly containing built-in system types, such as <xref:System.Object?displayProperty=nameWithType>.</span></span> <span data-ttu-id="b2a71-118">Le code suivant montre comment créer à l' <xref:System.Reflection.PathAssemblyResolver> aide de la collection constituée de l’assembly inspecté et de l’assembly principal du runtime actuel :</span><span class="sxs-lookup"><span data-stu-id="b2a71-118">The following code shows how to create the <xref:System.Reflection.PathAssemblyResolver> using the collection consisting of the inspected assembly and the current runtime's core assembly:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#CoreAssembly)]

<span data-ttu-id="b2a71-119">Si vous avez besoin d’accéder à tous les types BCL, vous pouvez inclure tous les assemblys de Runtime dans la collection.</span><span class="sxs-lookup"><span data-stu-id="b2a71-119">If you need access to all BCL types, you can include all runtime assemblies in the collection.</span></span> <span data-ttu-id="b2a71-120">Le code suivant montre comment créer à l' <xref:System.Reflection.PathAssemblyResolver> aide de la collection constituée de l’assembly inspecté et de tous les assemblys du runtime actuel :</span><span class="sxs-lookup"><span data-stu-id="b2a71-120">The following code shows how to create the <xref:System.Reflection.PathAssemblyResolver> using the collection consisting of the inspected assembly and all assemblies of the current runtime:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#RuntimeAssemblies)]

## <a name="create-metadataloadcontext"></a><span data-ttu-id="b2a71-121">Créer MetadataLoadContext</span><span class="sxs-lookup"><span data-stu-id="b2a71-121">Create MetadataLoadContext</span></span>

<span data-ttu-id="b2a71-122">Pour créer le <xref:System.Reflection.MetadataLoadContext> , appelez son constructeur <xref:System.Reflection.MetadataLoadContext.%23ctor%28System.Reflection.MetadataAssemblyResolver%2CSystem.String%29> , en passant le précédemment créé <xref:System.Reflection.MetadataAssemblyResolver> comme premier paramètre et le nom de l’assembly principal comme deuxième paramètre.</span><span class="sxs-lookup"><span data-stu-id="b2a71-122">To create the <xref:System.Reflection.MetadataLoadContext>, invoke its constructor <xref:System.Reflection.MetadataLoadContext.%23ctor%28System.Reflection.MetadataAssemblyResolver%2CSystem.String%29>, passing the previously created <xref:System.Reflection.MetadataAssemblyResolver> as the first parameter and the core assembly name as the second parameter.</span></span> <span data-ttu-id="b2a71-123">Vous pouvez omettre le nom de l’assembly principal, auquel cas le constructeur tente d’utiliser les noms par défaut : « mscorlib », « System. Runtime » ou « netstandard ».</span><span class="sxs-lookup"><span data-stu-id="b2a71-123">You can omit the core assembly name, in which case the constructor will attempt to use default names: "mscorlib", "System.Runtime", or "netstandard".</span></span>

<span data-ttu-id="b2a71-124">Une fois que vous avez créé le contexte, vous pouvez charger des assemblys dans celui-ci à l’aide de méthodes telles que <xref:System.Reflection.MetadataLoadContext.LoadFromAssemblyPath%2A> .</span><span class="sxs-lookup"><span data-stu-id="b2a71-124">After you've created the context, you can load assemblies into it using methods such as <xref:System.Reflection.MetadataLoadContext.LoadFromAssemblyPath%2A>.</span></span> <span data-ttu-id="b2a71-125">Vous pouvez utiliser toutes les API de réflexion sur les assemblys chargés, à l’exception de ceux qui impliquent l’exécution du code.</span><span class="sxs-lookup"><span data-stu-id="b2a71-125">You can use all reflection APIs on loaded assemblies except ones that involve code execution.</span></span> <span data-ttu-id="b2a71-126">La <xref:System.Reflection.MemberInfo.GetCustomAttributes%2A> méthode implique l’exécution de constructeurs. par conséquent, utilisez <xref:System.Reflection.MemberInfo.GetCustomAttributesData%2A> plutôt la méthode lorsque vous devez examiner des attributs personnalisés dans le <xref:System.Reflection.MetadataLoadContext> .</span><span class="sxs-lookup"><span data-stu-id="b2a71-126">The <xref:System.Reflection.MemberInfo.GetCustomAttributes%2A> method does involve the execution of constructors, so use the <xref:System.Reflection.MemberInfo.GetCustomAttributesData%2A> method instead when you need to examine custom attributes in the <xref:System.Reflection.MetadataLoadContext>.</span></span>

<span data-ttu-id="b2a71-127">L’exemple de code suivant crée <xref:System.Reflection.MetadataLoadContext> , charge l’assembly dans celui-ci et génère des attributs d’assembly dans la console :</span><span class="sxs-lookup"><span data-stu-id="b2a71-127">The following code sample creates <xref:System.Reflection.MetadataLoadContext>, loads the assembly into it, and outputs assembly attributes into the console:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#CreateContext)]

## <a name="example"></a><span data-ttu-id="b2a71-128"> Exemple</span><span class="sxs-lookup"><span data-stu-id="b2a71-128">Example</span></span>

<span data-ttu-id="b2a71-129">Pour obtenir un exemple de code complet, consultez l' [exemple inspecter le contenu de l’assembly à l’aide de MetadataLoadContext](/samples/dotnet/samples/inspect-assembly-contents-using-metadataloadcontext/).</span><span class="sxs-lookup"><span data-stu-id="b2a71-129">For a complete code example, see the [Inspect assembly contents using MetadataLoadContext sample](/samples/dotnet/samples/inspect-assembly-contents-using-metadataloadcontext/).</span></span>

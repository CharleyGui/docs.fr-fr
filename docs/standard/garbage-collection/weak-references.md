---
title: Références faibles
description: En savoir plus sur les références faibles, qui permettent au garbage collector .NET de collecter un objet tout en permettant à l’application d’accéder à l’objet.
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- weak references, short
- weak references, using
- weak references, long
- garbage collection, weak references
ms.assetid: 6a600fe5-3af3-4c64-82da-10a0a8e2d79b
ms.openlocfilehash: 1c18b4fa979058893e0683620ec6cff8e7b15b9b
ms.sourcegitcommit: 5fd4696a3e5791b2a8c449ccffda87f2cc2d4894
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/15/2020
ms.locfileid: "84768181"
---
# <a name="weak-references"></a><span data-ttu-id="d086a-103">Références faibles</span><span class="sxs-lookup"><span data-stu-id="d086a-103">Weak References</span></span>
<span data-ttu-id="d086a-104">Le Garbage collector ne peut pas collecter un objet actuellement utilisé par une application, tandis que le code de l’application peut accéder à cet objet.</span><span class="sxs-lookup"><span data-stu-id="d086a-104">The garbage collector cannot collect an object in use by an application while the application's code can reach that object.</span></span> <span data-ttu-id="d086a-105">On dit de l’application qu’elle a une référence forte à l’objet.</span><span class="sxs-lookup"><span data-stu-id="d086a-105">The application is said to have a strong reference to the object.</span></span>  
  
 <span data-ttu-id="d086a-106">Une référence faible permet au Garbage collector de collecter l’objet tout en permettant à l’application d’y accéder.</span><span class="sxs-lookup"><span data-stu-id="d086a-106">A weak reference permits the garbage collector to collect the object while still allowing the application to access the object.</span></span> <span data-ttu-id="d086a-107">Une référence faible est valide uniquement pour une période indéterminée jusqu’à ce que l’objet soit collecté quand il n’existe aucune référence forte.</span><span class="sxs-lookup"><span data-stu-id="d086a-107">A weak reference is valid only during the indeterminate amount of time until the object is collected when no strong references exist.</span></span> <span data-ttu-id="d086a-108">Quand vous utilisez une référence faible, l’application peut toujours obtenir une référence forte à l’objet, ce qui l’empêche d’être collecté.</span><span class="sxs-lookup"><span data-stu-id="d086a-108">When you use a weak reference, the application can still obtain a strong reference to the object, which prevents it from being collected.</span></span> <span data-ttu-id="d086a-109">Toutefois, il existe toujours un risque que le Garbage collector accède à l’objet avant qu’une référence forte soit rétablie.</span><span class="sxs-lookup"><span data-stu-id="d086a-109">However, there is always the risk that the garbage collector will get to the object first before a strong reference is reestablished.</span></span>  
  
 <span data-ttu-id="d086a-110">Les références faibles sont utiles pour les objets qui utilisent beaucoup de mémoire, mais peuvent être recréées facilement si elles sont récupérées par le garbage collection.</span><span class="sxs-lookup"><span data-stu-id="d086a-110">Weak references are useful for objects that use a lot of memory, but can be recreated easily if they are reclaimed by garbage collection.</span></span>  
  
 <span data-ttu-id="d086a-111">Supposons que l’arborescence d’une application Windows Forms présente à l’utilisateur un choix hiérarchique d’options complexe.</span><span class="sxs-lookup"><span data-stu-id="d086a-111">Suppose a tree view in a Windows Forms application displays a complex hierarchical choice of options to the user.</span></span> <span data-ttu-id="d086a-112">Si les données sous-jacentes sont volumineuses, la conservation de l’arborescence en mémoire est inefficace quand l’utilisateur est impliqué dans un autre élément de l’application.</span><span class="sxs-lookup"><span data-stu-id="d086a-112">If the underlying data is large, keeping the tree in memory is inefficient when the user is involved with something else in the application.</span></span>  
  
 <span data-ttu-id="d086a-113">Quand l’utilisateur passe à une autre partie de l’application, vous pouvez utiliser la classe <xref:System.WeakReference> pour créer une référence faible à l’arborescence et détruire toutes les références fortes.</span><span class="sxs-lookup"><span data-stu-id="d086a-113">When the user switches away to another part of the application, you can use the <xref:System.WeakReference> class to create a weak reference to the tree and destroy all strong references.</span></span> <span data-ttu-id="d086a-114">Quand l’utilisateur revient à l’arborescence, l’application tente d’obtenir une référence forte à l’arborescence et, en cas de réussite, évite de reconstruire l’arborescence.</span><span class="sxs-lookup"><span data-stu-id="d086a-114">When the user switches back to the tree, the application attempts to obtain a strong reference to the tree and, if successful, avoids reconstructing the tree.</span></span>  
  
 <span data-ttu-id="d086a-115">Pour établir une référence faible à un objet, vous créez un <xref:System.WeakReference> à l’aide de l’instance de l’objet à suivre.</span><span class="sxs-lookup"><span data-stu-id="d086a-115">To establish a weak reference with an object, you create a <xref:System.WeakReference> using the instance of the object to be tracked.</span></span> <span data-ttu-id="d086a-116">Vous affectez ensuite cet objet à la propriété <xref:System.WeakReference.Target%2A> et vous définissez la référence d’origine à l’objet sur `null`.</span><span class="sxs-lookup"><span data-stu-id="d086a-116">You then set the <xref:System.WeakReference.Target%2A> property to that object and set the original reference to the object to `null`.</span></span> <span data-ttu-id="d086a-117">Pour obtenir un exemple de code, consultez <xref:System.WeakReference> dans la bibliothèque de classes.</span><span class="sxs-lookup"><span data-stu-id="d086a-117">For a code example, see <xref:System.WeakReference> in the class library.</span></span>  
  
## <a name="short-and-long-weak-references"></a><span data-ttu-id="d086a-118">Références faibles courtes et longues</span><span class="sxs-lookup"><span data-stu-id="d086a-118">Short and Long Weak References</span></span>  
 <span data-ttu-id="d086a-119">Vous pouvez créer une référence faible courte ou une référence faible longue :</span><span class="sxs-lookup"><span data-stu-id="d086a-119">You can create a short weak reference or a long weak reference:</span></span>  
  
- <span data-ttu-id="d086a-120">Court</span><span class="sxs-lookup"><span data-stu-id="d086a-120">Short</span></span>  
  
     <span data-ttu-id="d086a-121">La cible d’une référence faible courte devient `null` quand l’objet est récupéré par le garbage collection.</span><span class="sxs-lookup"><span data-stu-id="d086a-121">The target of a short weak reference becomes `null` when the object is reclaimed by garbage collection.</span></span> <span data-ttu-id="d086a-122">La référence faible est elle-même un objet managé et fait l’objet d’un garbage collection comme tout autre objet managé.</span><span class="sxs-lookup"><span data-stu-id="d086a-122">The weak reference is itself a managed object, and is subject to garbage collection just like any other managed object.</span></span>  <span data-ttu-id="d086a-123">Une référence faible courte est le constructeur sans paramètre pour <xref:System.WeakReference>.</span><span class="sxs-lookup"><span data-stu-id="d086a-123">A short weak reference is the parameterless constructor for <xref:System.WeakReference>.</span></span>  
  
- <span data-ttu-id="d086a-124">Long</span><span class="sxs-lookup"><span data-stu-id="d086a-124">Long</span></span>  
  
     <span data-ttu-id="d086a-125">Une référence faible longue est conservée après l’appel de la méthode <xref:System.Object.Finalize%2A>.</span><span class="sxs-lookup"><span data-stu-id="d086a-125">A long weak reference is retained after the object's <xref:System.Object.Finalize%2A> method has been called.</span></span> <span data-ttu-id="d086a-126">Cela permet à l’objet d’être recréé, mais l’état de l’objet reste imprévisible.</span><span class="sxs-lookup"><span data-stu-id="d086a-126">This allows the object to be recreated, but the state of the object remains unpredictable.</span></span> <span data-ttu-id="d086a-127">Pour utiliser une référence longue, spécifiez `true` dans le constructeur <xref:System.WeakReference>.</span><span class="sxs-lookup"><span data-stu-id="d086a-127">To use a long reference, specify `true` in the <xref:System.WeakReference> constructor.</span></span>  
  
     <span data-ttu-id="d086a-128">Si le type de l’objet ne dispose pas d’une méthode <xref:System.Object.Finalize%2A>, la fonctionnalité de la référence faible courte s’applique et la référence faible est valide uniquement jusqu’à la collecte de la cible, ce qui peut se produire à tout moment après l’exécution du finaliseur.</span><span class="sxs-lookup"><span data-stu-id="d086a-128">If the object's type does not have a <xref:System.Object.Finalize%2A> method, the short weak reference functionality applies and the weak reference is valid only until the target is collected, which can occur anytime after the finalizer is run.</span></span>  
  
 <span data-ttu-id="d086a-129">Pour établir une référence forte et réutiliser l’objet, effectuez un cast de la propriété <xref:System.WeakReference.Target%2A> d’un <xref:System.WeakReference> vers le type de l’objet.</span><span class="sxs-lookup"><span data-stu-id="d086a-129">To establish a strong reference and use the object again, cast the <xref:System.WeakReference.Target%2A> property of a <xref:System.WeakReference> to the type of the object.</span></span> <span data-ttu-id="d086a-130">Si la propriété <xref:System.WeakReference.Target%2A> retourne la valeur `null`, l’objet a été collecté ; sinon, vous pouvez continuer à utiliser l’objet, car l’application a récupéré une référence forte à celui-ci.</span><span class="sxs-lookup"><span data-stu-id="d086a-130">If the <xref:System.WeakReference.Target%2A> property returns `null`, the object was collected; otherwise, you can continue to use the object because the application has regained a strong reference to it.</span></span>  
  
## <a name="guidelines-for-using-weak-references"></a><span data-ttu-id="d086a-131">Instructions d’utilisation de références faibles</span><span class="sxs-lookup"><span data-stu-id="d086a-131">Guidelines for Using Weak References</span></span>  
 <span data-ttu-id="d086a-132">Utilisez des références faibles longues uniquement quand cela est nécessaire, car l’état de l’objet est imprévisible après la finalisation.</span><span class="sxs-lookup"><span data-stu-id="d086a-132">Use long weak references only when necessary as the state of the object is unpredictable after finalization.</span></span>  
  
 <span data-ttu-id="d086a-133">Évitez d’utiliser des références faibles aux petits objets, car le pointeur lui-même peut être de la même taille ou d’une taille supérieure.</span><span class="sxs-lookup"><span data-stu-id="d086a-133">Avoid using weak references to small objects because the pointer itself may be as large or larger.</span></span>  
  
 <span data-ttu-id="d086a-134">Évitez d’utiliser les références faibles comme solution automatique aux problèmes de gestion de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="d086a-134">Avoid using weak references as an automatic solution to memory management problems.</span></span> <span data-ttu-id="d086a-135">Développez plutôt une stratégie de mise en cache efficace pour gérer les objets de votre application.</span><span class="sxs-lookup"><span data-stu-id="d086a-135">Instead, develop an effective caching policy for handling your application's objects.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d086a-136">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="d086a-136">See also</span></span>

- [<span data-ttu-id="d086a-137">Garbage collection</span><span class="sxs-lookup"><span data-stu-id="d086a-137">Garbage Collection</span></span>](index.md)

---
title: Collecte des ordures de fond
description: Découvrez la collecte des ordures de fond dans .NET et comment il diffère dans la station de travail et la collecte des ordures serveur.
ms.date: 04/21/2020
helpviewer_keywords:
- garbage collection, background
- background garbage collection
ms.openlocfilehash: dcb1d348e679e07646273b8fbc4ea29b44ee4974
ms.sourcegitcommit: 73aa9653547a1cd70ee6586221f79cc29b588ebd
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/23/2020
ms.locfileid: "82103561"
---
# <a name="background-garbage-collection"></a><span data-ttu-id="a8949-103">Collecte des ordures de fond</span><span class="sxs-lookup"><span data-stu-id="a8949-103">Background garbage collection</span></span>

<span data-ttu-id="a8949-104">En arrière-plan de collecte des ordures (GC), les générations éphémères (0 et 1) sont collectées au besoin alors que la collecte de la génération 2 est en cours.</span><span class="sxs-lookup"><span data-stu-id="a8949-104">In background garbage collection (GC), ephemeral generations (0 and 1) are collected as needed while the collection of generation 2 is in progress.</span></span> <span data-ttu-id="a8949-105">La collecte des ordures de fond est effectuée sur un ou plusieurs threads dédiés, selon qu’il s’agit de l’arrière-plan ou du serveur GC, et ne s’applique qu’aux collections de génération 2.</span><span class="sxs-lookup"><span data-stu-id="a8949-105">Background garbage collection is performed on one or more dedicated threads, depending on whether it's background or server GC, and applies only to generation 2 collections.</span></span>

<span data-ttu-id="a8949-106">La collecte des ordures de fond est activée par défaut.</span><span class="sxs-lookup"><span data-stu-id="a8949-106">Background garbage collection is enabled by default.</span></span> <span data-ttu-id="a8949-107">Il peut être activé ou désactivé avec le paramètre de configuration [GCConcurrent](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) dans les applications .NET Framework ou le paramètre [System.GC.Concurrent](../../core/run-time-config/garbage-collector.md#systemgcconcurrentcomplus_gcconcurrent) dans les applications .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a8949-107">It can be enabled or disabled with the [gcConcurrent](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) configuration setting in .NET Framework apps or the [System.GC.Concurrent](../../core/run-time-config/garbage-collector.md#systemgcconcurrentcomplus_gcconcurrent) setting in .NET Core apps.</span></span>

> [!NOTE]
> <span data-ttu-id="a8949-108">La collecte des ordures de fond remplace [la collecte simultanée des ordures](#concurrent-garbage-collection) et est disponible dans .NET Framework 4 et les versions ultérieures.</span><span class="sxs-lookup"><span data-stu-id="a8949-108">Background garbage collection replaces [concurrent garbage collection](#concurrent-garbage-collection) and is available in .NET Framework 4 and later versions.</span></span> <span data-ttu-id="a8949-109">Dans .NET Framework 4, il n’est pris en charge que pour la collecte des ordures de poste de *travail.*</span><span class="sxs-lookup"><span data-stu-id="a8949-109">In .NET Framework 4, it's supported only for *workstation* garbage collection.</span></span> <span data-ttu-id="a8949-110">En commençant par .NET Framework 4.5, la collecte des ordures de fond est disponible pour la collecte des ordures *de poste de travail* et de *serveur.*</span><span class="sxs-lookup"><span data-stu-id="a8949-110">Starting with .NET Framework 4.5, background garbage collection is available for both *workstation* and *server* garbage collection.</span></span>

<span data-ttu-id="a8949-111">Une collection sur les générations éphémères pendant la collecte des ordures de fond est connue sous le nom de collecte des ordures *de premier plan.*</span><span class="sxs-lookup"><span data-stu-id="a8949-111">A collection on ephemeral generations during background garbage collection is known as *foreground* garbage collection.</span></span> <span data-ttu-id="a8949-112">Lorsque des opérations garbage collection de premier plan ont lieu, tous les threads managés sont suspendus.</span><span class="sxs-lookup"><span data-stu-id="a8949-112">When foreground garbage collections occur, all managed threads are suspended.</span></span>

<span data-ttu-id="a8949-113">Lorsque la collecte des ordures de fond est en cours et que vous avez alloué suffisamment d’objets en génération 0, le CLR effectue une collecte des ordures de première génération ou de génération 1.</span><span class="sxs-lookup"><span data-stu-id="a8949-113">When background garbage collection is in progress and you've allocated enough objects in generation 0, the CLR performs a generation 0 or generation 1 foreground garbage collection.</span></span> <span data-ttu-id="a8949-114">Le thread de garbage collection d'arrière-plan dédié vérifie des points sécurisés fréquents de façon à déterminer s'il existe une demande de garbage collection de premier plan.</span><span class="sxs-lookup"><span data-stu-id="a8949-114">The dedicated background garbage collection thread checks at frequent safe points to determine whether there is a request for foreground garbage collection.</span></span> <span data-ttu-id="a8949-115">Le cas échéant, la collecte d'arrière-plan s'interrompt afin que le garbage collection de premier plan puisse se produire.</span><span class="sxs-lookup"><span data-stu-id="a8949-115">If there is, the background collection suspends itself so that foreground garbage collection can occur.</span></span> <span data-ttu-id="a8949-116">Une fois la collecte des ordures au premier plan terminée, les fils de collecte des ordures de fond et les fils d’utilisateur reprennent.</span><span class="sxs-lookup"><span data-stu-id="a8949-116">After the foreground garbage collection is completed, the dedicated background garbage collection threads and user threads resume.</span></span>

<span data-ttu-id="a8949-117">Le garbage collection d'arrière-plan supprime les restrictions d'allocation imposées par le garbage collection simultané, car des opérations garbage collection éphémères peuvent se produire pendant le garbage collection d'arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="a8949-117">Background garbage collection removes allocation restrictions imposed by concurrent garbage collection, because ephemeral garbage collections can occur during background garbage collection.</span></span> <span data-ttu-id="a8949-118">La collecte des ordures de fond peut enlever des objets morts dans des générations éphémères.</span><span class="sxs-lookup"><span data-stu-id="a8949-118">Background garbage collection can remove dead objects in ephemeral generations.</span></span> <span data-ttu-id="a8949-119">Il peut également étendre le tas si nécessaire au cours d’une collecte des ordures de génération 1.</span><span class="sxs-lookup"><span data-stu-id="a8949-119">It can also expand the heap if needed during a generation 1 garbage collection.</span></span>

## <a name="background-workstation-vs-server-gc"></a><span data-ttu-id="a8949-120">Poste de travail d’arrière-plan vs serveur GC</span><span class="sxs-lookup"><span data-stu-id="a8949-120">Background workstation vs. server GC</span></span>

<span data-ttu-id="a8949-121">En commençant par .NET Framework 4.5, la collecte des ordures de fond est disponible pour le serveur GC.</span><span class="sxs-lookup"><span data-stu-id="a8949-121">Starting with .NET Framework 4.5, background garbage collection is available for server GC.</span></span> <span data-ttu-id="a8949-122">Background GC est le mode par défaut pour la collecte des ordures du serveur.</span><span class="sxs-lookup"><span data-stu-id="a8949-122">Background GC is the default mode for server garbage collection.</span></span>

<span data-ttu-id="a8949-123">Fonctions de collecte des ordures du serveur de fond de la même façon que la collecte des ordures de poste de travail de fond, mais il y a quelques différences :</span><span class="sxs-lookup"><span data-stu-id="a8949-123">Background server garbage collection functions similarly to background workstation garbage collection, but there are a few differences:</span></span>

- <span data-ttu-id="a8949-124">La collecte des ordures de poste de travail de fond utilise un fil de collecte d’ordures de fond dédié, tandis que la collecte des ordures de serveur d’arrière-plan utilise plusieurs fils.</span><span class="sxs-lookup"><span data-stu-id="a8949-124">Background workstation garbage collection uses one dedicated background garbage collection thread, whereas background server garbage collection uses multiple threads.</span></span> <span data-ttu-id="a8949-125">Typiquement, il ya un thread dédié pour chaque processeur logique.</span><span class="sxs-lookup"><span data-stu-id="a8949-125">Typically, there's a dedicated thread for each logical processor.</span></span>

- <span data-ttu-id="a8949-126">Contrairement au fil de collecte des ordures de fond de poste de travail, les fils GC serveur d’arrière-plan ne s’arrêtent pas.</span><span class="sxs-lookup"><span data-stu-id="a8949-126">Unlike the workstation background garbage collection thread, the background server GC threads do not time out.</span></span>

<span data-ttu-id="a8949-127">L’illustration suivante montre la collecte des ordures *de poste de travail* de fond effectuée sur un fil distinct et dédié :</span><span class="sxs-lookup"><span data-stu-id="a8949-127">The following illustration shows background *workstation* garbage collection performed on a separate, dedicated thread:</span></span>

![Nettoyage de la mémoire de la station de travail en arrière-plan](./media/fundamentals/background-workstation-garbage-collection.png)

<span data-ttu-id="a8949-129">L’illustration suivante montre la collecte des ordures *du serveur* de fond effectuée sur des fils distincts et dédiés :</span><span class="sxs-lookup"><span data-stu-id="a8949-129">The following illustration shows background *server* garbage collection performed on separate, dedicated threads:</span></span>

![Nettoyage de la mémoire du serveur en arrière-plan](./media/fundamentals/background-server-garbage-collection.png)

## <a name="concurrent-garbage-collection"></a><span data-ttu-id="a8949-131">Garbage collection simultané</span><span class="sxs-lookup"><span data-stu-id="a8949-131">Concurrent garbage collection</span></span>

> [!TIP]
> <span data-ttu-id="a8949-132">Cette section s’applique à :</span><span class="sxs-lookup"><span data-stu-id="a8949-132">This section applies to:</span></span>
>
> - <span data-ttu-id="a8949-133">.NET Framework 3.5 et plus tôt pour la collecte des ordures de poste de travail</span><span class="sxs-lookup"><span data-stu-id="a8949-133">.NET Framework 3.5 and earlier for workstation garbage collection</span></span>
> - <span data-ttu-id="a8949-134">.NET Framework 4 et plus tôt pour la collecte des ordures du serveur</span><span class="sxs-lookup"><span data-stu-id="a8949-134">.NET Framework 4 and earlier for server garbage collection</span></span>
>
> <span data-ttu-id="a8949-135">Les déchets concomitants sont remplacés par la collecte des ordures de fond dans les versions ultérieures.</span><span class="sxs-lookup"><span data-stu-id="a8949-135">Concurrent garbage is replaced by background garbage collection in later versions.</span></span>

<span data-ttu-id="a8949-136">Dans le poste de travail ou la collecte des ordures serveur, vous pouvez activer la [collecte simultanée des ordures](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md), ce qui permet aux threads de fonctionner en même temps qu’un fil dédié qui effectue la collecte des ordures pendant la majeure partie de la durée de la collecte.</span><span class="sxs-lookup"><span data-stu-id="a8949-136">In workstation or server garbage collection, you can [enable concurrent garbage collection](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md), which enables threads to run concurrently with a dedicated thread that performs the garbage collection for most of the duration of the collection.</span></span> <span data-ttu-id="a8949-137">Cette option n’affecte que les collectes d’ordures de la génération 2; générations 0 et 1 sont toujours non-concurrentes parce qu’elles finissent rapidement.</span><span class="sxs-lookup"><span data-stu-id="a8949-137">This option affects only garbage collections in generation 2; generations 0 and 1 are always non-concurrent because they finish fast.</span></span>

<span data-ttu-id="a8949-138">Le garbage collection simultané permet aux applications interactives d'être plus réactives en réduisant les pauses d'une collection.</span><span class="sxs-lookup"><span data-stu-id="a8949-138">Concurrent garbage collection enables interactive applications to be more responsive by minimizing pauses for a collection.</span></span> <span data-ttu-id="a8949-139">Les threads managés peuvent continuer à s'exécuter une grande partie de la durée du garbage collection simultané.</span><span class="sxs-lookup"><span data-stu-id="a8949-139">Managed threads can continue to run most of the time while the concurrent garbage collection thread is running.</span></span> <span data-ttu-id="a8949-140">Cela génère des pauses plus courtes pendant l'opération garbage collection.</span><span class="sxs-lookup"><span data-stu-id="a8949-140">This results in shorter pauses while a garbage collection is occurring.</span></span>

<span data-ttu-id="a8949-141">Le garbage collection simultané est exécuté sur un thread dédié.</span><span class="sxs-lookup"><span data-stu-id="a8949-141">Concurrent garbage collection is performed on a dedicated thread.</span></span> <span data-ttu-id="a8949-142">Par défaut, le CLR effectue la collecte des ordures de poste de travail avec la collecte simultanée des ordures activées sur les ordinateurs à processeur unique et multi-processeurs.</span><span class="sxs-lookup"><span data-stu-id="a8949-142">By default, the CLR runs workstation garbage collection with concurrent garbage collection enabled on both single-processor and multi-processor computers.</span></span>

<span data-ttu-id="a8949-143">L'illustration suivante montre le garbage collection simultané exécuté sur un thread dédié différent.</span><span class="sxs-lookup"><span data-stu-id="a8949-143">The following illustration shows concurrent garbage collection performed on a separate dedicated thread.</span></span>

![Threads de nettoyage de la mémoire simultanés](./media/gc-concurrent.png)

## <a name="see-also"></a><span data-ttu-id="a8949-145">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="a8949-145">See also</span></span>

- [<span data-ttu-id="a8949-146">Garbage collection de station de travail et de serveur</span><span class="sxs-lookup"><span data-stu-id="a8949-146">Workstation and server garbage collection</span></span>](workstation-server-gc.md)
- [<span data-ttu-id="a8949-147">Options de configuration en temps d’exécution pour la collecte des ordures</span><span class="sxs-lookup"><span data-stu-id="a8949-147">Run-time configuration options for garbage collection</span></span>](../../core/run-time-config/garbage-collector.md)

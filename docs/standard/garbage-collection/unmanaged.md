---
title: Nettoyage de ressources non managées
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- Close method
- Dispose method
- garbage collector
- garbage collection, unmanaged resources
- cleanup operations
- explicit cleanups
- unmanaged resource cleanup
- Finalize method
ms.assetid: a17b0066-71c2-4ba4-9822-8e19332fc213
ms.openlocfilehash: e05cfb949ee3f206f212ca7015f3ff4c22cd2a12
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/15/2020
ms.locfileid: "73423036"
---
# <a name="cleaning-up-unmanaged-resources"></a><span data-ttu-id="40996-102">Nettoyage de ressources non managées</span><span class="sxs-lookup"><span data-stu-id="40996-102">Cleaning Up Unmanaged Resources</span></span>

<span data-ttu-id="40996-103">Pour la majorité des objets créés par votre application, vous pouvez laisser au Garbage collector .NET le soin de gérer les tâches de gestion de mémoire.</span><span class="sxs-lookup"><span data-stu-id="40996-103">For the majority of the objects that your app creates, you can rely on .NET's garbage collector to handle memory management.</span></span> <span data-ttu-id="40996-104">Lorsque vous créez des objets qui incluent des ressources non managées, vous devez libérer explicitement ces ressources lorsque vous avez fini de les utiliser dans votre application.</span><span class="sxs-lookup"><span data-stu-id="40996-104">However, when you create objects that include unmanaged resources, you must explicitly release those resources when you finish using them in your app.</span></span> <span data-ttu-id="40996-105">Les types les plus courants de ressources non managées sont des objets qui encapsulent les ressources du système d'exploitation, telles que les fichiers, les fenêtres, les connexions réseau ou les connexions de bases de données.</span><span class="sxs-lookup"><span data-stu-id="40996-105">The most common types of unmanaged resource are objects that wrap operating system resources, such as files, windows, network connections, or database connections.</span></span> <span data-ttu-id="40996-106">Bien que le récupérateur de mémoire puisse assurer le suivi de la durée de vie d'un objet qui encapsule une ressource non managée, il ne sait pas comment libérer et nettoyer la ressource non managée.</span><span class="sxs-lookup"><span data-stu-id="40996-106">Although the garbage collector is able to track the lifetime of an object that encapsulates an unmanaged resource, it doesn't know how to release and clean up the unmanaged resource.</span></span>

<span data-ttu-id="40996-107">Si vos types utilisent les ressources non managées, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="40996-107">If your types use unmanaged resources, you should do the following:</span></span>

- <span data-ttu-id="40996-108">Implémentez le [modèle de suppression](implementing-dispose.md).</span><span class="sxs-lookup"><span data-stu-id="40996-108">Implement the [dispose pattern](implementing-dispose.md).</span></span> <span data-ttu-id="40996-109">Pour ce faire, vous devez fournir une implémentation de <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> pour activer la version déterministe des ressources non managées.</span><span class="sxs-lookup"><span data-stu-id="40996-109">This requires that you provide an <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation to enable the deterministic release of  unmanaged resources.</span></span> <span data-ttu-id="40996-110">Un consommateur de votre type appelle la méthode <xref:System.IDisposable.Dispose%2A> lorsque l'objet (et les ressources qu'il utilise) n'est plus nécessaire.</span><span class="sxs-lookup"><span data-stu-id="40996-110">A consumer of your type calls <xref:System.IDisposable.Dispose%2A> when the object (and the resources it uses) is no longer needed.</span></span> <span data-ttu-id="40996-111">La méthode <xref:System.IDisposable.Dispose%2A> libère immédiatement les ressources non managées.</span><span class="sxs-lookup"><span data-stu-id="40996-111">The <xref:System.IDisposable.Dispose%2A> method immediately releases the unmanaged resources.</span></span>

- <span data-ttu-id="40996-112">Prévoyez que vos ressources non managées soient libérées si un consommateur de votre type oublie d'appeler la méthode <xref:System.IDisposable.Dispose%2A>.</span><span class="sxs-lookup"><span data-stu-id="40996-112">Provide for your unmanaged resources to be released in the event that a consumer of your type forgets to call <xref:System.IDisposable.Dispose%2A>.</span></span> <span data-ttu-id="40996-113">Il existe deux façons d'effectuer cette opération :</span><span class="sxs-lookup"><span data-stu-id="40996-113">There are two ways to do this:</span></span>

  - <span data-ttu-id="40996-114">Utilisez un handle sécurisé pour encapsuler votre ressource non managée.</span><span class="sxs-lookup"><span data-stu-id="40996-114">Use a safe handle to wrap your unmanaged resource.</span></span> <span data-ttu-id="40996-115">Il s’agit de la technique recommandée.</span><span class="sxs-lookup"><span data-stu-id="40996-115">This is the recommended technique.</span></span> <span data-ttu-id="40996-116">Les handles sécurisés sont dérivés de la classe <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType> et incluent une méthode <xref:System.Object.Finalize%2A> fiable.</span><span class="sxs-lookup"><span data-stu-id="40996-116">Safe handles are derived from the <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType> class and include a robust <xref:System.Object.Finalize%2A> method.</span></span> <span data-ttu-id="40996-117">Lorsque vous utilisez un handle sécurisé, implémentez simplement l'interface <xref:System.IDisposable> et appelez la méthode <xref:System.Runtime.InteropServices.SafeHandle.Dispose%2A> de votre handle sécurisé dans l'implémentation de <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="40996-117">When you use a safe handle, you simply implement the <xref:System.IDisposable> interface and call your safe handle's <xref:System.Runtime.InteropServices.SafeHandle.Dispose%2A> method in your <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation.</span></span> <span data-ttu-id="40996-118">Le finaliseur du handle sécurisé est appelé automatiquement par le récupérateur de mémoire si sa méthode <xref:System.IDisposable.Dispose%2A> n'est pas appelé.</span><span class="sxs-lookup"><span data-stu-id="40996-118">The safe handle's finalizer is called automatically by the garbage collector if its <xref:System.IDisposable.Dispose%2A> method is not called.</span></span>

    <span data-ttu-id="40996-119">Ou</span><span class="sxs-lookup"><span data-stu-id="40996-119">—or—</span></span>

  - <span data-ttu-id="40996-120">Remplacez la méthode <xref:System.Object.Finalize%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="40996-120">Override the <xref:System.Object.Finalize%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="40996-121">La finalisation active la mise en production non déterministe des ressources non managées lorsque le consommateur d’un type n’appelle pas la méthode <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> pour les supprimer de manière déterministe.</span><span class="sxs-lookup"><span data-stu-id="40996-121">Finalization enables the non-deterministic release of unmanaged resources when the consumer of a type fails to call <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> to dispose of them deterministically.</span></span> <span data-ttu-id="40996-122">Toutefois, comme la finalisation de l'objet peut s'avérer être une opération complexe et susceptible d'engendrer des erreurs, nous vous recommandons d'utiliser un handle sécurisé au lieu de fournir votre propre finaliseur.</span><span class="sxs-lookup"><span data-stu-id="40996-122">However, because object finalization can be a complex and error-prone operation, we recommend that you use a safe handle instead of providing your own finalizer.</span></span>

<span data-ttu-id="40996-123">Les consommateurs de votre type peuvent ensuite appeler directement votre implémentation de <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> pour libérer la mémoire utilisée par les ressources non managées.</span><span class="sxs-lookup"><span data-stu-id="40996-123">Consumers of your type can then call your <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation directly to free memory used by unmanaged resources.</span></span> <span data-ttu-id="40996-124">Lorsque vous implémentez correctement une méthode <xref:System.IDisposable.Dispose%2A>, la méthode <xref:System.Object.Finalize%2A> de votre handle sécurisé ou votre propre substitution de la méthode <xref:System.Object.Finalize%2A?displayProperty=nameWithType> devient un dispositif de protection pour nettoyer les ressources si la méthode <xref:System.IDisposable.Dispose%2A> n'est pas appelée.</span><span class="sxs-lookup"><span data-stu-id="40996-124">When you properly implement a <xref:System.IDisposable.Dispose%2A> method, either your safe handle's <xref:System.Object.Finalize%2A> method or your own override of the <xref:System.Object.Finalize%2A?displayProperty=nameWithType> method becomes a safeguard to clean up resources in the event that the <xref:System.IDisposable.Dispose%2A> method is not called.</span></span>

## <a name="in-this-section"></a><span data-ttu-id="40996-125">Dans cette section</span><span class="sxs-lookup"><span data-stu-id="40996-125">In This Section</span></span>

<span data-ttu-id="40996-126">[Implémentation d’une méthode Dispose](../../../docs/standard/garbage-collection/implementing-dispose.md) Explique comment implémenter le [modèle de suppression](implementing-dispose.md) pour libérer les ressources non managées.</span><span class="sxs-lookup"><span data-stu-id="40996-126">[Implementing a Dispose Method](../../../docs/standard/garbage-collection/implementing-dispose.md) Describes how to implement the [dispose pattern](implementing-dispose.md) for releasing unmanaged resources.</span></span>

<span data-ttu-id="40996-127">[Utilisation d’objets implémentant IDisposable](../../../docs/standard/garbage-collection/using-objects.md) Décrit comment les consommateurs d’un type vérifient que son implémentation <xref:System.IDisposable.Dispose%2A> est appelée.</span><span class="sxs-lookup"><span data-stu-id="40996-127">[Using Objects That Implement IDisposable](../../../docs/standard/garbage-collection/using-objects.md) Describes how consumers of a type ensure that its <xref:System.IDisposable.Dispose%2A> implementation is called.</span></span> <span data-ttu-id="40996-128">Pour ce faire, nous vous recommandons d'utiliser l'instruction `using` en C# ou l'instruction `Using` en Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="40996-128">We recommend using the C# `using` statement or the Visual Basic `Using` statement to do this.</span></span>

## <a name="reference"></a><span data-ttu-id="40996-129">Informations de référence</span><span class="sxs-lookup"><span data-stu-id="40996-129">Reference</span></span>

<xref:System.IDisposable?displayProperty=nameWithType>\
<span data-ttu-id="40996-130">Définit la méthode <xref:System.IDisposable.Dispose%2A> pour libérer des ressources non managées.</span><span class="sxs-lookup"><span data-stu-id="40996-130">Defines the <xref:System.IDisposable.Dispose%2A> method for releasing unmanaged resources.</span></span>

<xref:System.Object.Finalize%2A?displayProperty=nameWithType>\
<span data-ttu-id="40996-131">Prévoit la finalisation de l’objet si les ressources non managées ne sont pas libérées par la méthode <xref:System.IDisposable.Dispose%2A>.</span><span class="sxs-lookup"><span data-stu-id="40996-131">Provides for object finalization if unmanaged resources are not released by the <xref:System.IDisposable.Dispose%2A> method.</span></span>

<xref:System.GC.SuppressFinalize%2A?displayProperty=nameWithType>\
<span data-ttu-id="40996-132">Supprime la finalisation.</span><span class="sxs-lookup"><span data-stu-id="40996-132">Suppresses finalization.</span></span> <span data-ttu-id="40996-133">Cette méthode est généralement appelée à partir d'une méthode `Dispose` pour empêcher un finaliseur de s'exécuter.</span><span class="sxs-lookup"><span data-stu-id="40996-133">This method is customarily called from a `Dispose` method to prevent a finalizer from executing.</span></span>

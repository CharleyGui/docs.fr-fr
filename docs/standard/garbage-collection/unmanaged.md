---
title: Nettoyage de ressources non managées
description: Découvrez comment nettoyer les ressources non managées non gérées par le garbage collector .NET, telles que les fichiers, les fenêtres, les & les connexions réseau ou de base de données.
ms.date: 05/13/2020
helpviewer_keywords:
- Close method
- Dispose method
- garbage collector
- garbage collection, unmanaged resources
- cleanup operations
- explicit cleanups
- unmanaged resource cleanup
- Finalize method
ms.assetid: a17b0066-71c2-4ba4-9822-8e19332fc213
ms.openlocfilehash: edfb01411df3d974073a397a20f58acdcd8521f3
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/18/2020
ms.locfileid: "94827501"
---
# <a name="cleaning-up-unmanaged-resources"></a><span data-ttu-id="442d3-103">Nettoyage de ressources non managées</span><span class="sxs-lookup"><span data-stu-id="442d3-103">Cleaning up unmanaged resources</span></span>

<span data-ttu-id="442d3-104">Pour la majorité des objets créés par votre application, vous pouvez vous appuyer sur le [garbage collector .net](index.md) pour gérer la gestion de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="442d3-104">For the majority of the objects that your app creates, you can rely on the [.NET garbage collector](index.md) to handle memory management.</span></span> <span data-ttu-id="442d3-105">Toutefois, lorsque vous créez des objets qui incluent des ressources non managées, vous devez libérer explicitement ces ressources une fois que vous avez fini de les utiliser.</span><span class="sxs-lookup"><span data-stu-id="442d3-105">However, when you create objects that include unmanaged resources, you must explicitly release those resources when you finish using them.</span></span> <span data-ttu-id="442d3-106">Les types les plus courants de ressources non managées sont des objets qui encapsulent les ressources du système d’exploitation, telles que les fichiers, les fenêtres, les connexions réseau ou les connexions de base de données.</span><span class="sxs-lookup"><span data-stu-id="442d3-106">The most common types of unmanaged resources are objects that wrap operating system resources, such as files, windows, network connections, or database connections.</span></span> <span data-ttu-id="442d3-107">Bien que le récupérateur de mémoire puisse assurer le suivi de la durée de vie d'un objet qui encapsule une ressource non managée, il ne sait pas comment libérer et nettoyer la ressource non managée.</span><span class="sxs-lookup"><span data-stu-id="442d3-107">Although the garbage collector is able to track the lifetime of an object that encapsulates an unmanaged resource, it doesn't know how to release and clean up the unmanaged resource.</span></span>

<span data-ttu-id="442d3-108">Si vos types utilisent les ressources non managées, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="442d3-108">If your types use unmanaged resources, you should do the following:</span></span>

- <span data-ttu-id="442d3-109">Implémentez le [modèle de suppression](implementing-dispose.md).</span><span class="sxs-lookup"><span data-stu-id="442d3-109">Implement the [dispose pattern](implementing-dispose.md).</span></span> <span data-ttu-id="442d3-110">Pour cela, vous devez fournir une <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implémentation pour activer la version déterministe des ressources non managées.</span><span class="sxs-lookup"><span data-stu-id="442d3-110">This requires that you provide an <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation to enable the deterministic release of unmanaged resources.</span></span> <span data-ttu-id="442d3-111">Un consommateur de votre type appelle <xref:System.IDisposable.Dispose%2A> lorsque l’objet (et les ressources qu’il utilise) n’est plus nécessaire.</span><span class="sxs-lookup"><span data-stu-id="442d3-111">A consumer of your type calls <xref:System.IDisposable.Dispose%2A> when the object (and the resources it uses) are no longer needed.</span></span> <span data-ttu-id="442d3-112">La méthode <xref:System.IDisposable.Dispose%2A> libère immédiatement les ressources non managées.</span><span class="sxs-lookup"><span data-stu-id="442d3-112">The <xref:System.IDisposable.Dispose%2A> method immediately releases the unmanaged resources.</span></span>

- <span data-ttu-id="442d3-113">Dans le cas où un consommateur de votre type oublie d’appeler <xref:System.IDisposable.Dispose%2A> , vous pouvez libérer vos ressources non managées.</span><span class="sxs-lookup"><span data-stu-id="442d3-113">In the event that a consumer of your type forgets to call <xref:System.IDisposable.Dispose%2A>, provide a way for your unmanaged resources to be released.</span></span> <span data-ttu-id="442d3-114">Il existe deux façons d'effectuer cette opération :</span><span class="sxs-lookup"><span data-stu-id="442d3-114">There are two ways to do this:</span></span>

  - <span data-ttu-id="442d3-115">Utilisez un handle sécurisé pour encapsuler votre ressource non managée.</span><span class="sxs-lookup"><span data-stu-id="442d3-115">Use a safe handle to wrap your unmanaged resource.</span></span> <span data-ttu-id="442d3-116">Il s’agit de la technique recommandée.</span><span class="sxs-lookup"><span data-stu-id="442d3-116">This is the recommended technique.</span></span> <span data-ttu-id="442d3-117">Les Handles sécurisés sont dérivés de la <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType> classe abstraite et incluent une <xref:System.Object.Finalize%2A> méthode robuste.</span><span class="sxs-lookup"><span data-stu-id="442d3-117">Safe handles are derived from the <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType> abstract class and include a robust <xref:System.Object.Finalize%2A> method.</span></span> <span data-ttu-id="442d3-118">Lorsque vous utilisez un handle sécurisé, implémentez simplement l'interface <xref:System.IDisposable> et appelez la méthode <xref:System.Runtime.InteropServices.SafeHandle.Dispose%2A> de votre handle sécurisé dans l'implémentation de <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="442d3-118">When you use a safe handle, you simply implement the <xref:System.IDisposable> interface and call your safe handle's <xref:System.Runtime.InteropServices.SafeHandle.Dispose%2A> method in your <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation.</span></span> <span data-ttu-id="442d3-119">Le finaliseur du handle sécurisé est appelé automatiquement par le récupérateur de mémoire si sa méthode <xref:System.IDisposable.Dispose%2A> n'est pas appelé.</span><span class="sxs-lookup"><span data-stu-id="442d3-119">The safe handle's finalizer is called automatically by the garbage collector if its <xref:System.IDisposable.Dispose%2A> method is not called.</span></span>

    <span data-ttu-id="442d3-120">—**ou**—</span><span class="sxs-lookup"><span data-stu-id="442d3-120">—**or**—</span></span>

  - <span data-ttu-id="442d3-121">Remplacez la méthode <xref:System.Object.Finalize%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="442d3-121">Override the <xref:System.Object.Finalize%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="442d3-122">La finalisation active la mise en production non déterministe des ressources non managées lorsque le consommateur d’un type n’appelle pas la méthode <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> pour les supprimer de manière déterministe.</span><span class="sxs-lookup"><span data-stu-id="442d3-122">Finalization enables the non-deterministic release of unmanaged resources when the consumer of a type fails to call <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> to dispose of them deterministically.</span></span> <span data-ttu-id="442d3-123">Définissez un [finaliseur](../../csharp/programming-guide/classes-and-structs/destructors.md) en substituant la <xref:System.Object.Finalize%2A?displayProperty=nameWithType> méthode.</span><span class="sxs-lookup"><span data-stu-id="442d3-123">Define a [finalizer](../../csharp/programming-guide/classes-and-structs/destructors.md) by overriding the <xref:System.Object.Finalize%2A?displayProperty=nameWithType> method.</span></span>

  > [!WARNING]
  > <span data-ttu-id="442d3-124">Toutefois, étant donné que la finalisation de l’objet peut être une opération complexe et sujette aux erreurs, nous vous recommandons d’utiliser un handle sécurisé au lieu de fournir votre propre finaliseur.</span><span class="sxs-lookup"><span data-stu-id="442d3-124">However, because object finalization can be a complex and an error-prone operation, we recommend that you use a safe handle instead of providing your own finalizer.</span></span>

<span data-ttu-id="442d3-125">Les consommateurs de votre type peuvent ensuite appeler directement votre implémentation de <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> pour libérer la mémoire utilisée par les ressources non managées.</span><span class="sxs-lookup"><span data-stu-id="442d3-125">Consumers of your type can then call your <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation directly to free memory used by unmanaged resources.</span></span> <span data-ttu-id="442d3-126">Lorsque vous implémentez correctement une méthode <xref:System.IDisposable.Dispose%2A>, la méthode <xref:System.Object.Finalize%2A> de votre handle sécurisé ou votre propre substitution de la méthode <xref:System.Object.Finalize%2A?displayProperty=nameWithType> devient un dispositif de protection pour nettoyer les ressources si la méthode <xref:System.IDisposable.Dispose%2A> n'est pas appelée.</span><span class="sxs-lookup"><span data-stu-id="442d3-126">When you properly implement a <xref:System.IDisposable.Dispose%2A> method, either your safe handle's <xref:System.Object.Finalize%2A> method or your own override of the <xref:System.Object.Finalize%2A?displayProperty=nameWithType> method becomes a safeguard to clean up resources in the event that the <xref:System.IDisposable.Dispose%2A> method is not called.</span></span>

## <a name="in-this-section"></a><span data-ttu-id="442d3-127">Dans cette section</span><span class="sxs-lookup"><span data-stu-id="442d3-127">In this section</span></span>

<span data-ttu-id="442d3-128">[Implémentation d’une méthode dispose](implementing-dispose.md) décrit comment implémenter le modèle de suppression pour libérer des ressources non managées.</span><span class="sxs-lookup"><span data-stu-id="442d3-128">[Implementing a Dispose method](implementing-dispose.md) describes how to implement the dispose pattern for releasing unmanaged resources.</span></span>

<span data-ttu-id="442d3-129">[Utilisation d’objets qui `IDisposable` implémentent](using-objects.md) décrit comment les consommateurs d’un type vérifient que son <xref:System.IDisposable.Dispose%2A> implémentation est appelée.</span><span class="sxs-lookup"><span data-stu-id="442d3-129">[Using objects that implement `IDisposable`](using-objects.md) describes how consumers of a type ensure that its <xref:System.IDisposable.Dispose%2A> implementation is called.</span></span> <span data-ttu-id="442d3-130">`using`Pour ce faire, nous vous recommandons d’utiliser l’instruction C# (ou l’Visual Basic `Using` ).</span><span class="sxs-lookup"><span data-stu-id="442d3-130">We recommend using the C# `using` (or the Visual Basic `Using`) statement to do this.</span></span>

## <a name="reference"></a><span data-ttu-id="442d3-131">Référence</span><span class="sxs-lookup"><span data-stu-id="442d3-131">Reference</span></span>

| <span data-ttu-id="442d3-132">Type/membre</span><span class="sxs-lookup"><span data-stu-id="442d3-132">Type / Member</span></span> | <span data-ttu-id="442d3-133">Description</span><span class="sxs-lookup"><span data-stu-id="442d3-133">Description</span></span> |
|--|--|
| <xref:System.IDisposable?displayProperty=nameWithType> | <span data-ttu-id="442d3-134">Définit la méthode <xref:System.IDisposable.Dispose%2A> pour libérer des ressources non managées.</span><span class="sxs-lookup"><span data-stu-id="442d3-134">Defines the <xref:System.IDisposable.Dispose%2A> method for releasing unmanaged resources.</span></span> |
| <xref:System.Object.Finalize%2A?displayProperty=nameWithType> | <span data-ttu-id="442d3-135">Prévoit la finalisation de l’objet si les ressources non managées ne sont pas libérées par la méthode <xref:System.IDisposable.Dispose%2A>.</span><span class="sxs-lookup"><span data-stu-id="442d3-135">Provides for object finalization if unmanaged resources are not released by the <xref:System.IDisposable.Dispose%2A> method.</span></span> |
| <xref:System.GC.SuppressFinalize%2A?displayProperty=nameWithType> | <span data-ttu-id="442d3-136">Supprime la finalisation.</span><span class="sxs-lookup"><span data-stu-id="442d3-136">Suppresses finalization.</span></span> <span data-ttu-id="442d3-137">Cette méthode est généralement appelée à partir d'une méthode `Dispose` pour empêcher un finaliseur de s'exécuter.</span><span class="sxs-lookup"><span data-stu-id="442d3-137">This method is customarily called from a `Dispose` method to prevent a finalizer from executing.</span></span> |

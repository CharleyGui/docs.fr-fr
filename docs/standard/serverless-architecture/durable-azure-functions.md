---
title: Azure functions durables - applications sans serveur
description: Azure functions durables étendent le runtime Azure Functions pour activer le flux de travail avec état dans le code.
author: cecilphillip
ms.author: cephilli
ms.date: 06/26/2018
ms.openlocfilehash: f7ee74926d6658042120113b49dc763383881423
ms.sourcegitcommit: 8699383914c24a0df033393f55db3369db728a7b
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/15/2019
ms.locfileid: "65643400"
---
# <a name="durable-azure-functions"></a><span data-ttu-id="ee949-103">Fonctions Azure durables</span><span class="sxs-lookup"><span data-stu-id="ee949-103">Durable Azure functions</span></span>

<span data-ttu-id="ee949-104">Lorsque vous créez des applications sans serveur avec Azure Functions, vos opérations seront généralement conçues pour s’exécuter sans état.</span><span class="sxs-lookup"><span data-stu-id="ee949-104">When creating serverless applications with Azure Functions, your operations will typically be designed to run in a stateless manner.</span></span> <span data-ttu-id="ee949-105">La raison de ce choix de conception est, car comme les échelles de plateforme, il devient difficile de savoir quels serveurs le code est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="ee949-105">The reason for this design choice is because as the platform scales, it becomes difficult to know what servers the code is running on.</span></span> <span data-ttu-id="ee949-106">Il devient également difficile de savoir combien d’instances est actifs à un moment donné.</span><span class="sxs-lookup"><span data-stu-id="ee949-106">It also becomes difficult to know how many instances are active at any given point.</span></span> <span data-ttu-id="ee949-107">Toutefois, il existe des classes d’applications qui nécessitent l’état actuel d’un processus connu.</span><span class="sxs-lookup"><span data-stu-id="ee949-107">However, there are classes of applications that require the current state of a process to be known.</span></span> <span data-ttu-id="ee949-108">Considérons le processus de soumission d’une commande à un magasin en ligne.</span><span class="sxs-lookup"><span data-stu-id="ee949-108">Consider the process of submitting an order to an online store.</span></span> <span data-ttu-id="ee949-109">L’opération d’extraction peut être un flux de travail qui se compose de plusieurs opérations qui doivent connaître l’état du processus.</span><span class="sxs-lookup"><span data-stu-id="ee949-109">The checkout operation might be a workflow that is composed of multiple operations that need to know the state of the process.</span></span> <span data-ttu-id="ee949-110">Ces informations peuvent inclure l’inventaire de produits, si le client dispose d’aucun crédit sur leur compte et également les résultats du traitement de la carte de crédit.</span><span class="sxs-lookup"><span data-stu-id="ee949-110">Such information may include the product inventory, if the customer has any credits on their account, and also the results of processing the credit card.</span></span> <span data-ttu-id="ee949-111">Ces opérations peuvent être facilement leurs propres flux de travail interne ou un voire des services à partir des systèmes tiers.</span><span class="sxs-lookup"><span data-stu-id="ee949-111">These operations could easily be their own internal workflows or even services from third-party systems.</span></span>

<span data-ttu-id="ee949-112">Différents modèles existent aujourd'hui cet assist la coordination de l’état de l’application entre les systèmes internes et externes.</span><span class="sxs-lookup"><span data-stu-id="ee949-112">Various patterns exist today that assist with the coordination of application state between internal and external systems.</span></span> <span data-ttu-id="ee949-113">Il est courant de rencontrer des solutions qui s’appuient sur les systèmes centralisés de file d’attente, les magasins de clés-valeurs distribuées ou des bases de données partagées pour gérer cet état.</span><span class="sxs-lookup"><span data-stu-id="ee949-113">It's common to come across solutions that rely on centralized queuing systems, distributed key-value stores, or shared databases to manage that state.</span></span> <span data-ttu-id="ee949-114">Toutefois, il s’agit de toutes les autres ressources qui doivent désormais être configurés et gérés.</span><span class="sxs-lookup"><span data-stu-id="ee949-114">However, these are all additional resources that now need to be provisioned and managed.</span></span> <span data-ttu-id="ee949-115">Dans un environnement sans serveur, votre code peut devenir fastidieux d’essayer de coordonner avec ces ressources manuellement.</span><span class="sxs-lookup"><span data-stu-id="ee949-115">In a serverless environment, your code could become cumbersome trying to coordinate with these resources manually.</span></span> <span data-ttu-id="ee949-116">Azure Functions offre une alternative pour la création des fonctions avec état appelées fonctions durables.</span><span class="sxs-lookup"><span data-stu-id="ee949-116">Azure Functions offers an alternative for creating stateful functions called Durable Functions.</span></span>

<span data-ttu-id="ee949-117">Fonctions durables est une extension pour le runtime Azure Functions qui permet la définition de flux de travail avec état dans le code.</span><span class="sxs-lookup"><span data-stu-id="ee949-117">Durable Functions is an extension to the Azure Functions runtime that enables the definition of stateful workflows in code.</span></span> <span data-ttu-id="ee949-118">En décomposant en activités de flux de travail, l’extension fonctions durables peut gérer l’état de créer des points de contrôle de progression et gérer la distribution des appels de fonction entre les serveurs.</span><span class="sxs-lookup"><span data-stu-id="ee949-118">By breaking down workflows into activities, the Durable Functions extension can manage state, create progress checkpoints, and handle the distribution of function calls across servers.</span></span> <span data-ttu-id="ee949-119">En arrière-plan, elle rend utiliser d’un compte de stockage Azure pour conserver l’historique d’exécution, de planifier les fonctions d’activité et de récupérer des réponses.</span><span class="sxs-lookup"><span data-stu-id="ee949-119">In the background, it makes use of an Azure Storage account to persist execution history, schedule activity functions and retrieve responses.</span></span> <span data-ttu-id="ee949-120">Votre code sans serveur ne doit jamais interagir avec les informations persistantes dans ce compte de stockage et est généralement pas quelque chose que les développeurs ont besoin d’interagir.</span><span class="sxs-lookup"><span data-stu-id="ee949-120">Your serverless code should never interact with persisted information in that storage account, and is typically not something with which developers need to interact.</span></span>

## <a name="triggering-a-stateful-workflow"></a><span data-ttu-id="ee949-121">Déclencher un flux de travail avec état</span><span class="sxs-lookup"><span data-stu-id="ee949-121">Triggering a stateful workflow</span></span>

<span data-ttu-id="ee949-122">Flux de travail avec état dans fonctions durables peut être divisé en deux composants intrinsèques. déclencheurs d’orchestration et l’activité.</span><span class="sxs-lookup"><span data-stu-id="ee949-122">Stateful workflows in Durable Functions can be broken down into two intrinsic components; orchestration and activity triggers.</span></span> <span data-ttu-id="ee949-123">Déclencheurs et liaisons sont les principaux composants utilisés par Azure Functions pour permettre à vos fonctions sans serveur être averti pour démarrer, la réception d’entrée et retourner des résultats.</span><span class="sxs-lookup"><span data-stu-id="ee949-123">Triggers and bindings are core components used by Azure Functions to enable your serverless functions to be notified when to start, receive input, and return results.</span></span>

### <a name="working-with-the-orchestration-client"></a><span data-ttu-id="ee949-124">Utilisation du client d’Orchestration</span><span class="sxs-lookup"><span data-stu-id="ee949-124">Working with the Orchestration client</span></span>

<span data-ttu-id="ee949-125">Orchestrations sont uniques par rapport aux autres styles d’opérations déclenchées dans Azure Functions.</span><span class="sxs-lookup"><span data-stu-id="ee949-125">Orchestrations are unique when compared to other styles of triggered operations in Azure Functions.</span></span> <span data-ttu-id="ee949-126">Fonctions durables permet l’exécution de fonctions qui peut prendre plusieurs heures voire plusieurs jours pour terminer.</span><span class="sxs-lookup"><span data-stu-id="ee949-126">Durable Functions enables the execution of functions that may take hours or even days to complete.</span></span> <span data-ttu-id="ee949-127">Ce type de comportement est fourni avec la nécessité de vérifier l’état d’une orchestration en cours d’exécution, titre préventif terminer, ou envoyer des notifications d’événements externes.</span><span class="sxs-lookup"><span data-stu-id="ee949-127">That type of behavior comes with the need to able to check the status of a running orchestration, preemptively terminate, or send notifications of external events.</span></span>

<span data-ttu-id="ee949-128">Dans ces cas, l’extension fonctions durables fournit la `DurableOrchestrationClient` classe qui vous permet d’interagir avec orchestré fonctions.</span><span class="sxs-lookup"><span data-stu-id="ee949-128">For such cases, the Durable Functions extension provides the `DurableOrchestrationClient` class that allows you to interact with orchestrated functions.</span></span> <span data-ttu-id="ee949-129">Vous obtenez l’accès au client d’orchestration à l’aide de la `OrchestrationClientAttribute` liaison.</span><span class="sxs-lookup"><span data-stu-id="ee949-129">You get access to the orchestration client by using the `OrchestrationClientAttribute` binding.</span></span> <span data-ttu-id="ee949-130">En règle générale, vous devez inclure cet attribut avec un autre type de déclencheur, comme un `HttpTrigger` ou `ServiceBusTrigger`.</span><span class="sxs-lookup"><span data-stu-id="ee949-130">Generally, you would include this attribute with another trigger type, such as an `HttpTrigger` or `ServiceBusTrigger`.</span></span> <span data-ttu-id="ee949-131">Une fois que la fonction de la source a été déclenchée, le client de l’orchestration peut être utilisé pour démarrer une fonction d’orchestrateur.</span><span class="sxs-lookup"><span data-stu-id="ee949-131">Once the source function has been triggered, the orchestration client can be used to start an orchestrator function.</span></span>

```csharp
[FunctionName("KickOff")]
public static async Task<HttpResponseMessage> Run(
    [HttpTrigger(AuthorizationLevel.Function, "POST")]HttpRequestMessage req,
    [OrchestrationClient ] DurableOrchestrationClient<orchestrationClient>)
{
    OrderRequestData data = await req.Content.ReadAsAsync<OrderRequestData>();

    string instanceId = await orchestrationClient.StartNewAsync("PlaceOrder", data);

    return orchestrationClient.CreateCheckStatusResponse(req, instanceId);
}
```

### <a name="the-orchestrator-function"></a><span data-ttu-id="ee949-132">La fonction d’orchestrateur</span><span class="sxs-lookup"><span data-stu-id="ee949-132">The orchestrator function</span></span>

<span data-ttu-id="ee949-133">Annoter une fonction avec la OrchestrationTriggerAttribute dans Azure Functions marques cette fonction comme une fonction d’orchestrateur.</span><span class="sxs-lookup"><span data-stu-id="ee949-133">Annotating a function with the OrchestrationTriggerAttribute in Azure Functions marks that function as an orchestrator function.</span></span> <span data-ttu-id="ee949-134">Il est chargé de gérer les différentes activités qui composent votre flux de travail avec état.</span><span class="sxs-lookup"><span data-stu-id="ee949-134">It's responsible for managing the various activities that make up your stateful workflow.</span></span>

<span data-ttu-id="ee949-135">Les fonctions d’orchestrateur ne parvenons pas à utiliser des liaisons autres que le OrchestrationTriggerAttribute.</span><span class="sxs-lookup"><span data-stu-id="ee949-135">Orchestrator functions are unable to make use of bindings other than the OrchestrationTriggerAttribute.</span></span> <span data-ttu-id="ee949-136">Cet attribut peut uniquement être utilisé avec un type de paramètre de DurableOrchestrationContext.</span><span class="sxs-lookup"><span data-stu-id="ee949-136">This attribute can only be used with a parameter type of DurableOrchestrationContext.</span></span> <span data-ttu-id="ee949-137">Aucune entrée n’est utilisable dans la mesure où la désérialisation des entrées dans la signature de fonction n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="ee949-137">No other inputs can be used since deserialization of inputs in the function signature isn't supported.</span></span> <span data-ttu-id="ee949-138">Pour obtenir des entrées fournies par le client d’orchestration, le GetInput\<T\> méthode doit être utilisée.</span><span class="sxs-lookup"><span data-stu-id="ee949-138">To get inputs provided by the orchestration client, the GetInput\<T\> method must be used.</span></span>

<span data-ttu-id="ee949-139">En outre, les types de retour des fonctions d’orchestration doivent être void, tâche ou une valeur sérialisable JSON.</span><span class="sxs-lookup"><span data-stu-id="ee949-139">Also, the return types of orchestration functions must be either void, Task, or a JSON serializable value.</span></span>

> <span data-ttu-id="ee949-140">*Gestion du code d’erreur a été omis par souci de concision*</span><span class="sxs-lookup"><span data-stu-id="ee949-140">*Error handling code has been left out for brevity*</span></span>

```csharp
[FunctionName("PlaceOrder")]
public static async Task<string> PlaceOrder([OrchestrationTrigger] DurableOrchestrationContext context)
{
    OrderRequestData orderData = context.GetInput<OrderRequestData>();

    await context.CallActivityAsync<bool>("CheckAndReserveInventory", orderData);
    await context.CallActivityAsync<string>("ProcessPayment", orderData);

    string trackingNumber = await context.CallActivityAsync<string>("ScheduleShipping", orderData);
    await context.CallActivityAsync<string>("EmailCustomer", trackingNumber);

    return trackingNumber;
}
```

<span data-ttu-id="ee949-141">Plusieurs instances d’une orchestration peuvent être démarré et s’exécute en même temps.</span><span class="sxs-lookup"><span data-stu-id="ee949-141">Multiple instances of an orchestration can be started and running at the same time.</span></span> <span data-ttu-id="ee949-142">Appel de la `StartNewAsync` méthode sur le `DurableOrchestrationClient` lance une nouvelle instance de l’orchestration.</span><span class="sxs-lookup"><span data-stu-id="ee949-142">Calling the `StartNewAsync` method on the `DurableOrchestrationClient` launches a new instance of the orchestration.</span></span> <span data-ttu-id="ee949-143">La méthode retourne un `Task<string>` qui se termine lorsque l’orchestration a démarré.</span><span class="sxs-lookup"><span data-stu-id="ee949-143">The method returns a `Task<string>` that completes when the orchestration has started.</span></span> <span data-ttu-id="ee949-144">Une exception de type `TimeoutException` obtient levée si l’orchestration n’a pas démarré dans les 30 secondes.</span><span class="sxs-lookup"><span data-stu-id="ee949-144">An exception of type `TimeoutException` gets thrown if the orchestration hasn't started within 30 seconds.</span></span>

<span data-ttu-id="ee949-145">Fin du `Task<string>` de `StartNewAsync` doit contenir l’ID unique de l’instance d’orchestration.</span><span class="sxs-lookup"><span data-stu-id="ee949-145">The completed `Task<string>` from `StartNewAsync` should contain the unique ID of the orchestration instance.</span></span> <span data-ttu-id="ee949-146">Cet ID d’instance peut être utilisé pour appeler des opérations sur cette orchestration.</span><span class="sxs-lookup"><span data-stu-id="ee949-146">This instance ID can be used to invoke operations on that specific orchestration.</span></span> <span data-ttu-id="ee949-147">L’orchestration peut être interrogée pour connaître l’état ou envoyée des notifications d’événements.</span><span class="sxs-lookup"><span data-stu-id="ee949-147">The orchestration can be queried for the status or sent event notifications.</span></span>

### <a name="the-activity-functions"></a><span data-ttu-id="ee949-148">Les fonctions d’activité</span><span class="sxs-lookup"><span data-stu-id="ee949-148">The activity functions</span></span>

<span data-ttu-id="ee949-149">Fonctions d’activité sont les opérations discrètes obtient décomposées au sein d’une fonction d’orchestration pour créer le workflow.</span><span class="sxs-lookup"><span data-stu-id="ee949-149">Activity functions are the discrete operations that get composed together within an orchestration function to create the workflow.</span></span> <span data-ttu-id="ee949-150">Voici où a lieu la plupart du travail réel.</span><span class="sxs-lookup"><span data-stu-id="ee949-150">Here is where most of actual work would take place.</span></span> <span data-ttu-id="ee949-151">Ils représentent la logique métier, longs processus en cours d’exécution et les pièces du puzzle à une solution plus vaste.</span><span class="sxs-lookup"><span data-stu-id="ee949-151">They represent the business logic, long running processes, and the puzzle pieces to a larger solution.</span></span>

<span data-ttu-id="ee949-152">Le `ActivityTriggerAttribute` est utilisé pour annoter un paramètre de fonction de type `DurableActivityContext`.</span><span class="sxs-lookup"><span data-stu-id="ee949-152">The `ActivityTriggerAttribute` is used to annotate a function parameter of type `DurableActivityContext`.</span></span> <span data-ttu-id="ee949-153">À l’aide de l’annotation informe le runtime de que la fonction est destinée à être utilisée comme une fonction d’activité.</span><span class="sxs-lookup"><span data-stu-id="ee949-153">Using the annotation informs the runtime that the function is intended to be used as an activity function.</span></span> <span data-ttu-id="ee949-154">Les valeurs d’entrée pour les fonctions d’activité sont récupérés à l’aide de la `GetInput<T>` méthode de le `DurableActivityContext` paramètre.</span><span class="sxs-lookup"><span data-stu-id="ee949-154">Input values to activity functions are retrieved using the `GetInput<T>` method of the `DurableActivityContext` parameter.</span></span>

<span data-ttu-id="ee949-155">Comme pour les fonctions d’orchestration, les types de retour des fonctions d’activité doivent être void, tâche ou une valeur sérialisable JSON.</span><span class="sxs-lookup"><span data-stu-id="ee949-155">Similar to orchestration functions, the return types of activity functions must be either void, Task, or a JSON serializable value.</span></span>

<span data-ttu-id="ee949-156">Les exceptions non gérées levées dans les fonctions d’activité obtient envoyées à la fonction d’orchestrateur appelant et présentées sous la forme un `TaskFailedException`.</span><span class="sxs-lookup"><span data-stu-id="ee949-156">Any unhandled exceptions that get thrown within activity functions will get sent up to the calling orchestrator function and presented as a `TaskFailedException`.</span></span> <span data-ttu-id="ee949-157">À ce stade, l’erreur peut être interceptée et connecté l’orchestrateur, et l’activité peut être retentée.</span><span class="sxs-lookup"><span data-stu-id="ee949-157">At this point, the error can be caught and logged in the orchestrator, and the activity can be retried.</span></span>

```csharp
[FunctionName("CheckAndReserveInventory")]
public static bool CheckAndReserveInventory([ActivityTrigger] DurableActivityContext context)
{
    OrderRequestData orderData = context.GetInput<OrderRequestData>();

    // Connect to inventory system and try to reserve items
    return true;
}
```

## <a name="recommended-resources"></a><span data-ttu-id="ee949-158">Ressources recommandées</span><span class="sxs-lookup"><span data-stu-id="ee949-158">Recommended resources</span></span>

* [<span data-ttu-id="ee949-159">Fonctions durables</span><span class="sxs-lookup"><span data-stu-id="ee949-159">Durable Functions</span></span>](https://docs.microsoft.com/azure/azure-functions/durable-functions-overview)
* [<span data-ttu-id="ee949-160">Liaisons pour fonctions durables</span><span class="sxs-lookup"><span data-stu-id="ee949-160">Bindings for Durable Functions</span></span>](https://docs.microsoft.com/azure/azure-functions/durable-functions-bindings)
* [<span data-ttu-id="ee949-161">Gérer des instances dans fonctions durables</span><span class="sxs-lookup"><span data-stu-id="ee949-161">Manage instances in Durable Functions</span></span>](https://docs.microsoft.com/azure/azure-functions/durable-functions-instance-management)

>[!div class="step-by-step"]
><span data-ttu-id="ee949-162">[Précédent](event-grid.md)
>[Suivant](orchestration-patterns.md)</span><span class="sxs-lookup"><span data-stu-id="ee949-162">[Previous](event-grid.md)
[Next](orchestration-patterns.md)</span></span>

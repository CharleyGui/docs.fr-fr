---
title: Utiliser des modèles dans les objets-didacticiel C#
description: Ce didacticiel vous apprend à utiliser des critères spéciaux dans les membres d’une classe pour créer de meilleurs modèles pour le comportement des objets
ms.date: 11/05/2020
ms.openlocfilehash: 072f6f57696504c2d691473e3a43c1cda53f227f
ms.sourcegitcommit: 6bef8abde346c59771a35f4f76bf037ff61c5ba3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/06/2020
ms.locfileid: "94332190"
---
# <a name="use-pattern-matching-to-build-your-class-behavior-for-better-code"></a><span data-ttu-id="4baf2-103">Utilisez des critères spéciaux pour générer le comportement de votre classe pour un meilleur code</span><span class="sxs-lookup"><span data-stu-id="4baf2-103">Use pattern matching to build your class behavior for better code</span></span>

<span data-ttu-id="4baf2-104">Les fonctionnalités de critères spéciaux en C# fournissent une syntaxe pour exprimer vos algorithmes.</span><span class="sxs-lookup"><span data-stu-id="4baf2-104">The pattern matching features in C# provide syntax to express your algorithms.</span></span> <span data-ttu-id="4baf2-105">Vous pouvez utiliser ces techniques pour implémenter le comportement dans vos classes.</span><span class="sxs-lookup"><span data-stu-id="4baf2-105">You can use these techniques to implement the behavior in your classes.</span></span> <span data-ttu-id="4baf2-106">Vous pouvez combiner la conception de classes orientée objet avec une implémentation orientée données pour fournir un code concis lors de la modélisation d’objets réels.</span><span class="sxs-lookup"><span data-stu-id="4baf2-106">You can combine object-oriented class design with a data-oriented implementation to provide concise code while modeling real-world objects.</span></span>

<span data-ttu-id="4baf2-107">Ce didacticiel vous montre comment effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="4baf2-107">In this tutorial, you'll learn how to:</span></span>

> [!div class="checklist"]
>
> - <span data-ttu-id="4baf2-108">Exprimez vos classes orientées objet à l’aide de modèles de données.</span><span class="sxs-lookup"><span data-stu-id="4baf2-108">Express your object oriented classes using data patterns.</span></span>
> - <span data-ttu-id="4baf2-109">Implémentez ces modèles à l’aide des fonctionnalités de critères spéciaux de C#.</span><span class="sxs-lookup"><span data-stu-id="4baf2-109">Implement those patterns using C#'s pattern matching features.</span></span>
> - <span data-ttu-id="4baf2-110">Tirez parti des diagnostics du compilateur pour valider votre implémentation.</span><span class="sxs-lookup"><span data-stu-id="4baf2-110">Leverage compiler diagnostics to validate your implementation.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="4baf2-111">Prérequis</span><span class="sxs-lookup"><span data-stu-id="4baf2-111">Prerequisites</span></span>

<span data-ttu-id="4baf2-112">Vous devez configurer votre ordinateur pour exécuter .NET 5, y compris le compilateur C# 9,0.</span><span class="sxs-lookup"><span data-stu-id="4baf2-112">You’ll need to set up your machine to run .NET 5, including the C# 9.0 compiler.</span></span> <span data-ttu-id="4baf2-113">Le compilateur C# 9,0 est disponible à partir de [Visual Studio 2019 version 16,8 Preview](https://visualstudio.microsoft.com/vs/preview/) ou de la version [préliminaire du kit de développement logiciel (SDK) .net 5,0](https://dotnet.microsoft.com/download/dotnet/5.0).</span><span class="sxs-lookup"><span data-stu-id="4baf2-113">The C# 9.0 compiler is available starting with [Visual Studio 2019 version 16.8 preview](https://visualstudio.microsoft.com/vs/preview/) or the [.NET 5.0 SDK preview](https://dotnet.microsoft.com/download/dotnet/5.0).</span></span>

## <a name="build-a-simulation-of-a-canal-lock"></a><span data-ttu-id="4baf2-114">Créer une simulation d’un canal de verrouillage</span><span class="sxs-lookup"><span data-stu-id="4baf2-114">Build a simulation of a canal lock</span></span>

<span data-ttu-id="4baf2-115">Dans ce didacticiel, vous allez générer une classe C# qui simule un [verrou de canal](https://en.wikipedia.org/wiki/Lock_(water_navigation)).</span><span class="sxs-lookup"><span data-stu-id="4baf2-115">In this tutorial, you'll build a C# class that simulates a [canal lock](https://en.wikipedia.org/wiki/Lock_(water_navigation)).</span></span> <span data-ttu-id="4baf2-116">Brièvement, un canal de verrouillage est un appareil qui soulève et abaisse les canots lorsqu’ils se déplacent entre deux étirés d’eau à différents niveaux.</span><span class="sxs-lookup"><span data-stu-id="4baf2-116">Briefly, a canal lock is a device that raises and lowers boats as they travel between two stretches of water at different levels.</span></span> <span data-ttu-id="4baf2-117">Un verrou a deux portes et un mécanisme pour modifier le niveau d’eau.</span><span class="sxs-lookup"><span data-stu-id="4baf2-117">A lock has two gates and some mechanism to change the water level.</span></span>

<span data-ttu-id="4baf2-118">Dans son fonctionnement normal, un bateau entre l’un des portails, tandis que le niveau d’eau du verrou correspond au niveau de l’eau sur le côté du bateau.</span><span class="sxs-lookup"><span data-stu-id="4baf2-118">In its normal operation, a boat enters one of the gates while the water level in the lock matches the water level on the side the boat enters.</span></span> <span data-ttu-id="4baf2-119">Une fois dans le verrou, le niveau d’eau est modifié pour correspondre au niveau d’eau où le bateau laisse le verrou.</span><span class="sxs-lookup"><span data-stu-id="4baf2-119">Once in the lock, the water level is changed to match the water level where the boat will leave the lock.</span></span> <span data-ttu-id="4baf2-120">Une fois que le niveau d’eau correspond à ce côté, la porte du côté de sortie s’ouvre.</span><span class="sxs-lookup"><span data-stu-id="4baf2-120">Once the water level matches that side, the gate on the exit side opens.</span></span> <span data-ttu-id="4baf2-121">Les mesures de sécurité assurent qu’un opérateur ne peut pas créer une situation dangereuse dans le canal.</span><span class="sxs-lookup"><span data-stu-id="4baf2-121">Safety measures make sure an operator can't create a dangerous situation in the canal.</span></span> <span data-ttu-id="4baf2-122">Le niveau d’eau ne peut être modifié que lorsque les deux portes sont fermées.</span><span class="sxs-lookup"><span data-stu-id="4baf2-122">The water level can be changed only when both gates are closed.</span></span> <span data-ttu-id="4baf2-123">Au plus une porte peut être ouverte.</span><span class="sxs-lookup"><span data-stu-id="4baf2-123">At most one gate can be open.</span></span> <span data-ttu-id="4baf2-124">Pour ouvrir une porte, le niveau d’eau dans le verrou doit correspondre au niveau d’eau en dehors de la porte qui est ouverte.</span><span class="sxs-lookup"><span data-stu-id="4baf2-124">To open a gate, the water level in the lock must match the water level outside the gate being opened.</span></span>

<span data-ttu-id="4baf2-125">Vous pouvez générer une classe C# pour modéliser ce comportement.</span><span class="sxs-lookup"><span data-stu-id="4baf2-125">You can build a C# class to model this behavior.</span></span> <span data-ttu-id="4baf2-126">Une `CanalLock` classe prend en charge les commandes pour ouvrir ou fermer l’une ou l’autre des portes.</span><span class="sxs-lookup"><span data-stu-id="4baf2-126">A `CanalLock` class would support commands to open or close either gate.</span></span> <span data-ttu-id="4baf2-127">Il aurait d’autres commandes pour augmenter ou diminuer l’eau.</span><span class="sxs-lookup"><span data-stu-id="4baf2-127">It would have other commands to raise or lower the water.</span></span> <span data-ttu-id="4baf2-128">La classe doit également prendre en charge les propriétés pour lire l’état actuel des portes et du niveau d’eau.</span><span class="sxs-lookup"><span data-stu-id="4baf2-128">The class should also support properties to read the current state of both gates and the water level.</span></span> <span data-ttu-id="4baf2-129">Vos méthodes implémentent les mesures de sécurité.</span><span class="sxs-lookup"><span data-stu-id="4baf2-129">Your methods implement the safety measures.</span></span>

## <a name="define-a-class"></a><span data-ttu-id="4baf2-130">Définir une classe</span><span class="sxs-lookup"><span data-stu-id="4baf2-130">Define a class</span></span>

<span data-ttu-id="4baf2-131">Vous allez générer une application console pour tester votre `CanalLock` classe.</span><span class="sxs-lookup"><span data-stu-id="4baf2-131">You'll build a console application to test your `CanalLock` class.</span></span> <span data-ttu-id="4baf2-132">Créez un nouveau projet de console pour .NET 5 à l’aide de Visual Studio ou de l’interface de commande .NET.</span><span class="sxs-lookup"><span data-stu-id="4baf2-132">Create a new console project for .NET 5 using either Visual Studio or the .NET CLI.</span></span> <span data-ttu-id="4baf2-133">Ensuite, ajoutez une nouvelle classe et nommez-la `CanalLock` .</span><span class="sxs-lookup"><span data-stu-id="4baf2-133">Then, add a new class and name it `CanalLock`.</span></span> <span data-ttu-id="4baf2-134">Ensuite, concevez votre API publique, mais laissez les méthodes non implémentées :</span><span class="sxs-lookup"><span data-stu-id="4baf2-134">Next, design your public API, but leave the methods not implemented:</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="APIDesign":::

<span data-ttu-id="4baf2-135">Le code précédent Initialise l’objet afin que les deux portes soient fermées et que le niveau d’eau soit faible.</span><span class="sxs-lookup"><span data-stu-id="4baf2-135">The preceding code initializes the object so both gates are closed, and the water level is low.</span></span> <span data-ttu-id="4baf2-136">Ensuite, écrivez le code de test suivant dans votre `Main` méthode pour vous guider lors de la création d’une première implémentation de la classe :</span><span class="sxs-lookup"><span data-stu-id="4baf2-136">Next, write the following test code in your `Main` method to guide you as you create a first implementation of the class:</span></span>

:::code language="csharp" source="snippets/pattern-objects/Program.cs" ID="HappyTests":::

<span data-ttu-id="4baf2-137">Ensuite, ajoutez une première implémentation de chaque méthode dans la `CanalLock` classe.</span><span class="sxs-lookup"><span data-stu-id="4baf2-137">Next, add a first implementation of each method in the `CanalLock` class.</span></span> <span data-ttu-id="4baf2-138">Le code suivant implémente les méthodes de la classe sans se préoccuper des règles de sécurité.</span><span class="sxs-lookup"><span data-stu-id="4baf2-138">The following code implements the methods of the class without concern to the safety rules.</span></span> <span data-ttu-id="4baf2-139">Vous ajouterez des tests de sécurité plus tard :</span><span class="sxs-lookup"><span data-stu-id="4baf2-139">You'll add safety tests later:</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="FirstImplementation":::

<span data-ttu-id="4baf2-140">Les tests que vous avez écrits jusqu’à présent passent.</span><span class="sxs-lookup"><span data-stu-id="4baf2-140">The tests you've written so far pass.</span></span> <span data-ttu-id="4baf2-141">Vous avez implémenté les concepts de base.</span><span class="sxs-lookup"><span data-stu-id="4baf2-141">You've implemented the basics.</span></span> <span data-ttu-id="4baf2-142">À présent, écrivez un test pour la première condition d’échec.</span><span class="sxs-lookup"><span data-stu-id="4baf2-142">Now, write a test for the first failure condition.</span></span> <span data-ttu-id="4baf2-143">À la fin des tests précédents, les deux portes sont fermées et le niveau d’eau est défini sur faible.</span><span class="sxs-lookup"><span data-stu-id="4baf2-143">At the end of the previous tests, both gates are closed, and the water level is set to low.</span></span> <span data-ttu-id="4baf2-144">Ajoutez un test pour essayer d’ouvrir la porte supérieure :</span><span class="sxs-lookup"><span data-stu-id="4baf2-144">Add a test to try opening the upper gate:</span></span>

:::code language="csharp" source="snippets/pattern-objects/Program.cs" ID="HighGateSafetyTest":::

<span data-ttu-id="4baf2-145">Ce test échoue car la porte s’ouvre.</span><span class="sxs-lookup"><span data-stu-id="4baf2-145">This test fails because the gate opens.</span></span> <span data-ttu-id="4baf2-146">En guise de première implémentation, vous pouvez résoudre le problème à l’aide du code suivant :</span><span class="sxs-lookup"><span data-stu-id="4baf2-146">As a first implementation, you could fix it with the following code:</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="SecondImplementation":::

<span data-ttu-id="4baf2-147">Vos tests réussissent.</span><span class="sxs-lookup"><span data-stu-id="4baf2-147">Your tests pass.</span></span> <span data-ttu-id="4baf2-148">Toutefois, à mesure que vous ajoutez d’autres tests, vous ajouterez de plus en plus de `if` clauses et testerez différentes propriétés.</span><span class="sxs-lookup"><span data-stu-id="4baf2-148">But, as you add more tests, you'll add more and more `if` clauses and test different properties.</span></span> <span data-ttu-id="4baf2-149">Bientôt, ces méthodes seront trop compliquées à mesure que vous ajouterez des conditions supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="4baf2-149">Soon, these methods will get too complicated as you add more conditionals.</span></span>

## <a name="implement-the-commands-with-patterns"></a><span data-ttu-id="4baf2-150">Implémenter les commandes avec des modèles</span><span class="sxs-lookup"><span data-stu-id="4baf2-150">Implement the commands with patterns</span></span>

<span data-ttu-id="4baf2-151">Une meilleure méthode consiste à utiliser des *modèles* pour déterminer si l’objet est dans un état valide pour exécuter une commande.</span><span class="sxs-lookup"><span data-stu-id="4baf2-151">A better way is to use *patterns* to determine if the object is in a valid state to execute a command.</span></span> <span data-ttu-id="4baf2-152">Vous pouvez exprimer si une commande est autorisée en tant que fonction de trois variables : l’état de la porte, le niveau de l’eau et le nouveau paramètre :</span><span class="sxs-lookup"><span data-stu-id="4baf2-152">You can express if a command is allowed as a function of three variables: the state of the gate, the level of the water, and the new setting:</span></span>

| <span data-ttu-id="4baf2-153">Nouveau paramètre</span><span class="sxs-lookup"><span data-stu-id="4baf2-153">New setting</span></span> | <span data-ttu-id="4baf2-154">État de la porte</span><span class="sxs-lookup"><span data-stu-id="4baf2-154">Gate state</span></span> | <span data-ttu-id="4baf2-155">Niveau d’eau</span><span class="sxs-lookup"><span data-stu-id="4baf2-155">Water Level</span></span> | <span data-ttu-id="4baf2-156">Résultats</span><span class="sxs-lookup"><span data-stu-id="4baf2-156">Result</span></span>             |
| ----------- | ---------- | ----------- | ------------------ |
| <span data-ttu-id="4baf2-157">Fermé</span><span class="sxs-lookup"><span data-stu-id="4baf2-157">Closed</span></span>      | <span data-ttu-id="4baf2-158">Fermé</span><span class="sxs-lookup"><span data-stu-id="4baf2-158">Closed</span></span>     | <span data-ttu-id="4baf2-159">Importante</span><span class="sxs-lookup"><span data-stu-id="4baf2-159">High</span></span>        | <span data-ttu-id="4baf2-160">Fermé</span><span class="sxs-lookup"><span data-stu-id="4baf2-160">Closed</span></span>             |
| <span data-ttu-id="4baf2-161">Fermé</span><span class="sxs-lookup"><span data-stu-id="4baf2-161">Closed</span></span>      | <span data-ttu-id="4baf2-162">Fermé</span><span class="sxs-lookup"><span data-stu-id="4baf2-162">Closed</span></span>     | <span data-ttu-id="4baf2-163">Faible</span><span class="sxs-lookup"><span data-stu-id="4baf2-163">Low</span></span>         | <span data-ttu-id="4baf2-164">Fermé</span><span class="sxs-lookup"><span data-stu-id="4baf2-164">Closed</span></span>             |
| <span data-ttu-id="4baf2-165">Fermé</span><span class="sxs-lookup"><span data-stu-id="4baf2-165">Closed</span></span>      | <span data-ttu-id="4baf2-166">Ouvrir</span><span class="sxs-lookup"><span data-stu-id="4baf2-166">Open</span></span>       | <span data-ttu-id="4baf2-167">Importante</span><span class="sxs-lookup"><span data-stu-id="4baf2-167">High</span></span>        | <span data-ttu-id="4baf2-168">Ouvrir</span><span class="sxs-lookup"><span data-stu-id="4baf2-168">Open</span></span>               |
| <span data-ttu-id="4baf2-169">~~Fermé~~</span><span class="sxs-lookup"><span data-stu-id="4baf2-169">~~Closed~~</span></span>  | <span data-ttu-id="4baf2-170">~~Ouvrir~~</span><span class="sxs-lookup"><span data-stu-id="4baf2-170">~~Open~~</span></span>   | <span data-ttu-id="4baf2-171">~~Faible~~</span><span class="sxs-lookup"><span data-stu-id="4baf2-171">~~Low~~</span></span>     | <span data-ttu-id="4baf2-172">~~Fermé~~</span><span class="sxs-lookup"><span data-stu-id="4baf2-172">~~Closed~~</span></span>         |
| <span data-ttu-id="4baf2-173">Ouvrir</span><span class="sxs-lookup"><span data-stu-id="4baf2-173">Open</span></span>        | <span data-ttu-id="4baf2-174">Fermé</span><span class="sxs-lookup"><span data-stu-id="4baf2-174">Closed</span></span>     | <span data-ttu-id="4baf2-175">Importante</span><span class="sxs-lookup"><span data-stu-id="4baf2-175">High</span></span>        | <span data-ttu-id="4baf2-176">Ouvrir</span><span class="sxs-lookup"><span data-stu-id="4baf2-176">Open</span></span>               |
| <span data-ttu-id="4baf2-177">Ouvrir</span><span class="sxs-lookup"><span data-stu-id="4baf2-177">Open</span></span>        | <span data-ttu-id="4baf2-178">Fermé</span><span class="sxs-lookup"><span data-stu-id="4baf2-178">Closed</span></span>     | <span data-ttu-id="4baf2-179">Faible</span><span class="sxs-lookup"><span data-stu-id="4baf2-179">Low</span></span>         | <span data-ttu-id="4baf2-180">Fermé (erreur)</span><span class="sxs-lookup"><span data-stu-id="4baf2-180">Closed (Error)</span></span>     |
| <span data-ttu-id="4baf2-181">Ouvrir</span><span class="sxs-lookup"><span data-stu-id="4baf2-181">Open</span></span>        | <span data-ttu-id="4baf2-182">Ouvrir</span><span class="sxs-lookup"><span data-stu-id="4baf2-182">Open</span></span>       | <span data-ttu-id="4baf2-183">Importante</span><span class="sxs-lookup"><span data-stu-id="4baf2-183">High</span></span>        | <span data-ttu-id="4baf2-184">Ouvrir</span><span class="sxs-lookup"><span data-stu-id="4baf2-184">Open</span></span>               |
| <span data-ttu-id="4baf2-185">~~Ouvrir~~</span><span class="sxs-lookup"><span data-stu-id="4baf2-185">~~Open~~</span></span>    | <span data-ttu-id="4baf2-186">~~Ouvrir~~</span><span class="sxs-lookup"><span data-stu-id="4baf2-186">~~Open~~</span></span>   | <span data-ttu-id="4baf2-187">~~Faible~~</span><span class="sxs-lookup"><span data-stu-id="4baf2-187">~~Low~~</span></span>     | <span data-ttu-id="4baf2-188">~~Fermé (erreur)~~</span><span class="sxs-lookup"><span data-stu-id="4baf2-188">~~Closed (Error)~~</span></span> |

<span data-ttu-id="4baf2-189">Les quatrième et dernière lignes de la table ont du texte barré, car elles ne sont pas valides.</span><span class="sxs-lookup"><span data-stu-id="4baf2-189">The fourth and last rows in the table have strike through text because they're invalid.</span></span> <span data-ttu-id="4baf2-190">Le code que vous ajoutez maintenant doit s’assurer que la porte de haute-mer n’est jamais ouverte lorsque l’eau est faible.</span><span class="sxs-lookup"><span data-stu-id="4baf2-190">The code you're adding now should make sure the high water gate is never opened when the water is low.</span></span>  <span data-ttu-id="4baf2-191">Ces États peuvent être codés comme une expression de commutateur unique (n’oubliez pas que `false` indique « fermé ») :</span><span class="sxs-lookup"><span data-stu-id="4baf2-191">Those states can be coded as a single switch expression (remember that `false` indicates "Closed"):</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="ThirdImplementation":::

<span data-ttu-id="4baf2-192">Essayez cette version.</span><span class="sxs-lookup"><span data-stu-id="4baf2-192">Try this version.</span></span> <span data-ttu-id="4baf2-193">Vos tests réussissent, en validant le code.</span><span class="sxs-lookup"><span data-stu-id="4baf2-193">Your tests pass, validating the code.</span></span> <span data-ttu-id="4baf2-194">Le tableau complet indique les combinaisons possibles d’entrées et de résultats.</span><span class="sxs-lookup"><span data-stu-id="4baf2-194">The full table shows the possible combinations of inputs and results.</span></span> <span data-ttu-id="4baf2-195">Cela signifie que vous et d’autres développeurs pouvez consulter rapidement le tableau et voir que vous avez couvert toutes les entrées possibles.</span><span class="sxs-lookup"><span data-stu-id="4baf2-195">That means you and other developers can quickly look at the table and see that you've covered all the possible inputs.</span></span> <span data-ttu-id="4baf2-196">Encore plus facile, le compilateur peut également vous aider.</span><span class="sxs-lookup"><span data-stu-id="4baf2-196">Even easier, the compiler can help as well.</span></span> <span data-ttu-id="4baf2-197">Après avoir ajouté le code précédent, vous pouvez voir que le compilateur génère un avertissement : *CS8524* indique que l’expression de switch ne couvre pas toutes les entrées possibles.</span><span class="sxs-lookup"><span data-stu-id="4baf2-197">After you add the previous code, you can see that the compiler generates a warning: *CS8524* indicates the switch expression doesn't cover all possible inputs.</span></span> <span data-ttu-id="4baf2-198">La raison de cet avertissement est que l’une des entrées est un `enum` type.</span><span class="sxs-lookup"><span data-stu-id="4baf2-198">The reason for that warning is that one of the inputs is an `enum` type.</span></span> <span data-ttu-id="4baf2-199">Le compilateur interprète « toutes les entrées possibles » comme toutes les entrées du type sous-jacent, généralement `int` .</span><span class="sxs-lookup"><span data-stu-id="4baf2-199">The compiler interprets "all possible inputs" as all inputs from the underlying type, typically an `int`.</span></span> <span data-ttu-id="4baf2-200">Cette `switch` expression vérifie uniquement les valeurs déclarées dans le `enum` .</span><span class="sxs-lookup"><span data-stu-id="4baf2-200">This `switch` expression only checks the values declared in the `enum`.</span></span> <span data-ttu-id="4baf2-201">Pour supprimer l’avertissement, vous pouvez ajouter un modèle de rejet tous pour le dernier ARM de l’expression.</span><span class="sxs-lookup"><span data-stu-id="4baf2-201">To remove the warning, you can add a catch-all discard pattern for the last arm of the expression.</span></span> <span data-ttu-id="4baf2-202">Cette condition lève une exception, car elle indique une entrée non valide :</span><span class="sxs-lookup"><span data-stu-id="4baf2-202">This condition throws an exception, because it indicates invalid input:</span></span>

```csharp
_  => throw new InvalidOperationException("Invalid internal state"),
```

<span data-ttu-id="4baf2-203">Le bras du commutateur précédent doit être le dernier dans votre `switch` expression, car il correspond à toutes les entrées.</span><span class="sxs-lookup"><span data-stu-id="4baf2-203">The preceding switch arm must be last in your `switch` expression because it matches all inputs.</span></span> <span data-ttu-id="4baf2-204">Essayez en la déplaçant plus tôt dans l’ordre.</span><span class="sxs-lookup"><span data-stu-id="4baf2-204">Experiment by moving it earlier in the order.</span></span> <span data-ttu-id="4baf2-205">Cela provoque une erreur du compilateur *CS8510* pour le code inaccessible dans un modèle.</span><span class="sxs-lookup"><span data-stu-id="4baf2-205">That causes a compiler error *CS8510* for unreachable code in a pattern.</span></span>  <span data-ttu-id="4baf2-206">La structure naturelle des expressions de commutateur permet au compilateur de générer des erreurs et des avertissements pour les erreurs éventuelles.</span><span class="sxs-lookup"><span data-stu-id="4baf2-206">The natural structure of switch expressions enables the compiler to generate errors and warnings for possible mistakes.</span></span> <span data-ttu-id="4baf2-207">Le « filet de sécurité » du compilateur facilite la création d’un code correct en moins d’itérations, et la liberté de combiner des bras de commutateur avec des caractères génériques.</span><span class="sxs-lookup"><span data-stu-id="4baf2-207">The compiler "safety net" makes it easier for you to create correct code in fewer iterations, and the freedom to combine switch arms with wildcards.</span></span> <span data-ttu-id="4baf2-208">Le compilateur émettra des erreurs si votre combinaison produit des bras inaccessibles et des avertissements si vous supprimez un ARM qui est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="4baf2-208">The compiler will issue errors if your combination results in unreachable arms you didn't expect, and warnings if you remove an arm that's needed.</span></span>

<span data-ttu-id="4baf2-209">La première modification consiste à combiner tous les bras où la commande doit fermer la porte ; Cette autorisation est toujours autorisée.</span><span class="sxs-lookup"><span data-stu-id="4baf2-209">The first change is to combine all the arms where the command is to close the gate; that's always allowed.</span></span> <span data-ttu-id="4baf2-210">Ajoutez le code suivant en tant que premier bras dans votre expression de commutateur :</span><span class="sxs-lookup"><span data-stu-id="4baf2-210">Add the following code as the first arm in your switch expression:</span></span>

```csharp
(false, _, _) => false,
```

<span data-ttu-id="4baf2-211">Une fois que vous avez ajouté le bras du commutateur précédent, vous obtenez quatre erreurs de compilation, une sur chacun des bras où la commande est `false` .</span><span class="sxs-lookup"><span data-stu-id="4baf2-211">After you add the previous switch arm, you'll get four compiler errors, one on each of the arms where the command is `false`.</span></span> <span data-ttu-id="4baf2-212">Ces bras sont déjà couverts par le bras qui vient d’être ajouté.</span><span class="sxs-lookup"><span data-stu-id="4baf2-212">Those arms are already covered by the newly added arm.</span></span> <span data-ttu-id="4baf2-213">Vous pouvez supprimer ces quatre lignes en toute sécurité.</span><span class="sxs-lookup"><span data-stu-id="4baf2-213">You can safely remove those four lines.</span></span> <span data-ttu-id="4baf2-214">Vous avez souhaité que ce nouveau bras de commutateur remplace ces conditions.</span><span class="sxs-lookup"><span data-stu-id="4baf2-214">You intended this new switch arm to replace those conditions.</span></span>

<span data-ttu-id="4baf2-215">Ensuite, vous pouvez simplifier les quatre bras où la commande doit ouvrir la porte.</span><span class="sxs-lookup"><span data-stu-id="4baf2-215">Next, you can simplify the four arms where the command is to open the gate.</span></span> <span data-ttu-id="4baf2-216">Dans les deux cas où le niveau d’eau est élevé, la porte peut être ouverte.</span><span class="sxs-lookup"><span data-stu-id="4baf2-216">In both cases where the water level is high, the gate can be opened.</span></span> <span data-ttu-id="4baf2-217">(Dans un, il est déjà ouvert.) Un cas où le niveau d’eau est faible lève une exception et l’autre ne doit pas se produire.</span><span class="sxs-lookup"><span data-stu-id="4baf2-217">(In one, it's already open.) One case where the water level is low throws an exception, and the other shouldn't happen.</span></span> <span data-ttu-id="4baf2-218">Il doit être possible de lever la même exception en toute sécurité si le verrouillage de l’eau est déjà dans un État non valide.</span><span class="sxs-lookup"><span data-stu-id="4baf2-218">It should be safe to throw the same exception if the water lock is already in an invalid state.</span></span> <span data-ttu-id="4baf2-219">Vous pouvez effectuer les simplifications suivantes pour ces bras :</span><span class="sxs-lookup"><span data-stu-id="4baf2-219">You can make the following simplifications for those arms:</span></span>

```csharp
(true, _, WaterLevel.High) => true,
(true, false, WaterLevel.Low) => throw new InvalidOperationException("Cannot open high gate when the water is low"),
_ => throw new InvalidOperationException("Invalid internal state"),
```

<span data-ttu-id="4baf2-220">Exécutez à nouveau vos tests, et ils réussissent.</span><span class="sxs-lookup"><span data-stu-id="4baf2-220">Run your tests again, and they pass.</span></span> <span data-ttu-id="4baf2-221">Voici la version finale de la `SetHighGate` méthode :</span><span class="sxs-lookup"><span data-stu-id="4baf2-221">Here's the final version of the `SetHighGate` method:</span></span>

:::code language="csharp" source="snippets/pattern-objects/CanalLock.cs" ID="FinalImplementaton":::

## <a name="implement-patterns-yourself"></a><span data-ttu-id="4baf2-222">Implémentez vous-même des modèles</span><span class="sxs-lookup"><span data-stu-id="4baf2-222">Implement patterns yourself</span></span>

<span data-ttu-id="4baf2-223">Maintenant que vous avez vu la technique, renseignez les `SetLowGate` `SetWaterLevel` méthodes et vous-même.</span><span class="sxs-lookup"><span data-stu-id="4baf2-223">Now that you've seen the technique, fill in the `SetLowGate` and `SetWaterLevel` methods yourself.</span></span>  <span data-ttu-id="4baf2-224">Commencez par ajouter le code suivant pour tester les opérations non valides sur ces méthodes :</span><span class="sxs-lookup"><span data-stu-id="4baf2-224">Start by adding the following code to test invalid operations on those methods:</span></span>

:::code language="csharp" source="snippets/pattern-objects/Program.cs" ID="FinalTestCode":::

<span data-ttu-id="4baf2-225">Réexécutez votre application.</span><span class="sxs-lookup"><span data-stu-id="4baf2-225">Run your application again.</span></span> <span data-ttu-id="4baf2-226">Vous pouvez voir que les nouveaux tests échouent et que le canal de verrouillage est dans un État non valide.</span><span class="sxs-lookup"><span data-stu-id="4baf2-226">You can see the new tests fail, and the canal lock gets into an invalid state.</span></span> <span data-ttu-id="4baf2-227">Essayez d’implémenter vous-même les méthodes restantes.</span><span class="sxs-lookup"><span data-stu-id="4baf2-227">Try to implement the remaining methods yourself.</span></span> <span data-ttu-id="4baf2-228">La méthode permettant de définir la porte inférieure doit être semblable à la méthode pour définir la porte supérieure.</span><span class="sxs-lookup"><span data-stu-id="4baf2-228">The method to set the lower gate should be similar to the method to set the upper gate.</span></span> <span data-ttu-id="4baf2-229">La méthode qui modifie le niveau d’eau a des contrôles différents, mais elle doit suivre une structure similaire.</span><span class="sxs-lookup"><span data-stu-id="4baf2-229">The method that changes the water level has different checks, but should follow a similar structure.</span></span> <span data-ttu-id="4baf2-230">Il peut s’avérer utile d’utiliser le même processus pour la méthode qui définit le niveau d’eau.</span><span class="sxs-lookup"><span data-stu-id="4baf2-230">You may find it helpful to use the same process for the method that sets the water level.</span></span> <span data-ttu-id="4baf2-231">Commencez avec les quatre entrées : l’état des deux portes, l’état actuel du niveau d’eau et le nouveau niveau d’eau demandé.</span><span class="sxs-lookup"><span data-stu-id="4baf2-231">Start with all four inputs: The state of both gates, the current state of the water level, and the requested new water level.</span></span> <span data-ttu-id="4baf2-232">L’expression de Switch doit commencer par :</span><span class="sxs-lookup"><span data-stu-id="4baf2-232">The switch expression should start with:</span></span>

```csharp
CanalLockWaterLevel = (newLevel, CanalLockWaterLevel, LowWaterGateOpen, HighWaterGateOpen) switch
{
    // elided
};
```

<span data-ttu-id="4baf2-233">Vous aurez 16 bras de commutateur total à remplir.</span><span class="sxs-lookup"><span data-stu-id="4baf2-233">You'll have 16 total switch arms to fill in.</span></span> <span data-ttu-id="4baf2-234">Ensuite, testez et simplifiez.</span><span class="sxs-lookup"><span data-stu-id="4baf2-234">Then, test and simplify.</span></span>

<span data-ttu-id="4baf2-235">Avez-vous fait des méthodes comme ceci ?</span><span class="sxs-lookup"><span data-stu-id="4baf2-235">Did you make methods something like this?</span></span>

:::code language="csharp" source="snippets/pattern-objects/CanalLock.cs" ID="FinalExercise":::

<span data-ttu-id="4baf2-236">Vos tests doivent réussir et le canal de verrouillage doit fonctionner en toute sécurité.</span><span class="sxs-lookup"><span data-stu-id="4baf2-236">Your tests should pass, and the canal lock should operate safely.</span></span>

## <a name="summary"></a><span data-ttu-id="4baf2-237">Résumé</span><span class="sxs-lookup"><span data-stu-id="4baf2-237">Summary</span></span>

<span data-ttu-id="4baf2-238">Dans ce didacticiel, vous avez appris à utiliser des critères spéciaux pour vérifier l’état interne d’un objet avant d’appliquer les modifications apportées à cet État.</span><span class="sxs-lookup"><span data-stu-id="4baf2-238">In this tutorial, you learned to use pattern matching to check the internal state of an object before applying any changes to that state.</span></span> <span data-ttu-id="4baf2-239">Vous pouvez vérifier les combinaisons de propriétés.</span><span class="sxs-lookup"><span data-stu-id="4baf2-239">You can check combinations of properties.</span></span> <span data-ttu-id="4baf2-240">Une fois que vous avez créé des tables pour l’une de ces transitions, vous testez votre code, puis vous simplifiez la lisibilité et la maintenabilité.</span><span class="sxs-lookup"><span data-stu-id="4baf2-240">Once you've built tables for any of those transitions, you test your code, then simplify for readability and maintainability.</span></span> <span data-ttu-id="4baf2-241">Ces refactorisations initiales peuvent suggérer des refactorisations supplémentaires qui valident l’état interne ou gèrent d’autres modifications de l’API.</span><span class="sxs-lookup"><span data-stu-id="4baf2-241">These initial refactorings may suggest further refactorings that validate internal state or manage other API changes.</span></span> <span data-ttu-id="4baf2-242">Ce didacticiel combine des classes et des objets avec une approche plus orientée données et basée sur les modèles pour implémenter ces classes.</span><span class="sxs-lookup"><span data-stu-id="4baf2-242">This tutorial combined classes and objects with a more data-oriented, pattern-based approach to implement those classes.</span></span>

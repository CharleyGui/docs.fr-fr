---
title: 'Mettre à jour les interfaces en toute sécurité à l’aide des méthodes d’interface par défaut en C #'
description: Ce tutoriel avancé explore comment vous pouvez ajouter de manière sécurisée de nouvelles fonctionnalités aux définitions d’une interface existante sans rompre toutes les classes et tous les structs qui implémentent cette interface.
ms.date: 05/06/2019
ms.technlogy: csharp-advanced-concepts
ms.custom: mvc
ms.openlocfilehash: 1e73f9001414631975248f1a1658833d2785169b
ms.sourcegitcommit: 1eae045421d9ea2bfc82aaccfa5b1ff1b8c9e0e4
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/16/2020
ms.locfileid: "84803212"
---
# <a name="tutorial-update-interfaces-with-default-interface-methods-in-c-80"></a><span data-ttu-id="17415-103">Didacticiel : mettre à jour les interfaces avec les méthodes d’interface par défaut en C# 8,0</span><span class="sxs-lookup"><span data-stu-id="17415-103">Tutorial: Update interfaces with default interface methods in C# 8.0</span></span>

<span data-ttu-id="17415-104">Depuis C# 8.0 sur .NET Core 3.0, vous pouvez définir une implémentation lorsque vous déclarez un membre d’une interface.</span><span class="sxs-lookup"><span data-stu-id="17415-104">Beginning with C# 8.0 on .NET Core 3.0, you can define an implementation when you declare a member of an interface.</span></span> <span data-ttu-id="17415-105">Le scénario le plus courant consiste à ajouter de manière sécurisée des membres à une interface déjà publiée et utilisée par de nombreux clients.</span><span class="sxs-lookup"><span data-stu-id="17415-105">The most common scenario is to safely add members to an interface already released and used by innumerable clients.</span></span>

<span data-ttu-id="17415-106">Ce didacticiel vous montre comment effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="17415-106">In this tutorial, you'll learn how to:</span></span>

> [!div class="checklist"]
>
> * <span data-ttu-id="17415-107">Étendre des interfaces de manière sécurisée en ajoutant des méthodes avec des implémentations</span><span class="sxs-lookup"><span data-stu-id="17415-107">Extend interfaces safely by adding methods with implementations.</span></span>
> * <span data-ttu-id="17415-108">Créer des implémentations paramétrables pour fournir une plus grande flexibilité</span><span class="sxs-lookup"><span data-stu-id="17415-108">Create parameterized implementations to provide greater flexibility.</span></span>
> * <span data-ttu-id="17415-109">Permettre aux implémenteurs de fournir une implémentation plus spécifique sous la forme d’un remplacement</span><span class="sxs-lookup"><span data-stu-id="17415-109">Enable implementers to provide a more specific implementation in the form of an override.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="17415-110">Prérequis</span><span class="sxs-lookup"><span data-stu-id="17415-110">Prerequisites</span></span>

<span data-ttu-id="17415-111">Vous devez configurer votre ordinateur pour exécuter .NET Core, y compris le compilateur C# 8,0.</span><span class="sxs-lookup"><span data-stu-id="17415-111">You’ll need to set up your machine to run .NET Core, including the C# 8.0 compiler.</span></span> <span data-ttu-id="17415-112">Le compilateur C# 8,0 est disponible à partir de [Visual Studio 2019 version 16,3](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=inline+link&utm_content=download+vs2019) ou du [Kit de développement logiciel (SDK) .net Core 3,0](https://dotnet.microsoft.com/download).</span><span class="sxs-lookup"><span data-stu-id="17415-112">The C# 8.0 compiler is available starting with [Visual Studio 2019 version 16.3](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=inline+link&utm_content=download+vs2019) or the [.NET Core 3.0 SDK](https://dotnet.microsoft.com/download).</span></span>

## <a name="scenario-overview"></a><span data-ttu-id="17415-113">Présentation du scénario</span><span class="sxs-lookup"><span data-stu-id="17415-113">Scenario overview</span></span>

<span data-ttu-id="17415-114">Ce tutoriel commence par la version 1 d’une bibliothèque de relation client.</span><span class="sxs-lookup"><span data-stu-id="17415-114">This tutorial starts with version 1 of a customer relationship library.</span></span> <span data-ttu-id="17415-115">Vous pouvez obtenir l’application de démarrage à partir de notre [dépôt samples sur GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="17415-115">You can get the starter application on our [samples repo on GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span></span> <span data-ttu-id="17415-116">L’entreprise qui a créé cette bibliothèque espérait la voir adoptée par les clients ayant des applications existantes.</span><span class="sxs-lookup"><span data-stu-id="17415-116">The company that built this library intended customers with existing applications to adopt their library.</span></span> <span data-ttu-id="17415-117">Elle a fourni des définitions d’interface minimales destinées à être implémentées par les utilisateurs de sa bibliothèque.</span><span class="sxs-lookup"><span data-stu-id="17415-117">They provided minimal interface definitions for users of their library to implement.</span></span> <span data-ttu-id="17415-118">Voici la définition d’interface pour un client :</span><span class="sxs-lookup"><span data-stu-id="17415-118">Here's the interface definition for a customer:</span></span>

[!code-csharp[InitialCustomerInterface](~/samples/snippets/csharp/tutorials/default-interface-members-versions/starter/customer-relationship/ICustomer.cs?name=SnippetICustomerVersion1)]

<span data-ttu-id="17415-119">Elle a défini une deuxième interface qui représente une commande :</span><span class="sxs-lookup"><span data-stu-id="17415-119">They defined a second interface that represents an order:</span></span>

[!code-csharp[InitialOrderInterface](~/samples/snippets/csharp/tutorials/default-interface-members-versions/starter/customer-relationship/IOrder.cs?name=SnippetIorderVersion1)]

<span data-ttu-id="17415-120">À partir de ces interfaces, l’équipe a pu générer une bibliothèque pour les utilisateurs permettant de créer une meilleure expérience pour ses clients.</span><span class="sxs-lookup"><span data-stu-id="17415-120">From those interfaces, the team could build a library for their users to create a better experience for their customers.</span></span> <span data-ttu-id="17415-121">Son objectif était de créer une relation plus étroite avec les clients existants et d’améliorer ses relations avec les nouveaux clients.</span><span class="sxs-lookup"><span data-stu-id="17415-121">Their goal was to create a deeper relationship with existing customers and improve their relationships with new customers.</span></span>

<span data-ttu-id="17415-122">À présent, il est temps de mettre à niveau la bibliothèque pour la prochaine version.</span><span class="sxs-lookup"><span data-stu-id="17415-122">Now, it's time to upgrade the library for the next release.</span></span> <span data-ttu-id="17415-123">L’une des fonctionnalités demandées permet une remise de fidélité pour les clients qui ont un grand nombre de commandes.</span><span class="sxs-lookup"><span data-stu-id="17415-123">One of the requested features enables a loyalty discount for customers that have lots of orders.</span></span> <span data-ttu-id="17415-124">Cette nouvelle remise de fidélité est appliquée chaque fois qu’un client passe une commande.</span><span class="sxs-lookup"><span data-stu-id="17415-124">This new loyalty discount gets applied whenever a customer makes an order.</span></span> <span data-ttu-id="17415-125">La remise spécifique est une propriété de chaque client.</span><span class="sxs-lookup"><span data-stu-id="17415-125">The specific discount is a property of each individual customer.</span></span> <span data-ttu-id="17415-126">Chaque implémentation de `ICustomer` peut définir des règles différentes pour la remise de fidélité.</span><span class="sxs-lookup"><span data-stu-id="17415-126">Each implementation of `ICustomer` can set different rules for the loyalty discount.</span></span>

<span data-ttu-id="17415-127">La façon la plus naturelle d’ajouter cette fonctionnalité consiste à améliorer l’interface `ICustomer` avec une méthode pour appliquer une remise de fidélité.</span><span class="sxs-lookup"><span data-stu-id="17415-127">The most natural way to add this functionality is to enhance the `ICustomer` interface with a method to apply any loyalty discount.</span></span> <span data-ttu-id="17415-128">Cette suggestion de conception a posé problème aux développeurs expérimentés : «les interfaces sont immuables une fois qu’elles ont été publiées !</span><span class="sxs-lookup"><span data-stu-id="17415-128">This design suggestion caused concern among experienced developers: "Interfaces are immutable once they've been released!</span></span> <span data-ttu-id="17415-129">Il s’agit d’une modification avec rupture ! »</span><span class="sxs-lookup"><span data-stu-id="17415-129">This is a breaking change!"</span></span> <span data-ttu-id="17415-130">C# 8.0 ajoute des *implémentations d’interface par défaut* pour la mise à niveau des interfaces.</span><span class="sxs-lookup"><span data-stu-id="17415-130">C# 8.0 adds *default interface implementations* for upgrading interfaces.</span></span> <span data-ttu-id="17415-131">Les auteurs de bibliothèque peuvent ajouter de nouveaux membres à l’interface et fournir une implémentation par défaut pour ces membres.</span><span class="sxs-lookup"><span data-stu-id="17415-131">The library authors can add new members to the interface and provide a default implementation for those members.</span></span>

<span data-ttu-id="17415-132">Les implémentations d’interface par défaut permettent aux développeurs de mettre à niveau une interface tout en laissant la possibilité aux implémenteurs de substituer cette implémentation.</span><span class="sxs-lookup"><span data-stu-id="17415-132">Default interface implementations enable developers to upgrade an interface while still enabling any implementors to override that implementation.</span></span> <span data-ttu-id="17415-133">Les utilisateurs de la bibliothèque peuvent accepter l’implémentation par défaut en tant que modification sans rupture.</span><span class="sxs-lookup"><span data-stu-id="17415-133">Users of the library can accept the default implementation as a non-breaking change.</span></span> <span data-ttu-id="17415-134">Si leurs règles métier sont différentes, ils peuvent opérer un remplacement.</span><span class="sxs-lookup"><span data-stu-id="17415-134">If their business rules are different, they can override.</span></span>

## <a name="upgrade-with-default-interface-methods"></a><span data-ttu-id="17415-135">Mettre à niveau avec les méthodes d’interface par défaut</span><span class="sxs-lookup"><span data-stu-id="17415-135">Upgrade with default interface methods</span></span>

<span data-ttu-id="17415-136">L’équipe s’est mise d’accord sur l’implémentation par défaut la plus vraisemblable : une remise de fidélité pour les clients.</span><span class="sxs-lookup"><span data-stu-id="17415-136">The team agreed on the most likely default implementation: a loyalty discount for customers.</span></span>

<span data-ttu-id="17415-137">La mise à niveau doit fournir la fonctionnalité permettant de définir deux propriétés : le nombre de commandes nécessaires pour pouvoir bénéficier de la remise et le pourcentage de celle-ci.</span><span class="sxs-lookup"><span data-stu-id="17415-137">The upgrade should provide the functionality to set two properties: the number of orders needed to be eligible for the discount, and the percentage of the discount.</span></span> <span data-ttu-id="17415-138">Cela en fait un scénario parfait pour les méthodes d’interface par défaut.</span><span class="sxs-lookup"><span data-stu-id="17415-138">This makes it a perfect scenario for default interface methods.</span></span> <span data-ttu-id="17415-139">Vous pouvez ajouter une méthode à l' `ICustomer` interface et fournir l’implémentation la plus probable.</span><span class="sxs-lookup"><span data-stu-id="17415-139">You can add a method to the `ICustomer` interface, and provide the most likely implementation.</span></span> <span data-ttu-id="17415-140">Toutes les implémentations existantes et nouvelles peuvent utiliser l’implémentation par défaut ou fournir la leur.</span><span class="sxs-lookup"><span data-stu-id="17415-140">All existing, and any new implementations can use the default implementation, or provide their own.</span></span>

<span data-ttu-id="17415-141">Tout d’abord, ajoutez la nouvelle méthode à l’interface, y compris le corps de la méthode :</span><span class="sxs-lookup"><span data-stu-id="17415-141">First, add the new method to the interface, including the body of the method:</span></span>

[!code-csharp[InitialOrderInterface](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetLoyaltyDiscountVersionOne)]

<span data-ttu-id="17415-142">L’auteur de la bibliothèque a écrit un premier test pour vérifier l’implémentation :</span><span class="sxs-lookup"><span data-stu-id="17415-142">The library author wrote a first test to check the implementation:</span></span>

[!code-csharp[TestDefaultImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetTestDefaultImplementation)]

<span data-ttu-id="17415-143">Notez la partie suivante du test :</span><span class="sxs-lookup"><span data-stu-id="17415-143">Notice the following portion of the test:</span></span>

[!code-csharp[TestDefaultImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetHighlightCast)]

<span data-ttu-id="17415-144">Ce cast de `SampleCustomer` en `ICustomer` est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="17415-144">That cast from `SampleCustomer` to `ICustomer` is necessary.</span></span> <span data-ttu-id="17415-145">La classe `SampleCustomer` n’a pas besoin de fournir une implémentation pour `ComputeLoyaltyDiscount` ; elle est fournie par l’interface `ICustomer`.</span><span class="sxs-lookup"><span data-stu-id="17415-145">The `SampleCustomer` class doesn't need to provide an implementation for `ComputeLoyaltyDiscount`; that's provided by the `ICustomer` interface.</span></span> <span data-ttu-id="17415-146">Toutefois, la classe `SampleCustomer` n’hérite pas les membres de ses interfaces.</span><span class="sxs-lookup"><span data-stu-id="17415-146">However, the `SampleCustomer` class doesn't inherit members from its interfaces.</span></span> <span data-ttu-id="17415-147">Cette règle n’a pas changé.</span><span class="sxs-lookup"><span data-stu-id="17415-147">That rule hasn't changed.</span></span> <span data-ttu-id="17415-148">Pour qu’il soit possible d’appeler n’importe quelle méthode déclarée et implémentée dans l’interface, la variable doit être du même type que l’interface, `ICustomer` dans cet exemple.</span><span class="sxs-lookup"><span data-stu-id="17415-148">In order to call any method declared and implemented in the interface, the variable must be the type of the interface, `ICustomer` in this example.</span></span>

## <a name="provide-parameterization"></a><span data-ttu-id="17415-149">Fournir le paramétrage</span><span class="sxs-lookup"><span data-stu-id="17415-149">Provide parameterization</span></span>

<span data-ttu-id="17415-150">C’est un bon début.</span><span class="sxs-lookup"><span data-stu-id="17415-150">That's a good start.</span></span> <span data-ttu-id="17415-151">Toutefois, l’implémentation par défaut est trop restrictive.</span><span class="sxs-lookup"><span data-stu-id="17415-151">But, the default implementation is too restrictive.</span></span> <span data-ttu-id="17415-152">De nombreux consommateurs de ce système peuvent choisir des seuils différents pour le nombre d’achats, une durée différente pour la qualité de membre ou un pourcentage de remise différent.</span><span class="sxs-lookup"><span data-stu-id="17415-152">Many consumers of this system may choose different thresholds for number of purchases, a different length of membership, or a different percentage discount.</span></span> <span data-ttu-id="17415-153">Vous pouvez procurer une meilleure expérience de mise à niveau à davantage de clients en fournissant un moyen de définir ces paramètres.</span><span class="sxs-lookup"><span data-stu-id="17415-153">You can provide a better upgrade experience for more customers by providing a way to set those parameters.</span></span> <span data-ttu-id="17415-154">Nous allons ajouter une méthode statique qui définit ces trois paramètres de contrôle de l’implémentation par défaut :</span><span class="sxs-lookup"><span data-stu-id="17415-154">Let's add a static method that sets those three parameters controlling the default implementation:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetLoyaltyDiscountVersionTwo)]

<span data-ttu-id="17415-155">De nombreuses nouvelles fonctionnalités de langage sont présentées dans ce petit fragment de code.</span><span class="sxs-lookup"><span data-stu-id="17415-155">There are many new language capabilities shown in that small code fragment.</span></span> <span data-ttu-id="17415-156">Les interfaces peuvent maintenant inclure des membres statiques, notamment des champs et des méthodes.</span><span class="sxs-lookup"><span data-stu-id="17415-156">Interfaces can now include static members, including fields and methods.</span></span> <span data-ttu-id="17415-157">Différents modificateurs d’accès sont également activés.</span><span class="sxs-lookup"><span data-stu-id="17415-157">Different access modifiers are also enabled.</span></span> <span data-ttu-id="17415-158">Les champs supplémentaires sont privés, tandis que la nouvelle méthode est publique.</span><span class="sxs-lookup"><span data-stu-id="17415-158">The additional fields are private, the new method is public.</span></span> <span data-ttu-id="17415-159">Tout modificateur est autorisé sur les membres d’interface.</span><span class="sxs-lookup"><span data-stu-id="17415-159">Any of the modifiers are allowed on interface members.</span></span>

<span data-ttu-id="17415-160">Les applications qui utilisent la formule générale pour le calcul de la remise de fidélité, mais des paramètres différents, n’ont pas besoin de fournir une implémentation personnalisée ; elles peuvent définir les arguments par le biais d’une méthode statique.</span><span class="sxs-lookup"><span data-stu-id="17415-160">Applications that use the general formula for computing the loyalty discount, but different parameters, don't need to provide a custom implementation; they can set the arguments through a static method.</span></span> <span data-ttu-id="17415-161">Par exemple, le code suivant définit une « évaluation du client » qui récompense tout client membre depuis plus d’un mois :</span><span class="sxs-lookup"><span data-stu-id="17415-161">For example, the following code sets a "customer appreciation" that rewards any customer with more than one month's membership:</span></span>

[!code-csharp[SetLoyaltyThresholds](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetSetLoyaltyThresholds)]

## <a name="extend-the-default-implementation"></a><span data-ttu-id="17415-162">Étendre l’implémentation par défaut</span><span class="sxs-lookup"><span data-stu-id="17415-162">Extend the default implementation</span></span>

<span data-ttu-id="17415-163">Le code que vous avez ajouté jusqu’à présent a fourni une implémentation pratique pour les scénarios où les utilisateurs veulent quelque chose comme l’implémentation par défaut ou pour fournir un ensemble de règles non lié.</span><span class="sxs-lookup"><span data-stu-id="17415-163">The code you've added so far has provided a convenient implementation for those scenarios where users want something like the default implementation, or to provide an unrelated set of rules.</span></span> <span data-ttu-id="17415-164">En guise de dernière fonctionnalité, nous allons refactoriser le code un peu pour permettre les scénarios où les utilisateurs sont susceptibles de vouloir générer l’implémentation par défaut.</span><span class="sxs-lookup"><span data-stu-id="17415-164">For a final feature, let's refactor the code a bit to enable scenarios where users may want to build on the default implementation.</span></span>

<span data-ttu-id="17415-165">Imaginez une start-up qui souhaite attirer de nouveaux clients.</span><span class="sxs-lookup"><span data-stu-id="17415-165">Consider a startup that wants to attract new customers.</span></span> <span data-ttu-id="17415-166">Elle offre une remise de 50 % sur la première commande d’un nouveau client.</span><span class="sxs-lookup"><span data-stu-id="17415-166">They offer a 50% discount off a new customer's first order.</span></span> <span data-ttu-id="17415-167">Pour leur part, les clients existants bénéficient de la remise standard.</span><span class="sxs-lookup"><span data-stu-id="17415-167">Otherwise, existing customers get the standard discount.</span></span> <span data-ttu-id="17415-168">L’auteur de la bibliothèque doit déplacer l’implémentation par défaut vers une méthode `protected static` afin que toute classe qui implémente cette interface puisse réutiliser le code dans son implémentation.</span><span class="sxs-lookup"><span data-stu-id="17415-168">The library author needs to move the default implementation into a `protected static` method so that any class implementing this interface can reuse the code in their implementation.</span></span> <span data-ttu-id="17415-169">L’implémentation par défaut du membre d’interface appelle également cette méthode partagée :</span><span class="sxs-lookup"><span data-stu-id="17415-169">The default implementation of the interface member calls this shared method as well:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetFinalVersion)]

<span data-ttu-id="17415-170">Dans une implémentation d’une classe qui implémente cette interface, le remplacement peut appeler la méthode d’assistance statique et étendre cette logique pour fournir la remise « nouveau client » :</span><span class="sxs-lookup"><span data-stu-id="17415-170">In an implementation of a class that implements this interface, the override can call the static helper method, and extend that logic to provide the "new customer" discount:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/SampleCustomer.cs?name=SnippetOverrideAndExtend)]

<span data-ttu-id="17415-171">Vous pouvez voir l’intégralité du code terminé dans notre [dépôt d’exemples sur GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/finished/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="17415-171">You can see the entire finished code in our [samples repo on GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/finished/customer-relationship).</span></span> <span data-ttu-id="17415-172">Vous pouvez obtenir l’application de démarrage à partir de notre [dépôt samples sur GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="17415-172">You can get the starter application on our [samples repo on GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span></span>

<span data-ttu-id="17415-173">Ces nouvelles fonctionnalités signifient que les interfaces peuvent être mises à jour de manière sécurisée quand il existe une implémentation par défaut raisonnable pour les nouveaux membres.</span><span class="sxs-lookup"><span data-stu-id="17415-173">These new features mean that interfaces can be updated safely when there's a reasonable default implementation for those new members.</span></span> <span data-ttu-id="17415-174">Concevez soigneusement les interfaces pour exprimer des idées fonctionnelles uniques pouvant être implémentées par plusieurs classes.</span><span class="sxs-lookup"><span data-stu-id="17415-174">Carefully design interfaces to express single functional ideas that can be implemented by multiple classes.</span></span> <span data-ttu-id="17415-175">Cela facilite la mise à niveau de ces définitions d’interface quand de nouvelles exigences sont découvertes pour cette même idée fonctionnelle.</span><span class="sxs-lookup"><span data-stu-id="17415-175">That makes it easier to upgrade those interface definitions when new requirements are discovered for that same functional idea.</span></span>

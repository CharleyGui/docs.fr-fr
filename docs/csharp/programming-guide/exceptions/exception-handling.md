---
title: Gestion des exceptions - Guide de programmation C#
description: En savoir plus sur la gestion des exceptions. Consultez des exemples d’instructions Try-Catch, try-finally et try-catch-finally.
ms.date: 12/09/2020
helpviewer_keywords:
- exception handling [C#], about exception handling
- exceptions [C#], handling
ms.assetid: b4e4ecf2-b907-4e58-891f-2563762258e9
ms.openlocfilehash: fabf1413ba498232e67f45460195fe96e25fab0a
ms.sourcegitcommit: 9b877e160c326577e8aa5ead22a937110d80fa44
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/11/2020
ms.locfileid: "97110193"
---
# <a name="exception-handling-c-programming-guide"></a><span data-ttu-id="978a3-104">Gestion des exceptions (Guide de programmation C#)</span><span class="sxs-lookup"><span data-stu-id="978a3-104">Exception Handling (C# Programming Guide)</span></span>

<span data-ttu-id="978a3-105">Un bloc [try](../../language-reference/keywords/try-catch.md) est utilisé par les programmeurs C# pour partitionner du code susceptible d’être affecté par une exception.</span><span class="sxs-lookup"><span data-stu-id="978a3-105">A [try](../../language-reference/keywords/try-catch.md) block is used by C# programmers to partition code that might be affected by an exception.</span></span> <span data-ttu-id="978a3-106">Des blocs [catch](../../language-reference/keywords/try-catch.md) associés sont utilisés pour gérer les exceptions générées.</span><span class="sxs-lookup"><span data-stu-id="978a3-106">Associated [catch](../../language-reference/keywords/try-catch.md) blocks are used to handle any resulting exceptions.</span></span> <span data-ttu-id="978a3-107">Un bloc [finally](../../language-reference/keywords/try-finally.md) contient du code qui est exécuté, qu’une exception soit levée ou non dans le `try` bloc, par exemple la libération de ressources qui sont allouées dans le `try` bloc.</span><span class="sxs-lookup"><span data-stu-id="978a3-107">A [finally](../../language-reference/keywords/try-finally.md) block contains code that is run whether or not an exception is thrown in the `try` block, such as releasing resources that are allocated in the `try` block.</span></span> <span data-ttu-id="978a3-108">Un bloc `try` doit être associé à un ou plusieurs blocs `catch`, à un bloc `finally`, ou aux deux.</span><span class="sxs-lookup"><span data-stu-id="978a3-108">A `try` block requires one or more associated `catch` blocks, or a `finally` block, or both.</span></span>

<span data-ttu-id="978a3-109">Les exemples suivants montrent une instruction `try-catch`, une instruction `try-finally` et une instruction `try-catch-finally`.</span><span class="sxs-lookup"><span data-stu-id="978a3-109">The following examples show a `try-catch` statement, a `try-finally` statement, and a `try-catch-finally` statement.</span></span>

:::code language="csharp" source="snippets/exceptions/Program.cs" id="TryCatchStructure":::

:::code language="csharp" source="snippets/exceptions/Program.cs" id="TryFinallyStructure":::

:::code language="csharp" source="snippets/exceptions/Program.cs" id="TryCatchFinallyStructure":::

<span data-ttu-id="978a3-110">Un bloc `try` sans bloc `catch` ou `finally` provoque une erreur du compilateur.</span><span class="sxs-lookup"><span data-stu-id="978a3-110">A `try` block without a `catch` or `finally` block causes a compiler error.</span></span>

## <a name="catch-blocks"></a><span data-ttu-id="978a3-111">Blocs catch</span><span class="sxs-lookup"><span data-stu-id="978a3-111">Catch Blocks</span></span>

<span data-ttu-id="978a3-112">Un bloc `catch` peut spécifier le type d’exception à intercepter.</span><span class="sxs-lookup"><span data-stu-id="978a3-112">A `catch` block can specify the type of exception to catch.</span></span> <span data-ttu-id="978a3-113">La spécification de type est appelée *filtre d’exception*.</span><span class="sxs-lookup"><span data-stu-id="978a3-113">The type specification is called an *exception filter*.</span></span> <span data-ttu-id="978a3-114">Le type d’exception doit être dérivé de <xref:System.Exception>.</span><span class="sxs-lookup"><span data-stu-id="978a3-114">The exception type should be derived from <xref:System.Exception>.</span></span> <span data-ttu-id="978a3-115">En général, ne spécifiez pas <xref:System.Exception> comme filtre d’exception, sauf si vous savez comment gérer toutes les exceptions susceptibles d’être levées dans le `try` bloc ou si vous avez inclus une instruction [throw](../../language-reference/keywords/throw.md) à la fin de votre `catch` bloc.</span><span class="sxs-lookup"><span data-stu-id="978a3-115">In general, don't specify <xref:System.Exception> as the exception filter unless either you know how to handle all exceptions that might be thrown in the `try` block, or you've included a [throw](../../language-reference/keywords/throw.md) statement at the end of your `catch` block.</span></span>

<span data-ttu-id="978a3-116">Plusieurs `catch` blocs avec différentes classes d’exception peuvent être chaînés ensemble.</span><span class="sxs-lookup"><span data-stu-id="978a3-116">Multiple `catch` blocks with different exception classes can be chained together.</span></span> <span data-ttu-id="978a3-117">Les blocs `catch` sont évalués de haut en bas dans votre code, mais un seul bloc `catch` est exécuté pour chaque exception levée.</span><span class="sxs-lookup"><span data-stu-id="978a3-117">The `catch` blocks are evaluated from top to bottom in your code, but only one `catch` block is executed for each exception that is thrown.</span></span> <span data-ttu-id="978a3-118">Le premier bloc `catch` qui spécifie le type exact ou une classe de base de l’exception levée est exécuté.</span><span class="sxs-lookup"><span data-stu-id="978a3-118">The first `catch` block that specifies the exact type or a base class of the thrown exception is executed.</span></span> <span data-ttu-id="978a3-119">Si aucun `catch` bloc ne spécifie une classe d’exception correspondante, un `catch` bloc qui n’a pas de type est sélectionné, s’il est présent dans l’instruction.</span><span class="sxs-lookup"><span data-stu-id="978a3-119">If no `catch` block specifies a matching exception class, a `catch` block that doesn't have any type is selected, if one is present in the statement.</span></span> <span data-ttu-id="978a3-120">Il est important de placer `catch` les blocs avec les classes d’exception les plus spécifiques (autrement dit, les plus dérivées).</span><span class="sxs-lookup"><span data-stu-id="978a3-120">It's important to position `catch` blocks with the most specific (that is, the most derived) exception classes first.</span></span>

<span data-ttu-id="978a3-121">Interceptez les exceptions lorsque les conditions suivantes sont vraies :</span><span class="sxs-lookup"><span data-stu-id="978a3-121">Catch exceptions when the following conditions are true:</span></span>

- <span data-ttu-id="978a3-122">Vous savez pourquoi l’exception a été levée et vous pouvez implémenter une récupération spécifique, par exemple inviter l’utilisateur à entrer un nouveau nom de fichier quand vous interceptez un objet <xref:System.IO.FileNotFoundException>.</span><span class="sxs-lookup"><span data-stu-id="978a3-122">You have a good understanding of why the exception might be thrown, and you can implement a specific recovery, such as prompting the user to enter a new file name when you catch a <xref:System.IO.FileNotFoundException> object.</span></span>
- <span data-ttu-id="978a3-123">Vous pouvez créer et lever une nouvelle exception plus spécifique.</span><span class="sxs-lookup"><span data-stu-id="978a3-123">You can create and throw a new, more specific exception.</span></span>
  :::code language="csharp" source="snippets/exceptions/Program.cs" id="ThrowMoreSpecificException":::
- <span data-ttu-id="978a3-124">Vous voulez traiter partiellement une exception avant de la transmettre en vue d’un traitement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="978a3-124">You want to partially handle an exception before passing it on for additional handling.</span></span> <span data-ttu-id="978a3-125">Dans l’exemple suivant, un `catch` bloc est utilisé pour ajouter une entrée à un journal des erreurs avant de lever à nouveau l’exception.</span><span class="sxs-lookup"><span data-stu-id="978a3-125">In the following example, a `catch` block is used to add an entry to an error log before rethrowing the exception.</span></span>
  :::code language="csharp" source="snippets/exceptions/Program.cs" id="RethrowError":::

<span data-ttu-id="978a3-126">Vous pouvez également spécifier des *filtres d’exception* pour ajouter une expression booléenne à une clause catch.</span><span class="sxs-lookup"><span data-stu-id="978a3-126">You can also specify *exception filters* to add a boolean expression to a catch clause.</span></span> <span data-ttu-id="978a3-127">Ils indiquent qu’une clause catch spécifique correspond uniquement lorsque cette condition est vraie.</span><span class="sxs-lookup"><span data-stu-id="978a3-127">These indicate that a specific catch clause matches only when that condition is true.</span></span> <span data-ttu-id="978a3-128">Dans l’exemple suivant, les deux clauses catch utilisent la même classe d’exception, mais une condition supplémentaire est vérifiée pour créer un autre message d’erreur :</span><span class="sxs-lookup"><span data-stu-id="978a3-128">In the following example, both catch clauses use the same exception class, but an additional condition is checked to create a different error message:</span></span>

:::code language="csharp" source="snippets/exceptions/ExceptionFilter.cs" ID="DemonstrateExceptionFilter":::

<span data-ttu-id="978a3-129">Un filtre d’exception qui retourne toujours `false` peut être utilisé pour examiner toutes les exceptions, mais ne pas les traiter.</span><span class="sxs-lookup"><span data-stu-id="978a3-129">An exception filter that always returns `false` can be used to examine all exceptions but not process them.</span></span> <span data-ttu-id="978a3-130">Une utilisation courante consiste à enregistrer les exceptions :</span><span class="sxs-lookup"><span data-stu-id="978a3-130">A typical use is to log exceptions:</span></span>

:::code language="csharp" source="snippets/exceptions/ExceptionFilter.cs" ID="ShowExceptionFilter":::

<span data-ttu-id="978a3-131">La `LogException` méthode retourne toujours `false` , aucune `catch` clause utilisant ce filtre d’exception ne correspond à.</span><span class="sxs-lookup"><span data-stu-id="978a3-131">The `LogException` method always returns `false`, no `catch` clause using this exception filter matches.</span></span> <span data-ttu-id="978a3-132">La clause catch peut être générale, l’utilisation de <xref:System.Exception?displayProperty=nameWithType> et les clauses ultérieures peuvent traiter des classes d’exception plus spécifiques.</span><span class="sxs-lookup"><span data-stu-id="978a3-132">The catch clause can be general, using <xref:System.Exception?displayProperty=nameWithType>, and later clauses can process more specific exception classes.</span></span>

## <a name="finally-blocks"></a><span data-ttu-id="978a3-133">Blocs Finally</span><span class="sxs-lookup"><span data-stu-id="978a3-133">Finally Blocks</span></span>

<span data-ttu-id="978a3-134">Un bloc `finally` vous permet de nettoyer les actions qui sont exécutées dans un bloc `try`.</span><span class="sxs-lookup"><span data-stu-id="978a3-134">A `finally` block enables you to clean up actions that are performed in a `try` block.</span></span> <span data-ttu-id="978a3-135">S’il est présent, le bloc `finally` s’exécute en dernier, après le bloc `try` et tout bloc `catch` mis en correspondance.</span><span class="sxs-lookup"><span data-stu-id="978a3-135">If present, the `finally` block executes last, after the `try` block and any matched `catch` block.</span></span> <span data-ttu-id="978a3-136">Un `finally` bloc s’exécute toujours, qu’une exception soit levée ou qu’un `catch` bloc correspondant au type d’exception soit trouvé.</span><span class="sxs-lookup"><span data-stu-id="978a3-136">A `finally` block always runs, whether an exception is thrown or a `catch` block matching the exception type is found.</span></span>

<span data-ttu-id="978a3-137">Le bloc `finally` peut être utilisé pour libérer des ressources telles que des flux de fichiers, des connexions de base de données et des handles graphiques, sans attendre que le récupérateur de mémoire dans le runtime finalise les objets.</span><span class="sxs-lookup"><span data-stu-id="978a3-137">The `finally` block can be used to release resources such as file streams, database connections, and graphics handles without waiting for the garbage collector in the runtime to finalize the objects.</span></span> <span data-ttu-id="978a3-138">Pour plus d’informations, consultez l' [instruction using](../../language-reference/keywords/using-statement.md).</span><span class="sxs-lookup"><span data-stu-id="978a3-138">For more information See the [using Statement](../../language-reference/keywords/using-statement.md).</span></span>

<span data-ttu-id="978a3-139">Dans l’exemple suivant, le bloc `finally` est utilisé pour fermer un fichier ouvert dans le bloc `try`.</span><span class="sxs-lookup"><span data-stu-id="978a3-139">In the following example, the `finally` block is used to close a file that is opened in the `try` block.</span></span> <span data-ttu-id="978a3-140">Notez que l’état du handle de fichier est vérifié avant la fermeture du fichier.</span><span class="sxs-lookup"><span data-stu-id="978a3-140">Notice that the state of the file handle is checked before the file is closed.</span></span> <span data-ttu-id="978a3-141">Si le `try` bloc ne peut pas ouvrir le fichier, le descripteur de fichier a toujours la valeur `null` et le `finally` bloc ne tente pas de le fermer.</span><span class="sxs-lookup"><span data-stu-id="978a3-141">If the `try` block can't open the file, the file handle still has the value `null` and the `finally` block doesn't try to close it.</span></span> <span data-ttu-id="978a3-142">Au lieu de cela, si le fichier est ouvert avec succès dans le `try` bloc, le `finally` bloc ferme le fichier ouvert.</span><span class="sxs-lookup"><span data-stu-id="978a3-142">Instead, if the file is opened successfully in the `try` block, the `finally` block closes the open file.</span></span>

:::code language="csharp" source="snippets/exceptions/Program.cs" id="CleanupIfNotNull":::

## <a name="c-language-specification"></a><span data-ttu-id="978a3-143">Spécification du langage C#</span><span class="sxs-lookup"><span data-stu-id="978a3-143">C# Language Specification</span></span>

<span data-ttu-id="978a3-144">Pour plus d’informations, consultez [Exceptions](~/_csharplang/spec/exceptions.md) et [Instruction try](~/_csharplang/spec/statements.md#the-try-statement) dans la [spécification du langage C#](/dotnet/csharp/language-reference/language-specification/introduction).</span><span class="sxs-lookup"><span data-stu-id="978a3-144">For more information, see [Exceptions](~/_csharplang/spec/exceptions.md) and [The try statement](~/_csharplang/spec/statements.md#the-try-statement) in the [C# Language Specification](/dotnet/csharp/language-reference/language-specification/introduction).</span></span> <span data-ttu-id="978a3-145">La spécification du langage est la source de référence pour la syntaxe C# et son utilisation.</span><span class="sxs-lookup"><span data-stu-id="978a3-145">The language specification is the definitive source for C# syntax and usage.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="978a3-146">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="978a3-146">See also</span></span>

- [<span data-ttu-id="978a3-147">Référence C#</span><span class="sxs-lookup"><span data-stu-id="978a3-147">C# Reference</span></span>](../../language-reference/index.md)
- [<span data-ttu-id="978a3-148">try-catch</span><span class="sxs-lookup"><span data-stu-id="978a3-148">try-catch</span></span>](../../language-reference/keywords/try-catch.md)
- [<span data-ttu-id="978a3-149">try-finally</span><span class="sxs-lookup"><span data-stu-id="978a3-149">try-finally</span></span>](../../language-reference/keywords/try-finally.md)
- [<span data-ttu-id="978a3-150">try-catch-finally</span><span class="sxs-lookup"><span data-stu-id="978a3-150">try-catch-finally</span></span>](../../language-reference/keywords/try-catch-finally.md)
- [<span data-ttu-id="978a3-151">using, instruction</span><span class="sxs-lookup"><span data-stu-id="978a3-151">using Statement</span></span>](../../language-reference/keywords/using-statement.md)

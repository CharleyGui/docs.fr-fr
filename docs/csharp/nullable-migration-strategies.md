---
title: Mettre à jour votre code base pour utiliser des types référence Nullable
description: Choisissez la meilleure stratégie pour mettre à niveau votre base de code afin d’utiliser des types de référence Nullable.
ms.technology: csharp-null-safety
ms.date: 07/31/2019
ms.openlocfilehash: ab0970247c7e3f3c20d7fdb40ef035c4ba1d8b01
ms.sourcegitcommit: 30e9e11dfd90112b8eec6406186ba3533f21eba1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/21/2020
ms.locfileid: "95099325"
---
# <a name="update-libraries-to-use-nullable-reference-types-and-communicate-nullable-rules-to-callers"></a><span data-ttu-id="5a96d-103">Mettre à jour les bibliothèques pour utiliser des types référence Nullable et communiquer des règles Nullable aux appelants</span><span class="sxs-lookup"><span data-stu-id="5a96d-103">Update libraries to use nullable reference types and communicate nullable rules to callers</span></span>

<span data-ttu-id="5a96d-104">L’ajout de [types de référence Nullable](nullable-references.md) signifie que vous pouvez déclarer si une `null` valeur est autorisée ou non pour chaque variable.</span><span class="sxs-lookup"><span data-stu-id="5a96d-104">The addition of [nullable reference types](nullable-references.md) means you can declare whether or not a `null` value is allowed or expected for every variable.</span></span> <span data-ttu-id="5a96d-105">En outre, vous pouvez appliquer un certain nombre d’attributs : `AllowNull` , `DisallowNull` ,,,, `MaybeNull` `NotNull` `NotNullWhen` `MaybeNullWhen` et `NotNullIfNotNull` pour décrire complètement les États null de l’argument et les valeurs de retour.</span><span class="sxs-lookup"><span data-stu-id="5a96d-105">In addition, you can apply a number of attributes: `AllowNull`, `DisallowNull`, `MaybeNull`, `NotNull`, `NotNullWhen`, `MaybeNullWhen`, and `NotNullIfNotNull` to completely describe the null states of argument and return values.</span></span> <span data-ttu-id="5a96d-106">Cela offre une excellente expérience lorsque vous écrivez du code.</span><span class="sxs-lookup"><span data-stu-id="5a96d-106">That provides a great experience as you write code.</span></span> <span data-ttu-id="5a96d-107">Vous recevez des avertissements si une variable qui n’accepte pas les valeurs NULL peut avoir la valeur `null` .</span><span class="sxs-lookup"><span data-stu-id="5a96d-107">You get warnings if a non-nullable variable might be set to `null`.</span></span> <span data-ttu-id="5a96d-108">Vous recevez des avertissements si une variable Nullable n’est pas vérifiée par null avant d’être déréférencée.</span><span class="sxs-lookup"><span data-stu-id="5a96d-108">You get warnings if a nullable variable isn't null-checked before you dereference it.</span></span> <span data-ttu-id="5a96d-109">La mise à jour de vos bibliothèques peut prendre du temps, mais les avantages le justifient.</span><span class="sxs-lookup"><span data-stu-id="5a96d-109">Updating your libraries can take time, but the payoffs are worth it.</span></span> <span data-ttu-id="5a96d-110">Plus d’informations que vous fournissez au compilateur sur les *cas où* une `null` valeur est autorisée ou interdite, les meilleurs avertissements que les utilisateurs de votre API obtiendront.</span><span class="sxs-lookup"><span data-stu-id="5a96d-110">The more information you provide to the compiler about *when* a `null` value is allowed or prohibited, the better warnings users of your API will get.</span></span> <span data-ttu-id="5a96d-111">Commençons par un exemple familier.</span><span class="sxs-lookup"><span data-stu-id="5a96d-111">Let's start with a familiar example.</span></span> <span data-ttu-id="5a96d-112">Imaginez que votre bibliothèque possède l’API suivante pour récupérer une chaîne de ressource :</span><span class="sxs-lookup"><span data-stu-id="5a96d-112">Imagine your library has the following API to retrieve a resource string:</span></span>

```csharp
bool TryGetMessage(string key, out string message)
```

<span data-ttu-id="5a96d-113">L’exemple précédent suit le `Try*` modèle familier dans .net.</span><span class="sxs-lookup"><span data-stu-id="5a96d-113">The preceding example follows the familiar `Try*` pattern in .NET.</span></span> <span data-ttu-id="5a96d-114">Il existe deux arguments de référence pour cette API : `key` et le `message` paramètre.</span><span class="sxs-lookup"><span data-stu-id="5a96d-114">There are two reference arguments for this API: the `key` and the `message` parameter.</span></span> <span data-ttu-id="5a96d-115">Cette API comporte les règles suivantes relatives à la valeur null de ces arguments :</span><span class="sxs-lookup"><span data-stu-id="5a96d-115">This API has the following rules relating to the nullness of these arguments:</span></span>

- <span data-ttu-id="5a96d-116">Les appelants ne doivent pas passer `null` comme argument pour `key` .</span><span class="sxs-lookup"><span data-stu-id="5a96d-116">Callers shouldn't pass `null` as the argument for `key`.</span></span>
- <span data-ttu-id="5a96d-117">Les appelants peuvent passer une variable dont la valeur est `null` l’argument pour `message` .</span><span class="sxs-lookup"><span data-stu-id="5a96d-117">Callers can pass a variable whose value is `null` as the argument for `message`.</span></span>
- <span data-ttu-id="5a96d-118">Si la `TryGetMessage` méthode retourne `true` , la valeur de `message` n’est pas null.</span><span class="sxs-lookup"><span data-stu-id="5a96d-118">If the `TryGetMessage` method returns `true`, the value of `message` isn't null.</span></span> <span data-ttu-id="5a96d-119">Si la valeur de retour est `false,` la valeur de `message` (et son état null) est null.</span><span class="sxs-lookup"><span data-stu-id="5a96d-119">If the return value is `false,` the value of `message` (and its null state) is null.</span></span>

<span data-ttu-id="5a96d-120">La règle pour `key` peut être entièrement exprimée par le type de variable : `key` doit être un type de référence non Nullable.</span><span class="sxs-lookup"><span data-stu-id="5a96d-120">The rule for `key` can be completely expressed by the variable type: `key` should be a non-nullable reference type.</span></span> <span data-ttu-id="5a96d-121">Le `message` paramètre est plus complexe.</span><span class="sxs-lookup"><span data-stu-id="5a96d-121">The `message` parameter is more complex.</span></span> <span data-ttu-id="5a96d-122">Elle autorise `null` comme argument, mais garantit que, en cas de réussite, cet `out` argument n’est pas null.</span><span class="sxs-lookup"><span data-stu-id="5a96d-122">It allows `null` as the argument, but guarantees that, on success, that `out` argument isn't null.</span></span> <span data-ttu-id="5a96d-123">Pour ces scénarios, vous avez besoin d’un vocabulaire plus riche pour décrire les attentes.</span><span class="sxs-lookup"><span data-stu-id="5a96d-123">For these scenarios, you need a richer vocabulary to describe the expectations.</span></span>

<span data-ttu-id="5a96d-124">La mise à jour de votre bibliothèque pour les références Nullable nécessite plus que l’extinction `?` sur certaines variables et certains noms de types.</span><span class="sxs-lookup"><span data-stu-id="5a96d-124">Updating your library for nullable references requires more than sprinkling `?` on some of the variables and type names.</span></span> <span data-ttu-id="5a96d-125">L’exemple précédent montre que vous devez examiner vos API et prendre en compte vos attentes pour chaque argument d’entrée.</span><span class="sxs-lookup"><span data-stu-id="5a96d-125">The preceding example shows that you need to examine your APIs and consider your expectations for each input argument.</span></span> <span data-ttu-id="5a96d-126">Considérez les garanties pour la valeur de retour et `out` les `ref` arguments ou sur le retour de la méthode.</span><span class="sxs-lookup"><span data-stu-id="5a96d-126">Consider the guarantees for the return value, and any `out` or `ref` arguments upon the method's return.</span></span> <span data-ttu-id="5a96d-127">Ensuite, communiquez ces règles au compilateur et le compilateur fournira des avertissements quand les appelants ne respectent pas ces règles.</span><span class="sxs-lookup"><span data-stu-id="5a96d-127">Then communicate those rules to the compiler, and the compiler will provide warnings when callers don't abide by those rules.</span></span>

<span data-ttu-id="5a96d-128">Ce travail prend du temps.</span><span class="sxs-lookup"><span data-stu-id="5a96d-128">This work takes time.</span></span> <span data-ttu-id="5a96d-129">Commençons par des stratégies pour rendre votre bibliothèque ou votre application prenant en charge les valeurs NULL, tout en équilibrant d’autres exigences.</span><span class="sxs-lookup"><span data-stu-id="5a96d-129">Let's start with strategies to make your library or application nullable-aware, while balancing other requirements.</span></span> <span data-ttu-id="5a96d-130">Vous verrez comment équilibrer le développement en cours et activer les types de référence Nullable.</span><span class="sxs-lookup"><span data-stu-id="5a96d-130">You'll see how to balance ongoing development enabling nullable reference types.</span></span> <span data-ttu-id="5a96d-131">Vous découvrirez les défis liés aux définitions de type générique.</span><span class="sxs-lookup"><span data-stu-id="5a96d-131">You'll learn challenges for generic type definitions.</span></span> <span data-ttu-id="5a96d-132">Vous apprendrez à appliquer des attributs pour décrire des conditions préalables et postérieures à des API individuelles.</span><span class="sxs-lookup"><span data-stu-id="5a96d-132">You'll learn to apply attributes to describe pre- and post-conditions on individual APIs.</span></span>

## <a name="choose-a-strategy-for-nullable-reference-types"></a><span data-ttu-id="5a96d-133">Choisir une stratégie pour les types de référence Nullable</span><span class="sxs-lookup"><span data-stu-id="5a96d-133">Choose a strategy for nullable reference types</span></span>

<span data-ttu-id="5a96d-134">Le premier choix est si les types de référence Nullable doivent être activés ou désactivés par défaut.</span><span class="sxs-lookup"><span data-stu-id="5a96d-134">The first choice is whether nullable reference types should be on or off by default.</span></span> <span data-ttu-id="5a96d-135">Vous avez deux stratégies :</span><span class="sxs-lookup"><span data-stu-id="5a96d-135">You have two strategies:</span></span>

- <span data-ttu-id="5a96d-136">Activez les types de référence Nullable pour l’ensemble du projet et désactivez-le dans le code qui n’est pas prêt.</span><span class="sxs-lookup"><span data-stu-id="5a96d-136">Enable nullable reference types for the entire project, and disable it in code that's not ready.</span></span>
- <span data-ttu-id="5a96d-137">Activez uniquement les types référence Nullable pour le code qui a été annoté pour les types référence Nullable.</span><span class="sxs-lookup"><span data-stu-id="5a96d-137">Only enable nullable reference types for code that's been annotated for nullable reference types.</span></span>

<span data-ttu-id="5a96d-138">La première stratégie fonctionne mieux lorsque vous ajoutez d’autres fonctionnalités à la bibliothèque lors de sa mise à jour pour les types de référence Nullable.</span><span class="sxs-lookup"><span data-stu-id="5a96d-138">The first strategy works best when you're adding other features to the library as you update it for nullable reference types.</span></span> <span data-ttu-id="5a96d-139">Tout nouveau développement prend en charge les valeurs NULL.</span><span class="sxs-lookup"><span data-stu-id="5a96d-139">All new development is nullable aware.</span></span> <span data-ttu-id="5a96d-140">Lorsque vous mettez à jour le code existant, vous activez les types de référence Nullable dans ces classes.</span><span class="sxs-lookup"><span data-stu-id="5a96d-140">As you update existing code, you enable nullable reference types in those classes.</span></span>

<span data-ttu-id="5a96d-141">Après cette première stratégie, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="5a96d-141">Following this first strategy, you do the following steps:</span></span>

1. <span data-ttu-id="5a96d-142">Activez les types de référence Nullable pour l’ensemble du projet en ajoutant l' `<Nullable>enable</Nullable>` élément à vos fichiers *csproj* .</span><span class="sxs-lookup"><span data-stu-id="5a96d-142">Enable nullable reference types for the entire project by adding the `<Nullable>enable</Nullable>` element to your *csproj* files.</span></span>
1. <span data-ttu-id="5a96d-143">Ajoutez le `#nullable disable` pragma à chaque fichier source de votre projet.</span><span class="sxs-lookup"><span data-stu-id="5a96d-143">Add the `#nullable disable` pragma to every source file in your project.</span></span>
1. <span data-ttu-id="5a96d-144">Lorsque vous travaillez sur chaque fichier, supprimez le pragma et résolvez tous les avertissements.</span><span class="sxs-lookup"><span data-stu-id="5a96d-144">As you work on each file, remove the pragma and address any warnings.</span></span>

<span data-ttu-id="5a96d-145">Cette première stratégie a plus de travail initial pour ajouter le pragma à chaque fichier.</span><span class="sxs-lookup"><span data-stu-id="5a96d-145">This first strategy has more up-front work to add the pragma to every file.</span></span> <span data-ttu-id="5a96d-146">L’avantage est que chaque nouveau fichier de code ajouté au projet sera activé pour la valeur null.</span><span class="sxs-lookup"><span data-stu-id="5a96d-146">The advantage is that every new code file added to the project will be nullable enabled.</span></span> <span data-ttu-id="5a96d-147">Tout nouveau travail prend en charge les valeurs null ; seul le code existant doit être mis à jour.</span><span class="sxs-lookup"><span data-stu-id="5a96d-147">Any new work will be nullable aware; only existing code must be updated.</span></span>

<span data-ttu-id="5a96d-148">La deuxième stratégie fonctionne mieux si la bibliothèque est stable, et l’objectif principal du développement est d’adopter des types de référence Nullable.</span><span class="sxs-lookup"><span data-stu-id="5a96d-148">The second strategy works better if the library is stable, and the main focus of the development is to adopt nullable reference types.</span></span> <span data-ttu-id="5a96d-149">Vous activez les types de référence Nullable quand vous annotez des API.</span><span class="sxs-lookup"><span data-stu-id="5a96d-149">You turn on nullable reference types as you annotate APIs.</span></span> <span data-ttu-id="5a96d-150">Lorsque vous avez terminé, vous activez les types de référence Nullable pour l’ensemble du projet.</span><span class="sxs-lookup"><span data-stu-id="5a96d-150">When you've finished, you enable nullable reference types for the entire project.</span></span>

<span data-ttu-id="5a96d-151">Après cette seconde stratégie, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="5a96d-151">Following this second strategy you do the following steps:</span></span>

1. <span data-ttu-id="5a96d-152">Ajoutez le `#nullable enable` pragma au fichier que vous souhaitez rendre compatible avec la valeur null.</span><span class="sxs-lookup"><span data-stu-id="5a96d-152">Add the `#nullable enable` pragma to the file you want to make nullable aware.</span></span>
1. <span data-ttu-id="5a96d-153">Résolvez tous les avertissements.</span><span class="sxs-lookup"><span data-stu-id="5a96d-153">Address any warnings.</span></span>
1. <span data-ttu-id="5a96d-154">Poursuivez ces deux premières étapes jusqu’à ce que vous ayez pris en charge la valeur null de la bibliothèque entière.</span><span class="sxs-lookup"><span data-stu-id="5a96d-154">Continue these first two steps until you've made the entire library nullable aware.</span></span>
1. <span data-ttu-id="5a96d-155">Activez les types Nullable pour l’ensemble du projet en ajoutant l' `<Nullable>enable</Nullable>` élément à vos fichiers *csproj* .</span><span class="sxs-lookup"><span data-stu-id="5a96d-155">Enable nullable types for the entire project by adding the `<Nullable>enable</Nullable>` element to your *csproj* files.</span></span>
1. <span data-ttu-id="5a96d-156">Supprimez les `#nullable enable` pragmas, car ils ne sont plus nécessaires.</span><span class="sxs-lookup"><span data-stu-id="5a96d-156">Remove the `#nullable enable` pragmas, as they're no longer needed.</span></span>

<span data-ttu-id="5a96d-157">Cette deuxième stratégie a moins de travail avant.</span><span class="sxs-lookup"><span data-stu-id="5a96d-157">This second strategy has less work up-front.</span></span> <span data-ttu-id="5a96d-158">Le compromis est que la première tâche lorsque vous créez un nouveau fichier consiste à ajouter le pragma et à le rendre compatible avec la valeur null.</span><span class="sxs-lookup"><span data-stu-id="5a96d-158">The tradeoff is that the first task when you create a new file is to add the pragma and make it nullable aware.</span></span> <span data-ttu-id="5a96d-159">Si des développeurs de votre équipe oublient, ce nouveau code est désormais dans le backlog de travail pour rendre tout le code prenant en charge la valeur null.</span><span class="sxs-lookup"><span data-stu-id="5a96d-159">If any developers on your team forget, that new code is now in the backlog of work to make all code nullable aware.</span></span>

<span data-ttu-id="5a96d-160">Les stratégies que vous choisissez dépendent de la quantité de développement actif dans votre projet.</span><span class="sxs-lookup"><span data-stu-id="5a96d-160">Which of these strategies you pick depends on how much active development is taking place in your project.</span></span> <span data-ttu-id="5a96d-161">Plus votre projet est mature et stable, plus la seconde stratégie est performante.</span><span class="sxs-lookup"><span data-stu-id="5a96d-161">The more mature and stable your project, the better the second strategy.</span></span> <span data-ttu-id="5a96d-162">Plus vous développez de fonctionnalités, mieux la première stratégie.</span><span class="sxs-lookup"><span data-stu-id="5a96d-162">The more features being developed, the better the first strategy.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5a96d-163">Le contexte Nullable global ne s’applique pas aux fichiers de code générés.</span><span class="sxs-lookup"><span data-stu-id="5a96d-163">The global nullable context does not apply for generated code files.</span></span> <span data-ttu-id="5a96d-164">Dans l’une ou l’autre stratégie, le contexte Nullable est *désactivé* pour tout fichier source marqué comme généré.</span><span class="sxs-lookup"><span data-stu-id="5a96d-164">Under either strategy, the nullable context is *disabled* for any source file marked as generated.</span></span> <span data-ttu-id="5a96d-165">Cela signifie que toutes les API dans les fichiers générés ne sont pas annotées.</span><span class="sxs-lookup"><span data-stu-id="5a96d-165">This means any APIs in generated files are not annotated.</span></span> <span data-ttu-id="5a96d-166">Un fichier est marqué comme généré de quatre façons :</span><span class="sxs-lookup"><span data-stu-id="5a96d-166">There are four ways a file is marked as generated:</span></span>
>
> 1. <span data-ttu-id="5a96d-167">Dans le fichier. editorconfig, spécifiez `generated_code = true` dans une section qui s’applique à ce fichier.</span><span class="sxs-lookup"><span data-stu-id="5a96d-167">In the .editorconfig, specify `generated_code = true` in a section that applies to that file.</span></span>
> 1. <span data-ttu-id="5a96d-168">Placez `<auto-generated>` ou `<auto-generated/>` dans un commentaire en haut du fichier.</span><span class="sxs-lookup"><span data-stu-id="5a96d-168">Put `<auto-generated>` or `<auto-generated/>` in a comment at the top of the file.</span></span> <span data-ttu-id="5a96d-169">Il peut se trouver sur n’importe quelle ligne de ce commentaire, mais le bloc de commentaires doit être le premier élément du fichier.</span><span class="sxs-lookup"><span data-stu-id="5a96d-169">It can be on any line in that comment, but the comment block must be the first element in the file.</span></span>
> 1. <span data-ttu-id="5a96d-170">Démarrer le nom de fichier avec *TemporaryGeneratedFile_*</span><span class="sxs-lookup"><span data-stu-id="5a96d-170">Start the file name with *TemporaryGeneratedFile_*</span></span>
> 1. <span data-ttu-id="5a96d-171">Terminez le nom de fichier avec *. Designer.cs*, *. generated.cs*, *. g.cs* ou *. g.i.cs*.</span><span class="sxs-lookup"><span data-stu-id="5a96d-171">End the file name with *.designer.cs*, *.generated.cs*, *.g.cs*, or *.g.i.cs*.</span></span>
>
> <span data-ttu-id="5a96d-172">Les générateurs peuvent s’abonner à l’aide de la [`#nullable`](language-reference/preprocessor-directives/preprocessor-nullable.md) directive de préprocesseur.</span><span class="sxs-lookup"><span data-stu-id="5a96d-172">Generators can opt-in using the [`#nullable`](language-reference/preprocessor-directives/preprocessor-nullable.md) preprocessor directive.</span></span>

## <a name="should-nullable-warnings-introduce-breaking-changes"></a><span data-ttu-id="5a96d-173">Les avertissements de type Nullable introduisent-ils des modifications avec rupture ?</span><span class="sxs-lookup"><span data-stu-id="5a96d-173">Should nullable warnings introduce breaking changes?</span></span>

<span data-ttu-id="5a96d-174">Avant d’activer les types de référence Nullable, les variables sont considérées comme *Nullable oublie*.</span><span class="sxs-lookup"><span data-stu-id="5a96d-174">Before you enable nullable reference types, variables are considered *nullable oblivious*.</span></span> <span data-ttu-id="5a96d-175">Une fois que vous activez les types de référence Nullable, toutes ces variables ne peuvent pas avoir la valeur *null*.</span><span class="sxs-lookup"><span data-stu-id="5a96d-175">Once you enable nullable reference types, all those variables are *non-nullable*.</span></span> <span data-ttu-id="5a96d-176">Le compilateur émet des avertissements si ces variables ne sont pas initialisées à des valeurs non null.</span><span class="sxs-lookup"><span data-stu-id="5a96d-176">The compiler will issue warnings if those variables aren't initialized to non-null values.</span></span>

<span data-ttu-id="5a96d-177">Une autre source probable d’avertissements est celle des valeurs de retour lorsque la valeur n’a pas été initialisée.</span><span class="sxs-lookup"><span data-stu-id="5a96d-177">Another likely source of warnings is return values when the value hasn't been initialized.</span></span>

<span data-ttu-id="5a96d-178">La première étape de la résolution des avertissements du compilateur consiste à utiliser `?` des annotations sur les types de paramètres et de retour pour indiquer quand les arguments ou les valeurs de retour peuvent être null.</span><span class="sxs-lookup"><span data-stu-id="5a96d-178">The first step in addressing the compiler warnings is to use `?` annotations on parameter and return types to indicate when arguments or return values may be null.</span></span> <span data-ttu-id="5a96d-179">Lorsque les variables de référence ne doivent pas avoir la valeur null, la déclaration d’origine est correcte.</span><span class="sxs-lookup"><span data-stu-id="5a96d-179">When reference variables must not be null, the original declaration is correct.</span></span> <span data-ttu-id="5a96d-180">Au fur et à mesure que vous effectuez cette tâche, votre objectif n’est pas simplement de corriger les avertissements.</span><span class="sxs-lookup"><span data-stu-id="5a96d-180">As you do this task, your goal isn't just to fix warnings.</span></span> <span data-ttu-id="5a96d-181">L’objectif le plus important est de faire en sorte que le compilateur comprenne votre intention pour les valeurs NULL potentielles.</span><span class="sxs-lookup"><span data-stu-id="5a96d-181">The more important goal is to make the compiler understand your intent for potential null values.</span></span> <span data-ttu-id="5a96d-182">Lorsque vous examinez les avertissements, vous atteignez votre prochaine décision majeure pour votre bibliothèque.</span><span class="sxs-lookup"><span data-stu-id="5a96d-182">As you examine the warnings, you reach your next major decision for your library.</span></span> <span data-ttu-id="5a96d-183">Voulez-vous envisager de modifier les signatures d’API pour communiquer plus clairement votre intention de conception ?</span><span class="sxs-lookup"><span data-stu-id="5a96d-183">Do you want to consider modifying API signatures to more clearly communicate your design intent?</span></span> <span data-ttu-id="5a96d-184">Une meilleure signature d’API pour la `TryGetMessage` méthode examinée précédemment peut être :</span><span class="sxs-lookup"><span data-stu-id="5a96d-184">A better API signature for the `TryGetMessage` method examined earlier could be:</span></span>

```csharp
string? TryGetMessage(string key);
```

<span data-ttu-id="5a96d-185">La valeur de retour indique la réussite ou l’échec et transporte la valeur si la valeur a été trouvée.</span><span class="sxs-lookup"><span data-stu-id="5a96d-185">The return value indicates success or failure, and carries the value if the value was found.</span></span> <span data-ttu-id="5a96d-186">Dans de nombreux cas, la modification des signatures d’API peut améliorer la façon dont elles communiquent les valeurs NULL.</span><span class="sxs-lookup"><span data-stu-id="5a96d-186">In many cases, changing API signatures can improve how they communicate null values.</span></span>

<span data-ttu-id="5a96d-187">Toutefois, pour les bibliothèques publiques ou les bibliothèques avec des bases d’utilisateurs volumineuses, vous préférerez peut-être ne pas introduire de modifications de signature d’API.</span><span class="sxs-lookup"><span data-stu-id="5a96d-187">However, for public libraries, or libraries with large user bases, you may prefer not introducing any API signature changes.</span></span> <span data-ttu-id="5a96d-188">Dans ces cas-là, et d’autres modèles courants, vous pouvez appliquer des attributs pour définir plus clairement quand un argument ou une valeur de retour peut être `null` .</span><span class="sxs-lookup"><span data-stu-id="5a96d-188">For those cases, and other common patterns, you can apply attributes to more clearly define when an argument or return value may be `null`.</span></span> <span data-ttu-id="5a96d-189">Si vous envisagez de modifier la surface de votre API, vous constaterez sans doute que les annotations de type ne suffisent pas pour décrire les `null` valeurs des arguments ou des valeurs de retour.</span><span class="sxs-lookup"><span data-stu-id="5a96d-189">Whether or not you consider changing the surface of your API, you'll likely find that type annotations alone aren't sufficient for describing `null` values for arguments or return values.</span></span> <span data-ttu-id="5a96d-190">Dans ces instances, vous pouvez appliquer des attributs pour décrire plus clairement une API.</span><span class="sxs-lookup"><span data-stu-id="5a96d-190">In those instances, you can apply attributes to more clearly describe an API.</span></span>

## <a name="attributes-extend-type-annotations"></a><span data-ttu-id="5a96d-191">Les attributs étendent les annotations de type</span><span class="sxs-lookup"><span data-stu-id="5a96d-191">Attributes extend type annotations</span></span>

<span data-ttu-id="5a96d-192">Plusieurs attributs ont été ajoutés pour exprimer des informations supplémentaires sur l’État null des variables.</span><span class="sxs-lookup"><span data-stu-id="5a96d-192">Several attributes have been added to express additional information about the null state of variables.</span></span> <span data-ttu-id="5a96d-193">Tout le code que vous avez écrit avant C# 8 a introduit des types de référence Nullable était *null oublie*.</span><span class="sxs-lookup"><span data-stu-id="5a96d-193">All code you wrote before C# 8 introduced nullable reference types was *null oblivious*.</span></span> <span data-ttu-id="5a96d-194">Cela signifie que toute variable de type référence peut avoir la valeur null, mais que les vérifications de valeur NULL ne sont pas requises.</span><span class="sxs-lookup"><span data-stu-id="5a96d-194">That means any reference type variable may be null, but null checks aren't required.</span></span> <span data-ttu-id="5a96d-195">Une fois que votre code prend en *charge les valeurs NULL*, ces règles changent.</span><span class="sxs-lookup"><span data-stu-id="5a96d-195">Once your code is *nullable aware*, those rules change.</span></span> <span data-ttu-id="5a96d-196">Les types référence ne doivent jamais être la `null` valeur, et les types référence Nullable doivent être vérifiés `null` avant d’être déréférencés.</span><span class="sxs-lookup"><span data-stu-id="5a96d-196">Reference types should never be the `null` value, and nullable reference types must be checked against `null` before being dereferenced.</span></span>

<span data-ttu-id="5a96d-197">Les règles de vos API sont probablement plus compliquées, comme vous l’avez vu dans le `TryGetValue` scénario d’API.</span><span class="sxs-lookup"><span data-stu-id="5a96d-197">The rules for your APIs are likely more complicated, as you saw with the `TryGetValue` API scenario.</span></span> <span data-ttu-id="5a96d-198">La plupart de vos API ont des règles plus complexes pour le moment où les variables peuvent ou ne peuvent pas être `null` .</span><span class="sxs-lookup"><span data-stu-id="5a96d-198">Many of your APIs have more complex rules for when variables can or can't be `null`.</span></span> <span data-ttu-id="5a96d-199">Dans ce cas, vous utiliserez des attributs pour exprimer ces règles.</span><span class="sxs-lookup"><span data-stu-id="5a96d-199">In these cases, you'll use attributes to express those rules.</span></span> <span data-ttu-id="5a96d-200">Les attributs qui décrivent la sémantique de votre API se trouvent dans l’article sur les [attributs qui affectent l’analyse Nullable](./language-reference/attributes/nullable-analysis.md).</span><span class="sxs-lookup"><span data-stu-id="5a96d-200">The attributes that describe the semantics of your API are found in the article on [Attributes that impact nullable analysis](./language-reference/attributes/nullable-analysis.md).</span></span>

## <a name="generic-definitions-and-nullability"></a><span data-ttu-id="5a96d-201">Définitions génériques et possibilité de valeur null</span><span class="sxs-lookup"><span data-stu-id="5a96d-201">Generic definitions and nullability</span></span>

<span data-ttu-id="5a96d-202">La communication correcte de l’État null des types génériques et des méthodes génériques requiert une attention particulière.</span><span class="sxs-lookup"><span data-stu-id="5a96d-202">Correctly communicating the null state of generic types and generic methods requires special care.</span></span> <span data-ttu-id="5a96d-203">Les soins supplémentaires proviennent du fait qu’un type valeur Nullable et un type référence Nullable sont fondamentalement différents.</span><span class="sxs-lookup"><span data-stu-id="5a96d-203">The extra care stems from the fact that a nullable value type and a nullable reference type are fundamentally different.</span></span> <span data-ttu-id="5a96d-204">Un `int?` est un synonyme de `Nullable<int>` , tandis que `string?` est `string` associé à un attribut ajouté par le compilateur.</span><span class="sxs-lookup"><span data-stu-id="5a96d-204">An `int?` is a synonym for `Nullable<int>`, whereas `string?` is `string` with an attribute added by the compiler.</span></span> <span data-ttu-id="5a96d-205">Le résultat est que le compilateur ne peut pas générer de code correct pour `T?` sans savoir si `T` est un `class` ou un `struct` .</span><span class="sxs-lookup"><span data-stu-id="5a96d-205">The result is that the compiler can't generate correct code for `T?` without knowing if `T` is a `class` or a `struct`.</span></span>

<span data-ttu-id="5a96d-206">Ce fait ne signifie pas que vous ne pouvez pas utiliser un type Nullable (type valeur ou type référence) comme argument de type pour un type générique fermé.</span><span class="sxs-lookup"><span data-stu-id="5a96d-206">This fact doesn't mean you can't use a nullable type (either value type or reference type) as the type argument for a closed generic type.</span></span> <span data-ttu-id="5a96d-207">`List<string?>`Et `List<int?>` sont des instanciations valides de `List<T>` .</span><span class="sxs-lookup"><span data-stu-id="5a96d-207">Both `List<string?>` and `List<int?>` are valid instantiations of `List<T>`.</span></span>

<span data-ttu-id="5a96d-208">Cela signifie que vous ne pouvez pas utiliser `T?` dans une déclaration de classe ou de méthode générique sans contraintes.</span><span class="sxs-lookup"><span data-stu-id="5a96d-208">What it does mean is that you can't use `T?` in a generic class or method declaration without constraints.</span></span> <span data-ttu-id="5a96d-209">Par exemple, <xref:System.Linq.Enumerable.FirstOrDefault%60%601(System.Collections.Generic.IEnumerable%7B%60%600%7D)?displayProperty=nameWithType> ne peut pas être modifié pour retourner `T?` .</span><span class="sxs-lookup"><span data-stu-id="5a96d-209">For example, <xref:System.Linq.Enumerable.FirstOrDefault%60%601(System.Collections.Generic.IEnumerable%7B%60%600%7D)?displayProperty=nameWithType> won't be changed to return `T?`.</span></span> <span data-ttu-id="5a96d-210">Vous pouvez contourner cette limitation en ajoutant la `struct` `class` contrainte ou.</span><span class="sxs-lookup"><span data-stu-id="5a96d-210">You can overcome this limitation by adding either the `struct` or `class` constraint.</span></span> <span data-ttu-id="5a96d-211">Avec l’une de ces contraintes, le compilateur sait comment générer du code pour `T` et `T?` .</span><span class="sxs-lookup"><span data-stu-id="5a96d-211">With either of those constraints, the compiler knows how to generate code for both `T` and `T?`.</span></span>

<span data-ttu-id="5a96d-212">Vous pouvez restreindre les types utilisés pour un argument de type générique à des types non nullables.</span><span class="sxs-lookup"><span data-stu-id="5a96d-212">You may want to restrict the types used for a generic type argument to be non-nullable types.</span></span> <span data-ttu-id="5a96d-213">Pour ce faire, vous pouvez ajouter la `notnull` contrainte sur cet argument de type.</span><span class="sxs-lookup"><span data-stu-id="5a96d-213">You can do that by adding the `notnull` constraint on that type argument.</span></span> <span data-ttu-id="5a96d-214">Quand cette contrainte est appliquée, l’argument de type ne doit pas être un type Nullable.</span><span class="sxs-lookup"><span data-stu-id="5a96d-214">When that constraint is applied, the type argument must not be a nullable type.</span></span>

## <a name="late-initialized-properties-data-transfer-objects-and-nullability"></a><span data-ttu-id="5a96d-215">Propriétés initialisées tardivement, objets Transfert de données et possibilité de valeur null</span><span class="sxs-lookup"><span data-stu-id="5a96d-215">Late-initialized properties, Data Transfer Objects, and nullability</span></span>

<span data-ttu-id="5a96d-216">Indiquant la possibilité de valeur null des propriétés qui sont initialisées tardivement, ce qui signifie qu’elles sont définies après la construction, peut nécessiter une attention particulière afin de garantir que votre classe continue d’exprimer correctement l’intention de conception d’origine.</span><span class="sxs-lookup"><span data-stu-id="5a96d-216">Indicating the nullability of properties that are late-initialized, meaning set after construction, may require special consideration to ensure that your class continues to correctly express the original design intent.</span></span>

<span data-ttu-id="5a96d-217">Les types qui contiennent des propriétés initialisées tardivement, telles que les objets Transfert de données (DTO), sont souvent instanciés par une bibliothèque externe, comme un ORM de base de données (mappage relationnel d’objets), un désérialiseur ou un autre composant qui remplit automatiquement les propriétés d’une autre source.</span><span class="sxs-lookup"><span data-stu-id="5a96d-217">Types that contain late-initialized properties, such as Data Transfer Objects (DTOs), are often instantiated by an external library, like a database ORM (Object Relational Mapper), a deserializer, or some other component that automatically populates properties from another source.</span></span>

<span data-ttu-id="5a96d-218">Considérez la classe DTO suivante, avant d’activer les types de référence Nullable, qui représente un Student :</span><span class="sxs-lookup"><span data-stu-id="5a96d-218">Consider the following DTO class, prior to enabling nullable reference types, that represents a student:</span></span>

```csharp
class Student
{
    [Required]
    public string FirstName { get; set; }

    [Required]
    public string LastName { get; set; }

    public string VehicleRegistration { get; set; }
}
```

<span data-ttu-id="5a96d-219">L’intention de conception (indiquée dans ce cas par l' `Required` attribut) suggère que dans ce système, `FirstName` les `LastName` Propriétés et sont **obligatoires** et, par conséquent, non null.</span><span class="sxs-lookup"><span data-stu-id="5a96d-219">The design intent (indicated in this case by the `Required` attribute) suggests that in this system, the `FirstName` and `LastName` properties are **mandatory**, and therefore not null.</span></span>

<span data-ttu-id="5a96d-220">La `VehicleRegistration` propriété n’étant **pas obligatoire**, elle peut avoir la valeur null.</span><span class="sxs-lookup"><span data-stu-id="5a96d-220">The `VehicleRegistration` property is **not mandatory**, so may be null.</span></span>

<span data-ttu-id="5a96d-221">Lorsque vous activez les types de référence Nullable, vous souhaitez indiquer quelles propriétés de votre DTO peuvent être Nullable, conformément à votre intention d’origine :</span><span class="sxs-lookup"><span data-stu-id="5a96d-221">When you enable nullable reference types, you want to indicate which properties on your DTO may be nullable, consistent with your original intent:</span></span>

```csharp
class Student
{
    [Required]
    public string FirstName { get; set; }

    [Required]
    public string LastName { get; set; }

    public string? VehicleRegistration { get; set; }
}
```

<span data-ttu-id="5a96d-222">Pour ce DTO, la seule propriété qui peut être null est ``VehicleRegistration`` .</span><span class="sxs-lookup"><span data-stu-id="5a96d-222">For this DTO, the only property that may be null is ``VehicleRegistration``.</span></span>

<span data-ttu-id="5a96d-223">Toutefois, le compilateur déclenche `CS8618` des avertissements pour `FirstName` et `LastName` , indiquant que les propriétés non Nullable ne sont pas initialisées.</span><span class="sxs-lookup"><span data-stu-id="5a96d-223">However, the compiler raises `CS8618` warnings for both `FirstName` and `LastName`, indicating the non-nullable properties are uninitialized.</span></span>

<span data-ttu-id="5a96d-224">Trois options sont à votre disposition pour résoudre les avertissements du compilateur de manière à conserver l’intention d’origine.</span><span class="sxs-lookup"><span data-stu-id="5a96d-224">There are three options available to you that resolve the compiler warnings in a way that maintains the original intent.</span></span> <span data-ttu-id="5a96d-225">L’une de ces options est valide. vous devez choisir celui qui convient le mieux à vos exigences de style et de conception de codage.</span><span class="sxs-lookup"><span data-stu-id="5a96d-225">Any of these options are valid; you should choose the one that best suits your coding style and design requirements.</span></span>

### <a name="initialize-in-the-constructor"></a><span data-ttu-id="5a96d-226">Initialiser dans le constructeur</span><span class="sxs-lookup"><span data-stu-id="5a96d-226">Initialize in the constructor</span></span>

<span data-ttu-id="5a96d-227">Pour résoudre les avertissements non initialisés, la méthode idéale consiste à initialiser les propriétés dans le constructeur :</span><span class="sxs-lookup"><span data-stu-id="5a96d-227">The ideal way to resolve the uninitialized warnings is to initialize the properties in the constructor:</span></span>

```csharp
class Student
{
    public Student(string firstName, string lastName)
    {
        FirstName = firstName;
        LastName = lastName;
    }

    [Required]
    public string FirstName { get; set; }

    [Required]
    public string LastName { get; set; }

    public string? VehicleRegistration { get; set; }
}
```

<span data-ttu-id="5a96d-228">Cette approche fonctionne uniquement si la bibliothèque que vous utilisez pour instancier la classe prend en charge le passage de paramètres dans le constructeur.</span><span class="sxs-lookup"><span data-stu-id="5a96d-228">This approach only works if the library that you use to instantiate the class supports passing parameters in the constructor.</span></span>

<span data-ttu-id="5a96d-229">Une bibliothèque peut prendre en charge la transmission de *certaines* propriétés dans le constructeur, mais pas toutes.</span><span class="sxs-lookup"><span data-stu-id="5a96d-229">A library may support passing *some* properties in the constructor, but not all.</span></span> <span data-ttu-id="5a96d-230">Par exemple, EF Core prend en charge la [liaison de constructeur](/ef/core/modeling/constructors) pour les propriétés de colonne normales, mais pas pour les propriétés de navigation.</span><span class="sxs-lookup"><span data-stu-id="5a96d-230">For example, EF Core supports [constructor binding](/ef/core/modeling/constructors) for normal column properties, but not navigation properties.</span></span>

<span data-ttu-id="5a96d-231">Consultez la documentation sur la bibliothèque qui instancie votre classe pour comprendre la portée à laquelle elle prend en charge la liaison de constructeur.</span><span class="sxs-lookup"><span data-stu-id="5a96d-231">Check the documentation on the library that instantiates your class, to understand the extent to which it supports constructor binding.</span></span>

### <a name="property-with-nullable-backing-field"></a><span data-ttu-id="5a96d-232">Propriété avec champ de stockage Nullable</span><span class="sxs-lookup"><span data-stu-id="5a96d-232">Property with nullable backing field</span></span>

<span data-ttu-id="5a96d-233">Si la liaison de constructeur ne fonctionne pas pour vous, une façon de traiter ce problème consiste à avoir une propriété qui n’accepte pas les valeurs NULL avec un champ de stockage Nullable :</span><span class="sxs-lookup"><span data-stu-id="5a96d-233">If constructor binding won't work for you, one way to deal with this problem is to have a non-nullable property with a nullable backing field:</span></span>

```csharp
private string? _firstName;

[Required]
public string FirstName
{
    set => _firstName = value;
    get => _firstName
           ?? throw new InvalidOperationException("Uninitialized " + nameof(FirstName))
}
```

<span data-ttu-id="5a96d-234">Dans ce scénario, si `FirstName` vous accédez à la propriété avant qu’elle n’ait été initialisée, le code lève une `InvalidOperationException` , car le contrat d’API a été utilisé de façon incorrecte.</span><span class="sxs-lookup"><span data-stu-id="5a96d-234">In this scenario, if the `FirstName` property is accessed before it has been initialized, then the code throws an `InvalidOperationException`, because the API contract has been used incorrectly.</span></span>

<span data-ttu-id="5a96d-235">Sachez que certaines bibliothèques peuvent avoir des considérations particulières lors de l’utilisation de champs de stockage.</span><span class="sxs-lookup"><span data-stu-id="5a96d-235">Consider that some libraries may have special considerations when using backing fields.</span></span> <span data-ttu-id="5a96d-236">Par exemple, EF Core devrez peut-être être configuré pour utiliser correctement les [champs de sauvegarde](/ef/core/modeling/backing-field) .</span><span class="sxs-lookup"><span data-stu-id="5a96d-236">For example, EF Core may need to be configured to use [backing fields](/ef/core/modeling/backing-field) correctly.</span></span>

### <a name="initialize-the-property-to-null"></a><span data-ttu-id="5a96d-237">Initialise la propriété avec la valeur null</span><span class="sxs-lookup"><span data-stu-id="5a96d-237">Initialize the property to null</span></span>

<span data-ttu-id="5a96d-238">Comme une alternative terser à l’utilisation d’un champ de stockage Nullable, ou si la bibliothèque qui instancie votre classe n’est pas compatible avec cette approche, vous pouvez initialiser la propriété `null` directement, à l’aide de l’opérateur null-indulgent avec ( `!` ) :</span><span class="sxs-lookup"><span data-stu-id="5a96d-238">As a terser alternative to using a nullable backing field, or if the library that instantiates your class isn't compatible with that approach, you can initialize the property to `null` directly, with the help of the null-forgiving operator (`!`):</span></span>

```csharp
[Required]
public string FirstName { get; set; } = null!;

[Required]
public string LastName { get; set; } = null!;

public string? VehicleRegistration { get; set; }
```

<span data-ttu-id="5a96d-239">Vous n’observerez jamais une valeur null réelle au moment de l’exécution sauf en raison d’un bogue de programmation, en accédant à la propriété avant qu’elle ait été correctement initialisée.</span><span class="sxs-lookup"><span data-stu-id="5a96d-239">You'll never observe an actual null value at runtime except as a result of a programming bug, by accessing the property before it has been properly initialized.</span></span>

## <a name="see-also"></a><span data-ttu-id="5a96d-240">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="5a96d-240">See also</span></span>

- [<span data-ttu-id="5a96d-241">Migration d’une base de code existante vers des références nullables</span><span class="sxs-lookup"><span data-stu-id="5a96d-241">Migrate an existing codebase to nullable references</span></span>](tutorials/upgrade-to-nullable-references.md)
- [<span data-ttu-id="5a96d-242">Utilisation des types de référence Nullable dans EF Core</span><span class="sxs-lookup"><span data-stu-id="5a96d-242">Working with Nullable Reference Types in EF Core</span></span>](/ef/core/miscellaneous/nullable-reference-types)

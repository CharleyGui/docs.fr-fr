---
title: Guide pratique pour caster de manière sécurisée avec les critères spéciaux, ainsi que les opérateurs is et as
description: Découvrez les techniques relatives aux critères spéciaux pour caster de manière sécurisée des variables vers un autre type. Vous pouvez utiliser les critères spéciaux, ainsi que les opérateurs is et as pour convertir des types de manière sécurisée.
ms.date: 09/05/2018
helpviewer_keywords:
- cast operators [C#], as and is operators
- as operator [C#]
- is operator [C#]
ms.openlocfilehash: 8d090df1338c535b11a7fd3ec32f6d1cb00b338f
ms.sourcegitcommit: 22be09204266253d45ece46f51cc6f080f2b3fd6
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/07/2019
ms.locfileid: "73739683"
---
# <a name="how-to-safely-cast-by-using-pattern-matching-and-the-is-and-as-operators"></a><span data-ttu-id="52c2d-104">Guide pratique pour caster de manière sécurisée avec les critères spéciaux, ainsi que les opérateurs is et as</span><span class="sxs-lookup"><span data-stu-id="52c2d-104">How to: safely cast by using pattern matching and the is and as operators</span></span>

<span data-ttu-id="52c2d-105">Dans la mesure où les objets sont polymorphes, une variable d’un type de classe de base peut contenir un [type](../programming-guide/types/index.md) dérivé.</span><span class="sxs-lookup"><span data-stu-id="52c2d-105">Because objects are polymorphic, it's possible for a variable of a base class type to hold a derived [type](../programming-guide/types/index.md).</span></span> <span data-ttu-id="52c2d-106">Pour accéder aux membres d’instance du type dérivé, il est nécessaire de réeffectuer un [cast](../programming-guide/types/casting-and-type-conversions.md) de la valeur vers le type dérivé.</span><span class="sxs-lookup"><span data-stu-id="52c2d-106">To access the derived type's instance members, it's necessary to [cast](../programming-guide/types/casting-and-type-conversions.md) the value back to the derived type.</span></span> <span data-ttu-id="52c2d-107">Toutefois, un cast risque de lever <xref:System.InvalidCastException>.</span><span class="sxs-lookup"><span data-stu-id="52c2d-107">However, a cast creates the risk of throwing an <xref:System.InvalidCastException>.</span></span> <span data-ttu-id="52c2d-108">C# fournit des instructions relatives aux [critères spéciaux](../pattern-matching.md), qui effectuent un cast de manière conditionnelle, uniquement en cas de réussite.</span><span class="sxs-lookup"><span data-stu-id="52c2d-108">C# provides [pattern matching](../pattern-matching.md) statements that perform a cast conditionally only when it will succeed.</span></span> <span data-ttu-id="52c2d-109">C# fournit également les opérateurs [is](../language-reference/operators/type-testing-and-cast.md#is-operator) et [as](../language-reference/operators/type-testing-and-cast.md#as-operator) pour tester l’appartenance d’une valeur à un certain type.</span><span class="sxs-lookup"><span data-stu-id="52c2d-109">C# also provides the [is](../language-reference/operators/type-testing-and-cast.md#is-operator) and [as](../language-reference/operators/type-testing-and-cast.md#as-operator) operators to test if a value is of a certain type.</span></span>

<span data-ttu-id="52c2d-110">Le code suivant illustre l’instruction `is` relative aux critères spéciaux.</span><span class="sxs-lookup"><span data-stu-id="52c2d-110">The following code demonstrates the pattern matching `is` statement.</span></span> <span data-ttu-id="52c2d-111">Il contient des méthodes qui testent un argument de méthode pour déterminer s’il s’agit d’un ensemble possible de types dérivés :</span><span class="sxs-lookup"><span data-stu-id="52c2d-111">It contains methods that test a method argument to determine if it is one of a possible set of derived types:</span></span>

[!code-csharp[Pattern matching is statement](../../../samples/snippets/csharp/how-to/safelycast/patternmatching/Program.cs#PatternMatchingIs)]

<span data-ttu-id="52c2d-112">L’exemple précédent illustre quelques fonctionnalités de la syntaxe relative aux critères spéciaux.</span><span class="sxs-lookup"><span data-stu-id="52c2d-112">The preceding sample demonstrates a few features of pattern matching syntax.</span></span> <span data-ttu-id="52c2d-113">Les instructions `if (a is Mammal m)` et `if (o is Mammal m)` combinent le test à une assignation d’initialisation.</span><span class="sxs-lookup"><span data-stu-id="52c2d-113">The `if (a is Mammal m)` and `if (o is Mammal m)` statements combine the test with an initialization assignment.</span></span> <span data-ttu-id="52c2d-114">L’assignation n’a lieu qu’en cas de réussite du test.</span><span class="sxs-lookup"><span data-stu-id="52c2d-114">The assignment occurs only when the test succeeds.</span></span> <span data-ttu-id="52c2d-115">La variable `m` se trouve uniquement dans l’étendue de l’instruction `if` incorporée, à laquelle elle a été assignée.</span><span class="sxs-lookup"><span data-stu-id="52c2d-115">The variable `m` is only in scope in the embedded `if` statement where it has been assigned.</span></span> <span data-ttu-id="52c2d-116">Vous ne pouvez pas accéder à `m` plus tard dans la même méthode.</span><span class="sxs-lookup"><span data-stu-id="52c2d-116">You cannot access `m` later in the same method.</span></span> <span data-ttu-id="52c2d-117">Faites un essai dans la fenêtre interactive.</span><span class="sxs-lookup"><span data-stu-id="52c2d-117">Try it in the interactive window.</span></span>

<span data-ttu-id="52c2d-118">Vous pouvez également utiliser la même syntaxe pour le test si un [type valeur Nullable](../language-reference/builtin-types/nullable-value-types.md) a une valeur, comme indiqué dans l’exemple de code suivant :</span><span class="sxs-lookup"><span data-stu-id="52c2d-118">You can also use the same syntax for testing if a [nullable value type](../language-reference/builtin-types/nullable-value-types.md) has a value, as shown in the following sample code:</span></span>

[!code-csharp[Pattern matching with nullable types](../../../samples/snippets/csharp/how-to/safelycast/nullablepatternmatching/Program.cs#PatternMatchingNullable)]

<span data-ttu-id="52c2d-119">L’exemple précédent illustre d’autres fonctionnalités relatives aux critères spéciaux pour les conversions.</span><span class="sxs-lookup"><span data-stu-id="52c2d-119">The preceding sample demonstrates other features of pattern matching to use with conversions.</span></span> <span data-ttu-id="52c2d-120">Vous pouvez tester le modèle null d’une variable en vérifiant spécifiquement la valeur `null`.</span><span class="sxs-lookup"><span data-stu-id="52c2d-120">You can test a variable for the null pattern by checking specifically for the `null` value.</span></span> <span data-ttu-id="52c2d-121">Quand la valeur runtime de la variable est `null`, une instruction `is` de vérification de type retourne toujours `false`.</span><span class="sxs-lookup"><span data-stu-id="52c2d-121">When the runtime value of the variable is `null`, an `is` statement checking for a type always returns `false`.</span></span> <span data-ttu-id="52c2d-122">L’instruction `is` relative aux critères spéciaux n’autorise aucun type valeur Nullable, par exemple `int?` ou `Nullable<int>`. Toutefois, vous pouvez tester un autre type valeur.</span><span class="sxs-lookup"><span data-stu-id="52c2d-122">The pattern matching `is` statement doesn't allow a nullable value type, such as `int?` or `Nullable<int>`, but you can test for any other value type.</span></span> <span data-ttu-id="52c2d-123">Les modèles de `is` de l’exemple précédent ne sont pas limités aux types valeur Nullable.</span><span class="sxs-lookup"><span data-stu-id="52c2d-123">The `is` patterns from the preceding example are not limited to the nullable value types.</span></span> <span data-ttu-id="52c2d-124">Vous pouvez également utiliser ces modèles pour tester si une variable d’un type de référence a une valeur ou si elle est `null`.</span><span class="sxs-lookup"><span data-stu-id="52c2d-124">You also can use those patterns to test if a variable of a reference type has a value or it's `null`.</span></span>

<span data-ttu-id="52c2d-125">L’exemple précédent montre également comment utiliser l’expression `is` relative aux critères spéciaux dans une instruction `switch`, où la variable peut avoir plusieurs types différents.</span><span class="sxs-lookup"><span data-stu-id="52c2d-125">The preceding sample also shows how you use the pattern matching `is` expression in a `switch` statement where the variable may be one of many different types.</span></span>

<span data-ttu-id="52c2d-126">Pour déterminer si une variable a un type donné, mais sans l’assigner pour autant à une nouvelle variable, vous pouvez utiliser les opérateurs `is` et `as` pour les types référence et les types Nullable.</span><span class="sxs-lookup"><span data-stu-id="52c2d-126">If you want to test if a variable is a given type, but not assign it to a new variable, you can use the `is` and `as` operators for reference types and nullable types.</span></span> <span data-ttu-id="52c2d-127">Le code suivant montre comment utiliser les instructions `is` et `as`, qui faisaient partie du langage C# avant l’introduction des critères spéciaux permettant de déterminer l’existence ou non d’un type donné pour une variable :</span><span class="sxs-lookup"><span data-stu-id="52c2d-127">The following code shows how to use the `is` and `as` statements that were part of the C# language before pattern matching was introduced to test if a variable is of a given type:</span></span>

[!code-csharp[testing variable types with the is and as statements](../../../samples/snippets/csharp/how-to/safelycast/asandis/Program.cs#IsAndAs)]

<span data-ttu-id="52c2d-128">Comme vous pouvez le constater en comparant ce code avec le code utilisant les critères spéciaux, la syntaxe des critères spéciaux fournit des fonctionnalités plus robustes, car elle combine le test et l’assignation dans une seule instruction.</span><span class="sxs-lookup"><span data-stu-id="52c2d-128">As you can see by comparing this code with the pattern matching code, the pattern matching syntax provides more robust features by combining the test and the assignment in a single statement.</span></span> <span data-ttu-id="52c2d-129">Utilisez la syntaxe des critères spéciaux autant que possible.</span><span class="sxs-lookup"><span data-stu-id="52c2d-129">Use the pattern matching syntax whenever possible.</span></span>

<span data-ttu-id="52c2d-130">Vous pouvez essayer ces exemples en examinant le code dans notre [dépôt GitHub](https://github.com/dotnet/samples/tree/master/snippets/csharp/how-to/safelycast).</span><span class="sxs-lookup"><span data-stu-id="52c2d-130">You can try these samples by looking at the code in our [GitHub repository](https://github.com/dotnet/samples/tree/master/snippets/csharp/how-to/safelycast).</span></span> <span data-ttu-id="52c2d-131">Vous pouvez aussi télécharger les exemples [sous forme de fichier zip](https://github.com/dotnet/samples/raw/master/snippets/csharp/how-to/safelycast.zip).</span><span class="sxs-lookup"><span data-stu-id="52c2d-131">Or you can download the samples [as a zip file](https://github.com/dotnet/samples/raw/master/snippets/csharp/how-to/safelycast.zip).</span></span>

---
title: Types référence Nullable-référence C#
description: En savoir plus sur les types de référence Nullable C# et leur utilisation
ms.date: 04/06/2020
ms.openlocfilehash: d961af9ba3b4776e6b4ec3eeea5392fb0d0394ce
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/18/2020
ms.locfileid: "94822423"
---
# <a name="nullable-reference-types-c-reference"></a><span data-ttu-id="096d1-103">Types référence Nullable (référence C#)</span><span class="sxs-lookup"><span data-stu-id="096d1-103">Nullable reference types (C# reference)</span></span>

> [!NOTE]
> <span data-ttu-id="096d1-104">Cet article traite des types de référence Nullable.</span><span class="sxs-lookup"><span data-stu-id="096d1-104">This article covers nullable reference types.</span></span> <span data-ttu-id="096d1-105">Vous pouvez également déclarer des [types valeur Nullable](nullable-value-types.md).</span><span class="sxs-lookup"><span data-stu-id="096d1-105">You can also declare [nullable value types](nullable-value-types.md).</span></span>

<span data-ttu-id="096d1-106">Les types référence Nullable sont disponibles à partir de C# 8,0, dans le code qui a opté pour un *contexte reconnaissant* la valeur null.</span><span class="sxs-lookup"><span data-stu-id="096d1-106">Nullable reference types are available beginning with C# 8.0, in code that has opted in to a *nullable aware context*.</span></span> <span data-ttu-id="096d1-107">Les types de référence Nullable, les avertissements d’analyse statique null et l' [opérateur null-indulgent avec](../operators/null-forgiving.md) sont des fonctionnalités de langage facultatives.</span><span class="sxs-lookup"><span data-stu-id="096d1-107">Nullable reference types, the null static analysis warnings, and the [null-forgiving operator](../operators/null-forgiving.md) are optional language features.</span></span> <span data-ttu-id="096d1-108">Tous sont désactivés par défaut.</span><span class="sxs-lookup"><span data-stu-id="096d1-108">All are turned off by default.</span></span> <span data-ttu-id="096d1-109">Un *contexte Nullable* est contrôlé au niveau du projet à l’aide des paramètres de génération, ou dans le code à l’aide de pragmas.</span><span class="sxs-lookup"><span data-stu-id="096d1-109">A *nullable context* is controlled at the project level using build settings, or in code using pragmas.</span></span>

 <span data-ttu-id="096d1-110">Dans un contexte qui prend en charge la valeur NULL :</span><span class="sxs-lookup"><span data-stu-id="096d1-110">In a nullable aware context:</span></span>

- <span data-ttu-id="096d1-111">Une variable d’un type référence `T` doit être initialisée avec une valeur non null et ne peut jamais être assignée à une valeur qui peut être `null` .</span><span class="sxs-lookup"><span data-stu-id="096d1-111">A variable of a reference type `T` must be initialized with non-null, and may never be assigned a value that may be `null`.</span></span>
- <span data-ttu-id="096d1-112">Une variable d’un type référence `T?` peut être initialisée avec `null` ou assignée `null` , mais doit être vérifiée `null` avant d’être déréférencée.</span><span class="sxs-lookup"><span data-stu-id="096d1-112">A variable of a reference type `T?` may be initialized with `null` or assigned `null`, but is required to be checked against `null` before de-referencing.</span></span>
- <span data-ttu-id="096d1-113">Une variable `m` de type `T?` est considérée comme non NULL lorsque vous appliquez l’opérateur null-indulgent avec, comme dans `m!` .</span><span class="sxs-lookup"><span data-stu-id="096d1-113">A variable `m` of type `T?` is considered to be non-null when you apply the null-forgiving operator, as in `m!`.</span></span>

<span data-ttu-id="096d1-114">Les différences entre un type de référence non Nullable `T` et un type de référence Nullable `T?` sont appliquées par l’interprétation du compilateur des règles précédentes.</span><span class="sxs-lookup"><span data-stu-id="096d1-114">The distinctions between a non-nullable reference type `T` and a nullable reference type `T?` are enforced by the compiler's interpretation of the preceding rules.</span></span> <span data-ttu-id="096d1-115">Une variable de type `T` et une variable de type `T?` sont représentées par le même type .net.</span><span class="sxs-lookup"><span data-stu-id="096d1-115">A variable of type `T` and a variable of type `T?` are represented by the same .NET type.</span></span> <span data-ttu-id="096d1-116">L’exemple suivant déclare une chaîne non Nullable et une chaîne Nullable, puis utilise l’opérateur null-indulgent avec pour assigner une valeur à une chaîne qui n’accepte pas les valeurs NULL :</span><span class="sxs-lookup"><span data-stu-id="096d1-116">The following example declares a non-nullable string and a nullable string, and then uses the null-forgiving operator to assign a value to a non-nullable string:</span></span>

:::code language="csharp" source="snippets/shared/NullableReferenceTypes.cs" id="SnippetCoreSyntax":::

<span data-ttu-id="096d1-117">Les variables `notNull` et `nullable` sont toutes les deux représentées par le <xref:System.String> type.</span><span class="sxs-lookup"><span data-stu-id="096d1-117">The variables `notNull` and `nullable` are both represented by the <xref:System.String> type.</span></span> <span data-ttu-id="096d1-118">Étant donné que les types non Nullable et Nullable sont tous deux stockés sous le même type, il existe plusieurs emplacements où l’utilisation d’un type de référence Nullable n’est pas autorisée.</span><span class="sxs-lookup"><span data-stu-id="096d1-118">Because the non-nullable and nullable types are both stored as the same type, there are several locations where using a nullable reference type isn't allowed.</span></span> <span data-ttu-id="096d1-119">En général, un type de référence Nullable ne peut pas être utilisé comme classe de base ou comme interface implémentée.</span><span class="sxs-lookup"><span data-stu-id="096d1-119">In general, a nullable reference type can't be used as a base class or implemented interface.</span></span> <span data-ttu-id="096d1-120">Un type de référence Nullable ne peut pas être utilisé dans une expression de création d’objet ou de test de type.</span><span class="sxs-lookup"><span data-stu-id="096d1-120">A nullable reference type can't be used in any object creation or type testing expression.</span></span> <span data-ttu-id="096d1-121">Un type de référence Nullable ne peut pas être le type d’une expression d’accès de membre.</span><span class="sxs-lookup"><span data-stu-id="096d1-121">A nullable reference type can't be the type of a member access expression.</span></span> <span data-ttu-id="096d1-122">Les exemples suivants illustrent ces constructions :</span><span class="sxs-lookup"><span data-stu-id="096d1-122">The following examples show these constructs:</span></span>

```csharp
public MyClass : System.Object? // not allowed
{
}

var nullEmpty = System.String?.Empty; // Not allowed
var maybeObject = new object?(); // Not allowed
try
{
    if (thing is string? nullableString) // not allowed
        Console.WriteLine(nullableString);
} catch (Exception? e) // Not Allowed
{
    Console.WriteLine("error");
}
```

## <a name="nullable-references-and-static-analysis"></a><span data-ttu-id="096d1-123">Références Nullable et analyse statique</span><span class="sxs-lookup"><span data-stu-id="096d1-123">Nullable references and static analysis</span></span>

<span data-ttu-id="096d1-124">Les exemples de la section précédente illustrent la nature des types de référence Nullable.</span><span class="sxs-lookup"><span data-stu-id="096d1-124">The examples in the previous section illustrate the nature of nullable reference types.</span></span> <span data-ttu-id="096d1-125">Les types de référence Nullable ne sont pas de nouveaux types de classe, mais plutôt des annotations sur les types de référence existants.</span><span class="sxs-lookup"><span data-stu-id="096d1-125">Nullable reference types aren't new class types, but rather annotations on existing reference types.</span></span> <span data-ttu-id="096d1-126">Le compilateur utilise ces annotations pour vous aider à identifier les erreurs de référence null potentielles dans votre code.</span><span class="sxs-lookup"><span data-stu-id="096d1-126">The compiler uses those annotations to help you find potential null reference errors in your code.</span></span> <span data-ttu-id="096d1-127">Il n’existe aucune différence d’exécution entre un type de référence non Nullable et un type de référence Nullable.</span><span class="sxs-lookup"><span data-stu-id="096d1-127">There's no runtime difference between a non-nullable reference type and a nullable reference type.</span></span> <span data-ttu-id="096d1-128">Le compilateur n’ajoute pas de vérification du runtime pour les types de référence non Nullable.</span><span class="sxs-lookup"><span data-stu-id="096d1-128">The compiler doesn't add any runtime checking for non-nullable reference types.</span></span> <span data-ttu-id="096d1-129">Les avantages sont liés à l’analyse au moment de la compilation.</span><span class="sxs-lookup"><span data-stu-id="096d1-129">The benefits are in the compile-time analysis.</span></span> <span data-ttu-id="096d1-130">Le compilateur génère des avertissements qui vous aident à trouver et à corriger les erreurs null potentielles dans votre code.</span><span class="sxs-lookup"><span data-stu-id="096d1-130">The compiler generates warnings that help you find and fix potential null errors in your code.</span></span> <span data-ttu-id="096d1-131">Vous déclarez votre intention et le compilateur vous avertit lorsque votre code viole cet objectif.</span><span class="sxs-lookup"><span data-stu-id="096d1-131">You declare your intent, and the compiler warns you when your code violates that intent.</span></span>

<span data-ttu-id="096d1-132">Dans un contexte activé avec la valeur null, le compilateur effectue une analyse statique sur les variables de tout type référence, à la fois Nullable et non Nullable.</span><span class="sxs-lookup"><span data-stu-id="096d1-132">In a nullable enabled context, the compiler performs static analysis on variables of any reference type, both nullable and non-nullable.</span></span> <span data-ttu-id="096d1-133">Le compilateur effectue le suivi de l’État null de chaque variable de référence comme *not null* ou *peut être null*.</span><span class="sxs-lookup"><span data-stu-id="096d1-133">The compiler tracks the null state of each reference variable as either *not null* or *maybe null*.</span></span> <span data-ttu-id="096d1-134">L’État par défaut d’une référence qui n’accepte pas les valeurs NULL n’est *pas null*.</span><span class="sxs-lookup"><span data-stu-id="096d1-134">The default state of a non-nullable reference is *not null*.</span></span> <span data-ttu-id="096d1-135">L’État par défaut d’une référence Nullable est *peut-être null*.</span><span class="sxs-lookup"><span data-stu-id="096d1-135">The default state of a nullable reference is *maybe null*.</span></span>

<span data-ttu-id="096d1-136">Les types référence non Nullable doivent toujours être déréférencés, car leur état NULL n’est *pas null*.</span><span class="sxs-lookup"><span data-stu-id="096d1-136">Non-nullable reference types should always be safe to dereference because their null state is *not null*.</span></span> <span data-ttu-id="096d1-137">Pour appliquer cette règle, le compilateur émet des avertissements si un type de référence non Nullable n’est pas initialisé à une valeur non null.</span><span class="sxs-lookup"><span data-stu-id="096d1-137">To enforce that rule, the compiler issues warnings if a non-nullable reference type isn't initialized to a non-null value.</span></span> <span data-ttu-id="096d1-138">Les variables locales doivent être assignées là où elles sont déclarées.</span><span class="sxs-lookup"><span data-stu-id="096d1-138">Local variables must be assigned where they're declared.</span></span> <span data-ttu-id="096d1-139">Chaque constructeur doit assigner chaque champ, dans son corps, à un constructeur appelé ou à l’aide d’un initialiseur de champ.</span><span class="sxs-lookup"><span data-stu-id="096d1-139">Every constructor must assign every field, either in its body, a called constructor, or using a field initializer.</span></span> <span data-ttu-id="096d1-140">Le compilateur émet des avertissements si une référence qui n’accepte pas les valeurs NULL est assignée à une référence dont l’État est *peut-être null*.</span><span class="sxs-lookup"><span data-stu-id="096d1-140">The compiler issues warnings if a non-nullable reference is assigned to a reference whose state is *maybe null*.</span></span> <span data-ttu-id="096d1-141">Toutefois, étant donné qu’une référence non Nullable n’est *pas null*, aucun avertissement n’est émis lorsque ces variables sont déréférencées.</span><span class="sxs-lookup"><span data-stu-id="096d1-141">However, because a non-nullable reference is *not null*, no warnings are issued when those variables are de-referenced.</span></span>

<span data-ttu-id="096d1-142">Les types référence Nullable peuvent être initialisés ou assignés à `null` .</span><span class="sxs-lookup"><span data-stu-id="096d1-142">Nullable reference types may be initialized or assigned to `null`.</span></span> <span data-ttu-id="096d1-143">Par conséquent, l’analyse statique doit déterminer qu’une variable n’a *pas la valeur null* avant d’être déréférencée.</span><span class="sxs-lookup"><span data-stu-id="096d1-143">Therefore, static analysis must determine that a variable is *not null* before it's dereferenced.</span></span> <span data-ttu-id="096d1-144">Si une référence Nullable est peut-être *null*, elle ne peut pas être assignée à une variable de référence n’acceptant pas les valeurs NULL.</span><span class="sxs-lookup"><span data-stu-id="096d1-144">If a nullable reference is determined to be *maybe null*, it can't be assigned to a non-nullable reference variable.</span></span> <span data-ttu-id="096d1-145">La classe suivante montre des exemples de ces avertissements :</span><span class="sxs-lookup"><span data-stu-id="096d1-145">The following class shows examples of these warnings:</span></span>

:::code language="csharp" source="snippets/shared/NullableReferenceTypes.cs" id="SnippetClassWithNullable":::

<span data-ttu-id="096d1-146">L’extrait de code suivant indique où le compilateur émet des avertissements lors de l’utilisation de cette classe :</span><span class="sxs-lookup"><span data-stu-id="096d1-146">The following snippet shows where the compiler emits warnings when using this class:</span></span>

:::code language="csharp" source="snippets/shared/NullableReferenceTypes.cs" id="SnippetLocalWarnings":::

<span data-ttu-id="096d1-147">Les exemples précédents illustrent l’analyse statique du compilateur pour déterminer l’État null des variables de référence.</span><span class="sxs-lookup"><span data-stu-id="096d1-147">The preceding examples demonstrate the compiler's static analysis to determine the null state of reference variables.</span></span> <span data-ttu-id="096d1-148">Le compilateur applique des règles de langage pour les vérifications et les assignations null afin d’en informer l’analyse.</span><span class="sxs-lookup"><span data-stu-id="096d1-148">The compiler applies language rules for null checks and assignments to inform its analysis.</span></span>  <span data-ttu-id="096d1-149">Le compilateur ne peut pas faire d’hypothèses sur la sémantique des méthodes ou des propriétés.</span><span class="sxs-lookup"><span data-stu-id="096d1-149">The compiler can't make assumptions about the semantics of methods or properties.</span></span> <span data-ttu-id="096d1-150">Si vous appelez des méthodes qui effectuent des vérifications de valeur null, le compilateur ne peut pas savoir que ces méthodes affectent l’État null d’une variable.</span><span class="sxs-lookup"><span data-stu-id="096d1-150">If you call methods that perform null checks, the compiler can't know those methods affect a variable's null state.</span></span> <span data-ttu-id="096d1-151">Vous pouvez ajouter plusieurs attributs à vos API pour informer le compilateur de la sémantique des arguments et des valeurs de retour.</span><span class="sxs-lookup"><span data-stu-id="096d1-151">There are a number of attributes you can add to your APIs to inform the compiler about the semantics of arguments and return values.</span></span> <span data-ttu-id="096d1-152">Ces attributs ont été appliqués à de nombreuses API communes dans les bibliothèques .NET Core.</span><span class="sxs-lookup"><span data-stu-id="096d1-152">These attributes have been applied to many common APIs in the .NET Core libraries.</span></span> <span data-ttu-id="096d1-153">Par exemple, <xref:System.String.IsNullOrEmpty%2A> a été mis à jour et le compilateur interprète correctement cette méthode comme une vérification de valeur null.</span><span class="sxs-lookup"><span data-stu-id="096d1-153">For example, <xref:System.String.IsNullOrEmpty%2A> has been updated, and the compiler correctly interprets that method as a null check.</span></span> <span data-ttu-id="096d1-154">Pour plus d’informations sur les attributs qui s’appliquent à l’analyse statique d’État null, consultez l’article sur les [attributs Nullable](../attributes/nullable-analysis.md).</span><span class="sxs-lookup"><span data-stu-id="096d1-154">For more information about the attributes that apply to null state static analysis, see the article on [Nullable attributes](../attributes/nullable-analysis.md).</span></span>

## <a name="setting-the-nullable-context"></a><span data-ttu-id="096d1-155">Définition du contexte Nullable</span><span class="sxs-lookup"><span data-stu-id="096d1-155">Setting the nullable context</span></span>

<span data-ttu-id="096d1-156">Il existe deux façons de contrôler le contexte Nullable.</span><span class="sxs-lookup"><span data-stu-id="096d1-156">There are two ways to control the nullable context.</span></span> <span data-ttu-id="096d1-157">Au niveau du projet, vous pouvez ajouter le `<Nullable>enable</Nullable>` paramètre de projet.</span><span class="sxs-lookup"><span data-stu-id="096d1-157">At the project level, you can add the `<Nullable>enable</Nullable>` project setting.</span></span> <span data-ttu-id="096d1-158">Dans un seul fichier source C#, vous pouvez ajouter le `#nullable enable` pragma pour activer le contexte Nullable.</span><span class="sxs-lookup"><span data-stu-id="096d1-158">In a single C# source file, you can add the `#nullable enable` pragma to enable the nullable context.</span></span> <span data-ttu-id="096d1-159">Consultez l’article sur la [définition d’une stratégie Nullable](../../nullable-migration-strategies.md).</span><span class="sxs-lookup"><span data-stu-id="096d1-159">See the article on [setting a nullable strategy](../../nullable-migration-strategies.md).</span></span>

## <a name="c-language-specification"></a><span data-ttu-id="096d1-160">spécification du langage C#</span><span class="sxs-lookup"><span data-stu-id="096d1-160">C# language specification</span></span>

<span data-ttu-id="096d1-161">Pour plus d’informations, consultez les propositions suivantes pour la [spécification du langage C#](~/_csharplang/spec/introduction.md):</span><span class="sxs-lookup"><span data-stu-id="096d1-161">For more information, see the following proposals for the [C# language specification](~/_csharplang/spec/introduction.md):</span></span>

- [<span data-ttu-id="096d1-162">Types références Nullables</span><span class="sxs-lookup"><span data-stu-id="096d1-162">Nullable reference types</span></span>](~/_csharplang/proposals/csharp-8.0/nullable-reference-types.md)
- [<span data-ttu-id="096d1-163">Spécification des types de référence Nullable Draft</span><span class="sxs-lookup"><span data-stu-id="096d1-163">Draft nullable reference types specification</span></span>](~/_csharplang/proposals/csharp-9.0/nullable-reference-types-specification.md)

## <a name="see-also"></a><span data-ttu-id="096d1-164">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="096d1-164">See also</span></span>

- [<span data-ttu-id="096d1-165">Informations de référence sur C#</span><span class="sxs-lookup"><span data-stu-id="096d1-165">C# reference</span></span>](../index.md)
- [<span data-ttu-id="096d1-166">Types valeur Nullable</span><span class="sxs-lookup"><span data-stu-id="096d1-166">Nullable value types</span></span>](nullable-value-types.md)

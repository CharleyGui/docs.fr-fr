---
title: Dépannage des problèmes liés à l'interopérabilité
ms.date: 07/20/2015
helpviewer_keywords:
- interop, deploying assemblies
- assemblies [Visual Basic]
- interop, installing assemblies that share components
- COM objects, troubleshooting
- interop, sharing components
- troubleshooting interoperability [Visual Basic]
- interoperability, troubleshooting
- COM interop [Visual Basic], troubleshooting
- assemblies [Visual Basic], deploying
- troubleshooting Visual Basic, interoperability
- interop assemblies
- interoperability, sharing components
- shared components, using with assemblies
ms.assetid: b324cc1e-b03c-4f39-aea6-6a6d5bfd0e37
ms.openlocfilehash: 344c180cf0b9426898e17b45db768a337fd45beb
ms.sourcegitcommit: 17ee6605e01ef32506f8fdc686954244ba6911de
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/22/2019
ms.locfileid: "74338685"
---
# <a name="troubleshooting-interoperability-visual-basic"></a><span data-ttu-id="328dc-102">Dépannage des problèmes liés à l'interopérabilité (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="328dc-102">Troubleshooting Interoperability (Visual Basic)</span></span>
<span data-ttu-id="328dc-103">Lorsque vous interagissez entre COM et le code managé du .NET Framework, vous pouvez rencontrer un ou plusieurs des problèmes courants suivants.</span><span class="sxs-lookup"><span data-stu-id="328dc-103">When you interoperate between COM and the managed code of the .NET Framework, you may encounter one or more of the following common issues.</span></span>  
  
## <a name="vbconinteroperabilitymarshalinganchor1"></a><span data-ttu-id="328dc-104">Marshaling d’interopérabilité</span><span class="sxs-lookup"><span data-stu-id="328dc-104">Interop Marshaling</span></span>  
 <span data-ttu-id="328dc-105">Parfois, vous devrez peut-être utiliser des types de données qui ne font pas partie du .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="328dc-105">At times, you may have to use data types that are not part of the .NET Framework.</span></span> <span data-ttu-id="328dc-106">Les assemblys d’interopérabilité gèrent la majeure partie du travail pour les objets COM, mais vous devrez peut-être contrôler les types de données utilisés lorsque des objets managés sont exposés à COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-106">Interop assemblies handle most of the work for COM objects, but you may have to control the data types that are used when managed objects are exposed to COM.</span></span> <span data-ttu-id="328dc-107">Par exemple, les structures dans les bibliothèques de classes doivent spécifier le `BStr` type non managé sur les chaînes envoyées aux objets COM créés par Visual Basic 6,0 et versions antérieures.</span><span class="sxs-lookup"><span data-stu-id="328dc-107">For example, structures in class libraries must specify the `BStr` unmanaged type on strings sent to COM objects created by Visual Basic 6.0 and earlier versions.</span></span> <span data-ttu-id="328dc-108">Dans ce cas, vous pouvez utiliser l’attribut <xref:System.Runtime.InteropServices.MarshalAsAttribute> pour faire en sorte que les types managés soient exposés en tant que types non managés.</span><span class="sxs-lookup"><span data-stu-id="328dc-108">In such cases, you can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute to cause managed types to be exposed as unmanaged types.</span></span>  
  
## <a name="vbconinteroperabilitymarshalinganchor2"></a><span data-ttu-id="328dc-109">Exportation de chaînes de longueur fixe vers du code non managé</span><span class="sxs-lookup"><span data-stu-id="328dc-109">Exporting Fixed-Length Strings to Unmanaged Code</span></span>  
 <span data-ttu-id="328dc-110">Dans Visual Basic 6,0 et versions antérieures, les chaînes sont exportées vers les objets COM sous forme de séquences d’octets sans caractère de fin null.</span><span class="sxs-lookup"><span data-stu-id="328dc-110">In Visual Basic 6.0 and earlier versions, strings are exported to COM objects as sequences of bytes without a null termination character.</span></span> <span data-ttu-id="328dc-111">Pour la compatibilité avec d’autres langages, Visual Basic .NET comprend un caractère d’arrêt lors de l’exportation de chaînes.</span><span class="sxs-lookup"><span data-stu-id="328dc-111">For compatibility with other languages, Visual Basic .NET includes a termination character when exporting strings.</span></span> <span data-ttu-id="328dc-112">La meilleure façon de résoudre cette incompatibilité consiste à exporter des chaînes qui n’ont pas de caractère d’arrêt en tant que tableaux de `Byte` ou `Char`.</span><span class="sxs-lookup"><span data-stu-id="328dc-112">The best way to address this incompatibility is to export strings that lack the termination character as arrays of `Byte` or `Char`.</span></span>  
  
## <a name="vbconinteroperabilitymarshalinganchor3"></a><span data-ttu-id="328dc-113">Exportation des hiérarchies d’héritage</span><span class="sxs-lookup"><span data-stu-id="328dc-113">Exporting Inheritance Hierarchies</span></span>  
 <span data-ttu-id="328dc-114">Les hiérarchies de classes managées sont aplaties quand elles sont exposées en tant qu’objets COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-114">Managed class hierarchies flatten out when exposed as COM objects.</span></span> <span data-ttu-id="328dc-115">Par exemple, si vous définissez une classe de base avec un membre, puis que vous héritez de la classe de base dans une classe dérivée qui est exposée en tant qu’objet COM, les clients qui utilisent la classe dérivée dans l’objet COM ne pourront pas utiliser les membres hérités.</span><span class="sxs-lookup"><span data-stu-id="328dc-115">For example, if you define a base class with a member, and then inherit the base class in a derived class that is exposed as a COM object, clients that use the derived class in the COM object will not be able to use the inherited members.</span></span> <span data-ttu-id="328dc-116">Les membres de la classe de base sont accessibles uniquement à partir d’objets COM en tant qu’instances d’une classe de base, puis uniquement si la classe de base est également créée en tant qu’objet COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-116">Base class members can be accessed from COM objects only as instances of a base class, and then only if the base class is also created as a COM object.</span></span>  
  
## <a name="overloaded-methods"></a><span data-ttu-id="328dc-117">Méthodes surchargées</span><span class="sxs-lookup"><span data-stu-id="328dc-117">Overloaded Methods</span></span>  
 <span data-ttu-id="328dc-118">Bien que vous puissiez créer des méthodes surchargées avec Visual Basic, elles ne sont pas prises en charge par COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-118">Although you can create overloaded methods with Visual Basic, they are not supported by COM.</span></span> <span data-ttu-id="328dc-119">Lorsqu’une classe qui contient des méthodes surchargées est exposée en tant qu’objet COM, de nouveaux noms de méthode sont générés pour les méthodes surchargées.</span><span class="sxs-lookup"><span data-stu-id="328dc-119">When a class that contains overloaded methods is exposed as a COM object, new method names are generated for the overloaded methods.</span></span>  
  
 <span data-ttu-id="328dc-120">Par exemple, considérez une classe qui a deux surcharges de la méthode `Synch`.</span><span class="sxs-lookup"><span data-stu-id="328dc-120">For example, consider a class that has two overloads of the `Synch` method.</span></span> <span data-ttu-id="328dc-121">Lorsque la classe est exposée en tant qu’objet COM, les nouveaux noms de méthode générés peuvent être `Synch` et `Synch_2`.</span><span class="sxs-lookup"><span data-stu-id="328dc-121">When the class is exposed as a COM object, the new generated method names could be `Synch` and `Synch_2`.</span></span>  
  
 <span data-ttu-id="328dc-122">Le changement de nom peut entraîner deux problèmes pour les consommateurs de l’objet COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-122">The renaming can cause two problems for consumers of the COM object.</span></span>  
  
1. <span data-ttu-id="328dc-123">Les clients peuvent ne pas s’attendre à recevoir les noms de méthode générés.</span><span class="sxs-lookup"><span data-stu-id="328dc-123">Clients might not expect the generated method names.</span></span>  
  
2. <span data-ttu-id="328dc-124">Les noms de méthode générés dans la classe exposée comme un objet COM peuvent changer quand de nouvelles surcharges sont ajoutées à la classe ou à sa classe de base.</span><span class="sxs-lookup"><span data-stu-id="328dc-124">The generated method names in the class exposed as a COM object can change when new overloads are added to the class or its base class.</span></span> <span data-ttu-id="328dc-125">Cela peut entraîner des problèmes de contrôle de version.</span><span class="sxs-lookup"><span data-stu-id="328dc-125">This can cause versioning problems.</span></span>  
  
 <span data-ttu-id="328dc-126">Pour résoudre les deux problèmes, attribuez un nom unique à chaque méthode, au lieu d’utiliser la surcharge, lorsque vous développez des objets qui seront exposés en tant qu’objets COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-126">To solve both problems, give each method a unique name, instead of using overloading, when you develop objects that will be exposed as COM objects.</span></span>  
  
## <a name="vbconinteroperabilitymarshalinganchor4"></a><span data-ttu-id="328dc-127">Utilisation d’objets COM par le biais d’assemblys d’interopérabilité</span><span class="sxs-lookup"><span data-stu-id="328dc-127">Use of COM Objects Through Interop Assemblies</span></span>  
 <span data-ttu-id="328dc-128">Vous utilisez les assemblys d’interopérabilité presque comme s’il s’agissait de remplacements de code managé pour les objets COM qu’ils représentent.</span><span class="sxs-lookup"><span data-stu-id="328dc-128">You use interop assemblies almost as if they are managed code replacements for the COM objects they represent.</span></span> <span data-ttu-id="328dc-129">Toutefois, étant donné qu’il s’agit de wrappers et non d’objets COM réels, il existe des différences entre l’utilisation des assemblys d’interopérabilité et des assemblys standard.</span><span class="sxs-lookup"><span data-stu-id="328dc-129">However, because they are wrappers and not actual COM objects, there are some differences between using interop assemblies and standard assemblies.</span></span> <span data-ttu-id="328dc-130">Ces zones de différence incluent l’exposition des classes, et les types de données pour les paramètres et les valeurs de retour.</span><span class="sxs-lookup"><span data-stu-id="328dc-130">These areas of difference include the exposure of classes, and data types for parameters and return values.</span></span>  
  
## <a name="vbconinteroperabilitymarshalinganchor5"></a><span data-ttu-id="328dc-131">Classes exposées comme des interfaces et des classes</span><span class="sxs-lookup"><span data-stu-id="328dc-131">Classes Exposed as Both Interfaces and Classes</span></span>  
 <span data-ttu-id="328dc-132">Contrairement aux classes des assemblys standard, les classes COM sont exposées dans les assemblys d’interopérabilité à la fois comme une interface et une classe qui représente la classe COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-132">Unlike classes in standard assemblies, COM classes are exposed in interop assemblies as both an interface and a class that represents the COM class.</span></span> <span data-ttu-id="328dc-133">Le nom de l’interface est identique à celui de la classe COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-133">The interface's name is identical to that of the COM class.</span></span> <span data-ttu-id="328dc-134">Le nom de la classe Interop est le même que celui de la classe COM d’origine, mais avec le mot « Class » ajouté.</span><span class="sxs-lookup"><span data-stu-id="328dc-134">The name of the interop class is the same as that of the original COM class, but with the word "Class" appended.</span></span> <span data-ttu-id="328dc-135">Par exemple, supposons que vous ayez un projet avec une référence à un assembly d’interopérabilité pour un objet COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-135">For example, suppose you have a project with a reference to an interop assembly for a COM object.</span></span> <span data-ttu-id="328dc-136">Si la classe COM est nommée `MyComClass`, IntelliSense et l’Explorateur d’objets affichent une interface nommée `MyComClass` et une classe nommée `MyComClassClass`.</span><span class="sxs-lookup"><span data-stu-id="328dc-136">If the COM class is named `MyComClass`, IntelliSense and the Object Browser show an interface named `MyComClass` and a class named `MyComClassClass`.</span></span>  
  
## <a name="vbconinteroperabilitymarshalinganchor6"></a><span data-ttu-id="328dc-137">Création d’instances d’une classe .NET Framework</span><span class="sxs-lookup"><span data-stu-id="328dc-137">Creating Instances of a .NET Framework Class</span></span>  
 <span data-ttu-id="328dc-138">En général, vous créez une instance d’une classe .NET Framework à l’aide de l’instruction `New` avec un nom de classe.</span><span class="sxs-lookup"><span data-stu-id="328dc-138">Generally, you create an instance of a .NET Framework class using the `New` statement with a class name.</span></span> <span data-ttu-id="328dc-139">Avoir une classe COM représentée par un assembly d’interopérabilité est le seul cas dans lequel vous pouvez utiliser l’instruction `New` avec une interface.</span><span class="sxs-lookup"><span data-stu-id="328dc-139">Having a COM class represented by an interop assembly is the one case in which you can use the `New` statement with an interface.</span></span> <span data-ttu-id="328dc-140">À moins que vous n’utilisiez la classe COM avec une instruction `Inherits`, vous pouvez utiliser l’interface comme vous le feriez pour une classe.</span><span class="sxs-lookup"><span data-stu-id="328dc-140">Unless you are using the COM class with an `Inherits` statement, you can use the interface just as you would a class.</span></span> <span data-ttu-id="328dc-141">Le code suivant montre comment créer un objet `Command` dans un projet qui a une référence à l’objet COM de la bibliothèque 2,8 de Microsoft ActiveX Data Objects :</span><span class="sxs-lookup"><span data-stu-id="328dc-141">The following code demonstrates how to create a `Command` object in a project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object:</span></span>  
  
 [!code-vb[VbVbalrInterop#20](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#20)]  
  
 <span data-ttu-id="328dc-142">Toutefois, si vous utilisez la classe COM comme base pour une classe dérivée, vous devez utiliser la classe Interop qui représente la classe COM, comme dans le code suivant :</span><span class="sxs-lookup"><span data-stu-id="328dc-142">However, if you are using the COM class as the base for a derived class, you must use the interop class that represents the COM class, as in the following code:</span></span>  
  
 [!code-vb[VbVbalrInterop#21](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#21)]  
  
> [!NOTE]
> <span data-ttu-id="328dc-143">Les assemblys d’interopérabilité implémentent implicitement des interfaces qui représentent des classes COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-143">Interop assemblies implicitly implement interfaces that represent COM classes.</span></span> <span data-ttu-id="328dc-144">Vous ne devez pas essayer d’utiliser l’instruction `Implements` pour implémenter ces interfaces, sinon une erreur se produit.</span><span class="sxs-lookup"><span data-stu-id="328dc-144">You should not try to use the `Implements` statement to implement these interfaces or an error will result.</span></span>  
  
## <a name="vbconinteroperabilitymarshalinganchor7"></a><span data-ttu-id="328dc-145">Types de données pour les paramètres et les valeurs de retour</span><span class="sxs-lookup"><span data-stu-id="328dc-145">Data Types for Parameters and Return Values</span></span>  
 <span data-ttu-id="328dc-146">Contrairement aux membres des assemblys standard, les membres d’assembly d’interopérabilité peuvent avoir des types de données qui diffèrent de ceux utilisés dans la déclaration d’objet d’origine.</span><span class="sxs-lookup"><span data-stu-id="328dc-146">Unlike members of standard assemblies, interop assembly members may have data types that differ from those used in the  original object declaration.</span></span> <span data-ttu-id="328dc-147">Bien que les assemblys d’interopérabilité convertissent implicitement les types COM en types de common language runtime compatibles, vous devez prêter attention aux types de données utilisés par les deux côtés pour éviter les erreurs d’exécution.</span><span class="sxs-lookup"><span data-stu-id="328dc-147">Although interop assemblies implicitly convert COM types to compatible common language runtime types, you should pay attention to the data types that are used by both sides to prevent runtime errors.</span></span> <span data-ttu-id="328dc-148">Par exemple, dans les objets COM créés dans Visual Basic 6,0 et versions antérieures, les valeurs de type `Integer` assumer le type équivalent .NET Framework, `Short`.</span><span class="sxs-lookup"><span data-stu-id="328dc-148">For example, in COM objects created in Visual Basic 6.0 and earlier versions, values of type `Integer` assume the .NET Framework equivalent type, `Short`.</span></span> <span data-ttu-id="328dc-149">Il est recommandé d’utiliser l’Explorateur d’objets pour examiner les caractéristiques des membres importés avant de les utiliser.</span><span class="sxs-lookup"><span data-stu-id="328dc-149">It is recommended that you use the Object Browser to examine the characteristics of imported members before you use them.</span></span>  
  
## <a name="vbconinteroperabilitymarshalinganchor8"></a><span data-ttu-id="328dc-150">Méthodes COM au niveau du module</span><span class="sxs-lookup"><span data-stu-id="328dc-150">Module level COM methods</span></span>  
 <span data-ttu-id="328dc-151">La plupart des objets COM sont utilisés en créant une instance d’une classe COM à l’aide du mot clé `New`, puis en appelant les méthodes de l’objet.</span><span class="sxs-lookup"><span data-stu-id="328dc-151">Most COM objects are used by creating an instance of a COM class using the `New` keyword and then calling methods of the object.</span></span> <span data-ttu-id="328dc-152">Une exception à cette règle concerne les objets COM qui contiennent des classes `AppObj` ou `GlobalMultiUse` COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-152">One exception to this rule involves COM objects that contain `AppObj` or `GlobalMultiUse` COM classes.</span></span> <span data-ttu-id="328dc-153">Ces classes ressemblent aux méthodes de niveau module dans Visual Basic les classes .NET.</span><span class="sxs-lookup"><span data-stu-id="328dc-153">Such classes resemble module level methods in Visual Basic .NET classes.</span></span> <span data-ttu-id="328dc-154">Visual Basic 6,0 et les versions antérieures créent implicitement des instances de ces objets pour vous la première fois que vous appelez l’une de leurs méthodes.</span><span class="sxs-lookup"><span data-stu-id="328dc-154">Visual Basic 6.0 and earlier versions implicitly create instances of such objects for you the first time that you call one of their methods.</span></span> <span data-ttu-id="328dc-155">Par exemple, dans Visual Basic 6,0, vous pouvez ajouter une référence à la bibliothèque d’objets Microsoft DAO 3,6 et appeler la méthode `DBEngine` sans créer au préalable une instance :</span><span class="sxs-lookup"><span data-stu-id="328dc-155">For example, in Visual Basic 6.0 you can add a reference to the Microsoft DAO 3.6 Object Library and call the `DBEngine` method without first creating an instance:</span></span>  
  
```vb  
Dim db As DAO.Database  
' Open the database.  
Set db = DBEngine.OpenDatabase("C:\nwind.mdb")  
' Use the database object.  
```  
  
 <span data-ttu-id="328dc-156">Visual Basic .NET requiert que vous soyez toujours en mesure de créer des instances d’objets COM avant de pouvoir utiliser leurs méthodes.</span><span class="sxs-lookup"><span data-stu-id="328dc-156">Visual Basic .NET requires that you always create instances of COM objects before you can use their methods.</span></span> <span data-ttu-id="328dc-157">Pour utiliser ces méthodes dans Visual Basic, déclarez une variable de la classe souhaitée et utilisez le mot clé New pour assigner l’objet à la variable objet.</span><span class="sxs-lookup"><span data-stu-id="328dc-157">To use these methods in Visual Basic, declare a variable of the desired class and use the new keyword to assign the object to the object variable.</span></span> <span data-ttu-id="328dc-158">Vous pouvez utiliser le mot clé `Shared` lorsque vous souhaitez vous assurer qu’une seule instance de la classe est créée.</span><span class="sxs-lookup"><span data-stu-id="328dc-158">The `Shared` keyword can be used when you want to make sure that only one instance of the class is created.</span></span>  
  
 [!code-vb[VbVbalrInterop#23](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#23)]  
  
## <a name="vbconinteroperabilitymarshalinganchor9"></a><span data-ttu-id="328dc-159">Erreurs non gérées dans les gestionnaires d’événements</span><span class="sxs-lookup"><span data-stu-id="328dc-159">Unhandled Errors in Event Handlers</span></span>  
 <span data-ttu-id="328dc-160">Un problème d’interopérabilité courant implique des erreurs dans les gestionnaires d’événements qui gèrent les événements déclenchés par les objets COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-160">One common interop problem involves errors in event handlers that handle events raised by COM objects.</span></span> <span data-ttu-id="328dc-161">Ces erreurs sont ignorées, sauf si vous recherchez spécifiquement des erreurs à l’aide d’instructions `On Error` ou `Try...Catch...Finally`.</span><span class="sxs-lookup"><span data-stu-id="328dc-161">Such errors are ignored unless you specifically check for errors using `On Error` or `Try...Catch...Finally` statements.</span></span> <span data-ttu-id="328dc-162">Par exemple, l’exemple suivant provient d’un projet .NET Visual Basic qui a une référence à l’objet COM de la bibliothèque Microsoft ActiveX Data Objects 2,8.</span><span class="sxs-lookup"><span data-stu-id="328dc-162">For example, the following example is from a Visual Basic .NET project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object.</span></span>  
  
 [!code-vb[VbVbalrInterop#24](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#24)]  
  
 <span data-ttu-id="328dc-163">Cet exemple génère une erreur comme prévu.</span><span class="sxs-lookup"><span data-stu-id="328dc-163">This example raises an error as expected.</span></span> <span data-ttu-id="328dc-164">Toutefois, si vous essayez le même exemple sans le bloc `Try...Catch...Finally`, l’erreur est ignorée comme si vous utilisiez l’instruction `OnError Resume Next`.</span><span class="sxs-lookup"><span data-stu-id="328dc-164">However, if you try the same example without the `Try...Catch...Finally` block, the error is ignored as if you used the `OnError Resume Next` statement.</span></span> <span data-ttu-id="328dc-165">Sans la gestion des erreurs, la division par zéro échoue en silence.</span><span class="sxs-lookup"><span data-stu-id="328dc-165">Without error handling, the division by zero silently fails.</span></span> <span data-ttu-id="328dc-166">Étant donné que ces erreurs ne déclenchent jamais des erreurs d’exception non gérées, il est important d’utiliser une certaine forme de gestion des exceptions dans les gestionnaires d’événements qui gèrent des événements à partir d’objets COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-166">Because such errors never raise unhandled exception errors, it is important that you use some form of exception handling in event handlers that handle events from COM objects.</span></span>  
  
### <a name="understanding-com-interop-errors"></a><span data-ttu-id="328dc-167">Compréhension des erreurs de COM Interop</span><span class="sxs-lookup"><span data-stu-id="328dc-167">Understanding COM interop errors</span></span>  
 <span data-ttu-id="328dc-168">Sans la gestion des erreurs, les appels Interop génèrent souvent des erreurs qui fournissent peu d’informations.</span><span class="sxs-lookup"><span data-stu-id="328dc-168">Without error handling, interop calls often generate errors that provide little information.</span></span> <span data-ttu-id="328dc-169">Dans la mesure du possible, utilisez la gestion structurée des erreurs pour fournir plus d’informations sur les problèmes lorsqu’ils se produisent.</span><span class="sxs-lookup"><span data-stu-id="328dc-169">Whenever possible, use structured error handling to provide more information about problems when they occur.</span></span> <span data-ttu-id="328dc-170">Cela peut s’avérer particulièrement utile lorsque vous déboguez des applications.</span><span class="sxs-lookup"><span data-stu-id="328dc-170">This can be especially helpful when you debug applications.</span></span> <span data-ttu-id="328dc-171">Exemple :</span><span class="sxs-lookup"><span data-stu-id="328dc-171">For example:</span></span>  
  
 [!code-vb[VbVbalrInterop#25](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#25)]  
  
 <span data-ttu-id="328dc-172">Vous pouvez trouver des informations telles que la description de l’erreur, HRESULT et la source des erreurs COM en examinant le contenu de l’objet exception.</span><span class="sxs-lookup"><span data-stu-id="328dc-172">You can find information such as the error description, HRESULT, and the source of COM errors by examining the contents of the exception object.</span></span>  
  
## <a name="vbconinteroperabilitymarshalinganchor10"></a><span data-ttu-id="328dc-173">Problèmes liés aux contrôles ActiveX</span><span class="sxs-lookup"><span data-stu-id="328dc-173">ActiveX Control Issues</span></span>  
 <span data-ttu-id="328dc-174">La plupart des contrôles ActiveX qui fonctionnent avec Visual Basic 6,0 fonctionnent avec Visual Basic .NET sans aucun problème.</span><span class="sxs-lookup"><span data-stu-id="328dc-174">Most ActiveX controls that work with Visual Basic 6.0 work with Visual Basic .NET without trouble.</span></span> <span data-ttu-id="328dc-175">Les principales exceptions sont les contrôles conteneurs, ou les contrôles qui contiennent visuellement d’autres contrôles.</span><span class="sxs-lookup"><span data-stu-id="328dc-175">The main exceptions are container controls, or controls that visually contain other controls.</span></span> <span data-ttu-id="328dc-176">Voici quelques exemples de contrôles plus anciens qui ne fonctionnent pas correctement avec Visual Studio :</span><span class="sxs-lookup"><span data-stu-id="328dc-176">Some examples of older controls that do not work correctly with Visual Studio are as follows:</span></span>  
  
- <span data-ttu-id="328dc-177">Contrôle Frame Microsoft Forms 2,0</span><span class="sxs-lookup"><span data-stu-id="328dc-177">Microsoft Forms 2.0 Frame control</span></span>  
  
- <span data-ttu-id="328dc-178">Contrôle up-down, également appelé contrôle spin</span><span class="sxs-lookup"><span data-stu-id="328dc-178">Up-Down control, also known as the spin control</span></span>  
  
- <span data-ttu-id="328dc-179">Contrôle onglet Sheridan</span><span class="sxs-lookup"><span data-stu-id="328dc-179">Sheridan Tab Control</span></span>  
  
 <span data-ttu-id="328dc-180">Il n’existe que quelques solutions de contournement pour les problèmes de contrôle ActiveX non pris en charge.</span><span class="sxs-lookup"><span data-stu-id="328dc-180">There are only a few workarounds for unsupported ActiveX control problems.</span></span> <span data-ttu-id="328dc-181">Vous pouvez migrer des contrôles existants vers Visual Studio si vous êtes le propriétaire du code source d’origine.</span><span class="sxs-lookup"><span data-stu-id="328dc-181">You can migrate existing controls to Visual Studio if you own the original source code.</span></span> <span data-ttu-id="328dc-182">Dans le cas contraire, vous pouvez consulter les éditeurs de logiciels pour les mettre à jour. Versions compatibles NET des contrôles pour remplacer les contrôles ActiveX non pris en charge.</span><span class="sxs-lookup"><span data-stu-id="328dc-182">Otherwise, you can check with software vendors for updated .NET-compatible versions of controls to replace unsupported ActiveX controls.</span></span>  
  
## <a name="vbconinteroperabilitymarshalinganchor11"></a><span data-ttu-id="328dc-183">Passage de propriétés ReadOnly de contrôles ByRef</span><span class="sxs-lookup"><span data-stu-id="328dc-183">Passing ReadOnly Properties of Controls ByRef</span></span>  
 <span data-ttu-id="328dc-184">Visual Basic .NET génère parfois des erreurs COM, telles que « Error 0x800A017F CTL_E_SETNOTSUPPORTED », lorsque vous transmettez `ReadOnly` propriétés de certains contrôles ActiveX plus anciens en tant que paramètres de `ByRef` à d’autres procédures.</span><span class="sxs-lookup"><span data-stu-id="328dc-184">Visual Basic .NET sometimes raises COM errors such as, "Error 0x800A017F CTL_E_SETNOTSUPPORTED", when you pass `ReadOnly` properties of some older ActiveX controls as `ByRef` parameters to other procedures.</span></span> <span data-ttu-id="328dc-185">Des appels de procédure similaires à partir de Visual Basic 6,0 ne génèrent pas d’erreur et les paramètres sont traités comme si vous les aviez passés par valeur.</span><span class="sxs-lookup"><span data-stu-id="328dc-185">Similar procedure calls from Visual Basic 6.0 do not raise an error, and the parameters are treated as if you passed them by value.</span></span> <span data-ttu-id="328dc-186">Le message d’erreur Visual Basic .NET indique que vous essayez de modifier une propriété qui n’a pas de propriété `Set` procédure.</span><span class="sxs-lookup"><span data-stu-id="328dc-186">The Visual Basic .NET error message indicates that you are trying to change a property that does not have a property `Set` procedure.</span></span>  
  
 <span data-ttu-id="328dc-187">Si vous avez accès à la procédure appelée, vous pouvez éviter cette erreur en utilisant le mot clé `ByVal` pour déclarer des paramètres qui acceptent des propriétés `ReadOnly`.</span><span class="sxs-lookup"><span data-stu-id="328dc-187">If you have access to the procedure being called, you can prevent this error by using the `ByVal` keyword to declare parameters that accept `ReadOnly` properties.</span></span> <span data-ttu-id="328dc-188">Exemple :</span><span class="sxs-lookup"><span data-stu-id="328dc-188">For example:</span></span>  
  
 [!code-vb[VbVbalrInterop#26](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#26)]  
  
 <span data-ttu-id="328dc-189">Si vous n’avez pas accès au code source de la procédure appelée, vous pouvez forcer la propriété à être passée par valeur en ajoutant un ensemble de crochets supplémentaires autour de la procédure appelante.</span><span class="sxs-lookup"><span data-stu-id="328dc-189">If you do not have access to the source code for the procedure being called, you can force the property to be passed by value by adding an extra set of brackets around the calling procedure.</span></span> <span data-ttu-id="328dc-190">Par exemple, dans un projet qui a une référence à l’objet COM de la bibliothèque Microsoft ActiveX Data Objects 2,8, vous pouvez utiliser :</span><span class="sxs-lookup"><span data-stu-id="328dc-190">For example, in a project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object, you can use:</span></span>  
  
 [!code-vb[VbVbalrInterop#27](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#27)]  
  
## <a name="vbconinteroperabilitymarshalinganchor12"></a><span data-ttu-id="328dc-191">Déploiement d’assemblys qui exposent l’interopérabilité</span><span class="sxs-lookup"><span data-stu-id="328dc-191">Deploying Assemblies That Expose Interop</span></span>  
 <span data-ttu-id="328dc-192">Le déploiement d’assemblys qui exposent des interfaces COM présente des défis uniques.</span><span class="sxs-lookup"><span data-stu-id="328dc-192">Deploying assemblies that expose COM interfaces presents some unique challenges.</span></span> <span data-ttu-id="328dc-193">Par exemple, un problème potentiel se produit lorsque des applications distinctes référencent le même assembly COM.</span><span class="sxs-lookup"><span data-stu-id="328dc-193">For example, a potential problem occurs when separate applications reference the same COM assembly.</span></span> <span data-ttu-id="328dc-194">Cette situation est courante lorsqu’une nouvelle version d’un assembly est installée et qu’une autre application utilise toujours l’ancienne version de l’assembly.</span><span class="sxs-lookup"><span data-stu-id="328dc-194">This situation is common when a new version of an assembly is installed and another application is still using the old version of the assembly.</span></span> <span data-ttu-id="328dc-195">Si vous désinstallez un assembly qui partage une DLL, vous pouvez involontairement le rendre inaccessible aux autres assemblys.</span><span class="sxs-lookup"><span data-stu-id="328dc-195">If you uninstall an assembly that shares a DLL, you can unintentionally make it unavailable to the other assemblies.</span></span>  
  
 <span data-ttu-id="328dc-196">Pour éviter ce problème, vous devez installer les assemblys partagés dans le global assembly cache (GAC) et utiliser un MergeModule pour le composant.</span><span class="sxs-lookup"><span data-stu-id="328dc-196">To avoid this problem, you should install shared assemblies to the Global Assembly Cache (GAC) and use a MergeModule for the component.</span></span> <span data-ttu-id="328dc-197">Si vous ne pouvez pas installer l’application dans le GAC, elle doit être installée dans CommonFilesFolder dans un sous-répertoire spécifique à la version.</span><span class="sxs-lookup"><span data-stu-id="328dc-197">If you cannot install the application in the GAC, it should be installed to CommonFilesFolder in a version-specific subdirectory.</span></span>  
  
 <span data-ttu-id="328dc-198">Les assemblys qui ne sont pas partagés doivent être situés côte à côte dans le répertoire avec l’application appelante.</span><span class="sxs-lookup"><span data-stu-id="328dc-198">Assemblies that are not shared should be located side by side in the directory with the calling application.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="328dc-199">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="328dc-199">See also</span></span>

- <xref:System.Runtime.InteropServices.MarshalAsAttribute>
- [<span data-ttu-id="328dc-200">COM Interop</span><span class="sxs-lookup"><span data-stu-id="328dc-200">COM Interop</span></span>](../../../visual-basic/programming-guide/com-interop/index.md)
- [<span data-ttu-id="328dc-201">Tlbimp.exe (importateur de bibliothèques de types)</span><span class="sxs-lookup"><span data-stu-id="328dc-201">Tlbimp.exe (Type Library Importer)</span></span>](../../../framework/tools/tlbimp-exe-type-library-importer.md)
- [<span data-ttu-id="328dc-202">Tlbexp.exe (exportateur de bibliothèques de types)</span><span class="sxs-lookup"><span data-stu-id="328dc-202">Tlbexp.exe (Type Library Exporter)</span></span>](../../../framework/tools/tlbexp-exe-type-library-exporter.md)
- [<span data-ttu-id="328dc-203">Procédure pas à pas : implémentation de l’héritage avec les objets COM</span><span class="sxs-lookup"><span data-stu-id="328dc-203">Walkthrough: Implementing Inheritance with COM Objects</span></span>](../../../visual-basic/programming-guide/com-interop/walkthrough-implementing-inheritance-with-com-objects.md)
- [<span data-ttu-id="328dc-204">Inherits (instruction)</span><span class="sxs-lookup"><span data-stu-id="328dc-204">Inherits Statement</span></span>](../../../visual-basic/language-reference/statements/inherits-statement.md)
- [<span data-ttu-id="328dc-205">Global Assembly Cache</span><span class="sxs-lookup"><span data-stu-id="328dc-205">Global Assembly Cache</span></span>](../../../framework/app-domains/gac.md)

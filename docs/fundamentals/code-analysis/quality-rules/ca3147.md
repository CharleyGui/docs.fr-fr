---
title: 'CA3147 : marquer des gestionnaires de verbe avec ValidateAntiForgeryToken (analyse du code)'
description: 'En savoir plus sur la règle d’analyse du code CA3147 : marquer les gestionnaires de verbe avec ValidateAntiForgeryToken'
ms.date: 08/08/2018
ms.topic: reference
author: dotpaul
ms.author: paulming
dev_langs:
- CSharp
ms.openlocfilehash: 2f9785f40cd7741b65630c26193b8e7e2e5b52e3
ms.sourcegitcommit: 4df8e005c074ceb1f978f007b222fe253be2baf3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/04/2021
ms.locfileid: "99544032"
---
# <a name="ca3147-mark-verb-handlers-with-validateantiforgerytoken"></a><span data-ttu-id="2af10-103">CA3147 : Marquer les gestionnaires de verbe avec ValidateAntiForgeryToken</span><span class="sxs-lookup"><span data-stu-id="2af10-103">CA3147: Mark verb handlers with ValidateAntiForgeryToken</span></span>

| | <span data-ttu-id="2af10-104">Valeur</span><span class="sxs-lookup"><span data-stu-id="2af10-104">Value</span></span> |
|-|-|
| <span data-ttu-id="2af10-105">**Identificateur de la règle**</span><span class="sxs-lookup"><span data-stu-id="2af10-105">**Rule ID**</span></span> |<span data-ttu-id="2af10-106">CA3147</span><span class="sxs-lookup"><span data-stu-id="2af10-106">CA3147</span></span>|
| <span data-ttu-id="2af10-107">**Catégorie**</span><span class="sxs-lookup"><span data-stu-id="2af10-107">**Category**</span></span> |[<span data-ttu-id="2af10-108">Microsoft.Security</span><span class="sxs-lookup"><span data-stu-id="2af10-108">Microsoft.Security</span></span>](security-warnings.md)|
| <span data-ttu-id="2af10-109">**Correction en rupture ou sans rupture**</span><span class="sxs-lookup"><span data-stu-id="2af10-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="2af10-110">Sans rupture</span><span class="sxs-lookup"><span data-stu-id="2af10-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="2af10-111">Cause</span><span class="sxs-lookup"><span data-stu-id="2af10-111">Cause</span></span>

<span data-ttu-id="2af10-112">Une méthode d’action du contrôleur MVC ASP.NET n’est pas marquée avec [ValidateAntiForgeryTokenAttribute](/previous-versions/aspnet/dd492108(v=vs.118)), ou un attribut qui spécifie le verbe http, tel que [HttpGetAttribute](/previous-versions/aspnet/ee470993(v%3dvs.118)) ou [AcceptVerbsAttribute](/previous-versions/aspnet/dd470553%28v%3dvs.118%29).</span><span class="sxs-lookup"><span data-stu-id="2af10-112">An ASP.NET MVC controller action method isn't marked with [ValidateAntiForgeryTokenAttribute](/previous-versions/aspnet/dd492108(v=vs.118)), or an attribute specifying the HTTP verb, such as [HttpGetAttribute](/previous-versions/aspnet/ee470993(v%3dvs.118)) or [AcceptVerbsAttribute](/previous-versions/aspnet/dd470553%28v%3dvs.118%29).</span></span>

## <a name="rule-description"></a><span data-ttu-id="2af10-113">Description de la règle</span><span class="sxs-lookup"><span data-stu-id="2af10-113">Rule description</span></span>

<span data-ttu-id="2af10-114">Lors de la conception d’un contrôleur MVC ASP.NET, soyez attentif aux attaques de falsification de requête intersites.</span><span class="sxs-lookup"><span data-stu-id="2af10-114">When designing an ASP.NET MVC controller, be mindful of cross-site request forgery attacks.</span></span> <span data-ttu-id="2af10-115">Une attaque de falsification de requête intersite peut envoyer des demandes malveillantes d’un utilisateur authentifié à votre contrôleur ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="2af10-115">A cross-site request forgery attack can send malicious requests from an authenticated user to your ASP.NET MVC controller.</span></span> <span data-ttu-id="2af10-116">Pour plus d’informations, consultez [prévention de XSRF/CSRF dans ASP.NET MVC et pages Web](/aspnet/mvc/overview/security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages).</span><span class="sxs-lookup"><span data-stu-id="2af10-116">For more information, see [XSRF/CSRF prevention in ASP.NET MVC and web pages](/aspnet/mvc/overview/security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages).</span></span>

<span data-ttu-id="2af10-117">Cette règle vérifie que les méthodes d’action du contrôleur ASP.NET MVC sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="2af10-117">This rule checks that ASP.NET MVC controller action methods either:</span></span>

- <span data-ttu-id="2af10-118">Avoir le [ValidateAntiforgeryTokenAttribute](/previous-versions/aspnet/dd492108%28v%3dvs.118%29) et spécifier les verbes HTTP autorisés, à l’exclusion de http.</span><span class="sxs-lookup"><span data-stu-id="2af10-118">Have the [ValidateAntiforgeryTokenAttribute](/previous-versions/aspnet/dd492108%28v%3dvs.118%29) and specify allowed HTTP verbs, not including HTTP GET.</span></span>

- <span data-ttu-id="2af10-119">Spécifiez HTTP en tant que verbe autorisé.</span><span class="sxs-lookup"><span data-stu-id="2af10-119">Specify HTTP GET as an allowed verb.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="2af10-120">Comment corriger les violations</span><span class="sxs-lookup"><span data-stu-id="2af10-120">How to fix violations</span></span>

- <span data-ttu-id="2af10-121">Pour les actions du contrôleur ASP.NET MVC qui gèrent les demandes HTTP et qui n’ont pas d’effets secondaires potentiellement dangereux, ajoutez un [HttpGetAttribute](/previous-versions/aspnet/ee470993%28v%3dvs.118%29) à la méthode.</span><span class="sxs-lookup"><span data-stu-id="2af10-121">For ASP.NET MVC controller actions that handle HTTP GET requests and don't have potentially harmful side effects, add an [HttpGetAttribute](/previous-versions/aspnet/ee470993%28v%3dvs.118%29) to the method.</span></span>

  <span data-ttu-id="2af10-122">Si vous avez une action de contrôleur ASP.NET MVC qui gère les requêtes HTTP et présente des effets secondaires potentiellement dangereux tels que la modification des données sensibles, votre application est vulnérable aux attaques par falsification de requête intersites.</span><span class="sxs-lookup"><span data-stu-id="2af10-122">If you have an ASP.NET MVC controller action that handles HTTP GET requests and has potentially harmful side effects such as modifying sensitive data, then your application is vulnerable to cross-site request forgery attacks.</span></span>  <span data-ttu-id="2af10-123">Vous devez reconcevoir votre application afin que seules les demandes HTTP, PUT ou DELETE effectuent des opérations sensibles.</span><span class="sxs-lookup"><span data-stu-id="2af10-123">You'll need to redesign your application so that only HTTP POST, PUT, or DELETE requests perform sensitive operations.</span></span>

- <span data-ttu-id="2af10-124">Pour les actions du contrôleur ASP.NET MVC qui gèrent les demandes HTTP, PUT ou DELETE, ajoutez des [ValidateAntiForgeryTokenAttribute](/previous-versions/aspnet/dd492108(v=vs.118)) et des attributs qui spécifient les verbes HTTP autorisés ([AcceptVerbsAttribute](/previous-versions/aspnet/dd470553%28v%3dvs.118%29), [HttpPostAttribute](/previous-versions/aspnet/ee264023%28v%3dvs.118%29), [HttpPutAttribute](/previous-versions/aspnet/ee470909%28v%3dvs.118%29)ou [HttpDeleteAttribute](/previous-versions/aspnet/ee470917%28v%3dvs.118%29)).</span><span class="sxs-lookup"><span data-stu-id="2af10-124">For ASP.NET MVC controller actions that handle HTTP POST, PUT, or DELETE requests, add [ValidateAntiForgeryTokenAttribute](/previous-versions/aspnet/dd492108(v=vs.118)) and attributes specifying the allowed HTTP verbs ([AcceptVerbsAttribute](/previous-versions/aspnet/dd470553%28v%3dvs.118%29), [HttpPostAttribute](/previous-versions/aspnet/ee264023%28v%3dvs.118%29), [HttpPutAttribute](/previous-versions/aspnet/ee470909%28v%3dvs.118%29), or [HttpDeleteAttribute](/previous-versions/aspnet/ee470917%28v%3dvs.118%29)).</span></span> <span data-ttu-id="2af10-125">En outre, vous devez appeler la méthode [HtmlHelper. AntiForgeryToken ()](/previous-versions/aspnet/dd504812%28v%3dvs.118%29) à partir de votre vue MVC ou de votre page Web Razor.</span><span class="sxs-lookup"><span data-stu-id="2af10-125">Additionally, you need to call the [HtmlHelper.AntiForgeryToken()](/previous-versions/aspnet/dd504812%28v%3dvs.118%29) method from your MVC view or Razor web page.</span></span> <span data-ttu-id="2af10-126">Pour obtenir un exemple, consultez [examen des méthodes de modification et de la vue Edit](/aspnet/mvc/overview/getting-started/introduction/examining-the-edit-methods-and-edit-view).</span><span class="sxs-lookup"><span data-stu-id="2af10-126">For an example, see [Examining the edit methods and edit view](/aspnet/mvc/overview/getting-started/introduction/examining-the-edit-methods-and-edit-view).</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="2af10-127">Quand supprimer les avertissements</span><span class="sxs-lookup"><span data-stu-id="2af10-127">When to suppress warnings</span></span>

<span data-ttu-id="2af10-128">Il est possible de supprimer sans risque un avertissement de cette règle dans les cas suivants :</span><span class="sxs-lookup"><span data-stu-id="2af10-128">It's safe to suppress a warning from this rule if:</span></span>

- <span data-ttu-id="2af10-129">L’action du contrôleur ASP.NET MVC n’a aucun effet secondaire néfaste.</span><span class="sxs-lookup"><span data-stu-id="2af10-129">The ASP.NET MVC controller action has no harmful side effects.</span></span>

- <span data-ttu-id="2af10-130">L’application valide le jeton anti-contrefaçon d’une autre façon.</span><span class="sxs-lookup"><span data-stu-id="2af10-130">The application validates the antiforgery token in a different way.</span></span>

## <a name="validateantiforgerytoken-attribute-example"></a><span data-ttu-id="2af10-131">Exemple d’attribut ValidateAntiForgeryToken</span><span class="sxs-lookup"><span data-stu-id="2af10-131">ValidateAntiForgeryToken attribute example</span></span>

<span data-ttu-id="2af10-132">Encontre</span><span class="sxs-lookup"><span data-stu-id="2af10-132">Violation:</span></span>

```csharp
namespace TestNamespace
{
    using System.Web.Mvc;

    public class TestController : Controller
    {
        public ActionResult TransferMoney(string toAccount, string amount)
        {
            // You don't want an attacker to specify to who and how much money to transfer.

            return null;
        }
    }
}
```

<span data-ttu-id="2af10-133">Solution :</span><span class="sxs-lookup"><span data-stu-id="2af10-133">Solution:</span></span>

```csharp
using System;
using System.Xml;

namespace TestNamespace
{
    using System.Web.Mvc;

    public class TestController : Controller
    {
        [HttpPost]
        [ValidateAntiForgeryToken]
        public ActionResult TransferMoney(string toAccount, string amount)
        {
            return null;
        }
    }
}
```

## <a name="httpget-attribute-example"></a><span data-ttu-id="2af10-134">Exemple d’attribut HttpGet</span><span class="sxs-lookup"><span data-stu-id="2af10-134">HttpGet attribute example</span></span>

<span data-ttu-id="2af10-135">Encontre</span><span class="sxs-lookup"><span data-stu-id="2af10-135">Violation:</span></span>

```csharp
namespace TestNamespace
{
    using System.Web.Mvc;

    public class TestController : Controller
    {
        public ActionResult Help(int topicId)
        {
            // This Help method is an example of a read-only operation with no harmful side effects.
            return null;
        }
    }
}
```

<span data-ttu-id="2af10-136">Solution :</span><span class="sxs-lookup"><span data-stu-id="2af10-136">Solution:</span></span>

```csharp
namespace TestNamespace
{
    using System.Web.Mvc;

    public class TestController : Controller
    {
        [HttpGet]
        public ActionResult Help(int topicId)
        {
            return null;
        }
    }
}
```

---
title: 'CA3012 : passez en revue le code pour les vulnérabilités d’injection Regex (analyse du code)'
description: 'En savoir plus sur la règle d’analyse du code CA3012 : examiner le code pour les vulnérabilités d’injection Regex'
ms.date: 04/03/2019
ms.topic: reference
author: dotpaul
ms.author: paulming
dev_langs:
- CSharp
- VB
ms.openlocfilehash: ba9a5f9eef2c92e9bc1db3cc5016584736553c01
ms.sourcegitcommit: e301979e3049ce412d19b094c60ed95b316a8f8c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/16/2020
ms.locfileid: "97595232"
---
# <a name="ca3012-review-code-for-regex-injection-vulnerabilities"></a><span data-ttu-id="0feba-103">CA3012 : Passez en revue le code pour détecter les vulnérabilités de l’injection regex</span><span class="sxs-lookup"><span data-stu-id="0feba-103">CA3012: Review code for regex injection vulnerabilities</span></span>

| | <span data-ttu-id="0feba-104">Valeur</span><span class="sxs-lookup"><span data-stu-id="0feba-104">Value</span></span> |
|-|-|
| <span data-ttu-id="0feba-105">**Identificateur de la règle**</span><span class="sxs-lookup"><span data-stu-id="0feba-105">**Rule ID**</span></span> |<span data-ttu-id="0feba-106">CA3012</span><span class="sxs-lookup"><span data-stu-id="0feba-106">CA3012</span></span>|
| <span data-ttu-id="0feba-107">**Catégorie**</span><span class="sxs-lookup"><span data-stu-id="0feba-107">**Category**</span></span> |<span data-ttu-id="0feba-108">Microsoft.Security</span><span class="sxs-lookup"><span data-stu-id="0feba-108">Microsoft.Security</span></span>|
| <span data-ttu-id="0feba-109">**Correction en rupture ou sans rupture**</span><span class="sxs-lookup"><span data-stu-id="0feba-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="0feba-110">Sans rupture</span><span class="sxs-lookup"><span data-stu-id="0feba-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="0feba-111">Cause</span><span class="sxs-lookup"><span data-stu-id="0feba-111">Cause</span></span>

<span data-ttu-id="0feba-112">Une entrée de requête HTTP potentiellement non approuvée atteint une expression régulière.</span><span class="sxs-lookup"><span data-stu-id="0feba-112">Potentially untrusted HTTP request input reaches a regular expression.</span></span>

<span data-ttu-id="0feba-113">Par défaut, cette règle analyse l’ensemble du code base, mais il peut être [configuré](#configure-code-to-analyze).</span><span class="sxs-lookup"><span data-stu-id="0feba-113">By default, this rule analyzes the entire codebase, but this is [configurable](#configure-code-to-analyze).</span></span>

## <a name="rule-description"></a><span data-ttu-id="0feba-114">Description de la règle</span><span class="sxs-lookup"><span data-stu-id="0feba-114">Rule description</span></span>

<span data-ttu-id="0feba-115">Lorsque vous travaillez avec des entrées non fiables, soyez attentif aux attaques par injection de Regex.</span><span class="sxs-lookup"><span data-stu-id="0feba-115">When working with untrusted input, be mindful of regex injection attacks.</span></span> <span data-ttu-id="0feba-116">Une personne malveillante peut utiliser l’injection Regex pour modifier une expression régulière de manière malveillante, pour faire correspondre des résultats inattendus par l’expression régulière, ou pour faire en sorte que l’expression régulière consomme un processeur excessif, entraînant une attaque par déni de service.</span><span class="sxs-lookup"><span data-stu-id="0feba-116">An attacker can use regex injection to maliciously modify a regular expression, to make the regex match unintended results, or to make the regex consume excessive CPU resulting in a Denial of Service attack.</span></span>

<span data-ttu-id="0feba-117">Cette règle tente de trouver une entrée à partir des requêtes HTTP qui atteignent une expression régulière.</span><span class="sxs-lookup"><span data-stu-id="0feba-117">This rule attempts to find input from HTTP requests reaching a regular expression.</span></span>

> [!NOTE]
> <span data-ttu-id="0feba-118">Cette règle ne peut pas effectuer le suivi des données dans les assemblys.</span><span class="sxs-lookup"><span data-stu-id="0feba-118">This rule can't track data across assemblies.</span></span> <span data-ttu-id="0feba-119">Par exemple, si un assembly lit l’entrée de la requête HTTP, puis le passe à un autre assembly qui crée une expression régulière, cette règle ne génère pas d’avertissement.</span><span class="sxs-lookup"><span data-stu-id="0feba-119">For example, if one assembly reads the HTTP request input and then passes it to another assembly that creates a regular expression, this rule won't produce a warning.</span></span>

> [!NOTE]
> <span data-ttu-id="0feba-120">Il existe une limite configurable de la profondeur de cette règle pour analyser le workflow des données entre les appels de méthode.</span><span class="sxs-lookup"><span data-stu-id="0feba-120">There is a configurable limit to how deep this rule will analyze data flow across method calls.</span></span> <span data-ttu-id="0feba-121">Consultez [configuration de l’analyseur](https://github.com/dotnet/roslyn-analyzers/blob/master/docs/Analyzer%20Configuration.md#dataflow-analysis) pour savoir comment configurer la limite dans un fichier baEditorConfig.</span><span class="sxs-lookup"><span data-stu-id="0feba-121">See [Analyzer Configuration](https://github.com/dotnet/roslyn-analyzers/blob/master/docs/Analyzer%20Configuration.md#dataflow-analysis) for how to configure the limit in an EditorConfig file.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="0feba-122">Comment corriger les violations</span><span class="sxs-lookup"><span data-stu-id="0feba-122">How to fix violations</span></span>

<span data-ttu-id="0feba-123">Certaines atténuations par rapport aux injections regex sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="0feba-123">Some mitigations against regex injections include:</span></span>

- <span data-ttu-id="0feba-124">Utilisez toujours un [délai d’expiration de correspondance](../../../standard/base-types/best-practices.md#use-time-out-values) lors de l’utilisation d’expressions régulières.</span><span class="sxs-lookup"><span data-stu-id="0feba-124">Always use a [match timeout](../../../standard/base-types/best-practices.md#use-time-out-values) when using regular expressions.</span></span>
- <span data-ttu-id="0feba-125">Évitez d’utiliser des expressions régulières basées sur l’entrée d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="0feba-125">Avoid using regular expressions based on user input.</span></span>
- <span data-ttu-id="0feba-126">Échapper les caractères spéciaux de l’entrée d’utilisateur en appelant <xref:System.Text.RegularExpressions.Regex.Escape%2A?displayProperty=fullName> ou une autre méthode.</span><span class="sxs-lookup"><span data-stu-id="0feba-126">Escape special characters from user input by calling <xref:System.Text.RegularExpressions.Regex.Escape%2A?displayProperty=fullName> or another method.</span></span>
- <span data-ttu-id="0feba-127">Autorise uniquement les caractères non spéciaux de l’entrée d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="0feba-127">Allow only non-special characters from user input.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="0feba-128">Quand supprimer les avertissements</span><span class="sxs-lookup"><span data-stu-id="0feba-128">When to suppress warnings</span></span>

<span data-ttu-id="0feba-129">Si vous savez que vous utilisez un [délai d’expiration de correspondance](../../../standard/base-types/best-practices.md#use-time-out-values) et que l’entrée utilisateur ne contient pas de caractères spéciaux, il est possible de supprimer cet avertissement.</span><span class="sxs-lookup"><span data-stu-id="0feba-129">If you know you're using a [match timeout](../../../standard/base-types/best-practices.md#use-time-out-values) and the user input is free of special characters, it's okay to suppress this warning.</span></span>

## <a name="configure-code-to-analyze"></a><span data-ttu-id="0feba-130">Configurer le code pour analyser</span><span class="sxs-lookup"><span data-stu-id="0feba-130">Configure code to analyze</span></span>

<span data-ttu-id="0feba-131">Utilisez les options suivantes pour configurer les parties de votre code base pour l’exécution de cette règle.</span><span class="sxs-lookup"><span data-stu-id="0feba-131">Use the following options to configure which parts of your codebase to run this rule on.</span></span>

- [<span data-ttu-id="0feba-132">Exclure des symboles spécifiques</span><span class="sxs-lookup"><span data-stu-id="0feba-132">Exclude specific symbols</span></span>](#exclude-specific-symbols)
- [<span data-ttu-id="0feba-133">Exclure des types spécifiques et leurs types dérivés</span><span class="sxs-lookup"><span data-stu-id="0feba-133">Exclude specific types and their derived types</span></span>](#exclude-specific-types-and-their-derived-types)

<span data-ttu-id="0feba-134">Vous pouvez configurer ces options uniquement pour cette règle, pour toutes les règles ou pour toutes les règles de cette catégorie (sécurité).</span><span class="sxs-lookup"><span data-stu-id="0feba-134">You can configure these options for just this rule, for all rules, or for all rules in this category (Security).</span></span> <span data-ttu-id="0feba-135">Pour plus d’informations, consultez Options de configuration d’une [règle de qualité du code](../code-quality-rule-options.md).</span><span class="sxs-lookup"><span data-stu-id="0feba-135">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

[!INCLUDE[excluded-symbol-names](~/includes/code-analysis/excluded-symbol-names.md)]

[!INCLUDE[excluded-type-names-with-derived-types](~/includes/code-analysis/excluded-type-names-with-derived-types.md)]

## <a name="pseudo-code-examples"></a><span data-ttu-id="0feba-136">Exemples de pseudo-code</span><span class="sxs-lookup"><span data-stu-id="0feba-136">Pseudo-code examples</span></span>

### <a name="violation"></a><span data-ttu-id="0feba-137">Violation</span><span class="sxs-lookup"><span data-stu-id="0feba-137">Violation</span></span>

```csharp
using System;
using System.Text.RegularExpressions;

public partial class WebForm : System.Web.UI.Page
{
    public string SearchableText { get; set; }

    protected void Page_Load(object sender, EventArgs e)
    {
        string findTerm = Request.Form["findTerm"];
        Match m = Regex.Match(SearchableText, "^term=" + findTerm);
    }
}
```

```vb
Imports System
Imports System.Text.RegularExpressions

Public Partial Class WebForm
    Inherits System.Web.UI.Page

    Public Property SearchableText As String

    Protected Sub Page_Load(sender As Object, e As EventArgs)
        Dim findTerm As String = Request.Form("findTerm")
        Dim m As Match = Regex.Match(SearchableText, "^term=" + findTerm)
    End Sub
End Class
```

---
title: 'Ca1068 : les paramètres CancellationToken doivent être en dernier (analyse du code)'
description: 'En savoir plus sur la règle d’analyse du code ca1068 : les paramètres CancellationToken doivent être les derniers'
ms.date: 09/16/2019
ms.topic: reference
f1_keywords:
- CA1068
- CancellationTokenParametersMustComeLast
helpviewer_keywords:
- CA1068
- CancellationTokenParametersMustComeLast
author: mavasani
ms.author: mavasani
ms.openlocfilehash: a87519b019dc7c3dbce8cd68f3e1eb93eaced069
ms.sourcegitcommit: 45c7148f2483db2501c1aa696ab6ed2ed8cb71b2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/08/2020
ms.locfileid: "96851553"
---
# <a name="ca1068-cancellationtoken-parameters-must-come-last"></a>CA1068 : Les paramètres CancellationToken doivent venir en dernier

| | Valeur |
|-|-|
| **Identificateur de la règle** |CA1068|
| **Catégorie** |Microsoft. Design|
| **Correction en rupture ou sans rupture** |Rupture|

## <a name="cause"></a>Cause

Une méthode a un <xref:System.Threading.CancellationToken> paramètre qui n’est pas le dernier paramètre.

Par défaut, cette règle analyse l’ensemble du code base, mais il peut être [configuré](#include-or-exclude-selected-apis).

## <a name="rule-description"></a>Description de la règle

Les méthodes qui effectuent des opérations ou des opérations asynchrones de longue durée et qui peuvent être annulées prennent normalement un paramètre de jeton d’annulation. Chaque jeton d’annulation a un <xref:System.Threading.CancellationTokenSource> qui crée le jeton et l’utilise pour les calculs annulables. Il est courant d’avoir une longue chaîne d’appels de méthode qui passent autour du jeton d’annulation des appelants aux appelants. Par conséquent, un grand nombre de méthodes qui prennent part à un calcul annulable finissent par avoir un paramètre de jeton d’annulation. Toutefois, le jeton d’annulation proprement dit n’est généralement pas pertinent pour la fonctionnalité de base de la plupart de ces méthodes. Il est considéré comme une bonne pratique de conception d’API pour que ces paramètres soient le dernier paramètre de la liste.

## <a name="special-cases"></a>Cas particuliers

La règle ca1068 ne se déclenche pas dans les cas spéciaux suivants :

- La méthode a un ou plusieurs paramètres [facultatifs](../../../csharp/programming-guide/classes-and-structs/named-and-optional-arguments.md#optional-arguments) ([facultatifs](../../../visual-basic/programming-guide/language-features/procedures/optional-parameters.md) dans Visual Basic) après un paramètre de jeton d’annulation non facultatif. Le compilateur requiert que tous les paramètres facultatifs soient définis après tous les paramètres non facultatifs.
- La méthode a un ou plusieurs paramètres [ref](../../../csharp/language-reference/keywords/ref.md) ou [out](../../../csharp/language-reference/keywords/out-parameter-modifier.md) ([ByRef](../../../visual-basic/language-reference/modifiers/byref.md) dans Visual Basic) après un paramètre de jeton d’annulation. Il est courant d’avoir des `ref` `out` paramètres ou à la fin de la liste, car ils indiquent généralement les valeurs de sortie de la méthode.

## <a name="how-to-fix-violations"></a>Comment corriger les violations

Modifiez la signature de la méthode pour déplacer le paramètre de jeton d’annulation à la fin de la liste. Par exemple, les deux extraits de code suivants illustrent une violation de la règle et comment la corriger :

```csharp
// Violates CA1068
public void LongRunningOperation(CancellationToken token, string usefulParameter)
{
    ...
}
```

```csharp
// Does not violate CA1068
public void LongRunningOperation(string usefulParameter, CancellationToken token)
{
    ...
}
```

## <a name="when-to-suppress-warnings"></a>Quand supprimer les avertissements

Si la méthode est une API publique visible de l’extérieur qui fait déjà partie d’une bibliothèque livrée, il est possible de supprimer sans risque un avertissement de cette règle afin d’éviter une modification avec rupture pour les consommateurs de la bibliothèque.

## <a name="configurability"></a>Configurabilité

Cette règle comporte les options configurables suivantes qui peuvent être configurées uniquement pour cette règle, pour toutes les règles ou pour toutes les règles de cette catégorie (conception). Pour plus d’informations, consultez Options de configuration d’une [règle de qualité du code](../code-quality-rule-options.md).

### <a name="include-or-exclude-selected-apis"></a>Inclure ou exclure les API sélectionnées

Utilisez les options suivantes pour configurer les parties de votre code base pour l’exécution de cette règle.

- [Inclure des surfaces d’API spécifiques](#include-specific-api-surfaces)
- [Exclure des symboles spécifiques](#exclude-specific-symbols)
- [Exclure des types spécifiques et leurs types dérivés](#exclude-specific-types-and-their-derived-types)

#### <a name="include-specific-api-surfaces"></a>Inclure des surfaces d’API spécifiques

Vous pouvez inclure ou exclure des API de l’analyse en fonction de leur accessibilité. Par exemple, pour spécifier que la règle doit s’exécuter uniquement sur la surface d’API non publique, ajoutez la paire clé-valeur suivante à un fichier *. editorconfig* dans votre projet :

```ini
dotnet_code_quality.CA1068.api_surface = private, internal
```

#### <a name="exclude-specific-symbols"></a>Exclure des symboles spécifiques

Vous pouvez exclure des symboles spécifiques, tels que des types et des méthodes, de l’analyse. Par exemple, pour spécifier que la règle ne doit pas être exécutée sur un code dans des types nommés `MyType` , ajoutez la paire clé-valeur suivante à un fichier *. editorconfig* dans votre projet :

```ini
dotnet_code_quality.CA1068.excluded_symbol_names = MyType
```

Formats de noms de symboles autorisés dans la valeur de l’option (séparés par `|` ) :

- Nom du symbole uniquement (comprend tous les symboles portant le nom, quel que soit le type ou l’espace de noms conteneur).
- Noms qualifiés complets dans le format d' [ID de documentation](../../../csharp/programming-guide/xmldoc/processing-the-xml-file.md#id-strings)du symbole. Chaque nom de symbole requiert un préfixe de type symbole, tel que `M:` pour les méthodes, `T:` pour les types et `N:` pour les espaces de noms.
- `.ctor` pour les constructeurs et `.cctor` pour les constructeurs statiques.

Exemples :

| Valeur d’option | Résumé |
| --- | --- |
|`dotnet_code_quality.CA1068.excluded_symbol_names = MyType` | Correspond à tous les symboles nommés’MyType'. |
|`dotnet_code_quality.CA1068.excluded_symbol_names = MyType1|MyType2` | Correspond à tous les symboles nommés’MyType1 'ou’MyType2 '. |
|`dotnet_code_quality.CA1068.excluded_symbol_names = M:NS.MyType.MyMethod(ParamType)` | Met en correspondance une méthode spécifique `MyMethod` avec la signature complète spécifiée. |
|`dotnet_code_quality.CA1068.excluded_symbol_names = M:NS1.MyType1.MyMethod1(ParamType)|M:NS2.MyType2.MyMethod2(ParamType)` | Met en correspondance des méthodes spécifiques « MyMethod1 » et « MyMethod2 » avec les signatures qualifiées complètes respectives. |

#### <a name="exclude-specific-types-and-their-derived-types"></a>Exclure des types spécifiques et leurs types dérivés

Vous pouvez exclure des types spécifiques et leurs types dérivés de l’analyse. Par exemple, pour spécifier que la règle ne doit pas s’exécuter sur les méthodes dans les types nommés `MyType` et leurs types dérivés, ajoutez la paire clé-valeur suivante à un fichier *. editorconfig* dans votre projet :

```ini
dotnet_code_quality.CA1068.excluded_type_names_with_derived_types = MyType
```

Formats de noms de symboles autorisés dans la valeur de l’option (séparés par `|` ) :

- Nom de type uniquement (comprend tous les types portant le nom, quel que soit le type ou l’espace de noms conteneur).
- Noms qualifiés complets dans le format d' [ID de documentation](../../../csharp/programming-guide/xmldoc/processing-the-xml-file.md#id-strings)du symbole, avec un `T:` préfixe facultatif.

Exemples :

| Valeur d’option | Résumé |
| --- | --- |
|`dotnet_code_quality.CA1068.excluded_type_names_with_derived_types = MyType` | Correspond à tous les types nommés’MyType’et à tous leurs types dérivés. |
|`dotnet_code_quality.CA1068.excluded_type_names_with_derived_types = MyType1|MyType2` | Correspond à tous les types nommés’MyType1 'ou’MyType2 'et tous leurs types dérivés. |
|`dotnet_code_quality.CA1068.excluded_type_names_with_derived_types = M:NS.MyType` | Correspond au type spécifique’MyType’avec le nom qualifié complet donné et tous ses types dérivés. |
|`dotnet_code_quality.CA1068.excluded_type_names_with_derived_types = M:NS1.MyType1|M:NS2.MyType2` | Met en correspondance des types spécifiques « MyType1 » et « MyType2 » avec les noms qualifiés complets respectifs et tous leurs types dérivés. |

## <a name="related-rules"></a>Règles associées

- [CA1021 : Éviter les paramètres out](ca1021.md)

## <a name="see-also"></a>Voir aussi

- [Modèles recommandés pour CancellationToken](https://devblogs.microsoft.com/premier-developer/recommended-patterns-for-cancellationtoken/)

---
title: Architecture des outils en ligne de commande .NET Core
description: Découvrez les différentes couches des outils .NET Core et les changements apportés aux versions récentes.
ms.date: 03/06/2017
ms.openlocfilehash: fde1a0acb6af9dd65aa3466b4ea37473b2eab6fb
ms.sourcegitcommit: 011314e0c8eb4cf4a11d92078f58176c8c3efd2d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/09/2020
ms.locfileid: "77092913"
---
# <a name="high-level-overview-of-changes-in-the-net-core-tools"></a><span data-ttu-id="7cd4b-103">Vue d’ensemble générale des modifications des outils .NET Core</span><span class="sxs-lookup"><span data-stu-id="7cd4b-103">High-level overview of changes in the .NET Core tools</span></span>

<span data-ttu-id="7cd4b-104">Ce document décrit les modifications associées de passage de *project.json* à MSBuild et au système de projet *csproj*, avec des informations sur les modifications apportées aux couches d’outils .NET Core et à l’implémentation des commandes de l’interface CLI.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-104">This document describes the changes associated with moving from *project.json* to MSBuild and the *csproj* project system with information on the changes to the layering of the .NET Core tooling and the implementation of the CLI commands.</span></span> <span data-ttu-id="7cd4b-105">Ces modifications ont été apportées lors du lancement du Kit de développement logiciel (SDK) .NET Core 1.0 et de Visual Studio 2017 le 7 mars 2017 (consultez [l’annonce](https://devblogs.microsoft.com/dotnet/announcing-net-core-tools-1-0/)), mais ont été à l’origine implémentées avec le lancement de la préversion 3 du Kit SDK .NET Core.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-105">These changes occurred with the release of .NET Core SDK 1.0 and Visual Studio 2017 on March 7, 2017 (see the [announcement](https://devblogs.microsoft.com/dotnet/announcing-net-core-tools-1-0/)) but were initially implemented with the release of the .NET Core SDK Preview 3.</span></span>

## <a name="moving-away-from-projectjson"></a><span data-ttu-id="7cd4b-106">Abandon de project.json</span><span class="sxs-lookup"><span data-stu-id="7cd4b-106">Moving away from project.json</span></span>

<span data-ttu-id="7cd4b-107">Le plus grand changement apporté aux outils pour .NET Core est certainement le [passage du système de projet project.json à csproj](https://devblogs.microsoft.com/dotnet/changes-to-project-json/).</span><span class="sxs-lookup"><span data-stu-id="7cd4b-107">The biggest change in the tooling for .NET Core is certainly the [move away from project.json to csproj](https://devblogs.microsoft.com/dotnet/changes-to-project-json/) as the project system.</span></span> <span data-ttu-id="7cd4b-108">Les dernières versions des outils en ligne de commande ne prennent pas en charge les fichiers *project.json*.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-108">The latest versions of the command-line tools don't support *project.json* files.</span></span> <span data-ttu-id="7cd4b-109">Cela signifie qu’il ne peut pas être utilisé pour générer, exécuter ou publier des applications et des bibliothèques basées sur Project. JSON.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-109">That means that it cannot be used to build, run, or publish project.json based applications and libraries.</span></span> <span data-ttu-id="7cd4b-110">Pour utiliser cette version des outils, vous pouvez migrer vos projets existants ou en démarrer de nouveaux.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-110">To use this version of the tools, migrate your existing projects or start new ones.</span></span>

<span data-ttu-id="7cd4b-111">Dans le cadre de ce passage, le moteur de génération personnalisé qui a été développé pour générer des projets project.json a été remplacé par un moteur de génération mature et entièrement compatible appelé [MSBuild](https://github.com/Microsoft/msbuild).</span><span class="sxs-lookup"><span data-stu-id="7cd4b-111">As part of this move, the custom build engine that was developed to build project.json projects was replaced with a mature and fully capable build engine called [MSBuild](https://github.com/Microsoft/msbuild).</span></span> <span data-ttu-id="7cd4b-112">MSBuild est un moteur connu dans la communauté .NET.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-112">MSBuild is a well-known engine in the .NET community.</span></span> <span data-ttu-id="7cd4b-113">Il s’agit d’une technologie clé depuis la première version de la plateforme.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-113">It has been a key technology since the platform's first release.</span></span> <span data-ttu-id="7cd4b-114">Étant donné qu’il doit générer des applications .NET Core, MSBuild a été porté sur .NET Core et peut être utilisé sur n’importe quelle plateforme sur laquelle .NET Core s’exécute.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-114">Because it needs to build .NET Core applications, MSBuild has been ported to .NET Core and can be used on any platform that .NET Core runs on.</span></span> <span data-ttu-id="7cd4b-115">Une des principales promesses de .NET Core réside dans une pile de développement multiplateforme, et nous avons veillé à ce que cette évolution n’entrave pas cette promesse.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-115">One of the main promises of .NET Core is that of a cross-platform development stack, and we have made sure that this move does not break that promise.</span></span>

> [!TIP]
> <span data-ttu-id="7cd4b-116">Si vous débutez avec MSBuild et que vous souhaitez en savoir plus à ce sujet, vous pouvez commencer par lire l’article [concepts de MSBuild](/visualstudio/msbuild/msbuild-concepts) .</span><span class="sxs-lookup"><span data-stu-id="7cd4b-116">If you are new to MSBuild and would like to learn more about it, you can start by reading the [MSBuild concepts](/visualstudio/msbuild/msbuild-concepts) article.</span></span>

## <a name="the-tooling-layers"></a><span data-ttu-id="7cd4b-117">Les couches des outils</span><span class="sxs-lookup"><span data-stu-id="7cd4b-117">The tooling layers</span></span>

<span data-ttu-id="7cd4b-118">Avec la modification dans le moteur de génération et l’éloignement du système de projet existant, certaines questions suivent naturellement.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-118">With the change in build engine and the move away from the existing project system, some questions naturally follow.</span></span> <span data-ttu-id="7cd4b-119">L’une de ces modifications modifie-t-elle la « superposition » globale de l’écosystème des outils .NET Core ?</span><span class="sxs-lookup"><span data-stu-id="7cd4b-119">Do any of these changes change the overall "layering" of the .NET Core tooling ecosystem?</span></span> <span data-ttu-id="7cd4b-120">Existe-t-il de nouvelles parties et composants ?</span><span class="sxs-lookup"><span data-stu-id="7cd4b-120">Are there new bits and components?</span></span>

<span data-ttu-id="7cd4b-121">Commençons par un rappel rapide de l’organisation en couches de Preview 2, comme l’illustre l’image suivante :</span><span class="sxs-lookup"><span data-stu-id="7cd4b-121">Let's start with a quick refresher on Preview 2 layering as shown in the following picture:</span></span>

![Architecture générale des outils Preview 2](media/cli-msbuild-architecture/p2-arch.png)

<span data-ttu-id="7cd4b-123">La superposition des outils de Preview 2 est simple.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-123">The layering of the tools in Preview 2 is straightforward.</span></span> <span data-ttu-id="7cd4b-124">En bas, la Fondation est le CLI .NET Core.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-124">At the bottom, the foundation is the .NET Core CLI.</span></span> <span data-ttu-id="7cd4b-125">Tous les autres outils de niveau supérieur, tels que Visual Studio ou Visual Studio Code, dépendent de l’interface CLI pour générer des projets, restaurer des dépendances, etc.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-125">All other, higher-level tools, such as Visual Studio or Visual Studio Code, depend and rely on the CLI to build projects, restore dependencies, and so on.</span></span> <span data-ttu-id="7cd4b-126">Par exemple, si Visual Studio souhaite effectuer une opération de restauration, il appelle la commande `dotnet restore` ([Voir la remarque](#dotnet-restore-note)) dans l’interface CLI.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-126">For example, if Visual Studio wanted to perform a restore operation, it would call into the `dotnet restore` ([see note](#dotnet-restore-note)) command in the CLI.</span></span>

<span data-ttu-id="7cd4b-127">Avec le passage au nouveau système de projet, le schéma précédent change :</span><span class="sxs-lookup"><span data-stu-id="7cd4b-127">With the move to the new project system, the previous diagram changes:</span></span>

![Architecture générale du SDK .NET Core 1.0.0](media/cli-msbuild-architecture/p3-arch.png)

<span data-ttu-id="7cd4b-129">La principale différence est que l’interface de ligne de commande n’est plus la couche de base, ce rôle étant rempli par le « composant SDK partagé ».</span><span class="sxs-lookup"><span data-stu-id="7cd4b-129">The main difference is that the CLI is not the foundational layer anymore; this role is now filled by the "shared SDK component".</span></span> <span data-ttu-id="7cd4b-130">Ce composant SDK partagé est un ensemble de cibles et de tâches associées qui sont responsables de la compilation du code, de sa publication, de l’empaquetage des packages NuGet, etc.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-130">This shared SDK component is a set of targets and associated tasks that are responsible for compiling code, publishing it, packing NuGet packages, and so on.</span></span> <span data-ttu-id="7cd4b-131">Le kit SDK .NET Core est open source et est disponible sur GitHub sur le [référentiel SDK](https://github.com/dotnet/sdk).</span><span class="sxs-lookup"><span data-stu-id="7cd4b-131">The .NET Core SDK is open-source and is available on GitHub on the [SDK repo](https://github.com/dotnet/sdk).</span></span>

> [!NOTE]
> <span data-ttu-id="7cd4b-132">Une « cible » est un terme MSBuild qui indique une opération nommée que MSBuild peut appeler.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-132">A "target" is an MSBuild term that indicates a named operation that MSBuild can invoke.</span></span> <span data-ttu-id="7cd4b-133">Elle est généralement associée à une ou plusieurs tâches qui exécutent une logique que la cible est supposée effectuer.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-133">It is usually coupled with one or more tasks that execute some logic that the target is supposed to do.</span></span> <span data-ttu-id="7cd4b-134">MSBuild prend en charge plusieurs cibles prédéfinies telles que `Copy` ou `Execute`, et permet aussi aux utilisateurs d’écrire leurs propres tâches à l’aide de code managé et de définir des cibles pour exécuter ces tâches.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-134">MSBuild supports many ready-made targets such as `Copy` or `Execute`; it also allows users to write their own tasks using managed code and define targets to execute those tasks.</span></span> <span data-ttu-id="7cd4b-135">Pour plus d’informations, consultez [Tâches MSBuild](/visualstudio/msbuild/msbuild-tasks).</span><span class="sxs-lookup"><span data-stu-id="7cd4b-135">For more information, see [MSBuild tasks](/visualstudio/msbuild/msbuild-tasks).</span></span>

<span data-ttu-id="7cd4b-136">Tous les ensembles d’outils utilisent désormais le composant SDK partagé et ses cibles, interface de ligne de commande incluse.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-136">All the toolsets now consume the shared SDK component and its targets, CLI included.</span></span> <span data-ttu-id="7cd4b-137">Par exemple, Visual Studio 2019 n’appelle pas la commande `dotnet restore` ([Voir la remarque](#dotnet-restore-note)) pour restaurer les dépendances des projets .net core.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-137">For example, Visual Studio 2019 doesn't call into the `dotnet restore` ([see note](#dotnet-restore-note)) command to restore dependencies for .NET Core projects.</span></span> <span data-ttu-id="7cd4b-138">Au lieu de cela, il utilise directement la cible « Restore ».</span><span class="sxs-lookup"><span data-stu-id="7cd4b-138">Instead, it uses the "Restore" target directly.</span></span> <span data-ttu-id="7cd4b-139">Comme il s’agit de cibles de MSBuild, vous pouvez également utiliser MSBuild sous forme brute pour les exécuter à l’aide de la commande [dotnet msbuild](dotnet-msbuild.md).</span><span class="sxs-lookup"><span data-stu-id="7cd4b-139">Since these are MSBuild targets, you can also use raw MSBuild to execute them using the [dotnet msbuild](dotnet-msbuild.md) command.</span></span>

### <a name="cli-commands"></a><span data-ttu-id="7cd4b-140">Commandes CLI</span><span class="sxs-lookup"><span data-stu-id="7cd4b-140">CLI commands</span></span>

<span data-ttu-id="7cd4b-141">Le composant SDK partagé signifie que la majorité des commandes CLI existantes ont été réimplémentées en tant que cibles et tâches MSBuild.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-141">The shared SDK component means that the majority of existing CLI commands have been reimplemented as MSBuild tasks and targets.</span></span> <span data-ttu-id="7cd4b-142">Que cela signifie-t-il pour les commandes CLI et votre utilisation de l’ensemble d’outils ?</span><span class="sxs-lookup"><span data-stu-id="7cd4b-142">What does this mean for the CLI commands and your usage of the toolset?</span></span>

<span data-ttu-id="7cd4b-143">Du point de vue de l’utilisation, il ne modifie pas la façon dont vous utilisez l’interface CLI.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-143">From a usage perspective, it doesn't change the way you use the CLI.</span></span> <span data-ttu-id="7cd4b-144">L’interface CLI possède toujours les commandes de base qui existaient dans la version préliminaire 2 de .NET Core 1,0 :</span><span class="sxs-lookup"><span data-stu-id="7cd4b-144">The CLI still has the core commands that existed in the .NET Core 1.0 Preview 2 release:</span></span>

- `new`
- `restore`
- `run`
- `build`
- `publish`
- `test`
- `pack`

<span data-ttu-id="7cd4b-145">Ces commandes effectuent toujours ce que vous attendez (créer un projet, le générer, le publier, le compresser, etc.).</span><span class="sxs-lookup"><span data-stu-id="7cd4b-145">These commands still do what you expect them to do (new up a project, build it, publish it, pack it, and so on).</span></span> <span data-ttu-id="7cd4b-146">Vous pouvez consulter l’écran d’aide de la commande (à l’aide de `dotnet <command> --help`) ou la documentation sur ce site pour vous familiariser avec leur comportement.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-146">You can consult either the command's help screen (using `dotnet <command> --help`) or documentation on this site to get familiar with their behavior.</span></span>

<span data-ttu-id="7cd4b-147">Du point de vue de l’exécution, les commandes CLI prennent leurs paramètres et construisent un appel à MSBuild « RAW » qui définit les propriétés nécessaires et exécute la cible souhaitée.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-147">From an execution perspective, the CLI commands take their parameters and construct a call to "raw" MSBuild that sets the needed properties and runs the desired target.</span></span> <span data-ttu-id="7cd4b-148">Pour mieux illustrer ce propos, considérons la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="7cd4b-148">To better illustrate this, consider the following command:</span></span>

   ```dotnetcli
   dotnet publish -o pub -c Release
   ```

<span data-ttu-id="7cd4b-149">Cette commande publie une application dans un dossier `pub` à l’aide de la configuration « Release ».</span><span class="sxs-lookup"><span data-stu-id="7cd4b-149">This command publishes an application into a `pub` folder using the "Release" configuration.</span></span> <span data-ttu-id="7cd4b-150">En interne, cette commande se traduit par l’appel MSBuild suivant :</span><span class="sxs-lookup"><span data-stu-id="7cd4b-150">Internally, this command gets translated into the following MSBuild invocation:</span></span>

   ```dotnetcli
   dotnet msbuild -t:Publish -p:OutputPath=pub -p:Configuration=Release
   ```

<span data-ttu-id="7cd4b-151">Les exceptions notables à cette règle sont les commandes `new` et `run`.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-151">Notable exceptions to this rule are the `new` and `run` commands.</span></span> <span data-ttu-id="7cd4b-152">Elles n’ont pas été implémentées en tant que cibles MSBuild.</span><span class="sxs-lookup"><span data-stu-id="7cd4b-152">They have not been implemented as MSBuild targets.</span></span>

<a name="dotnet-restore-note"></a>
[!INCLUDE[DotNet Restore Note](~/includes/dotnet-restore-note.md)]

---
title: Restauration par progression du runtime pour les déploiements d’applications autonomes .NET Core.
description: Découvrez-en plus sur les modifications apportées à la commande dotnet publish pour les déploiements autonomes.
author: KathleenDollard
ms.date: 05/31/2018
ms.custom: seodec18
ms.openlocfilehash: 6a0cdfb34973822c2f40cdb37d4038d3b7ad8e2a
ms.sourcegitcommit: 4f4a32a5c16a75724920fa9627c59985c41e173c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/17/2019
ms.locfileid: "72522090"
---
# <a name="self-contained-deployment-runtime-roll-forward"></a><span data-ttu-id="6cf33-103">Restauration par progression du runtime de déploiement autonome</span><span class="sxs-lookup"><span data-stu-id="6cf33-103">Self-contained deployment runtime roll forward</span></span>

<span data-ttu-id="6cf33-104">[Les déploiements d’applications autonomes](index.md) .NET Core incluent à la fois les bibliothèques .NET Core et le runtime .NET Core.</span><span class="sxs-lookup"><span data-stu-id="6cf33-104">.NET Core [self-contained application deployments](index.md) include both the .NET Core libraries and the .NET Core runtime.</span></span> <span data-ttu-id="6cf33-105">À compter du SDK .NET Core 2.1 (version 2.1.300), un déploiement d’applications autonome [publie le runtime du correctif le plus élevé sur votre machine](https://github.com/dotnet/designs/pull/36).</span><span class="sxs-lookup"><span data-stu-id="6cf33-105">Starting in .NET Core 2.1 SDK (version 2.1.300), a self-contained application deployment [publishes the highest patch runtime on your machine](https://github.com/dotnet/designs/pull/36).</span></span> <span data-ttu-id="6cf33-106">Par défaut, [`dotnet publish`](../tools/dotnet-publish.md) pour un déploiement autonome sélectionne la dernière version installée dans le cadre du SDK sur la machine de publication.</span><span class="sxs-lookup"><span data-stu-id="6cf33-106">By default, [`dotnet publish`](../tools/dotnet-publish.md) for a self-contained deployment selects the latest version installed as part of the SDK on the publishing machine.</span></span> <span data-ttu-id="6cf33-107">Ainsi, votre application déployée peut exécuter des correctifs de sécurité (et d’autres correctifs) disponibles pendant `publish`.</span><span class="sxs-lookup"><span data-stu-id="6cf33-107">This enables your deployed application to run with security fixes (and other fixes) available during `publish`.</span></span> <span data-ttu-id="6cf33-108">L’application doit être republiée pour obtenir un nouveau correctif.</span><span class="sxs-lookup"><span data-stu-id="6cf33-108">The application must be re-published to obtain a new patch.</span></span> <span data-ttu-id="6cf33-109">Les applications autonomes sont créées en spécifiant `-r <RID>` dans la commande `dotnet publish` ou en spécifiant l’[identificateur du runtime (RID)](../rid-catalog.md) dans le fichier projet (csproj/vbproj) ou sur la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="6cf33-109">Self-contained applications are created by specifying `-r <RID>` on the `dotnet publish` command or by specifying the [runtime identifier (RID)](../rid-catalog.md) in the project file (csproj / vbproj) or on the command line.</span></span>

## <a name="patch-version-roll-forward-overview"></a><span data-ttu-id="6cf33-110">Vue d’ensemble de la restauration par progression d’une version de correctif</span><span class="sxs-lookup"><span data-stu-id="6cf33-110">Patch version roll forward overview</span></span>

<span data-ttu-id="6cf33-111">[`restore`](../tools/dotnet-restore.md), [`build`](../tools/dotnet-build.md) et [`publish`](../tools/dotnet-publish.md) sont des commandes `dotnet` exécutables séparément.</span><span class="sxs-lookup"><span data-stu-id="6cf33-111">[`restore`](../tools/dotnet-restore.md), [`build`](../tools/dotnet-build.md) and [`publish`](../tools/dotnet-publish.md) are `dotnet` commands that can run separately.</span></span> <span data-ttu-id="6cf33-112">Le choix du runtime fait partie de l’opération `restore`, et non de `publish` ou `build`.</span><span class="sxs-lookup"><span data-stu-id="6cf33-112">The runtime choice is part of the `restore` operation, not `publish` or `build`.</span></span> <span data-ttu-id="6cf33-113">Si vous appelez `publish`, la dernière version du correctif est choisie.</span><span class="sxs-lookup"><span data-stu-id="6cf33-113">If you call `publish`, the latest patch version will be chosen.</span></span> <span data-ttu-id="6cf33-114">Si vous appelez `publish` avec l’argument `--no-restore`, alors vous risquez de ne pas obtenir la version de correctif voulue, car un `restore` antérieur n’a peut-être pas été exécuté avec la nouvelle stratégie de publication des applications autonomes.</span><span class="sxs-lookup"><span data-stu-id="6cf33-114">If you call `publish` with the `--no-restore` argument, then you may not get the desired patch version because a prior `restore` may not have been executed with the new self-contained application publishing policy.</span></span> <span data-ttu-id="6cf33-115">Dans ce cas, une erreur de build est générée avec un texte similaire au suivant :</span><span class="sxs-lookup"><span data-stu-id="6cf33-115">In this case, a build error is generated with text similar to the following:</span></span>

  <span data-ttu-id="6cf33-116">« Le projet a été restauré à l’aide de Microsoft.NETCore.App version 2.0.0, mais avec les paramètres actuels, la version 2.0.6 serait plutôt utilisée.</span><span class="sxs-lookup"><span data-stu-id="6cf33-116">"The project was restored using Microsoft.NETCore.App version 2.0.0, but with current settings, version 2.0.6 would be used instead.</span></span> <span data-ttu-id="6cf33-117">Pour résoudre ce problème, vérifiez que les mêmes paramètres sont utilisés pour la restauration et pour les opérations suivantes telles que la génération ou la publication.</span><span class="sxs-lookup"><span data-stu-id="6cf33-117">To resolve this issue, make sure the same settings are used for restore and for subsequent operations such as build or publish.</span></span> <span data-ttu-id="6cf33-118">En général, ce problème peut se produire si la propriété RuntimeIdentifier est définie au pendant la génération ou la publication mais pas pendant la restauration. »</span><span class="sxs-lookup"><span data-stu-id="6cf33-118">Typically this issue can occur if the RuntimeIdentifier property is set during build or publish but not during restore."</span></span>

> [!NOTE]
> <span data-ttu-id="6cf33-119">`restore` et `build` peut être exécutées implicitement dans le cadre d’une autre commande, comme `publish`.</span><span class="sxs-lookup"><span data-stu-id="6cf33-119">`restore` and `build` can be run implicitly as part of another command, like `publish`.</span></span> <span data-ttu-id="6cf33-120">Quand vous exécutez une commande implicitement dans le cadre d’une autre commande, un contexte supplémentaire est fourni afin de produire les artefacts adéquats.</span><span class="sxs-lookup"><span data-stu-id="6cf33-120">When run implicitly as part of another command, they are provided with additional context so that the right artifacts are produced.</span></span> <span data-ttu-id="6cf33-121">Quand vous exécutez une commande `publish` avec un runtime (par exemple, `dotnet publish -r linux-x64`), la commande `restore` implicite restaure les packages du runtime linux-x64.</span><span class="sxs-lookup"><span data-stu-id="6cf33-121">When you `publish` with a runtime (for example, `dotnet publish -r linux-x64`), the implicit `restore` restores packages for the linux-x64 runtime.</span></span> <span data-ttu-id="6cf33-122">Si vous appelez `restore` explicitement, les packages du runtime ne sont pas restaurés par défaut, car ce contexte n’est pas fourni.</span><span class="sxs-lookup"><span data-stu-id="6cf33-122">If you call `restore` explicitly, it does not restore runtime packages by default, because it doesn't have that context.</span></span>

## <a name="how-to-avoid-restore-during-publish"></a><span data-ttu-id="6cf33-123">Comment éviter la restauration pendant la publication</span><span class="sxs-lookup"><span data-stu-id="6cf33-123">How to avoid restore during publish</span></span>

<span data-ttu-id="6cf33-124">L’exécution de `restore` dans le cadre de l’opération `publish` peut ne pas convenir à votre scénario.</span><span class="sxs-lookup"><span data-stu-id="6cf33-124">Running `restore` as part of the `publish` operation may be undesirable for your scenario.</span></span> <span data-ttu-id="6cf33-125">Pour éviter `restore` pendant `publish` quand vous créez des applications autonomes, procédez effectuez les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="6cf33-125">To avoid `restore` during `publish` while creating self-contained applications, do the following:</span></span>

- <span data-ttu-id="6cf33-126">Définissez la propriété `RuntimeIdentifiers` sur une liste séparée par des points-virgules de tous les [RID](../rid-catalog.md) à publier.</span><span class="sxs-lookup"><span data-stu-id="6cf33-126">Set the `RuntimeIdentifiers` property to a semicolon-separated list of all the [RIDs](../rid-catalog.md) to be published.</span></span>
- <span data-ttu-id="6cf33-127">Affectez à la propriété `TargetLatestRuntimePatch` la valeur `true`.</span><span class="sxs-lookup"><span data-stu-id="6cf33-127">Set the `TargetLatestRuntimePatch` property to `true`.</span></span>

## <a name="no-restore-argument-with-dotnet-publish-options"></a><span data-ttu-id="6cf33-128">Argument No-restore avec des options dotnet publish</span><span class="sxs-lookup"><span data-stu-id="6cf33-128">No-restore argument with dotnet publish options</span></span>

<span data-ttu-id="6cf33-129">Pour créer à la fois des applications autonomes et des [applications dépendant du framework](index.md) avec le même fichier projet, quand vous voulez utiliser l’argument `--no-restore` avec `dotnet publish`, choisissez l’une des possibilités suivantes :</span><span class="sxs-lookup"><span data-stu-id="6cf33-129">If you want to create both self-contained applications and [framework-dependent applications](index.md) with the same project file, and you want to use the `--no-restore` argument with `dotnet publish`, then choose one of the following:</span></span>

1. <span data-ttu-id="6cf33-130">Préférez le comportement dépendant du framework.</span><span class="sxs-lookup"><span data-stu-id="6cf33-130">Prefer the framework-dependent behavior.</span></span> <span data-ttu-id="6cf33-131">Si l’application dépend du framework, il s’agit du comportement par défaut.</span><span class="sxs-lookup"><span data-stu-id="6cf33-131">If the application is framework-dependent, this is the default behavior.</span></span> <span data-ttu-id="6cf33-132">Si l’application est autonome et peut utiliser un runtime local 2.1.0 sans correctif, définissez `TargetLatestRuntimePatch` sur `false` dans le fichier projet.</span><span class="sxs-lookup"><span data-stu-id="6cf33-132">If the application is self-contained, and can use an unpatched 2.1.0 local runtime, set the `TargetLatestRuntimePatch` to `false` in the project file.</span></span>

2. <span data-ttu-id="6cf33-133">Préférez le comportement autonome.</span><span class="sxs-lookup"><span data-stu-id="6cf33-133">Prefer the self-contained behavior.</span></span> <span data-ttu-id="6cf33-134">Si l’application est autonome, il s’agit du comportement par défaut.</span><span class="sxs-lookup"><span data-stu-id="6cf33-134">If the application is self-contained, this is the default behavior.</span></span> <span data-ttu-id="6cf33-135">Si l’application dépend du framework et nécessite l’installation du dernier correctif, définissez `TargetLatestRuntimePatch` sur `true` dans le fichier projet.</span><span class="sxs-lookup"><span data-stu-id="6cf33-135">If the application is framework-dependent, and requires the latest patch installed, set `TargetLatestRuntimePatch` to `true` in the project file.</span></span>

3. <span data-ttu-id="6cf33-136">Prenez le contrôle explicite de la version du framework du runtime en définissant `RuntimeFrameworkVersion` sur la version de correctif spécifique dans le fichier projet.</span><span class="sxs-lookup"><span data-stu-id="6cf33-136">Take explicit control of the runtime framework version by setting `RuntimeFrameworkVersion` to the specific patch version in the project file.</span></span>

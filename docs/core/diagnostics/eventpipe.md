---
title: Présentation de EventPipe
description: Découvrez EventPipe et comment l’utiliser pour effectuer le suivi de vos applications .NET afin de diagnostiquer les problèmes de performances.
ms.date: 11/09/2020
ms.topic: overview
ms.openlocfilehash: d30cdf02c3ae300401febe2078dfd3431269c73e
ms.sourcegitcommit: 34968a61e9bac0f6be23ed6ffb837f52d2390c85
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/17/2020
ms.locfileid: "94688572"
---
# <a name="eventpipe"></a><span data-ttu-id="e698e-103">EventPipe</span><span class="sxs-lookup"><span data-stu-id="e698e-103">EventPipe</span></span>

<span data-ttu-id="e698e-104">EventPipe est un composant d’exécution qui peut être utilisé pour collecter des données de suivi, comme ETW ou LTTng.</span><span class="sxs-lookup"><span data-stu-id="e698e-104">EventPipe is a runtime component that can be used to collect tracing data, similar to ETW or LTTng.</span></span> <span data-ttu-id="e698e-105">L’objectif de EventPipe est de permettre aux développeurs .NET de suivre facilement leurs applications .NET sans avoir à s’appuyer sur des composants natifs du système d’exploitation spécifiques à la plateforme, tels que ETW ou LTTng.</span><span class="sxs-lookup"><span data-stu-id="e698e-105">The goal of EventPipe is to allow .NET developers to easily trace their .NET applications without having to rely on platform-specific OS-native components such as ETW or LTTng.</span></span>

<span data-ttu-id="e698e-106">EventPipe est le mécanisme qui sous-tend un grand nombre d’outils de diagnostic et qui peut être utilisé pour consommer des événements émis par le runtime ainsi que des événements personnalisés écrits avec [EventSource](xref:System.Diagnostics.Tracing.EventSource).</span><span class="sxs-lookup"><span data-stu-id="e698e-106">EventPipe is the mechanism behind many of the diagnostic tools and can be used for consuming events emitted by the runtime as well as custom events written with [EventSource](xref:System.Diagnostics.Tracing.EventSource).</span></span>

<span data-ttu-id="e698e-107">Cet article est une vue d’ensemble de EventPipe qui décrit quand et comment utiliser EventPipe et comment le configurer en fonction de vos besoins.</span><span class="sxs-lookup"><span data-stu-id="e698e-107">This article is a high-level overview of EventPipe describing when and how to use EventPipe, and how to configure it to best suit your needs.</span></span>

## <a name="eventpipe-basics"></a><span data-ttu-id="e698e-108">Notions de base de EventPipe</span><span class="sxs-lookup"><span data-stu-id="e698e-108">EventPipe basics</span></span>

<span data-ttu-id="e698e-109">EventPipe agrège les événements émis par les composants d’exécution (par exemple, le compilateur juste-à-temps ou le garbage collector) et les événements écrits à partir d’instances [EventSource](xref:System.Diagnostics.Tracing.EventSource) dans les bibliothèques et le code utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e698e-109">EventPipe aggregates events emitted by runtime components - for example, the Just-In-Time compiler or the garbage collector - and events written from [EventSource](xref:System.Diagnostics.Tracing.EventSource) instances in the libraries and user code.</span></span>

<span data-ttu-id="e698e-110">Les événements sont ensuite sérialisés et peuvent être écrits directement dans un fichier ou utilisés par le biais d’un port de diagnostic.</span><span class="sxs-lookup"><span data-stu-id="e698e-110">The events are then serialized and can be written directly to a file or consumed through a Diagnostics Port from out-of-proces.</span></span> <span data-ttu-id="e698e-111">Sur Windows, les ports de diagnostic sont implémentés en tant que `NamedPipe` s.</span><span class="sxs-lookup"><span data-stu-id="e698e-111">On Windows, Diagnostic Ports are implemented as `NamedPipe`s.</span></span> <span data-ttu-id="e698e-112">Sur les plateformes autres que Windows, telles que Linux ou macOS, elles sont implémentées à l’aide de sockets de domaine UNIX.</span><span class="sxs-lookup"><span data-stu-id="e698e-112">On non-Windows platforms, such as Linux or macOS, it is implemented using Unix Domain Sockets.</span></span> <span data-ttu-id="e698e-113">Pour plus d’informations sur le port de diagnostic et sur la manière d’interagir avec lui via son protocole de communication interprocessus personnalisé, consultez la [documentation relative au protocole IPC pour les diagnostics](https://github.com/dotnet/diagnostics/blob/master/documentation/design-docs/ipc-protocol.md).</span><span class="sxs-lookup"><span data-stu-id="e698e-113">For more information about the Diagnostics Port and how to interact with it via its custom inter-process communication protocol, see the [diagnostics IPC protocol documentation](https://github.com/dotnet/diagnostics/blob/master/documentation/design-docs/ipc-protocol.md).</span></span>

<span data-ttu-id="e698e-114">EventPipe écrit ensuite les événements sérialisés au `.nettrace` format de fichier sous forme de flux via des ports de diagnostic ou directement dans un fichier.</span><span class="sxs-lookup"><span data-stu-id="e698e-114">EventPipe then writes the serialized events in the `.nettrace` file format, either as a stream via Diagnostic Ports or directly to a file.</span></span> <span data-ttu-id="e698e-115">Pour en savoir plus sur le format de sérialisation EventPipe, reportez-vous à la [documentation de format EventPipe](https://github.com/microsoft/perfview/blob/master/src/TraceEvent/EventPipe/EventPipeFormat.md).</span><span class="sxs-lookup"><span data-stu-id="e698e-115">To learn more about the EventPipe serialization format, refer to the [EventPipe format documentation](https://github.com/microsoft/perfview/blob/master/src/TraceEvent/EventPipe/EventPipeFormat.md).</span></span>

## <a name="eventpipe-vs-etwlttng"></a><span data-ttu-id="e698e-116">EventPipe et ETW/LTTng</span><span class="sxs-lookup"><span data-stu-id="e698e-116">EventPipe vs. ETW/LTTng</span></span>

<span data-ttu-id="e698e-117">EventPipe fait partie du .NET Runtime (CoreCLR) et est conçu pour fonctionner de la même façon sur toutes les plateformes prises en charge par .NET Core.</span><span class="sxs-lookup"><span data-stu-id="e698e-117">EventPipe is part of the .NET runtime (CoreCLR) and is designed to work the same way across all the platforms .NET Core supports.</span></span> <span data-ttu-id="e698e-118">Cela permet aux outils de suivi basés sur EventPipe, tels que `dotnet-counters` , `dotnet-gcdump` et `dotnet-trace` , de fonctionner de manière transparente entre les plateformes.</span><span class="sxs-lookup"><span data-stu-id="e698e-118">This allows tracing tools based on EventPipe, such as `dotnet-counters`, `dotnet-gcdump`, and `dotnet-trace`, to work seamlessly across platforms.</span></span>

<span data-ttu-id="e698e-119">Toutefois, étant donné que EventPipe est un composant d’exécution intégré, sa portée est limitée au code managé et au runtime lui-même.</span><span class="sxs-lookup"><span data-stu-id="e698e-119">However, because EventPipe is a runtime built-in component, its scope is limited to managed code and the runtime itself.</span></span> <span data-ttu-id="e698e-120">EventPipe ne peut pas être utilisé pour le suivi de certains événements de niveau inférieur, tels que la résolution de la pile de code natif ou l’obtention de différents événements de noyau.</span><span class="sxs-lookup"><span data-stu-id="e698e-120">EventPipe cannot be used for tracking some lower-level events, such as resolving native code stack or getting various kernel events.</span></span> <span data-ttu-id="e698e-121">Si vous utilisez l’interopérabilité C/C++ dans votre application ou si vous souhaitez suivre le runtime lui-même (qui est écrit en C++), ou si vous souhaitez des diagnostics plus approfondis dans le comportement de l’application qui requiert des événements de noyau (c’est-à-dire des événements de basculement de contexte de thread natif), vous devez utiliser ETW ou [perf/LTTng](./trace-perfcollect-lttng.md).</span><span class="sxs-lookup"><span data-stu-id="e698e-121">If you use C/C++ interop in your app or you want to trace the runtime itself (which is written in C++), or want deeper diagnostics into the behavior of the app that requires kernel events (that is, native-thread context-switching events) you should use ETW or [perf/LTTng](./trace-perfcollect-lttng.md).</span></span>

<span data-ttu-id="e698e-122">Une autre différence majeure entre EventPipe et ETW/LTTng est l’exigence d’un privilège d’administration/racine.</span><span class="sxs-lookup"><span data-stu-id="e698e-122">Another major difference between EventPipe and ETW/LTTng is admin/root privilege requirement.</span></span> <span data-ttu-id="e698e-123">Pour effectuer le suivi d’une application à l’aide de ETW ou LTTng, vous devez être administrateur/racine.</span><span class="sxs-lookup"><span data-stu-id="e698e-123">To trace an application using ETW or LTTng you need to be an admin/root.</span></span> <span data-ttu-id="e698e-124">À l’aide de EventPipe, vous pouvez tracer des applications tant que le traceur (par exemple, `dotnet-trace` ) est exécuté en tant qu’utilisateur qui a lancé l’application.</span><span class="sxs-lookup"><span data-stu-id="e698e-124">Using EventPipe, you can trace applications as long as the tracer (for example, `dotnet-trace`) is run as the same user as the user that launched the application.</span></span>

<span data-ttu-id="e698e-125">Le tableau suivant résume les différences entre EventPipe et ETW/LTTng.</span><span class="sxs-lookup"><span data-stu-id="e698e-125">The following table is a summary of the differences between EventPipe and ETW/LTTng.</span></span>

|<span data-ttu-id="e698e-126">Fonctionnalité</span><span class="sxs-lookup"><span data-stu-id="e698e-126">Feature</span></span>|<span data-ttu-id="e698e-127">EventPipe</span><span class="sxs-lookup"><span data-stu-id="e698e-127">EventPipe</span></span>|<span data-ttu-id="e698e-128">ETW</span><span class="sxs-lookup"><span data-stu-id="e698e-128">ETW</span></span>|<span data-ttu-id="e698e-129">LTTng</span><span class="sxs-lookup"><span data-stu-id="e698e-129">LTTng</span></span>|
|-------|---------|---|-----------|
|<span data-ttu-id="e698e-130">Système multiplateforme</span><span class="sxs-lookup"><span data-stu-id="e698e-130">Cross-platform</span></span>|<span data-ttu-id="e698e-131">Oui</span><span class="sxs-lookup"><span data-stu-id="e698e-131">Yes</span></span>|<span data-ttu-id="e698e-132">Non (uniquement sur Windows)</span><span class="sxs-lookup"><span data-stu-id="e698e-132">No (only on Windows)</span></span>|<span data-ttu-id="e698e-133">Non (uniquement sur les distributions Linux pris en charge)</span><span class="sxs-lookup"><span data-stu-id="e698e-133">No (only on supported Linux distros)</span></span>|
|<span data-ttu-id="e698e-134">Exiger un privilège d’administrateur/racine</span><span class="sxs-lookup"><span data-stu-id="e698e-134">Require admin/root privilege</span></span>|<span data-ttu-id="e698e-135">Non</span><span class="sxs-lookup"><span data-stu-id="e698e-135">No</span></span>|<span data-ttu-id="e698e-136">Oui</span><span class="sxs-lookup"><span data-stu-id="e698e-136">Yes</span></span>|<span data-ttu-id="e698e-137">Oui</span><span class="sxs-lookup"><span data-stu-id="e698e-137">Yes</span></span>|
|<span data-ttu-id="e698e-138">Peut recevoir des événements du système d’exploitation/noyau</span><span class="sxs-lookup"><span data-stu-id="e698e-138">Can get OS/kernel events</span></span>|<span data-ttu-id="e698e-139">Non</span><span class="sxs-lookup"><span data-stu-id="e698e-139">No</span></span>|<span data-ttu-id="e698e-140">Oui</span><span class="sxs-lookup"><span data-stu-id="e698e-140">Yes</span></span>|<span data-ttu-id="e698e-141">Oui</span><span class="sxs-lookup"><span data-stu-id="e698e-141">Yes</span></span>|
|<span data-ttu-id="e698e-142">Peut résoudre les piles natifs</span><span class="sxs-lookup"><span data-stu-id="e698e-142">Can resolve native callstacks</span></span>|<span data-ttu-id="e698e-143">Non</span><span class="sxs-lookup"><span data-stu-id="e698e-143">No</span></span>|<span data-ttu-id="e698e-144">Oui</span><span class="sxs-lookup"><span data-stu-id="e698e-144">Yes</span></span>|<span data-ttu-id="e698e-145">Oui</span><span class="sxs-lookup"><span data-stu-id="e698e-145">Yes</span></span>|

## <a name="use-eventpipe-to-trace-your-net-application"></a><span data-ttu-id="e698e-146">Utiliser EventPipe pour tracer votre application .NET</span><span class="sxs-lookup"><span data-stu-id="e698e-146">Use EventPipe to trace your .NET application</span></span>

<span data-ttu-id="e698e-147">Vous pouvez utiliser EventPipe pour effectuer le suivi de votre application .NET de plusieurs façons :</span><span class="sxs-lookup"><span data-stu-id="e698e-147">You can use EventPipe to trace your .NET application in many ways:</span></span>

* <span data-ttu-id="e698e-148">Utilisez l’un des [outils de diagnostic](#tools-using-eventpipe) basés sur EventPipe.</span><span class="sxs-lookup"><span data-stu-id="e698e-148">Use one of the [diagnostics tools](#tools-using-eventpipe) that are built on top of EventPipe.</span></span>

* <span data-ttu-id="e698e-149">Utilisez la bibliothèque [Microsoft. Diagnostics. Netcore. client](https://github.com/dotnet/diagnostics/blob/master/documentation/diagnostics-client-library-instructions.md) pour écrire votre propre outil afin de configurer et de démarrer vous-même les sessions EventPipe.</span><span class="sxs-lookup"><span data-stu-id="e698e-149">Use [Microsoft.Diagnostics.NETCore.Client](https://github.com/dotnet/diagnostics/blob/master/documentation/diagnostics-client-library-instructions.md) library to write your own tool to configure and start EventPipe sessions yourself.</span></span>

* <span data-ttu-id="e698e-150">Utilisez des [variables d’environnement](#trace-using-environment-variables) pour démarrer EventPipe.</span><span class="sxs-lookup"><span data-stu-id="e698e-150">Use [environment variables](#trace-using-environment-variables) to start EventPipe.</span></span>

<span data-ttu-id="e698e-151">Une fois que vous avez créé un `nettrace` fichier qui contient vos événements EventPipe, vous pouvez afficher le fichier dans [`PerfView`](https://github.com/Microsoft/perfview#perfview-overview) ou Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e698e-151">After you've produced a `nettrace` file that contains your EventPipe events, you can view the file in [`PerfView`](https://github.com/Microsoft/perfview#perfview-overview) or Visual Studio.</span></span> <span data-ttu-id="e698e-152">Sur les plateformes non-Windows, vous pouvez convertir le `nettrace` fichier au `speedscope` format de suivi ou à `Chromium` l’aide de la [`dotnet-trace convert`](./dotnet-trace.md#dotnet-trace-convert) commande et l’afficher avec [`speedscope`](https://www.speedscope.app/) ou chrome devtools.</span><span class="sxs-lookup"><span data-stu-id="e698e-152">On non-Windows platforms, you can convert the `nettrace` file to a `speedscope` or `Chromium` trace format by using [`dotnet-trace convert`](./dotnet-trace.md#dotnet-trace-convert) command and view it with [`speedscope`](https://www.speedscope.app/) or Chrome DevTools.</span></span>

<span data-ttu-id="e698e-153">Vous pouvez également analyser les traces EventPipe par programmation avec [TraceEvent](https://github.com/Microsoft/perfview/blob/master/documentation/TraceEvent/TraceEventLibrary.md).</span><span class="sxs-lookup"><span data-stu-id="e698e-153">You can also analyze EventPipe traces programmatically with [TraceEvent](https://github.com/Microsoft/perfview/blob/master/documentation/TraceEvent/TraceEventLibrary.md).</span></span>

### <a name="tools-that-use-eventpipe"></a><span data-ttu-id="e698e-154">Outils qui utilisent EventPipe</span><span class="sxs-lookup"><span data-stu-id="e698e-154">Tools that use EventPipe</span></span>

<span data-ttu-id="e698e-155">Il s’agit du moyen le plus simple d’utiliser EventPipe pour tracer votre application.</span><span class="sxs-lookup"><span data-stu-id="e698e-155">This is the easiest way to use EventPipe to trace your application.</span></span> <span data-ttu-id="e698e-156">Pour en savoir plus sur l’utilisation de chacun de ces outils, reportez-vous à la documentation de chaque outil.</span><span class="sxs-lookup"><span data-stu-id="e698e-156">To learn more about how to use each of these tools, refer to each tool's documentation.</span></span>

* <span data-ttu-id="e698e-157">[dotnet-Counters](./dotnet-counters.md) vous permet de surveiller et de collecter différentes mesures émises par le Runtime .net et les bibliothèques de base, ainsi que des métriques personnalisées que vous pouvez écrire.</span><span class="sxs-lookup"><span data-stu-id="e698e-157">[dotnet-counters](./dotnet-counters.md) lets you monitor and collect various metrics emitted by the .NET runtime and core libraries, as well as custom metrics you can write.</span></span>

* <span data-ttu-id="e698e-158">[dotnet-gcdump](./dotnet-gcdump.md) vous permet de collecter les vidages de tas GC des processus en direct pour analyser le tas managé d’une application.</span><span class="sxs-lookup"><span data-stu-id="e698e-158">[dotnet-gcdump](./dotnet-gcdump.md) lets you collect GC heap dumps of live processes for analyzing an application's managed heap.</span></span>

* <span data-ttu-id="e698e-159">[dotnet-trace](./dotnet-trace.md) vous permet de collecter des traces d’applications pour analyser les performances.</span><span class="sxs-lookup"><span data-stu-id="e698e-159">[dotnet-trace](./dotnet-trace.md) lets you collect traces of applications to analyze for performance.</span></span>

## <a name="trace-using-environment-variables"></a><span data-ttu-id="e698e-160">Suivi à l’aide de variables d’environnement</span><span class="sxs-lookup"><span data-stu-id="e698e-160">Trace using environment variables</span></span>

<span data-ttu-id="e698e-161">Le mécanisme préféré pour l’utilisation de EventPipe consiste à utiliser `dotnet-trace` ou la `Microsoft.Diagnostics.NETCore.Client` bibliothèque.</span><span class="sxs-lookup"><span data-stu-id="e698e-161">The preferred mechanism for using EventPipe is to use `dotnet-trace` or the `Microsoft.Diagnostics.NETCore.Client` library.</span></span>

<span data-ttu-id="e698e-162">Toutefois, vous pouvez utiliser les variables d’environnement suivantes pour configurer une session EventPipe sur une application et faire en sorte qu’elle écrit directement la trace dans un fichier.</span><span class="sxs-lookup"><span data-stu-id="e698e-162">However, you can use the following environment variables to set up an EventPipe session on an app and have it write the trace directly to a file.</span></span> <span data-ttu-id="e698e-163">Pour arrêter le suivi, quittez l’application.</span><span class="sxs-lookup"><span data-stu-id="e698e-163">To stop tracing, exit the application.</span></span>

* <span data-ttu-id="e698e-164">`COMPlus_EnableEventPipe`: Définissez cette valeur sur `1` pour démarrer une session EventPipe qui écrit directement dans un fichier.</span><span class="sxs-lookup"><span data-stu-id="e698e-164">`COMPlus_EnableEventPipe`: Set this to `1` to start an EventPipe session that writes directly to a file.</span></span> <span data-ttu-id="e698e-165">La valeur par défaut est `0`.</span><span class="sxs-lookup"><span data-stu-id="e698e-165">The default value is `0`.</span></span>

* <span data-ttu-id="e698e-166">`COMPlus_EventPipeOutputPath`: Chemin d’accès au fichier de trace EventPipe de sortie lorsqu’il est configuré pour s’exécuter via `COMPlus_EnableEventPipe` .</span><span class="sxs-lookup"><span data-stu-id="e698e-166">`COMPlus_EventPipeOutputPath`: The path to the output EventPipe trace file when it's configured to run via `COMPlus_EnableEventPipe`.</span></span> <span data-ttu-id="e698e-167">La valeur par défaut est `trace.nettrace` , qui sera créée dans le répertoire à partir duquel l’application s’exécute.</span><span class="sxs-lookup"><span data-stu-id="e698e-167">The default value is `trace.nettrace`, which will be created in the same directory that the app is running from.</span></span>

* <span data-ttu-id="e698e-168">`COMPlus_CircularBufferMB`: Taille de la mémoire tampon interne utilisée par EventPipe lorsqu’elle est configurée pour s’exécuter via `COMPlus_EnableEventPipe` .</span><span class="sxs-lookup"><span data-stu-id="e698e-168">`COMPlus_CircularBufferMB`: The size of the internal buffer that is used by EventPipe when it's configured to run via `COMPlus_EnableEventPipe`.</span></span>

* <span data-ttu-id="e698e-169">`COMPlus_EventPipeConfig`: Définit la configuration de session EventPipe lors du démarrage d’une session EventPipe avec `COMPlus_EnableEventPipe` .</span><span class="sxs-lookup"><span data-stu-id="e698e-169">`COMPlus_EventPipeConfig`: Sets up the EventPipe session configuration when starting an EventPipe session with `COMPlus_EnableEventPipe`.</span></span>

  <span data-ttu-id="e698e-170">La syntaxe est la suivante :</span><span class="sxs-lookup"><span data-stu-id="e698e-170">The syntax is as follows:</span></span>

  `<provider>:<keyword>:<level>`

  <span data-ttu-id="e698e-171">Vous pouvez également spécifier plusieurs fournisseurs en les concaténant à l’aide d’une virgule :</span><span class="sxs-lookup"><span data-stu-id="e698e-171">You can also specify multiple providers by concatenating them with a comma:</span></span>

  `<provider1>:<keyword1>:<level1>,<provider2>:<keyword2>:<level2>`

  <span data-ttu-id="e698e-172">Si cette variable d’environnement n’est pas définie mais que EventPipe est activé par `COMPlus_EnableEventPipe` , elle démarre le suivi en activant les fournisseurs suivants avec les mots clés et les niveaux suivants :</span><span class="sxs-lookup"><span data-stu-id="e698e-172">If this environment variable is not set but EventPipe is enabled by `COMPlus_EnableEventPipe`, it will start tracing by enabling the following providers with the following keywords and levels:</span></span>

  - `Microsoft-Windows-DotNETRuntime:4c14fccbd:5`
  - `Microsoft-Windows-DotNETRuntimePrivate:4002000b:5`
  - `Microsoft-DotNETCore-SampleProfiler:0:5`

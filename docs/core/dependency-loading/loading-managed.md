---
title: Algorithme de chargement d’assembly managé-.NET Core
description: Description des détails de l’algorithme de chargement d’assembly managé dans .NET Core
ms.date: 08/09/2019
author: sdmaclea
ms.author: stmaclea
ms.openlocfilehash: bf95cbd0eebed064f0198ae9b0f7a4288a938f8a
ms.sourcegitcommit: 6f28b709592503d27077b16fff2e2eacca569992
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/28/2019
ms.locfileid: "70234639"
---
# <a name="managed-assembly-loading-algorithm"></a><span data-ttu-id="fd81f-103">Algorithme de chargement d’assembly managé</span><span class="sxs-lookup"><span data-stu-id="fd81f-103">Managed assembly loading algorithm</span></span>

<span data-ttu-id="fd81f-104">Les assemblys managés sont localisés et chargés à l’aide d’un algorithme impliquant différentes étapes.</span><span class="sxs-lookup"><span data-stu-id="fd81f-104">Managed assemblies are located and loaded with an algorithm involving various stages.</span></span>

<span data-ttu-id="fd81f-105">Tous les assemblys managés, à `WinRT` l’exception des assemblys satellites et des assemblys, utilisent le même algorithme.</span><span class="sxs-lookup"><span data-stu-id="fd81f-105">All managed assemblies except satellite assemblies and `WinRT` assemblies use the same algorithm.</span></span>

## <a name="when-are-managed-assemblies-loaded"></a><span data-ttu-id="fd81f-106">Quand les assemblys gérés sont-ils chargés?</span><span class="sxs-lookup"><span data-stu-id="fd81f-106">When are managed assemblies loaded?</span></span>

<span data-ttu-id="fd81f-107">Le mécanisme le plus courant pour déclencher un chargement d’assembly managé est une référence d’assembly statique.</span><span class="sxs-lookup"><span data-stu-id="fd81f-107">The most common mechanism to trigger a managed assembly load is a static assembly reference.</span></span> <span data-ttu-id="fd81f-108">Ces références sont insérées par le compilateur chaque fois que le code utilise un type défini dans un autre assembly.</span><span class="sxs-lookup"><span data-stu-id="fd81f-108">These references are inserted by the compiler whenever code uses a type defined in another assembly.</span></span> <span data-ttu-id="fd81f-109">Ces assemblys sont chargés (`load-by-name`) en fonction des besoins du Runtime.</span><span class="sxs-lookup"><span data-stu-id="fd81f-109">These assemblies are loaded (`load-by-name`) as needed by the runtime.</span></span>

<span data-ttu-id="fd81f-110">L’utilisation directe d’API spécifiques déclenche également des charges:</span><span class="sxs-lookup"><span data-stu-id="fd81f-110">The direct use of specific APIs will also trigger loads:</span></span>

|<span data-ttu-id="fd81f-111">API</span><span class="sxs-lookup"><span data-stu-id="fd81f-111">API</span></span>  |<span data-ttu-id="fd81f-112">Description</span><span class="sxs-lookup"><span data-stu-id="fd81f-112">Description</span></span>  |<span data-ttu-id="fd81f-113">`Active` <xref:System.Runtime.Loader.AssemblyLoadContext></span><span class="sxs-lookup"><span data-stu-id="fd81f-113">`Active` <xref:System.Runtime.Loader.AssemblyLoadContext></span></span> |
|---------|---------|---------|
|<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromAssemblyName%2A?displayProperty=nameWithType>|`Load-by-name`|<span data-ttu-id="fd81f-114">Instance [This](../../csharp/language-reference/keywords/this.md) .</span><span class="sxs-lookup"><span data-stu-id="fd81f-114">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
|<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromAssemblyPath%2A?displayProperty=nameWithType><p><xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromNativeImagePath%2A?displayProperty=nameWithType>|<span data-ttu-id="fd81f-115">Charger à partir du chemin d’accès.</span><span class="sxs-lookup"><span data-stu-id="fd81f-115">Load from path.</span></span>|<span data-ttu-id="fd81f-116">Instance [This](../../csharp/language-reference/keywords/this.md) .</span><span class="sxs-lookup"><span data-stu-id="fd81f-116">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromStream%2A?displayProperty=nameWithType>|<span data-ttu-id="fd81f-117">Charger à partir de l’objet.</span><span class="sxs-lookup"><span data-stu-id="fd81f-117">Load from object.</span></span>|<span data-ttu-id="fd81f-118">Instance [This](../../csharp/language-reference/keywords/this.md) .</span><span class="sxs-lookup"><span data-stu-id="fd81f-118">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
|<xref:System.Reflection.Assembly.LoadFile%2A?displayProperty=nameWithType>|<span data-ttu-id="fd81f-119">Charger à partir d’un chemin <xref:System.Runtime.Loader.AssemblyLoadContext> d’accès dans une nouvelle instance</span><span class="sxs-lookup"><span data-stu-id="fd81f-119">Load from path in a new <xref:System.Runtime.Loader.AssemblyLoadContext> instance</span></span>|<span data-ttu-id="fd81f-120">Nouvelle instance <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="fd81f-120">The new <xref:System.Runtime.Loader.AssemblyLoadContext> instance.</span></span>|
<xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType>|<span data-ttu-id="fd81f-121">Charge à partir du chemin <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> d’accès dans l’instance.</span><span class="sxs-lookup"><span data-stu-id="fd81f-121">Load from path in the <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instance.</span></span><p><span data-ttu-id="fd81f-122">Ajoute un <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving> gestionnaire à <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="fd81f-122">Adds a <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving> handler to <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="fd81f-123">Le gestionnaire chargera les dépendances de l’assembly à partir de son répertoire.</span><span class="sxs-lookup"><span data-stu-id="fd81f-123">The handler will load the assembly's dependencies from its directory.</span></span>|<span data-ttu-id="fd81f-124">Instance <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="fd81f-124">The <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instance.</span></span>|
|<xref:System.Reflection.Assembly.Load(System.Reflection.AssemblyName)?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.Load(System.String)?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.LoadWithPartialName%2A?displayProperty=nameWithType>|<span data-ttu-id="fd81f-125">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="fd81f-125">`Load-by-name`.</span></span>|<span data-ttu-id="fd81f-126">Déduit de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="fd81f-126">Inferred from caller.</span></span><p><span data-ttu-id="fd81f-127">Méthodes <xref:System.Runtime.Loader.AssemblyLoadContext> conseillées.</span><span class="sxs-lookup"><span data-stu-id="fd81f-127">Prefer <xref:System.Runtime.Loader.AssemblyLoadContext> methods.</span></span>|
|<xref:System.Reflection.Assembly.Load(System.Byte[])?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.Load(System.Byte[],System.Byte[])?displayProperty=nameWithType>|<span data-ttu-id="fd81f-128">Charger à partir de l’objet.</span><span class="sxs-lookup"><span data-stu-id="fd81f-128">Load from object.</span></span>|<span data-ttu-id="fd81f-129">Déduit de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="fd81f-129">Inferred from caller.</span></span><p><span data-ttu-id="fd81f-130">Méthodes <xref:System.Runtime.Loader.AssemblyLoadContext> conseillées.</span><span class="sxs-lookup"><span data-stu-id="fd81f-130">Prefer <xref:System.Runtime.Loader.AssemblyLoadContext> methods.</span></span>|
<xref:System.Type.GetType(System.String)?displayProperty=nameWithType><p><xref:System.Type.GetType(System.String,System.Boolean)?displayProperty=nameWithType><p><xref:System.Type.GetType(System.String,System.Boolean,System.Boolean)?displayProperty=nameWithType>|<span data-ttu-id="fd81f-131">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="fd81f-131">`Load-by-name`.</span></span>|<span data-ttu-id="fd81f-132">Déduit de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="fd81f-132">Inferred from caller.</span></span><p><span data-ttu-id="fd81f-133">Préférer <xref:System.Type.GetType%2A?displayProperty=nameWithType> les méthodes à `assemblyResolver` un argument.</span><span class="sxs-lookup"><span data-stu-id="fd81f-133">Prefer <xref:System.Type.GetType%2A?displayProperty=nameWithType> methods with an `assemblyResolver` argument.</span></span>|
<xref:System.Reflection.Assembly.GetType%2A?displayProperty=nameWithType>|<span data-ttu-id="fd81f-134">Si le `name` `Load-by-name`type décrit un type générique qualifié d’assembly, déclenchez.</span><span class="sxs-lookup"><span data-stu-id="fd81f-134">If type `name` describes an assembly qualified generic type, trigger a `Load-by-name`.</span></span>|<span data-ttu-id="fd81f-135">Déduit de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="fd81f-135">Inferred from caller.</span></span><p><span data-ttu-id="fd81f-136">Préférer <xref:System.Type.GetType%2A?displayProperty=nameWithType> lorsque vous utilisez des noms de types qualifiés d’assembly.</span><span class="sxs-lookup"><span data-stu-id="fd81f-136">Prefer <xref:System.Type.GetType%2A?displayProperty=nameWithType> when using assembly qualified type names.</span></span>|
<xref:System.Activator.CreateInstance(System.String,System.String)?displayProperty=nameWithType><p><xref:System.Activator.CreateInstance(System.String,System.String,System.Object[])?displayProperty=nameWithType><p><xref:System.Activator.CreateInstance(System.String,System.String,System.Boolean,System.Reflection.BindingFlags,System.Reflection.Binder,System.Object[],System.Globalization.CultureInfo,System.Object[])?displayProperty=nameWithType>|<span data-ttu-id="fd81f-137">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="fd81f-137">`Load-by-name`.</span></span>|<span data-ttu-id="fd81f-138">Déduit de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="fd81f-138">Inferred from caller.</span></span><p><span data-ttu-id="fd81f-139">Préférer <xref:System.Activator.CreateInstance%2A?displayProperty=nameWithType> les méthodes qui <xref:System.Type> prennent un argument.</span><span class="sxs-lookup"><span data-stu-id="fd81f-139">Prefer <xref:System.Activator.CreateInstance%2A?displayProperty=nameWithType> methods taking a <xref:System.Type> argument.</span></span>|

## <a name="algorithm"></a><span data-ttu-id="fd81f-140">Algorithme</span><span class="sxs-lookup"><span data-stu-id="fd81f-140">Algorithm</span></span>

<span data-ttu-id="fd81f-141">L’algorithme suivant décrit comment le runtime charge un assembly managé.</span><span class="sxs-lookup"><span data-stu-id="fd81f-141">The following algorithm describes how the runtime loads a managed assembly.</span></span>

1. <span data-ttu-id="fd81f-142">Déterminez `active` le <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="fd81f-142">Determine the `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span>

    - <span data-ttu-id="fd81f-143">Pour une référence d’assembly statique `active` , <xref:System.Runtime.Loader.AssemblyLoadContext> est l’instance qui a chargé l’assembly de référence.</span><span class="sxs-lookup"><span data-stu-id="fd81f-143">For a static assembly reference, the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> is the instance that loaded the referring assembly.</span></span>
    - <span data-ttu-id="fd81f-144">`active` Les<xref:System.Runtime.Loader.AssemblyLoadContext> API préférées rendent explicite.</span><span class="sxs-lookup"><span data-stu-id="fd81f-144">Preferred APIs make the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> explicit.</span></span>
    - <span data-ttu-id="fd81f-145">D’autres API déduisent le `active`. <xref:System.Runtime.Loader.AssemblyLoadContext></span><span class="sxs-lookup"><span data-stu-id="fd81f-145">Other APIs infer the `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span> <span data-ttu-id="fd81f-146">Pour ces API, la <xref:System.Runtime.Loader.AssemblyLoadContext.CurrentContextualReflectionContext?displayProperty=nameWithType> propriété est utilisée.</span><span class="sxs-lookup"><span data-stu-id="fd81f-146">For these APIs, the <xref:System.Runtime.Loader.AssemblyLoadContext.CurrentContextualReflectionContext?displayProperty=nameWithType> property is used.</span></span> <span data-ttu-id="fd81f-147">Si sa valeur est `null`, l' <xref:System.Runtime.Loader.AssemblyLoadContext> instance déduite est utilisée.</span><span class="sxs-lookup"><span data-stu-id="fd81f-147">If its value is `null`, then the inferred <xref:System.Runtime.Loader.AssemblyLoadContext> instance is used.</span></span>
    - <span data-ttu-id="fd81f-148">Consultez le tableau ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="fd81f-148">See table above.</span></span>

2. <span data-ttu-id="fd81f-149">Pour les `Load-by-name` méthodes, le actif <xref:System.Runtime.Loader.AssemblyLoadContext> charge l’assembly.</span><span class="sxs-lookup"><span data-stu-id="fd81f-149">For the `Load-by-name` methods, the active <xref:System.Runtime.Loader.AssemblyLoadContext> loads the assembly.</span></span> <span data-ttu-id="fd81f-150">Par ordre de priorité, procédez comme suit:</span><span class="sxs-lookup"><span data-stu-id="fd81f-150">In priority order by:</span></span>
    - <span data-ttu-id="fd81f-151">Vérification de `cache-by-name`son.</span><span class="sxs-lookup"><span data-stu-id="fd81f-151">Checking its `cache-by-name`.</span></span>

    - <span data-ttu-id="fd81f-152">Appel de <xref:System.Runtime.Loader.AssemblyLoadContext.Load%2A?displayProperty=nameWithType> la fonction.</span><span class="sxs-lookup"><span data-stu-id="fd81f-152">Calling the <xref:System.Runtime.Loader.AssemblyLoadContext.Load%2A?displayProperty=nameWithType> function.</span></span>

    - <span data-ttu-id="fd81f-153">Vérification du <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> cache des instances et exécution de la logique de [sondage par défaut](default-probing.md#managed-assembly-default-probing) de l’assembly managé.</span><span class="sxs-lookup"><span data-stu-id="fd81f-153">Checking the <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instances' cache and running [managed assembly default probing](default-probing.md#managed-assembly-default-probing) logic.</span></span>

    - <span data-ttu-id="fd81f-154">Déclenchement de <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> l’événement pour le AssemblyLoadContext actif.</span><span class="sxs-lookup"><span data-stu-id="fd81f-154">Raising the <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> event for the active AssemblyLoadContext.</span></span>

    - <span data-ttu-id="fd81f-155">Déclenchement de <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> l’événement.</span><span class="sxs-lookup"><span data-stu-id="fd81f-155">Raising the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event.</span></span>

3. <span data-ttu-id="fd81f-156">Pour les autres types de charges, le `active` <xref:System.Runtime.Loader.AssemblyLoadContext> charge l’assembly.</span><span class="sxs-lookup"><span data-stu-id="fd81f-156">For the other types of loads, the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> loads the assembly.</span></span> <span data-ttu-id="fd81f-157">Par ordre de priorité, procédez comme suit:</span><span class="sxs-lookup"><span data-stu-id="fd81f-157">In priority order by:</span></span>
    - <span data-ttu-id="fd81f-158">Vérification de `cache-by-name`son.</span><span class="sxs-lookup"><span data-stu-id="fd81f-158">Checking its `cache-by-name`.</span></span>

    - <span data-ttu-id="fd81f-159">Chargement à partir du chemin d’accès ou de l’objet d’assembly brut spécifié.</span><span class="sxs-lookup"><span data-stu-id="fd81f-159">Loading from the specified path or raw assembly object.</span></span>

4. <span data-ttu-id="fd81f-160">Dans les deux cas, si un assembly est nouvellement chargé, alors:</span><span class="sxs-lookup"><span data-stu-id="fd81f-160">In either case, if an assembly is newly loaded, then:</span></span>
   - <span data-ttu-id="fd81f-161">L'événement <xref:System.AppDomain.AssemblyLoad?displayProperty=nameWithType> est déclenché.</span><span class="sxs-lookup"><span data-stu-id="fd81f-161">The <xref:System.AppDomain.AssemblyLoad?displayProperty=nameWithType> event is raised.</span></span>
   - <span data-ttu-id="fd81f-162">Une référence est ajoutée au de <xref:System.Runtime.Loader.AssemblyLoadContext> `cache-by-name`l’instance de l’assembly.</span><span class="sxs-lookup"><span data-stu-id="fd81f-162">A reference is added to the assembly's <xref:System.Runtime.Loader.AssemblyLoadContext> instance's `cache-by-name`.</span></span>

5. <span data-ttu-id="fd81f-163">Si l’assembly est trouvé, une référence est ajoutée si nécessaire au `active` de `cache-by-name`l' <xref:System.Runtime.Loader.AssemblyLoadContext> instance.</span><span class="sxs-lookup"><span data-stu-id="fd81f-163">If the assembly is found, a reference is added as needed to the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> instance's `cache-by-name`.</span></span>

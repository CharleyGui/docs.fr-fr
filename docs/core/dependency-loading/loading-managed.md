---
title: Algorithme de chargement d’assemblage géré - .NET Core
description: Description des détails de l’algorithme de chargement d’assemblage géré dans .NET Core
ms.date: 08/09/2019
author: sdmaclea
ms.author: stmaclea
ms.openlocfilehash: 312a320676be6eb453697e0704ab771a6707618b
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/14/2020
ms.locfileid: "73973501"
---
# <a name="managed-assembly-loading-algorithm"></a><span data-ttu-id="e4a03-103">Algorithme de chargement d’assemblage géré</span><span class="sxs-lookup"><span data-stu-id="e4a03-103">Managed assembly loading algorithm</span></span>

<span data-ttu-id="e4a03-104">Les assemblages gérés sont situés et chargés d’un algorithme impliquant différentes étapes.</span><span class="sxs-lookup"><span data-stu-id="e4a03-104">Managed assemblies are located and loaded with an algorithm involving various stages.</span></span>

<span data-ttu-id="e4a03-105">Tous les assemblages gérés, `WinRT` à l’exception des assemblages et assemblages satellites, utilisent le même algorithme.</span><span class="sxs-lookup"><span data-stu-id="e4a03-105">All managed assemblies except satellite assemblies and `WinRT` assemblies use the same algorithm.</span></span>

## <a name="when-are-managed-assemblies-loaded"></a><span data-ttu-id="e4a03-106">Quand les assemblages gérés sont-ils chargés?</span><span class="sxs-lookup"><span data-stu-id="e4a03-106">When are managed assemblies loaded?</span></span>

<span data-ttu-id="e4a03-107">Le mécanisme le plus commun pour déclencher une charge d’assemblage gérée est une référence d’assemblage statique.</span><span class="sxs-lookup"><span data-stu-id="e4a03-107">The most common mechanism to trigger a managed assembly load is a static assembly reference.</span></span> <span data-ttu-id="e4a03-108">Ces références sont insérées par le compilateur chaque fois que le code utilise un type défini dans un autre assemblage.</span><span class="sxs-lookup"><span data-stu-id="e4a03-108">These references are inserted by the compiler whenever code uses a type defined in another assembly.</span></span> <span data-ttu-id="e4a03-109">Ces assemblages sont`load-by-name`chargés ( ) comme nécessaire par le temps d’exécution.</span><span class="sxs-lookup"><span data-stu-id="e4a03-109">These assemblies are loaded (`load-by-name`) as needed by the runtime.</span></span>

<span data-ttu-id="e4a03-110">L’utilisation directe d’API spécifiques déclenchera également des charges :</span><span class="sxs-lookup"><span data-stu-id="e4a03-110">The direct use of specific APIs will also trigger loads:</span></span>

|<span data-ttu-id="e4a03-111">API</span><span class="sxs-lookup"><span data-stu-id="e4a03-111">API</span></span>  |<span data-ttu-id="e4a03-112">Description</span><span class="sxs-lookup"><span data-stu-id="e4a03-112">Description</span></span>  |<span data-ttu-id="e4a03-113">`Active` <xref:System.Runtime.Loader.AssemblyLoadContext></span><span class="sxs-lookup"><span data-stu-id="e4a03-113">`Active` <xref:System.Runtime.Loader.AssemblyLoadContext></span></span> |
|---------|---------|---------|
|<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromAssemblyName%2A?displayProperty=nameWithType>|`Load-by-name`|<span data-ttu-id="e4a03-114">La [présente](../../csharp/language-reference/keywords/this.md) instance.</span><span class="sxs-lookup"><span data-stu-id="e4a03-114">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
|<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromAssemblyPath%2A?displayProperty=nameWithType><p><xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromNativeImagePath%2A?displayProperty=nameWithType>|<span data-ttu-id="e4a03-115">Chargez du chemin.</span><span class="sxs-lookup"><span data-stu-id="e4a03-115">Load from path.</span></span>|<span data-ttu-id="e4a03-116">La [présente](../../csharp/language-reference/keywords/this.md) instance.</span><span class="sxs-lookup"><span data-stu-id="e4a03-116">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromStream%2A?displayProperty=nameWithType>|<span data-ttu-id="e4a03-117">Chargez de l’objet.</span><span class="sxs-lookup"><span data-stu-id="e4a03-117">Load from object.</span></span>|<span data-ttu-id="e4a03-118">La [présente](../../csharp/language-reference/keywords/this.md) instance.</span><span class="sxs-lookup"><span data-stu-id="e4a03-118">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
|<xref:System.Reflection.Assembly.LoadFile%2A?displayProperty=nameWithType>|<span data-ttu-id="e4a03-119">Chargement du chemin <xref:System.Runtime.Loader.AssemblyLoadContext> dans une nouvelle instance</span><span class="sxs-lookup"><span data-stu-id="e4a03-119">Load from path in a new <xref:System.Runtime.Loader.AssemblyLoadContext> instance</span></span>|<span data-ttu-id="e4a03-120">Nouvelle instance <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="e4a03-120">The new <xref:System.Runtime.Loader.AssemblyLoadContext> instance.</span></span>|
<xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType>|<span data-ttu-id="e4a03-121">Chargez du <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> chemin dans l’instance.</span><span class="sxs-lookup"><span data-stu-id="e4a03-121">Load from path in the <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instance.</span></span><p><span data-ttu-id="e4a03-122">Ajoute <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving> un <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>gestionnaire à .</span><span class="sxs-lookup"><span data-stu-id="e4a03-122">Adds a <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving> handler to <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="e4a03-123">Le gestionnaire chargera les dépendances de l’assemblage à partir de son répertoire.</span><span class="sxs-lookup"><span data-stu-id="e4a03-123">The handler will load the assembly's dependencies from its directory.</span></span>|<span data-ttu-id="e4a03-124">Instance <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="e4a03-124">The <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instance.</span></span>|
|<xref:System.Reflection.Assembly.Load(System.Reflection.AssemblyName)?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.Load(System.String)?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.LoadWithPartialName%2A?displayProperty=nameWithType>|<span data-ttu-id="e4a03-125">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="e4a03-125">`Load-by-name`.</span></span>|<span data-ttu-id="e4a03-126">Inféré de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="e4a03-126">Inferred from caller.</span></span><p><span data-ttu-id="e4a03-127">Préférez <xref:System.Runtime.Loader.AssemblyLoadContext> les méthodes.</span><span class="sxs-lookup"><span data-stu-id="e4a03-127">Prefer <xref:System.Runtime.Loader.AssemblyLoadContext> methods.</span></span>|
|<xref:System.Reflection.Assembly.Load(System.Byte[])?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.Load(System.Byte[],System.Byte[])?displayProperty=nameWithType>|<span data-ttu-id="e4a03-128">Chargez de l’objet dans un nouveau <xref:System.Runtime.Loader.AssemblyLoadContext> cas.</span><span class="sxs-lookup"><span data-stu-id="e4a03-128">Load from object in a new <xref:System.Runtime.Loader.AssemblyLoadContext> instance.</span></span>|<span data-ttu-id="e4a03-129">Nouvelle instance <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="e4a03-129">The new <xref:System.Runtime.Loader.AssemblyLoadContext> instance.</span></span>|
<xref:System.Type.GetType(System.String)?displayProperty=nameWithType><p><xref:System.Type.GetType(System.String,System.Boolean)?displayProperty=nameWithType><p><xref:System.Type.GetType(System.String,System.Boolean,System.Boolean)?displayProperty=nameWithType>|<span data-ttu-id="e4a03-130">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="e4a03-130">`Load-by-name`.</span></span>|<span data-ttu-id="e4a03-131">Inféré de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="e4a03-131">Inferred from caller.</span></span><p><span data-ttu-id="e4a03-132">Préférez <xref:System.Type.GetType%2A?displayProperty=nameWithType> les `assemblyResolver` méthodes avec un argument.</span><span class="sxs-lookup"><span data-stu-id="e4a03-132">Prefer <xref:System.Type.GetType%2A?displayProperty=nameWithType> methods with an `assemblyResolver` argument.</span></span>|
<xref:System.Reflection.Assembly.GetType%2A?displayProperty=nameWithType>|<span data-ttu-id="e4a03-133">Si `name` le type décrit un type `Load-by-name`générique qualifié d’assemblage, déclenchez un .</span><span class="sxs-lookup"><span data-stu-id="e4a03-133">If type `name` describes an assembly qualified generic type, trigger a `Load-by-name`.</span></span>|<span data-ttu-id="e4a03-134">Inféré de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="e4a03-134">Inferred from caller.</span></span><p><span data-ttu-id="e4a03-135">Préférez <xref:System.Type.GetType%2A?displayProperty=nameWithType> lorsque vous utilisez des noms de type qualifié d’assemblage.</span><span class="sxs-lookup"><span data-stu-id="e4a03-135">Prefer <xref:System.Type.GetType%2A?displayProperty=nameWithType> when using assembly qualified type names.</span></span>|
<xref:System.Activator.CreateInstance(System.String,System.String)?displayProperty=nameWithType><p><xref:System.Activator.CreateInstance(System.String,System.String,System.Object[])?displayProperty=nameWithType><p><xref:System.Activator.CreateInstance(System.String,System.String,System.Boolean,System.Reflection.BindingFlags,System.Reflection.Binder,System.Object[],System.Globalization.CultureInfo,System.Object[])?displayProperty=nameWithType>|<span data-ttu-id="e4a03-136">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="e4a03-136">`Load-by-name`.</span></span>|<span data-ttu-id="e4a03-137">Inféré de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="e4a03-137">Inferred from caller.</span></span><p><span data-ttu-id="e4a03-138">Préférez <xref:System.Activator.CreateInstance%2A?displayProperty=nameWithType> les <xref:System.Type> méthodes qui prennent un argument.</span><span class="sxs-lookup"><span data-stu-id="e4a03-138">Prefer <xref:System.Activator.CreateInstance%2A?displayProperty=nameWithType> methods taking a <xref:System.Type> argument.</span></span>|

## <a name="algorithm"></a><span data-ttu-id="e4a03-139">Algorithm</span><span class="sxs-lookup"><span data-stu-id="e4a03-139">Algorithm</span></span>

<span data-ttu-id="e4a03-140">L’algorithme suivant décrit comment le temps d’exécution charge un assemblage géré.</span><span class="sxs-lookup"><span data-stu-id="e4a03-140">The following algorithm describes how the runtime loads a managed assembly.</span></span>

1. <span data-ttu-id="e4a03-141">Déterminer `active` <xref:System.Runtime.Loader.AssemblyLoadContext>le .</span><span class="sxs-lookup"><span data-stu-id="e4a03-141">Determine the `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span>

    - <span data-ttu-id="e4a03-142">Pour une référence d’assemblage statique, c’est `active` <xref:System.Runtime.Loader.AssemblyLoadContext> l’instance qui a chargé l’assemblage de référence.</span><span class="sxs-lookup"><span data-stu-id="e4a03-142">For a static assembly reference, the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> is the instance that loaded the referring assembly.</span></span>
    - <span data-ttu-id="e4a03-143">Les API `active` <xref:System.Runtime.Loader.AssemblyLoadContext> préférées rendent explicites.</span><span class="sxs-lookup"><span data-stu-id="e4a03-143">Preferred APIs make the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> explicit.</span></span>
    - <span data-ttu-id="e4a03-144">D’autres API `active` <xref:System.Runtime.Loader.AssemblyLoadContext>inférer le .</span><span class="sxs-lookup"><span data-stu-id="e4a03-144">Other APIs infer the `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span> <span data-ttu-id="e4a03-145">Pour ces API, la <xref:System.Runtime.Loader.AssemblyLoadContext.CurrentContextualReflectionContext?displayProperty=nameWithType> propriété est utilisée.</span><span class="sxs-lookup"><span data-stu-id="e4a03-145">For these APIs, the <xref:System.Runtime.Loader.AssemblyLoadContext.CurrentContextualReflectionContext?displayProperty=nameWithType> property is used.</span></span> <span data-ttu-id="e4a03-146">Si sa `null`valeur est, alors <xref:System.Runtime.Loader.AssemblyLoadContext> l’instance déduite est utilisée.</span><span class="sxs-lookup"><span data-stu-id="e4a03-146">If its value is `null`, then the inferred <xref:System.Runtime.Loader.AssemblyLoadContext> instance is used.</span></span>
    - <span data-ttu-id="e4a03-147">Voir la table ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="e4a03-147">See table above.</span></span>

2. <span data-ttu-id="e4a03-148">Pour `Load-by-name` les méthodes, <xref:System.Runtime.Loader.AssemblyLoadContext> l’actif charge l’assemblage.</span><span class="sxs-lookup"><span data-stu-id="e4a03-148">For the `Load-by-name` methods, the active <xref:System.Runtime.Loader.AssemblyLoadContext> loads the assembly.</span></span> <span data-ttu-id="e4a03-149">Dans l’ordre de priorité par :</span><span class="sxs-lookup"><span data-stu-id="e4a03-149">In priority order by:</span></span>
    - <span data-ttu-id="e4a03-150">Vérification `cache-by-name`de son .</span><span class="sxs-lookup"><span data-stu-id="e4a03-150">Checking its `cache-by-name`.</span></span>

    - <span data-ttu-id="e4a03-151">Appel <xref:System.Runtime.Loader.AssemblyLoadContext.Load%2A?displayProperty=nameWithType> de la fonction.</span><span class="sxs-lookup"><span data-stu-id="e4a03-151">Calling the <xref:System.Runtime.Loader.AssemblyLoadContext.Load%2A?displayProperty=nameWithType> function.</span></span>

    - <span data-ttu-id="e4a03-152">Vérification <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> du cache des instances et exécution de la logique [de sondage par défaut d’assemblage géré.](default-probing.md#managed-assembly-default-probing)</span><span class="sxs-lookup"><span data-stu-id="e4a03-152">Checking the <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instances' cache and running [managed assembly default probing](default-probing.md#managed-assembly-default-probing) logic.</span></span>

    - <span data-ttu-id="e4a03-153">Élever <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> l’événement pour l’AssembléeLoadContexte active.</span><span class="sxs-lookup"><span data-stu-id="e4a03-153">Raising the <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> event for the active AssemblyLoadContext.</span></span>

    - <span data-ttu-id="e4a03-154">Élever <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> l’événement.</span><span class="sxs-lookup"><span data-stu-id="e4a03-154">Raising the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event.</span></span>

3. <span data-ttu-id="e4a03-155">Pour les autres types de `active` <xref:System.Runtime.Loader.AssemblyLoadContext> charges, les charges de l’assemblage.</span><span class="sxs-lookup"><span data-stu-id="e4a03-155">For the other types of loads, the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> loads the assembly.</span></span> <span data-ttu-id="e4a03-156">Dans l’ordre de priorité par :</span><span class="sxs-lookup"><span data-stu-id="e4a03-156">In priority order by:</span></span>
    - <span data-ttu-id="e4a03-157">Vérification `cache-by-name`de son .</span><span class="sxs-lookup"><span data-stu-id="e4a03-157">Checking its `cache-by-name`.</span></span>

    - <span data-ttu-id="e4a03-158">Chargement à partir du chemin spécifié ou de l’objet d’assemblage brut.</span><span class="sxs-lookup"><span data-stu-id="e4a03-158">Loading from the specified path or raw assembly object.</span></span>

4. <span data-ttu-id="e4a03-159">Dans les deux cas, si un assemblage est nouvellement chargé, alors :</span><span class="sxs-lookup"><span data-stu-id="e4a03-159">In either case, if an assembly is newly loaded, then:</span></span>
   - <span data-ttu-id="e4a03-160">L'événement <xref:System.AppDomain.AssemblyLoad?displayProperty=nameWithType> est déclenché.</span><span class="sxs-lookup"><span data-stu-id="e4a03-160">The <xref:System.AppDomain.AssemblyLoad?displayProperty=nameWithType> event is raised.</span></span>
   - <span data-ttu-id="e4a03-161">Une référence est ajoutée à <xref:System.Runtime.Loader.AssemblyLoadContext> l’instance de l’assemblée `cache-by-name`.</span><span class="sxs-lookup"><span data-stu-id="e4a03-161">A reference is added to the assembly's <xref:System.Runtime.Loader.AssemblyLoadContext> instance's `cache-by-name`.</span></span>

5. <span data-ttu-id="e4a03-162">Si l’assemblage est trouvé, une référence `active` <xref:System.Runtime.Loader.AssemblyLoadContext> est `cache-by-name`ajoutée au besoin à l’instance .</span><span class="sxs-lookup"><span data-stu-id="e4a03-162">If the assembly is found, a reference is added as needed to the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> instance's `cache-by-name`.</span></span>

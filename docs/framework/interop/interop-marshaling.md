---
title: Marshaling d’interopérabilité
description: Prise en main du marshaling d’interopérabilité, qui régit la façon dont les données sont transmises dans les arguments de méthode et les valeurs de retour entre la mémoire managée et non managée lors des appels.
ms.date: 03/30/2017
helpviewer_keywords:
- marshaling, COM interop
- interop marshaling
- interop marshaling, about interop marshaling
ms.assetid: 115f7a2f-d422-4605-ab36-13a8dd28142a
ms.openlocfilehash: bd618714a9bd27bc309b7933b656de6bd139cfe7
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/15/2020
ms.locfileid: "90554890"
---
# <a name="interop-marshaling"></a><span data-ttu-id="b4e8a-103">Marshaling d’interopérabilité</span><span class="sxs-lookup"><span data-stu-id="b4e8a-103">Interop Marshaling</span></span>

<span data-ttu-id="b4e8a-104">Le marshaling d'interopérabilité détermine la façon dont les données sont transmises dans les arguments de méthode et les valeurs de retour entre la mémoire managée et non managée lors des appels.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-104">Interop marshaling governs how data is passed in method arguments and return values between managed and unmanaged memory during calls.</span></span> <span data-ttu-id="b4e8a-105">Le marshaling d'interopérabilité est une activité d'exécution effectuée par le service de marshaling du common language runtime.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-105">Interop marshaling is a run-time activity performed by the common language runtime's marshaling service.</span></span>

<span data-ttu-id="b4e8a-106">La plupart des types de données ont des représentations communes dans la mémoire managée et la mémoire non managée.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-106">Most data types have common representations in both managed and unmanaged memory.</span></span> <span data-ttu-id="b4e8a-107">Le marshaleur d’interopérabilité gère ces types à votre place.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-107">The interop marshaler handles these types for you.</span></span> <span data-ttu-id="b4e8a-108">D'autres types peuvent être ambigus ou non représentés dans la mémoire managée.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-108">Other types can be ambiguous or not represented at all in managed memory.</span></span>

<span data-ttu-id="b4e8a-109">Un type ambigu peut avoir plusieurs représentations non managées qui correspondent à un seul type managé ou bien ne pas avoir d'informations de type (par exemple, la taille d'un tableau).</span><span class="sxs-lookup"><span data-stu-id="b4e8a-109">An ambiguous type can have either multiple unmanaged representations that map to a single managed type, or missing type information, such as the size of an array.</span></span> <span data-ttu-id="b4e8a-110">Pour les types ambigus, le marshaleur fournit une représentation par défaut et des représentations alternatives où plusieurs représentations existent.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-110">For ambiguous types, the marshaler provides a default representation and alternative representations where multiple representations exist.</span></span> <span data-ttu-id="b4e8a-111">Vous pouvez fournir des instructions explicites au marshaleur sur la façon de marshaler un type ambigu.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-111">You can supply explicit instructions to the marshaler on how it is to marshal an ambiguous type.</span></span>

## <a name="platform-invoke-and-com-interop-models"></a><span data-ttu-id="b4e8a-112">Appel de code non managé et modèles d'interopérabilité COM</span><span class="sxs-lookup"><span data-stu-id="b4e8a-112">Platform Invoke and COM Interop Models</span></span>

<span data-ttu-id="b4e8a-113">Le common language runtime fournit deux mécanismes d'interopérabilité avec le code non managé :</span><span class="sxs-lookup"><span data-stu-id="b4e8a-113">The common language runtime provides two mechanisms for interoperating with unmanaged code:</span></span>

- <span data-ttu-id="b4e8a-114">L'appel de code non managé, qui permet au code managé d'appeler des fonctions exportées à partir d'une bibliothèque non managée.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-114">Platform invoke, which enables managed code to call functions exported from an unmanaged library.</span></span>
- <span data-ttu-id="b4e8a-115">COM Interop, qui permet au code managé d'interagir avec les objets COM via des interfaces.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-115">COM interop, which enables managed code to interact with Component Object Model (COM) objects through interfaces.</span></span>

<span data-ttu-id="b4e8a-116">L’appel de code non managé et COM Interop utilisent tous deux le marshaling d’interopérabilité pour faire passer les arguments de méthode de l’appelant à l’appelé, puis dans l’autre sens, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-116">Both platform invoke and COM interop use interop marshaling to accurately move method arguments between caller and callee and back, if required.</span></span> <span data-ttu-id="b4e8a-117">Comme le montre l’illustration suivante, un appel de méthode d’appel de code non managé passe du code managé au code non managé et jamais dans l’autre sens, sauf quand des [fonctions de rappel](callback-functions.md) sont impliquées.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-117">As the following illustration shows, a platform invoke method call flows from managed to unmanaged code and never the other way, except when [callback functions](callback-functions.md) are involved.</span></span> <span data-ttu-id="b4e8a-118">Même si les appels de code non managé peuvent uniquement passer du code managé au code non managé, les données peuvent circuler dans les deux sens en tant que paramètres d'entrée ou de sortie.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-118">Even though platform invoke calls can flow only from managed to unmanaged code, data can flow in both directions as input or output parameters.</span></span> <span data-ttu-id="b4e8a-119">Les appels de méthode COM Interop peuvent circuler dans les deux sens.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-119">COM interop method calls can flow in either direction.</span></span>

<span data-ttu-id="b4e8a-120">![Appel de code non managé](./media/interop-marshaling/interop-marshaling-invoke-and-com.png "Flux des appels de code non managé et des appels COM Interop")</span><span class="sxs-lookup"><span data-stu-id="b4e8a-120">![Platform invoke](./media/interop-marshaling/interop-marshaling-invoke-and-com.png "Platform invoke and COM interop call flow")</span></span>

<span data-ttu-id="b4e8a-121">Au niveau le plus bas, ces deux mécanismes utilisent le même service de marshaling d’interopérabilité. Toutefois, certains types de données sont pris en charge exclusivement par COM Interop ou par l’appel de code non managé.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-121">At the lowest level, both mechanisms use the same interop marshaling service; however, certain data types are supported exclusively by COM interop or platform invoke.</span></span> <span data-ttu-id="b4e8a-122">Pour plus d’informations, consultez [Comportement de marshaling par défaut](default-marshaling-behavior.md).</span><span class="sxs-lookup"><span data-stu-id="b4e8a-122">For details, see [Default Marshaling Behavior](default-marshaling-behavior.md).</span></span>

## <a name="marshaling-and-com-apartments"></a><span data-ttu-id="b4e8a-123">Marshaling et cloisonnements COM</span><span class="sxs-lookup"><span data-stu-id="b4e8a-123">Marshaling and COM Apartments</span></span>

<span data-ttu-id="b4e8a-124">Le marshaleur d'interopérabilité marshale les données entre le tas du common langage runtime et le tas non managé.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-124">The interop marshaler marshals data between the common language runtime heap and the unmanaged heap.</span></span> <span data-ttu-id="b4e8a-125">Le marshaling se produit chaque fois que l’appelant et l’appelé ne peuvent pas agir sur une même instance de données.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-125">Marshaling occurs whenever the caller and callee cannot operate on the same instance of data.</span></span> <span data-ttu-id="b4e8a-126">Le marshaleur d'interopérabilité permet à l'appelant et à l'appelé d'utiliser les mêmes données, même s'ils possèdent chacun leur propre copie des données.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-126">The interop marshaler makes it possible for the caller and callee to appear to be operating on the same data even if they have their own copy of the data.</span></span>

<span data-ttu-id="b4e8a-127">COM possède également un marshaleur qui marshale les données entre des cloisonnements COM ou différents processus COM.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-127">COM also has a marshaler that marshals data between COM apartments or different COM processes.</span></span> <span data-ttu-id="b4e8a-128">Lors d'un appel entre du code managé et du code non managé au sein d'un même cloisonnement COM, le marshaleur d'interopérabilité est le seul marshaleur impliqué.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-128">When calling between managed and unmanaged code within the same COM apartment, the interop marshaler is the only marshaler involved.</span></span> <span data-ttu-id="b4e8a-129">Lors d'un appel entre du code managé et du code non managé au sein de cloisonnements COM (ou autres processus) différents, le marshaleur d'interopérabilité et le marshaleur COM sont tous les deux impliqués.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-129">When calling between managed code and unmanaged code in a different COM apartment or a different process, both the interop marshaler and the COM marshaler are involved.</span></span>

### <a name="com-clients-and-managed-servers"></a><span data-ttu-id="b4e8a-130">Clients COM et serveurs managés</span><span class="sxs-lookup"><span data-stu-id="b4e8a-130">COM Clients and Managed Servers</span></span>

<span data-ttu-id="b4e8a-131">L’entrée de Registre `ThreadingModel` d’un serveur managé exporté avec une bibliothèque de types inscrite par l’outil [Regasm.exe (outil d’inscription d’assemblys)](../tools/regasm-exe-assembly-registration-tool.md) a la valeur `Both`.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-131">An exported managed server with a type library registered by the [Regasm.exe (Assembly Registration Tool)](../tools/regasm-exe-assembly-registration-tool.md) has a `ThreadingModel` registry entry set to `Both`.</span></span> <span data-ttu-id="b4e8a-132">Cette valeur indique que le serveur peut être activé dans un thread unique cloisonné (STA) ou dans un multithread cloisonné (MTA).</span><span class="sxs-lookup"><span data-stu-id="b4e8a-132">This value indicates that the server can be activated in a single-threaded apartment (STA) or a multithreaded apartment (MTA).</span></span> <span data-ttu-id="b4e8a-133">L’objet serveur est créé dans le même cloisonnement que son appelant, comme indiqué dans le tableau suivant :</span><span class="sxs-lookup"><span data-stu-id="b4e8a-133">The server object is created in the same apartment as its caller, as shown in the following table:</span></span>

|<span data-ttu-id="b4e8a-134">Client COM</span><span class="sxs-lookup"><span data-stu-id="b4e8a-134">COM client</span></span>|<span data-ttu-id="b4e8a-135">Serveur .NET</span><span class="sxs-lookup"><span data-stu-id="b4e8a-135">.NET server</span></span>|<span data-ttu-id="b4e8a-136">Configuration requise</span><span class="sxs-lookup"><span data-stu-id="b4e8a-136">Marshaling requirements</span></span>|
|----------------|-----------------|-----------------------------|
|<span data-ttu-id="b4e8a-137">STA</span><span class="sxs-lookup"><span data-stu-id="b4e8a-137">STA</span></span>|<span data-ttu-id="b4e8a-138">`Both` deviennent un STA.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-138">`Both` becomes STA.</span></span>|<span data-ttu-id="b4e8a-139">Marshaling dans un même cloisonnement.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-139">Same-apartment marshaling.</span></span>|
|<span data-ttu-id="b4e8a-140">MTA</span><span class="sxs-lookup"><span data-stu-id="b4e8a-140">MTA</span></span>|<span data-ttu-id="b4e8a-141">`Both` deviennent un MTA.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-141">`Both` becomes MTA.</span></span>|<span data-ttu-id="b4e8a-142">Marshaling dans un même cloisonnement.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-142">Same-apartment marshaling.</span></span>|

<span data-ttu-id="b4e8a-143">Étant donné que le client et le serveur se trouvent dans le même cloisonnement, le service de marshaling d’interopérabilité gère automatiquement tout le marshaling de données.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-143">Because the client and server are in the same apartment, the interop marshaling service automatically handles all data marshaling.</span></span> <span data-ttu-id="b4e8a-144">L'illustration suivante montre le service de marshaling d'interopérabilité agissant entre les tas managés et non managés au sein du même cloisonnement de style COM.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-144">The following illustration shows the interop marshaling service operating between managed and unmanaged heaps within the same COM-style apartment.</span></span>

<span data-ttu-id="b4e8a-145">![Marshaling d’interopérabilité entre des tas managés et non managés](./media/interop-marshaling/interop-heaps-managed-and-unmanaged.gif "Processus de marshaling dans un même cloisonnement.")</span><span class="sxs-lookup"><span data-stu-id="b4e8a-145">![Interop marshaling between managed and unmanaged heaps](./media/interop-marshaling/interop-heaps-managed-and-unmanaged.gif "Same-apartment marshaling process")</span></span>

<span data-ttu-id="b4e8a-146">Si vous prévoyez d'exporter un serveur managé, n'oubliez pas que le client COM détermine le cloisonnement du serveur.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-146">If you plan to export a managed server, be aware that the COM client determines the apartment of the server.</span></span> <span data-ttu-id="b4e8a-147">Un serveur managé appelé par un client COM initialisé dans un MTA doit garantir la cohérence des threads.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-147">A managed server called by a COM client initialized in an MTA must ensure thread safety.</span></span>

### <a name="managed-clients-and-com-servers"></a><span data-ttu-id="b4e8a-148">Clients managés et serveurs COM</span><span class="sxs-lookup"><span data-stu-id="b4e8a-148">Managed Clients and COM Servers</span></span>

<span data-ttu-id="b4e8a-149">Le paramètre par défaut des cloisonnements de clients managés est MTA. Toutefois, le type d'application du client .NET peut modifier le paramètre par défaut.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-149">The default setting for managed client apartments is MTA; however, the application type of the .NET client can change the default setting.</span></span> <span data-ttu-id="b4e8a-150">Par exemple, le paramètre de cloisonnement d’un client Visual Basic est STA.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-150">For example, a Visual Basic client apartment setting is STA.</span></span> <span data-ttu-id="b4e8a-151">Vous pouvez utiliser l'attribut <xref:System.STAThreadAttribute?displayProperty=nameWithType>, l'attribut <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, la propriété <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> ou la propriété <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> pour examiner et modifier le paramètre de cloisonnement d'un client managé.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-151">You can use the <xref:System.STAThreadAttribute?displayProperty=nameWithType>, the <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, the <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> property, or the <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> property to examine and change the apartment setting of a managed client.</span></span>

<span data-ttu-id="b4e8a-152">L'auteur du composant définit l'affinité de thread d'un serveur COM.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-152">The author of the component sets the thread affinity of a COM server.</span></span> <span data-ttu-id="b4e8a-153">Le tableau suivant montre les combinaisons de paramètres de cloisonnement pour les serveurs COM et les clients .NET.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-153">The following table shows the combinations of apartment settings for .NET clients and COM servers.</span></span> <span data-ttu-id="b4e8a-154">Il montre également la configuration de marshaling requise qui en résulte pour les combinaisons.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-154">It also shows the resulting marshaling requirements for the combinations.</span></span>

|<span data-ttu-id="b4e8a-155">Client .NET</span><span class="sxs-lookup"><span data-stu-id="b4e8a-155">.NET client</span></span>|<span data-ttu-id="b4e8a-156">Serveur COM</span><span class="sxs-lookup"><span data-stu-id="b4e8a-156">COM server</span></span>|<span data-ttu-id="b4e8a-157">Configuration requise</span><span class="sxs-lookup"><span data-stu-id="b4e8a-157">Marshaling requirements</span></span>|
|-----------------|----------------|-----------------------------|
|<span data-ttu-id="b4e8a-158">MTA (par défaut)</span><span class="sxs-lookup"><span data-stu-id="b4e8a-158">MTA (default)</span></span>|<span data-ttu-id="b4e8a-159">MTA</span><span class="sxs-lookup"><span data-stu-id="b4e8a-159">MTA</span></span><br /><br /> <span data-ttu-id="b4e8a-160">STA</span><span class="sxs-lookup"><span data-stu-id="b4e8a-160">STA</span></span>|<span data-ttu-id="b4e8a-161">Marshaling d’interopérabilité.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-161">Interop marshaling.</span></span><br /><br /> <span data-ttu-id="b4e8a-162">Marshaling COM et marshaling d’interopérabilité.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-162">Interop and COM marshaling.</span></span>|
|<span data-ttu-id="b4e8a-163">STA</span><span class="sxs-lookup"><span data-stu-id="b4e8a-163">STA</span></span>|<span data-ttu-id="b4e8a-164">MTA</span><span class="sxs-lookup"><span data-stu-id="b4e8a-164">MTA</span></span><br /><br /> <span data-ttu-id="b4e8a-165">STA</span><span class="sxs-lookup"><span data-stu-id="b4e8a-165">STA</span></span>|<span data-ttu-id="b4e8a-166">Marshaling COM et marshaling d’interopérabilité.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-166">Interop and COM marshaling.</span></span><br /><br /> <span data-ttu-id="b4e8a-167">Marshaling d’interopérabilité.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-167">Interop marshaling.</span></span>|

<span data-ttu-id="b4e8a-168">Quand un client managé et un serveur non managé se trouvent dans un même cloisonnement, le service de marshaling d'interopérabilité gère tout le marshaling de données.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-168">When a managed client and unmanaged server are in the same apartment, the interop marshaling service handles all data marshaling.</span></span> <span data-ttu-id="b4e8a-169">Toutefois, quand le client et le serveur sont initialisés dans des cloisonnements différents, le marshaling COM est également requis.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-169">However, when client and server are initialized in different apartments, COM marshaling is also required.</span></span> <span data-ttu-id="b4e8a-170">L’illustration suivante montre les éléments d’un appel inter-cloisonnement :</span><span class="sxs-lookup"><span data-stu-id="b4e8a-170">The following illustration shows the elements of a cross-apartment call:</span></span>

<span data-ttu-id="b4e8a-171">![Marshaling COM](./media/interop-marshaling/single-process-across-multi-apartment.gif "Appel intercloisonnements entre un client .NET et un objet COM")</span><span class="sxs-lookup"><span data-stu-id="b4e8a-171">![COM marshaling](./media/interop-marshaling/single-process-across-multi-apartment.gif "Cross-apartment call between a .NET client and COM object")</span></span>

<span data-ttu-id="b4e8a-172">Pour le marshaling intercloisonnements, vous pouvez procéder comme suit :</span><span class="sxs-lookup"><span data-stu-id="b4e8a-172">For cross-apartment marshaling, you can do the following:</span></span>

- <span data-ttu-id="b4e8a-173">Acceptez la surcharge du marshaling intercloisonnements, qui se remarque uniquement quand de nombreux appels dépassent la limite.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-173">Accept the overhead of the cross-apartment marshaling, which is noticeable only when there are many calls across the boundary.</span></span> <span data-ttu-id="b4e8a-174">Vous devez inscrire la bibliothèque de types du composant COM pour que les appels puissent franchir les limites des cloisonnements.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-174">You must register the type library of the COM component for calls to successfully cross the apartment boundary.</span></span>
- <span data-ttu-id="b4e8a-175">Modifiez le thread principal en définissant le thread client sur STA ou MTA.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-175">Alter the main thread by setting the client thread to STA or MTA.</span></span> <span data-ttu-id="b4e8a-176">Par exemple, si votre client C# appelle plusieurs composants COM STA, vous pouvez éviter le marshaling intercloisonnements en définissant le thread principal sur STA.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-176">For example, if your C# client calls many STA COM components, you can avoid cross-apartment marshaling by setting the main thread to STA.</span></span>

    > [!NOTE]
    > <span data-ttu-id="b4e8a-177">Une fois le thread d’un client C# défini sur STA, les appels aux composants COM MTA nécessiteront un marshaling intercloisonnements.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-177">Once the thread of a C# client is set to STA, calls to MTA COM components will require cross-apartment marshaling.</span></span>

<span data-ttu-id="b4e8a-178">Pour obtenir des instructions sur la sélection explicite d’un modèle de cloisonnement, consultez [Threading managé et non managé](/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="b4e8a-178">For instructions on explicitly selecting an apartment model, see [Managed and Unmanaged Threading](/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100)).</span></span>

## <a name="marshaling-remote-calls"></a><span data-ttu-id="b4e8a-179">Marshaling des appels distants</span><span class="sxs-lookup"><span data-stu-id="b4e8a-179">Marshaling Remote Calls</span></span>

<span data-ttu-id="b4e8a-180">Comme pour le marshaling intercloisonnements, le marshaling COM est impliqué dans chaque appel effectué entre du code managé et du code non managé chaque fois que les objets résident dans des processus distincts.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-180">As with cross-apartment marshaling, COM marshaling is involved in each call between managed and unmanaged code whenever the objects reside in separate processes.</span></span> <span data-ttu-id="b4e8a-181">Exemple :</span><span class="sxs-lookup"><span data-stu-id="b4e8a-181">For example:</span></span>

- <span data-ttu-id="b4e8a-182">Un client COM qui appelle un serveur managé sur un hôte distant utilise le modèle DCOM (Distributed COM).</span><span class="sxs-lookup"><span data-stu-id="b4e8a-182">A COM client that invokes a managed server on a remote host uses distributed COM (DCOM).</span></span>
- <span data-ttu-id="b4e8a-183">Un client managé qui appelle un serveur COM sur un hôte distant utilise le modèle DCOM.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-183">A managed client that invokes a COM server on a remote host uses DCOM.</span></span>

<span data-ttu-id="b4e8a-184">L’illustration suivante montre comment le marshaling d’interopérabilité et le marshaling COM fournissent des canaux de communication entre les limites des processus et des hôtes :</span><span class="sxs-lookup"><span data-stu-id="b4e8a-184">The following illustration shows how interop marshaling and COM marshaling provide communications channels across process and host boundaries:</span></span>

<span data-ttu-id="b4e8a-185">![Marshaling COM](./media/interop-marshaling/interop-and-com-marshaling.gif "Marshaling interprocessus")</span><span class="sxs-lookup"><span data-stu-id="b4e8a-185">![COM marshaling](./media/interop-marshaling/interop-and-com-marshaling.gif "Cross-process marshaling")</span></span>

### <a name="preserving-identity"></a><span data-ttu-id="b4e8a-186">Conservation d'identité</span><span class="sxs-lookup"><span data-stu-id="b4e8a-186">Preserving Identity</span></span>

<span data-ttu-id="b4e8a-187">Le common language runtime préserve l'identité des références managées et non managées.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-187">The common language runtime preserves the identity of managed and unmanaged references.</span></span> <span data-ttu-id="b4e8a-188">L'illustration suivante montre le flux des références non managées directes (ligne du haut) et des références managées directes (ligne du bas) entre plusieurs hôtes et processus.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-188">The following illustration shows the flow of direct unmanaged references (top row) and direct managed references (bottom row) across process and host boundaries.</span></span>

<span data-ttu-id="b4e8a-189">![Wrapper CCW (COM Callable Wrapper) et wrapper RCW (Runtime Callable Wrapper)](./media/interop-marshaling/interop-direct-ref-across-process.gif "Références franchissant les limites d'hôtes et de processus")</span><span class="sxs-lookup"><span data-stu-id="b4e8a-189">![COM callable wrapper and runtime callable wrapper](./media/interop-marshaling/interop-direct-ref-across-process.gif "Reference passing across process and host boundaries")</span></span>

<span data-ttu-id="b4e8a-190">Dans cette illustration :</span><span class="sxs-lookup"><span data-stu-id="b4e8a-190">In this illustration:</span></span>

- <span data-ttu-id="b4e8a-191">Un client non managé obtient une référence à un objet COM provenant d'un objet managé qui reçoit cette référence d'un hôte distant.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-191">An unmanaged client gets a reference to a COM object from a managed object that gets this reference from a remote host.</span></span> <span data-ttu-id="b4e8a-192">Le mécanisme de communication à distance est DCOM.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-192">The remoting mechanism is DCOM.</span></span>
- <span data-ttu-id="b4e8a-193">Un client managé obtient une référence à un objet managé provenant d'un objet COM qui reçoit cette référence d'un hôte distant.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-193">A managed client gets a reference to a managed object from a COM object that gets this reference from a remote host.</span></span> <span data-ttu-id="b4e8a-194">Le mécanisme de communication à distance est DCOM.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-194">The remoting mechanism is DCOM.</span></span>

    > [!NOTE]
    > <span data-ttu-id="b4e8a-195">La bibliothèque de types exportée du serveur managée doit être inscrite.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-195">The exported type library of the managed server must be registered.</span></span>

<span data-ttu-id="b4e8a-196">Le nombre de limites de processus entre l'appelant et l'appelé est sans importance. Le même référencement direct se produit pour les appels de type in-process et out-of-process.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-196">The number of process boundaries between caller and callee is irrelevant; the same direct referencing occurs for in-process and out-of-process calls.</span></span>

### <a name="managed-remoting"></a><span data-ttu-id="b4e8a-197">Communication à distance managée</span><span class="sxs-lookup"><span data-stu-id="b4e8a-197">Managed Remoting</span></span>

<span data-ttu-id="b4e8a-198">Le runtime fournit également une communication à distance managée que vous pouvez utiliser pour établir un canal de communication entre des objets managés de plusieurs hôtes et processus.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-198">The runtime also provides managed remoting, which you can use to establish a communications channel between managed objects across process and host boundaries.</span></span> <span data-ttu-id="b4e8a-199">La communication à distance managée peut prendre en charge un pare-feu entre les composants communicants, comme le montre l’illustration suivante :</span><span class="sxs-lookup"><span data-stu-id="b4e8a-199">Managed remoting can accommodate a firewall between the communicating components, as the following illustration shows:</span></span>

<span data-ttu-id="b4e8a-200">![SOAP ou TcpChannel](./media/interop-marshaling/interop-remote-soap-or-tcp.gif "Appels distants traversant des pare-feu à l'aide de SOAP ou de la classe TcpChannel") Appels distants via des pare-feu à l’aide de SOAP ou de la classe TcpChannel</span><span class="sxs-lookup"><span data-stu-id="b4e8a-200">![SOAP or TcpChannel](./media/interop-marshaling/interop-remote-soap-or-tcp.gif "Remote calls across firewalls using SOAP or the TcpChannel class") Remote calls across firewalls using SOAP or the TcpChannel class</span></span>

<span data-ttu-id="b4e8a-201">Certains appels non managés peuvent être transmis par le biais de SOAP, tels que les appels entre composants pris en charge et COM.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-201">Some unmanaged calls can be channeled through SOAP, such as the calls between serviced components and COM.</span></span>

## <a name="related-topics"></a><span data-ttu-id="b4e8a-202">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="b4e8a-202">Related Topics</span></span>

|<span data-ttu-id="b4e8a-203">Titre</span><span class="sxs-lookup"><span data-stu-id="b4e8a-203">Title</span></span>|<span data-ttu-id="b4e8a-204">Description</span><span class="sxs-lookup"><span data-stu-id="b4e8a-204">Description</span></span>|
|-----------|-----------------|
|[<span data-ttu-id="b4e8a-205">comportement de marshaling par défaut</span><span class="sxs-lookup"><span data-stu-id="b4e8a-205">Default Marshaling Behavior</span></span>](default-marshaling-behavior.md)|<span data-ttu-id="b4e8a-206">Décrit les règles utilisées par le service de marshaling d’interopérabilité pour marshaler des données.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-206">Describes the rules that the interop marshaling service uses to marshal data.</span></span>|
|[<span data-ttu-id="b4e8a-207">Marshaling de données à l’aide de l’appel de code managé</span><span class="sxs-lookup"><span data-stu-id="b4e8a-207">Marshaling Data with Platform Invoke</span></span>](marshaling-data-with-platform-invoke.md)|<span data-ttu-id="b4e8a-208">Décrit comment déclarer des paramètres de méthode et passer des arguments à des fonctions exportées par des bibliothèques non managées.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-208">Describes how to declare method parameters and pass arguments to functions exported by unmanaged libraries.</span></span>|
|[<span data-ttu-id="b4e8a-209">marshaler des données avec COM Interop</span><span class="sxs-lookup"><span data-stu-id="b4e8a-209">Marshaling Data with COM Interop</span></span>](marshaling-data-with-com-interop.md)|<span data-ttu-id="b4e8a-210">Décrit comment personnaliser des wrappers COM pour modifier le comportement de marshaling.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-210">Describes how to customize COM wrappers to alter marshaling behavior.</span></span>|
|[<span data-ttu-id="b4e8a-211">Procédure : Migrer du code DCOM managé vers WCF</span><span class="sxs-lookup"><span data-stu-id="b4e8a-211">How to: Migrate Managed-Code DCOM to WCF</span></span>](how-to-migrate-managed-code-dcom-to-wcf.md)|<span data-ttu-id="b4e8a-212">Décrit comment effectuer une migration de DCOM à WCF.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-212">Describes how to migrate from DCOM to WCF.</span></span>|
|[<span data-ttu-id="b4e8a-213">Procédure : mapper des HRESULT et des exceptions</span><span class="sxs-lookup"><span data-stu-id="b4e8a-213">How to: Map HRESULTs and Exceptions</span></span>](how-to-map-hresults-and-exceptions.md)|<span data-ttu-id="b4e8a-214">Décrit comment mapper des exceptions personnalisées aux HRESULT et fournit le mappage complet de chaque HRESULT à sa classe d'exception comparable dans .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-214">Describes how to map custom exceptions to HRESULTs and provides the complete mapping from each HRESULT to its comparable exception class in the .NET Framework.</span></span>|
|<span data-ttu-id="b4e8a-215">[Interopérabilité à l’aide de types génériques](/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="b4e8a-215">[Interoperating Using Generic Types](/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span></span>|<span data-ttu-id="b4e8a-216">Décrit les actions prises en charge lors de l'utilisation de types génériques pour l'interopérabilité COM.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-216">Describes which actions are supported when using generic types for COM interoperability.</span></span>|
|[<span data-ttu-id="b4e8a-217">Interopération avec du code non managé</span><span class="sxs-lookup"><span data-stu-id="b4e8a-217">Interoperating with Unmanaged Code</span></span>](index.md)|<span data-ttu-id="b4e8a-218">Décrit les services d'interopérabilité fournis par le common language runtime.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-218">Describes interoperability services provided by the common language runtime.</span></span>|
|<span data-ttu-id="b4e8a-219">[Interopérabilité COM avancée](/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="b4e8a-219">[Advanced COM Interoperability](/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span></span>|<span data-ttu-id="b4e8a-220">Fournit des liens vers des informations sur l'incorporation de composants COM dans une application .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-220">Provides links to more information about incorporating COM components into your .NET Framework application.</span></span>|
|<span data-ttu-id="b4e8a-221">[Considérations relatives à la conception de l’interopérabilité](/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="b4e8a-221">[Design Considerations for Interoperation](/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span></span>|<span data-ttu-id="b4e8a-222">Fournit des conseils pour l'écriture de composants COM intégrés.</span><span class="sxs-lookup"><span data-stu-id="b4e8a-222">Provides tips for writing integrated COM components.</span></span>|

## <a name="reference"></a><span data-ttu-id="b4e8a-223">Informations de référence</span><span class="sxs-lookup"><span data-stu-id="b4e8a-223">Reference</span></span>

<xref:System.Runtime.InteropServices?displayProperty=nameWithType>

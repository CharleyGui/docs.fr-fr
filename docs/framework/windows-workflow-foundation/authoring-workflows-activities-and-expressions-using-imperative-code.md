---
title: Création de workflows, d'activités et d'expressions à l'aide du code impératif
description: Une définition de flux de travail Workflow Foundation est une arborescence d’objets d’activité configurés. Utilisez du code pour créer des définitions de flux de travail, des activités et des expressions.
ms.date: 03/30/2017
ms.assetid: cefc9cfc-2882-4eb9-8c94-7a6da957f2b2
ms.openlocfilehash: 5355f2090317a0bce3fec0f46550b202bd0af095
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/26/2020
ms.locfileid: "96289124"
---
# <a name="authoring-workflows-activities-and-expressions-using-imperative-code"></a><span data-ttu-id="95f6f-104">Création de workflows, d'activités et d'expressions à l'aide du code impératif</span><span class="sxs-lookup"><span data-stu-id="95f6f-104">Authoring Workflows, Activities, and Expressions Using Imperative Code</span></span>

<span data-ttu-id="95f6f-105">Une définition de workflow est une arborescence d’objets d’activité configurés.</span><span class="sxs-lookup"><span data-stu-id="95f6f-105">A workflow definition is a tree of configured activity objects.</span></span> <span data-ttu-id="95f6f-106">Cette arborescence d'activités peut être définie de nombreuses façons, notamment en modifiant manuellement des données XAML ou en utilisant le Workflow Designer pour produire  des données XAML.</span><span class="sxs-lookup"><span data-stu-id="95f6f-106">This tree of activities can be defined many ways, including by hand-editing XAML or by using the Workflow Designer to produce XAML.</span></span> <span data-ttu-id="95f6f-107">L'utilisation de XAML n'est toutefois pas impérative.</span><span class="sxs-lookup"><span data-stu-id="95f6f-107">Use of XAML, however, is not a requirement.</span></span> <span data-ttu-id="95f6f-108">Les définitions de workflow peuvent également être créées par programmation.</span><span class="sxs-lookup"><span data-stu-id="95f6f-108">Workflow definitions can also be created programmatically.</span></span> <span data-ttu-id="95f6f-109">Cette rubrique fournit une vue d'ensemble de la création des définitions, des activités et des expressions de workflow à l'aide du code.</span><span class="sxs-lookup"><span data-stu-id="95f6f-109">This topic provides an overview of creating workflow definitions, activities, and expressions by using code.</span></span> <span data-ttu-id="95f6f-110">Pour obtenir des exemples d’utilisation de workflows XAML à l’aide de code, consultez [sérialisation de workflows et d’activités vers et à partir de XAML](serializing-workflows-and-activities-to-and-from-xaml.md).</span><span class="sxs-lookup"><span data-stu-id="95f6f-110">For examples of working with XAML workflows using code, see [Serializing Workflows and Activities to and from XAML](serializing-workflows-and-activities-to-and-from-xaml.md).</span></span>  
  
## <a name="creating-workflow-definitions"></a><span data-ttu-id="95f6f-111">Création de définitions de workflow</span><span class="sxs-lookup"><span data-stu-id="95f6f-111">Creating Workflow Definitions</span></span>  

 <span data-ttu-id="95f6f-112">Une définition de workflow peut être créée en instanciant une instance d'un type d'activité et configurant les propriétés de l'objet d'activité.</span><span class="sxs-lookup"><span data-stu-id="95f6f-112">A workflow definition can be created by instantiating an instance of an activity type and configuring the activity object’s properties.</span></span> <span data-ttu-id="95f6f-113">Pour les activités qui ne contiennent pas d'activités enfants, cette opération peut être effectuée à l'aide de quelques lignes de code.</span><span class="sxs-lookup"><span data-stu-id="95f6f-113">For activities that do not contain child activities, this can be accomplished using a few lines of code.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#47](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#47)]  
  
> [!NOTE]
> <span data-ttu-id="95f6f-114">Les exemples de cette rubrique utilisent <xref:System.Activities.WorkflowInvoker> pour exécuter les exemples de workflow.</span><span class="sxs-lookup"><span data-stu-id="95f6f-114">The examples in this topic use <xref:System.Activities.WorkflowInvoker> to run the sample workflows.</span></span> <span data-ttu-id="95f6f-115">Pour plus d’informations sur l’appel de workflows, le passage d’arguments et les différents choix d’hébergement disponibles, consultez [utilisation de WorkflowInvoker et WorkflowApplication](using-workflowinvoker-and-workflowapplication.md).</span><span class="sxs-lookup"><span data-stu-id="95f6f-115">For more information about invoking workflows, passing arguments, and the different hosting choices that are available, see [Using WorkflowInvoker and WorkflowApplication](using-workflowinvoker-and-workflowapplication.md).</span></span>  
  
 <span data-ttu-id="95f6f-116">Dans cet exemple, un workflow qui consiste en une activité <xref:System.Activities.Statements.WriteLine> unique est créé.</span><span class="sxs-lookup"><span data-stu-id="95f6f-116">In this example, a workflow that consists of a single <xref:System.Activities.Statements.WriteLine> activity is created.</span></span> <span data-ttu-id="95f6f-117">L'argument <xref:System.Activities.Statements.WriteLine> de l'activité <xref:System.Activities.Statements.WriteLine.Text%2A> est défini et le workflow est appelé.</span><span class="sxs-lookup"><span data-stu-id="95f6f-117">The <xref:System.Activities.Statements.WriteLine> activity’s <xref:System.Activities.Statements.WriteLine.Text%2A> argument is set, and the workflow is invoked.</span></span> <span data-ttu-id="95f6f-118">Si une activité contient des activités enfants, la méthode de construction est semblable.</span><span class="sxs-lookup"><span data-stu-id="95f6f-118">If an activity contains child activities, the method of construction is similar.</span></span> <span data-ttu-id="95f6f-119">L'exemple suivant utilise une activité <xref:System.Activities.Statements.Sequence> qui contient deux activités <xref:System.Activities.Statements.WriteLine>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-119">The following example uses a <xref:System.Activities.Statements.Sequence> activity that contains two <xref:System.Activities.Statements.WriteLine> activities.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#48](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#48)]  
  
### <a name="using-object-initializers"></a><span data-ttu-id="95f6f-120">Utilisation d'initialiseurs d'objets</span><span class="sxs-lookup"><span data-stu-id="95f6f-120">Using Object Initializers</span></span>  

 <span data-ttu-id="95f6f-121">Les exemples de cette rubrique utilisent la syntaxe d'initialisation d'objet.</span><span class="sxs-lookup"><span data-stu-id="95f6f-121">The examples in this topic use object initialization syntax.</span></span> <span data-ttu-id="95f6f-122">La syntaxe d'initialisation d'objet peut être une méthode utile pour créer des définitions de workflow dans le code, car elle fournit une vue hiérarchique des activités dans le workflow et affiche la relation entre les activités.</span><span class="sxs-lookup"><span data-stu-id="95f6f-122">Object initialization syntax can be a useful way to create workflow definitions in code because it provides a hierarchical view of the activities in the workflow and shows the relationship between the activities.</span></span> <span data-ttu-id="95f6f-123">Il n'est pas impératif d'utiliser la syntaxe d'initialisation d'objet lorsque vous créez des workflows par programmation.</span><span class="sxs-lookup"><span data-stu-id="95f6f-123">There is no requirement to use object initialization syntax when you programmatically create workflows.</span></span> <span data-ttu-id="95f6f-124">L'exemple suivant est d'un point de vue fonctionnel équivalent à l'exemple précédent :</span><span class="sxs-lookup"><span data-stu-id="95f6f-124">The following example is functionally equivalent to the previous example.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#49](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#49)]  
  
 <span data-ttu-id="95f6f-125">Pour plus d’informations sur les initialiseurs d’objets, consultez [Comment : initialiser des objets sans appeler de constructeur (Guide de programmation C#)](../../csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer.md) et [Comment : déclarer un objet à l’aide d’un initialiseur d’objet](../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-declare-an-object-by-using-an-object-initializer.md).</span><span class="sxs-lookup"><span data-stu-id="95f6f-125">For more information about object initializers, see [How to: Initialize Objects without Calling a Constructor (C# Programming Guide)](../../csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer.md) and [How to: Declare an Object by Using an Object Initializer](../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-declare-an-object-by-using-an-object-initializer.md).</span></span>  
  
### <a name="working-with-variables-literal-values-and-expressions"></a><span data-ttu-id="95f6f-126">Utilisation de variables, de valeurs littérales et d'expressions</span><span class="sxs-lookup"><span data-stu-id="95f6f-126">Working with Variables, Literal Values, and Expressions</span></span>  

 <span data-ttu-id="95f6f-127">Lorsque vous créez une définition de workflow à l'aide de code, tenez compte de ce que le code exécute dans le cadre de la création de la définition de workflow et de ce qu'il exécute dans le cadre de l'exécution d'une instance de ce workflow.</span><span class="sxs-lookup"><span data-stu-id="95f6f-127">When creating a workflow definition using code, be aware of what code executes as part of the creation of the workflow definition and what code executes as part of the execution of an instance of that workflow.</span></span> <span data-ttu-id="95f6f-128">Par exemple, le workflow suivant est conçu pour générer un nombre aléatoire et l'écrire dans la console.</span><span class="sxs-lookup"><span data-stu-id="95f6f-128">For example, the following workflow is intended to generate a random number and write it to the console.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#50](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#50)]  
  
 <span data-ttu-id="95f6f-129">Lorsque ce code de définition de workflow est exécuté, l'appel à `Random.Next` est passé et le résultat est stocké dans la définition de workflow comme valeur littérale.</span><span class="sxs-lookup"><span data-stu-id="95f6f-129">When this workflow definition code is executed, the call to `Random.Next` is made and the result is stored in the workflow definition as a literal value.</span></span> <span data-ttu-id="95f6f-130">De nombreuses instances de ce workflow peuvent être appelées et toutes afficheraient le même nombre.</span><span class="sxs-lookup"><span data-stu-id="95f6f-130">Many instances of this workflow can be invoked, and all would display the same number.</span></span> <span data-ttu-id="95f6f-131">Pour que la génération du nombre aléatoire ait lieu pendant l'exécution du workflow, une expression qui est évaluée à chaque exécution du workflow doit être utilisée.</span><span class="sxs-lookup"><span data-stu-id="95f6f-131">To have the random number generation occur during workflow execution, an expression must be used that is evaluated each time the workflow runs.</span></span> <span data-ttu-id="95f6f-132">Dans l'exemple suivant, une expression Visual Basic est utilisée avec <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-132">In the following example, a Visual Basic expression is used with a <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#51](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#51)]  
  
 <span data-ttu-id="95f6f-133">L'expression dans l'exemple précédent pourrait également être implémentée à l'aide de <xref:Microsoft.CSharp.Activities.CSharpValue%601> et d'une expression C#.</span><span class="sxs-lookup"><span data-stu-id="95f6f-133">The expression in the previous example could also be implemented using a <xref:Microsoft.CSharp.Activities.CSharpValue%601> and a C# expression.</span></span>  
  
```csharp  
new Assign<int>  
{  
    To = n,  
    Value = new CSharpValue<int>("new Random().Next(1, 101)")  
}  
```  
  
 <span data-ttu-id="95f6f-134">Les expressions C# doivent être compilées avant que le workflow qui les contient ne soit appelé.</span><span class="sxs-lookup"><span data-stu-id="95f6f-134">C# expressions must be compiled before the workflow containing them is invoked.</span></span> <span data-ttu-id="95f6f-135">Si les expressions C# ne sont pas compilées, une <xref:System.NotSupportedException> exception est levée lorsque le workflow est appelé avec un message similaire à ce qui suit : ``Expression Activity type 'CSharpValue`1' requires compilation in order to run.  Please ensure that the workflow has been compiled.`` dans la plupart des scénarios impliquant des flux de travail créés dans Visual Studio, les expressions c# sont compilées automatiquement, mais dans certains scénarios, tels que les flux de travail de code, les expressions c# doivent être compilées manuellement.</span><span class="sxs-lookup"><span data-stu-id="95f6f-135">If the C# expressions are not compiled, a <xref:System.NotSupportedException> is thrown when the workflow is invoked with a message similar to the following: ``Expression Activity type 'CSharpValue`1' requires compilation in order to run.  Please ensure that the workflow has been compiled.`` In most scenarios involving workflows created in Visual Studio the C# expressions are compiled automatically, but in some scenarios, such as code workflows, the C# expressions must be manually compiled.</span></span> <span data-ttu-id="95f6f-136">Pour obtenir un exemple de compilation d’expressions C#, consultez la section [utilisation d’expressions c# dans les flux de travail de code](csharp-expressions.md#CodeWorkflows) de la rubrique [expressions c#](csharp-expressions.md) .</span><span class="sxs-lookup"><span data-stu-id="95f6f-136">For an example of how to compile C# expressions, see the [Using C# expressions in code workflows](csharp-expressions.md#CodeWorkflows) section of the [C# Expressions](csharp-expressions.md) topic.</span></span>  
  
 <span data-ttu-id="95f6f-137"><xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> représente une expression dans la syntaxe Visual Basic qui peut être utilisée comme r-value dans une expression et <xref:Microsoft.CSharp.Activities.CSharpValue%601> représente une expression dans la syntaxe C# qui peut être utilisée comme r-value dans une expression.</span><span class="sxs-lookup"><span data-stu-id="95f6f-137">A <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> represents an expression in Visual Basic syntax that can be used as an r-value in an expression, and a <xref:Microsoft.CSharp.Activities.CSharpValue%601> represents an expression in C# syntax that can be used as an r-value in an expression.</span></span> <span data-ttu-id="95f6f-138">Ces expressions sont évaluées chaque fois que l'activité conteneur est exécutée.</span><span class="sxs-lookup"><span data-stu-id="95f6f-138">These expressions are evaluated each time the containing activity is executed.</span></span> <span data-ttu-id="95f6f-139">Le résultat de l'expression est affecté à la variable de workflow `n` et ces résultats sont utilisés par l'activité suivante dans le workflow.</span><span class="sxs-lookup"><span data-stu-id="95f6f-139">The result of the expression is assigned to the workflow variable `n`, and these results are used by the next activity in the workflow.</span></span> <span data-ttu-id="95f6f-140">Pour accéder à la valeur de la variable de workflow `n` au moment de l'exécution, le <xref:System.Activities.ActivityContext> est requis.</span><span class="sxs-lookup"><span data-stu-id="95f6f-140">To access the value of the workflow variable `n` at runtime, the <xref:System.Activities.ActivityContext> is required.</span></span> <span data-ttu-id="95f6f-141">Elle est accessible à l’aide de l’expression lambda suivante.</span><span class="sxs-lookup"><span data-stu-id="95f6f-141">This can be accessed by using the following lambda expression.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="95f6f-142">Notez que ces deux exemples de code utilisent C# comme langage de programmation, mais l'un d'eux utilise <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> et l'autre utilise <xref:Microsoft.CSharp.Activities.CSharpValue%601>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-142">Note that both of these code are examples are using C# as the programming language, but one uses a <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> and one uses a <xref:Microsoft.CSharp.Activities.CSharpValue%601>.</span></span> <span data-ttu-id="95f6f-143"><xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> et <xref:Microsoft.CSharp.Activities.CSharpValue%601> peuvent être utilisés dans les projets Visual Basic et C#.</span><span class="sxs-lookup"><span data-stu-id="95f6f-143"><xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> and <xref:Microsoft.CSharp.Activities.CSharpValue%601> can be used in both Visual Basic and C# projects.</span></span> <span data-ttu-id="95f6f-144">Par défaut, les expressions créées dans le concepteur de workflow correspondent au langage du projet d'hébergement.</span><span class="sxs-lookup"><span data-stu-id="95f6f-144">By default, expressions created in the workflow designer match the language of the hosting project.</span></span> <span data-ttu-id="95f6f-145">Lors de la création des workflows dans le code, le langage souhaité est à la discrétion de l'auteur de workflow.</span><span class="sxs-lookup"><span data-stu-id="95f6f-145">When creating workflows in code, the desired language is at the discretion of the workflow author.</span></span>  
  
 <span data-ttu-id="95f6f-146">Dans ces exemples, le résultat de l'expression est affecté à la variable de workflow `n` et ces résultats sont utilisés par l'activité suivante dans le workflow.</span><span class="sxs-lookup"><span data-stu-id="95f6f-146">In these examples the result of the expression is assigned to the workflow variable `n`, and these results are used by the next activity in the workflow.</span></span> <span data-ttu-id="95f6f-147">Pour accéder à la valeur de la variable de workflow `n` au moment de l'exécution, le <xref:System.Activities.ActivityContext> est requis.</span><span class="sxs-lookup"><span data-stu-id="95f6f-147">To access the value of the workflow variable `n` at runtime, the <xref:System.Activities.ActivityContext> is required.</span></span> <span data-ttu-id="95f6f-148">Elle est accessible à l’aide de l’expression lambda suivante.</span><span class="sxs-lookup"><span data-stu-id="95f6f-148">This can be accessed by using the following lambda expression.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#52](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#52)]  
  
 <span data-ttu-id="95f6f-149">Pour plus d’informations sur les expressions lambda, consultez [expressions lambda (référence C#)](../../csharp/language-reference/operators/lambda-expressions.md) ou [expressions lambda (Visual Basic)](../../visual-basic/programming-guide/language-features/procedures/lambda-expressions.md).</span><span class="sxs-lookup"><span data-stu-id="95f6f-149">For more information about lambda expressions, see [Lambda Expressions (C# reference)](../../csharp/language-reference/operators/lambda-expressions.md) or [Lambda Expressions (Visual Basic)](../../visual-basic/programming-guide/language-features/procedures/lambda-expressions.md).</span></span>  
  
 <span data-ttu-id="95f6f-150">Les expressions lambda ne sont pas sérialisables au format XAML.</span><span class="sxs-lookup"><span data-stu-id="95f6f-150">Lambda expressions are not serializable to XAML format.</span></span> <span data-ttu-id="95f6f-151">Si une tentative de sérialiser un workflow avec les expressions lambda est faite, <xref:System.Activities.Expressions.LambdaSerializationException> est levée avec le message suivant : « Ce workflow contient des expressions lambda spécifiées dans le code.</span><span class="sxs-lookup"><span data-stu-id="95f6f-151">If an attempt to serialize a workflow with lambda expressions is made, a <xref:System.Activities.Expressions.LambdaSerializationException> is thrown with the following message: "This workflow contains lambda expressions specified in code.</span></span> <span data-ttu-id="95f6f-152">Ces expressions ne peuvent pas être sérialisées en XAML.</span><span class="sxs-lookup"><span data-stu-id="95f6f-152">These expressions are not XAML serializable.</span></span> <span data-ttu-id="95f6f-153">Pour cela, utilisez VisualBasicValue/VisualBasicReference ou ExpressionServices.Convert(lambda).</span><span class="sxs-lookup"><span data-stu-id="95f6f-153">In order to make your workflow XAML-serializable, either use VisualBasicValue/VisualBasicReference or ExpressionServices.Convert(lambda).</span></span> <span data-ttu-id="95f6f-154">Cela convertira les expressions lambda en activités d'expressions. »</span><span class="sxs-lookup"><span data-stu-id="95f6f-154">This will convert your lambda expressions into expression activities."</span></span> <span data-ttu-id="95f6f-155">Pour rendre cette expression compatible avec XAML, utilisez <xref:System.Activities.Expressions.ExpressionServices> et <xref:System.Activities.Expressions.ExpressionServices.Convert%2A>, comme illustré dans l'exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="95f6f-155">To make this expression compatible with XAML, use <xref:System.Activities.Expressions.ExpressionServices> and <xref:System.Activities.Expressions.ExpressionServices.Convert%2A>, as shown in the following example.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#53](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#53)]  
  
 <span data-ttu-id="95f6f-156">Un <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> pourrait également être utilisé.</span><span class="sxs-lookup"><span data-stu-id="95f6f-156">A <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> could also be used.</span></span> <span data-ttu-id="95f6f-157">Notez qu'aucune expression lambda n'est requise lors de l'utilisation d'une expression Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="95f6f-157">Note that no lambda expression is required when using a Visual Basic expression.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#54](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#54)]  
  
 <span data-ttu-id="95f6f-158">Au moment de l'exécution, les expressions Visual Basic sont compilées dans des expressions LINQ.</span><span class="sxs-lookup"><span data-stu-id="95f6f-158">At run time, Visual Basic expressions are compiled into LINQ expressions.</span></span> <span data-ttu-id="95f6f-159">Les deux exemples précédents sont sérialisables en XAML, mais si le code XAML sérialisé est conçu pour être affiché et modifié dans le concepteur de workflow, utilisez <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> pour vos expressions.</span><span class="sxs-lookup"><span data-stu-id="95f6f-159">Both of the previous examples are serializable to XAML, but if the serialized XAML is intended to be viewed and edited in the workflow designer, use <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> for your expressions.</span></span> <span data-ttu-id="95f6f-160">Les workflows sérialisés qui utilisent `ExpressionServices.Convert` peuvent être ouverts dans le concepteur, mais la valeur de l'expression sera vide.</span><span class="sxs-lookup"><span data-stu-id="95f6f-160">Serialized workflows that use `ExpressionServices.Convert` can be opened in the designer, but the value of the expression will be blank.</span></span> <span data-ttu-id="95f6f-161">Pour plus d’informations sur la sérialisation des flux de travail en XAML, consultez [sérialisation de workflows et d’activités vers et à partir de XAML](serializing-workflows-and-activities-to-and-from-xaml.md).</span><span class="sxs-lookup"><span data-stu-id="95f6f-161">For more information about serializing workflows to XAML, see [Serializing Workflows and Activities to and from XAML](serializing-workflows-and-activities-to-and-from-xaml.md).</span></span>  
  
#### <a name="literal-expressions-and-reference-types"></a><span data-ttu-id="95f6f-162">Expressions littérales et types de référence</span><span class="sxs-lookup"><span data-stu-id="95f6f-162">Literal Expressions and Reference Types</span></span>  

 <span data-ttu-id="95f6f-163">Les expressions littérales sont représentées dans les workflows par l'activité <xref:System.Activities.Expressions.Literal%601>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-163">Literal expressions are represented in workflows by the <xref:System.Activities.Expressions.Literal%601> activity.</span></span> <span data-ttu-id="95f6f-164">Les activités <xref:System.Activities.Statements.WriteLine> suivantes sont équivalentes du point de vue fonctionnel.</span><span class="sxs-lookup"><span data-stu-id="95f6f-164">The following <xref:System.Activities.Statements.WriteLine> activities are functionally equivalent.</span></span>  
  
```csharp  
new WriteLine  
{  
    Text = "Hello World."  
},  
new WriteLine  
{  
    Text = new Literal<string>("Hello World.")  
}  
```  
  
 <span data-ttu-id="95f6f-165">Elle n'est pas valide pour initialiser une expression littérale avec un type de référence, sauf <xref:System.String>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-165">It is invalid to initialize a literal expression with any reference type except <xref:System.String>.</span></span> <span data-ttu-id="95f6f-166">Dans l'exemple suivant, la propriété <xref:System.Activities.Statements.Assign> d'une activité <xref:System.Activities.Statements.Assign.Value%2A> est initialisée avec une expression littérale à l'aide de `List<string>`.</span><span class="sxs-lookup"><span data-stu-id="95f6f-166">In the following example, an <xref:System.Activities.Statements.Assign> activity's <xref:System.Activities.Statements.Assign.Value%2A> property is initialized with a literal expression using a `List<string>`.</span></span>  
  
```csharp  
new Assign  
{  
    To = new OutArgument<List<string>>(items),  
    Value = new InArgument<List<string>>(new List<string>())  
},  
```  
  
 <span data-ttu-id="95f6f-167">Lorsque le workflow contenant cette activité est validé, l'erreur de validation suivante est retournée : « Un littéral prend uniquement en charge les types valeur et le type immuable System.String.</span><span class="sxs-lookup"><span data-stu-id="95f6f-167">When the workflow containing this activity is validated, the following validation error is returned: "Literal only supports value types and the immutable type System.String.</span></span> <span data-ttu-id="95f6f-168">Le type System.Collections.Generic.List\`1[System.String] ne peut pas être utilisé comme littéral. »</span><span class="sxs-lookup"><span data-stu-id="95f6f-168">The type System.Collections.Generic.List\`1[System.String] cannot be used as a literal."</span></span> <span data-ttu-id="95f6f-169">Si le workflow est appelé, il lève une <xref:System.Activities.InvalidWorkflowException> qui contient le texte de l'erreur de validation.</span><span class="sxs-lookup"><span data-stu-id="95f6f-169">If the workflow is invoked, an <xref:System.Activities.InvalidWorkflowException> is thrown that contains the text of the validation error.</span></span> <span data-ttu-id="95f6f-170">Il s’agit d’une erreur de validation, car la création d’une expression littérale avec un type de référence ne crée pas de nouvelle instance du type de référence pour chaque instance du workflow.</span><span class="sxs-lookup"><span data-stu-id="95f6f-170">This is a validation error because creating a literal expression with a reference type does not create a new instance of the reference type for each instance of the workflow.</span></span> <span data-ttu-id="95f6f-171">Pour résoudre ce problème, remplacez l'expression littérale par une expression qui crée et retourne une nouvelle instance du type de référence.</span><span class="sxs-lookup"><span data-stu-id="95f6f-171">To resolve this, replace the literal expression with one that creates and returns a new instance of the reference type.</span></span>  
  
```csharp  
new Assign  
{  
    To = new OutArgument<List<string>>(items),  
    Value = new InArgument<List<string>>(new VisualBasicValue<List<string>>("New List(Of String)"))  
},  
```  
  
 <span data-ttu-id="95f6f-172">Pour plus d’informations sur les expressions, consultez [expressions](expressions.md).</span><span class="sxs-lookup"><span data-stu-id="95f6f-172">For more information about expressions, see [Expressions](expressions.md).</span></span>  
  
#### <a name="invoking-methods-on-objects-using-expressions-and-the-invokemethod-activity"></a><span data-ttu-id="95f6f-173">Appeler des méthodes sur des objets à l'aide d'expressions et de l'activité InvokeMethod</span><span class="sxs-lookup"><span data-stu-id="95f6f-173">Invoking Methods on Objects using Expressions and the InvokeMethod Activity</span></span>  

 <span data-ttu-id="95f6f-174">L'activité <xref:System.Activities.Expressions.InvokeMethod%601> peut être utilisée pour appeler les méthodes statiques et d'instance des classes dans le .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="95f6f-174">The <xref:System.Activities.Expressions.InvokeMethod%601> activity can be used to invoke static and instance methods of classes in the .NET Framework.</span></span> <span data-ttu-id="95f6f-175">Dans un exemple précédent de cette rubrique, un nombre aléatoire a été généré à l'aide de la classe <xref:System.Random>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-175">In a previous example in this topic, a random number was generated using the <xref:System.Random> class.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#51](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#51)]  
  
 <span data-ttu-id="95f6f-176">L'activité <xref:System.Activities.Expressions.InvokeMethod%601> peut avoir été utilisée pour appeler la méthode <xref:System.Random.Next%2A> de classe <xref:System.Random>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-176">The <xref:System.Activities.Expressions.InvokeMethod%601> activity could also have been used to call the <xref:System.Random.Next%2A> method of the <xref:System.Random> class.</span></span>  
  
```csharp  
new InvokeMethod<int>  
{  
    TargetObject = new InArgument<Random>(new VisualBasicValue<Random>("New Random()")),  
    MethodName = "Next",  
    Parameters =
    {  
        new InArgument<int>(1),  
        new InArgument<int>(101)  
    },  
    Result = n  
}  
```  
  
 <span data-ttu-id="95f6f-177">Étant donné que <xref:System.Random.Next%2A> n'est pas une méthode statique, une instance de la classe <xref:System.Random> est fournie pour la propriété <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-177">Since <xref:System.Random.Next%2A> is not a static method, an instance of the <xref:System.Random> class is supplied for the <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A> property.</span></span> <span data-ttu-id="95f6f-178">Dans cet exemple une nouvelle instance est créée à l'aide d'une expression Visual Basic, mais elle peut également avoir été créée précédemment et stockée dans une variable de workflow.</span><span class="sxs-lookup"><span data-stu-id="95f6f-178">In this example a new instance is created using a Visual Basic expression, but it could also have been created previously and stored in a workflow variable.</span></span> <span data-ttu-id="95f6f-179">Dans cet exemple, il serait plus simple d'utiliser l'activité <xref:System.Activities.Statements.Assign%601> plutôt que l'activité <xref:System.Activities.Expressions.InvokeMethod%601>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-179">In this example, it would be simpler to use the <xref:System.Activities.Statements.Assign%601> activity instead of the <xref:System.Activities.Expressions.InvokeMethod%601> activity.</span></span> <span data-ttu-id="95f6f-180">Si l'appel de la méthode appelée en dernier lieu par l'activité <xref:System.Activities.Statements.Assign%601> ou <xref:System.Activities.Expressions.InvokeMethod%601> est long, <xref:System.Activities.Expressions.InvokeMethod%601> présente un avantage, car il a une propriété <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-180">If the method call ultimately invoked by either the <xref:System.Activities.Statements.Assign%601> or <xref:System.Activities.Expressions.InvokeMethod%601> activities is long running, <xref:System.Activities.Expressions.InvokeMethod%601> has an advantage since it has a <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> property.</span></span> <span data-ttu-id="95f6f-181">Lorsque cette propriété a la valeur `true`, la méthode appelée s'exécute de façon asynchrone par rapport au workflow.</span><span class="sxs-lookup"><span data-stu-id="95f6f-181">When this property is set to `true`, the invoked method will run asynchronously with regard to the workflow.</span></span> <span data-ttu-id="95f6f-182">Si d'autres activités existent en parallèle, elles ne seront pas bloquées pendant que la méthode s'exécute de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="95f6f-182">If other activities are in parallel, they will not be blocked while the method is asynchronously executing.</span></span> <span data-ttu-id="95f6f-183">En outre, si la méthode à appeler n'a aucune valeur de retour, <xref:System.Activities.Expressions.InvokeMethod%601> est la méthode appropriée pour appeler la méthode.</span><span class="sxs-lookup"><span data-stu-id="95f6f-183">Also, if the method to be invoked has no return value, then <xref:System.Activities.Expressions.InvokeMethod%601> is the appropriate way to invoke the method.</span></span>  
  
## <a name="arguments-and-dynamic-activities"></a><span data-ttu-id="95f6f-184">Arguments et activités dynamiques</span><span class="sxs-lookup"><span data-stu-id="95f6f-184">Arguments and Dynamic Activities</span></span>  

 <span data-ttu-id="95f6f-185">Une définition de workflow est créée dans le code en assemblant des activités dans une arborescence d’activité et en configurant l’ensemble des propriétés et arguments.</span><span class="sxs-lookup"><span data-stu-id="95f6f-185">A workflow definition is created in code by assembling activities into an activity tree and configuring any properties and arguments.</span></span> <span data-ttu-id="95f6f-186">Les arguments existants peuvent être liés, mais les nouveaux arguments ne peuvent pas être ajoutés aux activités.</span><span class="sxs-lookup"><span data-stu-id="95f6f-186">Existing arguments can be bound, but new arguments cannot be added to activities.</span></span> <span data-ttu-id="95f6f-187">Cela inclut les arguments de workflow passés à l’activité racine.</span><span class="sxs-lookup"><span data-stu-id="95f6f-187">This includes workflow arguments passed to the root activity.</span></span> <span data-ttu-id="95f6f-188">Dans le code impératif, les arguments de workflow sont spécifiés comme propriétés sur un nouveau type CLR et, en XAML, ils sont déclarés à l'aide de `x:Class` et `x:Member`.</span><span class="sxs-lookup"><span data-stu-id="95f6f-188">In imperative code, workflow arguments are specified as properties on a new CLR type, and in XAML they are declared by using `x:Class` and `x:Member`.</span></span> <span data-ttu-id="95f6f-189">Étant donné qu'il n'existe aucun nouveau type CLR créé lorsqu'une définition de workflow est créée comme une arborescence d'objets en mémoire, les arguments ne peuvent pas être ajoutés.</span><span class="sxs-lookup"><span data-stu-id="95f6f-189">Because there is no new CLR type created when a workflow definition is created as a tree of in-memory objects, arguments cannot be added.</span></span> <span data-ttu-id="95f6f-190">Toutefois, les arguments peuvent être ajoutés à une <xref:System.Activities.DynamicActivity>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-190">However, arguments can be added to a <xref:System.Activities.DynamicActivity>.</span></span> <span data-ttu-id="95f6f-191">Dans cet exemple, un <xref:System.Activities.DynamicActivity%601> qui accepte deux arguments entiers, les additionne et retourne le résultat est créé.</span><span class="sxs-lookup"><span data-stu-id="95f6f-191">In this example, a <xref:System.Activities.DynamicActivity%601> is created that takes two integer arguments, adds them together, and returns the result.</span></span> <span data-ttu-id="95f6f-192">Une <xref:System.Activities.DynamicActivityProperty> est créée pour chaque argument et le résultat de l’opération est affecté à l’argument <xref:System.Activities.Activity%601.Result%2A> de <xref:System.Activities.DynamicActivity%601>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-192">A <xref:System.Activities.DynamicActivityProperty> is created for each argument, and the result of the operation is assigned to the <xref:System.Activities.Activity%601.Result%2A> argument of the <xref:System.Activities.DynamicActivity%601>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#55](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#55)]  
  
 <span data-ttu-id="95f6f-193">Pour plus d’informations sur les activités dynamiques, consultez [création d’une activité au moment de l’exécution](creating-an-activity-at-runtime-with-dynamicactivity.md).</span><span class="sxs-lookup"><span data-stu-id="95f6f-193">For more information about dynamic activities, see [Creating an Activity at Runtime](creating-an-activity-at-runtime-with-dynamicactivity.md).</span></span>  
  
## <a name="compiled-activities"></a><span data-ttu-id="95f6f-194">Activités compilées</span><span class="sxs-lookup"><span data-stu-id="95f6f-194">Compiled Activities</span></span>  

 <span data-ttu-id="95f6f-195">Les activités dynamiques sont un moyen de définir une activité qui contient des arguments à l’aide du code, mais les activités peuvent également être créées dans le code et être compilées en types.</span><span class="sxs-lookup"><span data-stu-id="95f6f-195">Dynamic activities are one way to define an activity that contains arguments using code, but activities can also be created in code and compiled into types.</span></span> <span data-ttu-id="95f6f-196">Il est possible de créer des activités simples qui dérivent de <xref:System.Activities.CodeActivity>, et des activités asynchrones qui dérivent de <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-196">Simple activities can be created that derive from <xref:System.Activities.CodeActivity>, and asynchronous activities that derive from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="95f6f-197">Ces activités peuvent avoir des arguments, des valeurs de retour, et définir leur logique en utilisant du code impératif.</span><span class="sxs-lookup"><span data-stu-id="95f6f-197">These activities can have arguments, return values, and define their logic using imperative code.</span></span> <span data-ttu-id="95f6f-198">Pour obtenir des exemples de création de ces types d’activités, consultez [classe de base CodeActivity](workflow-activity-authoring-using-the-codeactivity-class.md) et [création d’activités asynchrones](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="95f6f-198">For examples of creating these types of activities, see [CodeActivity Base Class](workflow-activity-authoring-using-the-codeactivity-class.md) and [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>  
  
 <span data-ttu-id="95f6f-199">Les activités qui dérivent de <xref:System.Activities.NativeActivity> peuvent définir leur logique à l'aide du code impératif et elles peuvent également contenir des activités enfants qui définissent la logique.</span><span class="sxs-lookup"><span data-stu-id="95f6f-199">Activities that derive from <xref:System.Activities.NativeActivity> can define their logic using imperative code and they can also contain child activities that define the logic.</span></span> <span data-ttu-id="95f6f-200">Ils ont également un accès complet aux fonctionnalités du runtime telles que la création de signets.</span><span class="sxs-lookup"><span data-stu-id="95f6f-200">They also have full access to the features of the runtime such as creating bookmarks.</span></span> <span data-ttu-id="95f6f-201">Pour obtenir des exemples de création d’une <xref:System.Activities.NativeActivity> activité basée sur, consultez [classe de base NativeActivity](nativeactivity-base-class.md), [Comment : créer une activité](how-to-create-an-activity.md)et l’exemple [composite personnalisé à l’aide d’une activité Native](./samples/custom-composite-using-native-activity.md) .</span><span class="sxs-lookup"><span data-stu-id="95f6f-201">For examples of creating a <xref:System.Activities.NativeActivity>-based activity, see [NativeActivity Base Class](nativeactivity-base-class.md), [How to: Create an Activity](how-to-create-an-activity.md), and the [Custom Composite using Native Activity](./samples/custom-composite-using-native-activity.md) sample.</span></span>  
  
 <span data-ttu-id="95f6f-202">Les activités qui dérivent de <xref:System.Activities.Activity> définissent leur logique uniquement via l'utilisation d'activités enfants.</span><span class="sxs-lookup"><span data-stu-id="95f6f-202">Activities that derive from <xref:System.Activities.Activity> define their logic solely through the use of child activities.</span></span> <span data-ttu-id="95f6f-203">Ces activités sont généralement créées à l'aide du concepteur de workflow Designer, mais peuvent également être définies à l'aide du code.</span><span class="sxs-lookup"><span data-stu-id="95f6f-203">These activities are typically created by using the workflow designer, but can also be defined by using code.</span></span> <span data-ttu-id="95f6f-204">Dans l'exemple suivant, une activité `Square` qui dérive d'`Activity<int>` est définie.</span><span class="sxs-lookup"><span data-stu-id="95f6f-204">In the following example, a `Square` activity is defined that derives from `Activity<int>`.</span></span> <span data-ttu-id="95f6f-205">L'activité `Square` a un seul <xref:System.Activities.InArgument%601> nommé `Value`, et définit sa logique en spécifiant une activité <xref:System.Activities.Statements.Sequence> à l'aide de la propriété <xref:System.Activities.Activity.Implementation%2A>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-205">The `Square` activity has a single <xref:System.Activities.InArgument%601> named `Value`, and defines its logic by specifying a <xref:System.Activities.Statements.Sequence> activity using the <xref:System.Activities.Activity.Implementation%2A> property.</span></span> <span data-ttu-id="95f6f-206">L'activité <xref:System.Activities.Statements.Sequence> contient une activité <xref:System.Activities.Statements.WriteLine> et une activité <xref:System.Activities.Statements.Assign%601>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-206">The <xref:System.Activities.Statements.Sequence> activity contains a <xref:System.Activities.Statements.WriteLine> activity and an <xref:System.Activities.Statements.Assign%601> activity.</span></span> <span data-ttu-id="95f6f-207">Ensemble, ces trois activités implémentent la logique de l'activité `Square`.</span><span class="sxs-lookup"><span data-stu-id="95f6f-207">Together, these three activities implement the logic of the `Square` activity.</span></span>  
  
```csharp  
class Square : Activity<int>  
{  
    [RequiredArgument]  
    public InArgument<int> Value { get; set; }  
  
    public Square()  
    {  
        this.Implementation = () => new Sequence  
        {  
            Activities =  
            {  
                new WriteLine  
                {  
                    Text = new InArgument<string>((env) => "Squaring the value: " + this.Value.Get(env))  
                },  
                new Assign<int>  
                {  
                    To = new OutArgument<int>((env) => this.Result.Get(env)),  
                    Value = new InArgument<int>((env) => this.Value.Get(env) * this.Value.Get(env))  
                }  
            }  
        };  
    }  
}  
```  
  
 <span data-ttu-id="95f6f-208">L'exemple suivant appelle une définition de workflow composée d'une activité `Square` unique à l'aide de <xref:System.Activities.WorkflowInvoker>.</span><span class="sxs-lookup"><span data-stu-id="95f6f-208">In the following example, a workflow definition consisting of a single `Square` activity is invoked using <xref:System.Activities.WorkflowInvoker>.</span></span>  
  
```csharp  
Dictionary<string, object> inputs = new Dictionary<string, object> {{ "Value", 5}};  
int result = WorkflowInvoker.Invoke(new Square(), inputs);  
Console.WriteLine("Result: {0}", result);  
```  
  
 <span data-ttu-id="95f6f-209">Lorsque le workflow est appelé, la sortie suivante s'affiche sur la console :</span><span class="sxs-lookup"><span data-stu-id="95f6f-209">When the workflow is invoked, the following output is displayed to the console:</span></span>  
  
 <span data-ttu-id="95f6f-210">**Mise au carré de la valeur : 5**</span><span class="sxs-lookup"><span data-stu-id="95f6f-210">**Squaring the value: 5**</span></span>  
<span data-ttu-id="95f6f-211">**Résultat : 25**</span><span class="sxs-lookup"><span data-stu-id="95f6f-211">**Result: 25**</span></span>

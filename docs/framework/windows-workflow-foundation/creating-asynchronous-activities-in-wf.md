---
title: Création d'activités asynchrones dans WF
description: Découvrez comment créer des activités asynchrones personnalisées à l’aide de AsyncCodeActivity, ce qui permet aux activités dérivées d’implémenter une logique d’exécution asynchrone.
ms.date: 03/30/2017
ms.assetid: 497e81ed-5eef-460c-ba55-fae73c05824f
ms.openlocfilehash: a03fbde1ff27084cc36dffc3a1912220d9bbca7e
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/26/2020
ms.locfileid: "96242082"
---
# <a name="creating-asynchronous-activities-in-wf"></a><span data-ttu-id="376a4-103">Création d'activités asynchrones dans WF</span><span class="sxs-lookup"><span data-stu-id="376a4-103">Creating Asynchronous Activities in WF</span></span>

<span data-ttu-id="376a4-104"><xref:System.Activities.AsyncCodeActivity> fournit aux auteurs d'activités une classe de base qui permet aux activités dérivées d'implémenter la logique d'exécution asynchrone.</span><span class="sxs-lookup"><span data-stu-id="376a4-104"><xref:System.Activities.AsyncCodeActivity> provides activity authors a base class to use that enables derived activities to implement asynchronous execution logic.</span></span> <span data-ttu-id="376a4-105">Les activités personnalisées peuvent ainsi effectuer un travail asynchrone sans maintenir le thread du service de planification de workflow. Elles peuvent également bloquer toute activité qui peut s'exécuter en parallèle.</span><span class="sxs-lookup"><span data-stu-id="376a4-105">This is useful for custom activities that must perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span> <span data-ttu-id="376a4-106">Cette rubrique fournit une vue d'ensemble de la méthode de création des activités asynchrones personnalisées à l'aide de l'objet <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="376a4-106">This topic provides an overview of how to create custom asynchronous activities using <xref:System.Activities.AsyncCodeActivity>.</span></span>  
  
## <a name="using-asynccodeactivity"></a><span data-ttu-id="376a4-107">Utilisation d'AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="376a4-107">Using AsyncCodeActivity</span></span>  

 <span data-ttu-id="376a4-108">L'objet <xref:System.Activities?displayProperty=nameWithType> fournit aux auteurs d'activités personnalisées différentes classes de base pour différentes spécifications de création d'activité.</span><span class="sxs-lookup"><span data-stu-id="376a4-108"><xref:System.Activities?displayProperty=nameWithType> provides custom activity authors with different base classes for different activity authoring requirements.</span></span> <span data-ttu-id="376a4-109">Chacune possède une sémantique particulière et fournit à un auteur de workflow (et au runtime d'activité) un contrat correspondant.</span><span class="sxs-lookup"><span data-stu-id="376a4-109">Each one carries a particular semantic and provides a workflow author (and the activity runtime) a corresponding contract.</span></span> <span data-ttu-id="376a4-110">Une activité basée sur l'objet <xref:System.Activities.AsyncCodeActivity> est une activité qui effectue le travail de façon asynchrone par rapport au thread du service de planification et dont la logique d'exécution est exprimée en code managé.</span><span class="sxs-lookup"><span data-stu-id="376a4-110">An <xref:System.Activities.AsyncCodeActivity> based activity is an activity that performs work asynchronously relative to the scheduler thread and whose execution logic is expressed in managed code.</span></span> <span data-ttu-id="376a4-111">Du fait qu'il devienne asynchrone, un objet <xref:System.Activities.AsyncCodeActivity> peut induire un point inactif lors de l'exécution.</span><span class="sxs-lookup"><span data-stu-id="376a4-111">As a result of going asynchronous, an <xref:System.Activities.AsyncCodeActivity> may induce an idle point during execution.</span></span> <span data-ttu-id="376a4-112">En raison de la nature volatile du travail asynchrone, un objet <xref:System.Activities.AsyncCodeActivity> crée toujours un bloc sans persistance pour la durée d'exécution de l'activité.</span><span class="sxs-lookup"><span data-stu-id="376a4-112">Due to the volatile nature of asynchronous work, an <xref:System.Activities.AsyncCodeActivity> always creates a no persist block for the duration of the activity’s execution.</span></span> <span data-ttu-id="376a4-113">Cela empêche le runtime du workflow de rendre persistante l'instance de workflow au milieu du travail asynchrone, et empêche également l'instance de workflow de se décharger lors de l'exécution du code asynchrone.</span><span class="sxs-lookup"><span data-stu-id="376a4-113">This prevents the workflow runtime from persisting the workflow instance in the middle of the asynchronous work, and also prevents the workflow instance from unloading while the asynchronous code is executing.</span></span>  
  
### <a name="asynccodeactivity-methods"></a><span data-ttu-id="376a4-114">Méthodes AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="376a4-114">AsyncCodeActivity Methods</span></span>  

 <span data-ttu-id="376a4-115">Les activités qui dérivent de l'objet <xref:System.Activities.AsyncCodeActivity> peuvent créer la logique d'exécution asynchrone en substituant le code personnalisé aux méthodes <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> et <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="376a4-115">Activities that derive from <xref:System.Activities.AsyncCodeActivity> can create asynchronous execution logic by overriding the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> methods with custom code.</span></span> <span data-ttu-id="376a4-116">Une fois appelées par le runtime, un <xref:System.Activities.AsyncCodeActivityContext> est passé à ces méthodes.</span><span class="sxs-lookup"><span data-stu-id="376a4-116">When called by the runtime, these methods are passed an <xref:System.Activities.AsyncCodeActivityContext>.</span></span> <span data-ttu-id="376a4-117"><xref:System.Activities.AsyncCodeActivityContext>permet à l’auteur de l’activité de fournir un état partagé <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> /  <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> dans la propriété du contexte <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> .</span><span class="sxs-lookup"><span data-stu-id="376a4-117"><xref:System.Activities.AsyncCodeActivityContext> allows the activity author to provide shared state across <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/ <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> in the context’s <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> property.</span></span> <span data-ttu-id="376a4-118">Dans l'exemple suivant, une activité `GenerateRandom` génère un nombre aléatoire de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="376a4-118">In the following example, a `GenerateRandom` activity generates a random number asynchronously.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#8](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#8)]  
  
 <span data-ttu-id="376a4-119">L'exemple d'activité précédent dérive d'<xref:System.Activities.AsyncCodeActivity%601>, et comprend un `OutArgument<int>` élevé nommé `Result`.</span><span class="sxs-lookup"><span data-stu-id="376a4-119">The previous example activity derives from <xref:System.Activities.AsyncCodeActivity%601>, and has an elevated `OutArgument<int>` named `Result`.</span></span> <span data-ttu-id="376a4-120">La valeur retournée par la méthode `GetRandom` est extraite et retournée par la substitution <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> et cette valeur est définie comme valeur `Result`.</span><span class="sxs-lookup"><span data-stu-id="376a4-120">The value returned by the `GetRandom` method is extracted and returned by the <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override, and this value is set as the `Result` value.</span></span> <span data-ttu-id="376a4-121">Les activités asynchrones qui ne retournent pas de résultat doivent dériver d'<xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="376a4-121">Asynchronous activities that do not return a result should derive from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="376a4-122">Dans l'exemple suivant, une activité `DisplayRandom` qui dérive d'<xref:System.Activities.AsyncCodeActivity> est définie.</span><span class="sxs-lookup"><span data-stu-id="376a4-122">In the following example, a `DisplayRandom` activity is defined which derives from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="376a4-123">Cette activité est semblable à l'activité `GetRandom`, mais au lieu de retourner un résultat, elle affiche un message sur la console.</span><span class="sxs-lookup"><span data-stu-id="376a4-123">This activity is like the `GetRandom` activity but instead of returning a result it displays a message to the console.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#11](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#11)]  
  
 <span data-ttu-id="376a4-124">Notez qu'étant donné qu'il n'y a pas de valeur de retour, `DisplayRandom` utilise un <xref:System.Action> au lieu d'un <xref:System.Func%602> pour appeler son délégué, et que le délégué ne retourne aucune valeur.</span><span class="sxs-lookup"><span data-stu-id="376a4-124">Note that because there is no return value, `DisplayRandom` uses an <xref:System.Action> instead of a <xref:System.Func%602> to invoke its delegate, and the delegate returns no value.</span></span>  
  
 <span data-ttu-id="376a4-125"><xref:System.Activities.AsyncCodeActivity> fournit également une substitution <xref:System.Activities.AsyncCodeActivity.Cancel%2A>.</span><span class="sxs-lookup"><span data-stu-id="376a4-125"><xref:System.Activities.AsyncCodeActivity> also provides a <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override.</span></span> <span data-ttu-id="376a4-126">Tandis que <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> et <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> sont des substitutions obligatoires, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> est facultative et peut être substituée de sorte que l'activité puisse nettoyer son état asynchrone en attente lors de son annulation ou de son abandon.</span><span class="sxs-lookup"><span data-stu-id="376a4-126">While <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> are required overrides, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> is optional, and can be overridden so the activity can clean up its outstanding asynchronous state when it is being canceled or aborted.</span></span> <span data-ttu-id="376a4-127">Si le nettoyage est possible et `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` est `true`, l'activité doit appeler la méthode <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>.</span><span class="sxs-lookup"><span data-stu-id="376a4-127">If clean up is possible and `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` is `true`, the activity should call <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>.</span></span> <span data-ttu-id="376a4-128">Toute exception levée à partir de cette méthode est critique pour l'instance de workflow.</span><span class="sxs-lookup"><span data-stu-id="376a4-128">Any exceptions thrown from this method are fatal to the workflow instance.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#10](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#10)]  
  
### <a name="invoking-asynchronous-methods-on-a-class"></a><span data-ttu-id="376a4-129">Appel de méthodes asynchrones sur une classe</span><span class="sxs-lookup"><span data-stu-id="376a4-129">Invoking Asynchronous Methods on a Class</span></span>  

 <span data-ttu-id="376a4-130">La plupart des classes de la .NET Framework fournissent des fonctionnalités asynchrones, et cette fonctionnalité peut être appelée de manière asynchrone à l’aide d’une <xref:System.Activities.AsyncCodeActivity> activité basée sur.</span><span class="sxs-lookup"><span data-stu-id="376a4-130">Many of the classes in the .NET Framework provide asynchronous functionality, and this functionality can be asynchronously invoked by using an <xref:System.Activities.AsyncCodeActivity> based activity.</span></span> <span data-ttu-id="376a4-131">Dans l’exemple suivant, une activité créée de façon asynchrone crée un fichier à l’aide de la <xref:System.IO.FileStream> classe.</span><span class="sxs-lookup"><span data-stu-id="376a4-131">In the following example, an activity is created that asynchronously creates a file by using the <xref:System.IO.FileStream> class.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#12](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#12)]  
  
### <a name="sharing-state-between-the-beginexecute-and-endexecute-methods"></a><span data-ttu-id="376a4-132">Partager l'état entre les méthodes BeginExecute et EndExecute</span><span class="sxs-lookup"><span data-stu-id="376a4-132">Sharing State Between the BeginExecute and EndExecute Methods</span></span>  

 <span data-ttu-id="376a4-133">Dans l'exemple précédent, l'objet <xref:System.IO.FileStream> créé dans <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> était accessible dans le <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="376a4-133">In the previous example, the <xref:System.IO.FileStream> object that was created in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> was accessed in the <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="376a4-134">Cela s'avère possible, car la variable `file` a été passée dans la propriété <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> dans <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="376a4-134">This is possible because the `file` variable was passed in the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> property in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="376a4-135">Il s'agit de la méthode correcte pour partager l'état entre <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> et <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="376a4-135">This is the correct method for sharing state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="376a4-136">Il est incorrect d'utiliser une variable membre dans la classe dérivée (`FileWriter` dans ce cas) pour partager l'état entre <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> et <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>, car l'objet activité peut être référencé par plusieurs instances d'activité.</span><span class="sxs-lookup"><span data-stu-id="376a4-136">It is incorrect to use a member variable in the derived class (`FileWriter` in this case) to share state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> because the activity object may be referenced by multiple activity instances.</span></span> <span data-ttu-id="376a4-137">Toute tentative d'utilisation d'une variable membre pour partager l'état peut générer des valeurs d'un <xref:System.Activities.ActivityInstance> qui remplacent ou consomment des valeurs d'un autre <xref:System.Activities.ActivityInstance>.</span><span class="sxs-lookup"><span data-stu-id="376a4-137">Attempting to use a member variable to share state can result in values from one <xref:System.Activities.ActivityInstance> overwriting or consuming values from another <xref:System.Activities.ActivityInstance>.</span></span>  
  
### <a name="accessing-argument-values"></a><span data-ttu-id="376a4-138">Accès aux valeurs des arguments</span><span class="sxs-lookup"><span data-stu-id="376a4-138">Accessing Argument Values</span></span>  

 <span data-ttu-id="376a4-139">L’environnement d’un objet <xref:System.Activities.AsyncCodeActivity> se compose d’arguments définis sur l’activité.</span><span class="sxs-lookup"><span data-stu-id="376a4-139">The environment of an <xref:System.Activities.AsyncCodeActivity> consists of the arguments defined on the activity.</span></span> <span data-ttu-id="376a4-140">Ces arguments sont accessibles à partir des <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> / <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> substitutions à l’aide du <xref:System.Activities.AsyncCodeActivityContext> paramètre.</span><span class="sxs-lookup"><span data-stu-id="376a4-140">These arguments can be accessed from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/<xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides using the <xref:System.Activities.AsyncCodeActivityContext> parameter.</span></span> <span data-ttu-id="376a4-141">Il est impossible d’accéder aux arguments dans le délégué, mais les valeurs d’argument ou toutes autres données peuvent être passées dans celui-ci à l’aide de ses paramètres.</span><span class="sxs-lookup"><span data-stu-id="376a4-141">The arguments cannot be accessed in the delegate, but the argument values or any other desired data can be passed in to the delegate using its parameters.</span></span> <span data-ttu-id="376a4-142">L'exemple suivant consiste à définir une activité générant un nombre aléatoire qui obtient la limite supérieure inclusive de son argument `Max`.</span><span class="sxs-lookup"><span data-stu-id="376a4-142">In the following example, a random number-generating activity is defined that obtains the inclusive upper bound from its `Max` argument.</span></span> <span data-ttu-id="376a4-143">La valeur de l’argument est passée dans le code asynchrone lors de l’appel du délégué.</span><span class="sxs-lookup"><span data-stu-id="376a4-143">The value of the argument is passed in to the asynchronous code when the delegate is invoked.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#9](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#9)]  
  
### <a name="scheduling-actions-or-child-activities-using-asynccodeactivity"></a><span data-ttu-id="376a4-144">Planifier des actions ou des activités enfants à l'aide d'AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="376a4-144">Scheduling Actions or Child Activities Using AsyncCodeActivity</span></span>  

 <span data-ttu-id="376a4-145">Les activités personnalisées dérivées <xref:System.Activities.AsyncCodeActivity> fournissent une méthode pour effectuer des tâches de façon asynchrone concernant le thread de workflow, mais ne permettent pas de planifier des activités enfants ou des actions.</span><span class="sxs-lookup"><span data-stu-id="376a4-145"><xref:System.Activities.AsyncCodeActivity> derived custom activities  provide a method for performing work asynchronously with regard to the workflow thread, but do not provide the ability to schedule child activities or actions.</span></span> <span data-ttu-id="376a4-146">Toutefois, le comportement asynchrone peut être incorporé à la planification des activités enfants via la composition.</span><span class="sxs-lookup"><span data-stu-id="376a4-146">However, asynchronous behavior can be incorporated with scheduling of child activities through composition.</span></span> <span data-ttu-id="376a4-147">Une activité asynchrone peut être créée, puis être composée d'une activité dérivée <xref:System.Activities.Activity> ou <xref:System.Activities.NativeActivity> pour fournir le comportement asynchrone et planifier des activités ou actions enfants.</span><span class="sxs-lookup"><span data-stu-id="376a4-147">An asynchronous activity can be created, and then composed with an <xref:System.Activities.Activity> or <xref:System.Activities.NativeActivity> derived activity to provide asynchronous behavior and scheduling of child activities or actions.</span></span> <span data-ttu-id="376a4-148">Par exemple, une activité peut être créée qui dérive de <xref:System.Activities.Activity>, et qui a comme implémentation un <xref:System.Activities.Statements.Sequence> contenant l'activité asynchrone, ainsi que les autres activités qui implémentent la logique de l'activité.</span><span class="sxs-lookup"><span data-stu-id="376a4-148">For example, an activity could be created that derives from <xref:System.Activities.Activity>, and has as its implementation a <xref:System.Activities.Statements.Sequence> containing the asynchronous activity as well the other activities that implement the logic of the activity.</span></span> <span data-ttu-id="376a4-149">Pour obtenir plus d’exemples de composition d’activités à l’aide de <xref:System.Activities.Activity> et de <xref:System.Activities.NativeActivity> , consultez [procédure : créer une activité](how-to-create-an-activity.md) et des [options de création d’activité](activity-authoring-options-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="376a4-149">For more examples of composing activities using <xref:System.Activities.Activity> and <xref:System.Activities.NativeActivity>, see [How to: Create an Activity](how-to-create-an-activity.md) and [Activity Authoring Options](activity-authoring-options-in-wf.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="376a4-150">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="376a4-150">See also</span></span>

- <xref:System.Action>
- <xref:System.Func%602>

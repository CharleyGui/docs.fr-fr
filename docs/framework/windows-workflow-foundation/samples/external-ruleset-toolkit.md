---
title: External RuleSet Toolkit
ms.date: 03/30/2017
ms.assetid: a306d283-a031-475e-aa01-9ae86e7adcb0
ms.openlocfilehash: b07d2b63d9f3d98b8f08eb697a8d688d8fac1962
ms.sourcegitcommit: 5fb5b6520b06d7f5e6131ec2ad854da302a28f2e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/03/2019
ms.locfileid: "74710896"
---
# <a name="external-ruleset-toolkit"></a><span data-ttu-id="19db6-102">External RuleSet Toolkit</span><span class="sxs-lookup"><span data-stu-id="19db6-102">External Ruleset Toolkit</span></span>

<span data-ttu-id="19db6-103">Généralement, lorsque des règles sont utilisées dans une application de workflow, elles font partie de l'assembly.</span><span class="sxs-lookup"><span data-stu-id="19db6-103">Normally when rules are used within a workflow application, the rules are part of the assembly.</span></span> <span data-ttu-id="19db6-104">Dans certains cas, il peut être préférable de gérer les RuleSets séparément de l'assembly afin qu'ils soient mis à jour sans que la génération et le déploiement de l'assembly de workflow ne soient nécessaires.</span><span class="sxs-lookup"><span data-stu-id="19db6-104">In some scenarios, you may want to maintain the RuleSets separately from the assembly so that they can be updated without rebuilding and deploying the workflow assembly.</span></span> <span data-ttu-id="19db6-105">Cet exemple vous permet de gérer et de modifier des RuleSets dans une base de données et d'accéder à ceux-ci à partir d'un workflow au moment de son exécution,</span><span class="sxs-lookup"><span data-stu-id="19db6-105">This sample allows you to manage and edit RuleSets in a database and access those RuleSets from a workflow at runtime.</span></span> <span data-ttu-id="19db6-106">opération qui permet aux instances de workflow en cours d'intégrer automatiquement des modifications de RuleSets.</span><span class="sxs-lookup"><span data-stu-id="19db6-106">This enables running workflow instances to automatically incorporate RuleSet changes.</span></span>

<span data-ttu-id="19db6-107">L'exemple External RuleSet Toolkit contient un utilitaire basé sur les Windows Forms pouvant être utilisé pour gérer et modifier les versions d'un RuleSet dans une base de données.</span><span class="sxs-lookup"><span data-stu-id="19db6-107">The External RuleSet Toolkit sample contains a Windows Forms-based tool that you can use to manage and edit RuleSet versions in a database.</span></span> <span data-ttu-id="19db6-108">Il inclut également une activité et un service hôte permettant d'exécuter ces règles.</span><span class="sxs-lookup"><span data-stu-id="19db6-108">It also includes an activity and a host service for executing those rules.</span></span>

> [!NOTE]
> <span data-ttu-id="19db6-109">Cet exemple requiert [Microsoft SQL Server](https://go.microsoft.com/fwlink/?LinkId=96181).</span><span class="sxs-lookup"><span data-stu-id="19db6-109">This sample requires [Microsoft SQL Server](https://go.microsoft.com/fwlink/?LinkId=96181).</span></span>

<span data-ttu-id="19db6-110">Visual Studio fournit un éditeur de groupe de règles dans le cadre de l’Windows Workflow Foundation (WF).</span><span class="sxs-lookup"><span data-stu-id="19db6-110">Visual Studio provides a RuleSet editor as part of the Windows Workflow Foundation (WF).</span></span> <span data-ttu-id="19db6-111">Vous pouvez démarrer cet éditeur en double-cliquant sur l'activité `Policy` dans un workflow ; cette opération sérialise l'objet RuleSet défini au fichier .rules associé au workflow (une activité `Policy` exécute une instance RuleSet sur le workflow).</span><span class="sxs-lookup"><span data-stu-id="19db6-111">You can start this editor by double-clicking the `Policy` activity in a workflow; it serializes the defined RuleSet object to the .rules file associated with the workflow (a `Policy` activity runs a RuleSet instance against the workflow).</span></span> <span data-ttu-id="19db6-112">Le fichier .rules est compilé dans l'assembly en tant que ressource lors de la génération du projet de workflow.</span><span class="sxs-lookup"><span data-stu-id="19db6-112">The .rules file is compiled into the assembly as a resource when you build the workflow project.</span></span>

<span data-ttu-id="19db6-113">Les composants de cet exemple incluent les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="19db6-113">The components of this sample include:</span></span>

- <span data-ttu-id="19db6-114">Un outil GUI RuleSet pouvant être utilisé pour modifier et gérer des versions de RuleSets dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="19db6-114">A RuleSet graphical user interface tool that you can use to edit and manage RuleSet versions in the database.</span></span>

- <span data-ttu-id="19db6-115">Un service de RuleSet configuré dans l'application hôte et accédant aux RuleSets de la base de données.</span><span class="sxs-lookup"><span data-stu-id="19db6-115">A RuleSet service that is configured on the host application and accesses RuleSets from the database.</span></span>

- <span data-ttu-id="19db6-116">Une activité `ExternalPolicy` nécessitant un RuleSet du service de RuleSet et exécutant ce RuleSet sur le workflow.</span><span class="sxs-lookup"><span data-stu-id="19db6-116">An `ExternalPolicy` activity that requests a RuleSet from the RuleSet service and runs the RuleSet against the workflow.</span></span>

<span data-ttu-id="19db6-117">L’interaction des composants est illustrée dans l’image suivante.</span><span class="sxs-lookup"><span data-stu-id="19db6-117">The interaction of the components is shown in the following image.</span></span> <span data-ttu-id="19db6-118">Les sections qui suivent décrivent chacun de ces composants.</span><span class="sxs-lookup"><span data-stu-id="19db6-118">The sections that follow describe each component.</span></span>

![Diagramme montrant la vue d’ensemble de l’exemple External RuleSet Toolkit.](./media/external-ruleset-toolkit/ruleset-toolkit-overview.gif)

> [!IMPORTANT]
> <span data-ttu-id="19db6-120">Les exemples peuvent déjà être installés sur votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="19db6-120">The samples may already be installed on your machine.</span></span> <span data-ttu-id="19db6-121">Recherchez le répertoire (par défaut) suivant avant de continuer.</span><span class="sxs-lookup"><span data-stu-id="19db6-121">Check for the following (default) directory before continuing.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples`
>
> <span data-ttu-id="19db6-122">Si ce répertoire n’existe pas, accédez à [Windows Communication Foundation (WCF) et Windows Workflow Foundation (WF) exemples pour .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) pour télécharger tous les exemples Windows Communication Foundation (WCF) et [!INCLUDE[wf1](../../../../includes/wf1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="19db6-122">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="19db6-123">Cet exemple se trouve dans le répertoire suivant.</span><span class="sxs-lookup"><span data-stu-id="19db6-123">This sample is located in the following directory.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\ExternalRuleSetToolKit`

## <a name="ruleset-tool"></a><span data-ttu-id="19db6-124">Outil RuleSet</span><span class="sxs-lookup"><span data-stu-id="19db6-124">RuleSet Tool</span></span>

<span data-ttu-id="19db6-125">L’image suivante est une capture d’écran de l’outil RuleSet.</span><span class="sxs-lookup"><span data-stu-id="19db6-125">The following image is a screenshot of the RuleSet tool.</span></span> <span data-ttu-id="19db6-126">Dans le menu **magasin de règles** , vous pouvez charger les ensembles de règles disponibles à partir de la base de données et enregistrer les ensembles de règles modifiés dans le magasin.</span><span class="sxs-lookup"><span data-stu-id="19db6-126">From the **Rule Store** menu, you can load the available RuleSets from the database and save modified RuleSets back to the store.</span></span> <span data-ttu-id="19db6-127">Un fichier de configuration d'application contient une chaîne de connexion pour la base de données RuleSet.</span><span class="sxs-lookup"><span data-stu-id="19db6-127">An application configuration file provides a database connection string for the RuleSet database.</span></span> <span data-ttu-id="19db6-128">Lorsque vous démarrez l'outil, ce dernier charge automatiquement les RuleSets à partir de la base de données configurée.</span><span class="sxs-lookup"><span data-stu-id="19db6-128">When you start the tool, it automatically loads the RuleSets from the configured database.</span></span>

![Capture d’écran montrant le navigateur de l’ensemble de règles.](./media/external-ruleset-toolkit/ruleset-browser-dialog.gif)

<span data-ttu-id="19db6-130">L’outil RuleSet applique aux RuleSets des numéros de version principaux et secondaires, vous permettant de gérer et de stocker simultanément plusieurs versions. Il ne dispose pas de fonctionnalités de verrouillage ou de contrôle de configuration en plus de ces fonctionnalités de versions.</span><span class="sxs-lookup"><span data-stu-id="19db6-130">The RuleSet tool applies major and minor version numbers to the RuleSets, allowing you to simultaneously maintain and store multiple versions (the tool provides no locking or other configuration management features in addition to the versioning capability).</span></span> <span data-ttu-id="19db6-131">Cet outil vous permet de créer des versions de RuleSets ou de supprimer des versions existantes.</span><span class="sxs-lookup"><span data-stu-id="19db6-131">Using the tool, you can create new RuleSet versions or delete existing versions.</span></span> <span data-ttu-id="19db6-132">Lorsque vous cliquez sur **nouveau**, l’outil crée un nouveau nom d’ensemble de règles et applique la version 1,0.</span><span class="sxs-lookup"><span data-stu-id="19db6-132">When you click **New**, the tool creates a new RuleSet name and applies version 1.0.</span></span> <span data-ttu-id="19db6-133">Lorsque vous copiez une version, l'outil crée une copie de la version de l'ensemble de règles sélectionné, y compris les règles qu'il contient, et assigne de nouveaux numéros de version uniques.</span><span class="sxs-lookup"><span data-stu-id="19db6-133">When you copy a version, the tool creates a copy of the selected RuleSet version, including the contained rules, and assigns new, unique version numbers.</span></span> <span data-ttu-id="19db6-134">Ces numéros sont basés sur ceux de RuleSets existants.</span><span class="sxs-lookup"><span data-stu-id="19db6-134">These version numbers are based on the version numbers of existing RuleSets.</span></span> <span data-ttu-id="19db6-135">Vous pouvez changer le nom d'un RuleSet et ses numéros de version en utilisant les champs associés sur le formulaire.</span><span class="sxs-lookup"><span data-stu-id="19db6-135">You can change the RuleSet name and version numbers using the associated fields on the form.</span></span>

<span data-ttu-id="19db6-136">Lorsque vous cliquez sur **modifier les règles**, l’éditeur de RuleSet démarre, comme illustré dans l’image suivante :</span><span class="sxs-lookup"><span data-stu-id="19db6-136">When you click **Edit Rules**, the RuleSet editor starts, as shown in the following image:</span></span>

![Capture d’écran montrant l’éditeur de RuleSet.](./media/external-ruleset-toolkit/ruleset-editor-dialog.gif)

<span data-ttu-id="19db6-138">Il s’agit d’un nouvel hébergement de la boîte de dialogue de l’éditeur qui fait partie du complément Windows Workflow Foundation Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="19db6-138">This is a re-hosting of the editor dialog that is part of the Windows Workflow Foundation Visual Studio add-in.</span></span> <span data-ttu-id="19db6-139">Elle contient les mêmes fonctionnalités, y compris la prise en charge Intellisense.</span><span class="sxs-lookup"><span data-stu-id="19db6-139">It provides the same functionality, including Intellisense support.</span></span> <span data-ttu-id="19db6-140">Les règles sont créées par rapport à un type de cible (tel qu’un flux de travail) associé au RuleSet dans l’outil. Lorsque vous cliquez sur **Parcourir** dans la boîte de dialogue principale de l’outil, la boîte de dialogue **Workflow/Type Selector** s’affiche, comme illustré à la figure 4.</span><span class="sxs-lookup"><span data-stu-id="19db6-140">The rules are authored against a target type (such as a workflow) that is associated with the RuleSet in the tool; when you click **Browse** in the main tool dialog, the **Workflow/Type Selector** dialog appears, as shown in Figure 4.</span></span>

<span data-ttu-id="19db6-141">![Sélection &#47;du type de workflow](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span><span class="sxs-lookup"><span data-stu-id="19db6-141">![Workflow &#47;Type Selection](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span></span>

<span data-ttu-id="19db6-142">Figure 4 : Workflow/Type Selector</span><span class="sxs-lookup"><span data-stu-id="19db6-142">Figure 4: Workflow/Type Selector</span></span>

<span data-ttu-id="19db6-143">Vous pouvez utiliser la boîte de dialogue **du sélecteur de flux de travail/type** pour spécifier un assembly et un type spécifique au sein de cet assembly.</span><span class="sxs-lookup"><span data-stu-id="19db6-143">You can use the **Workflow/Type Selector** dialog to specify an assembly and a specific type within that assembly.</span></span> <span data-ttu-id="19db6-144">Ce type correspond au type de cible pour lequel les règles sont créées (et exécutées).</span><span class="sxs-lookup"><span data-stu-id="19db6-144">This type is the target type against which the rules are authored (and run).</span></span> <span data-ttu-id="19db6-145">Dans de nombreux cas, le type de cible est un workflow ou un autre type d'activité.</span><span class="sxs-lookup"><span data-stu-id="19db6-145">In many cases, the target type is a workflow or some other activity type.</span></span> <span data-ttu-id="19db6-146">Toutefois, il est possible d'exécuter un RuleSet sur tout type .NET.</span><span class="sxs-lookup"><span data-stu-id="19db6-146">However, you can run a RuleSet against any .NET type.</span></span>

<span data-ttu-id="19db6-147">Le chemin d’accès au fichier d’assembly et le type `name are stored with the` ensemble de règles dans la base de données, de sorte que lorsque le RuleSet est récupéré de la base de données, l’outil tente de charger automatiquement le type cible.</span><span class="sxs-lookup"><span data-stu-id="19db6-147">The path to the assembly file and the type `name are stored with the` RuleSet in the database, so that when the RuleSet is retrieved from the database, the tool attempts to automatically load the target type.</span></span>

<span data-ttu-id="19db6-148">Lorsque vous cliquez sur **OK** dans la boîte de dialogue du **Sélecteur de flux de travail/type** , il valide le type sélectionné par rapport à l’ensemble de règles, afin de garantir que tous les membres sont référencés par les règles dans le type cible.</span><span class="sxs-lookup"><span data-stu-id="19db6-148">When you click **OK** in the **Workflow/Type Selector** dialog, it validates the selected type against the RuleSet, to ensure that the target type has all the members referenced by the rules.</span></span> <span data-ttu-id="19db6-149">Les erreurs sont affichées dans une boîte de dialogue **Erreurs de validation** .</span><span class="sxs-lookup"><span data-stu-id="19db6-149">Errors are shown in a **Validation Errors** dialog.</span></span> <span data-ttu-id="19db6-150">Vous pouvez choisir de poursuivre la modification en dépit des erreurs, ou de cliquer sur **Annuler**.</span><span class="sxs-lookup"><span data-stu-id="19db6-150">You can choose to continue with the change despite the errors, or click **Cancel**.</span></span> <span data-ttu-id="19db6-151">Dans le menu **Outils** de la boîte de dialogue principale de l’outil, vous pouvez cliquer sur **valider** pour revalider la version de l’ensemble de règles par rapport à l’activité cible.</span><span class="sxs-lookup"><span data-stu-id="19db6-151">From the **Tools** menu in the main tool dialog, you can click **Validate** to re-validate the RuleSet version against the target activity.</span></span>

![Capture d’écran montrant la boîte de dialogue Erreurs de validation.](./media/external-ruleset-toolkit/validation-errors-dialog.png)

<span data-ttu-id="19db6-153">Dans le menu **données** de l’outil, vous pouvez importer et exporter des ensembles de règles.</span><span class="sxs-lookup"><span data-stu-id="19db6-153">From the **Data** menu in the tool, you can import and export RuleSets.</span></span> <span data-ttu-id="19db6-154">Lorsque vous cliquez sur **Importer**, une boîte de dialogue de sélection de fichier s’affiche, à partir de laquelle vous pouvez sélectionner un fichier. Rules.</span><span class="sxs-lookup"><span data-stu-id="19db6-154">When you click **Import**, a file-chooser dialog appears, from which you can select a .rules file.</span></span> <span data-ttu-id="19db6-155">Il se peut qu’il soit ou non un fichier initialement créé dans Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="19db6-155">This may or may not be a file initially created in Visual Studio.</span></span> <span data-ttu-id="19db6-156">Le fichier .rules doit contenir une instance de `RuleDefinitions` sérialisée qui dispose d’une collection de conditions et d’une collection de RuleSets.</span><span class="sxs-lookup"><span data-stu-id="19db6-156">The .rules file should contain a serialized `RuleDefinitions` instance that contains a collection of conditions and a collection of RuleSets.</span></span> <span data-ttu-id="19db6-157">L’outil n’utilise pas la collection de conditions, mais il utilise le format `RuleDefinitions`. Rules pour permettre l’interaction avec l’environnement Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="19db6-157">The tool does not use the conditions collection, but it does use the `RuleDefinitions` .rules format to allow interaction with the Visual Studio environment.</span></span>

<span data-ttu-id="19db6-158">Une fois que vous avez sélectionné un fichier. Rules, une boîte de dialogue de **sélection de RuleSet** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="19db6-158">After selecting a .rules file, a **RuleSet Selector** dialog appears.</span></span> <span data-ttu-id="19db6-159">Celle-ci permet de sélectionner les ensembles de règles que vous souhaitez importer à partir du fichier (par défaut, tous les ensembles de règles sont sélectionnés).</span><span class="sxs-lookup"><span data-stu-id="19db6-159">You can use the dialog to select the RuleSets from the file that you want to import (the default specifies all RuleSets).</span></span> <span data-ttu-id="19db6-160">Les RuleSets d'un fichier .rules ne disposent pas de numéros de version, car leur version dans un projet WF est identique à celle de l'assembly.</span><span class="sxs-lookup"><span data-stu-id="19db6-160">RuleSets in the .rules file do not have version numbers, because their versioning within a WF project is the same as the version of the assembly.</span></span> <span data-ttu-id="19db6-161">Pendant le processus d’importation, l’outil attribue automatiquement le numéro de version principale disponible suivant (que vous pouvez modifier après l’importation). vous pouvez voir les numéros de version attribués dans la liste du **Sélecteur RuleSet** .</span><span class="sxs-lookup"><span data-stu-id="19db6-161">During the importing process, the tool automatically assigns the next available major version number (which you can change after importing); you can see the assigned version numbers in the **RuleSet Selector** list.</span></span>

<span data-ttu-id="19db6-162">Pour chaque RuleSet importé, l’outil tente de localiser le type associé dans le dossier bin\Debug qui se trouve sous l’emplacement du fichier .rules (s’il existe), en fonction des membres utilisés dans le RuleSet.</span><span class="sxs-lookup"><span data-stu-id="19db6-162">For each RuleSet it imports, the tool attempts to locate the associated type from the bin\Debug folder under the location of the .rules file (if it exists), based on the members used in the RuleSet.</span></span> <span data-ttu-id="19db6-163">Si l'outil détecte plusieurs types correspondants, il essaie d'en choisir un en fonction d'une correspondance entre le nom de fichier .rules et celui du type (par exemple, le type `Workflow1` correspond au fichier Workflow1.rules).</span><span class="sxs-lookup"><span data-stu-id="19db6-163">If the tool finds multiple matching types, it attempts to choose a type based on a match between the .rules file name and the type name (for example, the `Workflow1` type corresponds to Workflow1.rules).</span></span> <span data-ttu-id="19db6-164">Si plusieurs noms concordent, vous êtes invité à sélectionner le type.</span><span class="sxs-lookup"><span data-stu-id="19db6-164">If multiple matches exist, you are prompted to select the type.</span></span> <span data-ttu-id="19db6-165">Si ce mécanisme d’identification automatique ne parvient pas à localiser un assembly ou un type correspondant, après l’importation, vous pouvez cliquer sur **Parcourir** dans la boîte de dialogue principale de l’outil pour accéder au type associé.</span><span class="sxs-lookup"><span data-stu-id="19db6-165">If this auto-identification mechanism fails to locate a matching assembly or type, then after importing you can click **Browse** on the main tool dialog to navigate to the associated type.</span></span> <span data-ttu-id="19db6-166">L’illustration suivante montre le sélecteur de RuleSet :</span><span class="sxs-lookup"><span data-stu-id="19db6-166">The following image shows the RuleSet Selector:</span></span>

![Capture d’écran montrant la boîte de dialogue du sélecteur de RuleSet.](./media/external-ruleset-toolkit/ruleset-selector-dialog.gif)

<span data-ttu-id="19db6-168">Lorsque vous cliquez sur **Data-Export** dans le menu principal de l’outil, la boîte de dialogue **RuleSet Selector** s’affiche à nouveau, à partir de laquelle vous pouvez déterminer les ensembles de règles de la base de données qui doit être exportée.</span><span class="sxs-lookup"><span data-stu-id="19db6-168">When you click **Data-Export** from the main tool menu, the **RuleSet Selector** dialog appears again, from which you can determine the RuleSets from the database that should be exported.</span></span> <span data-ttu-id="19db6-169">Lorsque vous cliquez sur **OK**, une boîte de dialogue **enregistrer le fichier** s’affiche, dans laquelle vous pouvez spécifier le nom et l’emplacement du fichier. Rules résultant.</span><span class="sxs-lookup"><span data-stu-id="19db6-169">When you click **OK**, a **Save File** dialog appears, in which you can specify the name and location of the resulting .rules file.</span></span> <span data-ttu-id="19db6-170">Le fichier .rules ne contenant aucune information sur la version, vous pouvez sélectionner une seule version de RuleSet répondant à un nom donné.</span><span class="sxs-lookup"><span data-stu-id="19db6-170">Because the .rules file does not contain version information, you can only select one RuleSet version with a given RuleSet name.</span></span>

## <a name="policyfromservice-activity"></a><span data-ttu-id="19db6-171">Activité PolicyFromService</span><span class="sxs-lookup"><span data-stu-id="19db6-171">PolicyFromService Activity</span></span>

<span data-ttu-id="19db6-172">Le code correspondant à l'activité `PolicyFromService` est très simple.</span><span class="sxs-lookup"><span data-stu-id="19db6-172">The code for the `PolicyFromService` activity is straightforward.</span></span> <span data-ttu-id="19db6-173">Il fonctionne exactement comme l'activité `Policy` fournie avec WF, mais au lieu de récupérer le RuleSet cible dans le fichier .rules, il appelle un service hôte pour obtenir l'instance de ce RuleSet.</span><span class="sxs-lookup"><span data-stu-id="19db6-173">It works much like the `Policy` activity provided with WF, but instead of retrieving the target RuleSet from the .rules file, it calls a host service to obtain the RuleSet instance.</span></span> <span data-ttu-id="19db6-174">Il exécute ensuite le RuleSet sur l'instance de l'activité du workflow racine.</span><span class="sxs-lookup"><span data-stu-id="19db6-174">It then runs the RuleSet against the root workflow activity instance.</span></span>

<span data-ttu-id="19db6-175">Pour utiliser l'activité dans un workflow, ajoutez une référence aux assemblys `PolicyActivities` et `RuleSetService` de votre projet de workflow.</span><span class="sxs-lookup"><span data-stu-id="19db6-175">To use the activity in a workflow, add a reference to the `PolicyActivities` and `RuleSetService` assemblies from your workflow project.</span></span> <span data-ttu-id="19db6-176">Consultez la procédure située à la fin de cette rubrique pour savoir comment ajouter une activité à la boîte à outils.</span><span class="sxs-lookup"><span data-stu-id="19db6-176">See the procedure at the end of this topic for a discussion of how to add the activity to the toolbox.</span></span>

<span data-ttu-id="19db6-177">Après avoir ajouté l'activité à votre workflow, vous devez indiquer le nom du RuleSet à exécuter.</span><span class="sxs-lookup"><span data-stu-id="19db6-177">After placing the activity in your workflow, you must provide the name of the RuleSet to be run.</span></span> <span data-ttu-id="19db6-178">Vous pouvez indiquer ce nom en tant que valeur littérale ou le lier à la variable ou à la propriété de workflow d'une autre activité.</span><span class="sxs-lookup"><span data-stu-id="19db6-178">You can enter the name as a literal value, or bind to a workflow variable or property of another activity.</span></span> <span data-ttu-id="19db6-179">Vous pouvez également indiquer des numéros de version pour le RuleSet à exécuter (facultatif).</span><span class="sxs-lookup"><span data-stu-id="19db6-179">Optionally, you can enter version numbers for the specific RuleSet that should be run.</span></span> <span data-ttu-id="19db6-180">Si vous laissez la valeur par défaut (0) comme numéro de version principal ou secondaire, le numéro de version le plus récent figurant dans la base de données sera automatiquement assigné à l'activité.</span><span class="sxs-lookup"><span data-stu-id="19db6-180">If you leave the default value of 0 for the major and minor version numbers, the latest version number in the database is automatically provided for the activity.</span></span>

## <a name="ruleset-service"></a><span data-ttu-id="19db6-181">Service de RuleSet</span><span class="sxs-lookup"><span data-stu-id="19db6-181">RuleSet Service</span></span>

<span data-ttu-id="19db6-182">Ce service est chargé de récupérer dans la base de données la version indiquée du RuleSet et de la renvoyer à l'activité appelante.</span><span class="sxs-lookup"><span data-stu-id="19db6-182">The service is responsible for retrieving the specified RuleSet version from the database and returning it to the calling activity.</span></span> <span data-ttu-id="19db6-183">Comme indiqué précédemment, si la valeur des versions principales et secondaires passées dans l'appel `GetRuleSet` est de 0, le service récupère la version la plus récente.</span><span class="sxs-lookup"><span data-stu-id="19db6-183">As previously discussed, if the major and minor version values passed in the `GetRuleSet` call are both 0, the service retrieves the latest version.</span></span> <span data-ttu-id="19db6-184">À ce stade, aucune mise en cache des définitions ou des instances de RuleSets n’est effectuée ; de la même façon, aucune fonctionnalité visant à marquer certaines versions de RuleSets comme étant « déployées » (afin de les différencier des RuleSets en cours) n’est appliquée.</span><span class="sxs-lookup"><span data-stu-id="19db6-184">At this point, there is no caching of RuleSet definitions or instances; similarly, there are no features for marking RuleSet versions as "deployed" to differentiate them from in-progress RuleSets.</span></span>

<span data-ttu-id="19db6-185">La base de données devant être consultée par le service doit être configurée sur l'hôte à l'aide d'un fichier de configuration d'application.</span><span class="sxs-lookup"><span data-stu-id="19db6-185">The database to be accessed by the service should be configured on the host using an application configuration file.</span></span>

#### <a name="to-run-the-tool"></a><span data-ttu-id="19db6-186">Pour exécuter l'outil</span><span class="sxs-lookup"><span data-stu-id="19db6-186">To run the tool</span></span>

1. <span data-ttu-id="19db6-187">Le dossier de configuration de la table RuleSet utilisée par l’outil et par le service contient un fichier Setup.sql.</span><span class="sxs-lookup"><span data-stu-id="19db6-187">The folder that sets up the RuleSet table used by the tool and the service contains a Setup.sql file.</span></span> <span data-ttu-id="19db6-188">Vous pouvez exécuter le fichier de commandes Setup.cmd pour créer la base de données Rules dans SQL Express et configurer la table RuleSet.</span><span class="sxs-lookup"><span data-stu-id="19db6-188">You can run the Setup.cmd batch file to create the Rules database on SQL Express and to set up the RuleSet table.</span></span>

2. <span data-ttu-id="19db6-189">Si vous modifiez le fichier de commandes ou Setup.sql et indiquez de ne pas utiliser SQL Express ou d'ajouter la table dans une base de données autre que `Rules`, les fichiers de configuration d'application de l'outil RuleSet et les projets `UsageSample` doivent être modifiés pour contenir les mêmes informations.</span><span class="sxs-lookup"><span data-stu-id="19db6-189">If you edit the batch file or Setup.sql and specify not to use SQL Express or to place the table in a database named something other than `Rules`, the application configuration files in the RuleSet tool and `UsageSample` projects should be edited with the same information.</span></span>

3. <span data-ttu-id="19db6-190">Après avoir exécuté le script Setup.sql, vous pouvez générer la solution `ExternalRuleSetToolkit` puis exécuter l'outil RuleSet à partir du projet ExternalRuleSetTool.</span><span class="sxs-lookup"><span data-stu-id="19db6-190">After you run the Setup.sql script, you can build the `ExternalRuleSetToolkit` solution and then launch the RuleSet tool from the ExternalRuleSetTool project.</span></span>

4. <span data-ttu-id="19db6-191">La solution `RuleSetToolkitUsageSample` Sequential Workflow Console Application contient un exemple de workflow.</span><span class="sxs-lookup"><span data-stu-id="19db6-191">The `RuleSetToolkitUsageSample` Sequential Workflow Console Application solution includes a sample workflow.</span></span> <span data-ttu-id="19db6-192">Ce dernier se compose d'une activité `PolicyFromService` et de deux variables (`orderValue` et `discount`) sur lesquelles le RuleSet cible s'exécute.</span><span class="sxs-lookup"><span data-stu-id="19db6-192">The workflow consists of a `PolicyFromService` activity and two variables, `orderValue` and `discount`, against which the target RuleSet runs.</span></span>

5. <span data-ttu-id="19db6-193">Pour utiliser cet exemple, générez la solution `RuleSetToolkitUsageSample`.</span><span class="sxs-lookup"><span data-stu-id="19db6-193">To use the sample, build the `RuleSetToolkitUsageSample` solution.</span></span> <span data-ttu-id="19db6-194">Ensuite, dans le menu principal de l’outil RuleSet, cliquez sur **Data-Import** et pointez sur le fichier DiscountRuleSet. Rules dans le dossier RuleSetToolkitUsageSample.</span><span class="sxs-lookup"><span data-stu-id="19db6-194">Then from the RuleSet tool main menu, click **Data-Import** and point to the DiscountRuleSet.rules file in the RuleSetToolkitUsageSample folder.</span></span> <span data-ttu-id="19db6-195">Cliquez sur l’option de menu **enregistrer le magasin de règles** pour enregistrer l’ensemble de règles importé dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="19db6-195">Click the **Rule Store-Save** menu option to save the imported RuleSet to the database.</span></span>

6. <span data-ttu-id="19db6-196">L'assembly `PolicyActivities` étant référencé à partir du projet de workflow exemple, l'activité `PolicyFromService` apparaît dans le workflow.</span><span class="sxs-lookup"><span data-stu-id="19db6-196">Because the `PolicyActivities` assembly is referenced from the sample workflow project, the `PolicyFromService` activity appears in the workflow.</span></span> <span data-ttu-id="19db6-197">Toutefois, elle ne s'affiche pas par défaut dans la boîte à outils.</span><span class="sxs-lookup"><span data-stu-id="19db6-197">It does not, however, appear in the toolbox by default.</span></span> <span data-ttu-id="19db6-198">Pour l'ajouter à la boîte à outils, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="19db6-198">To add it to the toolbox, do the following:</span></span>

    - <span data-ttu-id="19db6-199">Cliquez avec le bouton droit sur la boîte à outils et sélectionnez **choisir les éléments** (cette opération peut prendre un certain temps).</span><span class="sxs-lookup"><span data-stu-id="19db6-199">Right-click the toolbox and select **Choose Items** (this may take a while).</span></span>

    - <span data-ttu-id="19db6-200">Quand la boîte de dialogue **choisir des éléments de boîte à outils** s’affiche, cliquez sur l’onglet **activités** .</span><span class="sxs-lookup"><span data-stu-id="19db6-200">When the **Choose Toolbox Items** dialog appears, click the **Activities** tab.</span></span>

    - <span data-ttu-id="19db6-201">Accédez à l’assembly `PolicyActivities` dans la solution `ExternalRuleSetToolkit`, puis cliquez sur **ouvrir**.</span><span class="sxs-lookup"><span data-stu-id="19db6-201">Browse to the `PolicyActivities` assembly in the `ExternalRuleSetToolkit` solution and click **Open**.</span></span>

    - <span data-ttu-id="19db6-202">Assurez-vous que l’activité `PolicyFromService` est sélectionnée dans la boîte de dialogue **choisir des éléments de boîte à outils** , puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="19db6-202">Ensure that the `PolicyFromService` activity is selected in the **Choose Toolbox Items** dialog and then click **OK**.</span></span>

    - <span data-ttu-id="19db6-203">L’activité doit maintenant apparaître dans la boîte à outils de la catégorie **composants RuleSetToolkitUsageSample** .</span><span class="sxs-lookup"><span data-stu-id="19db6-203">The activity should now appear in the toolbox in the **RuleSetToolkitUsageSample Components** category.</span></span>

7. <span data-ttu-id="19db6-204">Le service de RuleSet est déjà configuré dans l'application console hôte via l'instruction suivante dans Program.cs.</span><span class="sxs-lookup"><span data-stu-id="19db6-204">The RuleSet service is already configured on the console application host using the following statement in Program.cs.</span></span>

    ```csharp
    workflowRuntime.AddService(new RuleSetService());
    ```

8. <span data-ttu-id="19db6-205">Vous pouvez également configurer le service sur l'hôte en utilisant un fichier de configuration ; consultez la documentation du kit de développement logiciel (SDK) pour plus de détails.</span><span class="sxs-lookup"><span data-stu-id="19db6-205">You can also configure the service on the host using a configuration file; see the SDK documentation for details.</span></span>

9. <span data-ttu-id="19db6-206">Un fichier de configuration d'application est ajouté au projet de workflow afin d'indiquer la chaîne de connexion correspondant à la base de données devant être utilisée par le service.</span><span class="sxs-lookup"><span data-stu-id="19db6-206">An application configuration file is added to the workflow project to specify the connection string for the database to be used by the service.</span></span> <span data-ttu-id="19db6-207">Cette chaîne doit être la même que celle utilisée par l'outil RuleSet, laquelle cible la base de données contenant la table RuleSet.</span><span class="sxs-lookup"><span data-stu-id="19db6-207">This should be the same connection string used by the RuleSet tool, which points to the database that contains the RuleSet table.</span></span>

10. <span data-ttu-id="19db6-208">Vous pouvez désormais exécuter le projet `RuleSetToolkitUsageSample` comme s'il s'agissait de toute autre application console de workflow.</span><span class="sxs-lookup"><span data-stu-id="19db6-208">You can now run the `RuleSetToolkitUsageSample` project as you would any other workflow console application.</span></span> <span data-ttu-id="19db6-209">Appuyez sur F5 ou sur CTRL + F5 dans Visual Studio ou exécutez le fichier RuleSetToolkitUsageSample. exe directement.</span><span class="sxs-lookup"><span data-stu-id="19db6-209">Press F5 or Ctrl+F5 within Visual Studio or run the RuleSetToolkitUsageSample.exe file directly.</span></span>

    > [!NOTE]
    > <span data-ttu-id="19db6-210">Vous devez fermer l'outil RuleSet pour recompiler l'exemple d'utilisation, car l'outil charge l'assembly correspondant à cet exemple.</span><span class="sxs-lookup"><span data-stu-id="19db6-210">You must close the RuleSet tool to recompile the usage sample, because the tool loads the usage sample assembly.</span></span>

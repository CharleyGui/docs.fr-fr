---
title: Performances de Windows Workflow Foundation 4
description: Cet article explique les caractéristiques de performances de la révision majeure de Windows Workflow Foundation, qui fait partie de .NET Framework 4.
ms.date: 03/30/2017
ms.assetid: 67d2b3e8-3777-49f8-9084-abbb33b5a766
ms.openlocfilehash: 9b1b9e7c4fd7cdd122d425b2746859dde30ec209
ms.sourcegitcommit: 9a4488a3625866335e83a20da5e9c5286b1f034c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/15/2020
ms.locfileid: "83421564"
---
# <a name="windows-workflow-foundation-4-performance"></a><span data-ttu-id="e779b-103">Performances de Windows Workflow Foundation 4</span><span class="sxs-lookup"><span data-stu-id="e779b-103">Windows Workflow Foundation 4 Performance</span></span>

 <span data-ttu-id="e779b-104">.NET Framework 4 comprend une révision majeure du Windows Workflow Foundation (WF), avec des investissements importants en matière de performances.</span><span class="sxs-lookup"><span data-stu-id="e779b-104">.NET Framework 4 includes a major revision of the Windows Workflow Foundation (WF) with heavy investments in performance.</span></span> <span data-ttu-id="e779b-105">Cette nouvelle révision introduit des modifications de conception significatives à partir des versions précédentes de [!INCLUDE[wf1](../../../includes/wf1-md.md)] fournies dans le cadre de .NET Framework 3,0 et .NET Framework 3,5.</span><span class="sxs-lookup"><span data-stu-id="e779b-105">This new revision introduces significant design changes from the previous versions of [!INCLUDE[wf1](../../../includes/wf1-md.md)] that shipped as part of .NET Framework 3.0 and .NET Framework 3.5.</span></span> <span data-ttu-id="e779b-106">Elle a été remodelée à partir du modèle de programmation, du runtime et des outils de base afin d'améliorer considérablement ses performances et sa facilité d'utilisation.</span><span class="sxs-lookup"><span data-stu-id="e779b-106">It has been re-architected from the core of the programming model, runtime, and tooling to greatly improve performance and usability.</span></span> <span data-ttu-id="e779b-107">Cette rubrique décrit les caractéristiques de performances importantes de ces révisions et les compare avec celles de la version précédente.</span><span class="sxs-lookup"><span data-stu-id="e779b-107">This topic shows the important performance characteristics of these revisions and compares them against those of the previous version.</span></span>

 <span data-ttu-id="e779b-108">Les performances des composants de workflow individuels ont augmenté considérablement entre WF3 et WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-108">Individual workflow component performance has increased by orders of magnitude between WF3 and WF4.</span></span>  <span data-ttu-id="e779b-109">Cela laisse le fossé entre les services de Windows Communication Foundation codés manuellement (WCF) et les services de workflow WCF pour être assez petits.</span><span class="sxs-lookup"><span data-stu-id="e779b-109">This leaves the gap between hand-coded Windows Communication Foundation (WCF) services and WCF workflow services to be quite small.</span></span>  <span data-ttu-id="e779b-110">La latence du workflow a été considérablement réduite dans WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-110">Workflow latency has been significantly reduced in WF4.</span></span>  <span data-ttu-id="e779b-111">Les performances de la persistance ont augmenté d'un facteur de 2,5 à 3.</span><span class="sxs-lookup"><span data-stu-id="e779b-111">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="e779b-112">Le contrôle d'état au moyen du suivi de workflow nécessite une charge mémoire bien moindre.</span><span class="sxs-lookup"><span data-stu-id="e779b-112">Health monitoring by means of workflow tracking has significantly less overhead.</span></span>  <span data-ttu-id="e779b-113">Ces raisons incontestables justifient la migration vers WF4 ou son adoption dans vos applications.</span><span class="sxs-lookup"><span data-stu-id="e779b-113">These are compelling reasons to migrate to or adopt WF4 in your applications.</span></span>

## <a name="terminology"></a><span data-ttu-id="e779b-114">Terminologie</span><span class="sxs-lookup"><span data-stu-id="e779b-114">Terminology</span></span>

 <span data-ttu-id="e779b-115">La version de [!INCLUDE[wf1](../../../includes/wf1-md.md)] introduite dans .NET Framework 4 sera appelée WF4 dans le reste de cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="e779b-115">The version of [!INCLUDE[wf1](../../../includes/wf1-md.md)] introduced in .NET Framework 4 will be referred to as WF4 for the rest of this topic.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)]<span data-ttu-id="e779b-116">a été introduite dans .NET Framework 3,0 et a subi quelques révisions mineures via .NET Framework 3,5 SP1.</span><span class="sxs-lookup"><span data-stu-id="e779b-116">was introduced in .NET Framework 3.0 and had a few minor revisions through .NET Framework 3.5 SP1.</span></span> <span data-ttu-id="e779b-117">La .NET Framework version 3,5 de Workflow Foundation sera appelée WF3 pour le reste de cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="e779b-117">The .NET Framework 3.5 version of Workflow Foundation will be referred to as WF3 for the rest of this topic.</span></span> <span data-ttu-id="e779b-118">WF3 est fourni dans .NET Framework 4 côte à côte avec WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-118">WF3 is shipped in .NET Framework 4 side-by-side with WF4.</span></span> <span data-ttu-id="e779b-119">Pour plus d’informations sur la migration des artefacts WF3 vers WF4, consultez : [Windows Workflow Foundation 4 Guide de migration](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="e779b-119">For more information about migrating WF3 artifacts to WF4 see: [Windows Workflow Foundation 4 Migration Guide](migration-guidance.md).</span></span>

 <span data-ttu-id="e779b-120">Windows Communication Foundation (WCF) est le modèle de programmation unifié de Microsoft pour la création d’applications orientées service.</span><span class="sxs-lookup"><span data-stu-id="e779b-120">Windows Communication Foundation (WCF) is Microsoft’s unified programming model for building service-oriented applications.</span></span> <span data-ttu-id="e779b-121">Il a été introduit pour la première fois dans le cadre de .NET 3,0 avec WF3 et est maintenant l’un des principaux composants de l' .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="e779b-121">It was first introduced as part of .NET 3.0 together with WF3 and now is one of the key components of the .NET Framework.</span></span>

 <span data-ttu-id="e779b-122">Windows Server AppFabric est un jeu de technologies intégrées permettant de générer, mettre à l'échelle et gérer facilement des applications Web et composites qui s'exécutent sur les Services Internet (IIS).</span><span class="sxs-lookup"><span data-stu-id="e779b-122">Windows Server AppFabric is a set of integrated technologies that make it easier to build, scale and manage Web and composite applications that run on IIS.</span></span> <span data-ttu-id="e779b-123">Il fournit des outils pour déployer, surveiller et gérer les services et les workflows.</span><span class="sxs-lookup"><span data-stu-id="e779b-123">It provides tools for monitoring and managing services and workflows.</span></span> <span data-ttu-id="e779b-124">Pour plus d’informations, consultez [Windows Server AppFabric 1,0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span><span class="sxs-lookup"><span data-stu-id="e779b-124">For more information, see [Windows Server AppFabric 1.0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span></span>

## <a name="goals"></a><span data-ttu-id="e779b-125">Objectifs</span><span class="sxs-lookup"><span data-stu-id="e779b-125">Goals</span></span>
 <span data-ttu-id="e779b-126">Cette rubrique a pour objectif d'illustrer les caractéristiques de performances de WF4 à l'aide des données mesurées pour différents scénarios.</span><span class="sxs-lookup"><span data-stu-id="e779b-126">The goal of this topic is to show the performance characteristics of WF4 with data measured for different scenarios.</span></span> <span data-ttu-id="e779b-127">Elle présente également une comparaison détaillée entre WF4 et WF3, qui permet d'illustrer les grandes améliorations apportées à cette nouvelle révision.</span><span class="sxs-lookup"><span data-stu-id="e779b-127">It also provides detailed comparisons between WF4 and WF3, and thus shows the great improvements that have been made in this new revision.</span></span> <span data-ttu-id="e779b-128">Les scénarios et données présentés dans cet article permettent de quantifier le coût sous-jacent de différents aspects de WF4 et WF3.</span><span class="sxs-lookup"><span data-stu-id="e779b-128">The scenarios and data presented in this article quantify the underlying cost of different aspects of WF4 and WF3.</span></span> <span data-ttu-id="e779b-129">Ces données permettent de comprendre les caractéristiques de performances générales de WF4 et peuvent s'avérer utiles pour planifier les migrations de WF3 vers WF4 ou utiliser WF4 pour le développement d'applications.</span><span class="sxs-lookup"><span data-stu-id="e779b-129">This data is useful in understanding the performance characteristics of WF4 and can be helpful in planning migrations from WF3 to WF4 or using WF4 in application development.</span></span> <span data-ttu-id="e779b-130">Toutefois, nous vous recommandons de faire preuve de prudence lorsque vous tirez des conclusions des données présentées dans cet article.</span><span class="sxs-lookup"><span data-stu-id="e779b-130">However, care should be taken in the conclusions drawn from the data presented in this article.</span></span> <span data-ttu-id="e779b-131">Les performances d'une application de workflow composite dépendent beaucoup de la façon dont le workflow est implémenté et de la manière dont les différents composants sont intégrés.</span><span class="sxs-lookup"><span data-stu-id="e779b-131">The performance of a composite workflow application is highly dependent on how the workflow is implemented and how different components are integrated.</span></span> <span data-ttu-id="e779b-132">Il est nécessaire d'évaluer chaque application afin de déterminer ses caractéristiques de performances.</span><span class="sxs-lookup"><span data-stu-id="e779b-132">One must measure each application to determine the performance characteristics of that application.</span></span>

## <a name="overview-of-wf4-performance-enhancements"></a><span data-ttu-id="e779b-133">Vue d'ensemble des amélioration de performances de WF4</span><span class="sxs-lookup"><span data-stu-id="e779b-133">Overview of WF4 Performance Enhancements</span></span>
 <span data-ttu-id="e779b-134">WF4 a été conçu et implémenté avec soin et ses performances et son évolutivité optimales sont décrites dans les sections suivantes.</span><span class="sxs-lookup"><span data-stu-id="e779b-134">WF4 was carefully designed and implemented with high performance and scalability which are described in the following sections.</span></span>

### <a name="wf-runtime"></a><span data-ttu-id="e779b-135">Runtime WF</span><span class="sxs-lookup"><span data-stu-id="e779b-135">WF Runtime</span></span>
 <span data-ttu-id="e779b-136">À la base du runtime [!INCLUDE[wf1](../../../includes/wf1-md.md)] se trouve un planificateur asynchrone qui gère l'exécution des activités dans un workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-136">At the core of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime is an asynchronous scheduler that drives the execution of the activities in a workflow.</span></span> <span data-ttu-id="e779b-137">Il fournit un environnement d'exécution performant et prévisible pour les activités.</span><span class="sxs-lookup"><span data-stu-id="e779b-137">It provides a performant, predictable execution environment for activities.</span></span> <span data-ttu-id="e779b-138">L'environnement dispose d'un contrat bien défini pour l'exécution, la continuation, l'achèvement, l'annulation et les exceptions, ainsi que d'un modèle de thread prévisible.</span><span class="sxs-lookup"><span data-stu-id="e779b-138">The environment has a well-defined contract for execution, continuation, completion, cancellation, exceptions, and a predictable threading model.</span></span>

 <span data-ttu-id="e779b-139">Par rapport à WF3, le runtime WF4 est doté d'un planificateur plus efficace.</span><span class="sxs-lookup"><span data-stu-id="e779b-139">In comparison to WF3, the WF4 runtime has a more efficient scheduler.</span></span> <span data-ttu-id="e779b-140">Elle tire parti du même pool de threads d’e/s que celui utilisé pour WCF, ce qui est très efficace lors de l’exécution d’éléments de travail par lot.</span><span class="sxs-lookup"><span data-stu-id="e779b-140">It leverages the same I/O thread pool that is used for WCF, which is very efficient at executing batched work items.</span></span> <span data-ttu-id="e779b-141">La file d’attente interne du planificateur d’éléments de travail est optimisée pour les modèles d’utilisation les plus courants.</span><span class="sxs-lookup"><span data-stu-id="e779b-141">The internal work item scheduler queue is optimized for most common usage patterns.</span></span> <span data-ttu-id="e779b-142">Le runtime WF4 gère également les États d’exécution de façon très légère avec une synchronisation et une logique de gestion des événements minimes, tandis que WF3 dépend de l’inscription et de l’appel des événements lourds pour effectuer une synchronisation complexe des transitions d’État.</span><span class="sxs-lookup"><span data-stu-id="e779b-142">The WF4 runtime also manages the execution states in a very lightweight way with minimal synchronization and event handling logic, while WF3 depends on heavy-weight event registration and invocation to perform complex synchronization for state transitions.</span></span>

### <a name="data-storage-and-flow"></a><span data-ttu-id="e779b-143">Stockage et flux de données</span><span class="sxs-lookup"><span data-stu-id="e779b-143">Data Storage and Flow</span></span>
 <span data-ttu-id="e779b-144">Dans WF3, les données associées à une activité sont modélisées à l'aide des propriétés de dépendance implémentées par le type <xref:System.Windows.DependencyProperty>.</span><span class="sxs-lookup"><span data-stu-id="e779b-144">In WF3, data associated with an activity is modeled through dependency properties implemented by the type <xref:System.Windows.DependencyProperty>.</span></span> <span data-ttu-id="e779b-145">Le modèle de propriété de dépendance a été introduit dans Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="e779b-145">The dependency property pattern was introduced in Windows Presentation Foundation (WPF).</span></span> <span data-ttu-id="e779b-146">En général, ce modèle est très flexible afin de faciliter la liaison de données et de prendre en charge d’autres fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="e779b-146">In general, this pattern is very flexible to support easy data binding and other UI features.</span></span> <span data-ttu-id="e779b-147">Toutefois, ce modèle nécessite de définir les propriétés en tant que champs static dans la définition du workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-147">However, the pattern requires the properties to be defined as static fields in the workflow definition.</span></span> <span data-ttu-id="e779b-148">Lorsque le runtime [!INCLUDE[wf1](../../../includes/wf1-md.md)] définit ou obtient les valeurs de propriétés, cela implique une logique de recherche lourde.</span><span class="sxs-lookup"><span data-stu-id="e779b-148">Whenever the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime sets or gets the property values, it involves heavily-weighted look-up logic.</span></span>

 <span data-ttu-id="e779b-149">WF4 utilise une logique claire de portée des données afin d'améliorer considérablement le traitement des données dans un workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-149">WF4 uses clear data scoping logic to greatly improve how data is handled in a workflow.</span></span> <span data-ttu-id="e779b-150">Il sépare les données stockées dans une activité de celles transférées hors des limites de l’activité à l’aide de deux concepts différents : variables et arguments.</span><span class="sxs-lookup"><span data-stu-id="e779b-150">It separates the data stored in an activity from the data that is flowing across the activity boundaries by using two different concepts: variables and arguments.</span></span> <span data-ttu-id="e779b-151">En utilisant une étendue hiérarchique claire pour les variables et les arguments « in/out/InOut », la complexité d’utilisation des données pour les activités est considérablement réduite et la durée de vie des données est également étendue automatiquement.</span><span class="sxs-lookup"><span data-stu-id="e779b-151">By using a clear hierarchical scope for variables and "In/Out/InOut" arguments, the data usage complexity for activities is dramatically reduced and the lifetime of the data is also automatically scoped.</span></span> <span data-ttu-id="e779b-152">Les activités ont une signature bien définie décrite par ses arguments.</span><span class="sxs-lookup"><span data-stu-id="e779b-152">Activities have a well-defined signature described by its arguments.</span></span> <span data-ttu-id="e779b-153">Il vous suffit d'inspecter une activité pour déterminer les données qu'elle s'attend à recevoir et celles qu'elle générera suite à son exécution.</span><span class="sxs-lookup"><span data-stu-id="e779b-153">By simply inspecting an activity you can determine what data it expects to receive and what data will be produced by it as the result of its execution.</span></span>

 <span data-ttu-id="e779b-154">Dans WF3, les activités étaient initialisées lors de la création d'un workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-154">In WF3 activities were initialized when a workflow was created.</span></span> <span data-ttu-id="e779b-155">Dans WF 4, les activités sont initialisées seulement lorsque les activités correspondantes sont en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="e779b-155">In WF 4 activities are initialized only when the corresponding activities are executing.</span></span> <span data-ttu-id="e779b-156">Cela permet de simplifier le cycle de vie des activités sans effectuer d'opérations d'initialisation/d'annulation de l'initialisation lors de la création d'une nouvelle instance de workflow, et de garantir une meilleure efficacité.</span><span class="sxs-lookup"><span data-stu-id="e779b-156">This allows a simpler activity lifecycle without performing Initialize/Uninitialize operations when a new workflow instance is created, and thus has achieved more efficiency</span></span>

### <a name="control-flow"></a><span data-ttu-id="e779b-157">Flux de contrôle</span><span class="sxs-lookup"><span data-stu-id="e779b-157">Control Flow</span></span>
 <span data-ttu-id="e779b-158">Comme dans tout autre langage de programmation, [!INCLUDE[wf1](../../../includes/wf1-md.md)] fournit la prise en charge des flux de contrôle pour les définitions de workflow en introduisant un ensemble d'activités de flux de contrôle pour la mise en séquence, les boucles, les branchements et autres modèles.</span><span class="sxs-lookup"><span data-stu-id="e779b-158">Just as in any programming language, [!INCLUDE[wf1](../../../includes/wf1-md.md)] provides support for control flows for workflow definitions by introducing a set of control flow activities for sequencing, looping, branching and other patterns.</span></span> <span data-ttu-id="e779b-159">Dans WF3, lorsque la même activité doit être exécutée à nouveau, un <xref:System.Workflow.ComponentModel.ActivityExecutionContext> est créé et l'activité est clonée à l'aide d'une logique de sérialisation et de désérialisation lourde basée sur <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span><span class="sxs-lookup"><span data-stu-id="e779b-159">In WF3, when the same activity needs to be re-executed, a new <xref:System.Workflow.ComponentModel.ActivityExecutionContext> is created and the activity is cloned through a heavy-weight serialization and deserialization logic based on <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span></span> <span data-ttu-id="e779b-160">Les performances des flux de contrôle itératif sont généralement bien plus lentes que lors de l'exécution d'une séquence d'activités.</span><span class="sxs-lookup"><span data-stu-id="e779b-160">Usually the performance for iterative control flows is much slower than executing a sequence of activities.</span></span>

 <span data-ttu-id="e779b-161">WF4 traite cela de façon très différente.</span><span class="sxs-lookup"><span data-stu-id="e779b-161">WF4 handles this quite differently.</span></span> <span data-ttu-id="e779b-162">Il utilise le modèle d'activité pour créer un nouvel objet ActivityInstance qu'il ajoute à la file d'attente du planificateur.</span><span class="sxs-lookup"><span data-stu-id="e779b-162">It takes the activity template, creates a new ActivityInstance object, and adds it to the scheduler queue.</span></span> <span data-ttu-id="e779b-163">Ce processus entier implique uniquement la création d’objets explicites et est très léger.</span><span class="sxs-lookup"><span data-stu-id="e779b-163">This whole process only involves explicit object creation and is very lightweight.</span></span>

### <a name="asynchronous-programming"></a><span data-ttu-id="e779b-164">Programmation asynchrone</span><span class="sxs-lookup"><span data-stu-id="e779b-164">Asynchronous Programming</span></span>
 <span data-ttu-id="e779b-165">Les performances et l'évolutivité des applications sont généralement meilleures grâce à la programmation asynchrone pour les opérations à durée d'exécution longue et bloquantes telles que les opérations d'E/S ou de traitement distribué.</span><span class="sxs-lookup"><span data-stu-id="e779b-165">Applications usually have better performance and scalability with asynchronous programming for long running blocking operations such as I/O or distributed computing operations.</span></span> <span data-ttu-id="e779b-166">WF4 fournit la prise en charge asynchrone à l'aide des types d'activité de base <xref:System.Activities.AsyncCodeActivity> et <xref:System.Activities.AsyncCodeActivity%601>.</span><span class="sxs-lookup"><span data-stu-id="e779b-166">WF4 provides asynchronous support through base activity types <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span></span> <span data-ttu-id="e779b-167">Le runtime comprend les activités asynchrones en mode natif et peut donc placer automatiquement l'instance dans une zone sans persistance pendant que le travail asynchrone est en attente.</span><span class="sxs-lookup"><span data-stu-id="e779b-167">The runtime natively understands asynchronous activities and therefore can automatically put the instance in a no-persist zone while the asynchronous work is outstanding.</span></span> <span data-ttu-id="e779b-168">Les activités personnalisées peuvent ainsi dériver de ces types pour effectuer un travail asynchrone sans maintenir le thread du service de planification de workflow. Elles peuvent également bloquer toute activité qui peut s'exécuter en parallèle.</span><span class="sxs-lookup"><span data-stu-id="e779b-168">Custom activities can derive from these types to perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span>

### <a name="messaging"></a><span data-ttu-id="e779b-169">Messagerie</span><span class="sxs-lookup"><span data-stu-id="e779b-169">Messaging</span></span>
 <span data-ttu-id="e779b-170">Initialement, WF3 offrait une prise en charge de la messagerie limitée au moyen d'événements externes ou d'appels de services Web.</span><span class="sxs-lookup"><span data-stu-id="e779b-170">Initially WF3 had very limited messaging support through external events or web services invocations.</span></span> <span data-ttu-id="e779b-171">Dans .NET 3,5, les flux de travail peuvent être implémentés en tant que clients WCF ou exposés en tant que services WCF via <xref:System.Workflow.Activities.SendActivity> et <xref:System.Workflow.Activities.ReceiveActivity> .</span><span class="sxs-lookup"><span data-stu-id="e779b-171">In .NET 3.5, workflows could be implemented as WCF clients or exposed as WCF services through <xref:System.Workflow.Activities.SendActivity> and <xref:System.Workflow.Activities.ReceiveActivity>.</span></span> <span data-ttu-id="e779b-172">Dans WF4, le concept de programmation de messagerie basée sur les workflows a été renforcé grâce à l’intégration étroite de la logique de messagerie WCF dans WF.</span><span class="sxs-lookup"><span data-stu-id="e779b-172">In WF4, the concept of workflow-based messaging programming has been further strengthened through the tight integration of WCF messaging logic into WF.</span></span>

 <span data-ttu-id="e779b-173">Le pipeline de traitement des messages unifié fourni dans WCF dans .NET 4 aide les services WF4 à obtenir des performances et une évolutivité nettement supérieures à celles de WF3.</span><span class="sxs-lookup"><span data-stu-id="e779b-173">The unified message processing pipeline provided in WCF in .NET 4 helps WF4 services to have significantly better performance and scalability than WF3.</span></span> <span data-ttu-id="e779b-174">WF4 fournit également une prise en charge plus riche de la programmation de messagerie qui peut modéliser des modèles d’échange de messages (MEP, message exchange patterns) complexes.</span><span class="sxs-lookup"><span data-stu-id="e779b-174">WF4 also provides richer messaging programming support that can model complex Message Exchange Patterns (MEPs).</span></span> <span data-ttu-id="e779b-175">Les développeurs peuvent utiliser des contrats de service typés pour faciliter la programmation ou non typés pour améliorer les performances sans coûts de sérialisation.</span><span class="sxs-lookup"><span data-stu-id="e779b-175">Developers can use either typed service contracts to achieve easy programming or un-typed service contracts to achieve better performance without paying serialization costs.</span></span> <span data-ttu-id="e779b-176">La prise en charge de la mise en cache côté client à l'aide de la classe <xref:System.ServiceModel.Activities.SendMessageChannelCache> dans WF4 permet aux développeurs de créer des applications rapides avec un minimum d'effort.</span><span class="sxs-lookup"><span data-stu-id="e779b-176">The client-side channel caching support through the <xref:System.ServiceModel.Activities.SendMessageChannelCache> class in WF4 helps developers build fast applications with minimal effort.</span></span> <span data-ttu-id="e779b-177">Pour plus d’informations, consultez [modification des niveaux de partage du cache pour les activités d’envoi](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span><span class="sxs-lookup"><span data-stu-id="e779b-177">For more information, see [Changing the Cache Sharing Levels for Send Activities](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span></span>

### <a name="declarative-programming"></a><span data-ttu-id="e779b-178">Programmation déclarative</span><span class="sxs-lookup"><span data-stu-id="e779b-178">Declarative Programming</span></span>
 <span data-ttu-id="e779b-179">WF4 fournit une structure de programmation déclarative nette et simple permettant de modéliser les processus et services d'entreprise.</span><span class="sxs-lookup"><span data-stu-id="e779b-179">WF4 provides a clean and simple declarative programming framework to model business processes and services.</span></span> <span data-ttu-id="e779b-180">Le modèle de programmation prend en charge la composition entièrement déclarative des activités, sans code-beside, ce qui simplifie considérablement la création de workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-180">The programming model supports fully declarative composition of activities, with no code-beside, greatly simplifying workflow authoring.</span></span> <span data-ttu-id="e779b-181">Dans .NET Framework 4, l’infrastructure de programmation déclarative XAML a été unifiée dans le seul assembly System. Xaml. dll pour prendre en charge à la fois WPF et WF.</span><span class="sxs-lookup"><span data-stu-id="e779b-181">In .NET Framework 4, the XAML-based declarative programming framework has been unified into the single assembly System.Xaml.dll to support both WPF and WF.</span></span>

 <span data-ttu-id="e779b-182">Dans WF4, XAML fournit une expérience véritablement déclarative et permet de définir l'intégralité du workflow dans le balisage XML, en référençant les activités et les types créés à l'aide de .NET.</span><span class="sxs-lookup"><span data-stu-id="e779b-182">In WF4, XAML provides a truly declarative experience and allows for the entire definition of the workflow to be defined in XML markup, referencing activities and types built using .NET.</span></span> <span data-ttu-id="e779b-183">Il était difficile de le faire dans WF3 avec le format XOML sans impliquer une logique code-behind personnalisée.</span><span class="sxs-lookup"><span data-stu-id="e779b-183">This was difficult to do in WF3 with XOML format without involving custom code-behind logic.</span></span> <span data-ttu-id="e779b-184">La nouvelle pile XAML dans .NET 4 offre de bien meilleures performances dans la sérialisation et la désérialisation des artefacts de flux de travail et rend la programmation déclarative plus attrayante et solide.</span><span class="sxs-lookup"><span data-stu-id="e779b-184">The new XAML-stack in .NET 4 has much better performance in serializing/deserializing workflow artifacts and makes declarative programming more attractive and solid.</span></span>

### <a name="workflow-designer"></a><span data-ttu-id="e779b-185">Concepteur de flux de travail</span><span class="sxs-lookup"><span data-stu-id="e779b-185">Workflow Designer</span></span>
 <span data-ttu-id="e779b-186">La prise en charge de la programmation entièrement déclarative pour WF4 impose explicitement des exigences supérieures en matière de performances au moment de la conception pour les grands workflows.</span><span class="sxs-lookup"><span data-stu-id="e779b-186">Fully declarative programming support for WF4 explicitly imposes higher requirements for design time performance for large workflows.</span></span> <span data-ttu-id="e779b-187">L'évolutivité du concepteur de workflow de WF4 pour les grands workflows est bien supérieure à celle du concepteur de WF3.</span><span class="sxs-lookup"><span data-stu-id="e779b-187">The Workflow designer in WF4 has much better scalability for large workflows than that for WF3.</span></span> <span data-ttu-id="e779b-188">La prise en charge de la virtualisation de l'interface permet au concepteur de charger facilement un grand workflow de 1000 activités en quelques secondes, alors qu'il est presque impossible de charger un workflow de quelques centaines d'activités avec le concepteur de WF3.</span><span class="sxs-lookup"><span data-stu-id="e779b-188">With UI virtualization support, the designer can easily load a large workflow of 1000 activities in a few seconds, while it is almost impossible to load a workflow of a few hundred activities with the WF3 designer.</span></span>

## <a name="component-level-performance-comparisons"></a><span data-ttu-id="e779b-189">Comparaisons des performances au niveau des composants</span><span class="sxs-lookup"><span data-stu-id="e779b-189">Component-level Performance Comparisons</span></span>
 <span data-ttu-id="e779b-190">Cette section contient des données sur des comparaisons directes entre les activités individuelles dans les workflows de WF3 et de WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-190">This section contains data on direct comparisons between individual activities in WF3 and WF4 workflows.</span></span>  <span data-ttu-id="e779b-191">Des domaines clés tels que la persistance ont un impact plus profond sur les performances que les composants d'activité individuels.</span><span class="sxs-lookup"><span data-stu-id="e779b-191">Key areas like persistence have a more profound impact on performance than the individual activity components.</span></span>  <span data-ttu-id="e779b-192">Les améliorations de performances des composants individuels dans WF4 sont toutefois importantes, car les composants sont désormais suffisamment rapides pour pouvoir être comparés avec une logique d'orchestration codée manuellement.</span><span class="sxs-lookup"><span data-stu-id="e779b-192">The performance improvements in individual components in WF4 are important though because the components are now fast enough to be compared against hand-coded orchestration logic.</span></span>  <span data-ttu-id="e779b-193">Voici un exemple de ce qui est abordé dans la section suivante : « scénario de composition de service ».</span><span class="sxs-lookup"><span data-stu-id="e779b-193">An example of which is covered in the next section: "Service Composition Scenario."</span></span>

### <a name="environment-setup"></a><span data-ttu-id="e779b-194">Configuration de l’environnement</span><span class="sxs-lookup"><span data-stu-id="e779b-194">Environment Setup</span></span>
 ![Configuration de l’environnement pour la mesure des performances du flux de travail](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="e779b-196">La figure ci-dessus illustre la configuration de l'ordinateur utilisée pour la mesure des performances au niveau du composant.</span><span class="sxs-lookup"><span data-stu-id="e779b-196">The above figure shows the machine configuration used for component-level performance measurement.</span></span> <span data-ttu-id="e779b-197">Un serveur unique et cinq clients connectés par le biais d'une interface réseau Ethernet de 1 Gbit/s. </span><span class="sxs-lookup"><span data-stu-id="e779b-197">A single server and five clients connected over one 1-Gbps Ethernet network interface.</span></span> <span data-ttu-id="e779b-198">Pour faciliter les mesures, le serveur est configuré pour utiliser un seul cœur d'un serveur double processeur/quatre cœurs exécutant Windows Server 2008 x86.</span><span class="sxs-lookup"><span data-stu-id="e779b-198">For easy measurements, the server is configured to use a single core of a dual-proc/quad-core server  running Windows Server 2008 x86.</span></span> <span data-ttu-id="e779b-199">L'utilisation de l'UC système est maintenue aux alentours de 100 %.</span><span class="sxs-lookup"><span data-stu-id="e779b-199">The system CPU utilization is maintained at nearly 100%.</span></span>

### <a name="test-details"></a><span data-ttu-id="e779b-200">Détails du test</span><span class="sxs-lookup"><span data-stu-id="e779b-200">Test Details</span></span>
 <span data-ttu-id="e779b-201"><xref:System.Workflow.Activities.CodeActivity> de WF3 est sans doute l'activité la plus simple pouvant être utilisée dans un workflow WF3.</span><span class="sxs-lookup"><span data-stu-id="e779b-201">The WF3 <xref:System.Workflow.Activities.CodeActivity> is likely the simplest activity that can be used in a WF3 workflow.</span></span>  <span data-ttu-id="e779b-202">Cette activité appelle une méthode du code-behind où le programmeur de workflow peut entrer du code personnalisé.</span><span class="sxs-lookup"><span data-stu-id="e779b-202">The activity calls a method in the code-behind that the workflow programmer can put custom code into.</span></span>  <span data-ttu-id="e779b-203">Dans WF4, il n'existe aucun équivalent direct à <xref:System.Workflow.Activities.CodeActivity> de WF3 qui fournit les mêmes fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="e779b-203">In WF4, there is no direct analog to the WF3 <xref:System.Workflow.Activities.CodeActivity> that provides the same functionality.</span></span>  <span data-ttu-id="e779b-204">Notez que WF4 contient une classe de base <xref:System.Activities.CodeActivity> qui n'est pas liée à <xref:System.Workflow.Activities.CodeActivity> de WF3.</span><span class="sxs-lookup"><span data-stu-id="e779b-204">Note that there is a <xref:System.Activities.CodeActivity> base class in WF4 that is not related to the WF3 <xref:System.Workflow.Activities.CodeActivity>.</span></span>  <span data-ttu-id="e779b-205">Les auteurs de workflow sont encouragés à créer des activités personnalisées et à concevoir des workflows en XAML uniquement.</span><span class="sxs-lookup"><span data-stu-id="e779b-205">Workflow authors are encouraged to create custom activities and build XAML-only workflows.</span></span>  <span data-ttu-id="e779b-206">Dans les tests ci-dessous, une activité appelée `Comment` est utilisée à la place d'une <xref:System.Workflow.Activities.CodeActivity> vide dans les workflows WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-206">In the tests below, an activity called `Comment` is used in place of an empty <xref:System.Workflow.Activities.CodeActivity> in WF4 workflows.</span></span>  <span data-ttu-id="e779b-207">Le code de l'activité `Comment` est le suivant :</span><span class="sxs-lookup"><span data-stu-id="e779b-207">The code in the `Comment` activity is as follows:</span></span>

```csharp
[ContentProperty("Body")]
    public sealed class Comment : CodeActivity
    {
        public Comment()
            : base()
        {
        }

        [DefaultValue(null)]
        public Activity Body
        {
            get;
            set;
        }

        protected override void Execute(CodeActivityContext context)
        {
        }
    }
```

### <a name="empty-workflow"></a><span data-ttu-id="e779b-208">Workflow vide</span><span class="sxs-lookup"><span data-stu-id="e779b-208">Empty Workflow</span></span>
 <span data-ttu-id="e779b-209">Ce test utilise un workflow en séquences sans activités enfants.</span><span class="sxs-lookup"><span data-stu-id="e779b-209">This test uses a sequence workflow with no child activities.</span></span>

### <a name="single-activity"></a><span data-ttu-id="e779b-210">Activité unique</span><span class="sxs-lookup"><span data-stu-id="e779b-210">Single Activity</span></span>
 <span data-ttu-id="e779b-211">Ce workflow est un workflow en séquences contenant une activité enfant.</span><span class="sxs-lookup"><span data-stu-id="e779b-211">The workflow is a sequence workflow containing one child activity.</span></span>  <span data-ttu-id="e779b-212">L'activité est une <xref:System.Workflow.Activities.CodeActivity> sans code dans le cas de WF3 et une activité `Comment` dans le cas de WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-212">The activity is a <xref:System.Workflow.Activities.CodeActivity> with no code in the WF3 case and a `Comment` activity in the WF4 case.</span></span>

### <a name="while-with-1000-iterations"></a><span data-ttu-id="e779b-213">While avec 1000 itérations</span><span class="sxs-lookup"><span data-stu-id="e779b-213">While with 1000 Iterations</span></span>
 <span data-ttu-id="e779b-214">Le workflow en séquences contient une activité <xref:System.Activities.Statements.While> avec une activité enfant dans la boucle qui n'exécute aucun travail.</span><span class="sxs-lookup"><span data-stu-id="e779b-214">The sequence workflow contains one <xref:System.Activities.Statements.While> activity with one child activity in the loop that does not perform any work.</span></span>

### <a name="replicator-compared-to-parallelforeach"></a><span data-ttu-id="e779b-215">Replicator comparé à ParallelForEach</span><span class="sxs-lookup"><span data-stu-id="e779b-215">Replicator compared to ParallelForEach</span></span>
 <span data-ttu-id="e779b-216"><xref:System.Workflow.Activities.ReplicatorActivity> de WF3 a des modes d'exécution séquentiels et parallèles.</span><span class="sxs-lookup"><span data-stu-id="e779b-216"><xref:System.Workflow.Activities.ReplicatorActivity> in WF3 has sequential and parallel execution modes.</span></span>  <span data-ttu-id="e779b-217">En mode séquentiel, les performances de l'activité sont similaires à celles de <xref:System.Workflow.Activities.WhileActivity>.</span><span class="sxs-lookup"><span data-stu-id="e779b-217">In sequential mode, the activity’s performance is similar to the <xref:System.Workflow.Activities.WhileActivity>.</span></span>  <span data-ttu-id="e779b-218"><xref:System.Workflow.Activities.ReplicatorActivity> est surtout utile pour l'exécution parallèle.</span><span class="sxs-lookup"><span data-stu-id="e779b-218">The <xref:System.Workflow.Activities.ReplicatorActivity> is most useful for parallel execution.</span></span>  <span data-ttu-id="e779b-219">L'équivalent WF4 de ceci est l'activité <xref:System.Activities.Statements.ParallelForEach%601>.</span><span class="sxs-lookup"><span data-stu-id="e779b-219">The WF4 analog for this is the <xref:System.Activities.Statements.ParallelForEach%601> activity.</span></span>

 <span data-ttu-id="e779b-220">Le diagramme suivant montre les workflows utilisés pour ce test.</span><span class="sxs-lookup"><span data-stu-id="e779b-220">The following diagram shows the workflows used for this test.</span></span> <span data-ttu-id="e779b-221">Le workflow WF3 est représenté sur la gauche et le workflow WF4 sur la droite.</span><span class="sxs-lookup"><span data-stu-id="e779b-221">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

 ![ReplicatorActivity WF3 et ParallelForEach WF4](./media/performance/replicator-parallel-wf3-wf4.gif)

### <a name="sequential-workflow-with-five-activities"></a><span data-ttu-id="e779b-223">Workflow séquentiel avec cinq activités.</span><span class="sxs-lookup"><span data-stu-id="e779b-223">Sequential Workflow with Five Activities</span></span>
 <span data-ttu-id="e779b-224">Ces tests visent à montrer le résultat de l'exécution de plusieurs activités en séquences.</span><span class="sxs-lookup"><span data-stu-id="e779b-224">This test is meant to show the effect of having several activities execute in sequence.</span></span>  <span data-ttu-id="e779b-225">La séquence inclut cinq activités.</span><span class="sxs-lookup"><span data-stu-id="e779b-225">There are five activities in the sequence.</span></span>

### <a name="transaction-scope"></a><span data-ttu-id="e779b-226">Étendue de transaction</span><span class="sxs-lookup"><span data-stu-id="e779b-226">Transaction Scope</span></span>
 <span data-ttu-id="e779b-227">Le test d’étendue de transaction est légèrement différent des autres tests en ceci qu’une nouvelle instance de workflow n’est pas créée pour chaque itération.</span><span class="sxs-lookup"><span data-stu-id="e779b-227">The transaction scope test differs from the other tests slightly in that a new workflow instance is not created for every iteration.</span></span>  <span data-ttu-id="e779b-228">Au lieu de cela, le workflow est structuré avec une boucle while comprenant une activité <xref:System.Activities.Statements.TransactionScope> qui contient une activité unique qui n'effectue aucun travail.</span><span class="sxs-lookup"><span data-stu-id="e779b-228">Instead, the workflow is structured with a while loop containing a <xref:System.Activities.Statements.TransactionScope> activity containing a single activity that does no work.</span></span>  <span data-ttu-id="e779b-229">Chaque exécution d'un lot de 50 itérations dans la boucle while est comptée comme une opération unique.</span><span class="sxs-lookup"><span data-stu-id="e779b-229">Each run of a batch of 50 iterations through the while loop is counted as a single operation.</span></span>

### <a name="compensation"></a><span data-ttu-id="e779b-230">Compensation</span><span class="sxs-lookup"><span data-stu-id="e779b-230">Compensation</span></span>
 <span data-ttu-id="e779b-231">Le workflow WF3 contient une activité compensable unique appelée `WorkScope`.</span><span class="sxs-lookup"><span data-stu-id="e779b-231">The WF3 workflow has a single compensatable activity named `WorkScope`.</span></span>  <span data-ttu-id="e779b-232">L'activité implémente simplement l'interface <xref:System.Workflow.ComponentModel.ICompensatableActivity> :</span><span class="sxs-lookup"><span data-stu-id="e779b-232">The activity simply implements the <xref:System.Workflow.ComponentModel.ICompensatableActivity> interface:</span></span>

```csharp
class WorkScope :
        CompositeActivity, ICompensatableActivity
    {
        public WorkScope() : base() { }

        public WorkScope(string name)
        {
            this.Name = name;
        }

        public ActivityExecutionStatus Compensate(
            ActivityExecutionContext executionContext)
        {
            return ActivityExecutionStatus.Closed;
        }
    }
```

 <span data-ttu-id="e779b-233">Le gestionnaire d’erreurs cible l' `WorkScope` activité.</span><span class="sxs-lookup"><span data-stu-id="e779b-233">The fault handler targets the `WorkScope` activity.</span></span> <span data-ttu-id="e779b-234">Le flux de travail WF4 est tout aussi simpliste.</span><span class="sxs-lookup"><span data-stu-id="e779b-234">The WF4 workflow is equally simplistic.</span></span>  <span data-ttu-id="e779b-235">Une <xref:System.Activities.Statements.CompensableActivity> possède un corps et un gestionnaire de compensation.</span><span class="sxs-lookup"><span data-stu-id="e779b-235">A <xref:System.Activities.Statements.CompensableActivity> has a body and a compensation handler.</span></span>  <span data-ttu-id="e779b-236">La séquence suivante contient une compensation explicite.</span><span class="sxs-lookup"><span data-stu-id="e779b-236">An explicit compensate is next in the sequence.</span></span>  <span data-ttu-id="e779b-237">L'activité de corps et le gestionnaire de compensation sont des implémentations vides :</span><span class="sxs-lookup"><span data-stu-id="e779b-237">The body activity and compensation handler activity are both empty implementations:</span></span>

```csharp
public sealed class CompensableActivityEmptyCompensation : CodeActivity
    {
        public CompensableActivityEmptyCompensation()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
    public sealed class CompensableActivityEmptyBody : CodeActivity
    {
        public CompensableActivityEmptyBody()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
```

<span data-ttu-id="e779b-238">Le diagramme suivant montre le flux de travail de compensation de base.</span><span class="sxs-lookup"><span data-stu-id="e779b-238">The following diagram shows the basic compensation workflow.</span></span> <span data-ttu-id="e779b-239">Le workflow WF3 est représenté sur la gauche et le workflow WF4 sur la droite.</span><span class="sxs-lookup"><span data-stu-id="e779b-239">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

![Flux de travail de compensation de base WF3 et WF4](./media/performance/basic-compensation-workflows-wf3-wf4.gif)

### <a name="performance-test-results"></a><span data-ttu-id="e779b-241">Résultats des test de performances</span><span class="sxs-lookup"><span data-stu-id="e779b-241">Performance Test Results</span></span>

 ![Tableau contenant les données des résultats des tests de performances](./media/performance/performance-test-data.gif)

 ![Histogramme comparant les données de test de performances WF3 et WF4](./media/performance/performance-test-chart.gif)

 <span data-ttu-id="e779b-244">Tous les tests sont mesurés en workflows par seconde à l'exception du test d'étendue de transaction.</span><span class="sxs-lookup"><span data-stu-id="e779b-244">All tests are measured in workflows per second with the exception of the transaction scope test.</span></span>  <span data-ttu-id="e779b-245">Comme vous pouvez le constater ci-dessus, les performances du runtime [!INCLUDE[wf1](../../../includes/wf1-md.md)] se sont améliorées dans le tableau, en particulier dans les domaines qui nécessitent plusieurs exécutions de la même activité comme la boucle while.</span><span class="sxs-lookup"><span data-stu-id="e779b-245">As can be seen above, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime performance has improved across the board, especially in areas that require multiple executions of the same activity like the while loop.</span></span>

## <a name="service-composition-scenario"></a><span data-ttu-id="e779b-246">Scénario de composition de service</span><span class="sxs-lookup"><span data-stu-id="e779b-246">Service Composition Scenario</span></span>
 <span data-ttu-id="e779b-247">Comme indiqué dans la section précédente, « comparaisons des performances au niveau du composant », il y a eu une réduction significative de la surcharge entre WF3 et WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-247">As is shown in the previous section, "Component-level Performance Comparisons," there has been a significant reduction in overhead between WF3 and WF4.</span></span>  <span data-ttu-id="e779b-248">Les services de workflow WCF peuvent maintenant presque correspondre aux performances des services WCF codés manuellement, tout en conservant tous les avantages du [!INCLUDE[wf1](../../../includes/wf1-md.md)] Runtime.</span><span class="sxs-lookup"><span data-stu-id="e779b-248">WCF workflow services can now almost match the performance of hand-coded WCF services but still have all the benefits of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="e779b-249">Ce scénario de test compare un service WCF à un service de flux de travail WCF dans WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-249">This test scenario compares a WCF service against a WCF workflow service in WF4.</span></span>

### <a name="online-store-service"></a><span data-ttu-id="e779b-250">Service de magasin en ligne</span><span class="sxs-lookup"><span data-stu-id="e779b-250">Online Store Service</span></span>
 <span data-ttu-id="e779b-251">L’une des forces de Windows Workflow Foundation est la possibilité de composer des processus à l’aide de plusieurs services.</span><span class="sxs-lookup"><span data-stu-id="e779b-251">One of the strengths of Windows Workflow Foundation is the ability to compose processes using several services.</span></span>  <span data-ttu-id="e779b-252">Dans cet exemple, un service de magasin en ligne organise deux appels de service pour passer une commande.</span><span class="sxs-lookup"><span data-stu-id="e779b-252">For this example, there is an online store service that orchestrates two service calls to purchase an order.</span></span>  <span data-ttu-id="e779b-253">La première étape consiste à valider la commande par le biais d'un service de validation des commandes.</span><span class="sxs-lookup"><span data-stu-id="e779b-253">The first step is to validate the order using an Order Validating Service.</span></span>  <span data-ttu-id="e779b-254">La seconde étape consiste à satisfaire la commande à l'aide d'un service d'entrepôt .</span><span class="sxs-lookup"><span data-stu-id="e779b-254">The second step is to fill the order using a Warehouse Service.</span></span>

 <span data-ttu-id="e779b-255">Les deux services backend, de validation des commandes et d'entrepôt, sont les mêmes pour les deux tests.</span><span class="sxs-lookup"><span data-stu-id="e779b-255">The two backend services, Order Validating Service and Warehouse Service, remain the same for both tests.</span></span>  <span data-ttu-id="e779b-256">La partie qui change est le service de magasin en ligne qui effectue l'orchestration.</span><span class="sxs-lookup"><span data-stu-id="e779b-256">The part that changes is the Online Store Service that performs the orchestration.</span></span>  <span data-ttu-id="e779b-257">Dans un cas, le service est codé manuellement en tant que service WCF.</span><span class="sxs-lookup"><span data-stu-id="e779b-257">In one case, the service is hand-coded as a WCF service.</span></span>  <span data-ttu-id="e779b-258">Pour l’autre cas, le service est écrit sous la forme d’un service de workflow WCF dans WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-258">For the other case, the service is written as a WCF workflow service in WF4.</span></span> <span data-ttu-id="e779b-259">Les fonctionnalités spécifiques à [!INCLUDE[wf1](../../../includes/wf1-md.md)], telles que le suivi et la persistance, sont désactivées pour ce test.</span><span class="sxs-lookup"><span data-stu-id="e779b-259">[!INCLUDE[wf1](../../../includes/wf1-md.md)]-specific features like tracking and persistence are turned off for this test.</span></span>

### <a name="environment"></a><span data-ttu-id="e779b-260">Environnement</span><span class="sxs-lookup"><span data-stu-id="e779b-260">Environment</span></span>
![Configuration de l’environnement pour la mesure des performances](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="e779b-262">Les demandes du client sont transmises au service de magasin en ligne via HTTP à partir de plusieurs ordinateurs.</span><span class="sxs-lookup"><span data-stu-id="e779b-262">Client requests are made to the Online Store Service via HTTP from multiple computers.</span></span>  <span data-ttu-id="e779b-263">Un ordinateur unique héberge les trois services.</span><span class="sxs-lookup"><span data-stu-id="e779b-263">A single computer hosts all three services.</span></span>  <span data-ttu-id="e779b-264">La couche de transport entre le service de magasin en ligne et les services backend est TCP ou HTTP.</span><span class="sxs-lookup"><span data-stu-id="e779b-264">The transport layer between the Online Store Service and the backend services is TCP or HTTP.</span></span>  <span data-ttu-id="e779b-265">La mesure des opérations/seconde est basée sur le nombre d'appels `PurchaseOrder` passés au service de magasin en ligne.</span><span class="sxs-lookup"><span data-stu-id="e779b-265">The measurement of operations/second is based on the number of completed `PurchaseOrder` calls made to the Online Store Service.</span></span>  <span data-ttu-id="e779b-266">Le regroupement de canaux est une nouvelle fonctionnalité disponible dans WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-266">Channel pooling is a new feature available in WF4.</span></span>  <span data-ttu-id="e779b-267">Dans la partie WCF de ce test de regroupement de canaux n’est pas fourni par la suite, une implémentation codée manuellement d’une technique de regroupement simple a été utilisée dans le service de magasin en ligne.</span><span class="sxs-lookup"><span data-stu-id="e779b-267">In the WCF portion of this test channel pooling is not provided out of the box so a hand-coded implementation of a simple pooling technique was used in the Online Store Service.</span></span>

### <a name="performance"></a><span data-ttu-id="e779b-268">Performances</span><span class="sxs-lookup"><span data-stu-id="e779b-268">Performance</span></span>
![Histogramme présentant les performances du service de magasin en ligne](./media/performance/online-store-performance-graph.gif)

 <span data-ttu-id="e779b-270">En se connectant aux services TCP backend sans regroupement de canaux, le service [!INCLUDE[wf1](../../../includes/wf1-md.md)] a un impact de 17,2 % sur le débit.</span><span class="sxs-lookup"><span data-stu-id="e779b-270">Connecting to backend TCP services without channel pooling, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] service has a 17.2% impact on throughput.</span></span>  <span data-ttu-id="e779b-271">Avec le regroupement de canaux, la pénalité est d'environ 23,8 %.</span><span class="sxs-lookup"><span data-stu-id="e779b-271">With channel pooling, the penalty is about 23.8%.</span></span>  <span data-ttu-id="e779b-272">Pour HTTP, l'impact est bien moindre : 4,3 % sans regroupement et 8,1 % avec le regroupement.</span><span class="sxs-lookup"><span data-stu-id="e779b-272">For HTTP, the impact is much less: 4.3% without pooling and 8.1% with pooling.</span></span>  <span data-ttu-id="e779b-273">Il est important de noter que le regroupement de canaux présente très peu d'avantages lors de l'utilisation de HTTP.</span><span class="sxs-lookup"><span data-stu-id="e779b-273">It is also important to note that the channel pooling provides very little benefit when using HTTP.</span></span>

 <span data-ttu-id="e779b-274">Bien qu’il y ait une surcharge du runtime WF4 par rapport à un service WCF codé à la main dans ce test, il peut être considéré comme un scénario le plus défavorable.</span><span class="sxs-lookup"><span data-stu-id="e779b-274">While there is overhead from the WF4 runtime compared with a hand-coded WCF service in this test, it could be considered a worst-case scenario.</span></span>  <span data-ttu-id="e779b-275">Les deux services backend dans ce test exécutent très peu de travail.</span><span class="sxs-lookup"><span data-stu-id="e779b-275">The two backend services in this test do very little work.</span></span>  <span data-ttu-id="e779b-276">Dans un scénario de bout en bout réel, ces services effectueraient des opérations plus coûteuses telles que des appels de base de données, ce qui réduirait l'impact de la couche de transport sur les performances.</span><span class="sxs-lookup"><span data-stu-id="e779b-276">In a real end-to-end scenario, these services would perform more expensive operations like database calls, making the performance impact of the transport layer less important.</span></span>  <span data-ttu-id="e779b-277">Tout cela ajouté aux avantages des fonctionnalités disponibles dans WF4 fait de Workflow Foundation un choix viable pour la création de services d’orchestration.</span><span class="sxs-lookup"><span data-stu-id="e779b-277">This plus the benefits of the features available in WF4 makes Workflow Foundation a viable choice for creating orchestration services.</span></span>

## <a name="key-performance-considerations"></a><span data-ttu-id="e779b-278">Considérations sur les performances clés</span><span class="sxs-lookup"><span data-stu-id="e779b-278">Key Performance Considerations</span></span>
 <span data-ttu-id="e779b-279">Les fonctionnalités abordées dans cette section, à l’exception de l’interopérabilité, ont radicalement changé entre WF3 et WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-279">The feature areas in this section, with the exception of interop, have dramatically changed between WF3 and WF4.</span></span>  <span data-ttu-id="e779b-280">Cela affecte la conception des applications de workflow ainsi que les performances.</span><span class="sxs-lookup"><span data-stu-id="e779b-280">This affects the design of workflow applications as well as the performance.</span></span>

#### <a name="workflow-activation-latency"></a><span data-ttu-id="e779b-281">Latence de l'activation de workflow</span><span class="sxs-lookup"><span data-stu-id="e779b-281">Workflow Activation Latency</span></span>
 <span data-ttu-id="e779b-282">Dans une application de service de flux de travail WCF, la latence pour le démarrage d’un nouveau Workflow ou le chargement d’un flux de travail existant est importante, car elle peut être bloquée.</span><span class="sxs-lookup"><span data-stu-id="e779b-282">In a WCF workflow service application, the latency for starting a new workflow or loading an existing workflow is important as it can be blocking.</span></span>  <span data-ttu-id="e779b-283">Ce cas de test compare un hôte XOML WF3 à un hôte XAMLX WF4 dans un scénario classique.</span><span class="sxs-lookup"><span data-stu-id="e779b-283">This test case measures a WF3 XOML host against a WF4 XAMLX host in a typical scenario.</span></span>

##### <a name="environment-setup"></a><span data-ttu-id="e779b-284">Configuration de l’environnement</span><span class="sxs-lookup"><span data-stu-id="e779b-284">Environment Setup</span></span>
 ![Configuration de l'environnement pour les tests de latence et de débit](./media/performance/latency-throughput-environment-setup.gif)

##### <a name="test-setup"></a><span data-ttu-id="e779b-286">Configuration du test</span><span class="sxs-lookup"><span data-stu-id="e779b-286">Test Setup</span></span>
 <span data-ttu-id="e779b-287">Dans le scénario, un ordinateur client contacte un service de flux de travail WCF à l’aide de la corrélation basée sur le contexte.</span><span class="sxs-lookup"><span data-stu-id="e779b-287">In the scenario, a client computer contacts a WCF workflow service using context-based correlation.</span></span>  <span data-ttu-id="e779b-288">La corrélation de contexte nécessite une liaison de contexte spéciale et utilise un en-tête ou un cookie de contexte pour lier les messages à l’instance de workflow correcte.</span><span class="sxs-lookup"><span data-stu-id="e779b-288">Context correlation requires a special context binding and uses a context header or cookie to relate messages to the correct workflow instance.</span></span>  <span data-ttu-id="e779b-289">Elle offre un avantage en termes de performances, car dans la mesure où l'ID de corrélation se trouve dans l'en-tête du message, il n'est pas nécessaire d'analyser le corps du message.</span><span class="sxs-lookup"><span data-stu-id="e779b-289">It has a performance benefit in that the correlation Id is located in the message header so the message body does not need to be parsed.</span></span>

 <span data-ttu-id="e779b-290">Le service crée un nouveau workflow avec la demande et envoie une réponse immédiate de sorte que la mesure de la latence n'inclut pas le temps d'exécution du workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-290">The service will create a new workflow with the request and send an immediate response so that the measurement of latency does not include the time spent running the workflow.</span></span>  <span data-ttu-id="e779b-291">Le workflow WF3 est au format XOML avec un code-behind et le workflow WF4 est entièrement au format XAML.</span><span class="sxs-lookup"><span data-stu-id="e779b-291">The WF3 workflow is XOML with a code-behind and the WF4 workflow is entirely XAML.</span></span>  <span data-ttu-id="e779b-292">Voici un exemple de workflow WF4 :</span><span class="sxs-lookup"><span data-stu-id="e779b-292">The WF4 workflow looks like this:</span></span>

 ![Flux de travail d’étendue de corrélation WF4](./media/performance/wf4-correlationscope-workflow.gif)

 <span data-ttu-id="e779b-294">L'activité <xref:System.ServiceModel.Activities.Receive> crée l'instance de workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-294">The <xref:System.ServiceModel.Activities.Receive> activity creates the workflow instance.</span></span>  <span data-ttu-id="e779b-295">Une valeur passée dans le message reçu est répercutée dans le message de réponse.</span><span class="sxs-lookup"><span data-stu-id="e779b-295">A value passed in the received message is echoed in the reply message.</span></span>  <span data-ttu-id="e779b-296">Une séquence qui suit la réponse contient le reste du workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-296">A sequence following the reply contains the rest of the workflow.</span></span>  <span data-ttu-id="e779b-297">Dans le cas ci-dessus, un seule activité de commentaire est représentée.</span><span class="sxs-lookup"><span data-stu-id="e779b-297">In the above case, only one comment activity is shown.</span></span>  <span data-ttu-id="e779b-298">Le nombre d'activités de commentaire est modifié pour simuler la complexité de workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-298">The number of comment activities is changed to simulate workflow complexity.</span></span>  <span data-ttu-id="e779b-299">Une activité de commentaire est équivalente à un <xref:System.Workflow.Activities.CodeActivity> WF3 qui n'effectue aucune tâche.</span><span class="sxs-lookup"><span data-stu-id="e779b-299">A comment activity is equivalent to a WF3 <xref:System.Workflow.Activities.CodeActivity> that performs no work.</span></span> <span data-ttu-id="e779b-300">Pour plus d’informations sur l’activité de commentaire, consultez la section « Comparaison des performances au niveau des composants » plus haut dans cet article.</span><span class="sxs-lookup"><span data-stu-id="e779b-300">For more information about the comment activity, see the "Component-level Performance Comparison" section earlier in this article.</span></span>

##### <a name="test-results"></a><span data-ttu-id="e779b-301">Résultats du test</span><span class="sxs-lookup"><span data-stu-id="e779b-301">Test Results</span></span>

 <span data-ttu-id="e779b-302">Latence à froid et à chaud pour les services de workflow WCF :</span><span class="sxs-lookup"><span data-stu-id="e779b-302">Cold and warm latency for WCF workflow services:</span></span>

 ![Histogramme présentant la latence à froid et à chaud pour les services de workflow WCF à l’aide de WF3 et WF4](./media/performance/latency-results-graph.gif)

 <span data-ttu-id="e779b-304">Dans le graphique précédent, Cold fait référence au cas où il n’existe pas <xref:System.ServiceModel.WorkflowServiceHost> de existant pour le workflow donné.</span><span class="sxs-lookup"><span data-stu-id="e779b-304">In the previous chart, cold refers to the case where there is not an existing <xref:System.ServiceModel.WorkflowServiceHost> for the given workflow.</span></span>  <span data-ttu-id="e779b-305">En d'autres termes, la latence à froid correspond au cas dans lequel le workflow est utilisé pour la première fois et le XOML ou le XAML doit être compilé.</span><span class="sxs-lookup"><span data-stu-id="e779b-305">In other words, cold latency is when the workflow is being used for the first time and the XOML or XAML needs to be compiled.</span></span>  <span data-ttu-id="e779b-306">La latence à chaud correspond à la création d'une nouvelle instance de workflow lorsque le type de workflow a déjà été compilé.</span><span class="sxs-lookup"><span data-stu-id="e779b-306">Warm latency is the time to create a new workflow instance when the workflow type has already been compiled.</span></span>  <span data-ttu-id="e779b-307">La complexité du workflow a très peu d'impact dans le cas de WF4, mais a une progression linéaire dans le cas de WF3.</span><span class="sxs-lookup"><span data-stu-id="e779b-307">The complexity of the workflow makes very little difference in the WF4 case but has a linear progression in the WF3 case.</span></span>

#### <a name="correlation-throughput"></a><span data-ttu-id="e779b-308">Débit de corrélation</span><span class="sxs-lookup"><span data-stu-id="e779b-308">Correlation Throughput</span></span>
 <span data-ttu-id="e779b-309">WF4 introduit une nouvelle fonctionnalité de corrélation basée sur le contenu.</span><span class="sxs-lookup"><span data-stu-id="e779b-309">WF4 introduces a new content-based correlation feature.</span></span>  <span data-ttu-id="e779b-310">WF3 offrait seulement la corrélation basée sur le contexte.</span><span class="sxs-lookup"><span data-stu-id="e779b-310">WF3 provided only context-based correlation.</span></span>  <span data-ttu-id="e779b-311">La corrélation basée sur le contexte ne peut être effectuée que sur des liaisons de canal WCF spécifiques.</span><span class="sxs-lookup"><span data-stu-id="e779b-311">Context-based correlation could only be done over specific WCF channel bindings.</span></span>  <span data-ttu-id="e779b-312">L’ID de workflow est inséré dans l’en-tête de message lors de l’utilisation de ces liaisons.</span><span class="sxs-lookup"><span data-stu-id="e779b-312">The workflow Id is inserted into the message header when using these bindings.</span></span>  <span data-ttu-id="e779b-313">Le runtime WF3 peut uniquement identifier un flux de travail par son ID.  Avec la corrélation basée sur le contenu, l’auteur du flux de travail peut créer une clé de corrélation à partir d’un élément de données approprié, tel qu’un numéro de compte ou un ID client.</span><span class="sxs-lookup"><span data-stu-id="e779b-313">The WF3 runtime could only identify a workflow by its Id.  With content-based correlation, the workflow author can create a correlation key out of a relevant piece of data like an account number or customer Id.</span></span>

 <span data-ttu-id="e779b-314">La corrélation basée sur le contexte offre un avantage en matière de performances en ceci que la clé de corrélation se trouve dans l'en-tête du message.</span><span class="sxs-lookup"><span data-stu-id="e779b-314">Context-based correlation has a performance advantage in that the correlation key is located in the message header.</span></span>  <span data-ttu-id="e779b-315">La clé peut être lue à partir du message sans désérialisation/copie du message.</span><span class="sxs-lookup"><span data-stu-id="e779b-315">The key can be read from the message without de-serialization/message-copying.</span></span>  <span data-ttu-id="e779b-316">Avec la corrélation basée sur le contenu, la clé de corrélation est stockée dans le corps du message.</span><span class="sxs-lookup"><span data-stu-id="e779b-316">In content-based correlation, the correlation key is stored in the message body.</span></span>  <span data-ttu-id="e779b-317">Une expression XPath est utilisée pour rechercher la clé.</span><span class="sxs-lookup"><span data-stu-id="e779b-317">An XPath expression is used to locate the key.</span></span>  <span data-ttu-id="e779b-318">Le coût de ce traitement supplémentaire dépend de la taille du message, de la profondeur de la clé dans le corps et du nombre de clés.</span><span class="sxs-lookup"><span data-stu-id="e779b-318">The cost of this extra processing depends on the size of the message, depth of the key in the body, and the number of keys.</span></span>  <span data-ttu-id="e779b-319">Ce test compare la corrélation basée sur le contexte à celle basée sur le contenu et montre également la détérioration des performances lors de l'utilisation de plusieurs clés.</span><span class="sxs-lookup"><span data-stu-id="e779b-319">This test compares context- and content-based correlation and also shows the performance degradation when using multiple keys.</span></span>

#### <a name="environment-setup"></a><span data-ttu-id="e779b-320">Configuration de l’environnement</span><span class="sxs-lookup"><span data-stu-id="e779b-320">Environment Setup</span></span>
![Configuration de l’environnement pour le test des performances de workflow](./media/performance/performance-test-environment.gif)

#### <a name="test-setup"></a><span data-ttu-id="e779b-322">Configuration du test</span><span class="sxs-lookup"><span data-stu-id="e779b-322">Test Setup</span></span>
<span data-ttu-id="e779b-323">![Test du workflow de débit de corrélation](./media/performance/correlation-throughput-workflow.gif "Configuration du test de flux de travail du débit de corrélation")</span><span class="sxs-lookup"><span data-stu-id="e779b-323">![Correlation Throughput Workflow Test](./media/performance/correlation-throughput-workflow.gif "Correlation throughput workflow test setup")</span></span>

 <span data-ttu-id="e779b-324">Le flux de travail précédent est le même que celui utilisé dans la section de [persistance](#persistence) .</span><span class="sxs-lookup"><span data-stu-id="e779b-324">The previous workflow is the same one used in the [Persistence](#persistence) section.</span></span> <span data-ttu-id="e779b-325">Pour les tests de corrélation sans persistance, aucun fournisseur de persistance n’est installé dans le Runtime.</span><span class="sxs-lookup"><span data-stu-id="e779b-325">For the correlation tests without persistence, there is no persistence provider installed in the runtime.</span></span> <span data-ttu-id="e779b-326">La corrélation se produit en deux endroits : CreateOrder et CompleteOrder.</span><span class="sxs-lookup"><span data-stu-id="e779b-326">Correlation occurs in two places: CreateOrder and CompleteOrder.</span></span>

#### <a name="test-results"></a><span data-ttu-id="e779b-327">Résultats du test</span><span class="sxs-lookup"><span data-stu-id="e779b-327">Test Results</span></span>
<span data-ttu-id="e779b-328">![Débit de corrélation](./media/performance/correlation-throughput-graph.gif "Graphique de débit de corrélation")</span><span class="sxs-lookup"><span data-stu-id="e779b-328">![Correlation Throughput](./media/performance/correlation-throughput-graph.gif "Correlation throughput graph")</span></span>

 <span data-ttu-id="e779b-329">Ce graphique illustre une baisse des performances au fur et à mesure que le nombre de clés utilisées dans la corrélation basée sur le contenu augmente.</span><span class="sxs-lookup"><span data-stu-id="e779b-329">This graph shows a decrease in performance as the number of keys used in content-based correlation increases.</span></span>  <span data-ttu-id="e779b-330">La similarité entre les courbes de TCP et HTTP indique la charge mémoire associée à ces protocoles.</span><span class="sxs-lookup"><span data-stu-id="e779b-330">The similarity in the curves between TCP and HTTP indicates the overhead associated with these protocols.</span></span>

#### <a name="correlation-with-persistence"></a><span data-ttu-id="e779b-331">Corrélation et persistance.</span><span class="sxs-lookup"><span data-stu-id="e779b-331">Correlation with Persistence</span></span>
 <span data-ttu-id="e779b-332">Avec un workflow rendu persistant, la pression sur l'UC de la corrélation basée sur le contenu passe du runtine de workflow à la base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="e779b-332">With a persisted workflow, the CPU pressure from content-based correlation shifts from the workflow runtime to the SQL database.</span></span>  <span data-ttu-id="e779b-333">Les procédures stockées dans le fournisseur de persistance SQL font correspondre les clés pour rechercher le workflow approprié.</span><span class="sxs-lookup"><span data-stu-id="e779b-333">The stored procedures in the SQL persistence provider do the work of matching the keys to locate the appropriate workflow.</span></span>

 ![Graphique en courbes présentant les résultats de corrélation et de persistance](./media/performance/correlation-persistence-graph.gif)

 <span data-ttu-id="e779b-335">La corrélation basée sur le contexte est toujours plus rapide que la corrélation basée sur le contenu.</span><span class="sxs-lookup"><span data-stu-id="e779b-335">Context-based correlation is still faster than content-based correlation.</span></span>  <span data-ttu-id="e779b-336">Toutefois, la différence est moins prononcée, car la persistance a plus d'impact sur les performances que la corrélation.</span><span class="sxs-lookup"><span data-stu-id="e779b-336">However, the difference is less pronounced as persistence has more impact on performance than correlation.</span></span>

### <a name="complex-workflow-throughput"></a><span data-ttu-id="e779b-337">Débit de workflow complexe</span><span class="sxs-lookup"><span data-stu-id="e779b-337">Complex Workflow Throughput</span></span>
 <span data-ttu-id="e779b-338">La complexité d'un workflow ne se mesure pas uniquement au nombre d'activités.</span><span class="sxs-lookup"><span data-stu-id="e779b-338">The complexity of a workflow is not measured only by the number of activities.</span></span>  <span data-ttu-id="e779b-339">Les activités composites peuvent contenir de nombreux enfants, qui peuvent aussi être des activités composites.</span><span class="sxs-lookup"><span data-stu-id="e779b-339">Composite activities can contain many children and those children can also be composite activities.</span></span>  <span data-ttu-id="e779b-340">Au fur et à mesure que le nombre de niveaux d'imbrication augmente, il en va de même pour le nombre d'activités pouvant avoir l'état Exécution et le nombre de variables pouvant avoir cet état.</span><span class="sxs-lookup"><span data-stu-id="e779b-340">As the number of levels of nesting increases, so does the number of activities that can be currently in the executing state and the number of variables that can be in state.</span></span>  <span data-ttu-id="e779b-341">Ce test compare les débits de WF3 et de WF4 lors de l'exécution de workflows complexes.</span><span class="sxs-lookup"><span data-stu-id="e779b-341">This test compares throughput between WF3 and WF4 when executing complex workflows.</span></span>

### <a name="test-setup"></a><span data-ttu-id="e779b-342">Configuration du test</span><span class="sxs-lookup"><span data-stu-id="e779b-342">Test Setup</span></span>
 <span data-ttu-id="e779b-343">Ces tests ont été exécutés sur un ordinateur Intel Xeon X5355 2,66 GHz quatre cœurs avec 4 Go de RAM exécutant Windows Server 2008 x64.</span><span class="sxs-lookup"><span data-stu-id="e779b-343">These tests were executed on an Intel Xeon X5355 @ 2.66GHz 4-way computer with 4GB RAM running Windows Server 2008 x64.</span></span>  <span data-ttu-id="e779b-344">Le code de test exécute un processus unique avec un thread par cœur pour atteindre une utilisation de l'UC de 100 %.</span><span class="sxs-lookup"><span data-stu-id="e779b-344">The test code runs in a single process with one thread per core to reach 100% CPU utilization.</span></span>

 <span data-ttu-id="e779b-345">Les workflows générés pour ce test contiennent deux variables principales : profondeur et nombre d'activités dans chaque séquence.</span><span class="sxs-lookup"><span data-stu-id="e779b-345">The workflows generated for this test have two main variables: depth and number of activities in each sequence.</span></span>  <span data-ttu-id="e779b-346">Chaque niveau de profondeur inclut une activité parallèle, pendant la boucle, les décisions, les affectations et les séquences.</span><span class="sxs-lookup"><span data-stu-id="e779b-346">Each depth level includes a parallel activity, while loop, decisions, assignments, and sequences.</span></span>  <span data-ttu-id="e779b-347">Dans le concepteur WF4 illustré ci-dessous, l'organigramme de niveau supérieur est représenté.</span><span class="sxs-lookup"><span data-stu-id="e779b-347">In the WF4 designer pictured below, the top-level flow chart is pictured.</span></span>  <span data-ttu-id="e779b-348">Chaque activité d'organigramme ressemble au diagramme principal.</span><span class="sxs-lookup"><span data-stu-id="e779b-348">Each flowchart activity resembles the main flowchart.</span></span>  <span data-ttu-id="e779b-349">Il peut s'avérer utile de considérer une fractale pour illustrer ce workflow, dans lequel la profondeur est limitée aux paramètres du test.</span><span class="sxs-lookup"><span data-stu-id="e779b-349">It may be helpful to think of a fractal when picturing this workflow, where the depth is limited to the parameters of the test.</span></span>

 <span data-ttu-id="e779b-350">Le nombre d'activités dans un test donné est déterminé par la profondeur et nombre d'activités par séquence.</span><span class="sxs-lookup"><span data-stu-id="e779b-350">The number of activities in a given test is determined by the depth and number of activities per sequence.</span></span>  <span data-ttu-id="e779b-351">L'équation suivante calcule le nombre d'activités dans le test de WF4 :</span><span class="sxs-lookup"><span data-stu-id="e779b-351">The following equation computes the number of activities in the WF4 test:</span></span>

 ![Équation pour calculer le nombre d'activités](./media/performance/number-activities-equation.gif)

 <span data-ttu-id="e779b-353">Le nombre d'activités du test de WF3 peut être calculé à l'aide d'une équation un peu différente à cause d'une séquence supplémentaire :</span><span class="sxs-lookup"><span data-stu-id="e779b-353">The WF3 test’s activity count can be computed with a slightly different equation due to an extra sequence:</span></span>

 ![Équation permettant de calculer le nombre d’activités WF3](./media/performance/wf3-number-activities-equation.gif)

 <span data-ttu-id="e779b-355">Où d correspond à la profondeur et a au nombre d'activités par séquence.</span><span class="sxs-lookup"><span data-stu-id="e779b-355">Where d is the depth and a is the number of activities per sequence.</span></span>  <span data-ttu-id="e779b-356">La logique qui sous-tend ces équations est que la première constante, multipliée par a, correspond au nombre de séquences et la seconde constante correspond au nombre statique d'activités dans le niveau actuel.</span><span class="sxs-lookup"><span data-stu-id="e779b-356">The logic behind these equations is that the first constant, multiplied by a, is the number of sequences and the second constant is the static number of activities in the current level.</span></span>  <span data-ttu-id="e779b-357">Chaque organigramme inclut trois activités enfant.</span><span class="sxs-lookup"><span data-stu-id="e779b-357">There are three flowchart child activities in each flowchart.</span></span>  <span data-ttu-id="e779b-358">Au niveau de profondeur inférieur, ces organigrammes sont vides, mais les autres niveaux contiennent des copies de l'organigramme principal.</span><span class="sxs-lookup"><span data-stu-id="e779b-358">At the bottom depth level, these flowcharts are empty but at the other levels they are copies of the main flowchart.</span></span>  <span data-ttu-id="e779b-359">Le nombre d'activités dans la définition de workflow de chaque variation de test est indiqué dans le tableau suivant :</span><span class="sxs-lookup"><span data-stu-id="e779b-359">The number of activities in each test variation’s workflow definition is indicated in the following table:</span></span>

 ![Un tableau qui indique le nombre d’activités utilisées dans chaque test](./media/performance/workflow-variation-compare-table.gif)

 <span data-ttu-id="e779b-361">Le nombre d'activités dans la définition de workflow augmente nettement avec chaque niveau de profondeur.</span><span class="sxs-lookup"><span data-stu-id="e779b-361">The number of activities in the workflow definition increases sharply with each depth level.</span></span>  <span data-ttu-id="e779b-362">Toutefois, un seul chemin par point de décision est exécuté dans une instance de workflow donnée. Par conséquent, seul un petit sous-ensemble des activités réelles est exécuté.</span><span class="sxs-lookup"><span data-stu-id="e779b-362">But only one path per decision point is executed in a given workflow instance, so only a small subset of the actual activities are executed.</span></span>

 ![Organigramme du flux de travail du débit complexe](./media/performance/complex-workflow-throughput-workflow.gif)

 <span data-ttu-id="e779b-364">Un workflow équivalent a été créé pour WF3.</span><span class="sxs-lookup"><span data-stu-id="e779b-364">An equivalent workflow was created for WF3.</span></span> <span data-ttu-id="e779b-365">Le concepteur de WF3 montre l'intégralité du workflow dans la zone de conception au lieu de l'imbriquer, et il est donc trop volumineux pour s'afficher dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="e779b-365">The WF3 designer shows the entire workflow in the design area instead of nesting, therefore it is too big to display in this topic.</span></span> <span data-ttu-id="e779b-366">Un extrait du workflow est présenté ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="e779b-366">A snippet of the workflow is shown below.</span></span>

 ![Extrait de l’organigramme du flux de travail WF3](./media/performance/wf3-workflow-snippet.gif)

 <span data-ttu-id="e779b-368">Pour effectuer l'imbrication dans un cas extrême, un autre workflow inclus dans ce test utilise 100 séquences imbriquées.</span><span class="sxs-lookup"><span data-stu-id="e779b-368">To exercise nesting in an extreme case, another workflow that is part of this test uses 100 nested sequences.</span></span>  <span data-ttu-id="e779b-369">La séquence la plus profonde contient une activité `Comment` ou <xref:System.Workflow.Activities.CodeActivity> unique.</span><span class="sxs-lookup"><span data-stu-id="e779b-369">In the innermost sequence is a single `Comment` or <xref:System.Workflow.Activities.CodeActivity>.</span></span>

 ![Organigramme d’une séquence imbriquée](./media/performance/nested-sequence-workflow.gif)

 <span data-ttu-id="e779b-371">Le suivi et la persistance ne sont pas utilisés dans ce test.</span><span class="sxs-lookup"><span data-stu-id="e779b-371">Tracking and persistence are not used as part of this test.</span></span>

### <a name="test-results"></a><span data-ttu-id="e779b-372">Résultats du test</span><span class="sxs-lookup"><span data-stu-id="e779b-372">Test Results</span></span>
 ![Histogramme présentant les résultats des performances de débit](./media/performance/throughput-performance-results.gif)

 <span data-ttu-id="e779b-374">Même dans le cas de workflows complexes avec de nombreux niveaux de profondeur et un grand nombre d'activités, les résultats des performances sont cohérents avec d'autres nombres de débit indiqués plus haut dans cet article.</span><span class="sxs-lookup"><span data-stu-id="e779b-374">Even with complex workflows with lots of depth and a high number of activities, the performance results are consistent with other throughput numbers shown earlier in this article.</span></span>  <span data-ttu-id="e779b-375">Le débit de WF4 est beaucoup plus rapide et doit être comparé sur une échelle logarithmique.</span><span class="sxs-lookup"><span data-stu-id="e779b-375">WF4’s throughput is orders of magnitude faster and has to be compared on a logarithmic scale.</span></span>

### <a name="memory"></a><span data-ttu-id="e779b-376">Mémoire</span><span class="sxs-lookup"><span data-stu-id="e779b-376">Memory</span></span>
 <span data-ttu-id="e779b-377">La charge mémoire de Windows Workflow Foundation est mesurée dans deux domaines clés : complexité de workflow et nombre de définitions de workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-377">The memory overhead of Windows Workflow Foundation is measured in two key areas: workflow complexity and number of workflow definitions.</span></span>  <span data-ttu-id="e779b-378">Les mesures de mémoire proviennent d'une station de travail Windows 7 64 bits.</span><span class="sxs-lookup"><span data-stu-id="e779b-378">Memory measurements were taken on a Windows 7 64-bit workstation.</span></span>  <span data-ttu-id="e779b-379">Il existe de nombreuses façons d’obtenir la mesure de la taille de la plage de travail, telles que la surveillance des compteurs de performances, l’interrogation de l’environnement. la plage de travail ou l’utilisation d’un outil tel que VMMap disponible à partir de [VMMap](/sysinternals/downloads/vmmap).</span><span class="sxs-lookup"><span data-stu-id="e779b-379">There are many ways to obtain the measurement of working set size such as monitoring performance counters, polling Environment.WorkingSet, or using a tool like VMMap available from [VMMap](/sysinternals/downloads/vmmap).</span></span> <span data-ttu-id="e779b-380">Une combinaison de méthodes a été utilisée pour obtenir et vérifier les résultats de chaque test.</span><span class="sxs-lookup"><span data-stu-id="e779b-380">A combination of methods was used to obtain and verify the results of each test.</span></span>

### <a name="workflow-complexity-test"></a><span data-ttu-id="e779b-381">Test de complexité de workflow</span><span class="sxs-lookup"><span data-stu-id="e779b-381">Workflow Complexity Test</span></span>
 <span data-ttu-id="e779b-382">Les test de complexité de workflow mesure la différence du jeu de travail en fonction de la complexité du workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-382">The workflow complexity test measures the working set difference based on the complexity of the workflow.</span></span>  <span data-ttu-id="e779b-383">Outre les workflows complexes utilisés dans la section précédente, de nouvelles variations sont ajoutées pour couvrir deux cas de base : un workflow à activité unique et une séquence avec 1 000 activités.</span><span class="sxs-lookup"><span data-stu-id="e779b-383">In addition to the complex workflows used in the previous section, new variations are added to cover two basic cases: a single activity workflow and a sequence with 1000 activities.</span></span>  <span data-ttu-id="e779b-384">Pour ces tests, les workflows sont initialisés et exécutés jusqu'à la fin dans une boucle sérielle unique pour une période d'une minute.</span><span class="sxs-lookup"><span data-stu-id="e779b-384">For these tests the workflows are initialized and executed to completion in a single serial loop for a period of one minute.</span></span>  <span data-ttu-id="e779b-385">Chaque variation de test est exécutée trois fois et les données enregistrées correspondent à la moyenne de ces trois exécutions.</span><span class="sxs-lookup"><span data-stu-id="e779b-385">Each test variation is run three times and the data recorded is the average of those three runs.</span></span>

 <span data-ttu-id="e779b-386">Les workflows des deux nouveaux tests de base ressemblent à ceux-ci :</span><span class="sxs-lookup"><span data-stu-id="e779b-386">The two new basic tests have workflows that look like those shown below:</span></span>

 ![Flux de travail complexe pour WF3 et WF4](./media/performance/complex-workflow-wf3-wf4.gif)

 <span data-ttu-id="e779b-388">Dans le workflow WF3 représenté ci-dessus, des activités <xref:System.Workflow.Activities.CodeActivity> vides sont utilisées.</span><span class="sxs-lookup"><span data-stu-id="e779b-388">In the WF3 workflow shown above, empty <xref:System.Workflow.Activities.CodeActivity> activities are used.</span></span>  <span data-ttu-id="e779b-389">Le workflow WF4 ci-dessus utilise des activités `Comment`.</span><span class="sxs-lookup"><span data-stu-id="e779b-389">The WF4 workflow above uses `Comment` activities.</span></span>  <span data-ttu-id="e779b-390">L'activité `Comment` a été décrite dans la section « Comparaisons des performances au niveau des composants » plus haut dans cet article.</span><span class="sxs-lookup"><span data-stu-id="e779b-390">The `Comment` activity was described in the Component-level Performance Comparisons section earlier in this article.</span></span>

 ![Histogramme présentant l’utilisation de mémoire de flux de travail complexe pour les flux de travail WF3 et WF4](./media/performance/complex-memory-usage-wf3-wf4.gif)

 <span data-ttu-id="e779b-392">Une des tendances nettes à noter dans ce graphique est que l'imbrication a un impact relativement minime sur l'utilisation de la mémoire dans WF3 et WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-392">One of the clear trends to notice in this graph is that nesting has relatively minimal impact on memory usage in both WF3 and WF4.</span></span>  <span data-ttu-id="e779b-393">L'impact le plus important sur la mémoire vient du nombre d'activités dans un workflow donné.</span><span class="sxs-lookup"><span data-stu-id="e779b-393">The most significant memory impact comes from the number of activities in a given workflow.</span></span>  <span data-ttu-id="e779b-394">Compte tenu des données de la séquence 1000, les variations de la séquence 5 de profondeur 5 complexe et de la séquence 1 de profondeur 7 complexe, il est clair que lorsque le nombre d'activités se compte en milliers, l'augmentation de l'utilisation de la mémoire devient plus notable.</span><span class="sxs-lookup"><span data-stu-id="e779b-394">Given the data from the sequence 1000, complex depth 5 sequence 5, and complex depth 7 sequence 1 variations, it is clear that as the number of activities enters the thousands, the memory usage increase becomes more noticeable.</span></span>  <span data-ttu-id="e779b-395">Dans le cas extrême (séquence 1 de profondeur 7) qui contient environ 29 000 activités, WF4 utilise presque 79 % moins de mémoire que WF3.</span><span class="sxs-lookup"><span data-stu-id="e779b-395">In the extreme case (depth 7 sequence 1) where there are ~29K activities, WF4 is using almost 79% less memory than WF3.</span></span>

### <a name="multiple-workflow-definitions-test"></a><span data-ttu-id="e779b-396">Test de plusieurs définitions de workflow</span><span class="sxs-lookup"><span data-stu-id="e779b-396">Multiple Workflow Definitions Test</span></span>
 <span data-ttu-id="e779b-397">La mesure de la mémoire par définition de workflow fait l'objet de deux tests différents à cause des options disponibles pour l'hébergement de workflows dans WF3 et WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-397">Measuring memory per workflow definition is divided into two different tests because of the available options for hosting workflows in WF3 and WF4.</span></span>  <span data-ttu-id="e779b-398">Les tests sont exécutés de manière différente du test de complexité de workflow en ceci qu'un workflow donné est instancié et exécuté seulement une fois par définition.</span><span class="sxs-lookup"><span data-stu-id="e779b-398">The tests are run in a different manner than the workflow complexity test in that a given workflow is instanced and executed only once per definition.</span></span>  <span data-ttu-id="e779b-399">Ceci est dû au fait que la définition de workflow et son hôte restent en mémoire pour la durée de vie de l'AppDomain.</span><span class="sxs-lookup"><span data-stu-id="e779b-399">This is because the workflow definition and its host remain in memory for the lifetime of the AppDomain.</span></span>  <span data-ttu-id="e779b-400">La mémoire utilisée pour l'exécution d'une instance de workflow donnée doit être nettoyée lors de l'opération garbage collection.</span><span class="sxs-lookup"><span data-stu-id="e779b-400">The memory used by running a given workflow instance should be cleaned up during garbage collection.</span></span>  <span data-ttu-id="e779b-401">Les conseils de migration pour WF4 contiennent des informations plus détaillées sur les options d'hébergement.</span><span class="sxs-lookup"><span data-stu-id="e779b-401">The migration guidance for WF4 contains more detailed information on the hosting options.</span></span> <span data-ttu-id="e779b-402">Pour plus d’informations, consultez livre de recettes sur la [migration WF : Hébergement de workflow](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="e779b-402">For more information, see [WF Migration Cookbook: Workflow Hosting](migration-guidance.md).</span></span>

 <span data-ttu-id="e779b-403">Plusieurs méthodes permettent de créer de nombreuses définitions de workflow pour un test de définition de workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-403">Creating many workflow definitions for a workflow definition test can be done in several ways.</span></span>  <span data-ttu-id="e779b-404">Par exemple, la génération de code permet de créer 1000 workflows identiques, sauf en ce qui concerne leurs noms et d'enregistrer chaque workflow dans un fichier distinct.</span><span class="sxs-lookup"><span data-stu-id="e779b-404">For instance, one could use code generation to create a set of 1000 workflows that are identical except in name and save each of those workflows into separate files.</span></span>  <span data-ttu-id="e779b-405">Cette approche a été choisie pour le test hébergé sur console.</span><span class="sxs-lookup"><span data-stu-id="e779b-405">This approach was taken for the console-hosted test.</span></span>  <span data-ttu-id="e779b-406">Dans WF3, la classe <xref:System.Workflow.Runtime.WorkflowRuntime> a été utilisée pour exécuter les définitions de workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-406">In WF3, the <xref:System.Workflow.Runtime.WorkflowRuntime> class was used to run the workflow definitions.</span></span>  <span data-ttu-id="e779b-407">WF4 peut utiliser <xref:System.Activities.WorkflowApplication> pour créer une instance unique de workflow ou pour utiliser directement <xref:System.Activities.WorkflowInvoker> pour exécuter l'activité comme s'il s'agissait d'un appel de méthode.</span><span class="sxs-lookup"><span data-stu-id="e779b-407">WF4 can either use <xref:System.Activities.WorkflowApplication> to create a single workflow instance or directly use <xref:System.Activities.WorkflowInvoker> to run the activity as if it were a method call.</span></span>  <span data-ttu-id="e779b-408"><xref:System.Activities.WorkflowApplication> est l'hôte d'une instance de workflow unique et a une parité de fonctions plus proche de <xref:System.Workflow.Runtime.WorkflowRuntime> et a donc été utilisé dans ce test.</span><span class="sxs-lookup"><span data-stu-id="e779b-408"><xref:System.Activities.WorkflowApplication> is a host of a single workflow instance and has closer feature parity to <xref:System.Workflow.Runtime.WorkflowRuntime> so that was used in this test.</span></span>

 <span data-ttu-id="e779b-409">En cas d'hébergement de workflows dans IIS, il est possible d'utiliser un <xref:System.Web.Hosting.VirtualPathProvider> pour créer un nouveau <xref:System.ServiceModel.WorkflowServiceHost> au lieu de générer tous les fichiers XAMLX ou XOML.</span><span class="sxs-lookup"><span data-stu-id="e779b-409">When hosting workflows in IIS it is possible to use a <xref:System.Web.Hosting.VirtualPathProvider> to create a new <xref:System.ServiceModel.WorkflowServiceHost> instead of generating all of the XAMLX or XOML files.</span></span>  <span data-ttu-id="e779b-410">Le <xref:System.Web.Hosting.VirtualPathProvider> gère la requête entrante et répond avec un « fichier virtuel » qui peut être chargé à partir d’une base de données ou, dans ce cas, généré à la volée.</span><span class="sxs-lookup"><span data-stu-id="e779b-410">The <xref:System.Web.Hosting.VirtualPathProvider> handles the incoming request and responds with a "virtual file" that can be loaded from a database or, in this case, generated on the fly.</span></span>  <span data-ttu-id="e779b-411">Il n'est donc pas nécessaire de créer 1000 fichiers physiques.</span><span class="sxs-lookup"><span data-stu-id="e779b-411">It is therefore unnecessary to create 1000 physical files.</span></span>

 <span data-ttu-id="e779b-412">Les définitions de workflow utilisées dans ce test de console étaient des workflows séquentiels simples à activité unique.</span><span class="sxs-lookup"><span data-stu-id="e779b-412">The workflow definitions used in the console test were simple sequential workflows with a single activity.</span></span>  <span data-ttu-id="e779b-413">L'activité unique était une <xref:System.Workflow.Activities.CodeActivity> vide pour le cas WF3 et une activité `Comment` pour le cas WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-413">The single activity was an empty <xref:System.Workflow.Activities.CodeActivity> for the WF3 case and a `Comment` activity for the WF4 case.</span></span>  <span data-ttu-id="e779b-414">Le cas hébergé dans IIS utilisait des workflows qui commençaient lors de la réception d'un message et s'achevaient lors de l'envoi d'une réponse :</span><span class="sxs-lookup"><span data-stu-id="e779b-414">The IIS-hosted case used workflows that start on receiving a message and end on sending a reply:</span></span>

<span data-ttu-id="e779b-415">L’illustration suivante montre un flux de travail WF3 avec ReceiveActivity et un flux de travail WF4 avec un modèle de demande/réponse :</span><span class="sxs-lookup"><span data-stu-id="e779b-415">The following image shows a WF3 workflow with ReceiveActivity and a WF4 workflow with request/response pattern:</span></span>

 ![Services de flux de travail dans WF3 et WF4](./media/performance/workflow-receive-activity.gif)

 <span data-ttu-id="e779b-417">Le tableau suivant montre le delta dans la plage de travail entre une définition de workflow unique et les définitions 1001 :</span><span class="sxs-lookup"><span data-stu-id="e779b-417">The following table shows the delta in working set between a single workflow definition and 1001 definitions:</span></span>

|<span data-ttu-id="e779b-418">Options d'hébergement</span><span class="sxs-lookup"><span data-stu-id="e779b-418">Hosting Options</span></span>|<span data-ttu-id="e779b-419">Delta de jeu de travail WF3</span><span class="sxs-lookup"><span data-stu-id="e779b-419">WF3 Working Set Delta</span></span>|<span data-ttu-id="e779b-420">Delta de jeu de travail WF4</span><span class="sxs-lookup"><span data-stu-id="e779b-420">WF4 Working Set Delta</span></span>|
|---------------------|---------------------------|---------------------------|
|<span data-ttu-id="e779b-421">Workflows hébergés d'application console</span><span class="sxs-lookup"><span data-stu-id="e779b-421">Console Application Hosted Workflows</span></span>|<span data-ttu-id="e779b-422">18 MB</span><span class="sxs-lookup"><span data-stu-id="e779b-422">18 MB</span></span>|<span data-ttu-id="e779b-423">9 Mo</span><span class="sxs-lookup"><span data-stu-id="e779b-423">9 MB</span></span>|
|<span data-ttu-id="e779b-424">Services de workflow hébergés par IIS</span><span class="sxs-lookup"><span data-stu-id="e779b-424">IIS Hosted Workflow Services</span></span>|<span data-ttu-id="e779b-425">446 Mo</span><span class="sxs-lookup"><span data-stu-id="e779b-425">446 MB</span></span>|<span data-ttu-id="e779b-426">364 MB</span><span class="sxs-lookup"><span data-stu-id="e779b-426">364 MB</span></span>|

 <span data-ttu-id="e779b-427">L’hébergement de définitions de workflow dans IIS consomme beaucoup plus de mémoire en raison du <xref:System.ServiceModel.WorkflowServiceHost> , des artefacts de service WCF détaillés et de la logique de traitement de message associée à l’hôte.</span><span class="sxs-lookup"><span data-stu-id="e779b-427">Hosting workflow definitions in IIS consumes much more memory due to the <xref:System.ServiceModel.WorkflowServiceHost>, detailed WCF service artifacts, and the message processing logic associated with the host.</span></span>

 <span data-ttu-id="e779b-428">Pour l'hébergement sur console dans WF3 les workflows étaient implémentés dans le code plutôt que dans le format XOML.</span><span class="sxs-lookup"><span data-stu-id="e779b-428">For console hosting in WF3 the workflows were implemented in code instead of XOML.</span></span>  <span data-ttu-id="e779b-429">Dans WF4, XAML est utilisé par défaut.</span><span class="sxs-lookup"><span data-stu-id="e779b-429">In WF4 the default is to use XAML.</span></span>  <span data-ttu-id="e779b-430">Le XAML est stocké en tant que ressource incorporée dans l'assembly et compilé pendant l'exécution afin de fournir l'implémentation du workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-430">The XAML is stored as an embedded resource in the assembly and compiled during runtime to provide the implementation of the workflow.</span></span>  <span data-ttu-id="e779b-431">Une charge mémoire est associée à ce processus.</span><span class="sxs-lookup"><span data-stu-id="e779b-431">There is some overhead associated with this process.</span></span>  <span data-ttu-id="e779b-432">Pour une comparaison équitable entre WF3 et WF4, des workflows codés ont été utilisés au lieu de worflows XAML.</span><span class="sxs-lookup"><span data-stu-id="e779b-432">In order to make a fair comparison between WF3 and WF4, coded workflows were used instead of XAML.</span></span>  <span data-ttu-id="e779b-433">Un exemple d'un des workflows WF4 vous est proposé ci-après.</span><span class="sxs-lookup"><span data-stu-id="e779b-433">An example of one of the WF4 workflows is shown below:</span></span>

```csharp
public class Workflow1 : Activity
{
    protected override Func<Activity> Implementation
    {
        get
        {
            return new Func<Activity>(() =>
            {
                return new Sequence
                {
                    Activities = {
                        new Comment()
                    }
                };
            });
        }
        set
        {
            base.Implementation = value;
        }
    }
}
```

 <span data-ttu-id="e779b-434">Beaucoup d'autres facteurs peuvent affecter la consommation de mémoire.</span><span class="sxs-lookup"><span data-stu-id="e779b-434">There are many other factors that can affect memory consumption.</span></span> <span data-ttu-id="e779b-435">Le même conseil pour tous les programmes gérés est toujours applicable.</span><span class="sxs-lookup"><span data-stu-id="e779b-435">The same advice for all managed programs still applies.</span></span>  <span data-ttu-id="e779b-436">Dans les environnements hébergés par IIS, l'objet <xref:System.ServiceModel.WorkflowServiceHost> créé pour une définition de workflow reste en mémoire jusqu'à ce que le pool d'application soit recyclé.</span><span class="sxs-lookup"><span data-stu-id="e779b-436">In IIS-hosted environments, the <xref:System.ServiceModel.WorkflowServiceHost> object created for a workflow definition stays in memory until the application pool is recycled.</span></span>  <span data-ttu-id="e779b-437">Il ne faut pas l'oublier lors de l'écriture d'extensions.</span><span class="sxs-lookup"><span data-stu-id="e779b-437">This should be kept in mind when writing extensions.</span></span>  <span data-ttu-id="e779b-438">En outre, il est préférable d’éviter les variables « globales » (variables étendues à l’ensemble du flux de travail) et de limiter l’étendue des variables dans la mesure du possible.</span><span class="sxs-lookup"><span data-stu-id="e779b-438">Also, it is best to avoid "global" variables (variables scoped to the whole workflow) and limit the scope of variables wherever possible.</span></span>

## <a name="workflow-runtime-services"></a><span data-ttu-id="e779b-439">Services d'exécution de workflow</span><span class="sxs-lookup"><span data-stu-id="e779b-439">Workflow Runtime Services</span></span>

### <a name="persistence"></a><span data-ttu-id="e779b-440">Persistance</span><span class="sxs-lookup"><span data-stu-id="e779b-440">Persistence</span></span>
 <span data-ttu-id="e779b-441">WF3 et WF4 sont fournis avec un fournisseur de persistance SQL.</span><span class="sxs-lookup"><span data-stu-id="e779b-441">WF3 and WF4 both ship with a SQL persistence provider.</span></span>  <span data-ttu-id="e779b-442">Le fournisseur de persistance SQL de WF3 est une implémentation simple qui sérialise l'instance de workflow et la stocke dans un blob.</span><span class="sxs-lookup"><span data-stu-id="e779b-442">The WF3 SQL persistence provider is a simple implementation that serializes the workflow instance and stores it in a blob.</span></span>  <span data-ttu-id="e779b-443">Pour cette raison, les performances de ce fournisseur dépendent fortement de la taille de l'instance de workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-443">For this reason, the performance of this provider depends heavily on the size of the workflow instance.</span></span>  <span data-ttu-id="e779b-444">Dans WF3, la taille de l'instance pouvait augmenter pour de nombreuses raisons, comme indiqué précédemment dans cet article.</span><span class="sxs-lookup"><span data-stu-id="e779b-444">In WF3, the instance size could increase for many reasons, as is discussed previously in this paper.</span></span>  <span data-ttu-id="e779b-445">De nombreux clients choisissent de ne pas utiliser le fournisseur de persistance SQL par défaut, car le stockage d'une instance sérialisée dans une base de données ne donne aucune visibilité sur l'état du workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-445">Many customers choose not to use the default SQL persistence provider because storing a serialized instance in a database gives no visibility into the state of the workflow.</span></span>  <span data-ttu-id="e779b-446">Pour trouver un workflow particulier sans connaître son ID, il faudrait désérialiser chaque instance persistante et examiner son contenu.</span><span class="sxs-lookup"><span data-stu-id="e779b-446">In order to find a particular workflow without knowing the workflow id, one would have to deserialize each persisted instance and examine the contents.</span></span>  <span data-ttu-id="e779b-447">Beaucoup de développeurs préfèrent écrire leurs propres fournisseurs de persistance afin de surmonter cet obstacle.</span><span class="sxs-lookup"><span data-stu-id="e779b-447">Many developers prefer to write their own persistence providers to overcome this obstacle.</span></span>

 <span data-ttu-id="e779b-448">Le fournisseur de persistance SQL de WF4 SQL a tenté de régler ces problèmes.</span><span class="sxs-lookup"><span data-stu-id="e779b-448">The WF4 SQL persistence provider has tried to address some of these concerns.</span></span>  <span data-ttu-id="e779b-449">Les tables de persistance exposent des informations telles que les signets actifs et les propriétés pouvant être promues.</span><span class="sxs-lookup"><span data-stu-id="e779b-449">The persistence tables expose certain information such as the active bookmarks and promotable properties.</span></span>  <span data-ttu-id="e779b-450">La nouvelle fonctionnalité de corrélation basée sur le contenu de WF4 ne fonctionnerait pas correctement avec l’approche de persistance SQL de WF3, qui a entraîné des modifications dans l’organisation de l’instance de workflow persistante.</span><span class="sxs-lookup"><span data-stu-id="e779b-450">The new content-based correlation feature in WF4 would not perform well using the WF3 SQL persistence approach, which has driven some change in the organization of the persisted workflow instance.</span></span>  <span data-ttu-id="e779b-451">Cela rend le travail du fournisseur de persistance plus complexe et augmente le stress sur la base de données.</span><span class="sxs-lookup"><span data-stu-id="e779b-451">This makes the job of the persistence provider more complex and puts extra stress on the database.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="e779b-452">Configuration de l’environnement</span><span class="sxs-lookup"><span data-stu-id="e779b-452">Environment Setup</span></span>
![Configuration de l’environnement pour le test des performances de workflow](./media/performance/performance-test-environment.gif)

### <a name="test-setup"></a><span data-ttu-id="e779b-454">Configuration du test</span><span class="sxs-lookup"><span data-stu-id="e779b-454">Test Setup</span></span>
 <span data-ttu-id="e779b-455">Même avec un jeu de fonctionnalités amélioré et une meilleure gestion d’accès concurrentiel, le fournisseur de persistance SQL de WF4 est plus rapide que celui de WF3.</span><span class="sxs-lookup"><span data-stu-id="e779b-455">Even with an improved feature set and better concurrency handling, the SQL persistence provider in WF4 is faster than the provider in WF3.</span></span>  <span data-ttu-id="e779b-456">Pour illustrer cela, deux workflows qui exécutent des opérations identiques pour l'essentiel dans WF3 et WF4 sont comparés ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="e779b-456">To showcase this, two workflows that perform essentially the same operations in WF3 and WF4 are compared below.</span></span>

 ![Workflow de persistance dans WF3 à gauche et WF4 à droite](./media/performance/persist-workflow-wf3-wf4.gif)

 <span data-ttu-id="e779b-458">Les deux workflows sont créés par un message reçu.</span><span class="sxs-lookup"><span data-stu-id="e779b-458">The two workflows are both created by a received message.</span></span>  <span data-ttu-id="e779b-459">Une fois la réponse initiale envoyée, le workflow est persistant.</span><span class="sxs-lookup"><span data-stu-id="e779b-459">After sending an initial reply, the workflow is persisted.</span></span>  <span data-ttu-id="e779b-460">Dans le cas de WF3, une <xref:System.Workflow.ComponentModel.TransactionScopeActivity> vide est utilisée pour initier la persistance.</span><span class="sxs-lookup"><span data-stu-id="e779b-460">In the WF3 case, an empty <xref:System.Workflow.ComponentModel.TransactionScopeActivity> is used to initiate the persistence.</span></span>  <span data-ttu-id="e779b-461">La même opération peut être effectuée dans WF3 en marquant une activité comme « persister lors de la fermeture ».</span><span class="sxs-lookup"><span data-stu-id="e779b-461">The same could be achieved in WF3 by marking an activity as "persist on close."</span></span>  <span data-ttu-id="e779b-462">Un second message corrélé termine le workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-462">A second, correlated message completes the workflow.</span></span>  <span data-ttu-id="e779b-463">Les workflows sont persistants mais pas déchargés.</span><span class="sxs-lookup"><span data-stu-id="e779b-463">The workflows are persisted but not unloaded.</span></span>

### <a name="test-results"></a><span data-ttu-id="e779b-464">Résultats du test</span><span class="sxs-lookup"><span data-stu-id="e779b-464">Test Results</span></span>
 ![Histogramme présentant la persistance du débit](./media/performance/throughput-persistence-graph.gif)

 <span data-ttu-id="e779b-466">Lorsque le transport entre le client et le niveau intermédiaire est HTTP, la persistance dans WF4 présente une amélioration de 2,6 fois.</span><span class="sxs-lookup"><span data-stu-id="e779b-466">When the transport between client and middle tier is HTTP, persistence in WF4 shows an improvement of 2.6 times.</span></span>  <span data-ttu-id="e779b-467">Avec le transport TCP, ce facteur est de 3 fois.</span><span class="sxs-lookup"><span data-stu-id="e779b-467">The TCP transport increases that factor to 3.0 times.</span></span>  <span data-ttu-id="e779b-468">Dans tous le cas, l'utilisation de l'UC sur le niveau intermédiaire est de 98 % ou supérieure.</span><span class="sxs-lookup"><span data-stu-id="e779b-468">In all cases, CPU utilization on the middle tier is 98% or higher.</span></span>  <span data-ttu-id="e779b-469">Le débit est plus élevé dans WF4 à cause du runtime de workflow plus rapide.</span><span class="sxs-lookup"><span data-stu-id="e779b-469">The reason that WF4 throughput is greater is due to the faster workflow runtime.</span></span>  <span data-ttu-id="e779b-470">La taille de l'instance sérialisée est petite dans les deux cas et n'est pas un élément contributif majeur dans cette situation.</span><span class="sxs-lookup"><span data-stu-id="e779b-470">The size of the serialized instance is low for both cases and is not a major contributing element in this situation.</span></span>

 <span data-ttu-id="e779b-471">Les workflows WF3 et WF4 de ce test utilisent une activité pour indiquer explicitement quand la persistance doit avoir lieu.</span><span class="sxs-lookup"><span data-stu-id="e779b-471">Both the WF3 and WF4 workflows in this test use an activity to explicitly indicate when persistence should occur.</span></span>  <span data-ttu-id="e779b-472">Cela a pour avantage de faire persister le workflow sans le décharger.</span><span class="sxs-lookup"><span data-stu-id="e779b-472">This has the benefit of persisting the workflow without unloading it.</span></span>  <span data-ttu-id="e779b-473">Dans WF3, il est également possible de le faire persister à l'aide de la fonctionnalité <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A>, mais cela décharge l'instance de workflow de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="e779b-473">In WF3, it is also possible to persist using the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> feature, but this unloads the workflow instance from memory.</span></span>  <span data-ttu-id="e779b-474">Si un développeur utilisant WF3 veut s'assurer qu'un workflow persiste à certains points, il doit modifier la définition du workflow ou payer le coût du déchargement et du rechargement de l'instance de workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-474">If a developer using WF3 wants to make sure a workflow persists at certain points, they either have to alter the workflow definition or pay the cost for unloading and re-loading the workflow instance.</span></span>  <span data-ttu-id="e779b-475">Une nouvelle fonctionnalité de WF4 permet la persistance sans déchargement : <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span><span class="sxs-lookup"><span data-stu-id="e779b-475">A new feature in WF4 makes it possible to persist without unloading: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span></span>  <span data-ttu-id="e779b-476">Cette fonctionnalité permet de faire persister l’instance de workflow en cas de période d’inactivité, mais de la conserver dans la mémoire jusqu’à ce que le seuil de <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> soit atteint ou que l’exécution reprenne.</span><span class="sxs-lookup"><span data-stu-id="e779b-476">This feature allows the workflow instance to be persisted on idle but stay in memory until the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> threshold is met or execution is resumed.</span></span>

 <span data-ttu-id="e779b-477">Notez que le fournisseur de persistance SQL de WF4 effectue davantage de travail dans la couche de base de données.</span><span class="sxs-lookup"><span data-stu-id="e779b-477">Note that the WF4 SQL persistence provider performs more work in the database tier.</span></span>  <span data-ttu-id="e779b-478">La base de données SQL peut se transformer en goulot d'étranglement, il est donc important de surveiller l'utilisation du processeur et du disque à cet endroit.</span><span class="sxs-lookup"><span data-stu-id="e779b-478">The SQL database can become a bottleneck so it is important to monitor the CPU and disk usage there.</span></span>  <span data-ttu-id="e779b-479">Assurez-vous d’inclure les compteurs de performance suivants de la base de données SQL lors d’un test de performance des applications de workflow :</span><span class="sxs-lookup"><span data-stu-id="e779b-479">Be sure to include the following performance counters from the SQL database when performance testing workflow applications:</span></span>

- <span data-ttu-id="e779b-480">Disque physique \\ % temps de lecture du disque</span><span class="sxs-lookup"><span data-stu-id="e779b-480">PhysicalDisk\\%Disk Read Time</span></span>

- <span data-ttu-id="e779b-481">Disque physique \\ % temps du disque</span><span class="sxs-lookup"><span data-stu-id="e779b-481">PhysicalDisk\\% Disk Time</span></span>

- <span data-ttu-id="e779b-482">PhysicalDisk \\ pourcentage du temps d’écriture sur le disque</span><span class="sxs-lookup"><span data-stu-id="e779b-482">PhysicalDisk\\% Disk Write Time</span></span>

- <span data-ttu-id="e779b-483">\\Disque physique% longueur moyenne de la file d’attente du disque</span><span class="sxs-lookup"><span data-stu-id="e779b-483">PhysicalDisk\\% Avg. Disk Queue Length</span></span>

- <span data-ttu-id="e779b-484">Longueur de la file d’attente de lecture du disque disque physique\Moyenne</span><span class="sxs-lookup"><span data-stu-id="e779b-484">PhysicalDisk\Avg. Disk Read Queue Length</span></span>

- <span data-ttu-id="e779b-485">Longueur de la file d’attente d’écriture du disque disque physique\Moyenne</span><span class="sxs-lookup"><span data-stu-id="e779b-485">PhysicalDisk\Avg. Disk Write Queue Length</span></span>

- <span data-ttu-id="e779b-486">PhysicalDisk\Longueur actuelle de la file d'attente du disque</span><span class="sxs-lookup"><span data-stu-id="e779b-486">PhysicalDisk\Current Disk Queue Length</span></span>

- <span data-ttu-id="e779b-487">Informations processeur- \\ pourcentage de temps processeur</span><span class="sxs-lookup"><span data-stu-id="e779b-487">Processor Information\\% Processor Time</span></span>

- <span data-ttu-id="e779b-488">SQLServer : Verrous internes\Durée d'attente moyenne d'un verrou interne (ms)</span><span class="sxs-lookup"><span data-stu-id="e779b-488">SQLServer:Latches\Average Latch Wait Time (ms)</span></span>

- <span data-ttu-id="e779b-489">SQLServer : Verrous internes\Attentes de verrous NP internes/s</span><span class="sxs-lookup"><span data-stu-id="e779b-489">SQLServer:Latches\Latch Waits/sec</span></span>

### <a name="tracking"></a><span data-ttu-id="e779b-490">Suivi</span><span class="sxs-lookup"><span data-stu-id="e779b-490">Tracking</span></span>
 <span data-ttu-id="e779b-491">Le suivi de workflow permet de suivre la progression d'un workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-491">Workflow tracking can be used to track the progress of a workflow.</span></span>  <span data-ttu-id="e779b-492">Les informations incluses dans les événements de suivi sont déterminées par un modèle de suivi.</span><span class="sxs-lookup"><span data-stu-id="e779b-492">The information that is included in the tracking events is determined by a tracking profile.</span></span>  <span data-ttu-id="e779b-493">Plus le modèle de suivi est complexe, plus cette opération est coûteuse.</span><span class="sxs-lookup"><span data-stu-id="e779b-493">The more complex the tracking profile, the more expensive tracking becomes.</span></span>

 <span data-ttu-id="e779b-494">WF3 était fourni avec un service de suivi SQL.</span><span class="sxs-lookup"><span data-stu-id="e779b-494">WF3 shipped with a SQL-based tracking service.</span></span>  <span data-ttu-id="e779b-495">Ce service fonctionnait en mode batch et non-batch.</span><span class="sxs-lookup"><span data-stu-id="e779b-495">This service could work in batched and non-batched modes.</span></span>  <span data-ttu-id="e779b-496">En mode non-batch, les événements de suivi sont écrits directement dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="e779b-496">In non-batched mode, tracking events are written directly to the database.</span></span>  <span data-ttu-id="e779b-497">En mode batch, les événements de suivi sont regroupés dans le même lot que l'état de l'instance de workflow.</span><span class="sxs-lookup"><span data-stu-id="e779b-497">In batched mode, tracking events are collected into the same batch as the workflow instance state.</span></span>  <span data-ttu-id="e779b-498">Le mode batch offre les meilleures performances pour l'éventail de conceptions de workflow le plus large.</span><span class="sxs-lookup"><span data-stu-id="e779b-498">The batched mode has the best performance for the widest range of workflow designs.</span></span>  <span data-ttu-id="e779b-499">Toutefois, le traitement par lots peut avoir un impact négatif sur les performances si le workflow exécute de nombreuses activités sans persistance et que ces activités sont suivies.</span><span class="sxs-lookup"><span data-stu-id="e779b-499">However, batching can have a negative performance impact if the workflow runs many activities without persisting and those activities are tracked.</span></span>  <span data-ttu-id="e779b-500">Cela se produit généralement dans les boucles et la meilleure façon d'éviter ce scénario consiste à concevoir de grandes boucles pour contenir un point de persistance.</span><span class="sxs-lookup"><span data-stu-id="e779b-500">This would commonly happen in loops and the best way to avoid this scenario is to design large loops to contain a persistence point.</span></span>  <span data-ttu-id="e779b-501">L'introduction d'un point de persistance dans une boucle peut également avoir un impact négatif sur les performances. Il est donc important de mesurer les coûts de chaque élément et d'atteindre un équilibre.</span><span class="sxs-lookup"><span data-stu-id="e779b-501">Introducing a persistence point into a loop can negatively affect performance as well so it is important to measure the costs of each and come up with a balance.</span></span>

 <span data-ttu-id="e779b-502">WF4 n'est pas fourni avec un service de suivi SQL.</span><span class="sxs-lookup"><span data-stu-id="e779b-502">WF4 is not shipped with a SQL tracking service.</span></span>  <span data-ttu-id="e779b-503">L’enregistrement des informations de suivi dans une base de données SQL peut être mieux géré à partir d’un serveur d’applications plutôt que dans le .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="e779b-503">Recording tracking information to a SQL database can be handled better from an application server rather than built into the .NET Framework.</span></span> <span data-ttu-id="e779b-504">Par conséquent, le suivi SQL est désormais géré par AppFabric.</span><span class="sxs-lookup"><span data-stu-id="e779b-504">Therefore SQL tracking is now handled by AppFabric.</span></span>  <span data-ttu-id="e779b-505">Le fournisseur de suivi prédéfini de WF4 est basé sur ETW (suivi d'événements Windows).</span><span class="sxs-lookup"><span data-stu-id="e779b-505">The out-of-the-box tracking provider in WF4 is based on Event Tracing for Windows (ETW).</span></span>

 <span data-ttu-id="e779b-506">ETW est un système d'événement de niveau noyau à faible latence intégré à Windows.</span><span class="sxs-lookup"><span data-stu-id="e779b-506">ETW is a kernel-level, low-latency event system built into Windows.</span></span>  <span data-ttu-id="e779b-507">Il utilise un modèle fournisseur/consommateur qui permet d'encourir la pénalité liée au suivi d'événements seulement lorsqu'il y a réellement un consommateur.</span><span class="sxs-lookup"><span data-stu-id="e779b-507">It uses a provider/consumer model that makes it possible to only incur the penalty for event tracing when there is actually a consumer.</span></span>  <span data-ttu-id="e779b-508">Outre les événements de noyau tels que l'utilisation du processeur, du disque, de la mémoire et du réseau, de nombreuses applications tirent également parti d'ETW.</span><span class="sxs-lookup"><span data-stu-id="e779b-508">In addition to kernel events such as processor, disk, memory, and network usage, many applications leverage ETW as well.</span></span>  <span data-ttu-id="e779b-509">Les événements ETW sont plus puissants que les compteurs de performance en ceci que les événements peuvent être personnalisés pour l'application.</span><span class="sxs-lookup"><span data-stu-id="e779b-509">ETW events are more powerful than performance counters in that events can be customized to the application.</span></span>  <span data-ttu-id="e779b-510">Un événement peut contenir du texte tel qu'un ID de workflow ou un message d'information.</span><span class="sxs-lookup"><span data-stu-id="e779b-510">An event can contain text such as a workflow ID or an informational message.</span></span>  <span data-ttu-id="e779b-511">En outre, les événements sont classés à l'aide de masque de bits, de sorte que l'utilisation d'un sous-ensemble d'événements donné aura moins d'impact sur les performances que la capture de tous les événements.</span><span class="sxs-lookup"><span data-stu-id="e779b-511">Also, events are categorized with bitmasks so that consuming a certain subset of events will have less performance impact than capturing all events.</span></span>

 <span data-ttu-id="e779b-512">Les avantages de l'utilisation d'ETW pour le suivi au lieu de SQL sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="e779b-512">Benefits to the approach of using ETW for tracking instead of SQL include:</span></span>

- <span data-ttu-id="e779b-513">La collection d’événements de suivi peut être séparée dans un processus distinct.</span><span class="sxs-lookup"><span data-stu-id="e779b-513">Collection of tracking events can be separated to another process.</span></span>  <span data-ttu-id="e779b-514">Cela augmente la flexibilité de l'enregistrement des événements.</span><span class="sxs-lookup"><span data-stu-id="e779b-514">This gives greater flexibility in how the events are recorded.</span></span>

- <span data-ttu-id="e779b-515">Les événements de suivi ETW sont facilement combinés avec les événements ETW WCF ou d’autres fournisseurs ETW tels qu’un SQL Server ou un fournisseur de noyau.</span><span class="sxs-lookup"><span data-stu-id="e779b-515">ETW tracking events are easily combined with the WCF ETW events or other ETW providers such as a SQL Server or kernel provider.</span></span>

- <span data-ttu-id="e779b-516">Les auteurs de workflow n'ont pas besoin de modifier un workflow pour qu'il fonctionne mieux avec une implémentation de suivi particulière, telle que le mode batch du service de suivi SQL de WF3.</span><span class="sxs-lookup"><span data-stu-id="e779b-516">Workflow authors do not need to alter a workflow to work better with a particular tracking implementation, such as the WF3 SQL tracking service’s batch mode.</span></span>

- <span data-ttu-id="e779b-517">Un administrateur peut activer ou désactiver le suivi sans recycler le processus hôte.</span><span class="sxs-lookup"><span data-stu-id="e779b-517">An administrator can turn tracking on or off without recycling the host process.</span></span>

 <span data-ttu-id="e779b-518">Les avantages en matière de performances pour le suivi ETW s'accompagnent d'un inconvénient.</span><span class="sxs-lookup"><span data-stu-id="e779b-518">The performance benefits to ETW tracking come with a drawback.</span></span>  <span data-ttu-id="e779b-519">Les événements ETW peuvent être perdus si le système subit une pression intense sur les ressources.</span><span class="sxs-lookup"><span data-stu-id="e779b-519">ETW events can be lost if the system is under intense resource pressure.</span></span>  <span data-ttu-id="e779b-520">Le traitement des événements n'est pas destiné à bloquer l'exécution normale du programme et il n'est donc pas garanti que tous les événements ETW seront diffusés à leurs abonnés.</span><span class="sxs-lookup"><span data-stu-id="e779b-520">The processing of events is not meant to block normal program execution and therefore it is not guaranteed that all ETW events will be broadcast to their subscribers.</span></span>  <span data-ttu-id="e779b-521">Le suivi ETW est donc idéal pour le contrôle d'état, mais il n'est pas approprié pour l'audit.</span><span class="sxs-lookup"><span data-stu-id="e779b-521">This makes ETW tracking great for health monitoring but not suitable for auditing.</span></span>

 <span data-ttu-id="e779b-522">Contrairement à WF4, AppFabric est doté d'un fournisseur de suivi SQL.</span><span class="sxs-lookup"><span data-stu-id="e779b-522">While WF4 does not have a SQL tracking provider, AppFabric does.</span></span>  <span data-ttu-id="e779b-523">L'approche de suivi d'AppFabric consiste à s'abonner aux événements ETW à l'aide d'un service Windows qui traite les événements par lots et les écrit dans une table SQL conçue pour des insertions rapides.</span><span class="sxs-lookup"><span data-stu-id="e779b-523">AppFabric’s SQL tracking approach is to subscribe to ETW events with a Windows Service that batches the events and writes them to a SQL table designed for quick inserts.</span></span>  <span data-ttu-id="e779b-524">Un travail séparé extrait les données de cette table et les restitue dans des tables de rapports pouvant être affichées sur le tableau de bord AppFabric.</span><span class="sxs-lookup"><span data-stu-id="e779b-524">A separate job drains the data from this table and reforms it into reporting tables that can be viewed on the AppFabric dashboard.</span></span>  <span data-ttu-id="e779b-525">Cela signifie qu'un lot d'événements de suivi est traité indépendamment du workflow dont il provient et qu'il ne doit pas attendre un point de persistance pour être enregistré.</span><span class="sxs-lookup"><span data-stu-id="e779b-525">This means that a batch of tracking events is handled independent of the workflow it came from and therefore does not have to wait for a persistence point before being recorded.</span></span>

 <span data-ttu-id="e779b-526">Les événements ETW peuvent être enregistrés à l’aide d’outils tels que logman ou xperf.</span><span class="sxs-lookup"><span data-stu-id="e779b-526">ETW events can be recorded with tools such as logman or xperf.</span></span>  <span data-ttu-id="e779b-527">Le fichier ETL compact peut être affiché avec un outil tel que xperfview ou converti dans un format plus lisible, tel que XML, à l’aide de tracerpt.</span><span class="sxs-lookup"><span data-stu-id="e779b-527">The compact ETL file can be viewed with a tool like xperfview or converted to a more readable format, such as XML, with tracerpt.</span></span>  <span data-ttu-id="e779b-528">Dans WF3, la seule option permettant d'obtenir des événements de suivi sans base de données SQL consiste à créer un service de suivi personnalisé.</span><span class="sxs-lookup"><span data-stu-id="e779b-528">In WF3, the only option for getting tracking events without a SQL database is to create a custom tracking service.</span></span> <span data-ttu-id="e779b-529">Pour plus d’informations sur ETW, consultez [services WCF et suivi d’v nements pour Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) et [suivi d’événements-applications Windows](/windows/desktop/etw/event-tracing-portal).</span><span class="sxs-lookup"><span data-stu-id="e779b-529">For more information about ETW, see [WCF Services and Event Tracing for Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) and [Event Tracing - Windows applications](/windows/desktop/etw/event-tracing-portal).</span></span>

 <span data-ttu-id="e779b-530">L'activation du suivi de workflow affecte les performances à des degrés divers.</span><span class="sxs-lookup"><span data-stu-id="e779b-530">Enabling workflow tracking will impact performance in varying degrees.</span></span>  <span data-ttu-id="e779b-531">Le test d'évaluation ci-dessous emploie l'outil logman pour consommer les événements de suivi ETW et les enregistrer dans un fichier ETL.</span><span class="sxs-lookup"><span data-stu-id="e779b-531">The benchmark below uses the logman tool to consume the ETW tracking events and record them to an ETL file.</span></span>  <span data-ttu-id="e779b-532">Le coût du suivi SQL dans AppFabric n'est pas couvert dans cet article.</span><span class="sxs-lookup"><span data-stu-id="e779b-532">The cost of the SQL tracking in AppFabric is not in the scope of this article.</span></span>  <span data-ttu-id="e779b-533">Le modèle de suivi de base, également utilisé dans AppFabric, est décrit dans ce test d'évaluation.</span><span class="sxs-lookup"><span data-stu-id="e779b-533">The basic tracking profile, also used in AppFabric, is shown in this benchmark.</span></span>  <span data-ttu-id="e779b-534">Ce test inclut également le coût du suivi des événements de contrôle d'état uniquement.</span><span class="sxs-lookup"><span data-stu-id="e779b-534">Also included is the cost of tracking only health monitoring events.</span></span>  <span data-ttu-id="e779b-535">Ces événements sont utiles pour résoudre les problèmes et déterminer le débit moyen du système.</span><span class="sxs-lookup"><span data-stu-id="e779b-535">These events are useful for troubleshooting problems and determining the average throughput of the system.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="e779b-536">Configuration de l’environnement</span><span class="sxs-lookup"><span data-stu-id="e779b-536">Environment Setup</span></span>
 ![Configuration de l’environnement pour le test des performances de workflow](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="e779b-538">Résultats du test</span><span class="sxs-lookup"><span data-stu-id="e779b-538">Test Results</span></span>

 ![Histogramme présentant les coûts de suivi de flux de travail](./media/performance/workflow-tracking-costs.gif)

 <span data-ttu-id="e779b-540">Le contrôle d'état a un impact d'environ 3 % sur le débit.</span><span class="sxs-lookup"><span data-stu-id="e779b-540">Health monitoring has roughly a 3% impact on throughput.</span></span>  <span data-ttu-id="e779b-541">Le coût du modèle de base est d'environ 8 %.</span><span class="sxs-lookup"><span data-stu-id="e779b-541">The basic profile’s cost is around 8%.</span></span>

## <a name="interop"></a><span data-ttu-id="e779b-542">Interop</span><span class="sxs-lookup"><span data-stu-id="e779b-542">Interop</span></span>
 <span data-ttu-id="e779b-543">WF4 a été presque entièrement réécrit à partir de [!INCLUDE[wf1](../../../includes/wf1-md.md)], c'est pourquoi les workflows et les activités de WF3 ne sont pas directement compatibles avec WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-543">WF4 is almost a complete rewrite of [!INCLUDE[wf1](../../../includes/wf1-md.md)] and therefore WF3 workflows and activities are not directly compatible with WF4.</span></span>  <span data-ttu-id="e779b-544">De nombreux clients qui ont adopté Windows Workflow Foundation tôt auront des définitions de flux de travail internes ou tiers et des activités personnalisées pour WF3.</span><span class="sxs-lookup"><span data-stu-id="e779b-544">Many customers that adopted Windows Workflow Foundation early will have in-house or third-party workflow definitions and custom activities for WF3.</span></span>  <span data-ttu-id="e779b-545">Une façon de faciliter la transition vers WF4 consiste à utiliser l'activité Interop, qui peut exécuter des activités WF3 à partir d'un workflow WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-545">One way to ease the transition to WF4 is to use the Interop activity, which can execute WF3 activities from within a WF4 workflow.</span></span>  <span data-ttu-id="e779b-546">Il est recommandé d'utiliser l'activité <xref:System.Activities.Statements.Interop> seulement si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="e779b-546">It is recommended that the <xref:System.Activities.Statements.Interop> activity only be used when necessary.</span></span> <span data-ttu-id="e779b-547">Pour plus d’informations sur la migration vers WF4, consultez les [conseils de migration WF4](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="e779b-547">For more information about migrating to WF4 check out the [WF4 Migration Guidance](migration-guidance.md).</span></span>

### <a name="environment-setup"></a><span data-ttu-id="e779b-548">Configuration de l’environnement</span><span class="sxs-lookup"><span data-stu-id="e779b-548">Environment Setup</span></span>
 ![Configuration de l’environnement pour le test des performances de workflow](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="e779b-550">Résultats du test</span><span class="sxs-lookup"><span data-stu-id="e779b-550">Test Results</span></span>

<span data-ttu-id="e779b-551">Le tableau suivant présente les résultats de l’exécution d’un flux de travail contenant cinq activités dans une séquence de différentes configurations.</span><span class="sxs-lookup"><span data-stu-id="e779b-551">The following table shows the results of running a workflow containing five activities in a sequence in various configurations.</span></span>

|<span data-ttu-id="e779b-552">Test</span><span class="sxs-lookup"><span data-stu-id="e779b-552">Test</span></span>|<span data-ttu-id="e779b-553">Débit (workflows/s)</span><span class="sxs-lookup"><span data-stu-id="e779b-553">Throughput (workflows/sec)</span></span>|
|----------|-----------------------------------|
|<span data-ttu-id="e779b-554">Séquence WF3 dans le runtime WF3</span><span class="sxs-lookup"><span data-stu-id="e779b-554">WF3 Sequence in WF3 runtime</span></span>|<span data-ttu-id="e779b-555">1,576</span><span class="sxs-lookup"><span data-stu-id="e779b-555">1,576</span></span>|
|<span data-ttu-id="e779b-556">Séquence WF3 dans le runtime WF4 utilisant Interop</span><span class="sxs-lookup"><span data-stu-id="e779b-556">WF3 Sequence in WF4 runtime using Interop</span></span>|<span data-ttu-id="e779b-557">2,745</span><span class="sxs-lookup"><span data-stu-id="e779b-557">2,745</span></span>|
|<span data-ttu-id="e779b-558">Séquence WF4</span><span class="sxs-lookup"><span data-stu-id="e779b-558">WF4 Sequence</span></span>|<span data-ttu-id="e779b-559">153,582</span><span class="sxs-lookup"><span data-stu-id="e779b-559">153,582</span></span>|

 <span data-ttu-id="e779b-560">On constate une amélioration notable lors de l'utilisation d'Interop par rapport à WF3 simple.</span><span class="sxs-lookup"><span data-stu-id="e779b-560">There is a notable performance increase to using Interop over straight WF3.</span></span>  <span data-ttu-id="e779b-561">Toutefois, par rapport aux activités WF4, l'augmentation est négligeable.</span><span class="sxs-lookup"><span data-stu-id="e779b-561">However, when compared against WF4 activities, the increase is negligible.</span></span>

## <a name="summary"></a><span data-ttu-id="e779b-562">Résumé</span><span class="sxs-lookup"><span data-stu-id="e779b-562">Summary</span></span>
 <span data-ttu-id="e779b-563">Les lourds efforts consacrés aux performances pour WF4 ont payé dans de nombreux domaines cruciaux.</span><span class="sxs-lookup"><span data-stu-id="e779b-563">Heavy investments in performance for WF4 have paid off in many crucial areas.</span></span>  <span data-ttu-id="e779b-564">Dans certains cas, les performances des composants de workflow individuels sont des centaines de fois plus rapides dans WF4 que dans WF3 grâce à un runtime [!INCLUDE[wf1](../../../includes/wf1-md.md)] plus léger.</span><span class="sxs-lookup"><span data-stu-id="e779b-564">Individual workflow component performance is in some cases hundreds of times faster in WF4 compared to WF3 due to a leaner [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="e779b-565">Les chiffres de latence sont également considérablement meilleurs.</span><span class="sxs-lookup"><span data-stu-id="e779b-565">Latency numbers are significantly better as well.</span></span>  <span data-ttu-id="e779b-566">Cela signifie que la baisse des performances pour l’utilisation de au [!INCLUDE[wf1](../../../includes/wf1-md.md)] lieu du codage manuel des services d’orchestration WCF est très faible, en tenant compte des avantages supplémentaires de l’utilisation de [!INCLUDE[wf1](../../../includes/wf1-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="e779b-566">This means the performance penalty for using [!INCLUDE[wf1](../../../includes/wf1-md.md)] as opposed to hand-coding WCF orchestration services is very small considering the added benefits of using [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span></span>  <span data-ttu-id="e779b-567">Les performances de la persistance ont augmenté d'un facteur de 2,5 à 3.</span><span class="sxs-lookup"><span data-stu-id="e779b-567">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="e779b-568">Le contrôle d'état au moyen du suivi de workflow nécessite désormais très peu de charge mémoire.</span><span class="sxs-lookup"><span data-stu-id="e779b-568">Health monitoring by means of workflow tracking now has very little overhead.</span></span>  <span data-ttu-id="e779b-569">Un ensemble complet de guides de migration est disponible pour les utilisateurs qui envisagent de passer de WF3 à WF4.</span><span class="sxs-lookup"><span data-stu-id="e779b-569">A comprehensive set of migration guides are available for those that are considering moving from WF3 to WF4.</span></span>  <span data-ttu-id="e779b-570">Pour toutes ces raisons, WF4 constitue une option avantageuse pour l'écriture d'applications complexes.</span><span class="sxs-lookup"><span data-stu-id="e779b-570">All of this should make WF4 an attractive option for writing complex applications.</span></span>

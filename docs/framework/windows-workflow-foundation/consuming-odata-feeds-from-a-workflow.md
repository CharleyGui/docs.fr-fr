---
title: Consommation de flux OData à partir d’un flux de travail - WF
ms.date: 03/30/2017
ms.assetid: 1b26617c-53e9-476a-81af-675c36d95919
ms.openlocfilehash: e7d5230bb15474d63b2381d3906e07e48ac0134d
ms.sourcegitcommit: c7a7e1468bf0fa7f7065de951d60dfc8d5ba89f5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/14/2019
ms.locfileid: "65592981"
---
# <a name="consuming-odata-feeds-from-a-workflow"></a><span data-ttu-id="e7a13-102">Consommation de flux OData à partir d’un flux de travail</span><span class="sxs-lookup"><span data-stu-id="e7a13-102">Consuming OData feeds from a workflow</span></span>

<span data-ttu-id="e7a13-103">WCF Data Services est un composant du .NET Framework qui vous permet de créer des services qui utilisent le protocole Open Data Protocol (OData) pour exposer et consommer des données sur le Web ou l’intranet à l’aide de la sémantique representational state Transfer (REST).</span><span class="sxs-lookup"><span data-stu-id="e7a13-103">WCF Data Services is a component of the .NET Framework that enables you to create services that use the Open Data Protocol (OData) to expose and consume data over the Web or intranet by using the semantics of representational state transfer (REST).</span></span> <span data-ttu-id="e7a13-104">OData expose les données sous forme de ressources adressables par des URI.</span><span class="sxs-lookup"><span data-stu-id="e7a13-104">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="e7a13-105">Toute application peut interagir avec un service de données basé sur OData si elle peut envoyer une requête HTTP et traiter le flux OData retourné par un service de données.</span><span class="sxs-lookup"><span data-stu-id="e7a13-105">Any application can interact with an OData-based data service if it can send an HTTP request and process the OData feed that a data service returns.</span></span> <span data-ttu-id="e7a13-106">En outre, WCF Data Services inclut des bibliothèques clientes qui fournissent une expérience en programmation plus riche lorsque vous consommez des flux OData à partir d’applications .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="e7a13-106">In addition, WCF Data Services includes client libraries that provide a richer programming experience when you consume OData feeds from .NET Framework applications.</span></span> <span data-ttu-id="e7a13-107">Cette rubrique fournit une vue d'ensemble de la consommation d'un flux OData dans un workflow avec et sans l'utilisation de bibliothèques clientes.</span><span class="sxs-lookup"><span data-stu-id="e7a13-107">This topic provides an overview of consuming an OData feed in a workflow with and without using the client libraries.</span></span>

## <a name="using-the-sample-northwind-odata-service"></a><span data-ttu-id="e7a13-108">À l’aide de l’exemple de service Northwind OData</span><span class="sxs-lookup"><span data-stu-id="e7a13-108">Using the sample Northwind OData service</span></span>

<span data-ttu-id="e7a13-109">Les exemples de cette rubrique utilisent l’exemple de service de données Northwind à l’adresse [ http://services.odata.org/Northwind/Northwind.svc/ ](https://go.microsoft.com/fwlink/?LinkID=187426).</span><span class="sxs-lookup"><span data-stu-id="e7a13-109">The examples in this topic use the sample Northwind data service located at [http://services.odata.org/Northwind/Northwind.svc/](https://go.microsoft.com/fwlink/?LinkID=187426).</span></span> <span data-ttu-id="e7a13-110">Ce service fait partie du [SDK OData](https://go.microsoft.com/fwlink/?LinkID=185248) et fournit un accès en lecture seule à l’exemple de base de données Northwind.</span><span class="sxs-lookup"><span data-stu-id="e7a13-110">This service is provided as part of the [OData SDK](https://go.microsoft.com/fwlink/?LinkID=185248) and provides read-only access to the sample Northwind database.</span></span> <span data-ttu-id="e7a13-111">Si vous souhaitez un accès en écriture ou un service de données WCF local, vous pouvez suivre la procédure de [démarrage rapide WCF Data Services](https://go.microsoft.com/fwlink/?LinkID=131076) pour créer un service OData local qui donne accès à la base de données Northwind.</span><span class="sxs-lookup"><span data-stu-id="e7a13-111">If write access is desired, or if a local WCF Data Service is desired, you can follow the steps of the [WCF Data Services Quickstart](https://go.microsoft.com/fwlink/?LinkID=131076) to create a local OData service that provides access to the Northwind database.</span></span> <span data-ttu-id="e7a13-112">Si vous suivez la procédure de démarrage rapide, remplacez l'URI local par celui fourni dans l'exemple de code de cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="e7a13-112">If you follow the quickstart, substitute the local URI for the one provided in the example code in this topic.</span></span>

## <a name="consuming-an-odata-feed-using-the-client-libraries"></a><span data-ttu-id="e7a13-113">Consommation d’un OData flux à l’aide de bibliothèques clientes</span><span class="sxs-lookup"><span data-stu-id="e7a13-113">Consuming an OData feed using the client libraries</span></span>

<span data-ttu-id="e7a13-114">WCF Data Services inclut des bibliothèques clientes qui vous permettent de consommer plus facilement un flux OData depuis .NET Framework et les applications clientes.</span><span class="sxs-lookup"><span data-stu-id="e7a13-114">WCF Data Services includes client libraries that enable you to more easily consume an OData feed from .NET Framework and client applications.</span></span> <span data-ttu-id="e7a13-115">Ces bibliothèques simplifient l'envoi et la réception des messages HTTP.</span><span class="sxs-lookup"><span data-stu-id="e7a13-115">These libraries simplify sending and receiving HTTP messages.</span></span> <span data-ttu-id="e7a13-116">Elles traduisent également la charge utile de message dans les objets CLR qui représentent des données d'entité.</span><span class="sxs-lookup"><span data-stu-id="e7a13-116">They also translate the message payload into CLR objects that represent entity data.</span></span> <span data-ttu-id="e7a13-117">Les bibliothèques clientes comprennent les deux classes principales <xref:System.Data.Services.Client.DataServiceContext> et <xref:System.Data.Services.Client.DataServiceQuery%601>.</span><span class="sxs-lookup"><span data-stu-id="e7a13-117">The client libraries feature the two core classes <xref:System.Data.Services.Client.DataServiceContext> and <xref:System.Data.Services.Client.DataServiceQuery%601>.</span></span> <span data-ttu-id="e7a13-118">Ces classes vous permettent d'interroger un service de données, puis d'utiliser les données d'entité retournées sous forme d'objets CLR.</span><span class="sxs-lookup"><span data-stu-id="e7a13-118">These classes enable you to query a data service and then work with the returned entity data as CLR objects.</span></span> <span data-ttu-id="e7a13-119">Cette rubrique décrit deux approches de création d'activités qui utilisent les bibliothèques clientes.</span><span class="sxs-lookup"><span data-stu-id="e7a13-119">This section covers two approaches to creating activities that use the client libraries.</span></span>

### <a name="adding-a-service-reference-to-the-wcf-data-service"></a><span data-ttu-id="e7a13-120">Ajout d’une référence de service pour le service de données WCF</span><span class="sxs-lookup"><span data-stu-id="e7a13-120">Adding a service reference to the WCF Data service</span></span>

<span data-ttu-id="e7a13-121">Pour générer les bibliothèques clientes Northwind, vous pouvez utiliser la **ajouter une référence de Service** boîte de dialogue dans Visual Studio 2012 pour ajouter une référence au service Northwind OData.</span><span class="sxs-lookup"><span data-stu-id="e7a13-121">To generate the Northwind client libraries, you can use the **Add Service Reference** dialog box in Visual Studio 2012 to add a reference to the Northwind OData service.</span></span>

![Capture d’écran qui affiche la boîte de dialogue Ajouter une référence de Service.](./media/consuming-odata-feeds-from-a-workflow/add-service-reference-dialog.gif)

<span data-ttu-id="e7a13-123">Notez qu'aucune opération du service n'est exposée par le service et que la liste **Services** contient des éléments représentant les entités exposées par le service de données Northwind.</span><span class="sxs-lookup"><span data-stu-id="e7a13-123">Note that there are no service operations exposed by the service, and in the **Services** list there are items representing the entities exposed by the Northwind data service.</span></span> <span data-ttu-id="e7a13-124">Lorsqu'une référence de service est ajoutée, les classes sont générées pour ces entités et peuvent être utilisées dans le code client.</span><span class="sxs-lookup"><span data-stu-id="e7a13-124">When the service reference is added, classes will be generated for these entities and they can be used in the client code.</span></span> <span data-ttu-id="e7a13-125">Les exemples de cette rubrique utilisent ces classes et la classe `NorthwindEntities` pour exécuter les requêtes.</span><span class="sxs-lookup"><span data-stu-id="e7a13-125">The examples in this topic use these classes and the `NorthwindEntities` class to perform the queries.</span></span>

> [!NOTE]
> <span data-ttu-id="e7a13-126">Pour plus d’informations, consultez [génération de la bibliothèque de Client de Service de données (WCF Data Services)](../data/wcf/generating-the-data-service-client-library-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="e7a13-126">For more information, see [Generating the Data Service Client Library (WCF Data Services)](../data/wcf/generating-the-data-service-client-library-wcf-data-services.md).</span></span>

### <a name="using-asynchronous-methods"></a><span data-ttu-id="e7a13-127">À l’aide de méthodes asynchrones</span><span class="sxs-lookup"><span data-stu-id="e7a13-127">Using asynchronous methods</span></span>

<span data-ttu-id="e7a13-128">Pour résoudre les problèmes de latence possibles qui peuvent se produire lors de l'accès aux ressources sur le Web, il est recommandé d'accéder à WCF Data Services de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="e7a13-128">To address possible latency issues that may occur when accessing resources over the Web, we recommend accessing WCF Data Services asynchronously.</span></span> <span data-ttu-id="e7a13-129">Les bibliothèques de client WCF Data Services contiennent des méthodes asynchrones pour appeler les requêtes, et Windows Workflow Foundation (WF) fournit la <xref:System.Activities.AsyncCodeActivity> classe pour la création d’activités asynchrones.</span><span class="sxs-lookup"><span data-stu-id="e7a13-129">The WCF Data Services client libraries include asynchronous methods for invoking queries, and Windows Workflow Foundation (WF) provides the <xref:System.Activities.AsyncCodeActivity> class for authoring asynchronous activities.</span></span> <span data-ttu-id="e7a13-130"><xref:System.Activities.AsyncCodeActivity> activités dérivées peuvent être écrites pour tirer parti des classes de .NET Framework qui ont des méthodes asynchrones, ou le code doit être exécuté de façon asynchrone peut être inséré dans une méthode et appelé à l’aide d’un délégué.</span><span class="sxs-lookup"><span data-stu-id="e7a13-130"><xref:System.Activities.AsyncCodeActivity> derived activities can be written to take advantage of .NET Framework classes that have asynchronous methods, or the code to be executed asynchronously can be put into a method and invoked by using a delegate.</span></span> <span data-ttu-id="e7a13-131">Cette section contient deux exemples d'une activité dérivée <xref:System.Activities.AsyncCodeActivity> ; une qui utilise les méthodes asynchrones des bibliothèques clientes WCF Data Services et une qui utilise un délégué.</span><span class="sxs-lookup"><span data-stu-id="e7a13-131">This section provides two examples of an <xref:System.Activities.AsyncCodeActivity> derived activity; one that uses the asynchronous methods of the WCF Data Services client libraries and one that uses a delegate.</span></span>

> [!NOTE]
> <span data-ttu-id="e7a13-132">Pour plus d’informations, consultez [opérations asynchrones (WCF Data Services)](../data/wcf/asynchronous-operations-wcf-data-services.md) et [création d’activités asynchrones](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="e7a13-132">For more information, see [Asynchronous Operations (WCF Data Services)](../data/wcf/asynchronous-operations-wcf-data-services.md) and [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>

### <a name="using-client-library-asynchronous-methods"></a><span data-ttu-id="e7a13-133">À l’aide de méthodes asynchrones des bibliothèques de client</span><span class="sxs-lookup"><span data-stu-id="e7a13-133">Using client library asynchronous methods</span></span>

<span data-ttu-id="e7a13-134">La classe <xref:System.Data.Services.Client.DataServiceQuery%601> fournit les méthodes <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> et <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> pour interroger un service OData de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="e7a13-134">The <xref:System.Data.Services.Client.DataServiceQuery%601> class provides <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> and <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> methods for querying an OData service asynchronously.</span></span> <span data-ttu-id="e7a13-135">Ces méthodes peuvent être appelées à partir des substitutions <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> et <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> d'une classe dérivée <xref:System.Activities.AsyncCodeActivity> .</span><span class="sxs-lookup"><span data-stu-id="e7a13-135">These methods can be called from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides of an <xref:System.Activities.AsyncCodeActivity> derived class.</span></span> <span data-ttu-id="e7a13-136">Si la substitution <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> retourne, le workflow peut être inactif (mais pas persistant), et si la tâche asynchrone est terminée, la méthode <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> est appelée par le runtime.</span><span class="sxs-lookup"><span data-stu-id="e7a13-136">When the <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override returns, the workflow can go idle (but not persist), and when the asynchronous work is completed, <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> is invoked by the runtime.</span></span>

<span data-ttu-id="e7a13-137">Dans l'exemple suivant, une activité `OrdersByCustomer` est définie et contient deux arguments d'entrée.</span><span class="sxs-lookup"><span data-stu-id="e7a13-137">In the following example, an `OrdersByCustomer` activity is defined that has two input arguments.</span></span> <span data-ttu-id="e7a13-138">L'argument `CustomerId` représente le client qui identifie les commandes à retourner, et l'argument `ServiceUri` représente l'URI du service Odata à interroger.</span><span class="sxs-lookup"><span data-stu-id="e7a13-138">The `CustomerId` argument represents the customer who identifies which orders to return, and the `ServiceUri` argument represents the URI of the OData service to be queried.</span></span> <span data-ttu-id="e7a13-139">Comme l'activité dérive de `AsyncCodeActivity<IEnumerable<Order>>` , il y a aussi un argument de sortie <xref:System.Activities.Activity%601.Result%2A> , utilisé pour retourner le résultat de la requête.</span><span class="sxs-lookup"><span data-stu-id="e7a13-139">Because the activity derives from `AsyncCodeActivity<IEnumerable<Order>>` there is also a <xref:System.Activities.Activity%601.Result%2A> output argument that is used to return the results of the query.</span></span> <span data-ttu-id="e7a13-140">La substitution <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> crée une requête LINQ qui sélectionne toutes les commandes du client spécifié.</span><span class="sxs-lookup"><span data-stu-id="e7a13-140">The <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override creates a LINQ query that selects all orders of the specified customer.</span></span> <span data-ttu-id="e7a13-141">Cette requête est spécifiée comme <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> du <xref:System.Activities.AsyncCodeActivityContext>passé, puis la méthode <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> de la requête est appelée.</span><span class="sxs-lookup"><span data-stu-id="e7a13-141">This query is specified as the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> of the passed <xref:System.Activities.AsyncCodeActivityContext>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> method is called.</span></span> <span data-ttu-id="e7a13-142">Notez que le rappel et l'état qui sont passés à la méthode <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> de la requête sont ceux qui sont passés à la méthode <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> de l'activité.</span><span class="sxs-lookup"><span data-stu-id="e7a13-142">Note that the callback and state that are passed into the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> are the ones that are passed in to the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> method.</span></span> <span data-ttu-id="e7a13-143">Lorsque l'exécution de la requête est terminée, la méthode <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> de l'activité est appelée.</span><span class="sxs-lookup"><span data-stu-id="e7a13-143">When the query has finished executing, the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> method is invoked.</span></span> <span data-ttu-id="e7a13-144">La requête est récupérée dans la propriété <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, puis la méthode <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> de la requête est appelée.</span><span class="sxs-lookup"><span data-stu-id="e7a13-144">The query is retrieved from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> method is called.</span></span> <span data-ttu-id="e7a13-145">Cette méthode retourne un <xref:System.Collections.Generic.IEnumerable%601> du type d'entité spécifié, dans ce cas `Order`.</span><span class="sxs-lookup"><span data-stu-id="e7a13-145">This method returns an <xref:System.Collections.Generic.IEnumerable%601> of the specified entity type; in this case `Order`.</span></span> <span data-ttu-id="e7a13-146">`IEnumerable<Order>` étant le type générique de <xref:System.Activities.AsyncCodeActivity%601>, ce <xref:System.Collections.IEnumerable> est défini comme <xref:System.Activities.Activity%601.Result%2A> <xref:System.Activities.OutArgument%601> de l'activité.</span><span class="sxs-lookup"><span data-stu-id="e7a13-146">Since `IEnumerable<Order>` is the generic type of the <xref:System.Activities.AsyncCodeActivity%601>, this <xref:System.Collections.IEnumerable> is set as the <xref:System.Activities.Activity%601.Result%2A> <xref:System.Activities.OutArgument%601> of the activity.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#100](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#100)]

<span data-ttu-id="e7a13-147">Dans l'exemple suivant, l'activité `OrdersByCustomer` récupère une liste de commandes pour le client spécifié, puis une activité <xref:System.Activities.Statements.ForEach%601> énumère les commandes retournées et écrit la date de chacune d'elles dans la console.</span><span class="sxs-lookup"><span data-stu-id="e7a13-147">In the following example, the `OrdersByCustomer` activity retrieves a list of orders for the specified customer, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates the returned orders and writes the date of each order to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#10](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#10)]

<span data-ttu-id="e7a13-148">Lorsque ce workflow est appelé, les données suivantes sont écrites dans la console :</span><span class="sxs-lookup"><span data-stu-id="e7a13-148">When this workflow is invoked, the following data is written to the console:</span></span>

```console
Calling WCF Data Service...
8/25/1997
10/3/1997
10/13/1997
1/15/1998
3/16/1998
4/9/1998
```

> [!NOTE]
> <span data-ttu-id="e7a13-149">S'il est impossible d'établir une connexion au serveur OData, vous obtiendrez une exception semblable à la suivante :</span><span class="sxs-lookup"><span data-stu-id="e7a13-149">If a connection to the OData server cannot be established, you will get an exception similar to the following exception:</span></span>
>
> <span data-ttu-id="e7a13-150">Exception non prise en charge : System.InvalidOperationException : Une erreur s’est produite lors du traitement de cette demande.</span><span class="sxs-lookup"><span data-stu-id="e7a13-150">Unhandled Exception: System.InvalidOperationException: An error occurred while processing this request.</span></span> <span data-ttu-id="e7a13-151">---> System.Net.WebException : Impossible de se connecter au serveur distant---> System.Net.Sockets.SocketException : Une tentative de connexion a échoué car la partie connectée n’a pas répondu convenablement après une période de temps ou la connexion établie a échoué, car l’hôte connecté n’a pas répondu.</span><span class="sxs-lookup"><span data-stu-id="e7a13-151">---> System.Net.WebException: Unable to connect to the remote server ---> System.Net.Sockets.SocketException: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.</span></span>

<span data-ttu-id="e7a13-152">Si un traitement supplémentaire des données retournées par la requête est nécessaire, il peut être effectué dans la substitution <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> de l'activité.</span><span class="sxs-lookup"><span data-stu-id="e7a13-152">If any additional processing of the data returned by the query is required, it can be done in the activity's <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override.</span></span> <span data-ttu-id="e7a13-153">Les méthodes <xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A> et <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> sont appelées à l'aide du thread de workflow, et le code de ces substitutions ne s'exécute pas de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="e7a13-153">Both <xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> are invoked by using the workflow thread, and any code in these overrides does not run asynchronously.</span></span> <span data-ttu-id="e7a13-154">Si le traitement supplémentaire est étendu ou de longue durée, ou les résultats de la requête sont paginés, vous devez envisager d'adopter l'approche décrite dans la section suivante. Cette approche utilise un délégué pour exécuter la requête et effectuer le traitement supplémentaire de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="e7a13-154">If the additional processing is extensive or long-running, or the query results are paged, you should consider the approach discussed in the next section, which uses a delegate to execute the query and perform additional processing asynchronously.</span></span>

### <a name="using-a-delegate"></a><span data-ttu-id="e7a13-155">À l’aide d’un délégué</span><span class="sxs-lookup"><span data-stu-id="e7a13-155">Using a delegate</span></span>

<span data-ttu-id="e7a13-156">En plus d’appeler la méthode asynchrone d’une classe .NET Framework, un <xref:System.Activities.AsyncCodeActivity>-activité basée sur peut également définir la logique asynchrone dans une de ses méthodes.</span><span class="sxs-lookup"><span data-stu-id="e7a13-156">In addition to invoking the asynchronous method of a .NET Framework class, an <xref:System.Activities.AsyncCodeActivity>-based activity can also define the asynchronous logic in one of its methods.</span></span> <span data-ttu-id="e7a13-157">Cette méthode est spécifiée en utilisant un délégué dans la substitution <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> de l'activité.</span><span class="sxs-lookup"><span data-stu-id="e7a13-157">This method is specified by using a delegate in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="e7a13-158">Lorsque la méthode retourne, le runtime appelle la substitution <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> de l'activité.</span><span class="sxs-lookup"><span data-stu-id="e7a13-158">When the method returns, the runtime invokes the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> override.</span></span> <span data-ttu-id="e7a13-159">Lors de l'appel d'un service OData d'un workflow, cette méthode peut être utilisée pour interroger le service et fournir un traitement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="e7a13-159">When calling an OData service from a workflow, this method can be used to query the service and provide any additional processing.</span></span>

<span data-ttu-id="e7a13-160">Dans l'exemple suivant, une activité `ListCustomers` est définie.</span><span class="sxs-lookup"><span data-stu-id="e7a13-160">In the following example, a `ListCustomers` activity is defined.</span></span> <span data-ttu-id="e7a13-161">Cette activité interroge l'exemple de service de données Northwind et retourne un `List<Customer>` qui contient tous les clients dans la base de données Northwind.</span><span class="sxs-lookup"><span data-stu-id="e7a13-161">This activity queries the sample Northwind data service and returns a `List<Customer>` that contains all of the customers in the Northwind database.</span></span> <span data-ttu-id="e7a13-162">La tâche asynchrone est effectuée par la méthode `GetCustomers` .</span><span class="sxs-lookup"><span data-stu-id="e7a13-162">The asynchronous work is performed by the `GetCustomers` method.</span></span> <span data-ttu-id="e7a13-163">Cette méthode interroge le service pour tous les clients, puis les copie dans un `List<Customer>`.</span><span class="sxs-lookup"><span data-stu-id="e7a13-163">This method queries the service for all customers, and then copies them into a `List<Customer>`.</span></span> <span data-ttu-id="e7a13-164">Elle vérifie ensuite si les résultats sont paginés.</span><span class="sxs-lookup"><span data-stu-id="e7a13-164">It then checks to see if the results are paged.</span></span> <span data-ttu-id="e7a13-165">Le cas échéant, elle interroge le service pour la page suivante de résultats, les ajoute à la liste et continue jusqu'à ce que tous les clients aient été récupérés.</span><span class="sxs-lookup"><span data-stu-id="e7a13-165">If so, it queries the service for the next page of results, adds them to the list, and continues until all of the customer data has been retrieved.</span></span>

> [!NOTE]
> <span data-ttu-id="e7a13-166">Pour plus d’informations sur la pagination dans WCF Data Services, consultez [Comment : Charge résultats paginés (WCF Data Services)](../data/wcf/how-to-load-paged-results-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="e7a13-166">For more information about paging in WCF Data Services, see [How to: Load Paged Results (WCF Data Services)](../data/wcf/how-to-load-paged-results-wcf-data-services.md).</span></span>

<span data-ttu-id="e7a13-167">Une fois tous les clients ajoutés, la liste est retournée.</span><span class="sxs-lookup"><span data-stu-id="e7a13-167">Once all customers are added, the list is returned.</span></span> <span data-ttu-id="e7a13-168">La méthode `GetCustomers` est spécifiée dans la substitution <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> de l'activité.</span><span class="sxs-lookup"><span data-stu-id="e7a13-168">The `GetCustomers` method is specified in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="e7a13-169">Comme la méthode a une valeur de retour, un `Func<string, List<Customer>>` est créé pour spécifier la méthode.</span><span class="sxs-lookup"><span data-stu-id="e7a13-169">Since the method has a return value, a `Func<string, List<Customer>>` is created to specify the method.</span></span>

> [!NOTE]
> <span data-ttu-id="e7a13-170">Si la méthode qui effectue la tâche asynchrone n'a pas de valeur de retour, un <xref:System.Action> est utilisé à la place d'un <xref:System.Func%601>.</span><span class="sxs-lookup"><span data-stu-id="e7a13-170">If the method that performs the asynchronous work does not have a return value, an <xref:System.Action> is used instead of a <xref:System.Func%601>.</span></span> <span data-ttu-id="e7a13-171">Pour obtenir des exemples de création d’un exemple asynchrone à l’aide de ces deux approches, consultez [création d’activités asynchrones](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="e7a13-171">For examples of creating an asynchronous example using both approaches, see [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>

<span data-ttu-id="e7a13-172">Ce <xref:System.Func%601> est assigné au <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, puis `BeginInvoke` est appelé.</span><span class="sxs-lookup"><span data-stu-id="e7a13-172">This <xref:System.Func%601> is assigned to the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then `BeginInvoke` is called.</span></span> <span data-ttu-id="e7a13-173">Comme la méthode à appeler n'a pas accès à l'environnement des arguments de l'activité, la valeur de l'argument `ServiceUri` est passée comme premier paramètre, avec le rappel et l'état passés dans la méthode <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="e7a13-173">Since the method to be invoked does not have access to the activity's environment of arguments, the value of the `ServiceUri` argument is passed as the first parameter, together with the callback and state that were passed into <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="e7a13-174">Lorsque `GetCustomers` retourne, le runtime appelle <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="e7a13-174">When `GetCustomers` returns, the runtime invokes <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="e7a13-175">Le code dans la méthode <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> récupère le délégué à partir de la propriété <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, appelle `EndInvoke`, et retourne le résultat, qui correspond à la liste des clients retournés à partir de la méthode `GetCustomers` .</span><span class="sxs-lookup"><span data-stu-id="e7a13-175">The code in <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> retrieves the delegate from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, calls `EndInvoke`, and returns the result, which is the list of customers returned from the `GetCustomers` method.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#200](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#200)]

<span data-ttu-id="e7a13-176">Dans l'exemple suivant, l'activité `ListCustomers` récupère une liste de clients, puis une activité <xref:System.Activities.Statements.ForEach%601> les énumère et écrit le nom de la société et du contact de chacun des clients dans la console.</span><span class="sxs-lookup"><span data-stu-id="e7a13-176">In the following example, the `ListCustomers` activity retrieves a list of customers, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates them and writes the company name and contact name of each customer to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#20](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#20)]

<span data-ttu-id="e7a13-177">Lorsque ce workflow est appelé, les données suivantes sont écrites dans la console :</span><span class="sxs-lookup"><span data-stu-id="e7a13-177">When this workflow is invoked, the following data is written to the console.</span></span> <span data-ttu-id="e7a13-178">Comme cette requête retourne de nombreux clients, une seule partie du résultat s'affiche ici.</span><span class="sxs-lookup"><span data-stu-id="e7a13-178">Since this query returns many customers, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Alfreds Futterkiste, Contact: Maria Anders
Ana Trujillo Emparedados y helados, Contact: Ana Trujillo
Antonio Moreno Taquería, Contact: Antonio Moreno
Around the Horn, Contact: Thomas Hardy
Berglunds snabbköp, Contact: Christina Berglund
...
```

## <a name="consuming-an-odata-feed-without-using-the-client-libraries"></a><span data-ttu-id="e7a13-179">Consommation d’un OData flux sans utiliser les bibliothèques clientes</span><span class="sxs-lookup"><span data-stu-id="e7a13-179">Consuming an OData feed without using the client libraries</span></span>

<span data-ttu-id="e7a13-180">OData expose les données sous forme de ressources adressables par des URI.</span><span class="sxs-lookup"><span data-stu-id="e7a13-180">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="e7a13-181">Lorsque vous utilisez les bibliothèques clientes, ces URI sont créés pour vous, mais vous n'avez pas besoin d'utiliser les bibliothèques clientes.</span><span class="sxs-lookup"><span data-stu-id="e7a13-181">When you use the client libraries these URIs are created for you, but you do not have to use the client libraries.</span></span> <span data-ttu-id="e7a13-182">Si vous le souhaitez, vous pouvez accéder aux services OData directement sans utiliser les bibliothèques clientes.</span><span class="sxs-lookup"><span data-stu-id="e7a13-182">If desired, OData services can be accessed directly without using the client libraries.</span></span> <span data-ttu-id="e7a13-183">Le cas échéant, l'emplacement du service et les données voulues sont spécifiés par l'URI et les résultats sont retournés dans la réponse à la requête HTTP.</span><span class="sxs-lookup"><span data-stu-id="e7a13-183">When not using the client libraries the location of the service and the desired data are specified by the URI and the results are returned in the response to the HTTP request.</span></span> <span data-ttu-id="e7a13-184">Vous pouvez ensuite traiter ou manipuler ces données brutes de la façon appropriée.</span><span class="sxs-lookup"><span data-stu-id="e7a13-184">This raw data can then be processed or manipulated in the desired manner.</span></span> <span data-ttu-id="e7a13-185">Pour récupérer les résultats d'une requête OData, vous pouvez utiliser la classe <xref:System.Net.WebClient> .</span><span class="sxs-lookup"><span data-stu-id="e7a13-185">One way to retrieve the results of an OData query is by using the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="e7a13-186">Dans cet exemple, le contact du client représenté par la clé ALFKI est récupéré.</span><span class="sxs-lookup"><span data-stu-id="e7a13-186">In this example, the contact name for the customer represented by the key ALFKI is retrieved.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#2](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#2)]

<span data-ttu-id="e7a13-187">Lorsque ce code s'exécute, la sortie suivante s'affiche sur la console :</span><span class="sxs-lookup"><span data-stu-id="e7a13-187">When this code is run, the following output is displayed to the console:</span></span>

```console
Raw data returned:
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<ContactName xmlns="http://schemas.microsoft.com/ado/2007/08/dataservices">Maria Anders</ContactName>
```

<span data-ttu-id="e7a13-188">Dans un workflow, le code de cet exemple peut être incorporé dans la substitution <xref:System.Activities.CodeActivity.Execute%2A> d'une activité personnalisée basée sur <xref:System.Activities.CodeActivity>, mais cette même fonctionnalité peut aussi être obtenue à l'aide de l'activité <xref:System.Activities.Expressions.InvokeMethod%601>.</span><span class="sxs-lookup"><span data-stu-id="e7a13-188">In a workflow, the code from this example could be incorporated into the <xref:System.Activities.CodeActivity.Execute%2A> override of a <xref:System.Activities.CodeActivity>-based custom activity, but the same functionality can also be accomplished by using the <xref:System.Activities.Expressions.InvokeMethod%601> activity.</span></span> <span data-ttu-id="e7a13-189">L'activité <xref:System.Activities.Expressions.InvokeMethod%601> permet aux auteurs de workflow d'appeler des méthodes d'instance et statiques d'une classe, ainsi que d'appeler la méthode spécifiée de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="e7a13-189">The <xref:System.Activities.Expressions.InvokeMethod%601> activity enables workflow authors to invoke static and instance methods of a class, and also has an option to invoke the specified method asynchronously.</span></span> <span data-ttu-id="e7a13-190">Dans l'exemple suivant, une activité <xref:System.Activities.Expressions.InvokeMethod%601> est configurée pour appeler la méthode <xref:System.Net.WebClient.DownloadString%2A> de la classe <xref:System.Net.WebClient> et retourner une liste de clients.</span><span class="sxs-lookup"><span data-stu-id="e7a13-190">In the following example, an <xref:System.Activities.Expressions.InvokeMethod%601> activity is configured to call the <xref:System.Net.WebClient.DownloadString%2A> method of the <xref:System.Net.WebClient> class and return a list of customers.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#3](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#3)]

<span data-ttu-id="e7a13-191"><xref:System.Activities.Expressions.InvokeMethod%601> peut appeler à la fois des méthodes d'instance et statiques d'une classe.</span><span class="sxs-lookup"><span data-stu-id="e7a13-191"><xref:System.Activities.Expressions.InvokeMethod%601> can call both static and instance methods of a class.</span></span> <span data-ttu-id="e7a13-192">Comme <xref:System.Net.WebClient.DownloadString%2A> est une méthode d'instance de la classe <xref:System.Net.WebClient> , une nouvelle instance de la classe <xref:System.Net.WebClient> est spécifiée pour <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span><span class="sxs-lookup"><span data-stu-id="e7a13-192">Since <xref:System.Net.WebClient.DownloadString%2A> is an instance method of the <xref:System.Net.WebClient> class, a new instance of the <xref:System.Net.WebClient> class is specified for the <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span></span> <span data-ttu-id="e7a13-193">`DownloadString` est spécifiée pour la propriété <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>, l'URI qui contient la requête est spécifié dans la collection <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A> , et la propriété <xref:System.Activities.Activity%601.Result%2A> est affectée à la valeur de retour.</span><span class="sxs-lookup"><span data-stu-id="e7a13-193">`DownloadString` is specified as the <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>, the URI that contains the query is specified in the <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A> collection, and the return value is assigned to the <xref:System.Activities.Activity%601.Result%2A> value.</span></span> <span data-ttu-id="e7a13-194">La valeur <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> est affectée à la propriété `true`, ce qui signifie que l'appel de la méthode s'exécutera de façon asynchrone par rapport au workflow.</span><span class="sxs-lookup"><span data-stu-id="e7a13-194">The <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> value is set to `true`, which means that the method invocation will run asynchronously with regard to the workflow.</span></span> <span data-ttu-id="e7a13-195">Dans l'exemple suivant, un workflow est construit qui utilise l'activité <xref:System.Activities.Expressions.InvokeMethod%601> pour interroger l'exemple de service de données Northwind pour une liste de commandes d'un client spécifique, puis les données retournées sont écrites dans la console.</span><span class="sxs-lookup"><span data-stu-id="e7a13-195">In the following example, a workflow is constructed that uses the <xref:System.Activities.Expressions.InvokeMethod%601> activity to query the sample Northwind data service for a list of orders for a specific customer, and then the returned data is written to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#1](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#1)]

<span data-ttu-id="e7a13-196">Lorsque ce workflow est appelé, la sortie suivante s'affiche sur la console.</span><span class="sxs-lookup"><span data-stu-id="e7a13-196">When this workflow is invoked, the following output is displayed to the console.</span></span> <span data-ttu-id="e7a13-197">Comme cette requête retourne plusieurs commandes, une seule partie du résultat s'affiche ici.</span><span class="sxs-lookup"><span data-stu-id="e7a13-197">Since this query returns several orders, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Raw data returned:

<?xml version="1.0" encoding="utf-8" standalone="yes"?>*
<feed
xml:base="http://services.odata.org/Northwind/Northwind.svc/"
xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices"
xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"
xmlns="http://www.w3.org/2005/Atom">
<title type="text">Orders\</title>
<id>http://services.odata.org/Northwind/Northwind.svc/Customers('ALFKI')/Orders\</id>
<updated>2010-05-19T19:37:07Z\</updated>
<link rel="self" title="Orders" href="Orders" />
<entry>
<id>http://services.odata.org/Northwind/Northwind.svc/Orders(10643)\</id>
<title type="text">\</title>
<updated>2010-05-19T19:37:07Z\</updated>
<author>
<name />
</author>
<link rel="edit" title="Order" href="Orders(10643)" />
<link rel="http://schemas.microsoft.com/ado/2007/08/dataservices/related/Customer" type="application/atom+xml;type=entry" title="Customer" href="Orders(10643)/Customer" />
...
```

<span data-ttu-id="e7a13-198">Cet exemple fournit une méthode que les auteurs d'applications de workflow peuvent utiliser pour consommer les données brutes retournées par un service OData.</span><span class="sxs-lookup"><span data-stu-id="e7a13-198">This example provides one method that workflow application authors can use to consume the raw data returned from an OData service.</span></span> <span data-ttu-id="e7a13-199">Pour plus d’informations sur l’accès aux Services de données WCF à l’aide d’URI, consultez [accès aux ressources de Service de données (WCF Data Services)](../data/wcf/accessing-data-service-resources-wcf-data-services.md) et [OData : Conventions d’URI](https://go.microsoft.com/fwlink/?LinkId=185564).</span><span class="sxs-lookup"><span data-stu-id="e7a13-199">For more information about accessing WCF Data Services using URIs, see [Accessing Data Service Resources (WCF Data Services)](../data/wcf/accessing-data-service-resources-wcf-data-services.md) and [OData: URI Conventions](https://go.microsoft.com/fwlink/?LinkId=185564).</span></span>

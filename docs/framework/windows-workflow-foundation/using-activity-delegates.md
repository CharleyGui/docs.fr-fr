---
title: Utilisation de délégués d'activité
ms.date: 03/30/2017
ms.assetid: e33cf876-8979-440b-9b23-4a12d1139960
ms.openlocfilehash: cbcc8f8e498be4f79f8fed5af7cd3557d7c55981
ms.sourcegitcommit: a4f9b754059f0210e29ae0578363a27b9ba84b64
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/05/2019
ms.locfileid: "74837569"
---
# <a name="using-activity-delegates"></a><span data-ttu-id="e1668-102">Utilisation de délégués d'activité</span><span class="sxs-lookup"><span data-stu-id="e1668-102">Using Activity Delegates</span></span>
<span data-ttu-id="e1668-103">Les délégués d'activité permettent aux auteurs d'activités d'exposer des rappels avec des signatures spécifiques pour lesquelles les utilisateurs de l'activité peuvent fournir des gestionnaires basés sur l'activité.</span><span class="sxs-lookup"><span data-stu-id="e1668-103">Activity delegates enable activity authors to expose callbacks with specific signatures, for which users of the activity can provide activity-based handlers.</span></span> <span data-ttu-id="e1668-104">Deux types de délégués d'activité sont disponibles : <xref:System.Activities.ActivityAction%601> est utilisé pour définir des délégués d'activité qui n'ont pas de valeur de retour et <xref:System.Activities.ActivityFunc%601> est utilisé pour définir des délégués d'activité qui ont une valeur de retour.</span><span class="sxs-lookup"><span data-stu-id="e1668-104">Two types of activity delegates are available: <xref:System.Activities.ActivityAction%601> is used to define activity delegates that do not have a return value, and <xref:System.Activities.ActivityFunc%601> is used to define activity delegates that do have a return value.</span></span>

<span data-ttu-id="e1668-105">Les délégués d'activité sont utiles dans les scénarios où une activité enfant doit être limitée à une certaine signature.</span><span class="sxs-lookup"><span data-stu-id="e1668-105">Activity delegates are useful in scenarios where a child activity must be constrained to having a certain signature.</span></span> <span data-ttu-id="e1668-106">Par exemple, une activité <xref:System.Activities.Statements.While> peut contenir tout type d’activité enfant sans contraintes, mais le corps d’une activité <xref:System.Activities.Statements.ForEach%601> est un <xref:System.Activities.ActivityAction%601>, et l’activité enfant exécutée finalement par <xref:System.Activities.Statements.ForEach%601> doit avoir un <xref:System.Activities.InArgument%601> qui est du même type que les membres de la collection que le <xref:System.Activities.Statements.ForEach%601> énumère.</span><span class="sxs-lookup"><span data-stu-id="e1668-106">For example, a <xref:System.Activities.Statements.While> activity can contain any type of child activity with no constraints, but the body of a <xref:System.Activities.Statements.ForEach%601> activity is an <xref:System.Activities.ActivityAction%601>, and the child activity that is ultimately executed by <xref:System.Activities.Statements.ForEach%601> must have an <xref:System.Activities.InArgument%601> that is the same type of the members of the collection that the <xref:System.Activities.Statements.ForEach%601> enumerates.</span></span>

## <a name="using-activityaction"></a><span data-ttu-id="e1668-107">Utilisation d'ActivityAction</span><span class="sxs-lookup"><span data-stu-id="e1668-107">Using ActivityAction</span></span>

<span data-ttu-id="e1668-108">Plusieurs activités [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] utilisent des actions de l'activité, telles que l'activité <xref:System.Activities.Statements.Catch> et l'activité <xref:System.Activities.Statements.ForEach%601>.</span><span class="sxs-lookup"><span data-stu-id="e1668-108">Several [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] activities use activity actions, such as the <xref:System.Activities.Statements.Catch> activity and the <xref:System.Activities.Statements.ForEach%601> activity.</span></span> <span data-ttu-id="e1668-109">Dans chaque cas, l'action de l'activité représente un emplacement où l'auteur de workflow spécifie une activité pour fournir le comportement voulu lors de la composition d'un workflow à l'aide de l'une de ces activités.</span><span class="sxs-lookup"><span data-stu-id="e1668-109">In each case, the activity action represents a location where the workflow author specifies an activity to provide the desired behavior when composing a workflow using one of these activities.</span></span> <span data-ttu-id="e1668-110">Dans l'exemple suivant, une activité <xref:System.Activities.Statements.ForEach%601> est utilisée pour afficher un texte dans la fenêtre de console.</span><span class="sxs-lookup"><span data-stu-id="e1668-110">In the following example, a <xref:System.Activities.Statements.ForEach%601> activity is used to display text to the console window.</span></span> <span data-ttu-id="e1668-111">Le corps du <xref:System.Activities.Statements.ForEach%601> est spécifié à l'aide d'un <xref:System.Activities.ActivityAction%601> qui correspond au type du <xref:System.Activities.Statements.ForEach%601> qui est le type chaîne.</span><span class="sxs-lookup"><span data-stu-id="e1668-111">The body of the <xref:System.Activities.Statements.ForEach%601> is specified by using an <xref:System.Activities.ActivityAction%601> that matches the type of the <xref:System.Activities.Statements.ForEach%601> which is string.</span></span> <span data-ttu-id="e1668-112">L’activité <xref:System.Activities.Statements.WriteLine> spécifiée dans le <xref:System.Activities.ActivityDelegate.Handler%2A> a son argument <xref:System.Activities.Statements.WriteLine.Text%2A> lié aux valeurs de chaîne dans la collection au sein de laquelle l’activité <xref:System.Activities.Statements.ForEach%601> itère.</span><span class="sxs-lookup"><span data-stu-id="e1668-112">The <xref:System.Activities.Statements.WriteLine> activity specified in the <xref:System.Activities.ActivityDelegate.Handler%2A> has its <xref:System.Activities.Statements.WriteLine.Text%2A> argument bound to the string values in the collection that the <xref:System.Activities.Statements.ForEach%601> activity iterates.</span></span>

[!code-csharp[CFX_ActivityExample#6](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#6)]

<span data-ttu-id="e1668-113">L'actionArgument est utilisé pour transférer les éléments individuels dans la collection au WriteLine.</span><span class="sxs-lookup"><span data-stu-id="e1668-113">The actionArgument is used to flow the individual items in the collection to the WriteLine.</span></span> <span data-ttu-id="e1668-114">Lorsque le workflow est appelé, la sortie suivante s'affiche sur la console.</span><span class="sxs-lookup"><span data-stu-id="e1668-114">When the workflow is invoked, the following output is displayed to the console.</span></span>

```console
HelloWorld.
```

<span data-ttu-id="e1668-115">Les exemples de cette rubrique utilisent la syntaxe d'initialisation d'objet.</span><span class="sxs-lookup"><span data-stu-id="e1668-115">The examples in this topic use object initialization syntax.</span></span> <span data-ttu-id="e1668-116">La syntaxe d'initialisation d'objet peut être une méthode utile pour créer des définitions de workflow dans le code, car elle fournit une vue hiérarchique des activités dans le workflow et affiche la relation entre les activités.</span><span class="sxs-lookup"><span data-stu-id="e1668-116">Object initialization syntax can be a useful way to create workflow definitions in code because it provides a hierarchical view of the activities in the workflow and shows the relationship between the activities.</span></span> <span data-ttu-id="e1668-117">Il n'est pas impératif d'utiliser la syntaxe d'initialisation d'objet lorsque vous créez des workflows par programmation.</span><span class="sxs-lookup"><span data-stu-id="e1668-117">There is no requirement to use object initialization syntax when you programmatically create workflows.</span></span> <span data-ttu-id="e1668-118">L'exemple suivant est d'un point de vue fonctionnel équivalent à l'exemple précédent :</span><span class="sxs-lookup"><span data-stu-id="e1668-118">The following example is functionally equivalent to the previous example.</span></span>

[!code-csharp[CFX_ActivityExample#7](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#7)]

<span data-ttu-id="e1668-119">Pour plus d’informations sur les initialiseurs d’objets, consultez [Comment : initialiser des objets sans appelerC# de constructeur (Guide de programmation)](../../csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer.md) et [Comment : déclarer un objet à l’aide d’un initialiseur d’objet (Visual Basic)](../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-declare-an-object-by-using-an-object-initializer.md).</span><span class="sxs-lookup"><span data-stu-id="e1668-119">For more information about object initializers, see [How to: Initialize Objects without Calling a Constructor (C# Programming Guide)](../../csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer.md) and [How to: Declare an Object by Using an Object Initializer (Visual Basic)](../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-declare-an-object-by-using-an-object-initializer.md).</span></span>

<span data-ttu-id="e1668-120">Dans l'exemple suivant, une activité <xref:System.Activities.Statements.TryCatch> est utilisée dans un workflow.</span><span class="sxs-lookup"><span data-stu-id="e1668-120">In the following example, a <xref:System.Activities.Statements.TryCatch> activity is used in a workflow.</span></span> <span data-ttu-id="e1668-121">Un <xref:System.ApplicationException> est levé par le workflow et géré par une activité <xref:System.Activities.Statements.Catch%601>.</span><span class="sxs-lookup"><span data-stu-id="e1668-121">An <xref:System.ApplicationException> is thrown by the workflow, and is handled by a <xref:System.Activities.Statements.Catch%601> activity.</span></span> <span data-ttu-id="e1668-122">Le gestionnaire de l’action d’activité de l’activité de <xref:System.Activities.Statements.Catch%601> est une activité de <xref:System.Activities.Statements.WriteLine>, et le détail de l’exception est transmis à celui-ci à l’aide de la <xref:System.Activities.DelegateInArgument%601>`ex`.</span><span class="sxs-lookup"><span data-stu-id="e1668-122">The handler for the <xref:System.Activities.Statements.Catch%601> activity's activity action is a <xref:System.Activities.Statements.WriteLine> activity, and the exception detail is flowed through to it using the `ex` <xref:System.Activities.DelegateInArgument%601>.</span></span>

[!code-csharp[CFX_WorkflowApplicationExample#33](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#33)]

<span data-ttu-id="e1668-123">Lorsque vous créez une activité personnalisée qui définit un <xref:System.Activities.ActivityAction%601>, utilisez un <xref:System.Activities.Statements.InvokeAction%601> pour modéliser l'appel de ce <xref:System.Activities.ActivityAction%601>.</span><span class="sxs-lookup"><span data-stu-id="e1668-123">When creating a custom activity that defines an <xref:System.Activities.ActivityAction%601>, use an <xref:System.Activities.Statements.InvokeAction%601> to model the invocation of that <xref:System.Activities.ActivityAction%601>.</span></span> <span data-ttu-id="e1668-124">Dans cet exemple, une activité `WriteLineWithNotification` personnalisée est définie.</span><span class="sxs-lookup"><span data-stu-id="e1668-124">In this example, a custom `WriteLineWithNotification` activity is defined.</span></span> <span data-ttu-id="e1668-125">Cette activité est composée d'un <xref:System.Activities.Statements.Sequence> qui contient une activité <xref:System.Activities.Statements.WriteLine> suivie d'un <xref:System.Activities.Statements.InvokeAction%601> qui appelle un <xref:System.Activities.ActivityAction%601> qui prend un argument de chaîne.</span><span class="sxs-lookup"><span data-stu-id="e1668-125">This activity is composed of a <xref:System.Activities.Statements.Sequence> that contains a <xref:System.Activities.Statements.WriteLine> activity followed by an <xref:System.Activities.Statements.InvokeAction%601> that invokes an <xref:System.Activities.ActivityAction%601> that takes one string argument.</span></span>

[!code-csharp[CFX_ActivityExample#1](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#1)]

<span data-ttu-id="e1668-126">Lorsqu'un workflow est créé à l'aide de l'activité `WriteLineWithNotification`, l'auteur de workflow spécifie la logique personnalisée voulue dans le <xref:System.Activities.ActivityDelegate.Handler%2A> de l'action de l'activité.</span><span class="sxs-lookup"><span data-stu-id="e1668-126">When a workflow is created by using the `WriteLineWithNotification` activity, the workflow author specifies the desired custom logic in the activity action’s <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span> <span data-ttu-id="e1668-127">Dans cet exemple, un workflow qui utilise l'activité `WriteLineWithNotification` est créé et une activité <xref:System.Activities.Statements.WriteLine> est utilisée comme <xref:System.Activities.ActivityDelegate.Handler%2A>.</span><span class="sxs-lookup"><span data-stu-id="e1668-127">In this example, a workflow is created that use the `WriteLineWithNotification` activity, and a <xref:System.Activities.Statements.WriteLine> activity is used as the <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span>

[!code-csharp[CFX_ActivityExample#2](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#2)]

<span data-ttu-id="e1668-128">Il existe plusieurs versions génériques de <xref:System.Activities.Statements.InvokeAction%601> et <xref:System.Activities.ActivityAction%601> fournies pour le passage d’un ou de plusieurs arguments.</span><span class="sxs-lookup"><span data-stu-id="e1668-128">There are multiple generic versions of <xref:System.Activities.Statements.InvokeAction%601> and <xref:System.Activities.ActivityAction%601> provided for passing one or more arguments.</span></span>

## <a name="using-activityfunc"></a><span data-ttu-id="e1668-129">Utilisation d'ActivityFunc</span><span class="sxs-lookup"><span data-stu-id="e1668-129">Using ActivityFunc</span></span>

<span data-ttu-id="e1668-130"><xref:System.Activities.ActivityAction%601> est utile en l'absence de valeur de résultat de l'activité et <xref:System.Activities.ActivityFunc%601> est utilisé lorsqu'une valeur de résultat est retournée.</span><span class="sxs-lookup"><span data-stu-id="e1668-130"><xref:System.Activities.ActivityAction%601> is useful when there is no result value from the activity, and <xref:System.Activities.ActivityFunc%601> is used when a result value is returned.</span></span> <span data-ttu-id="e1668-131">Lorsque vous créez une activité personnalisée qui définit un <xref:System.Activities.ActivityFunc%601>, utilisez un <xref:System.Activities.Expressions.InvokeFunc%601> pour modéliser l'appel de ce <xref:System.Activities.ActivityFunc%601>.</span><span class="sxs-lookup"><span data-stu-id="e1668-131">When creating a custom activity that defines an <xref:System.Activities.ActivityFunc%601>, use an <xref:System.Activities.Expressions.InvokeFunc%601> to model the invocation of that <xref:System.Activities.ActivityFunc%601>.</span></span> <span data-ttu-id="e1668-132">Dans l'exemple suivant, une activité `WriteFillerText` est définie.</span><span class="sxs-lookup"><span data-stu-id="e1668-132">In the following example, a `WriteFillerText` activity is defined.</span></span> <span data-ttu-id="e1668-133">Pour fournir le texte de remplissage, un <xref:System.Activities.Expressions.InvokeFunc%601> qui prend un argument entier et a un résultat de chaîne est spécifié.</span><span class="sxs-lookup"><span data-stu-id="e1668-133">To supply the filler text, an <xref:System.Activities.Expressions.InvokeFunc%601> is specified that takes an integer argument and has a string result.</span></span> <span data-ttu-id="e1668-134">Une fois le texte de remplissage récupéré, il est affiché sur la console à l'aide d'une activité <xref:System.Activities.Statements.WriteLine>.</span><span class="sxs-lookup"><span data-stu-id="e1668-134">Once the filler text is retrieved, it is displayed to the console using a <xref:System.Activities.Statements.WriteLine> activity.</span></span>

[!code-csharp[CFX_ActivityExample#3](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#3)]

<span data-ttu-id="e1668-135">Pour fournir le texte, une activité qui prend un argument `int` et a un résultat de chaîne doit être utilisée.</span><span class="sxs-lookup"><span data-stu-id="e1668-135">To supply the text, an activity must be used that takes one `int` argument and has a string result.</span></span> <span data-ttu-id="e1668-136">Cet exemple montre une activité `TextGenerator` qui répond à ces critères.</span><span class="sxs-lookup"><span data-stu-id="e1668-136">This example shows a `TextGenerator` activity that meets these requirements.</span></span>

[!code-csharp[CFX_ActivityExample#4](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#4)]

<span data-ttu-id="e1668-137">Pour utiliser l'activité `TextGenerator` avec l'activité `WriteFillerText`, spécifiez-la en tant que <xref:System.Activities.ActivityDelegate.Handler%2A>.</span><span class="sxs-lookup"><span data-stu-id="e1668-137">To use the `TextGenerator` activity with the `WriteFillerText` activity, specify it as the <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span>

[!code-csharp[CFX_ActivityExample#5](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#5)]

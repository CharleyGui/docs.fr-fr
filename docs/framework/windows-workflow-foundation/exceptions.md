---
title: Exceptions
ms.date: 03/30/2017
ms.assetid: 065205cc-52dd-4f30-9578-b17d8d113136
ms.openlocfilehash: b08fca37e9695f57f1fcca114531e8a1e8b90c55
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/28/2019
ms.locfileid: "64640909"
---
# <a name="exceptions"></a><span data-ttu-id="8f927-102">Exceptions</span><span class="sxs-lookup"><span data-stu-id="8f927-102">Exceptions</span></span>
<span data-ttu-id="8f927-103">Les flux de travail peuvent utiliser l'activité <xref:System.Activities.Statements.TryCatch> pour gérer des exceptions déclenchées lors de leur exécution.</span><span class="sxs-lookup"><span data-stu-id="8f927-103">Workflows can use the <xref:System.Activities.Statements.TryCatch> activity to handle exceptions that are raised during the execution of a workflow.</span></span> <span data-ttu-id="8f927-104">Ces exceptions peuvent être gérées ou être à nouveau levées à l'aide de l'activité <xref:System.Activities.Statements.Rethrow>.</span><span class="sxs-lookup"><span data-stu-id="8f927-104">These exceptions can be handled or they can be re-thrown using the <xref:System.Activities.Statements.Rethrow> activity.</span></span> <span data-ttu-id="8f927-105">Les activités de la section <xref:System.Activities.Statements.TryCatch.Finally%2A> sont exécutées lorsque soit la section <xref:System.Activities.Statements.TryCatch.Try%2A>, soit la section <xref:System.Activities.Statements.TryCatch.Catches%2A> est terminée.</span><span class="sxs-lookup"><span data-stu-id="8f927-105">Activities in the <xref:System.Activities.Statements.TryCatch.Finally%2A> section are executed when either the <xref:System.Activities.Statements.TryCatch.Try%2A> section or the <xref:System.Activities.Statements.TryCatch.Catches%2A> section completes.</span></span> <span data-ttu-id="8f927-106">Les workflows hébergés par un <xref:System.Activities.WorkflowApplication> instance peut également utiliser le <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> Gestionnaire d’événements pour gérer les exceptions qui ne sont pas gérées par un <xref:System.Activities.Statements.TryCatch> activité.</span><span class="sxs-lookup"><span data-stu-id="8f927-106">Workflows hosted by a <xref:System.Activities.WorkflowApplication> instance can also use the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> event handler to handle exceptions that are not handled by a <xref:System.Activities.Statements.TryCatch> activity.</span></span>  
  
## <a name="causes-of-exceptions"></a><span data-ttu-id="8f927-107">Raisons des exceptions</span><span class="sxs-lookup"><span data-stu-id="8f927-107">Causes of Exceptions</span></span>  
 <span data-ttu-id="8f927-108">Dans un workflow, les exceptions peuvent être générées des différentes manières suivantes :</span><span class="sxs-lookup"><span data-stu-id="8f927-108">In a workflow, exceptions can be generated in the following ways:</span></span>  
  
- <span data-ttu-id="8f927-109">délai d'expiration de transactions dans l'objet <xref:System.Activities.Statements.TransactionScope> ;</span><span class="sxs-lookup"><span data-stu-id="8f927-109">A time-out of transactions in <xref:System.Activities.Statements.TransactionScope>.</span></span>  
  
- <span data-ttu-id="8f927-110">exception explicite levée par le flux de travail à l'aide de l'activité <xref:System.Activities.Statements.Throw> ;</span><span class="sxs-lookup"><span data-stu-id="8f927-110">An explicit exception thrown by the workflow using the <xref:System.Activities.Statements.Throw> activity.</span></span>  
  
- <span data-ttu-id="8f927-111">exception [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] levée depuis une activité ;</span><span class="sxs-lookup"><span data-stu-id="8f927-111">A [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] exception thrown from an activity.</span></span>  
  
- <span data-ttu-id="8f927-112">exception levée par un code externe, tel que les bibliothèques, composants ou services utilisés dans le flux de travail.</span><span class="sxs-lookup"><span data-stu-id="8f927-112">An exception thrown from external code, such as libraries, components, or services that are used in the workflow.</span></span>  
  
## <a name="handling-exceptions"></a><span data-ttu-id="8f927-113">Gestion des exceptions</span><span class="sxs-lookup"><span data-stu-id="8f927-113">Handling Exceptions</span></span>  
 <span data-ttu-id="8f927-114">Si une exception est levée par une activité et n'est pas gérée, le comportement par défaut consiste à arrêter l'instance de flux de travail.</span><span class="sxs-lookup"><span data-stu-id="8f927-114">If an exception is thrown by an activity and is unhandled, the default behavior is to terminate the workflow instance.</span></span> <span data-ttu-id="8f927-115">En cas de présence d'un gestionnaire <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> personnalisé, il peut substituer ce comportement par défaut.</span><span class="sxs-lookup"><span data-stu-id="8f927-115">If a custom <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is present, it can override this default behavior.</span></span> <span data-ttu-id="8f927-116">Ce gestionnaire permet à l’auteur hôte du workflow de fournir la gestion appropriée, englobant par exemple l’enregistrement personnalisé, l’abandon de workflow, l’annulation de workflow ou l’arrêt de workflow.</span><span class="sxs-lookup"><span data-stu-id="8f927-116">This handler gives the workflow host author an opportunity to provide the appropriate handling, such as custom logging, aborting the workflow, canceling the workflow, or terminating the workflow.</span></span>  <span data-ttu-id="8f927-117">Si un workflow lève une exception qui n'est pas gérée, le gestionnaire <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> est appelé.</span><span class="sxs-lookup"><span data-stu-id="8f927-117">If a workflow raises an exception that is not handled, the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is invoked.</span></span> <span data-ttu-id="8f927-118">Il existe trois actions possibles retournées depuis <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> qui déterminent les résultats finaux du flux de travail.</span><span class="sxs-lookup"><span data-stu-id="8f927-118">There are three possible actions returned from <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> which determine the final outcome of the workflow.</span></span>  
  
- <span data-ttu-id="8f927-119">**Annuler** -une instance de flux de travail annulé est une sortie normale de l’exécution d’une branche.</span><span class="sxs-lookup"><span data-stu-id="8f927-119">**Cancel** - A cancelled workflow instance is a graceful exit of a branch execution.</span></span> <span data-ttu-id="8f927-120">Vous pouvez modéliser le comportement d'annulation (par exemple, en utilisant une activité CancellationScope).</span><span class="sxs-lookup"><span data-stu-id="8f927-120">You can model cancelation behavior (for example, by using a CancellationScope activity).</span></span> <span data-ttu-id="8f927-121">Le gestionnaire Completed est appelé lorsque le processus d'annulation se termine.</span><span class="sxs-lookup"><span data-stu-id="8f927-121">The Completed handler is invoked when the cancellation process completes.</span></span> <span data-ttu-id="8f927-122">Un flux de travail annulé est dans un état d'annulation.</span><span class="sxs-lookup"><span data-stu-id="8f927-122">A cancelled workflow is in the Cancelled state.</span></span>  
  
- <span data-ttu-id="8f927-123">**Mettre fin à** -une instance de workflow terminée ne peut pas être reprise ou redémarrée.</span><span class="sxs-lookup"><span data-stu-id="8f927-123">**Terminate** - A terminated workflow instance cannot be resumed or restarted.</span></span>  <span data-ttu-id="8f927-124">Cela déclenche l'événement Completed dans lequel vous pouvez fournir une exception comme la raison de l'arrêt.</span><span class="sxs-lookup"><span data-stu-id="8f927-124">This triggers the Completed event in which you can provide an exception as the reason it was terminated.</span></span> <span data-ttu-id="8f927-125">Le gestionnaire Terminated est appelé lorsque le processus d'arrêt se termine.</span><span class="sxs-lookup"><span data-stu-id="8f927-125">The Terminated handler is invoked when the termination process completes.</span></span> <span data-ttu-id="8f927-126">Un flux de travail terminé est dans l'état d'erreur.</span><span class="sxs-lookup"><span data-stu-id="8f927-126">A terminated workflow is in the Faulted state.</span></span>  
  
- <span data-ttu-id="8f927-127">**Abandonner** -une instance de flux de travail abandonnée peut être repris uniquement s’il a été configuré pour être persistant.</span><span class="sxs-lookup"><span data-stu-id="8f927-127">**Abort** - An aborted workflow instances can be resumed only if it has been configured to be persistent.</span></span>  <span data-ttu-id="8f927-128">Sans persistance, un flux de travail ne peut pas être repris.</span><span class="sxs-lookup"><span data-stu-id="8f927-128">Without persistence, a workflow cannot be resumed.</span></span>  <span data-ttu-id="8f927-129">Au stade où un flux de travail est abandonné, les tâches effectuées (en mémoire) depuis le dernier point de persistance sont perdues.</span><span class="sxs-lookup"><span data-stu-id="8f927-129">At the point a workflow is aborted, any work done (in memory) since the last persistence point will be lost.</span></span> <span data-ttu-id="8f927-130">Pour un workflow abandonné, le gestionnaire Aborted est appelé en utilisant l'exception comme raison lorsque le processus d'abandon est terminé.</span><span class="sxs-lookup"><span data-stu-id="8f927-130">For an aborted workflow, the Aborted handler is invoked using the exception as the reason when the abort process completes.</span></span> <span data-ttu-id="8f927-131">Toutefois, contrairement aux gestionnaires Cancelled et Terminated, le gestionnaire Completed n'est pas appelé.</span><span class="sxs-lookup"><span data-stu-id="8f927-131">However, unlike Cancelled and Terminated, the Completed handler is not invoked.</span></span> <span data-ttu-id="8f927-132">Un flux de travail abandonné est dans un état d'abandon.</span><span class="sxs-lookup"><span data-stu-id="8f927-132">An aborted workflow is in an Aborted state.</span></span>  
  
 <span data-ttu-id="8f927-133">L'exemple suivant appelle un workflow qui lève une exception.</span><span class="sxs-lookup"><span data-stu-id="8f927-133">The following example invokes a workflow that throws an exception.</span></span> <span data-ttu-id="8f927-134">L'exception n'est pas prise en charge par le workflow et le gestionnaire <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> est appelé.</span><span class="sxs-lookup"><span data-stu-id="8f927-134">The exception is unhandled by the workflow and the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is invoked.</span></span> <span data-ttu-id="8f927-135">L'objet <xref:System.Activities.WorkflowApplicationUnhandledExceptionEventArgs> est inspecté de façon à fournir des informations sur l'exception, et le workflow est arrêté.</span><span class="sxs-lookup"><span data-stu-id="8f927-135">The <xref:System.Activities.WorkflowApplicationUnhandledExceptionEventArgs> are inspected to provide information about the exception, and the workflow is terminated.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#1](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#1)]  
  
### <a name="handling-exceptions-with-the-trycatch-activity"></a><span data-ttu-id="8f927-136">Gestion des exceptions avec l'activité TryCatch</span><span class="sxs-lookup"><span data-stu-id="8f927-136">Handling Exceptions with the TryCatch Activity</span></span>  
 <span data-ttu-id="8f927-137">La gestion des exceptions au sein d'un workflow est effectuée avec l'activité <xref:System.Activities.Statements.TryCatch>.</span><span class="sxs-lookup"><span data-stu-id="8f927-137">Handling exceptions inside a workflow is performed with the <xref:System.Activities.Statements.TryCatch> activity.</span></span> <span data-ttu-id="8f927-138">L’activité <xref:System.Activities.Statements.TryCatch> possède une collection <xref:System.Activities.Statements.TryCatch.Catches%2A> des activités <xref:System.Activities.Statements.Catch> qui sont toutes associées à un type <xref:System.Exception> spécifique.</span><span class="sxs-lookup"><span data-stu-id="8f927-138">The <xref:System.Activities.Statements.TryCatch> activity has a <xref:System.Activities.Statements.TryCatch.Catches%2A> collection of <xref:System.Activities.Statements.Catch> activities that are each associated with a specific <xref:System.Exception> type.</span></span> <span data-ttu-id="8f927-139">Si l'exception levée par une activité contenue dans la section <xref:System.Activities.Statements.TryCatch.Try%2A> d'une activité <xref:System.Activities.Statements.TryCatch> correspond à l'exception d'une activité <xref:System.Activities.Statements.Catch%601> dans la collection <xref:System.Activities.Statements.TryCatch.Catches%2A>, elle est gérée.</span><span class="sxs-lookup"><span data-stu-id="8f927-139">If the exception thrown by an activity that is contained in the <xref:System.Activities.Statements.TryCatch.Try%2A> section of a <xref:System.Activities.Statements.TryCatch> activity matches the exception of a <xref:System.Activities.Statements.Catch%601> activity in the <xref:System.Activities.Statements.TryCatch.Catches%2A> collection, then the exception is handled.</span></span> <span data-ttu-id="8f927-140">L'exception passe à l'activité parente si elle est explicitement à nouveau levée ou si une nouvelle exception est levée.</span><span class="sxs-lookup"><span data-stu-id="8f927-140">If the exception is explicitly re-thrown or a new exception is thrown then this exception passes up to the parent activity.</span></span> <span data-ttu-id="8f927-141">L'exemple de code suivant illustre une activité <xref:System.Activities.Statements.TryCatch> qui gère un objet <xref:System.ApplicationException> levé dans la section <xref:System.Activities.Statements.TryCatch.Try%2A> par une activité <xref:System.Activities.Statements.Throw>.</span><span class="sxs-lookup"><span data-stu-id="8f927-141">The following code example shows a <xref:System.Activities.Statements.TryCatch> activity that handles an <xref:System.ApplicationException> that is thrown in the <xref:System.Activities.Statements.TryCatch.Try%2A> section by a <xref:System.Activities.Statements.Throw> activity.</span></span> <span data-ttu-id="8f927-142">Le message de l'exception est écrit sur la console par l'activité <xref:System.Activities.Statements.Catch%601>, puis un message est écrit sur la console dans la section <xref:System.Activities.Statements.TryCatch.Finally%2A>.</span><span class="sxs-lookup"><span data-stu-id="8f927-142">The exception's message is written to the console by the <xref:System.Activities.Statements.Catch%601> activity, and then a message is written to the console in the <xref:System.Activities.Statements.TryCatch.Finally%2A> section.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#33](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#33)]  
  
 <span data-ttu-id="8f927-143">Les activités dans la section <xref:System.Activities.Statements.TryCatch.Finally%2A> sont exécutées lorsque soit la section <xref:System.Activities.Statements.TryCatch.Try%2A>, soit la section <xref:System.Activities.Statements.TryCatch.Catches%2A> est terminée correctement.</span><span class="sxs-lookup"><span data-stu-id="8f927-143">The activities in the <xref:System.Activities.Statements.TryCatch.Finally%2A> section are executed when either the <xref:System.Activities.Statements.TryCatch.Try%2A> section or the <xref:System.Activities.Statements.TryCatch.Catches%2A> section successfully completes.</span></span> <span data-ttu-id="8f927-144">La section <xref:System.Activities.Statements.TryCatch.Try%2A> se termine correctement si aucune exception n'est levée, et la section <xref:System.Activities.Statements.TryCatch.Catches%2A> se termine correctement si aucune exception n'est levée ou à nouveau levée.</span><span class="sxs-lookup"><span data-stu-id="8f927-144">The <xref:System.Activities.Statements.TryCatch.Try%2A> section successfully completes if no exceptions are thrown from it, and the <xref:System.Activities.Statements.TryCatch.Catches%2A> section successfully completes if no exceptions are thrown or rethrown from it.</span></span> <span data-ttu-id="8f927-145">Si une exception est levée dans la section <xref:System.Activities.Statements.TryCatch.Try%2A> d'un <xref:System.Activities.Statements.TryCatch> et n'est pas gérée par <xref:System.Activities.Statements.Catch%601> dans la section <xref:System.Activities.Statements.TryCatch.Catches%2A>, ou est à nouveau levée dans <xref:System.Activities.Statements.TryCatch.Catches%2A>, les activités dans <xref:System.Activities.Statements.TryCatch.Finally%2A> ne seront pas exécutées à moins qu'une des opérations suivantes se produise.</span><span class="sxs-lookup"><span data-stu-id="8f927-145">If an exception is thrown in the <xref:System.Activities.Statements.TryCatch.Try%2A> section of a <xref:System.Activities.Statements.TryCatch> and is either not handled by a <xref:System.Activities.Statements.Catch%601> in the <xref:System.Activities.Statements.TryCatch.Catches%2A> section, or is rethrown from the <xref:System.Activities.Statements.TryCatch.Catches%2A>, the activities in the <xref:System.Activities.Statements.TryCatch.Finally%2A> will not be executed unless the one of the following occurs.</span></span>  
  
- <span data-ttu-id="8f927-146">L'exception est interceptée par une activité <xref:System.Activities.Statements.TryCatch> de plus haut niveau dans le flux de travail, qu'elle soit levée de nouveau ou non à partir de cette activité <xref:System.Activities.Statements.TryCatch> de niveau supérieur.</span><span class="sxs-lookup"><span data-stu-id="8f927-146">The exception is caught by a higher level <xref:System.Activities.Statements.TryCatch> activity in the workflow, regardless of whether it is rethrown from that higher level <xref:System.Activities.Statements.TryCatch>.</span></span>  
  
- <span data-ttu-id="8f927-147">L'exception n'est pas gérée par une activité <xref:System.Activities.Statements.TryCatch> de niveau supérieur, s'échappe de la racine du flux de travail et le flux de travail est configuré de sorte à annuler au lieu de terminer ou abandonner.</span><span class="sxs-lookup"><span data-stu-id="8f927-147">The exception is not handled by a higher level <xref:System.Activities.Statements.TryCatch>, escapes the root of the workflow, and the workflow is configured to cancel instead of terminate or abort.</span></span> <span data-ttu-id="8f927-148">Les flux de travail hébergés à l'aide de <xref:System.Activities.WorkflowApplication> peuvent configurer cela en gérant <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> et en retournant <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span><span class="sxs-lookup"><span data-stu-id="8f927-148">Workflows hosted using <xref:System.Activities.WorkflowApplication> can configure this by handling <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> and returning <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span></span> <span data-ttu-id="8f927-149">Un exemple de gestion <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> est disponible précédemment dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="8f927-149">An example of handling <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> is provided previously in this topic.</span></span> <span data-ttu-id="8f927-150">Les services de flux de travail peuvent configurer cette opération à l'aide de <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> et en spécifiant <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel>.</span><span class="sxs-lookup"><span data-stu-id="8f927-150">Workflow services can configure this by using <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> and specifying <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel>.</span></span> <span data-ttu-id="8f927-151">Pour obtenir un exemple de configuration <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior>, consultez [Workflow Service Host Extensibility](../wcf/feature-details/workflow-service-host-extensibility.md).</span><span class="sxs-lookup"><span data-stu-id="8f927-151">For an example of configuring <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior>, see [Workflow Service Host Extensibility](../wcf/feature-details/workflow-service-host-extensibility.md).</span></span>  
  
## <a name="exception-handling-versus-compensation"></a><span data-ttu-id="8f927-152">Gestion des exceptions et compensation</span><span class="sxs-lookup"><span data-stu-id="8f927-152">Exception Handling versus Compensation</span></span>  
 <span data-ttu-id="8f927-153">La différence entre la gestion des exceptions et la compensation réside dans le fait que la gestion des exceptions a lieu lors de l'exécution d'une activité.</span><span class="sxs-lookup"><span data-stu-id="8f927-153">The difference between exception handling and compensation is that exception handling occurs during the execution of an activity.</span></span> <span data-ttu-id="8f927-154">La compensation a lieu une fois une activité terminée correctement.</span><span class="sxs-lookup"><span data-stu-id="8f927-154">Compensation occurs after an activity has successfully completed.</span></span> <span data-ttu-id="8f927-155">La gestion des exceptions permet de nettoyer une fois l'exception levée par l'activité, tandis que la compensation fournit un mécanisme permettant d'annuler un travail correctement terminé d'une activité précédemment terminée.</span><span class="sxs-lookup"><span data-stu-id="8f927-155">Exception handling provides an opportunity to clean up after the activity raises the exception, whereas compensation provides a mechanism by which the successfully completed work of a previously completed activity can be undone.</span></span> <span data-ttu-id="8f927-156">Pour plus d’informations, consultez [Compensation](compensation.md).</span><span class="sxs-lookup"><span data-stu-id="8f927-156">For more information, see [Compensation](compensation.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8f927-157">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="8f927-157">See also</span></span>

- <xref:System.Activities.Statements.TryCatch>
- <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A>
- <xref:System.Activities.Statements.CompensableActivity>

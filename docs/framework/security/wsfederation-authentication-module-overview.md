---
title: Vue d’ensemble du module d’authentification WSFederation
ms.date: 03/30/2017
ms.assetid: 02c4d5e8-f0a7-49ee-9cf5-3647578510ad
author: BrucePerlerMS
ms.openlocfilehash: f4dc63272c47dc0cd9eaa15986e4369d9d689b64
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/28/2019
ms.locfileid: "64592363"
---
# <a name="wsfederation-authentication-module-overview"></a><span data-ttu-id="9c48b-102">Vue d’ensemble du module d’authentification WSFederation</span><span class="sxs-lookup"><span data-stu-id="9c48b-102">WSFederation Authentication Module Overview</span></span>
<span data-ttu-id="9c48b-103">Windows Identity Foundation (WIF) prend en charge l’authentification fédérée dans les applications ASP.NET par le biais du module WS-FAM (WS-Federated Authentication Module).</span><span class="sxs-lookup"><span data-stu-id="9c48b-103">Windows Identity Foundation (WIF) includes support for federated authentication in ASP.NET applications through the WS-Federated Authentication Module (WS-FAM).</span></span> <span data-ttu-id="9c48b-104">Cette rubrique explique le fonctionnement et l’utilisation de l’authentification fédérée.</span><span class="sxs-lookup"><span data-stu-id="9c48b-104">This topic will help you understand how federated authentication works and how to use it.</span></span>  
  
### <a name="overview-of-federated-authentication"></a><span data-ttu-id="9c48b-105">Vue d’ensemble de l’authentification fédérée</span><span class="sxs-lookup"><span data-stu-id="9c48b-105">Overview of Federated Authentication</span></span>  
 <span data-ttu-id="9c48b-106">L’authentification fédérée permet à un service d’émission de jeton de sécurité (STS) dans un domaine d’approbation de fournir des informations d’authentification à un STS situé dans un autre domaine d’approbation avec lequel il a une relation d’approbation.</span><span class="sxs-lookup"><span data-stu-id="9c48b-106">Federated authentication allows a Security Token Service (STS) in one trust domain to provide authentication information to an STS in another trust domain when there is a trust relationship between the two domains.</span></span> <span data-ttu-id="9c48b-107">Un exemple de ceci est illustré dans l’illustration suivante :</span><span class="sxs-lookup"><span data-stu-id="9c48b-107">An example of this is shown in the following illustration:</span></span>  
  
 ![Diagramme montrant le scénario d’authentification fédérée.](./media/wsfederation-authentication-module-overview/federated-authentication.gif)  
  
1. <span data-ttu-id="9c48b-109">Un client situé dans le domaine d’approbation Fabrikam envoie une demande à une application par partie de confiance qui se trouve dans le domaine d’approbation Contoso.</span><span class="sxs-lookup"><span data-stu-id="9c48b-109">A client in the Fabrikam trust domain sends a request to a Relying Party (RP) application in the Contoso trust domain.</span></span>  
  
2. <span data-ttu-id="9c48b-110">La partie de confiance redirige le client vers un STS du domaine d’approbation Contoso.</span><span class="sxs-lookup"><span data-stu-id="9c48b-110">The RP redirects the client to an STS in the Contoso trust domain.</span></span> <span data-ttu-id="9c48b-111">Ce STS ne connaît pas le client.</span><span class="sxs-lookup"><span data-stu-id="9c48b-111">This STS has no knowledge of the client.</span></span>  
  
3. <span data-ttu-id="9c48b-112">Le STS Contoso redirige le client vers un STS situé dans le domaine d’approbation Fabrikam, avec lequel le domaine d’approbation Contoso a une relation d’approbation.</span><span class="sxs-lookup"><span data-stu-id="9c48b-112">The Contoso STS redirects the client to an STS in the Fabrikam trust domain, with which the Contoso trust domain has a trust relationship.</span></span>  
  
4. <span data-ttu-id="9c48b-113">Le STS Fabrikam vérifie l’identité du client et envoie un jeton de sécurité au STS Contoso.</span><span class="sxs-lookup"><span data-stu-id="9c48b-113">The Fabrikam STS verifies the client’s identity and issues a security token to the Contoso STS.</span></span>  
  
5. <span data-ttu-id="9c48b-114">Le STS Contoso utilise le jeton Fabrikam pour créer son propre jeton utilisable par la partie de confiance et l’envoie à celle-ci.</span><span class="sxs-lookup"><span data-stu-id="9c48b-114">The Contoso STS uses the Fabrikam token to create its own token that can be used by the RP and sends it to the RP.</span></span>  
  
6. <span data-ttu-id="9c48b-115">La partie de confiance extrait les revendications du client à partir du jeton de sécurité et rend une décision d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="9c48b-115">The RP extracts the client’s claims from the security token and makes an authorization decision.</span></span>  
  
### <a name="using-the-federated-authentication-module-with-aspnet"></a><span data-ttu-id="9c48b-116">Utilisation du module d’authentification fédérée avec ASP.NET</span><span class="sxs-lookup"><span data-stu-id="9c48b-116">Using the Federated Authentication Module with ASP.NET</span></span>  
 <span data-ttu-id="9c48b-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule> (WS-FAM) est un module HTTP qui permet d’ajouter l’authentification fédérée à une application [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9c48b-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule> (WS-FAM) is an HTTP module that lets you add federated authentication to an [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span> <span data-ttu-id="9c48b-118">Grâce à l’authentification fédérée, la logique d’authentification est gérée par le STS. Vous pouvez ainsi vous concentrer sur le travail d’écriture de la logique métier.</span><span class="sxs-lookup"><span data-stu-id="9c48b-118">Federated authentication lets authentication logic be handled by the STS and lets you focus on writing business logic.</span></span>  
  
 <span data-ttu-id="9c48b-119">Vous configurez le module WS-FAM pour spécifier le STS vers lequel les demandes non authentifiées doivent être redirigées.</span><span class="sxs-lookup"><span data-stu-id="9c48b-119">You configure the WS-FAM to specify the STS to which non-authenticated requests should be redirected.</span></span> <span data-ttu-id="9c48b-120">WIF vous permet d’authentifier un utilisateur selon deux méthodes :</span><span class="sxs-lookup"><span data-stu-id="9c48b-120">WIF lets you authenticate a user in two ways:</span></span>  
  
1. <span data-ttu-id="9c48b-121">Redirection passive : Lorsqu’un utilisateur non authentifié tente d’accéder à une ressource protégée, et que vous souhaitez simplement les rediriger vers un service STS sans nécessiter une page de connexion, il s’agit de la bonne approche.</span><span class="sxs-lookup"><span data-stu-id="9c48b-121">Passive redirect: When an unauthenticated user tries to access a protected resource, and you want to simply redirect them to an STS without requiring a login page, then this is the right approach.</span></span> <span data-ttu-id="9c48b-122">Le STS vérifie l’identité de l’utilisateur et émet un jeton de sécurité qui contient les revendications appropriées pour cet utilisateur.</span><span class="sxs-lookup"><span data-stu-id="9c48b-122">The STS verifies the user’s identity, and issues a security token that contains the appropriate claims for that user.</span></span> <span data-ttu-id="9c48b-123">Cette méthode nécessite l’ajout du module WS-FAM dans le pipeline des modules HTTP.</span><span class="sxs-lookup"><span data-stu-id="9c48b-123">This option requires the WS-FAM to be added in the HTTP Modules pipeline.</span></span> <span data-ttu-id="9c48b-124">L’outil Identity and Access pour Visual Studio 2012 vous permet de modifier le fichier de configuration de votre application afin d’utiliser le module WS-FAM et la fédération avec un STS.</span><span class="sxs-lookup"><span data-stu-id="9c48b-124">You can use the Identity and Access Tool for Visual Studio 2012 to modify your application’s configuration file to use the WS-FAM and to federate with an STS.</span></span> <span data-ttu-id="9c48b-125">Pour plus d’informations, consultez [Identity and Access Tool pour Visual Studio 2012](../../../docs/framework/security/identity-and-access-tool-for-vs.md).</span><span class="sxs-lookup"><span data-stu-id="9c48b-125">For more information, see [Identity and Access Tool for Visual Studio 2012](../../../docs/framework/security/identity-and-access-tool-for-vs.md).</span></span>  
  
2. <span data-ttu-id="9c48b-126">Vous pouvez appeler la méthode <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType> ou la méthode <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A> à partir du code-behind pour afficher une page de connexion dans votre application par partie de confiance.</span><span class="sxs-lookup"><span data-stu-id="9c48b-126">You can call the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType> method or the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A> method from the code-behind for a sign-in page in your RP application.</span></span>  
  
 <span data-ttu-id="9c48b-127">Avec la redirection passive, toutes les communications sont effectuées par réponse/redirection du client (en général, un navigateur).</span><span class="sxs-lookup"><span data-stu-id="9c48b-127">In passive redirect, all communication is performed through response/redirect from the client (typically a browser).</span></span> <span data-ttu-id="9c48b-128">Vous pouvez ajouter le module WS-FAM au pipeline HTTP de votre application, où il surveille les demandes d’utilisateurs non authentifiés et redirige ces utilisateurs vers le STS que vous spécifiez.</span><span class="sxs-lookup"><span data-stu-id="9c48b-128">You can add the WS-FAM to your application’s HTTP pipeline, where it watches for unauthenticated user requests and redirects users to the STS you specify.</span></span>  
  
 <span data-ttu-id="9c48b-129">WS-FAM déclenche également plusieurs événements qui vous permettent de personnaliser ses fonctionnalités dans une application [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9c48b-129">The WS-FAM also raises several events that let you customize its functionality in an [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span>  
  
### <a name="how-the-ws-fam-works"></a><span data-ttu-id="9c48b-130">Fonctionnement du module WS-FAM</span><span class="sxs-lookup"><span data-stu-id="9c48b-130">How the WS-FAM Works</span></span>  
 <span data-ttu-id="9c48b-131">Le module WS-FAM est implémenté dans la classe <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="9c48b-131">The WS-FAM is implemented in the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> class.</span></span> <span data-ttu-id="9c48b-132">En règle générale, vous ajoutez le module WS-FAM au pipeline HTTP de votre application par partie de confiance [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9c48b-132">Typically, you add the WS-FAM to the HTTP pipeline of your [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] RP application.</span></span> <span data-ttu-id="9c48b-133">Quand un utilisateur non authentifié tente d’accéder à une ressource protégée, la partie de confiance retourne une réponse HTTP de type « Erreur 401 : autorisation refusée ».</span><span class="sxs-lookup"><span data-stu-id="9c48b-133">When an unauthenticated user tries to access a protected resource, the RP returns a "401 authorization denied" HTTP response.</span></span> <span data-ttu-id="9c48b-134">Le module WS-FAM intercepte cette réponse avant qu’elle soit reçue par le client, puis il redirige l’utilisateur vers le STS spécifié.</span><span class="sxs-lookup"><span data-stu-id="9c48b-134">The WS-FAM intercepts this response instead of allowing the client to receive it, then it redirects the user to the specified STS.</span></span> <span data-ttu-id="9c48b-135">Le STS émet un jeton de sécurité, que le module WS-FAM intercepte encore.</span><span class="sxs-lookup"><span data-stu-id="9c48b-135">The STS issues a security token, which the WS-FAM again intercepts.</span></span> <span data-ttu-id="9c48b-136">Le module WS-FAM utilise le jeton pour créer une instance de <xref:System.Security.Claims.ClaimsPrincipal> pour l’utilisateur authentifié, ce qui permet aux mécanismes d’autorisation [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] habituels de fonctionner.</span><span class="sxs-lookup"><span data-stu-id="9c48b-136">The WS-FAM uses the token to create an instance of <xref:System.Security.Claims.ClaimsPrincipal> for the authenticated user, which enables regular [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] authorization mechanisms to function.</span></span>  
  
 <span data-ttu-id="9c48b-137">Étant donné que le protocole HTTP est sans état, vous devez empêcher la répétition de ce processus à chaque tentative de l’utilisateur d’accéder à une ressource protégée.</span><span class="sxs-lookup"><span data-stu-id="9c48b-137">Because HTTP is stateless, we need a way to avoid repeating this whole process every time that the user tries to access another protected resource.</span></span> <span data-ttu-id="9c48b-138">Pour cela, utilisez <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="9c48b-138">This is where the <xref:System.IdentityModel.Services.SessionAuthenticationModule> comes in.</span></span> <span data-ttu-id="9c48b-139">Quand le STS émet un jeton de sécurité pour l’utilisateur, <xref:System.IdentityModel.Services.SessionAuthenticationModule> crée également un jeton de sécurité de session pour l’utilisateur et le place dans un cookie.</span><span class="sxs-lookup"><span data-stu-id="9c48b-139">When the STS issues a security token for the user, <xref:System.IdentityModel.Services.SessionAuthenticationModule> also creates a session security token for the user and puts it in a cookie.</span></span> <span data-ttu-id="9c48b-140">Lors des demandes suivantes, <xref:System.IdentityModel.Services.SessionAuthenticationModule> intercepte ce cookie et l’utilise pour reconstruire le <xref:System.Security.Claims.ClaimsPrincipal> de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="9c48b-140">On subsequent requests, the <xref:System.IdentityModel.Services.SessionAuthenticationModule> intercepts this cookie and uses it to reconstruct the user’s <xref:System.Security.Claims.ClaimsPrincipal>.</span></span>  
  
 <span data-ttu-id="9c48b-141">Le diagramme suivant illustre le flux global des données dans le cas de la redirection passive.</span><span class="sxs-lookup"><span data-stu-id="9c48b-141">The following diagram shows the overall flow of information in the passive redirect case.</span></span> <span data-ttu-id="9c48b-142">La demande est automatiquement redirigée via le STS pour spécifier les informations d’identification sans passer par une page de connexion :</span><span class="sxs-lookup"><span data-stu-id="9c48b-142">The request is automatically redirected via the STS to establish credentials without a login page:</span></span>  
  
 ![Diagramme illustrant connectez-vous avec redirection passive.](./media/wsfederation-authentication-module-overview/sign-in-using-passive-redirect.gif)  
  
 <span data-ttu-id="9c48b-144">Le diagramme suivant détaille ce qui se passe quand l’utilisateur est authentifié auprès du STS et que ses jetons de sécurité sont traités par <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> :</span><span class="sxs-lookup"><span data-stu-id="9c48b-144">The following diagram shows more detail on what happens when the user has authenticated to the STS and their security tokens are processed by the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="9c48b-145">![Minutage du traitement des jetons avec la redirection passive](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span><span class="sxs-lookup"><span data-stu-id="9c48b-145">![Timing for token processing with passive redirect](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span></span>  
  
 <span data-ttu-id="9c48b-146">Le diagramme suivant montre en détail ce qui se passe quand les jetons de sécurité de l’utilisateur ont été sérialisés dans des cookies, puis interceptés par <xref:System.IdentityModel.Services.SessionAuthenticationModule> :</span><span class="sxs-lookup"><span data-stu-id="9c48b-146">The following diagram shows more detail on what happens when the user’s security tokens have been serialized into cookies and are intercepted by the <xref:System.IdentityModel.Services.SessionAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="9c48b-147">![Diagramme de minutage SAM de la connexion avec des contrôles](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span><span class="sxs-lookup"><span data-stu-id="9c48b-147">![SAM timing diagram showing sign&#45;in using controls](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span></span>  
  
### <a name="events"></a><span data-ttu-id="9c48b-148">Événements</span><span class="sxs-lookup"><span data-stu-id="9c48b-148">Events</span></span>  
 <span data-ttu-id="9c48b-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule> et leur classe parente <xref:System.IdentityModel.Services.HttpModuleBase> déclenchent des événements à différentes étapes du traitement d’une requête HTTP.</span><span class="sxs-lookup"><span data-stu-id="9c48b-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule>, and their parent class, <xref:System.IdentityModel.Services.HttpModuleBase>, raise events at various stages of processing of an HTTP request.</span></span> <span data-ttu-id="9c48b-150">Gérez ces événements dans le fichier `global.asax` de votre application [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9c48b-150">You can handle these events in the `global.asax` file of your [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span>  
  
- <span data-ttu-id="9c48b-151">L’infrastructure ASP.NET appelle la méthode <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> du module pour initialiser le module.</span><span class="sxs-lookup"><span data-stu-id="9c48b-151">The ASP.NET infrastructure invokes the module’s <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method to initialize the module.</span></span>  
  
- <span data-ttu-id="9c48b-152">L’événement <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType> est déclenché quand l’infrastructure ASP.NET appelle la méthode <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> pour la première fois sur l’un des modules de l’application qui dérivent de <xref:System.IdentityModel.Services.HttpModuleBase>.</span><span class="sxs-lookup"><span data-stu-id="9c48b-152">The <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType> event is raised when the ASP.NET infrastructure invokes the <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method for the first time on one of the application’s modules that derive from <xref:System.IdentityModel.Services.HttpModuleBase>.</span></span> <span data-ttu-id="9c48b-153">Cette méthode accède à la propriété <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType> statique, qui spécifie le chargement de la configuration à partir du fichier Web.config.</span><span class="sxs-lookup"><span data-stu-id="9c48b-153">This method accesses the static <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType> property, which causes configuration to be loaded from the Web.config file.</span></span> <span data-ttu-id="9c48b-154">Cet événement est déclenché uniquement lors du premier accès à cette propriété.</span><span class="sxs-lookup"><span data-stu-id="9c48b-154">This event is only raised the first time this property is accessed.</span></span> <span data-ttu-id="9c48b-155">L’objet <xref:System.IdentityModel.Services.Configuration.FederationConfiguration> initialisé à partir de la configuration est accessible par le biais de la propriété <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType> dans un gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="9c48b-155">The <xref:System.IdentityModel.Services.Configuration.FederationConfiguration> object that is initialized from configuration can be accessed through the <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType> property in an event handler.</span></span> <span data-ttu-id="9c48b-156">Vous pouvez utiliser cet événement pour modifier la configuration avant de l’appliquer aux modules.</span><span class="sxs-lookup"><span data-stu-id="9c48b-156">You can use this event to modify the configuration before it is applied to any modules.</span></span> <span data-ttu-id="9c48b-157">Vous pouvez ajouter un gestionnaire pour cet événement dans la méthode Application_Start :</span><span class="sxs-lookup"><span data-stu-id="9c48b-157">You can add a handler for this event in the Application_Start method:</span></span>  
  
    ```  
    void Application_Start(object sender, EventArgs e)  
    {  
        FederatedAuthentication.FederationConfigurationCreated += new EventHandler<FederationConfigurationCreatedEventArgs>(FederatedAuthentication_FederationConfigurationCreated);  
    }  
    ```  
  
     <span data-ttu-id="9c48b-158">Chaque module substitue les méthodes abstraites <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> et <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="9c48b-158">Each module overrides the <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> and <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType> abstract methods.</span></span> <span data-ttu-id="9c48b-159">La première de ces méthodes ajoute des gestionnaires pour les événements de pipeline ASP.NET qui sont pertinents pour le module.</span><span class="sxs-lookup"><span data-stu-id="9c48b-159">The first of these methods adds handlers for ASP.NET pipeline events that are of interest to the module.</span></span> <span data-ttu-id="9c48b-160">Dans la plupart des cas, l’implémentation par défaut du module est suffisante.</span><span class="sxs-lookup"><span data-stu-id="9c48b-160">In most cases the module’s default implementation will suffice.</span></span> <span data-ttu-id="9c48b-161">La seconde méthode initialise les propriétés du module à partir de sa propriété <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="9c48b-161">The second of these methods initializes the module’s properties from its <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="9c48b-162">(Il s’agit d’une copie de la configuration ayant déjà été chargée.) Vous devrez substituer cette deuxième méthode si vous souhaitez autoriser l’initialisation de nouvelles propriétés à partir de la configuration dans les classes que vous dérivez de <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> ou <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="9c48b-162">(This is a copy of the configuration that was loaded previously.) You may need to override this second method if you want to support the initialization of new properties from configuration in classes that you derive from <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="9c48b-163">Pour la prise en charge des propriétés de configuration supplémentaires, vous devrez également les dériver à partir des objets de configuration appropriés, par exemple <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration> ou <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span><span class="sxs-lookup"><span data-stu-id="9c48b-163">In such cases you would also need to derive from the appropriate configuration objects to support the added configuration properties; for example, from <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration>, or <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span></span>  
  
- <span data-ttu-id="9c48b-164">Le module WS-FAM déclenche l’événement <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived> quand il intercepte un jeton de sécurité ayant été émis par le STS.</span><span class="sxs-lookup"><span data-stu-id="9c48b-164">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived> event when it intercepts a security token that has been issued by the STS.</span></span>  
  
- <span data-ttu-id="9c48b-165">Le module WS-FAM déclenche l’événement <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated> une fois qu’il a validé le jeton.</span><span class="sxs-lookup"><span data-stu-id="9c48b-165">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated> event after it has validated the token.</span></span>  
  
- <span data-ttu-id="9c48b-166"><xref:System.IdentityModel.Services.SessionAuthenticationModule> déclenche l’événement <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated> quand il crée un jeton de sécurité de session pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="9c48b-166">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated> event when it creates a session security token for the user.</span></span>  
  
- <span data-ttu-id="9c48b-167"><xref:System.IdentityModel.Services.SessionAuthenticationModule> déclenche l’événement <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived> quand il intercepte d’autres demandes avec le cookie contenant le jeton de sécurité de session.</span><span class="sxs-lookup"><span data-stu-id="9c48b-167">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived> event when it intercepts subsequent requests with the cookie that contains the session security token.</span></span>  
  
- <span data-ttu-id="9c48b-168">Avant de rediriger l’utilisateur vers l’émetteur, le module WS-FAM déclenche l’événement <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.</span><span class="sxs-lookup"><span data-stu-id="9c48b-168">Before the WS-FAM redirects the user to the issuer, it raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider> event.</span></span> <span data-ttu-id="9c48b-169">La demande de connexion de WS-Federation est disponible via la propriété <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> du <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> passé dans l’événement.</span><span class="sxs-lookup"><span data-stu-id="9c48b-169">The WS-Federation sign-in request is available through the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> property of the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> passed in the event.</span></span> <span data-ttu-id="9c48b-170">Vous pouvez modifier la demande avant de l’envoyer à l’émetteur.</span><span class="sxs-lookup"><span data-stu-id="9c48b-170">You may choose to modify the request before sending this out to the issuer.</span></span>  
  
- <span data-ttu-id="9c48b-171">Le module WS-FAM déclenche l’événement <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn> une fois que le cookie a été écrit et que l’utilisateur est connecté.</span><span class="sxs-lookup"><span data-stu-id="9c48b-171">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn> event when the cookie is successfully written and the user is signed in.</span></span>  
  
- <span data-ttu-id="9c48b-172">Le module WS-FAM déclenche l’événement <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut> une seule fois par session, au moment de la fermeture de la session de chaque utilisateur.</span><span class="sxs-lookup"><span data-stu-id="9c48b-172">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut> event one time per session as the session is being closed down for each user.</span></span> <span data-ttu-id="9c48b-173">Cet événement n’est pas déclenché si la session est fermée côté client (par exemple, en supprimant le cookie de session).</span><span class="sxs-lookup"><span data-stu-id="9c48b-173">It is not raised if the session is closed down on the client-side (for example, by deleting the session cookie).</span></span> <span data-ttu-id="9c48b-174">Dans un environnement SSO, l’IP/STS peut également demander à chaque partie de confiance de se déconnecter.</span><span class="sxs-lookup"><span data-stu-id="9c48b-174">In an SSO environment, the IP-STS can request each RP to sign out, too.</span></span> <span data-ttu-id="9c48b-175">Cela déclenche aussi cet événement, avec <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> défini sur `true`.</span><span class="sxs-lookup"><span data-stu-id="9c48b-175">This will also raise this event, with <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> set to `true`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="9c48b-176">Vous ne devez pas utiliser la propriété <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> pendant un événement déclenché par <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> ou <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="9c48b-176">You should not use the <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> property during any event raised by <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="9c48b-177">La raison est que la propriété <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> est définie après le processus d’authentification, alors que les événements sont déclenchés pendant le processus d’authentification.</span><span class="sxs-lookup"><span data-stu-id="9c48b-177">This is because <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> is set after the authentication process, while events are raised during the authentication process.</span></span>  
  
### <a name="configuration-of-federated-authentication"></a><span data-ttu-id="9c48b-178">Configuration de l’authentification fédérée</span><span class="sxs-lookup"><span data-stu-id="9c48b-178">Configuration of Federated Authentication</span></span>  
 <span data-ttu-id="9c48b-179">Les modules WS-FAM et SAM sont configurés à l’aide de l’élément [\<federationConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md).</span><span class="sxs-lookup"><span data-stu-id="9c48b-179">The WS-FAM and SAM are configured through the [\<federationConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md) element.</span></span> <span data-ttu-id="9c48b-180">L’élément enfant [\<wsFederation>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) configure les valeurs par défaut des propriétés de WS-FAM, telles que <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A> et <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A>.</span><span class="sxs-lookup"><span data-stu-id="9c48b-180">The [\<wsFederation>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) child element configures default values for the WS-FAM properties; such as the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A> property and the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A> property.</span></span> <span data-ttu-id="9c48b-181">(Ces valeurs peuvent être modifiées pour chaque demande en fournissant des gestionnaires pour certains événements WS-FAM, comme <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.) Le gestionnaire de cookies utilisé par le module SAM est configuré à l’aide de l’élément enfant [\<cookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md).</span><span class="sxs-lookup"><span data-stu-id="9c48b-181">(These values can be changed on a per request basis by providing handlers for some of the WS-FAM events; for example, <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.) The cookie handler that is used by the SAM is configured through the [\<cookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md) child element.</span></span> <span data-ttu-id="9c48b-182">WIF fournit un gestionnaire de cookies par défaut implémenté dans la classe <xref:System.IdentityModel.Services.ChunkedCookieHandler> dont la taille de bloc est définie avec l’élément [\<chunkedCookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md).</span><span class="sxs-lookup"><span data-stu-id="9c48b-182">WIF provides a default cookie handler implemented in the <xref:System.IdentityModel.Services.ChunkedCookieHandler> class that can have its chunk size set through the [\<chunkedCookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md) element.</span></span> <span data-ttu-id="9c48b-183">L’élément `<federationConfiguration>` fait référence à un <xref:System.IdentityModel.Configuration.IdentityConfiguration>, qui fournit la configuration d’autres composants WIF utilisés dans l’application, tels que <xref:System.Security.Claims.ClaimsAuthenticationManager> et <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span><span class="sxs-lookup"><span data-stu-id="9c48b-183">The `<federationConfiguration>` element references an <xref:System.IdentityModel.Configuration.IdentityConfiguration>, which provides configuration for other WIF components used in the application, such as the <xref:System.Security.Claims.ClaimsAuthenticationManager> and the <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span></span> <span data-ttu-id="9c48b-184">La configuration d’identité peut être référencée explicitement en spécifiant un élément [\<identityConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md) nommé dans l’attribut `identityConfigurationName` de l’élément `<federationConfiguration>`.</span><span class="sxs-lookup"><span data-stu-id="9c48b-184">The identity configuration may be referenced explicitly by specifying a named [\<identityConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md) element in the `identityConfigurationName` attribute of the `<federationConfiguration>` element.</span></span> <span data-ttu-id="9c48b-185">Si la configuration d’identité n’est pas explicitement référencée, la configuration d’identité par défaut est utilisée.</span><span class="sxs-lookup"><span data-stu-id="9c48b-185">If the identity configuration is not referenced explicitly, the default identity configuration will be used.</span></span>  
  
 <span data-ttu-id="9c48b-186">Le code XML suivant montre une configuration d’une application par partie de confiance ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9c48b-186">The following XML shows a configuration of an ASP.NET relying party (RP) application.</span></span> <span data-ttu-id="9c48b-187">Les sections de configuration <xref:System.IdentityModel.Configuration.SystemIdentityModelSection> et <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> sont ajoutées sous l’élément `<configSections>`.</span><span class="sxs-lookup"><span data-stu-id="9c48b-187">The <xref:System.IdentityModel.Configuration.SystemIdentityModelSection> and <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> configuration sections are added under the `<configSections>` element.</span></span> <span data-ttu-id="9c48b-188">Les modules SAM et WS-FAM sont ajoutés aux modules HTTP sous l’élément `<system.webServer>`/`<modules>`.</span><span class="sxs-lookup"><span data-stu-id="9c48b-188">The SAM and WS-FAM are added to the HTTP Modules under the `<system.webServer>`/`<modules>` element.</span></span> <span data-ttu-id="9c48b-189">Enfin, les composants WIF sont configurés sous les éléments `<system.identityModel>`/`<identityConfiguration>` et `<system.identityModel.services>`/`<federationConfiguration>`.</span><span class="sxs-lookup"><span data-stu-id="9c48b-189">Finally the WIF components are configured under the `<system.identityModel>`/`<identityConfiguration>` and `<system.identityModel.services>`/`<federationConfiguration>` elements.</span></span> <span data-ttu-id="9c48b-190">Cette configuration spécifie le gestionnaire de cookies en bloc, car il s’agit du gestionnaire de cookies par défaut et il n’y a pas de type de gestionnaire de cookies spécifié dans l’élément `<cookieHandler>`.</span><span class="sxs-lookup"><span data-stu-id="9c48b-190">This configuration specifies the chunked cookie handler as it is the default cookie handler and there is not a cookie handler type specified in the `<cookieHandler>` element.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="9c48b-191">Dans l’exemple suivant, l’attribut `requireHttps` de l’élément `<wsFederation>` et l’attribut `requireSsl` de l’élément `<cookieHandler>` ont tous les deux la valeur `false`.</span><span class="sxs-lookup"><span data-stu-id="9c48b-191">In the following example, both the `requireHttps` attribute of the `<wsFederation>` element and the `requireSsl` attribute of the `<cookieHandler>` element are `false`.</span></span> <span data-ttu-id="9c48b-192">Cela présente une menace potentielle pour la sécurité.</span><span class="sxs-lookup"><span data-stu-id="9c48b-192">This presents a potential security threat.</span></span> <span data-ttu-id="9c48b-193">Dans votre code de production, vous devez définir ces deux valeurs sur `true`.</span><span class="sxs-lookup"><span data-stu-id="9c48b-193">In production, both these values should be set `true`.</span></span>  
  
```xml  
<configuration>  
  <configSections>  
    <section name="system.identityModel" type="System.IdentityModel.Configuration.SystemIdentityModelSection, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
    <section name="system.identityModel.services" type="System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
  </configSections>  
  
  ...  
  
  <system.webServer>  
    <modules>  
      <add name="WSFederationAuthenticationModule" type="System.IdentityModel.Services.WSFederationAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
      <add name="SessionAuthenticationModule" type="System.IdentityModel.Services.SessionAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
    </modules>  
  </system.webServer>  
  
  <system.identityModel>  
    <identityConfiguration>  
      <audienceUris>  
        <add value="http://localhost:50969/" />  
      </audienceUris>  
      <certificateValidation certificateValidationMode="None" />  
      <issuerNameRegistry type="System.IdentityModel.Tokens.ConfigurationBasedIssuerNameRegistry, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">  
        <trustedIssuers>  
          <add thumbprint="9B74CB2F320F7AAFC156E1252270B1DC01EF40D0" name="LocalSTS" />  
        </trustedIssuers>  
      </issuerNameRegistry>  
    </identityConfiguration>  
  </system.identityModel>  
  <system.identityModel.services>  
    <federationConfiguration>  
      <wsFederation passiveRedirectEnabled="true" issuer="http://localhost:15839/wsFederationSTS/Issue" realm="http://localhost:50969/" reply="http://localhost:50969/" requireHttps="false" />  
      <cookieHandler requireSsl="false" />  
    </federationConfiguration>  
  </system.identityModel.services>  
</configuration>  
```  
  
## <a name="see-also"></a><span data-ttu-id="9c48b-194">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="9c48b-194">See also</span></span>

- <xref:System.IdentityModel.Services.SessionAuthenticationModule>
- <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>
- [<span data-ttu-id="9c48b-195">\<federationConfiguration></span><span class="sxs-lookup"><span data-stu-id="9c48b-195">\<federationConfiguration></span></span>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md)

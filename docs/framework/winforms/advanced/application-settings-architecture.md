---
title: Architecture des paramètres d'application
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- application settings [Windows Forms], architecture
ms.assetid: c8eb2ad0-fac6-4ea2-9140-675a4a44d562
ms.openlocfilehash: b5d5a4456bef925cd8093fe9c696145aff83660e
ms.sourcegitcommit: cf9515122fce716bcfb6618ba366e39b5a2eb81e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/15/2019
ms.locfileid: "69039418"
---
# <a name="application-settings-architecture"></a><span data-ttu-id="46b3c-102">Architecture des paramètres d'application</span><span class="sxs-lookup"><span data-stu-id="46b3c-102">Application Settings Architecture</span></span>
<span data-ttu-id="46b3c-103">Cette rubrique décrit le fonctionnement de l’architecture Paramètres d’application et explore des fonctionnalités avancées de l’architecture telles que les paramètres groupés et les clés de paramètres.</span><span class="sxs-lookup"><span data-stu-id="46b3c-103">This topic describes how the Application Settings architecture works, and explores advanced features of the architecture, such as grouped settings and settings keys.</span></span>

 <span data-ttu-id="46b3c-104">L’architecture des paramètres d’application prend en charge la définition des paramètres fortement typés avec l’application ou la portée utilisateur, et la persistance des paramètres entre les sessions d’application.</span><span class="sxs-lookup"><span data-stu-id="46b3c-104">The application settings architecture supports defining strongly typed settings with either application or user scope, and persisting the settings between application sessions.</span></span> <span data-ttu-id="46b3c-105">L’architecture fournit un moteur de persistance par défaut pour enregistrer les paramètres et les charger à partir du système de fichiers local.</span><span class="sxs-lookup"><span data-stu-id="46b3c-105">The architecture provides a default persistence engine for saving settings to and loading them from the local file system.</span></span> <span data-ttu-id="46b3c-106">L’architecture définit également les interfaces qui fournissent un moteur de persistance personnalisé.</span><span class="sxs-lookup"><span data-stu-id="46b3c-106">The architecture also defines interfaces for supplying a custom persistence engine.</span></span>

 <span data-ttu-id="46b3c-107">Des interfaces sont fournies afin de permettre aux composants personnalisés de conserver leurs propres paramètres lorsqu’ils sont hébergés dans une application.</span><span class="sxs-lookup"><span data-stu-id="46b3c-107">Interfaces are provided that enable custom components to persist their own settings when they are hosted in an application.</span></span> <span data-ttu-id="46b3c-108">À l’aide de clés de paramètres, les composants peuvent séparer les paramètres pour plusieurs instances du composant.</span><span class="sxs-lookup"><span data-stu-id="46b3c-108">By using settings keys, components can keep settings for multiple instances of the component separate.</span></span>

## <a name="defining-settings"></a><span data-ttu-id="46b3c-109">Définition des paramètres</span><span class="sxs-lookup"><span data-stu-id="46b3c-109">Defining Settings</span></span>
 <span data-ttu-id="46b3c-110">L’architecture des paramètres d’application est utilisée dans ASP.NET et Windows Forms, et elle contient un certain nombre de classes de base qui sont partagées entre les deux environnements.</span><span class="sxs-lookup"><span data-stu-id="46b3c-110">The application settings architecture is used within both ASP.NET and Windows Forms, and it contains a number of base classes that are shared across both environments.</span></span> <span data-ttu-id="46b3c-111">Le plus important est <xref:System.Configuration.SettingsBase>, qui fournit l’accès aux paramètres via une collection et fournit des méthodes de bas niveau pour le chargement et l’enregistrement des paramètres.</span><span class="sxs-lookup"><span data-stu-id="46b3c-111">The most important is <xref:System.Configuration.SettingsBase>, which provides access to settings through a collection, and provides low-level methods for loading and saving settings.</span></span> <span data-ttu-id="46b3c-112">Chaque environnement implémente sa propre classe dérivée <xref:System.Configuration.SettingsBase> de pour fournir des fonctionnalités de paramètres supplémentaires pour cet environnement.</span><span class="sxs-lookup"><span data-stu-id="46b3c-112">Each environment implements its own class derived from <xref:System.Configuration.SettingsBase> to provide additional settings functionality for that environment.</span></span> <span data-ttu-id="46b3c-113">Dans une application basée sur Windows Forms, tous les paramètres d’application doivent être définis sur une classe dérivée de la <xref:System.Configuration.ApplicationSettingsBase> classe, ce qui ajoute les fonctionnalités suivantes à la classe de base:</span><span class="sxs-lookup"><span data-stu-id="46b3c-113">In a Windows Forms-based application, all application settings must be defined on a class derived from the <xref:System.Configuration.ApplicationSettingsBase> class, which adds the following functionality to the base class:</span></span>

- <span data-ttu-id="46b3c-114">Chargement et enregistrement d’opérations de plus haut niveau</span><span class="sxs-lookup"><span data-stu-id="46b3c-114">Higher-level loading and saving operations</span></span>

- <span data-ttu-id="46b3c-115">Prise en charge des paramètres de portée utilisateur</span><span class="sxs-lookup"><span data-stu-id="46b3c-115">Support for user-scoped settings</span></span>

- <span data-ttu-id="46b3c-116">Rétablissement des paramètres d’un utilisateur aux valeurs par défaut</span><span class="sxs-lookup"><span data-stu-id="46b3c-116">Reverting a user's settings to the predefined defaults</span></span>

- <span data-ttu-id="46b3c-117">Mise à niveau des paramètres à partir d’une version précédente de l’application</span><span class="sxs-lookup"><span data-stu-id="46b3c-117">Upgrading settings from a previous application version</span></span>

- <span data-ttu-id="46b3c-118">Validation des paramètres, avant leur modification ou leur enregistrement</span><span class="sxs-lookup"><span data-stu-id="46b3c-118">Validating settings, either before they are changed or before they are saved</span></span>

 <span data-ttu-id="46b3c-119">Les paramètres peuvent être décrits à l’aide d’un certain nombre d' <xref:System.Configuration> attributs définis dans l’espace de noms. ceux-ci sont décrits dans [attributs des paramètres d’application](application-settings-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="46b3c-119">The settings can be described using a number of attributes defined within the <xref:System.Configuration> namespace; these are described in [Application Settings Attributes](application-settings-attributes.md).</span></span> <span data-ttu-id="46b3c-120">Lorsque vous définissez un paramètre, vous devez l’appliquer avec <xref:System.Configuration.ApplicationScopedSettingAttribute> ou <xref:System.Configuration.UserScopedSettingAttribute>, ce qui indique si le paramètre s’applique à l’application entière ou uniquement à l’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="46b3c-120">When you define a setting, you must apply it with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>, which describes whether the setting applies to the entire application or just to the current user.</span></span>

 <span data-ttu-id="46b3c-121">L’exemple de code suivant définit une classe de paramètres personnalisés avec un paramètre unique, `BackgroundColor`.</span><span class="sxs-lookup"><span data-stu-id="46b3c-121">The following code example defines a custom settings class with a single setting, `BackgroundColor`.</span></span>

 [!code-csharp[ApplicationSettings.Create#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Create/CS/MyAppSettings.cs#1)]
 [!code-vb[ApplicationSettings.Create#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Create/VB/MyAppSettings.vb#1)]

## <a name="settings-persistence"></a><span data-ttu-id="46b3c-122">Persistance des paramètres</span><span class="sxs-lookup"><span data-stu-id="46b3c-122">Settings Persistence</span></span>
 <span data-ttu-id="46b3c-123">La <xref:System.Configuration.ApplicationSettingsBase> classe ne conserve pas elle-même les paramètres, mais cette tâche s’applique au fournisseur de paramètres, une classe qui <xref:System.Configuration.SettingsProvider>dérive de.</span><span class="sxs-lookup"><span data-stu-id="46b3c-123">The <xref:System.Configuration.ApplicationSettingsBase> class does not itself persist or load settings; this job falls to the settings provider, a class that derives from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="46b3c-124">Si une classe dérivée <xref:System.Configuration.ApplicationSettingsBase> de ne spécifie pas de fournisseur de <xref:System.Configuration.SettingsProviderAttribute>paramètres via, le fournisseur par <xref:System.Configuration.LocalFileSettingsProvider>défaut,, est utilisé.</span><span class="sxs-lookup"><span data-stu-id="46b3c-124">If a derived class of <xref:System.Configuration.ApplicationSettingsBase> does not specify a settings provider through the <xref:System.Configuration.SettingsProviderAttribute>, then the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span>

 <span data-ttu-id="46b3c-125">Le système de configuration qui a été publié à l’origine avec le .NET Framework prend en charge la fourniture de données de configuration d’application statiques via le `app.`fichier machine. config de l’ordinateur local ou dans un fichier exe. config que vous déployez avec votre application.</span><span class="sxs-lookup"><span data-stu-id="46b3c-125">The configuration system that was originally released with the .NET Framework supports providing static application configuration data through either the local computer's machine.config file or within an `app.`exe.config file that you deploy with your application.</span></span> <span data-ttu-id="46b3c-126">La <xref:System.Configuration.LocalFileSettingsProvider> classe étend cette prise en charge native des manières suivantes:</span><span class="sxs-lookup"><span data-stu-id="46b3c-126">The <xref:System.Configuration.LocalFileSettingsProvider> class expands this native support in the following ways:</span></span>

- <span data-ttu-id="46b3c-127">Les paramètres de portée d’application peuvent être stockés dans des fichiers machine.config ou `app.`exe.config.</span><span class="sxs-lookup"><span data-stu-id="46b3c-127">Application-scoped settings can be stored in either the machine.config or `app.`exe.config files.</span></span> <span data-ttu-id="46b3c-128">Machine.config est toujours en lecture seule, tandis que `app`.exe.config est limité par des considérations de sécurité en lecture seule pour la plupart des applications.</span><span class="sxs-lookup"><span data-stu-id="46b3c-128">Machine.config is always read-only, while `app`.exe.config is restricted by security considerations to read-only for most applications.</span></span>

- <span data-ttu-id="46b3c-129">Les paramètres de portée utilisateur peuvent être stockés dans des fichiers `app`.exe.config, fichiers, auquel cas ils sont traités comme des valeurs par défaut statiques.</span><span class="sxs-lookup"><span data-stu-id="46b3c-129">User-scoped settings can be stored in `app`.exe.config files, in which case they are treated as static defaults.</span></span>

- <span data-ttu-id="46b3c-130">Les paramètres de portée utilisateur non définis par défaut sont stockés dans un nouveau fichier, *user*.config, où *user* est le nom d’utilisateur de la personne qui exécute actuellement l’application.</span><span class="sxs-lookup"><span data-stu-id="46b3c-130">Non-default user-scoped settings are stored in a new file, *user*.config, where *user* is the user name of the person currently executing the application.</span></span> <span data-ttu-id="46b3c-131">Vous pouvez spécifier une valeur par défaut pour un paramètre de portée utilisateur <xref:System.Configuration.DefaultSettingValueAttribute>avec.</span><span class="sxs-lookup"><span data-stu-id="46b3c-131">You can specify a default for a user-scoped setting with <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="46b3c-132">Étant donné que les paramètres de portée utilisateur changent souvent pendant l’exécution d’applications, `user`.config est toujours accessible en lecture/écriture.</span><span class="sxs-lookup"><span data-stu-id="46b3c-132">Because user-scoped settings often change during application execution, `user`.config is always read/write.</span></span>

 <span data-ttu-id="46b3c-133">Ces trois fichiers de configuration stockent les paramètres au format XML.</span><span class="sxs-lookup"><span data-stu-id="46b3c-133">All three configuration files store settings in XML format.</span></span> <span data-ttu-id="46b3c-134">L’élément XML de niveau supérieur pour les paramètres de portée d’application est `<appSettings>`, tandis que `<userSettings>` est utilisé pour les paramètres de portée utilisateur.</span><span class="sxs-lookup"><span data-stu-id="46b3c-134">The top-level XML element for application-scoped settings is `<appSettings>`, while `<userSettings>` is used for user-scoped settings.</span></span> <span data-ttu-id="46b3c-135">Un fichier `app`.exe.config contenant les paramètres de portée d’application et les valeurs par défaut pour les paramètres de portée utilisateur ressemblerait à ceci :</span><span class="sxs-lookup"><span data-stu-id="46b3c-135">An `app`.exe.config file which contains both application-scoped settings and defaults for user-scoped settings would look like this:</span></span>

```xml
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <configSections>
        <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
        </sectionGroup>
        <sectionGroup name="userSettings" type="System.Configuration.UserSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" allowExeDefinition="MachineToLocalUser" />
        </sectionGroup>
    </configSections>
    <applicationSettings>
        <WindowsApplication1.Properties.Settings>
            <setting name="Cursor" serializeAs="String">
                <value>Default</value>
            </setting>
            <setting name="DoubleBuffering" serializeAs="String">
                <value>False</value>
            </setting>
        </WindowsApplication1.Properties.Settings>
    </applicationSettings>
    <userSettings>
        <WindowsApplication1.Properties.Settings>
            <setting name="FormTitle" serializeAs="String">
                <value>Form1</value>
            </setting>
            <setting name="FormSize" serializeAs="String">
                <value>595, 536</value>
            </setting>
        </WindowsApplication1.Properties.Settings>
    </userSettings>
</configuration>
```

 <span data-ttu-id="46b3c-136">Pour une définition des éléments dans la section Paramètres d’application d’un fichier de configuration, consultez [Schéma des paramètres d'application](../../configure-apps/file-schema/application-settings-schema.md).</span><span class="sxs-lookup"><span data-stu-id="46b3c-136">For a definition of the elements within the application settings section of a configuration file, see [Application Settings Schema](../../configure-apps/file-schema/application-settings-schema.md).</span></span>

### <a name="settings-bindings"></a><span data-ttu-id="46b3c-137">Liaisons de paramètres</span><span class="sxs-lookup"><span data-stu-id="46b3c-137">Settings Bindings</span></span>
 <span data-ttu-id="46b3c-138">Les paramètres d’application utilisent l’architecture de liaison de données Windows Forms pour fournir une communication bidirectionnelle pour les mises à jour des paramètres entre les composants et l’objet de paramètres.</span><span class="sxs-lookup"><span data-stu-id="46b3c-138">Application settings uses the Windows Forms data binding architecture to provide two-way communication of settings updates between the settings object and components.</span></span> <span data-ttu-id="46b3c-139">Si vous utilisez Visual Studio pour créer des paramètres d’application et les affecter aux propriétés du composant, ces liaisons sont générées automatiquement.</span><span class="sxs-lookup"><span data-stu-id="46b3c-139">If you use Visual Studio to create application settings and assign them to component properties, these bindings are generated automatically.</span></span>

 <span data-ttu-id="46b3c-140">Vous pouvez uniquement lier un paramètre d’application à un composant qui prend <xref:System.Windows.Forms.IBindableComponent> en charge l’interface.</span><span class="sxs-lookup"><span data-stu-id="46b3c-140">You can only bind an application setting to a component that supports the <xref:System.Windows.Forms.IBindableComponent> interface.</span></span> <span data-ttu-id="46b3c-141">En outre, le composant doit implémenter un événement de modification pour une propriété liée spécifique, ou notifier les paramètres de l’application <xref:System.ComponentModel.INotifyPropertyChanged> que la propriété a changé par le biais de l’interface.</span><span class="sxs-lookup"><span data-stu-id="46b3c-141">Also, the component must implement a change event for a specific bound property, or notify application settings that the property has changed through the <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span></span> <span data-ttu-id="46b3c-142">Si le composant n’implémente <xref:System.Windows.Forms.IBindableComponent> pas et que vous effectuez une liaison par le biais de Visual Studio, les propriétés liées sont définies la première fois, mais elles ne sont pas mises à jour.</span><span class="sxs-lookup"><span data-stu-id="46b3c-142">If the component does not implement <xref:System.Windows.Forms.IBindableComponent> and you are binding through Visual Studio, the bound properties will be set the first time, but will not update.</span></span> <span data-ttu-id="46b3c-143">Si le composant implémente <xref:System.Windows.Forms.IBindableComponent> , mais ne prend pas en charge les notifications de modification de propriété, la liaison ne sera pas mise à jour dans le fichier de paramètres lorsque la propriété sera modifiée.</span><span class="sxs-lookup"><span data-stu-id="46b3c-143">If the component implements <xref:System.Windows.Forms.IBindableComponent> but does not support property change notifications, the binding will not update in the settings file when the property is changed.</span></span>

 <span data-ttu-id="46b3c-144">Certains composants de Windows Forms, tels <xref:System.Windows.Forms.ToolStripItem>que, ne prennent pas en charge les liaisons de paramètres.</span><span class="sxs-lookup"><span data-stu-id="46b3c-144">Some Windows Forms components, such as <xref:System.Windows.Forms.ToolStripItem>, do not support settings bindings.</span></span>

### <a name="settings-serialization"></a><span data-ttu-id="46b3c-145">Sérialisation de paramètres</span><span class="sxs-lookup"><span data-stu-id="46b3c-145">Settings Serialization</span></span>
 <span data-ttu-id="46b3c-146">Lorsque <xref:System.Configuration.LocalFileSettingsProvider> doit enregistrer les paramètres sur le disque, il effectue les actions suivantes:</span><span class="sxs-lookup"><span data-stu-id="46b3c-146">When <xref:System.Configuration.LocalFileSettingsProvider> must save settings to disk, it performs the following actions:</span></span>

1. <span data-ttu-id="46b3c-147">Utilise la réflexion pour examiner toutes les propriétés définies sur votre <xref:System.Configuration.ApplicationSettingsBase> classe dérivée, en recherchant celles qui sont appliquées <xref:System.Configuration.ApplicationScopedSettingAttribute> avec <xref:System.Configuration.UserScopedSettingAttribute>ou.</span><span class="sxs-lookup"><span data-stu-id="46b3c-147">Uses reflection to examine all of the properties defined on your <xref:System.Configuration.ApplicationSettingsBase> derived class, finding those that are applied with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>.</span></span>

2. <span data-ttu-id="46b3c-148">Sérialise la propriété sur le disque.</span><span class="sxs-lookup"><span data-stu-id="46b3c-148">Serializes the property to disk.</span></span> <span data-ttu-id="46b3c-149">Il tente d’abord d’appeler <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> ou <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> sur le associé <xref:System.ComponentModel.TypeConverter>au type.</span><span class="sxs-lookup"><span data-stu-id="46b3c-149">It first attempts to call the <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> or <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> on the type's associated <xref:System.ComponentModel.TypeConverter>.</span></span> <span data-ttu-id="46b3c-150">Si cela ne réussit pas, la sérialisation XML est utilisée à la place.</span><span class="sxs-lookup"><span data-stu-id="46b3c-150">If this does not succeed, it uses XML serialization instead.</span></span>

3. <span data-ttu-id="46b3c-151">Détermine quels paramètres vont dans quels fichiers, selon l’attribut du paramètre.</span><span class="sxs-lookup"><span data-stu-id="46b3c-151">Determines which settings go in which files, based on the setting's attribute.</span></span>

 <span data-ttu-id="46b3c-152">Si vous implémentez votre propre classe de paramètres, vous pouvez <xref:System.Configuration.SettingsSerializeAsAttribute> utiliser pour marquer un paramètre pour la sérialisation binaire ou personnalisée à l' <xref:System.Configuration.SettingsSerializeAs> aide de l’énumération.</span><span class="sxs-lookup"><span data-stu-id="46b3c-152">If you implement your own settings class, you can use the <xref:System.Configuration.SettingsSerializeAsAttribute> to mark a setting for either binary or custom serialization using the <xref:System.Configuration.SettingsSerializeAs> enumeration.</span></span> <span data-ttu-id="46b3c-153">Pour plus d’informations sur la création de votre propre classe de paramètres [dans le code, consultez Procédure: Créer des paramètres](how-to-create-application-settings.md)d’application.</span><span class="sxs-lookup"><span data-stu-id="46b3c-153">For more information on creating your own settings class in code, see [How to: Create Application Settings](how-to-create-application-settings.md).</span></span>

### <a name="settings-file-locations"></a><span data-ttu-id="46b3c-154">Emplacements des fichiers de paramètres</span><span class="sxs-lookup"><span data-stu-id="46b3c-154">Settings File Locations</span></span>
 <span data-ttu-id="46b3c-155">L’emplacement des fichiers `app`.exe.config et *user*.config varie en fonction de la façon dont l’application est installée.</span><span class="sxs-lookup"><span data-stu-id="46b3c-155">The location of the `app`.exe.config and *user*.config files will differ based on how the application is installed.</span></span> <span data-ttu-id="46b3c-156">Pour une application Windows Forms copiée sur l’ordinateur local, `app`. exe. config se trouve dans le même répertoire que le répertoire de base du fichier exécutable principal de l’application, et *User*. config se trouve à l’emplacement spécifié par la <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> propriété.</span><span class="sxs-lookup"><span data-stu-id="46b3c-156">For a Windows Forms-based application copied onto the local computer, `app`.exe.config will reside in the same directory as the base directory of the application's main executable file, and *user*.config will reside in the location specified by the <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="46b3c-157">Pour une application installée par le biais de ClickOnce, ces deux fichiers se trouvent dans le répertoire de données ClickOnce sous%InstallRoot%\Documents and Settings et paramètres\\*nom d’utilisateur*\Local paramètres.</span><span class="sxs-lookup"><span data-stu-id="46b3c-157">For an application installed by means of ClickOnce, both of these files will reside in the ClickOnce Data Directory underneath %InstallRoot%\Documents and Settings\\*username*\Local Settings.</span></span>

 <span data-ttu-id="46b3c-158">L’emplacement de stockage de ces fichiers est légèrement différent si un utilisateur a activé les profils itinérants, ce qui permet à un utilisateur de définir différents paramètres d’application et Windows lorsqu’il utilise d’autres ordinateurs dans un domaine.</span><span class="sxs-lookup"><span data-stu-id="46b3c-158">The storage location of these files is slightly different if a user has enabled roaming profiles, which enables a user to define different Windows and application settings when he or she is using other computers within a domain.</span></span> <span data-ttu-id="46b3c-159">Dans ce cas, les applications ClickOnce et les applications non-ClickOnce auront leurs `app`fichiers. exe. config et *User*. config stockés sous%InstallRoot%\Documents and Settings et paramètres\\*nom d’utilisateur*\Application Data.</span><span class="sxs-lookup"><span data-stu-id="46b3c-159">In that case, both ClickOnce applications and non-ClickOnce applications will have their `app`.exe.config and *user*.config files stored under %InstallRoot%\Documents and Settings\\*username*\Application Data.</span></span>

 <span data-ttu-id="46b3c-160">Pour plus d’informations sur le fonctionnement de la fonctionnalité Paramètres d’application avec la nouvelle technologie de déploiement, consultez [ClickOnce et paramètres d’application](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="46b3c-160">For more information about how the Application Settings feature works with the new deployment technology, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span> <span data-ttu-id="46b3c-161">Pour plus d’informations sur le répertoire de données ClickOnce, consultez [accès aux données locales et distantes dans les applications ClickOnce](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span><span class="sxs-lookup"><span data-stu-id="46b3c-161">For more information about the ClickOnce Data Directory, see [Accessing Local and Remote Data in ClickOnce Applications](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span></span>

## <a name="application-settings-and-security"></a><span data-ttu-id="46b3c-162">Paramètres d’application et sécurité</span><span class="sxs-lookup"><span data-stu-id="46b3c-162">Application Settings and Security</span></span>
 <span data-ttu-id="46b3c-163">Les paramètres d’application sont conçus pour fonctionner en mode de confiance partielle, un environnement restreint qui est la configuration par défaut pour les applications Windows Forms hébergées sur Internet ou sur un intranet.</span><span class="sxs-lookup"><span data-stu-id="46b3c-163">Application settings are designed to work in partial trust, a restricted environment that is the default for Windows Forms applications hosted over the Internet or an intranet.</span></span> <span data-ttu-id="46b3c-164">Aucune autorisation spéciale au-delà de la confiance partielle n’est nécessaire pour utiliser les paramètres d’application avec le fournisseur de paramètres par défaut.</span><span class="sxs-lookup"><span data-stu-id="46b3c-164">No special permissions beyond partial trust are needed to use application settings with the default settings provider.</span></span>

 <span data-ttu-id="46b3c-165">Lorsque les paramètres d’application sont utilisés dans une application ClickOnce `user`, le fichier. config est stocké dans le répertoire de données ClickOnce.</span><span class="sxs-lookup"><span data-stu-id="46b3c-165">When application settings are used in a ClickOnce application, the `user`.config file is stored in the ClickOnce data directory.</span></span> <span data-ttu-id="46b3c-166">La taille du fichier `user`. config de l’application ne peut pas dépasser le quota de répertoire de données défini par ClickOnce.</span><span class="sxs-lookup"><span data-stu-id="46b3c-166">The size of the application's `user`.config file cannot exceed the data directory quota set by ClickOnce.</span></span> <span data-ttu-id="46b3c-167">Pour plus d'informations, consultez [ClickOnce et paramètres d’application](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="46b3c-167">For more information, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span>

## <a name="custom-settings-providers"></a><span data-ttu-id="46b3c-168">Fournisseurs de paramètres personnalisés</span><span class="sxs-lookup"><span data-stu-id="46b3c-168">Custom Settings Providers</span></span>
 <span data-ttu-id="46b3c-169">Dans l’architecture des paramètres d’application, il existe un couplage faible entre la classe wrapper de paramètres d’application <xref:System.Configuration.ApplicationSettingsBase>, dérivée de, et le ou les fournisseurs de <xref:System.Configuration.SettingsProvider>paramètres associés, dérivés de.</span><span class="sxs-lookup"><span data-stu-id="46b3c-169">In the Application Settings architecture, there is a loose coupling between the applications settings wrapper class, derived from <xref:System.Configuration.ApplicationSettingsBase>, and the associated settings provider or providers, derived from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="46b3c-170">Cette association est définie uniquement par le <xref:System.Configuration.SettingsProviderAttribute> appliqué à la classe wrapper ou à ses propriétés individuelles.</span><span class="sxs-lookup"><span data-stu-id="46b3c-170">This association is defined only by the <xref:System.Configuration.SettingsProviderAttribute> applied to the wrapper class or its individual properties.</span></span> <span data-ttu-id="46b3c-171">Si un fournisseur de paramètres n’est pas explicitement spécifié, le fournisseur <xref:System.Configuration.LocalFileSettingsProvider>par défaut,, est utilisé.</span><span class="sxs-lookup"><span data-stu-id="46b3c-171">If a settings provider is not explicitly specified, the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span> <span data-ttu-id="46b3c-172">Par conséquent, cette architecture prend en charge la création et l’utilisation de fournisseurs de paramètres personnalisés.</span><span class="sxs-lookup"><span data-stu-id="46b3c-172">As a result, this architecture supports creating and using custom settings providers.</span></span>

 <span data-ttu-id="46b3c-173">Par exemple, supposons que vous souhaitez développer et utiliser `SqlSettingsProvider`, un fournisseur qui stockera toutes les données de paramètres dans une base de données Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="46b3c-173">For example, suppose that you want to develop and use `SqlSettingsProvider`, a provider that will store all settings data in a Microsoft SQL Server database.</span></span> <span data-ttu-id="46b3c-174">Votre <xref:System.Configuration.SettingsProvider>classe dérivée de reçoit ces informations dans sa `Initialize` méthode en tant que paramètre de <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>type.</span><span class="sxs-lookup"><span data-stu-id="46b3c-174">Your <xref:System.Configuration.SettingsProvider>-derived class would receive this information in its `Initialize` method as a parameter of type <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span></span> <span data-ttu-id="46b3c-175">Vous devez ensuite implémenter <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> la méthode pour récupérer vos paramètres à partir du magasin de <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> données et les enregistrer.</span><span class="sxs-lookup"><span data-stu-id="46b3c-175">You would then implement the <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> method to retrieve your settings from the data store, and <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> to save them.</span></span> <span data-ttu-id="46b3c-176">Votre fournisseur peut utiliser le <xref:System.Configuration.SettingsPropertyCollection> fourni pour <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> déterminer le nom, le type et l’étendue de la propriété, ainsi que tous les autres attributs de paramètres définis pour cette propriété.</span><span class="sxs-lookup"><span data-stu-id="46b3c-176">Your provider can use the <xref:System.Configuration.SettingsPropertyCollection> supplied to <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> to determine the property's name, type, and scope, as well as any other settings attributes defined for that property.</span></span>

 <span data-ttu-id="46b3c-177">Votre fournisseur devra implémenter une propriété et une méthode dont les implémentations peuvent ne pas être évidentes.</span><span class="sxs-lookup"><span data-stu-id="46b3c-177">Your provider will need to implement one property and one method whose implementations may not be obvious.</span></span> <span data-ttu-id="46b3c-178">La <xref:System.Configuration.SettingsProvider.ApplicationName%2A> propriété est une propriété abstraite <xref:System.Configuration.SettingsProvider>de; vous devez la programmer pour retourner les éléments suivants:</span><span class="sxs-lookup"><span data-stu-id="46b3c-178">The <xref:System.Configuration.SettingsProvider.ApplicationName%2A> property is an abstract property of <xref:System.Configuration.SettingsProvider>; you should program it to return the following:</span></span>

 [!code-csharp[ApplicationSettings.Architecture#2](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#2)]
 [!code-vb[ApplicationSettings.Architecture#2](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#2)]

 <span data-ttu-id="46b3c-179">Votre classe dérivée doit également implémenter une méthode `Initialize` qui n’accepte aucun argument et ne retourne aucune valeur.</span><span class="sxs-lookup"><span data-stu-id="46b3c-179">Your derived class must also implement an `Initialize` method that takes no arguments and returns no value.</span></span> <span data-ttu-id="46b3c-180">Cette méthode n’est pas définie <xref:System.Configuration.SettingsProvider>par.</span><span class="sxs-lookup"><span data-stu-id="46b3c-180">This method is not defined by <xref:System.Configuration.SettingsProvider>.</span></span>

 <span data-ttu-id="46b3c-181">Enfin, vous implémentez <xref:System.Configuration.IApplicationSettingsProvider> sur votre fournisseur pour assurer la prise en charge de l’actualisation des paramètres, le rétablissement des paramètres par défaut et la mise à niveau des paramètres d’une version d’application vers une autre.</span><span class="sxs-lookup"><span data-stu-id="46b3c-181">Finally, you implement <xref:System.Configuration.IApplicationSettingsProvider> on your provider to provide support for refreshing settings, reverting settings to their defaults, and upgrading settings from one application version to another.</span></span>

 <span data-ttu-id="46b3c-182">Une fois que vous avez implémenté et compilé votre fournisseur, vous devez demander à votre classe de paramètres d’utiliser ce fournisseur au lieu de la valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="46b3c-182">Once you have implemented and compiled your provider, you need to instruct your settings class to use this provider instead of the default.</span></span> <span data-ttu-id="46b3c-183">Pour ce faire, vous <xref:System.Configuration.SettingsProviderAttribute>pouvez utiliser le.</span><span class="sxs-lookup"><span data-stu-id="46b3c-183">You accomplish this through the <xref:System.Configuration.SettingsProviderAttribute>.</span></span> <span data-ttu-id="46b3c-184">S’il est appliqué à une classe de paramètres entière, le fournisseur est utilisé pour chaque paramètre défini par la classe; s’il est appliqué à des paramètres individuels, l’architecture des paramètres d’application utilise ce fournisseur pour <xref:System.Configuration.LocalFileSettingsProvider> ces paramètres uniquement et utilise pour le reste.</span><span class="sxs-lookup"><span data-stu-id="46b3c-184">If applied to an entire settings class, the provider is used for each setting that the class defines; if applied to individual settings, Application Settings architecture uses that provider for those settings only, and uses <xref:System.Configuration.LocalFileSettingsProvider> for the rest.</span></span> <span data-ttu-id="46b3c-185">L’exemple de code suivant montre comment indiquer à la classe de paramètres d’utiliser votre fournisseur personnalisé.</span><span class="sxs-lookup"><span data-stu-id="46b3c-185">The following code example shows how to instruct the settings class to use your custom provider.</span></span>

 [!code-csharp[ApplicationSettings.Architecture#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#1)]
 [!code-vb[ApplicationSettings.Architecture#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#1)]

 <span data-ttu-id="46b3c-186">Un fournisseur peut être appelé à partir de plusieurs threads simultanément, mais il écrira toujours au même emplacement de stockage. Par conséquent, l’architecture de paramètres d’application n’instanciera jamais qu’une seule instance de votre classe de fournisseur.</span><span class="sxs-lookup"><span data-stu-id="46b3c-186">A provider may be called from multiple threads simultaneously, but it will always write to the same storage location; therefore, the Application Settings architecture will only ever instantiate a single instance of your provider class.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="46b3c-187">Vous devez vous assurer que votre fournisseur est thread-safe et autorise un seul thread à la fois à écrire dans les fichiers de configuration.</span><span class="sxs-lookup"><span data-stu-id="46b3c-187">You should ensure that your provider is thread-safe, and only allows one thread at a time to write to the configuration files.</span></span>

 <span data-ttu-id="46b3c-188">Votre fournisseur n’a pas besoin de prendre en charge tous les attributs de paramètres <xref:System.Configuration?displayProperty=nameWithType> définis dans l’espace de noms, même s' <xref:System.Configuration.ApplicationScopedSettingAttribute> il <xref:System.Configuration.UserScopedSettingAttribute>doit prendre en charge au <xref:System.Configuration.DefaultSettingValueAttribute>minimum et, et doit également prendre en charge.</span><span class="sxs-lookup"><span data-stu-id="46b3c-188">Your provider does not need to support all of the settings attributes defined in the <xref:System.Configuration?displayProperty=nameWithType> namespace, though it must at a minimum support <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute>, and should also support <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="46b3c-189">Pour les attributs qu’il ne prend pas en charge, votre fournisseur doit simplement échouer sans notification. Il ne doit pas lever une exception.</span><span class="sxs-lookup"><span data-stu-id="46b3c-189">For those attributes that it does not support, your provider should just fail without notification; it should not throw an exception.</span></span> <span data-ttu-id="46b3c-190">Toutefois, si la classe de paramètres utilise une combinaison non valide d’attributs (comme <xref:System.Configuration.ApplicationScopedSettingAttribute> l' <xref:System.Configuration.UserScopedSettingAttribute> application de et au même paramètre), votre fournisseur doit lever une exception et cesser l’opération.</span><span class="sxs-lookup"><span data-stu-id="46b3c-190">If the settings class uses an invalid combination of attributes, however — such as applying <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute> to the same setting — your provider should throw an exception and cease operation.</span></span>

## <a name="see-also"></a><span data-ttu-id="46b3c-191">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="46b3c-191">See also</span></span>

- <xref:System.Configuration.ApplicationSettingsBase>
- <xref:System.Configuration.SettingsProvider>
- <xref:System.Configuration.LocalFileSettingsProvider>
- [<span data-ttu-id="46b3c-192">Vue d'ensemble des paramètres d'application</span><span class="sxs-lookup"><span data-stu-id="46b3c-192">Application Settings Overview</span></span>](application-settings-overview.md)
- [<span data-ttu-id="46b3c-193">Application Settings for Custom Controls</span><span class="sxs-lookup"><span data-stu-id="46b3c-193">Application Settings for Custom Controls</span></span>](application-settings-for-custom-controls.md)
- [<span data-ttu-id="46b3c-194">ClickOnce et paramètres d’application</span><span class="sxs-lookup"><span data-stu-id="46b3c-194">ClickOnce and Application Settings</span></span>](/visualstudio/deployment/clickonce-and-application-settings)
- [<span data-ttu-id="46b3c-195">Schéma des paramètres d'application</span><span class="sxs-lookup"><span data-stu-id="46b3c-195">Application Settings Schema</span></span>](../../configure-apps/file-schema/application-settings-schema.md)

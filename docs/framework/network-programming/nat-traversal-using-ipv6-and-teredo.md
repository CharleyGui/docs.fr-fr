---
title: Parcours NAT avec IPv6 et Teredo
ms.date: 03/30/2017
ms.assetid: 568cd245-3300-49ef-a995-d81bf845d961
ms.openlocfilehash: f617dc8912091576727b90da1e9efb9ebd5f9bda
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/15/2020
ms.locfileid: "61642169"
---
# <a name="nat-traversal-using-ipv6-and-teredo"></a><span data-ttu-id="db33f-102">Parcours NAT avec IPv6 et Teredo</span><span class="sxs-lookup"><span data-stu-id="db33f-102">NAT Traversal using IPv6 and Teredo</span></span>
<span data-ttu-id="db33f-103">Des améliorations ont été apportées à la prise en charge du parcours NAT.</span><span class="sxs-lookup"><span data-stu-id="db33f-103">Enhancements were made that provide support for Network Address Translation (NAT) traversal.</span></span> <span data-ttu-id="db33f-104">Ces changements prévoient l’utilisation d’IPv6 et de Teredo. Toutefois, d’autres technologies de tunneling IP peuvent être utilisées.</span><span class="sxs-lookup"><span data-stu-id="db33f-104">These changes are designed for use with IPv6 and Teredo, but they are also applicable to other IP tunneling technologies.</span></span> <span data-ttu-id="db33f-105">Ces améliorations affectent les classes de <xref:System.Net> et les espaces de noms qui leur sont associés.</span><span class="sxs-lookup"><span data-stu-id="db33f-105">These enhancements affect classes in the <xref:System.Net> and related namespaces.</span></span>  
  
 <span data-ttu-id="db33f-106">Ces modifications peuvent affecter les applications clientes et serveur qui doivent utiliser des technologies de tunneling IP.</span><span class="sxs-lookup"><span data-stu-id="db33f-106">These changes can affect client and server applications that plan to use IP tunneling technologies.</span></span>  
  
 <span data-ttu-id="db33f-107">Les modifications de prise en charge du parcours NAT sont disponibles uniquement pour les applications qui utilisent le .NET Framework version 4.</span><span class="sxs-lookup"><span data-stu-id="db33f-107">The changes to support NAT traversal are available only for applications using .NET Framework version 4.</span></span> <span data-ttu-id="db33f-108">Ces fonctionnalités ne sont pas disponibles dans les versions antérieures du .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="db33f-108">These features are not available on earlier versions of the .NET Framework.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="db33f-109">Vue d’ensemble</span><span class="sxs-lookup"><span data-stu-id="db33f-109">Overview</span></span>  
 <span data-ttu-id="db33f-110">Le protocole IPv4 définit une adresse IPv4 comme ayant une longueur de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="db33f-110">The Internet Protocol version 4 (IPv4) defined an IPv4 address as 32 bits long.</span></span> <span data-ttu-id="db33f-111">Par conséquent, il prend en charge environ 4 milliards d’adresses IP uniques (2^32).</span><span class="sxs-lookup"><span data-stu-id="db33f-111">As a result, IPv4 supports approximately 4 billion unique IP addresses (2^32).</span></span> <span data-ttu-id="db33f-112">Lorsque le nombre d’ordinateurs et d’appareils réseau connectés à Internet a augmenté dans les années 1990, les limites de l’espace d’adressage IPv4 sont devenues évidentes.</span><span class="sxs-lookup"><span data-stu-id="db33f-112">As the number of computers and network devices on the Internet expanded in the 1990s, the limits of the IPv4 address space became apparent.</span></span>  
  
 <span data-ttu-id="db33f-113">L’une des techniques utilisées pour étendre la durée de vie d’IPv4 consiste à déployer le NAT pour permettre à une adresse IP publique unique de représenter un grand nombre d’adresses IP privées (intranet privé).</span><span class="sxs-lookup"><span data-stu-id="db33f-113">One of several techniques used to extend the lifetime of IPv4 has been to deploy NAT to allow a single unique public IP address to represent a large number of private IP addresses (private Intranet).</span></span> <span data-ttu-id="db33f-114">Les adresses IP privées situées derrière un appareil NAT partagent une même adresse IPv4 publique.</span><span class="sxs-lookup"><span data-stu-id="db33f-114">The private IP addresses behind the NAT device share the single public IPv4 address.</span></span> <span data-ttu-id="db33f-115">L’appareil NAT peut être un appareil matériel dédié (un point d’accès sans fil et un routeur peu coûteux, par exemple) ou un ordinateur exécutant un service NAT.</span><span class="sxs-lookup"><span data-stu-id="db33f-115">The NAT device may be a dedicated hardware device (an inexpensive Wireless Access Point and router, for example) or a computer running a service to provide NAT.</span></span> <span data-ttu-id="db33f-116">L’appareil ou le service de cette adresse IP publique va traduire les paquets IP entre un Internet public et un intranet privé.</span><span class="sxs-lookup"><span data-stu-id="db33f-116">A device or service for this public IP address translates IP network packets between the public Internet and the private Intranet.</span></span>  
  
 <span data-ttu-id="db33f-117">Ce modèle fonctionne bien pour les applications clientes exécutées sur un intranet privé qui envoient des requêtes à d’autres adresses IP (généralement des serveurs) sur Internet.</span><span class="sxs-lookup"><span data-stu-id="db33f-117">This scheme works well for client applications running on the private Intranet that send requests to other IP addresses (usually servers) on the Internet.</span></span> <span data-ttu-id="db33f-118">L’appareil ou le serveur NAT peut conserver les requêtes client. Ainsi, lorsqu’une réponse est retournée, il sait où l’envoyer.</span><span class="sxs-lookup"><span data-stu-id="db33f-118">The NAT device or server can keep a mapping of client requests so when a response is returned it knows where to send the response.</span></span> <span data-ttu-id="db33f-119">Mais ce schéma pose problème pour les applications qui sont exécutées sur un intranet privé derrière un appareil NAT et qui souhaitent fournir des services, écouter les paquets et répondre.</span><span class="sxs-lookup"><span data-stu-id="db33f-119">But this scheme poses problems for applications running in the private Intranet behind the NAT device that want to provide services, listen for packets, and respond.</span></span> <span data-ttu-id="db33f-120">Cela est d’autant plus vrai pour les applications pair à pair.</span><span class="sxs-lookup"><span data-stu-id="db33f-120">This is particularly the case for peer-to-peer applications.</span></span>  
  
 <span data-ttu-id="db33f-121">Le protocole IPv6 définit une adresse IPv4 comme ayant une longueur de 128 bits.</span><span class="sxs-lookup"><span data-stu-id="db33f-121">The IPv6 protocol defined an IPv4 address as 128 bits long.</span></span> <span data-ttu-id="db33f-122">Par conséquent, IPv6 prend en charge un très grand espace d’adressage équivalant à 3,2 x 10^38 adresses uniques (2^128).</span><span class="sxs-lookup"><span data-stu-id="db33f-122">As a result, IPv6 supports very a large IP address space of 3.2 x 10^38 unique addresses (2^128).</span></span> <span data-ttu-id="db33f-123">Avec un espace d’adressage de cette taille, il est possible pour tous les appareils connectés à Internet de recevoir une adresse unique.</span><span class="sxs-lookup"><span data-stu-id="db33f-123">With an address space of this size, it is possible for every device connected to the Internet to be given a unique address.</span></span> <span data-ttu-id="db33f-124">Mais cela pose problème.</span><span class="sxs-lookup"><span data-stu-id="db33f-124">But there are problems.</span></span> <span data-ttu-id="db33f-125">En effet, IPv4 reste le protocole utilisé par la majorité des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="db33f-125">Much of the world is still using only IPv4.</span></span> <span data-ttu-id="db33f-126">La plupart des routeurs et points d’accès sans fil utilisés par les petites entreprises, les organisations et les particuliers ne prennent pas en charge IPv6.</span><span class="sxs-lookup"><span data-stu-id="db33f-126">In particular, many of the existing routers and wireless access points used by small companies, organizations, and households do not support IPv6.</span></span> <span data-ttu-id="db33f-127">De plus, certains fournisseurs de services Internet ne prennent pas en charge ou n’ont pas configuré la prise en charge d’IPv6.</span><span class="sxs-lookup"><span data-stu-id="db33f-127">Also some Internet service providers that serve these customers either do not support or have not configured support for IPv6.</span></span>  
  
 <span data-ttu-id="db33f-128">Plusieurs technologies de transition IPv6 ont été développées pour « tunneler » les adresses IPv6 dans un paquet IPv4.</span><span class="sxs-lookup"><span data-stu-id="db33f-128">Several IPv6 transition technologies have been developed to tunnel IPv6 addresses in an IPv4 packet.</span></span> <span data-ttu-id="db33f-129">Ces technologies incluent les tunnels 6to4, ISATAP et Teredo, qui fournissent une attribution d’adresses et un tunneling automatique d’hôte à hôte pour un trafic IPv6 monodiffusion, lorsque les hôtes IPv6 doivent parcourir les réseaux IP4 pour atteindre d’autres réseaux IPv6.</span><span class="sxs-lookup"><span data-stu-id="db33f-129">These technologies include 6to4, ISATAP, and Teredo tunnels that provide address assignment and host-to-host automatic tunneling for unicast IPv6 traffic when IPv6 hosts must traverse IP4 networks to reach other IPv6 networks.</span></span> <span data-ttu-id="db33f-130">Les paquets IPv6 sont « tunnelés » sous la forme de paquets IPv4.</span><span class="sxs-lookup"><span data-stu-id="db33f-130">IPv6 packets are sent tunneled as IPv4 packets.</span></span> <span data-ttu-id="db33f-131">Plusieurs techniques de tunneling utilisées actuellement permettent un parcours NAT pour les adresses IPv6 à travers un appareil NAT.</span><span class="sxs-lookup"><span data-stu-id="db33f-131">Several tunneling techniques are being used that allow NAT traversal for IPv6 addresses through a NAT device.</span></span>  
  
 <span data-ttu-id="db33f-132">Teredo fait partie des technologies de transition IPv6 qui permettent une connectivité IPv6 aux réseaux IPv4.</span><span class="sxs-lookup"><span data-stu-id="db33f-132">Teredo is one of the IPv6 transition technologies which brings IPv6 connectivity to IPv4 networks.</span></span> <span data-ttu-id="db33f-133">Teredo est documenté dans les normes RFC 4380 publiées par l’IETF (Internet Engineering Task Force).</span><span class="sxs-lookup"><span data-stu-id="db33f-133">Teredo is documented in RFC 4380 published by the Internet Engineering Task Force (IETF).</span></span> <span data-ttu-id="db33f-134">Windows XP SP2 et les versions ultérieures prennent en charge la carte virtuelle Teredo qui peut fournir une adresse IPv6 publique dans la plage 2001:0::/32.</span><span class="sxs-lookup"><span data-stu-id="db33f-134">Windows XP SP2 and later provide support for a virtual Teredo adapter which can provide a public IPv6 address in the range 2001:0::/32.</span></span> <span data-ttu-id="db33f-135">Cette adresse IPv6 peut être utilisée pour écouter les connexions entrantes à partir d’Internet et peut être fournie aux clients compatibles IPv6 qui souhaitent se connecter au service d’écoute.</span><span class="sxs-lookup"><span data-stu-id="db33f-135">This IPv6 address can be used to listen for incoming connections from the Internet and can be provided to IPv6 enabled clients that wish to connect to the listening service.</span></span> <span data-ttu-id="db33f-136">Ainsi, l’application n’a plus à se préoccuper de la manière dont elle doit contacter un ordinateur situé derrière un appareil NAT, puisqu’elle peut simplement se connecter à l’aide de son adresse Teredo IPv6.</span><span class="sxs-lookup"><span data-stu-id="db33f-136">This frees an application from worrying about how to address a computer behind a NAT device, since the application can just connect to it using its IPv6 Teredo address.</span></span>  
  
## <a name="enhancements-to-support-nat-traversal-and-teredo"></a><span data-ttu-id="db33f-137">Améliorations apportées à la prise en charge du parcours NAT et de Teredo</span><span class="sxs-lookup"><span data-stu-id="db33f-137">Enhancements to Support NAT Traversal and Teredo</span></span>  
 <span data-ttu-id="db33f-138">Des améliorations ont été apportées aux espaces de noms <xref:System.Net>, <xref:System.Net.NetworkInformation>, et <xref:System.Net.Sockets> pour prendre en charge le parcours NAT avec IPv6 et Teredo.</span><span class="sxs-lookup"><span data-stu-id="db33f-138">Enhancements are added to the <xref:System.Net>, <xref:System.Net.NetworkInformation>, and <xref:System.Net.Sockets> namespaces for supporting NAT traversal using IPv6 and Teredo.</span></span>  
  
 <span data-ttu-id="db33f-139">Plusieurs méthodes ont été ajoutées à la classe <xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=nameWithType> pour obtenir la liste d’adresses IP de monodiffusion sur l’hôte.</span><span class="sxs-lookup"><span data-stu-id="db33f-139">Several methods are added to the <xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=nameWithType> class to get the list of unicast IP addresses on the host.</span></span> <span data-ttu-id="db33f-140">La méthode <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A> lance une requête asynchrone pour récupérer la table des adresses IP de monodiffusion stable sur l’ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="db33f-140">The <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A> method begins an asynchronous request to retrieve the stable unicast IP address table on the local computer.</span></span> <span data-ttu-id="db33f-141">La méthode <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A> termine une requête asynchrone en attente pour récupérer la table des adresses IP de monodiffusion stable sur l’ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="db33f-141">The <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A> method ends a pending asynchronous request to retrieve the stable unicast IP address table on the local computer.</span></span> <span data-ttu-id="db33f-142">La méthode <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A> est une requête synchrone qui permet de récupérer la table d’adresses IP de monodiffusion stable sur l’ordinateur local, et d’attendre que la table d’adresses soit stable, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="db33f-142">The <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A> method is a synchronous request to retrieve the stable unicast IP address table on the local computer, waiting until the address table stabilizes if necessary.</span></span>  
  
 <span data-ttu-id="db33f-143">La propriété <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType> peut être utilisée pour déterminer si un <xref:System.Net.IPAddress> est une adresse Teredo IPv6.</span><span class="sxs-lookup"><span data-stu-id="db33f-143">The <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType> property can be used to determine if an <xref:System.Net.IPAddress> is an IPv6 Teredo address.</span></span>  
  
 <span data-ttu-id="db33f-144">L’association de ces nouvelles méthodes de classe <xref:System.Net.NetworkInformation.IPGlobalProperties> et de la propriété <xref:System.Net.IPAddress.IsIPv6Teredo%2A> permet à une application de retrouver facilement l’adresse Teredo.</span><span class="sxs-lookup"><span data-stu-id="db33f-144">Using these new <xref:System.Net.NetworkInformation.IPGlobalProperties> class methods in combination with the <xref:System.Net.IPAddress.IsIPv6Teredo%2A> property allows an application to easily find the Teredo address.</span></span> <span data-ttu-id="db33f-145">Généralement, une application a seulement besoin de connaître l’adresse Teredo locale si elle communique ces informations à des applications distantes.</span><span class="sxs-lookup"><span data-stu-id="db33f-145">An application normally only needs to know the local Teredo address if it is communicating this information to remote applications.</span></span> <span data-ttu-id="db33f-146">Par exemple, une application pair à pair peut envoyer toutes ses adresses IPv6 à un serveur de matchmaking qui peut ensuite les transférer à d’autres pairs pour permettre une communication directe.</span><span class="sxs-lookup"><span data-stu-id="db33f-146">For example, a peer-to-peer application might send all of its IPv6 addresses to a matchmaking server which can then forward them to others peers to enable direct communication.</span></span>  
  
 <span data-ttu-id="db33f-147">Une application doit normalement définir son service d’écoute pour écouter <xref:System.Net.IPAddress.IPv6Any?displayProperty=nameWithType> plutôt que l’adresse Teredo locale.</span><span class="sxs-lookup"><span data-stu-id="db33f-147">An application should normally set its listening service to listen on <xref:System.Net.IPAddress.IPv6Any?displayProperty=nameWithType> rather than on the local Teredo address.</span></span> <span data-ttu-id="db33f-148">Par conséquent, si un client ou un pair distant dispose d’un itinéraire IPv6 direct vers l’hôte du service d’écoute, le client ou le pair peut se connecter directement à l’aide d’IPv6, sans devoir utiliser Teredo pour « tunneler » les paquets.</span><span class="sxs-lookup"><span data-stu-id="db33f-148">So if a remote client or peer has a direct IPv6 route to the host of the listening service, the client or peer can connect directly using IPv6 and not have to use Teredo to tunnel packets.</span></span>  
  
 <span data-ttu-id="db33f-149">Pour les applications TCP, la classe <xref:System.Net.Sockets.TcpListener?displayProperty=nameWithType> comprend une méthode <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A> qui permet un parcours NAT.</span><span class="sxs-lookup"><span data-stu-id="db33f-149">For TCP applications, the <xref:System.Net.Sockets.TcpListener?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A> method to enable NAT traversal.</span></span> <span data-ttu-id="db33f-150">Pour les applications UDP, la classe <xref:System.Net.Sockets.UdpClient?displayProperty=nameWithType> comprend une méthode <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A> qui permet un parcours NAT.</span><span class="sxs-lookup"><span data-stu-id="db33f-150">For UDP applications, the <xref:System.Net.Sockets.UdpClient?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A> method to enable NAT traversal.</span></span>  
  
 <span data-ttu-id="db33f-151">Pour les applications qui utilisent <xref:System.Net.Sockets.Socket?displayProperty=nameWithType> et les classes associées, les méthodes <xref:System.Net.Sockets.Socket.GetSocketOption%2A> et <xref:System.Net.Sockets.Socket.SetSocketOption%2A> peuvent être utilisées avec l’option de socket <xref:System.Net.Sockets.SocketOptionName.IPProtectionLevel?displayProperty=nameWithType> pour interroger, activer ou désactiver le parcours NAT.</span><span class="sxs-lookup"><span data-stu-id="db33f-151">For applications that use the <xref:System.Net.Sockets.Socket?displayProperty=nameWithType> and related classes, the <xref:System.Net.Sockets.Socket.GetSocketOption%2A> and <xref:System.Net.Sockets.Socket.SetSocketOption%2A> methods can be used with the <xref:System.Net.Sockets.SocketOptionName.IPProtectionLevel?displayProperty=nameWithType> socket option to query, enable, or disable NAT traversal.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="db33f-152">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="db33f-152">See also</span></span>

- <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.IPProtectionLevel?displayProperty=nameWithType>
- <xref:System.Net.Sockets.Socket.SetIPProtectionLevel%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A?displayProperty=nameWithType>

---
title: Automatisation de l’interface utilisateur d’un contrôle personnalisé
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- custom controls [WPF], applying UI automation
- accessibility [WPF], applying to custom controls
- custom controls [WPF], improving accessibility
- UI Automation [WPF], using with custom controls
ms.assetid: 47b310fc-fbd5-4ce2-a606-22d04c6d4911
ms.openlocfilehash: 9c33d0e5da70820041ba2a2881082d9f7d179fc5
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79187506"
---
# <a name="ui-automation-of-a-wpf-custom-control"></a><span data-ttu-id="d1ecf-102">UI Automation d'un contrôle personnalisé WPF</span><span class="sxs-lookup"><span data-stu-id="d1ecf-102">UI Automation of a WPF Custom Control</span></span>
[!INCLUDE[TLA#tla_uiautomation](../../../../includes/tlasharptla-uiautomation-md.md)] <span data-ttu-id="d1ecf-103">fournit une interface unique et généralisée que les clients Automation peuvent utiliser pour examiner ou utiliser les interfaces utilisateur de diverses plateformes et infrastructures.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-103">provides a single, generalized interface that automation clients can use to examine or operate the user interfaces of a variety of platforms and frameworks.</span></span> [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] <span data-ttu-id="d1ecf-104">active à la fois le code d’assurance qualité (test) et les applications d’accessibilité, par exemple les lecteurs d’écran, pour examiner les éléments de l’interface utilisateur et simuler la manière dont les utilisateurs interagissent avec ces éléments à partir d’un autre code.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-104">enables both quality-assurance (test) code and accessibility applications such as screen readers to examine user-interface elements and simulate user interaction with them from other code.</span></span> <span data-ttu-id="d1ecf-105">Pour plus d’informations sur [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] pour toutes les plateformes, consultez la rubrique d’accessibilité.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-105">For information about [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] across all platforms, see Accessibility.</span></span>  
  
 <span data-ttu-id="d1ecf-106">Cette rubrique explique comment implémenter un fournisseur UI Automation côté serveur pour un contrôle personnalisé qui s’exécute dans une application WPF.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-106">This topic describes how to implement a server-side UI Automation provider for a custom control that runs in a WPF application.</span></span> <span data-ttu-id="d1ecf-107">WPF prend en charge [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] à travers une arborescence d’objets Automation homologues qui présente en parallèle l’arborescence des éléments de l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-107">WPF supports [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] through a tree of peer automation objects that parallels the tree of user interface elements.</span></span> <span data-ttu-id="d1ecf-108">Le code de test et les applications qui fournissent des fonctionnalités d’accessibilité peuvent utiliser des objets homologues Automation, soit directement (pour le code in-process), soit travers l’interface généralisée fournie par [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d1ecf-108">Test code and applications that provide accessibility features can use automation peer objects directly (for in-process code) or through the generalized interface provided by [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)].</span></span>  

<a name="AutomationPeerClasses"></a>
## <a name="automation-peer-classes"></a><span data-ttu-id="d1ecf-109">Classes homologues Automation</span><span class="sxs-lookup"><span data-stu-id="d1ecf-109">Automation Peer Classes</span></span>  
 <span data-ttu-id="d1ecf-110">WPF contrôle [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] le soutien à travers <xref:System.Windows.Automation.Peers.AutomationPeer>un arbre de classes de pairs qui dérivent de .</span><span class="sxs-lookup"><span data-stu-id="d1ecf-110">WPF controls support [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] through a tree of peer classes that derive from <xref:System.Windows.Automation.Peers.AutomationPeer>.</span></span> <span data-ttu-id="d1ecf-111">Par convention, les noms de classes homologues commencent par le nom de la classe de contrôle et se terminent par « AutomationPeer ».</span><span class="sxs-lookup"><span data-stu-id="d1ecf-111">By convention, peer class names begin with the control class name and end with "AutomationPeer".</span></span> <span data-ttu-id="d1ecf-112">Par exemple, <xref:System.Windows.Automation.Peers.ButtonAutomationPeer> est la <xref:System.Windows.Controls.Button> classe de pairs pour la classe de contrôle.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-112">For example, <xref:System.Windows.Automation.Peers.ButtonAutomationPeer> is the peer class for the <xref:System.Windows.Controls.Button> control class.</span></span> <span data-ttu-id="d1ecf-113">Les classes de pairs [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] sont à peu près équivalentes aux types de contrôle, mais sont spécifiques aux éléments WPF.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-113">The peer classes are roughly equivalent to [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] control types but are specific to WPF elements.</span></span> <span data-ttu-id="d1ecf-114">Le code Automation qui accède aux applications WPF via l’interface [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] n’utilise pas directement les homologues Automation, mais le code Automation dans le même espace de processus peut utiliser directement les homologues Automation.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-114">Automation code that accesses WPF applications through the [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] interface does not use automation peers directly, but automation code in the same process space can use automation peers directly.</span></span>  
  
<a name="BuiltInAutomationPeerClasses"></a>
## <a name="built-in-automation-peer-classes"></a><span data-ttu-id="d1ecf-115">Classes homologues Automation intégrées</span><span class="sxs-lookup"><span data-stu-id="d1ecf-115">Built-in Automation Peer Classes</span></span>  
 <span data-ttu-id="d1ecf-116">Des éléments implémentent une classe homologue Automation s’ils acceptent l’activité de l’utilisateur dans l’interface, ou s’ils contiennent les informations dont ont besoin les utilisateurs d’applications de lecteur d’écran.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-116">Elements implement an automation peer class if they accept interface activity from the user, or if they contain information needed by users of screen-reader applications.</span></span> <span data-ttu-id="d1ecf-117">Tous les éléments visuels WPF n’ont pas d’homologues Automation.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-117">Not all WPF visual elements have automation peers.</span></span> <span data-ttu-id="d1ecf-118">Exemples de classes qui <xref:System.Windows.Controls.Button> <xref:System.Windows.Controls.TextBox>mettent <xref:System.Windows.Controls.Label>en œuvre des pairs d’automatisation sont , , et .</span><span class="sxs-lookup"><span data-stu-id="d1ecf-118">Examples of classes that implement automation peers are <xref:System.Windows.Controls.Button>, <xref:System.Windows.Controls.TextBox>, and <xref:System.Windows.Controls.Label>.</span></span> <span data-ttu-id="d1ecf-119">Des exemples de classes qui ne mettent <xref:System.Windows.Controls.Decorator>pas <xref:System.Windows.Controls.Border>en œuvre <xref:System.Windows.Controls.Panel>des <xref:System.Windows.Controls.Grid> pairs <xref:System.Windows.Controls.Canvas>d’automatisation sont des classes qui dérivent de , telles que , et des classes basées sur , tels que et .</span><span class="sxs-lookup"><span data-stu-id="d1ecf-119">Examples of classes that do not implement automation peers are classes that derive from <xref:System.Windows.Controls.Decorator>, such as <xref:System.Windows.Controls.Border>, and classes based on <xref:System.Windows.Controls.Panel>, such as <xref:System.Windows.Controls.Grid> and <xref:System.Windows.Controls.Canvas>.</span></span>  
  
 <span data-ttu-id="d1ecf-120">La <xref:System.Windows.Controls.Control> classe de base n’a pas de classe de pairs correspondante.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-120">The base <xref:System.Windows.Controls.Control> class does not have a corresponding peer class.</span></span> <span data-ttu-id="d1ecf-121">Si vous avez besoin d’une classe de <xref:System.Windows.Controls.Control>pairs pour correspondre à un <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>contrôle personnalisé qui dérive de , vous devriez tirer la classe de pairs personnalisé de .</span><span class="sxs-lookup"><span data-stu-id="d1ecf-121">If you need a peer class to correspond to a custom control that derives from <xref:System.Windows.Controls.Control>, you should derive the custom peer class from <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>.</span></span>  
  
<a name="SecurityConsiderations"></a>
## <a name="security-considerations-for-derived-peers"></a><span data-ttu-id="d1ecf-122">Considérations relatives à la sécurité des homologues dérivés</span><span class="sxs-lookup"><span data-stu-id="d1ecf-122">Security Considerations for Derived Peers</span></span>  
 <span data-ttu-id="d1ecf-123">Les homologues Automation doivent s’exécuter dans un environnement de confiance partielle.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-123">Automation peers must run in a partial-trust environment.</span></span> <span data-ttu-id="d1ecf-124">Le code dans l’assembly UIAutomationClient n’est pas configuré pour s’exécuter dans un environnement de confiance partielle et le code homologue Automation ne doit pas référencer cet assembly.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-124">Code in the UIAutomationClient assembly is not configured to run in a partial-trust environment, and automation peer code should not reference that assembly.</span></span> <span data-ttu-id="d1ecf-125">Au lieu de cela, vous devez utiliser les classes de l’assembly UIAutomationTypes.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-125">Instead, you should use the classes in the UIAutomationTypes assembly.</span></span> <span data-ttu-id="d1ecf-126">Par exemple, vous <xref:System.Windows.Automation.AutomationElementIdentifiers> devez utiliser la classe à partir de l’assemblage <xref:System.Windows.Automation.AutomationElement> UIAutomationTypes, qui correspond à la classe dans l’assemblage UIAutomationClient.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-126">For example, you should use the <xref:System.Windows.Automation.AutomationElementIdentifiers> class from the UIAutomationTypes assembly, which corresponds to the <xref:System.Windows.Automation.AutomationElement> class in the UIAutomationClient assembly.</span></span> <span data-ttu-id="d1ecf-127">La démarche la plus sûre consiste à référencer l’assembly UIAutomationTypes dans le code homologue Automation.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-127">It is safe to reference the UIAutomationTypes assembly in automation peer code.</span></span>  
  
<a name="PeerNavigation"></a>
## <a name="peer-navigation"></a><span data-ttu-id="d1ecf-128">Navigation homologue</span><span class="sxs-lookup"><span data-stu-id="d1ecf-128">Peer Navigation</span></span>  
 <span data-ttu-id="d1ecf-129">Après avoir localisé un pair d’automatisation, le code en cours <xref:System.Windows.Automation.Peers.AutomationPeer.GetChildren%2A> peut <xref:System.Windows.Automation.Peers.AutomationPeer.GetParent%2A> naviguer dans l’arbre de pairs en appelant l’objet et les méthodes.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-129">After locating an automation peer, in-process code can navigate the peer tree by calling the object's <xref:System.Windows.Automation.Peers.AutomationPeer.GetChildren%2A> and <xref:System.Windows.Automation.Peers.AutomationPeer.GetParent%2A> methods.</span></span> <span data-ttu-id="d1ecf-130">La navigation entre les éléments WPF dans un contrôle <xref:System.Windows.Automation.Peers.AutomationPeer.GetChildrenCore%2A> est soutenue par la mise en œuvre de la méthode par le pair.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-130">Navigation among WPF elements within a control is supported by the peer's implementation of the <xref:System.Windows.Automation.Peers.AutomationPeer.GetChildrenCore%2A> method.</span></span> <span data-ttu-id="d1ecf-131">Le système UI Automation appelle cette méthode pour générer une arborescence de sous-éléments contenus dans un contrôle ; par exemple, des éléments de liste dans une zone de liste.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-131">The UI Automation system calls this method to build up a tree of subelements contained within a control; for example, list items in a list box.</span></span> <span data-ttu-id="d1ecf-132">La <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A?displayProperty=nameWithType> méthode par défaut traverse l’arbre visuel des éléments pour construire l’arbre des pairs d’automatisation.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-132">The default <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A?displayProperty=nameWithType> method traverses the visual tree of elements to build the tree of automation peers.</span></span> <span data-ttu-id="d1ecf-133">Les contrôles personnalisés contournent cette méthode pour exposer les éléments enfants aux clients Automation, en retournant les homologues Automation des éléments qui acheminent des informations ou qui permettent une interaction avec l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-133">Custom controls override this method to expose children elements to automation clients, returning the automation peers of elements that convey information or allow user interaction.</span></span>  
  
<a name="Customizations"></a>
## <a name="customizations-in-a-derived-peer"></a><span data-ttu-id="d1ecf-134">Personnalisations dans un homologue dérivé</span><span class="sxs-lookup"><span data-stu-id="d1ecf-134">Customizations in a Derived Peer</span></span>  
 <span data-ttu-id="d1ecf-135">Toutes les classes <xref:System.Windows.UIElement> <xref:System.Windows.ContentElement> qui dérivent <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A>et contiennent la méthode virtuelle protégée.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-135">All classes that derive from <xref:System.Windows.UIElement> and <xref:System.Windows.ContentElement> contain the protected virtual method <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A>.</span></span> <span data-ttu-id="d1ecf-136">WPF <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> appelle pour obtenir l’objet pair d’automatisation pour chaque contrôle.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-136">WPF calls <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> to get the automation peer object for each control.</span></span> <span data-ttu-id="d1ecf-137">Le code Automation peut utiliser l’homologue pour obtenir des informations sur les caractéristiques et les fonctionnalités d’un contrôle et pour simuler une utilisation interactive.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-137">Automation code can use the peer to get information about a control’s characteristics and features and to simulate interactive use.</span></span> <span data-ttu-id="d1ecf-138">Un contrôle personnalisé qui prend <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> en charge l’automatisation doit <xref:System.Windows.Automation.Peers.AutomationPeer>remplacer et retourner une instance d’une classe qui dérive de .</span><span class="sxs-lookup"><span data-stu-id="d1ecf-138">A custom control that supports automation must override <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> and return an instance of a class that derives from <xref:System.Windows.Automation.Peers.AutomationPeer>.</span></span> <span data-ttu-id="d1ecf-139">Par exemple, si un contrôle <xref:System.Windows.Controls.Primitives.ButtonBase> personnalisé dérive de la <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> classe, <xref:System.Windows.Automation.Peers.ButtonBaseAutomationPeer>alors l’objet retourné par doit dériver de .</span><span class="sxs-lookup"><span data-stu-id="d1ecf-139">For example, if a custom control derives from the <xref:System.Windows.Controls.Primitives.ButtonBase> class, then the object returned by <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> should derive from <xref:System.Windows.Automation.Peers.ButtonBaseAutomationPeer>.</span></span>  
  
 <span data-ttu-id="d1ecf-140">Lorsque vous implémentez un contrôle personnalisé, vous devez substituer les méthodes « Core » à partir de la classe homologue Automation de base qui décrivent le comportement unique et spécifique à votre contrôle personnalisé.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-140">When implementing a custom control, you must override the "Core" methods from the base automation peer class that describe behavior unique and specific to your custom control.</span></span>  
  
### <a name="override-oncreateautomationpeer"></a><span data-ttu-id="d1ecf-141">Substituer la méthode OnCreateAutomationPeer</span><span class="sxs-lookup"><span data-stu-id="d1ecf-141">Override OnCreateAutomationPeer</span></span>  
 <span data-ttu-id="d1ecf-142">Remplacer la <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> méthode de votre contrôle personnalisé afin qu’il renvoie votre <xref:System.Windows.Automation.Peers.AutomationPeer>objet fournisseur, qui doit dériver directement ou indirectement de .</span><span class="sxs-lookup"><span data-stu-id="d1ecf-142">Override the <xref:System.Windows.UIElement.OnCreateAutomationPeer%2A> method for your custom control so that it returns your provider object, which must derive directly or indirectly from <xref:System.Windows.Automation.Peers.AutomationPeer>.</span></span>  
  
### <a name="override-getpattern"></a><span data-ttu-id="d1ecf-143">Substituer la méthode GetPattern</span><span class="sxs-lookup"><span data-stu-id="d1ecf-143">Override GetPattern</span></span>  
 <span data-ttu-id="d1ecf-144">Les homologues Automation simplifient certains aspects de l’implémentation des fournisseurs [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] côté serveur, fournisseurs, mais les homologues Automation d’un contrôle personnalisé doivent encore gérer les interfaces de modèle.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-144">Automation peers simplify some implementation aspects of server-side [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] providers, but custom control automation peers must still handle pattern interfaces.</span></span> <span data-ttu-id="d1ecf-145">Comme les fournisseurs non-WPF, les pairs prennent en <xref:System.Windows.Automation.Provider?displayProperty=nameWithType> charge les modèles <xref:System.Windows.Automation.Provider.IInvokeProvider>de contrôle en fournissant des implémentations d’interfaces dans l’espace de nom, tels que .</span><span class="sxs-lookup"><span data-stu-id="d1ecf-145">Like non-WPF providers, peers support control patterns by providing implementations of interfaces in the <xref:System.Windows.Automation.Provider?displayProperty=nameWithType> namespace, such as <xref:System.Windows.Automation.Provider.IInvokeProvider>.</span></span> <span data-ttu-id="d1ecf-146">Les interfaces de modèle de contrôle peuvent être implémentées par l’homologue lui-même ou par un autre objet.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-146">The control pattern interfaces can be implemented by the peer itself or by another object.</span></span> <span data-ttu-id="d1ecf-147">La mise en <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> œuvre par le pair des retours de l’objet qui prend en charge le modèle spécifié.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-147">The peer's implementation of <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> returns the object that supports the specified pattern.</span></span> [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)]<span data-ttu-id="d1ecf-148">code appelle <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> la méthode et <xref:System.Windows.Automation.Peers.PatternInterface> spécifie une valeur de recensement.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-148">code calls the <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> method and specifies a <xref:System.Windows.Automation.Peers.PatternInterface> enumeration value.</span></span> <span data-ttu-id="d1ecf-149">Votre remplacement <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> de devrait retourner l’objet qui implémente le modèle spécifié.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-149">Your override of <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> should return the object that implements the specified pattern.</span></span> <span data-ttu-id="d1ecf-150">Si votre contrôle n’a pas une mise en œuvre personnalisée <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> d’un modèle, vous pouvez appeler la mise en œuvre du type de base pour récupérer sa mise en œuvre ou nulle si le modèle n’est pas pris en charge pour ce type de contrôle.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-150">If your control does not have a custom implementation of a pattern, you can call the base type's implementation of <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> to retrieve either its implementation or null if the pattern is not supported for this control type.</span></span> <span data-ttu-id="d1ecf-151">Par exemple, un contrôle NumericUpDown personnalisé peut être défini [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] à une <xref:System.Windows.Automation.Provider.IRangeValueProvider> valeur dans une plage, de sorte que son homologue implémenterait l’interface.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-151">For example, a custom NumericUpDown control can be set to a value within a range, so its [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] peer would implement the <xref:System.Windows.Automation.Provider.IRangeValueProvider> interface.</span></span> <span data-ttu-id="d1ecf-152">L’exemple suivant montre comment <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> la méthode du pair <xref:System.Windows.Automation.Peers.PatternInterface.RangeValue?displayProperty=nameWithType> est remplacée pour répondre à une valeur.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-152">The following example shows how the peer's <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> method is overridden to respond to a <xref:System.Windows.Automation.Peers.PatternInterface.RangeValue?displayProperty=nameWithType> value.</span></span>  
  
 [!code-csharp[CustomControlNumericUpDown#GetPattern](~/samples/snippets/csharp/VS_Snippets_Wpf/CustomControlNumericUpDown/CSharp/CustomControlLibrary/NumericUpDown.cs#getpattern)]
 [!code-vb[CustomControlNumericUpDown#GetPattern](~/samples/snippets/visualbasic/VS_Snippets_Wpf/CustomControlNumericUpDown/visualbasic/customcontrollibrary/numericupdown.vb#getpattern)]  
  
 <span data-ttu-id="d1ecf-153">Une <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> méthode peut également spécifier un sous-cadre en tant que fournisseur de motifs.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-153">A <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetPattern%2A> method can also specify a subelement as a pattern provider.</span></span> <span data-ttu-id="d1ecf-154">Le code suivant <xref:System.Windows.Controls.ItemsControl> montre comment transfère la <xref:System.Windows.Controls.ScrollViewer> manipulation des modèles de défilement au pair de son contrôle interne.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-154">The following code shows how <xref:System.Windows.Controls.ItemsControl> transfers scroll pattern handling to the peer of its internal <xref:System.Windows.Controls.ScrollViewer> control.</span></span>  
  
```csharp  
public override object GetPattern(PatternInterface patternInterface)  
{  
    if (patternInterface == PatternInterface.Scroll)  
    {  
        ItemsControl owner = (ItemsControl) base.Owner;  
  
        // ScrollHost is internal to the ItemsControl class  
        if (owner.ScrollHost != null)  
        {  
            AutomationPeer peer = UIElementAutomationPeer.CreatePeerForElement(owner.ScrollHost);  
            if ((peer != null) && (peer is IScrollProvider))  
            {  
                peer.EventsSource = this;  
                return (IScrollProvider) peer;  
            }  
        }  
    }  
    return base.GetPattern(patternInterface);  
}  
```  
  
```vb  
Public Class Class1  
    Public Overrides Function GetPattern(ByVal patternInterface__1 As PatternInterface) As Object  
        If patternInterface1 = PatternInterface.Scroll Then  
            Dim owner As ItemsControl = DirectCast(MyBase.Owner, ItemsControl)  
  
            ' ScrollHost is internal to the ItemsControl class  
            If owner.ScrollHost IsNot Nothing Then  
                Dim peer As AutomationPeer = UIElementAutomationPeer.CreatePeerForElement(owner.ScrollHost)  
                If (peer IsNot Nothing) AndAlso (TypeOf peer Is IScrollProvider) Then  
                    peer.EventsSource = Me  
                    Return DirectCast(peer, IScrollProvider)  
                End If  
            End If  
        End If  
        Return MyBase.GetPattern(patternInterface1)  
    End Function  
End Class  
```  
  
 <span data-ttu-id="d1ecf-155">Pour spécifier un sous-ensemble pour la manipulation des motifs, <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.CreatePeerForElement%2A> ce code <xref:System.Windows.Automation.Peers.AutomationPeer.EventsSource%2A> obtient l’objet de sous-ensemble, crée un pair en utilisant la méthode, définit la propriété du nouveau pair au pair actuel, et renvoie le nouveau pair.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-155">To specify a subelement for pattern handling, this code gets the subelement object, creates a peer by using the <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.CreatePeerForElement%2A> method, sets the <xref:System.Windows.Automation.Peers.AutomationPeer.EventsSource%2A> property of the new peer to the current peer, and returns the new peer.</span></span> <span data-ttu-id="d1ecf-156">Le <xref:System.Windows.Automation.Peers.AutomationPeer.EventsSource%2A> réglage sur un sous-cadre empêche le sous-cadre d’apparaître dans l’arbre de pair d’automatisation <xref:System.Windows.Automation.Peers.AutomationPeer.EventsSource%2A>et désigne tous les événements soulevés par le sous-cadre comme provenant du contrôle spécifié dans .</span><span class="sxs-lookup"><span data-stu-id="d1ecf-156">Setting <xref:System.Windows.Automation.Peers.AutomationPeer.EventsSource%2A> on a subelement prevents the subelement from appearing in the automation peer tree and designates all events raised by the subelement as originating from the control specified in <xref:System.Windows.Automation.Peers.AutomationPeer.EventsSource%2A>.</span></span> <span data-ttu-id="d1ecf-157">Le <xref:System.Windows.Controls.ScrollViewer> contrôle n’apparaît pas dans l’arbre d’automatisation, et les <xref:System.Windows.Controls.ItemsControl> événements de défilement qu’il génère semblent provenir de l’objet.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-157">The <xref:System.Windows.Controls.ScrollViewer> control does not appear in the automation tree, and scrolling events that it generates appear to originate from the <xref:System.Windows.Controls.ItemsControl> object.</span></span>  
  
### <a name="override-core-methods"></a><span data-ttu-id="d1ecf-158">Substituer les méthodes « Core »</span><span class="sxs-lookup"><span data-stu-id="d1ecf-158">Override "Core" Methods</span></span>  
 <span data-ttu-id="d1ecf-159">Le code Automation obtient des informations sur votre contrôle en appelant des méthodes publiques de la classe homologue.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-159">Automation code gets information about your control by calling public methods of the peer class.</span></span> <span data-ttu-id="d1ecf-160">Pour fournir des informations sur votre contrôle, substituez chaque méthode dont le nom se termine par « Core » lorsque l’implémentation de votre contrôle diffère de celle fournie par la classe homologue Automation de base.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-160">To provide information about your control, override each method whose name ends with "Core" when your control implementation differs from that of that provided by the base automation peer class.</span></span> <span data-ttu-id="d1ecf-161">À tout le moins, <xref:System.Windows.Automation.Peers.AutomationPeer.GetClassNameCore%2A> votre <xref:System.Windows.Automation.Peers.AutomationPeer.GetAutomationControlTypeCore%2A> contrôle doit implémenter les méthodes et les méthodes, comme le montre l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-161">At a minimum, your control must implement the <xref:System.Windows.Automation.Peers.AutomationPeer.GetClassNameCore%2A> and <xref:System.Windows.Automation.Peers.AutomationPeer.GetAutomationControlTypeCore%2A> methods, as shown in the following example.</span></span>  
  
 [!code-csharp[CustomControlNumericUpDown#CoreOverrides](~/samples/snippets/csharp/VS_Snippets_Wpf/CustomControlNumericUpDown/CSharp/CustomControlLibrary/NumericUpDown.cs#coreoverrides)]
 [!code-vb[CustomControlNumericUpDown#CoreOverrides](~/samples/snippets/visualbasic/VS_Snippets_Wpf/CustomControlNumericUpDown/visualbasic/customcontrollibrary/numericupdown.vb#coreoverrides)]  
  
 <span data-ttu-id="d1ecf-162">Votre mise <xref:System.Windows.Automation.Peers.AutomationPeer.GetAutomationControlTypeCore%2A> en œuvre <xref:System.Windows.Automation.ControlType> décrit votre contrôle en retournant une valeur.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-162">Your implementation of <xref:System.Windows.Automation.Peers.AutomationPeer.GetAutomationControlTypeCore%2A> describes your control by returning a <xref:System.Windows.Automation.ControlType> value.</span></span> <span data-ttu-id="d1ecf-163">Bien que <xref:System.Windows.Automation.ControlType.Custom?displayProperty=nameWithType>vous puissiez revenir, vous devez retourner l’un des types de contrôle les plus spécifiques s’il décrit avec précision votre contrôle.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-163">Although you can return <xref:System.Windows.Automation.ControlType.Custom?displayProperty=nameWithType>, you should return one of the more specific control types if it accurately describes your control.</span></span> <span data-ttu-id="d1ecf-164">Une valeur <xref:System.Windows.Automation.ControlType.Custom?displayProperty=nameWithType> de retour de nécessite [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)]un [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] travail supplémentaire pour le fournisseur de mettre en œuvre, et les produits clients sont incapables d’anticiper la structure de contrôle, l’interaction clavier, et les modèles de contrôle possibles.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-164">A return value of <xref:System.Windows.Automation.ControlType.Custom?displayProperty=nameWithType> requires extra work for the provider to implement [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)], and [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] client products are unable to anticipate the control structure, keyboard interaction, and possible control patterns.</span></span>  
  
 <span data-ttu-id="d1ecf-165">Implémentez les <xref:System.Windows.Automation.Peers.AutomationPeer.IsContentElementCore%2A> méthodes et <xref:System.Windows.Automation.Peers.AutomationPeer.IsControlElementCore%2A> les méthodes pour indiquer si votre contrôle contient du contenu de données ou remplit un rôle interactif dans l’interface utilisateur (ou les deux).</span><span class="sxs-lookup"><span data-stu-id="d1ecf-165">Implement the <xref:System.Windows.Automation.Peers.AutomationPeer.IsContentElementCore%2A> and <xref:System.Windows.Automation.Peers.AutomationPeer.IsControlElementCore%2A> methods to indicate whether your control contains data content or fulfills an interactive role in the user interface (or both).</span></span> <span data-ttu-id="d1ecf-166">Par défaut, ces deux méthodes retournent `true`.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-166">By default, both methods return `true`.</span></span> <span data-ttu-id="d1ecf-167">Ces paramètres facilitent l’utilisation des outils Automatisation, comme les lecteurs d’écran, qui peuvent utiliser ces méthodes pour filtrer l’arborescence Automation.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-167">These settings improve the usability of automation tools such as screen readers, which may use these methods to filter the automation tree.</span></span> <span data-ttu-id="d1ecf-168">Si <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> votre méthode transfère la manipulation de modèle à <xref:System.Windows.Automation.Peers.AutomationPeer.IsControlElementCore%2A> un pair de sous-ensemble, la méthode du pair de sous-ensemble peut retourner fausse pour cacher le pair de sous-ensemble de l’arbre d’automatisation.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-168">If your <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> method transfers pattern handling to a subelement peer, the subelement peer's <xref:System.Windows.Automation.Peers.AutomationPeer.IsControlElementCore%2A> method can return false to hide the subelement peer from the automation tree.</span></span> <span data-ttu-id="d1ecf-169">Par exemple, le <xref:System.Windows.Controls.ListBox> défilement dans <xref:System.Windows.Controls.ScrollViewer>un est manipulé <xref:System.Windows.Automation.Peers.PatternInterface.Scroll?displayProperty=nameWithType> par un <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> , <xref:System.Windows.Automation.Peers.ScrollViewerAutomationPeer> et le pair <xref:System.Windows.Automation.Peers.ListBoxAutomationPeer>d’automatisation pour est retourné par la méthode de la qui est associée à la . Par conséquent, <xref:System.Windows.Automation.Peers.AutomationPeer.IsControlElementCore%2A> la <xref:System.Windows.Automation.Peers.ScrollViewerAutomationPeer> `false`méthode des <xref:System.Windows.Automation.Peers.ScrollViewerAutomationPeer> retours , de sorte que le n’apparaît pas dans l’arbre d’automatisation.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-169">For example, scrolling in a <xref:System.Windows.Controls.ListBox> is handled by a <xref:System.Windows.Controls.ScrollViewer>, and the automation peer for <xref:System.Windows.Automation.Peers.PatternInterface.Scroll?displayProperty=nameWithType> is returned by the <xref:System.Windows.Automation.Peers.AutomationPeer.GetPattern%2A> method of the <xref:System.Windows.Automation.Peers.ScrollViewerAutomationPeer> that is associated with the <xref:System.Windows.Automation.Peers.ListBoxAutomationPeer>.Therefore, the <xref:System.Windows.Automation.Peers.AutomationPeer.IsControlElementCore%2A> method of the <xref:System.Windows.Automation.Peers.ScrollViewerAutomationPeer> returns `false`, so that the <xref:System.Windows.Automation.Peers.ScrollViewerAutomationPeer> does not appear in the automation tree.</span></span>  
  
 <span data-ttu-id="d1ecf-170">Votre homologue Automation doit fournir des valeurs par défaut appropriées pour votre contrôle.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-170">Your automation peer should provide appropriate default values for your control.</span></span> <span data-ttu-id="d1ecf-171">Notez que XAML qui fait référence à votre contrôle <xref:System.Windows.Automation.AutomationProperties> peut remplacer vos implémentations par les pairs des méthodes de base en incluant des attributs.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-171">Note that XAML that references your control can override your peer implementations of core methods by including <xref:System.Windows.Automation.AutomationProperties> attributes.</span></span> <span data-ttu-id="d1ecf-172">Par exemple, le code XAML suivant crée un bouton qui comporte deux propriétés [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] personnalisées.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-172">For example, the following XAML creates a button that has two customized [!INCLUDE[TLA2#tla_uiautomation](../../../../includes/tla2sharptla-uiautomation-md.md)] properties.</span></span>  
  
```xaml  
<Button AutomationProperties.Name="Special"
    AutomationProperties.HelpText="This is a special button."/>  
```  
  
### <a name="implement-pattern-providers"></a><span data-ttu-id="d1ecf-173">Implémenter des fournisseurs de modèles</span><span class="sxs-lookup"><span data-stu-id="d1ecf-173">Implement Pattern Providers</span></span>  
 <span data-ttu-id="d1ecf-174">Les interfaces mises en œuvre par un fournisseur personnalisé <xref:System.Windows.Controls.Control>sont explicitement déclarées si l’élément propriétaire dérive directement de .</span><span class="sxs-lookup"><span data-stu-id="d1ecf-174">The interfaces implemented by a custom provider are explicitly declared if the owning element derives directly from <xref:System.Windows.Controls.Control>.</span></span> <span data-ttu-id="d1ecf-175">Par exemple, le code suivant déclare <xref:System.Windows.Controls.Control> un pair pour un qui implémente une valeur de plage.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-175">For example, the following code declares a peer for a <xref:System.Windows.Controls.Control> that implements a range value.</span></span>  
  
```csharp  
public class RangePeer1 : FrameworkElementAutomationPeer, IRangeValueProvider { }  
```  
  
```vb  
Public Class RangePeer1  
    Inherits FrameworkElementAutomationPeer  
    Implements IRangeValueProvider  
End Class  
```  
  
 <span data-ttu-id="d1ecf-176">Si le contrôle de possession provient d’un <xref:System.Windows.Controls.Primitives.RangeBase>type spécifique de contrôle tel que , le pair peut être dérivé d’une classe équivalente de pairs dérivés.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-176">If the owning control derives from a specific type of control such as <xref:System.Windows.Controls.Primitives.RangeBase>, the peer can be derived from an equivalent derived peer class.</span></span> <span data-ttu-id="d1ecf-177">Dans ce cas, le <xref:System.Windows.Automation.Peers.RangeBaseAutomationPeer>pair dériverait de <xref:System.Windows.Automation.Provider.IRangeValueProvider>, qui fournit une mise en œuvre de base de .</span><span class="sxs-lookup"><span data-stu-id="d1ecf-177">In this case, the peer would derive from <xref:System.Windows.Automation.Peers.RangeBaseAutomationPeer>, which supplies a base implementation of <xref:System.Windows.Automation.Provider.IRangeValueProvider>.</span></span> <span data-ttu-id="d1ecf-178">Le code suivant illustre la déclaration de ce type d’homologue.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-178">The following code shows the declaration of such a peer.</span></span>  
  
```csharp  
public class RangePeer2 : RangeBaseAutomationPeer { }  
```  
  
```vb  
Public Class RangePeer2  
    Inherits RangeBaseAutomationPeer  
End Class  
```  
  
<span data-ttu-id="d1ecf-179">Par exemple, consultez le code source [C ou](https://github.com/dotnet/samples/tree/master/snippets/csharp/VS_Snippets_Wpf/CustomControlNumericUpDown/CSharp) [Visual Basic](https://github.com/dotnet/samples/tree/master/snippets/visualbasic/VS_Snippets_Wpf/CustomControlNumericUpDown/visualbasic) qui implémente et consomme un contrôle personnalisé NumericUpDown.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-179">For an example implementation, see the [C#](https://github.com/dotnet/samples/tree/master/snippets/csharp/VS_Snippets_Wpf/CustomControlNumericUpDown/CSharp) or [Visual Basic](https://github.com/dotnet/samples/tree/master/snippets/visualbasic/VS_Snippets_Wpf/CustomControlNumericUpDown/visualbasic) source code that implements and consumes a NumericUpDown custom control.</span></span>  
  
### <a name="raise-events"></a><span data-ttu-id="d1ecf-180">Déclencher des événements</span><span class="sxs-lookup"><span data-stu-id="d1ecf-180">Raise Events</span></span>  
 <span data-ttu-id="d1ecf-181">Les clients Automation peuvent s’abonner à des événements Automation.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-181">Automation clients can subscribe to automation events.</span></span> <span data-ttu-id="d1ecf-182">Les contrôles personnalisés doivent signaler <xref:System.Windows.Automation.Peers.AutomationPeer.RaiseAutomationEvent%2A> les modifications apportées à l’état de contrôle en appelant la méthode.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-182">Custom controls must report changes to control state by calling the <xref:System.Windows.Automation.Peers.AutomationPeer.RaiseAutomationEvent%2A> method.</span></span> <span data-ttu-id="d1ecf-183">De même, lorsqu’une valeur <xref:System.Windows.Automation.Peers.AutomationPeer.RaisePropertyChangedEvent%2A> de propriété change, appelez la méthode.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-183">Similarly, when a property value changes, call the <xref:System.Windows.Automation.Peers.AutomationPeer.RaisePropertyChangedEvent%2A> method.</span></span> <span data-ttu-id="d1ecf-184">Le code suivant montre comment obtenir l’objet homologue à partir du code de contrôle et appeler une méthode pour déclencher un événement.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-184">The following code shows how to get the peer object from within the control code and call a method to raise an event.</span></span> <span data-ttu-id="d1ecf-185">À des fins d’optimisation, le code détermine s’il existe des écouteurs pour ce type d’événement.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-185">As an optimization, the code determines if there are any listeners for this event type.</span></span> <span data-ttu-id="d1ecf-186">Déclencher l’événement uniquement lorsqu’il y a des écouteurs évite les surcharges inutiles et permet au contrôle de rester réactif.</span><span class="sxs-lookup"><span data-stu-id="d1ecf-186">Raising the event only when there are listeners avoids unnecessary overhead and helps the control remain responsive.</span></span>  
  
 [!code-csharp[CustomControlNumericUpDown#RaiseEventFromControl](~/samples/snippets/csharp/VS_Snippets_Wpf/CustomControlNumericUpDown/CSharp/CustomControlLibrary/NumericUpDown.cs#raiseeventfromcontrol)]
 [!code-vb[CustomControlNumericUpDown#RaiseEventFromControl](~/samples/snippets/visualbasic/VS_Snippets_Wpf/CustomControlNumericUpDown/visualbasic/customcontrollibrary/numericupdown.vb#raiseeventfromcontrol)]  
  
## <a name="see-also"></a><span data-ttu-id="d1ecf-187">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="d1ecf-187">See also</span></span>

- [<span data-ttu-id="d1ecf-188">Vue d'ensemble d'UI Automation</span><span class="sxs-lookup"><span data-stu-id="d1ecf-188">UI Automation Overview</span></span>](../../ui-automation/ui-automation-overview.md)
- [<span data-ttu-id="d1ecf-189">Implémentation de fournisseur UI Automation côté serveur</span><span class="sxs-lookup"><span data-stu-id="d1ecf-189">Server-Side UI Automation Provider Implementation</span></span>](../../ui-automation/server-side-ui-automation-provider-implementation.md)
- [<span data-ttu-id="d1ecf-190">Contrôle personnalisé NumericUpDown sur GitHub</span><span class="sxs-lookup"><span data-stu-id="d1ecf-190">NumericUpDown custom control (C#) on GitHub</span></span>](https://github.com/dotnet/samples/tree/master/snippets/csharp/VS_Snippets_Wpf/CustomControlNumericUpDown/CSharp)  
- [<span data-ttu-id="d1ecf-191">Contrôle personnalisé NumericUpDown (Visual Basic) sur GitHub</span><span class="sxs-lookup"><span data-stu-id="d1ecf-191">NumericUpDown custom control (Visual Basic) on GitHub</span></span>](https://github.com/dotnet/samples/tree/master/snippets/visualbasic/VS_Snippets_Wpf/CustomControlNumericUpDown/visualbasic)

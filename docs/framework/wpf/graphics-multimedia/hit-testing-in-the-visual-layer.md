---
title: Test de positionnement dans la couche visuelle
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- hit testing functionality [WPF]
- visual layer [WPF], hit testing functionality
ms.assetid: b1a64b61-14be-4d75-b89a-5c67bebb2c7b
ms.openlocfilehash: 92b7e8ffab001af4dba6c571fd06c64f2865b1e3
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/22/2019
ms.locfileid: "69962117"
---
# <a name="hit-testing-in-the-visual-layer"></a><span data-ttu-id="705c0-102">Test de positionnement dans la couche visuelle</span><span class="sxs-lookup"><span data-stu-id="705c0-102">Hit Testing in the Visual Layer</span></span>
<span data-ttu-id="705c0-103">Cette rubrique fournit une vue d’ensemble de la fonctionnalité de test de positionnement fournie par la couche visuelle.</span><span class="sxs-lookup"><span data-stu-id="705c0-103">This topic provides an overview of hit testing functionality provided by the visual layer.</span></span> <span data-ttu-id="705c0-104">La prise en charge du test de positionnement vous permet de déterminer si une géométrie ou une valeur de point <xref:System.Windows.Media.Visual>se trouve dans le contenu rendu d’un, ce qui vous permet d’implémenter le comportement de l’interface utilisateur, par exemple un rectangle de sélection pour sélectionner plusieurs objets.</span><span class="sxs-lookup"><span data-stu-id="705c0-104">Hit testing support allows you to determine whether a geometry or point value falls within the rendered content of a <xref:System.Windows.Media.Visual>, allowing you to implement user interface behavior such as a selection rectangle to select multiple objects.</span></span>  

<a name="hit_testing_scenarios"></a>   
## <a name="hit-testing-scenarios"></a><span data-ttu-id="705c0-105">Scénarios de test de positionnement</span><span class="sxs-lookup"><span data-stu-id="705c0-105">Hit Testing Scenarios</span></span>  
 <span data-ttu-id="705c0-106">La <xref:System.Windows.UIElement> classe fournit la <xref:System.Windows.UIElement.InputHitTest%2A> méthode, qui vous permet d’effectuer un test de positionnement sur un élément à l’aide d’une valeur de coordonnée donnée.</span><span class="sxs-lookup"><span data-stu-id="705c0-106">The <xref:System.Windows.UIElement> class provides the <xref:System.Windows.UIElement.InputHitTest%2A> method, which allows you to hit test against an element using a given coordinate value.</span></span> <span data-ttu-id="705c0-107">Dans de nombreux cas, <xref:System.Windows.UIElement.InputHitTest%2A> la méthode fournit les fonctionnalités souhaitées pour l’implémentation du test de positionnement des éléments.</span><span class="sxs-lookup"><span data-stu-id="705c0-107">In many cases, the <xref:System.Windows.UIElement.InputHitTest%2A> method provides the desired functionality for implementing hit testing of elements.</span></span> <span data-ttu-id="705c0-108">Toutefois, il existe plusieurs scénarios dans lesquels vous devrez peut-être implémenter le test de positionnement sur la couche visuelle.</span><span class="sxs-lookup"><span data-stu-id="705c0-108">However, there are several scenarios in which you may need to implement hit testing at the visual layer.</span></span>  
  
- <span data-ttu-id="705c0-109">Tests de positionnement sur des<xref:System.Windows.UIElement> objets non-: Cela s’applique si vous effectuez un test de<xref:System.Windows.UIElement> positionnement de non- <xref:System.Windows.Media.DrawingVisual> objets, tels que des objets graphiques ou.</span><span class="sxs-lookup"><span data-stu-id="705c0-109">Hit testing against non-<xref:System.Windows.UIElement> objects: This applies if you are hit testing non-<xref:System.Windows.UIElement> objects, such as <xref:System.Windows.Media.DrawingVisual> or graphics objects.</span></span>  
  
- <span data-ttu-id="705c0-110">Test de positionnement à l’aide d’une géométrie: Cela s’applique si vous devez effectuer un test de positionnement à l’aide d’un objet Geometry plutôt que de la valeur de coordonnée d’un point.</span><span class="sxs-lookup"><span data-stu-id="705c0-110">Hit testing using a geometry: This applies if you need to hit test using a geometry object rather than the coordinate value of a point.</span></span>  
  
- <span data-ttu-id="705c0-111">Tests de positionnement sur plusieurs objets: Cela s’applique lorsque vous devez effectuer un test de positionnement sur plusieurs objets, tels que des objets qui se chevauchent.</span><span class="sxs-lookup"><span data-stu-id="705c0-111">Hit testing against multiple objects: This applies when you need to hit test against multiple objects, such as overlapping objects.</span></span> <span data-ttu-id="705c0-112">Vous pouvez obtenir des résultats pour tous les objets visuels croisant une géométrie ou un point, pas seulement le premier.</span><span class="sxs-lookup"><span data-stu-id="705c0-112">You can get results for all visuals intersecting a geometry or point, not just the first one.</span></span>  
  
- <span data-ttu-id="705c0-113">Stratégie de test de positionnementignorée:<xref:System.Windows.UIElement> Cela s’applique lorsque vous devez ignorer la <xref:System.Windows.UIElement> stratégie de test de positionnement, qui prend en considération des facteurs tels que le fait qu’un élément soit désactivé ou invisible.</span><span class="sxs-lookup"><span data-stu-id="705c0-113">Ignoring <xref:System.Windows.UIElement> hit testing policy: This applies when you need to ignore the <xref:System.Windows.UIElement> hit testing policy, which takes into consideration such factors as whether an element is disabled or invisible.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="705c0-114">Pour un exemple de code complet illustrant le test de positionnement sur la couche visuelle, consultez [Test de positionnement à l’aide de l’exemple DrawingVisuals](https://go.microsoft.com/fwlink/?LinkID=159994) et [Test de positionnement avec l’exemple Interopérabilité Win32](https://go.microsoft.com/fwlink/?LinkID=159995).</span><span class="sxs-lookup"><span data-stu-id="705c0-114">For a complete code sample illustrating hit testing at the visual layer, see [Hit Test Using DrawingVisuals Sample](https://go.microsoft.com/fwlink/?LinkID=159994) and [Hit Test with Win32 Interoperation Sample](https://go.microsoft.com/fwlink/?LinkID=159995).</span></span>  
  
<a name="hit_testing_support"></a>   
## <a name="hit-testing-support"></a><span data-ttu-id="705c0-115">Prise en charge du test de positionnement</span><span class="sxs-lookup"><span data-stu-id="705c0-115">Hit Testing Support</span></span>  
 <span data-ttu-id="705c0-116">L’objectif des <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> méthodes dans la <xref:System.Windows.Media.VisualTreeHelper> classe est de déterminer si une géométrie ou une valeur de coordonnée de point se trouve dans le contenu rendu d’un objet donné, tel qu’un contrôle ou un élément graphique.</span><span class="sxs-lookup"><span data-stu-id="705c0-116">The purpose of the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> methods in the <xref:System.Windows.Media.VisualTreeHelper> class is to determine whether a geometry or point coordinate value is within the rendered content of a given object, such as a control or graphic element.</span></span> <span data-ttu-id="705c0-117">Par exemple, vous pouvez utiliser le test de positionnement pour déterminer si un clic de souris dans le rectangle englobant d’un objet se trouve dans la géométrie d’un cercle.</span><span class="sxs-lookup"><span data-stu-id="705c0-117">For example, you could use hit testing to determine whether a mouse click within the bounding rectangle of an object falls within the geometry of a circle.</span></span> <span data-ttu-id="705c0-118">Vous pouvez également choisir de substituer l’implémentation par défaut du test de positionnement pour effectuer vos propres calculs de test de positionnement personnalisés.</span><span class="sxs-lookup"><span data-stu-id="705c0-118">You can also choose to override the default implementation of hit testing to perform your own custom hit test calculations.</span></span>  
  
 <span data-ttu-id="705c0-119">L’illustration suivante montre la relation entre la région d’un objet non rectangulaire et son rectangle englobant.</span><span class="sxs-lookup"><span data-stu-id="705c0-119">The following illustration shows the relationship between a non-rectangular object's region and its bounding rectangle.</span></span>  
  
 <span data-ttu-id="705c0-120">![Diagramme d’une région de test de positionnement valide](./media/wcpsdk-mmgraphics-visuals-hittest-1.png "wcpsdk_mmgraphics_visuals_hittest_1")</span><span class="sxs-lookup"><span data-stu-id="705c0-120">![Diagram of valid hit test region](./media/wcpsdk-mmgraphics-visuals-hittest-1.png "wcpsdk_mmgraphics_visuals_hittest_1")</span></span>  
<span data-ttu-id="705c0-121">Diagramme de la région de test de positionnement valide</span><span class="sxs-lookup"><span data-stu-id="705c0-121">Diagram of valid hit test region</span></span>  
  
<a name="hit_testing_and_z-order"></a>   
## <a name="hit-testing-and-z-order"></a><span data-ttu-id="705c0-122">Test de positionnement et ordre de plan</span><span class="sxs-lookup"><span data-stu-id="705c0-122">Hit Testing and Z-Order</span></span>  
 <span data-ttu-id="705c0-123">La couche visuelle [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] prend en charge le test de positionnement sur tous les objets sous un point ou une géométrie, pas seulement l’objet de niveau supérieur.</span><span class="sxs-lookup"><span data-stu-id="705c0-123">The [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] visual layer supports hit testing against all objects under a point or geometry, not just the top-most object.</span></span> <span data-ttu-id="705c0-124">Les résultats sont retournés dans l’ordre de plan.</span><span class="sxs-lookup"><span data-stu-id="705c0-124">Results are returned in z-order.</span></span> <span data-ttu-id="705c0-125">Toutefois, l’objet visuel que vous transmettez comme paramètre à la <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> méthode détermine la partie de l’arborescence d’éléments visuels qui fera l’objet d’un test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-125">However, the visual object that you pass as the parameter to the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method determines which portion of the visual tree that will be hit test.</span></span> <span data-ttu-id="705c0-126">Vous pouvez effectuer un test de positionnement sur l’arborescence visuelle entière ou une portion de celle-ci.</span><span class="sxs-lookup"><span data-stu-id="705c0-126">You can hit test against the entire visual tree, or any portion of it.</span></span>  
  
 <span data-ttu-id="705c0-127">Dans l’illustration suivante, l’objet cercle est au-dessus des objets carré et triangle.</span><span class="sxs-lookup"><span data-stu-id="705c0-127">In the following illustration, the circle object is on top of both the square and triangle objects.</span></span> <span data-ttu-id="705c0-128">Si vous êtes uniquement intéressé par le test de positionnement de l’objet visuel dont la valeur de l’ordre de plan est la plus haute, vous pouvez définir l' <xref:System.Windows.Media.HitTestResultBehavior.Stop> énumération <xref:System.Windows.Media.HitTestResultCallback> du test de positionnement visuel à retourner de pour arrêter le parcours du test de positionnement après le premier élément.</span><span class="sxs-lookup"><span data-stu-id="705c0-128">If you are only interested in hit testing the visual object whose z-order value is top-most, you can set the visual hit test enumeration to return <xref:System.Windows.Media.HitTestResultBehavior.Stop> from the <xref:System.Windows.Media.HitTestResultCallback> to stop the hit test traversal after the first item.</span></span>  
  
 <span data-ttu-id="705c0-129">![Diagramme de l’ordre&#45;de plan d’une arborescence d’éléments visuels](./media/wcpsdk-mmgraphics-visuals-hittest-2.png "wcpsdk_mmgraphics_visuals_hittest_2")</span><span class="sxs-lookup"><span data-stu-id="705c0-129">![Diagram of the z&#45;order of a visual tree](./media/wcpsdk-mmgraphics-visuals-hittest-2.png "wcpsdk_mmgraphics_visuals_hittest_2")</span></span>  
<span data-ttu-id="705c0-130">Diagramme de l’ordre de plan d’une arborescence d’éléments visuels</span><span class="sxs-lookup"><span data-stu-id="705c0-130">Diagram of the z-order of a visual tree</span></span>  
  
 <span data-ttu-id="705c0-131">Si vous souhaitez énumérer tous les objets visuels sous un point ou une géométrie spécifique, <xref:System.Windows.Media.HitTestResultBehavior.Continue> retournez <xref:System.Windows.Media.HitTestResultCallback>à partir de.</span><span class="sxs-lookup"><span data-stu-id="705c0-131">If you want to enumerate all visual objects under a specific point or geometry, return <xref:System.Windows.Media.HitTestResultBehavior.Continue> from the <xref:System.Windows.Media.HitTestResultCallback>.</span></span> <span data-ttu-id="705c0-132">Cela signifie que vous pouvez effectuer un test de positionnement pour des objets visuels situés sous d’autres objets, même s’ils sont complètement masqués.</span><span class="sxs-lookup"><span data-stu-id="705c0-132">This means you can hit test for visual objects that are beneath other objects, even if they are wholly obscured.</span></span> <span data-ttu-id="705c0-133">Pour plus d’informations, consultez l’exemple de code dans la section « Utilisation du rappel des résultats d’un test de positionnement ».</span><span class="sxs-lookup"><span data-stu-id="705c0-133">See the sample code in the section "Using a Hit Test Results Callback" for more information.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="705c0-134">Un objet visuel transparent peut également être l’objet d’un test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-134">A visual object that is transparent can also be hit test.</span></span>  
  
<a name="using_default_hit_testing"></a>   
## <a name="using-default-hit-testing"></a><span data-ttu-id="705c0-135">Utilisation du test de positionnement par défaut</span><span class="sxs-lookup"><span data-stu-id="705c0-135">Using Default Hit Testing</span></span>  
 <span data-ttu-id="705c0-136">Vous pouvez déterminer si un point se trouve dans la géométrie d’un objet visuel, en utilisant <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> la méthode pour spécifier un objet visuel et une valeur de coordonnée de point à tester.</span><span class="sxs-lookup"><span data-stu-id="705c0-136">You can identify whether a point is within the geometry of a visual object, by using the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method to specify a visual object and a point coordinate value to test against.</span></span> <span data-ttu-id="705c0-137">Le paramètre de l’objet visuel identifie le point de départ dans l’arborescence visuelle pour la recherche du test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-137">The visual object parameter identifies the starting point in the visual tree for the hit test search.</span></span> <span data-ttu-id="705c0-138">Si un objet visuel est trouvé dans l’arborescence d’éléments visuels dont la géométrie contient la coordonnée, <xref:System.Windows.Media.HitTestResult.VisualHit%2A> il est défini <xref:System.Windows.Media.HitTestResult> sur la propriété d’un objet.</span><span class="sxs-lookup"><span data-stu-id="705c0-138">If a visual object is found in the visual tree whose geometry contains the coordinate, it is set to the <xref:System.Windows.Media.HitTestResult.VisualHit%2A> property of a <xref:System.Windows.Media.HitTestResult> object.</span></span> <span data-ttu-id="705c0-139">Est ensuite retourné à partir de <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> la méthode. <xref:System.Windows.Media.HitTestResult></span><span class="sxs-lookup"><span data-stu-id="705c0-139">The <xref:System.Windows.Media.HitTestResult> is then returned from the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span> <span data-ttu-id="705c0-140">Si le point n’est pas contenu dans la sous-arborescence visuelle sur laquelle vous effectuez <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> un `null`test de positionnement, retourne.</span><span class="sxs-lookup"><span data-stu-id="705c0-140">If the point is not contained with the visual sub-tree you are hit testing, <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> returns `null`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="705c0-141">Le test de positionnement par défaut retourne toujours l’objet de plus haut niveau dans l’ordre de plan.</span><span class="sxs-lookup"><span data-stu-id="705c0-141">Default hit testing always returns the top-most object in the z-order.</span></span> <span data-ttu-id="705c0-142">Afin d’identifier tous les objets visuels, y compris ceux partiellement ou entièrement cachés, utilisez un rappel des résultats du test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-142">In order to identify all visual objects, even those that may be partly or wholly obscured, use a hit test result callback.</span></span>  
  
 <span data-ttu-id="705c0-143">La valeur de coordonnée que vous transmettez comme <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> paramètre de point pour la méthode doit être relative à l’espace de coordonnées de l’objet visuel sur lequel vous effectuez le test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-143">The coordinate value you pass as the point parameter for the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method has to be relative to the coordinate space of the visual object you are hit testing against.</span></span> <span data-ttu-id="705c0-144">Par exemple, si vous avez imbriqué des objets visuels définis sur (100, 100) dans l’espace des coordonnées du parent, alors le test de positionnement sur un objet visuel enfant à (0, 0) est équivalent au test de positionnement sur (100, 100) dans l’espace des coordonnées du parent.</span><span class="sxs-lookup"><span data-stu-id="705c0-144">For example, if you have nested visual objects defined at (100, 100) in the parent's coordinate space, then hit testing a child visual at (0, 0) is equivalent to hit testing at (100, 100) in the parent's coordinate space.</span></span>  
  
 <span data-ttu-id="705c0-145">Le code suivant montre comment configurer des gestionnaires d’événements de souris pour un <xref:System.Windows.UIElement> objet utilisé pour capturer des événements utilisés pour le test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-145">The following code shows how to set up mouse event handlers for a <xref:System.Windows.UIElement> object that is used to capture events used for hit testing.</span></span>  
  
 [!code-csharp[HitTestingOverview#100](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#100)]
 [!code-vb[HitTestingOverview#100](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#100)]  
  
### <a name="how-the-visual-tree-affects-hit-testing"></a><span data-ttu-id="705c0-146">Impact de l’arborescence visuelle sur le test de positionnement</span><span class="sxs-lookup"><span data-stu-id="705c0-146">How the Visual Tree Affects Hit Testing</span></span>  
 <span data-ttu-id="705c0-147">Le point de départ dans l’arborescence visuelle détermine quels objets sont retournés lors de l’énumération du test de positionnement des objets.</span><span class="sxs-lookup"><span data-stu-id="705c0-147">The starting point in the visual tree determines which objects are returned during the hit test enumeration of objects.</span></span> <span data-ttu-id="705c0-148">Si vous avez plusieurs objets sur lesquels vous voulez effectuer un test de positionnement, l’objet visuel utilisé comme point de départ de l’arborescence visuelle doit être l’ancêtre commun de tous les objets concernés.</span><span class="sxs-lookup"><span data-stu-id="705c0-148">If you have multiple objects you want to hit test, the visual object used as the starting point in the visual tree must be the common ancestor of all objects of interest.</span></span> <span data-ttu-id="705c0-149">Par exemple, si vous voulez effectuer un test de positionnement sur l’élément bouton et l’objet visuel de dessin dans le diagramme suivant, vous devez définir le point de départ dans l’arborescence visuelle sur l’ancêtre commun des deux.</span><span class="sxs-lookup"><span data-stu-id="705c0-149">For example, if you were interested in hit testing both the button element and drawing visual in the following diagram, you would have to set the starting point in the visual tree to the common ancestor of both.</span></span> <span data-ttu-id="705c0-150">Dans ce cas, l’élément canevas est l’ancêtre commun de l’élément bouton et de l’objet visuel de dessin.</span><span class="sxs-lookup"><span data-stu-id="705c0-150">In this case, the canvas element is the common ancestor of both the button element and the drawing visual.</span></span>  
  
 <span data-ttu-id="705c0-151">![Diagramme d’une hiérarchie d’arborescence d’éléments visuels](./media/wcpsdk-mmgraphics-visuals-overview-01.gif "wcpsdk_mmgraphics_visuals_overview_01")</span><span class="sxs-lookup"><span data-stu-id="705c0-151">![Diagram of a visual tree hierarchy](./media/wcpsdk-mmgraphics-visuals-overview-01.gif "wcpsdk_mmgraphics_visuals_overview_01")</span></span>  
<span data-ttu-id="705c0-152">Diagramme d’une hiérarchie d’arborescence d’éléments visuels</span><span class="sxs-lookup"><span data-stu-id="705c0-152">Diagram of a visual tree hierarchy</span></span>  
  
> [!NOTE]
> <span data-ttu-id="705c0-153">La <xref:System.Windows.UIElement.IsHitTestVisible%2A> propriété obtient ou définit une valeur qui déclare si un <xref:System.Windows.UIElement>objet dérivé de peut être retourné comme résultat d’un test de positionnement à partir d’une partie de son contenu rendu.</span><span class="sxs-lookup"><span data-stu-id="705c0-153">The <xref:System.Windows.UIElement.IsHitTestVisible%2A> property gets or sets a value that declares whether a <xref:System.Windows.UIElement>-derived object can possibly be returned as a hit test result from some portion of its rendered content.</span></span> <span data-ttu-id="705c0-154">Cela vous permet de modifier de manière sélective l’arborescence visuelle afin de déterminer les objets visuels impliqués dans un test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-154">This allows you to selectively alter the visual tree to determine which visual objects are involved in a hit test.</span></span>  
  
<a name="using_a_hit_test_result_callback"></a>   
## <a name="using-a-hit-test-result-callback"></a><span data-ttu-id="705c0-155">Utilisation d’un rappel des résultats du test de positionnement</span><span class="sxs-lookup"><span data-stu-id="705c0-155">Using a Hit Test Result Callback</span></span>  
 <span data-ttu-id="705c0-156">Vous pouvez énumérer tous les objets visuels dans une arborescence visuelle dont la géométrie contient une valeur des coordonnées spécifiée.</span><span class="sxs-lookup"><span data-stu-id="705c0-156">You can enumerate all visual objects in a visual tree whose geometry contains a specified coordinate value.</span></span> <span data-ttu-id="705c0-157">Cela vous permet d’identifier tous les objets visuels, y compris ceux partiellement ou entièrement cachés par d’autres objets visuels.</span><span class="sxs-lookup"><span data-stu-id="705c0-157">This allows you to identify all visual objects, even those that may be partly or wholly obscured by other visual objects.</span></span> <span data-ttu-id="705c0-158">Pour énumérer des objets visuels dans une arborescence d’éléments <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> visuels, utilisez la méthode avec une fonction de rappel de test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-158">To enumerate visual objects in a visual tree use the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method with a hit test callback function.</span></span> <span data-ttu-id="705c0-159">La fonction de rappel du test de positionnement est appelée par le système lorsque la valeur des coordonnées que vous spécifiez est contenue dans un objet visuel.</span><span class="sxs-lookup"><span data-stu-id="705c0-159">The hit test callback function is called by the system when the coordinate value you specify is contained in a visual object.</span></span>  
  
 <span data-ttu-id="705c0-160">Lors de l’énumération des résultats du test de positionnement, vous ne devez effectuer aucune opération susceptible de modifier l’arborescence visuelle.</span><span class="sxs-lookup"><span data-stu-id="705c0-160">During the hit test results enumeration, you should not perform any operation that modifies the visual tree.</span></span> <span data-ttu-id="705c0-161">L’ajout ou la suppression d’un objet dans l’arborescence visuelle pendant qu’il est parcouru peut entraîner un comportement imprévisible.</span><span class="sxs-lookup"><span data-stu-id="705c0-161">Adding or removing an object from the visual tree while it is being traversed can result in unpredictable behavior.</span></span> <span data-ttu-id="705c0-162">Vous pouvez modifier en toute sécurité l’arborescence d’éléments <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> visuels après le retour de la méthode.</span><span class="sxs-lookup"><span data-stu-id="705c0-162">You can safely modify the visual tree after the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method returns.</span></span> <span data-ttu-id="705c0-163">Vous pouvez fournir une structure de données, telle qu’un <xref:System.Collections.ArrayList>, pour stocker des valeurs pendant l’énumération des résultats des tests de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-163">You may want to provide a data structure, such as an <xref:System.Collections.ArrayList>, to store values during the hit test results enumeration.</span></span>  
  
 [!code-csharp[HitTestingOverview#101](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#101)]
 [!code-vb[HitTestingOverview#101](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#101)]  
  
 <span data-ttu-id="705c0-164">La méthode de rappel du test de positionnement définit les actions que vous effectuez lorsqu’un test de positionnement est identifié sur un objet visuel particulier dans l’arborescence visuelle.</span><span class="sxs-lookup"><span data-stu-id="705c0-164">The hit test callback method defines the actions you perform when a hit test is identified on a particular visual object in the visual tree.</span></span> <span data-ttu-id="705c0-165">Après avoir effectué les actions, vous retournez une <xref:System.Windows.Media.HitTestResultBehavior> valeur qui détermine s’il faut continuer l’énumération de tous les autres objets visuels.</span><span class="sxs-lookup"><span data-stu-id="705c0-165">After you perform the actions, you return a <xref:System.Windows.Media.HitTestResultBehavior> value that determines whether to continue the enumeration of any other visual objects or not.</span></span>  
  
 [!code-csharp[HitTestingOverview#102](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#102)]
 [!code-vb[HitTestingOverview#102](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#102)]  
  
> [!NOTE]
> <span data-ttu-id="705c0-166">L’ordre d’énumération des objets visuels de positionnement se fait selon l’ordre de plan.</span><span class="sxs-lookup"><span data-stu-id="705c0-166">The order of enumeration of hit visual objects is by z-order.</span></span> <span data-ttu-id="705c0-167">L’objet visuel au niveau de l’ordre de plan le plus élevé est le premier objet énuméré.</span><span class="sxs-lookup"><span data-stu-id="705c0-167">The visual object at the top-most z-order level is the first object enumerated.</span></span> <span data-ttu-id="705c0-168">Les autres objets visuels énumérés le sont dans l’ordre de plan décroissant.</span><span class="sxs-lookup"><span data-stu-id="705c0-168">Any other visual objects enumerated are at decreasing z-order level.</span></span> <span data-ttu-id="705c0-169">Cet ordre d’énumération correspond à l’ordre de rendu des objets visuels.</span><span class="sxs-lookup"><span data-stu-id="705c0-169">This order of enumeration corresponds to the rendering order of the visuals.</span></span>  
  
 <span data-ttu-id="705c0-170">Vous pouvez arrêter l’énumération des objets visuels à tout moment dans la fonction de rappel du test <xref:System.Windows.Media.HitTestResultBehavior.Stop>de positionnement en retournant.</span><span class="sxs-lookup"><span data-stu-id="705c0-170">You can stop the enumeration of visual objects at any time in the hit test callback function by returning <xref:System.Windows.Media.HitTestResultBehavior.Stop>.</span></span>  
  
 [!code-csharp[HitTestingOverview#103](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#103)]
 [!code-vb[HitTestingOverview#103](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#103)]  
  
<a name="using_a_hit_test_filter_callback"></a>   
## <a name="using-a-hit-test-filter-callback"></a><span data-ttu-id="705c0-171">Utilisation d’un rappel de filtre du test de positionnement</span><span class="sxs-lookup"><span data-stu-id="705c0-171">Using a Hit Test Filter Callback</span></span>  
 <span data-ttu-id="705c0-172">Vous pouvez utiliser un filtre de test de positionnement facultatif pour restreindre les objets transmis aux résultats du test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-172">You can use an optional hit test filter to restrict the objects that are passed on to the hit test results.</span></span> <span data-ttu-id="705c0-173">Ceci vous permet d’ignorer les parties de l’arborescence d’éléments visuels que vous ne souhaitez pas traiter dans vos résultats de test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-173">This allows you to ignore parts of the visual tree that you are not interested in processing in your hit test results.</span></span> <span data-ttu-id="705c0-174">Pour implémenter un filtre de test de positionnement, vous devez définir une fonction de rappel de filtre de test de positionnement et la passer <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> en tant que valeur de paramètre lorsque vous appelez la méthode.</span><span class="sxs-lookup"><span data-stu-id="705c0-174">To implement a hit test filter, you define a hit test filter callback function and pass it as a parameter value when you call the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span>  
  
 [!code-csharp[HitTestingOverview#104](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#104)]
 [!code-vb[HitTestingOverview#104](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#104)]  
  
 <span data-ttu-id="705c0-175">Si vous ne souhaitez pas fournir la fonction de rappel de filtre de test de positionnement facultative `null` , transmettez une valeur en <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> tant que paramètre pour la méthode.</span><span class="sxs-lookup"><span data-stu-id="705c0-175">If you do not want to supply the optional hit test filter callback function, pass a `null` value as its parameter for the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span>  
  
 [!code-csharp[HitTestingOverview#105](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#105)]
 [!code-vb[HitTestingOverview#105](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#105)]  
  
 <span data-ttu-id="705c0-176">![Nettoyage d’une arborescence d’éléments visuels à l’aide d’un filtre de test de positionnement](./media/filteredvisualtree-01.png "FilteredVisualTree_01")</span><span class="sxs-lookup"><span data-stu-id="705c0-176">![Pruning a visual tree using a hit test filter](./media/filteredvisualtree-01.png "FilteredVisualTree_01")</span></span>  
<span data-ttu-id="705c0-177">Élagage d’une arborescence visuelle</span><span class="sxs-lookup"><span data-stu-id="705c0-177">Pruning a visual tree</span></span>  
  
 <span data-ttu-id="705c0-178">La fonction de rappel de filtre de test de positionnement permet d’énumérer tous les objets visuels dont le contenu rendu contient les coordonnées que vous spécifiez.</span><span class="sxs-lookup"><span data-stu-id="705c0-178">The hit test filter callback function allows you to enumerate through all the visuals whose rendered content contains the coordinates you specify.</span></span> <span data-ttu-id="705c0-179">Toutefois, vous pouvez ignorer certaines branches de l’arborescence d’éléments visuels que vous ne souhaitez pas traiter dans votre fonction de rappel des résultats de test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-179">However, you may want to ignore certain branches of the visual tree that you are not interested in processing in your hit test results callback function.</span></span> <span data-ttu-id="705c0-180">La valeur de retour de la fonction de rappel de filtre de test de positionnement détermine le type d’action que l’énumération des objets visuels doit prendre.</span><span class="sxs-lookup"><span data-stu-id="705c0-180">The return value of the hit test filter callback function determines what type of action the enumeration of the visual objects should take.</span></span> <span data-ttu-id="705c0-181">Par exemple, si vous retournez la valeur, <xref:System.Windows.Media.HitTestFilterBehavior.ContinueSkipSelfAndChildren>, vous pouvez supprimer l’objet visuel actuel et ses enfants de l’énumération des résultats du test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-181">For example, if you return the value, <xref:System.Windows.Media.HitTestFilterBehavior.ContinueSkipSelfAndChildren>, you can remove the current visual object and its children from the hit test results enumeration.</span></span> <span data-ttu-id="705c0-182">Cela signifie que la fonction de rappel des résultats de test de positionnement ne verra pas ces objets dans son énumération.</span><span class="sxs-lookup"><span data-stu-id="705c0-182">This means that the hit test results callback function will not see these objects in its enumeration.</span></span> <span data-ttu-id="705c0-183">L’élagage des objets dans l’arborescence visuelle diminue la quantité de traitement au cours de la passe de l’énumération des résultats de test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="705c0-183">Pruning the visual tree of objects decreases the amount of processing during the hit test results enumeration pass.</span></span> <span data-ttu-id="705c0-184">Dans l’exemple de code suivant, le filtre ignore les étiquettes et leurs descendants et effectue un test de positionnement sur tout le reste.</span><span class="sxs-lookup"><span data-stu-id="705c0-184">In the following code example, the filter skips labels and their descendants and hit tests everything else.</span></span>  
  
 [!code-csharp[HitTestingOverview#106](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#106)]
 [!code-vb[HitTestingOverview#106](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#106)]  
  
> [!NOTE]
> <span data-ttu-id="705c0-185">Le rappel de filtre du test de positionnement est parfois appelé dans les cas où le rappel des résultats du test d’atteinte n’est pas appelé.</span><span class="sxs-lookup"><span data-stu-id="705c0-185">The hit test filter callback will sometimes be called in cases where the hit test results callback is not called.</span></span>  
  
<a name="overriding_default_hit_testing"></a>   
## <a name="overriding-default-hit-testing"></a><span data-ttu-id="705c0-186">Substitution du test de positionnement par défaut</span><span class="sxs-lookup"><span data-stu-id="705c0-186">Overriding Default Hit Testing</span></span>  
 <span data-ttu-id="705c0-187">Vous pouvez substituer la prise en charge du test de positionnement par défaut d’un <xref:System.Windows.Media.Visual.HitTestCore%2A> objet visuel en substituant la méthode.</span><span class="sxs-lookup"><span data-stu-id="705c0-187">You can override a visual object’s default hit testing support by overriding the <xref:System.Windows.Media.Visual.HitTestCore%2A> method.</span></span> <span data-ttu-id="705c0-188">Cela signifie que lorsque vous appelez la <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> méthode, votre implémentation substituée de <xref:System.Windows.Media.Visual.HitTestCore%2A> est appelée.</span><span class="sxs-lookup"><span data-stu-id="705c0-188">This means that when you invoke the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method, your overridden implementation of <xref:System.Windows.Media.Visual.HitTestCore%2A> is called.</span></span> <span data-ttu-id="705c0-189">Votre méthode substituée est appelée lorsqu’un test de positionnement se situe dans le rectangle englobant de l’objet visuel, même si les coordonnées se situent en dehors du contenu rendu de l’objet visuel.</span><span class="sxs-lookup"><span data-stu-id="705c0-189">Your overridden method is called when a hit test falls within the bounding rectangle of the visual object, even if the coordinate falls outside the rendered content of the visual object.</span></span>  
  
 [!code-csharp[HitTestingOverview#107](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#107)]
 [!code-vb[HitTestingOverview#107](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#107)]  
  
 <span data-ttu-id="705c0-190">Vous voudrez parfois effectuer un nouveau test de positionnement sur le rectangle englobant et le contenu rendu d’un objet visuel.</span><span class="sxs-lookup"><span data-stu-id="705c0-190">There may be times when you want to hit test against both the bounding rectangle and the rendered content of a visual object.</span></span> <span data-ttu-id="705c0-191">En utilisant la `PointHitTestParameters` valeur de paramètre dans votre méthode <xref:System.Windows.Media.Visual.HitTestCore%2A> substituée comme paramètre de la méthode <xref:System.Windows.Media.Visual.HitTestCore%2A>de base, vous pouvez effectuer des actions en fonction d’un accès au rectangle englobant d’un objet visuel, puis effectuer un deuxième test de positionnement sur le contenu rendu de l’objet visuel.</span><span class="sxs-lookup"><span data-stu-id="705c0-191">By using the `PointHitTestParameters` parameter value in your overridden <xref:System.Windows.Media.Visual.HitTestCore%2A> method as the parameter to the base method <xref:System.Windows.Media.Visual.HitTestCore%2A>, you can perform actions based on a hit of the bounding rectangle of a visual object, and then perform a second hit test against the rendered content of the visual object.</span></span>  
  
 [!code-csharp[HitTestingOverview#108](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#108)]
 [!code-vb[HitTestingOverview#108](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#108)]  
  
## <a name="see-also"></a><span data-ttu-id="705c0-192">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="705c0-192">See also</span></span>

- <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>
- <xref:System.Windows.Media.HitTestResult>
- <xref:System.Windows.Media.HitTestResultCallback>
- <xref:System.Windows.Media.HitTestFilterCallback>
- <xref:System.Windows.UIElement.IsHitTestVisible%2A>
- [<span data-ttu-id="705c0-193">Test de positionnement à l’aide de DrawingVisuals, exemple</span><span class="sxs-lookup"><span data-stu-id="705c0-193">Hit Test Using DrawingVisuals Sample</span></span>](https://go.microsoft.com/fwlink/?LinkID=159994)
- [<span data-ttu-id="705c0-194">Exemple d’interopérabilité de test de positionnement avec Win32</span><span class="sxs-lookup"><span data-stu-id="705c0-194">Hit Test with Win32 Interoperation Sample</span></span>](https://go.microsoft.com/fwlink/?LinkID=159995)
- [<span data-ttu-id="705c0-195">Effectuer un test de positionnement avec Geometry dans un Visual</span><span class="sxs-lookup"><span data-stu-id="705c0-195">Hit Test Geometry in a Visual</span></span>](how-to-hit-test-geometry-in-a-visual.md)
- [<span data-ttu-id="705c0-196">Test de positionnement à l’aide d’un conteneur hôte Win32</span><span class="sxs-lookup"><span data-stu-id="705c0-196">Hit Test Using a Win32 Host Container</span></span>](how-to-hit-test-using-a-win32-host-container.md)

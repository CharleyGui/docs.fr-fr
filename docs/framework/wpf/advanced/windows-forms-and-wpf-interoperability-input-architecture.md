---
title: Architecture d’entrée Windows Forms et WPF Interop
titleSuffix: ''
ms.date: 03/30/2017
helpviewer_keywords:
- input architecture [WPF interoperability]
- messages [WPF]
- Windows Forms [WPF], interoperability with
- Windows Forms [WPF], WPF interoperation
- interoperability [WPF], Windows Forms
- modeless forms [WPF]
- ElementHost keyboard and messages [WPF]
- keyboard interoperation [WPF]
- WindowsFormsHost keyboard and messages [WPF]
- modeless dialog boxes [WPF]
ms.assetid: 0eb6f137-f088-4c5e-9e37-f96afd28f235
ms.openlocfilehash: f79971ba13691ccc36420e39696b7b8a46e5ce0e
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/24/2020
ms.locfileid: "76745051"
---
# <a name="windows-forms-and-wpf-interoperability-input-architecture"></a><span data-ttu-id="4d8a2-102">Architecture d'entrée pour l'interopérabilité entre Windows Forms et WPF</span><span class="sxs-lookup"><span data-stu-id="4d8a2-102">Windows Forms and WPF Interoperability Input Architecture</span></span>
<span data-ttu-id="4d8a2-103">L’interopérabilité entre les [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] et [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] requiert que les deux technologies aient le traitement d’entrée de clavier approprié.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-103">Interoperation between the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] requires that both technologies have the appropriate keyboard input processing.</span></span> <span data-ttu-id="4d8a2-104">Cette rubrique décrit comment ces technologies implémentent le traitement du clavier et des messages pour permettre une interopérabilité fluide dans des applications hybrides.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-104">This topic describes how these technologies implement keyboard and message processing to enable smooth interoperation in hybrid applications.</span></span>  
  
 <span data-ttu-id="4d8a2-105">Cette rubrique contient les sous-sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="4d8a2-105">This topic contains the following subsections:</span></span>  
  
- <span data-ttu-id="4d8a2-106">Formulaires et boîtes de dialogue non modals</span><span class="sxs-lookup"><span data-stu-id="4d8a2-106">Modeless Forms and Dialog Boxes</span></span>  
  
- <span data-ttu-id="4d8a2-107">Clavier WindowsFormsHost et traitement des messages</span><span class="sxs-lookup"><span data-stu-id="4d8a2-107">WindowsFormsHost Keyboard and Message Processing</span></span>  
  
- <span data-ttu-id="4d8a2-108">Clavier ElementHost et traitement des messages</span><span class="sxs-lookup"><span data-stu-id="4d8a2-108">ElementHost Keyboard and Message Processing</span></span>  
  
## <a name="modeless-forms-and-dialog-boxes"></a><span data-ttu-id="4d8a2-109">Formulaires et boîtes de dialogue non modals</span><span class="sxs-lookup"><span data-stu-id="4d8a2-109">Modeless Forms and Dialog Boxes</span></span>  
 <span data-ttu-id="4d8a2-110">Appelez la méthode <xref:System.Windows.Forms.Integration.WindowsFormsHost.EnableWindowsFormsInterop%2A> sur l’élément <xref:System.Windows.Forms.Integration.WindowsFormsHost> pour ouvrir un formulaire ou une boîte de dialogue non modale à partir d’une application basée sur [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d8a2-110">Call the <xref:System.Windows.Forms.Integration.WindowsFormsHost.EnableWindowsFormsInterop%2A> method on the <xref:System.Windows.Forms.Integration.WindowsFormsHost> element to open a modeless form or dialog box from a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]-based application.</span></span>  
  
 <span data-ttu-id="4d8a2-111">Appelez la méthode <xref:System.Windows.Forms.Integration.ElementHost.EnableModelessKeyboardInterop%2A> sur le contrôle <xref:System.Windows.Forms.Integration.ElementHost> pour ouvrir une page [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] non modale dans une application basée sur des [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d8a2-111">Call the <xref:System.Windows.Forms.Integration.ElementHost.EnableModelessKeyboardInterop%2A> method on the <xref:System.Windows.Forms.Integration.ElementHost> control to open a modeless [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] page in a [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)]-based application.</span></span>  
  
## <a name="windowsformshost-keyboard-and-message-processing"></a><span data-ttu-id="4d8a2-112">Clavier WindowsFormsHost et traitement des messages</span><span class="sxs-lookup"><span data-stu-id="4d8a2-112">WindowsFormsHost Keyboard and Message Processing</span></span>  
 <span data-ttu-id="4d8a2-113">Lorsqu’elle est hébergée par une application basée sur [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] le traitement du clavier et des messages se compose des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="4d8a2-113">When hosted by a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]-based application, [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] keyboard and message processing consists of the following:</span></span>  
  
- <span data-ttu-id="4d8a2-114">La classe <xref:System.Windows.Forms.Integration.WindowsFormsHost> acquiert des messages à partir de la boucle de message [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], qui est implémentée par la classe <xref:System.Windows.Interop.ComponentDispatcher>.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-114">The <xref:System.Windows.Forms.Integration.WindowsFormsHost> class acquires messages from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] message loop, which is implemented by the <xref:System.Windows.Interop.ComponentDispatcher> class.</span></span>  
  
- <span data-ttu-id="4d8a2-115">La classe <xref:System.Windows.Forms.Integration.WindowsFormsHost> crée une boucle de messages [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] de substitution pour s’assurer que le traitement du clavier de [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] ordinaire se produit.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-115">The <xref:System.Windows.Forms.Integration.WindowsFormsHost> class creates a surrogate [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] message loop to ensure that ordinary [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] keyboard processing occurs.</span></span>  
  
- <span data-ttu-id="4d8a2-116">La classe <xref:System.Windows.Forms.Integration.WindowsFormsHost> implémente l’interface <xref:System.Windows.Interop.IKeyboardInputSink> pour coordonner la gestion du focus avec [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d8a2-116">The <xref:System.Windows.Forms.Integration.WindowsFormsHost> class implements the <xref:System.Windows.Interop.IKeyboardInputSink> interface to coordinate focus management with [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span></span>  
  
- <span data-ttu-id="4d8a2-117">Les contrôles <xref:System.Windows.Forms.Integration.WindowsFormsHost> s’inscrivent et démarrent leurs boucles de messages.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-117">The <xref:System.Windows.Forms.Integration.WindowsFormsHost> controls register themselves and start their message loops.</span></span>  
  
 <span data-ttu-id="4d8a2-118">Les sections suivantes décrivent ces parties du processus plus en détail.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-118">The following sections describe these parts of the process in more detail.</span></span>  
  
### <a name="acquiring-messages-from-the-wpf-message-loop"></a><span data-ttu-id="4d8a2-119">Acquisition de messages à partir de la boucle de message WPF</span><span class="sxs-lookup"><span data-stu-id="4d8a2-119">Acquiring Messages from the WPF Message Loop</span></span>  
 <span data-ttu-id="4d8a2-120">La classe <xref:System.Windows.Interop.ComponentDispatcher> implémente le gestionnaire de boucles de messages pour [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d8a2-120">The <xref:System.Windows.Interop.ComponentDispatcher> class implements the message loop manager for [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span></span> <span data-ttu-id="4d8a2-121">La classe <xref:System.Windows.Interop.ComponentDispatcher> fournit des hooks pour permettre aux clients externes de filtrer des messages avant que [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] les traite.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-121">The <xref:System.Windows.Interop.ComponentDispatcher> class provides hooks to enable external clients to filter messages before [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] processes them.</span></span>  
  
 <span data-ttu-id="4d8a2-122">L’implémentation de l’interopérabilité gère l’événement <xref:System.Windows.Interop.ComponentDispatcher.ThreadFilterMessage?displayProperty=nameWithType>, qui permet aux contrôles [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] de traiter les messages avant les contrôles [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d8a2-122">The interoperation implementation handles the <xref:System.Windows.Interop.ComponentDispatcher.ThreadFilterMessage?displayProperty=nameWithType> event, which enables [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] controls to process messages before [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] controls.</span></span>  
  
### <a name="surrogate-windows-forms-message-loop"></a><span data-ttu-id="4d8a2-123">Boucle de messages de Windows Forms de substitution</span><span class="sxs-lookup"><span data-stu-id="4d8a2-123">Surrogate Windows Forms Message Loop</span></span>  
 <span data-ttu-id="4d8a2-124">Par défaut, la classe <xref:System.Windows.Forms.Application?displayProperty=nameWithType> contient la boucle de messages principale pour les applications [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d8a2-124">By default, the <xref:System.Windows.Forms.Application?displayProperty=nameWithType> class contains the primary message loop for [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] applications.</span></span> <span data-ttu-id="4d8a2-125">Pendant l’interopérabilité, la boucle de message [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] ne traite pas les messages.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-125">During interoperation, the [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] message loop does not process messages.</span></span> <span data-ttu-id="4d8a2-126">Par conséquent, cette logique doit être reproduite.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-126">Therefore, this logic must be reproduced.</span></span> <span data-ttu-id="4d8a2-127">Le gestionnaire de l’événement <xref:System.Windows.Interop.ComponentDispatcher.ThreadFilterMessage?displayProperty=nameWithType> effectue les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="4d8a2-127">The handler for the <xref:System.Windows.Interop.ComponentDispatcher.ThreadFilterMessage?displayProperty=nameWithType> event performs the following steps:</span></span>  
  
1. <span data-ttu-id="4d8a2-128">Filtre le message à l’aide de l’interface <xref:System.Windows.Forms.IMessageFilter>.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-128">Filters the message using the <xref:System.Windows.Forms.IMessageFilter> interface.</span></span>  
  
2. <span data-ttu-id="4d8a2-129">Appelle la méthode <xref:System.Windows.Forms.Control.PreProcessMessage%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-129">Calls the <xref:System.Windows.Forms.Control.PreProcessMessage%2A?displayProperty=nameWithType> method.</span></span>  
  
3. <span data-ttu-id="4d8a2-130">Traduit et distribue le message, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-130">Translates and dispatches the message, if it is required.</span></span>  
  
4. <span data-ttu-id="4d8a2-131">Transmet le message au contrôle d’hébergement, si aucun autre contrôle ne traite le message.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-131">Passes the message to the hosting control, if no other controls process the message.</span></span>  
  
### <a name="ikeyboardinputsink-implementation"></a><span data-ttu-id="4d8a2-132">Implémentation de IKeyboardInputSink</span><span class="sxs-lookup"><span data-stu-id="4d8a2-132">IKeyboardInputSink Implementation</span></span>  
 <span data-ttu-id="4d8a2-133">La boucle de message de substitution gère la gestion du clavier.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-133">The surrogate message loop handles keyboard management.</span></span> <span data-ttu-id="4d8a2-134">Par conséquent, la méthode <xref:System.Windows.Interop.IKeyboardInputSink.TabInto%2A?displayProperty=nameWithType> est la seule <xref:System.Windows.Interop.IKeyboardInputSink> membre qui requiert une implémentation dans la classe <xref:System.Windows.Forms.Integration.WindowsFormsHost>.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-134">Therefore, the <xref:System.Windows.Interop.IKeyboardInputSink.TabInto%2A?displayProperty=nameWithType> method is the only <xref:System.Windows.Interop.IKeyboardInputSink> member that requires an implementation in the <xref:System.Windows.Forms.Integration.WindowsFormsHost> class.</span></span>  
  
 <span data-ttu-id="4d8a2-135">Par défaut, la classe <xref:System.Windows.Interop.HwndHost> retourne `false` pour son implémentation <xref:System.Windows.Interop.HwndHost.System%23Windows%23Interop%23IKeyboardInputSink%23TabInto%2A>.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-135">By default, the <xref:System.Windows.Interop.HwndHost> class returns `false` for its <xref:System.Windows.Interop.HwndHost.System%23Windows%23Interop%23IKeyboardInputSink%23TabInto%2A> implementation.</span></span> <span data-ttu-id="4d8a2-136">Cela empêche la tabulation d’un contrôle de [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] à un contrôle de [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d8a2-136">This prevents tabbing from a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] control to a [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] control.</span></span>  
  
 <span data-ttu-id="4d8a2-137">L’implémentation <xref:System.Windows.Forms.Integration.WindowsFormsHost> de la méthode <xref:System.Windows.Interop.IKeyboardInputSink.TabInto%2A?displayProperty=nameWithType> effectue les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="4d8a2-137">The <xref:System.Windows.Forms.Integration.WindowsFormsHost> implementation of the <xref:System.Windows.Interop.IKeyboardInputSink.TabInto%2A?displayProperty=nameWithType> method performs the following steps:</span></span>  
  
1. <span data-ttu-id="4d8a2-138">Recherche le premier ou le dernier contrôle de [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] contenu dans le contrôle <xref:System.Windows.Forms.Integration.WindowsFormsHost> et qui peut recevoir le focus.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-138">Finds the first or last [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] control that is contained by the <xref:System.Windows.Forms.Integration.WindowsFormsHost> control and that can receive focus.</span></span> <span data-ttu-id="4d8a2-139">Le choix du contrôle dépend des informations de parcours.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-139">The control choice depends on traversal information.</span></span>  
  
2. <span data-ttu-id="4d8a2-140">Définit le focus sur le contrôle et retourne `true`.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-140">Sets focus to the control and returns `true`.</span></span>  
  
3. <span data-ttu-id="4d8a2-141">Si aucun contrôle ne peut recevoir le focus, retourne `false`.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-141">If no control can receive focus, returns `false`.</span></span>  
  
### <a name="windowsformshost-registration"></a><span data-ttu-id="4d8a2-142">Inscription WindowsFormsHost</span><span class="sxs-lookup"><span data-stu-id="4d8a2-142">WindowsFormsHost Registration</span></span>  
 <span data-ttu-id="4d8a2-143">Quand le handle de fenêtre d’un contrôle de <xref:System.Windows.Forms.Integration.WindowsFormsHost> est créé, le contrôle <xref:System.Windows.Forms.Integration.WindowsFormsHost> appelle une méthode statique interne qui enregistre sa présence pour la boucle de message.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-143">When the window handle to a <xref:System.Windows.Forms.Integration.WindowsFormsHost> control is created, the <xref:System.Windows.Forms.Integration.WindowsFormsHost> control calls an internal static method that registers its presence for the message loop.</span></span>  
  
 <span data-ttu-id="4d8a2-144">Pendant l’inscription, le contrôle <xref:System.Windows.Forms.Integration.WindowsFormsHost> examine la boucle de message.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-144">During registration, the <xref:System.Windows.Forms.Integration.WindowsFormsHost> control examines the message loop.</span></span> <span data-ttu-id="4d8a2-145">Si la boucle de message n’a pas été démarrée, le gestionnaire d’événements <xref:System.Windows.Interop.ComponentDispatcher.ThreadFilterMessage?displayProperty=nameWithType> est créé.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-145">If the message loop has not been started, the <xref:System.Windows.Interop.ComponentDispatcher.ThreadFilterMessage?displayProperty=nameWithType> event handler is created.</span></span> <span data-ttu-id="4d8a2-146">La boucle de message est considérée comme étant en cours d’exécution lorsque le gestionnaire d’événements <xref:System.Windows.Interop.ComponentDispatcher.ThreadFilterMessage?displayProperty=nameWithType> est attaché.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-146">The message loop is considered to be running when the <xref:System.Windows.Interop.ComponentDispatcher.ThreadFilterMessage?displayProperty=nameWithType> event handler is attached.</span></span>  
  
 <span data-ttu-id="4d8a2-147">Quand le handle de fenêtre est détruit, le contrôle <xref:System.Windows.Forms.Integration.WindowsFormsHost> se supprime lui-même de l’inscription.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-147">When the window handle is destroyed, the <xref:System.Windows.Forms.Integration.WindowsFormsHost> control removes itself from registration.</span></span>  
  
## <a name="elementhost-keyboard-and-message-processing"></a><span data-ttu-id="4d8a2-148">Clavier ElementHost et traitement des messages</span><span class="sxs-lookup"><span data-stu-id="4d8a2-148">ElementHost Keyboard and Message Processing</span></span>  
 <span data-ttu-id="4d8a2-149">Lorsqu’ils sont hébergés par une application [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)], [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] le traitement du clavier et des messages se compose des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="4d8a2-149">When hosted by a [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] application, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] keyboard and message processing consists of the following:</span></span>  
  
- <span data-ttu-id="4d8a2-150">implémentations d’interface <xref:System.Windows.Interop.HwndSource>, <xref:System.Windows.Interop.IKeyboardInputSink>et <xref:System.Windows.Interop.IKeyboardInputSite>.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-150"><xref:System.Windows.Interop.HwndSource>, <xref:System.Windows.Interop.IKeyboardInputSink>, and <xref:System.Windows.Interop.IKeyboardInputSite> interface implementations.</span></span>  
  
- <span data-ttu-id="4d8a2-151">Touches de tabulation et de direction.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-151">Tabbing and arrow keys.</span></span>  
  
- <span data-ttu-id="4d8a2-152">Clés de commande et clés de boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-152">Command keys and dialog box keys.</span></span>  
  
- [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] <span data-ttu-id="4d8a2-153">le traitement des accélérateurs.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-153">accelerator processing.</span></span>  
  
 <span data-ttu-id="4d8a2-154">Les sections suivantes décrivent ces parties plus en détail.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-154">The following sections describe these parts in more detail.</span></span>  
  
### <a name="interface-implementations"></a><span data-ttu-id="4d8a2-155">Implémentations d’interface</span><span class="sxs-lookup"><span data-stu-id="4d8a2-155">Interface Implementations</span></span>  
 <span data-ttu-id="4d8a2-156">Dans [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)], les messages de clavier sont acheminés vers le handle de fenêtre du contrôle qui a le focus.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-156">In [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)], keyboard messages are routed to the window handle of the control that has focus.</span></span> <span data-ttu-id="4d8a2-157">Dans le contrôle <xref:System.Windows.Forms.Integration.ElementHost>, ces messages sont routés vers l’élément hébergé.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-157">In the <xref:System.Windows.Forms.Integration.ElementHost> control, these messages are routed to the hosted element.</span></span> <span data-ttu-id="4d8a2-158">Pour ce faire, le contrôle <xref:System.Windows.Forms.Integration.ElementHost> fournit une instance <xref:System.Windows.Interop.HwndSource>.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-158">To accomplish this, the <xref:System.Windows.Forms.Integration.ElementHost> control provides an <xref:System.Windows.Interop.HwndSource> instance.</span></span> <span data-ttu-id="4d8a2-159">Si le contrôle de <xref:System.Windows.Forms.Integration.ElementHost> a le focus, l’instance de <xref:System.Windows.Interop.HwndSource> route la plupart des entrées au clavier afin qu’elles puissent être traitées par la classe <xref:System.Windows.Input.InputManager> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d8a2-159">If the <xref:System.Windows.Forms.Integration.ElementHost> control has focus, the <xref:System.Windows.Interop.HwndSource> instance routes most keyboard input so that it can be processed by the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Input.InputManager> class.</span></span>  
  
 <span data-ttu-id="4d8a2-160">La classe <xref:System.Windows.Interop.HwndSource> implémente les interfaces <xref:System.Windows.Interop.IKeyboardInputSink> et <xref:System.Windows.Interop.IKeyboardInputSite>.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-160">The <xref:System.Windows.Interop.HwndSource> class implements the <xref:System.Windows.Interop.IKeyboardInputSink> and <xref:System.Windows.Interop.IKeyboardInputSite> interfaces.</span></span>  
  
 <span data-ttu-id="4d8a2-161">L’interopérabilité du clavier repose sur l’implémentation de la méthode <xref:System.Windows.Interop.IKeyboardInputSite.OnNoMoreTabStops%2A> pour gérer l’entrée de la touche TAB et de la touche de direction qui déplace le focus hors des éléments hébergés.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-161">Keyboard interoperation relies on implementing the <xref:System.Windows.Interop.IKeyboardInputSite.OnNoMoreTabStops%2A> method to handle TAB key and arrow key input that moves focus out of hosted elements.</span></span>  
  
### <a name="tabbing-and-arrow-keys"></a><span data-ttu-id="4d8a2-162">Touches de tabulation et de direction</span><span class="sxs-lookup"><span data-stu-id="4d8a2-162">Tabbing and Arrow Keys</span></span>  
 <span data-ttu-id="4d8a2-163">La logique de sélection de [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] est mappée aux méthodes de <xref:System.Windows.Interop.HwndSource.System%23Windows%23Interop%23IKeyboardInputSink%23TabInto%2A> et de <xref:System.Windows.Interop.IKeyboardInputSite.OnNoMoreTabStops%2A> pour implémenter la navigation par TABULATIONs et les touches de direction.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-163">The [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] selection logic is mapped to the <xref:System.Windows.Interop.HwndSource.System%23Windows%23Interop%23IKeyboardInputSink%23TabInto%2A> and <xref:System.Windows.Interop.IKeyboardInputSite.OnNoMoreTabStops%2A> methods to implement TAB and arrow key navigation.</span></span> <span data-ttu-id="4d8a2-164">La substitution de la méthode <xref:System.Windows.Forms.Integration.ElementHost.Select%2A> effectue ce mappage.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-164">Overriding the <xref:System.Windows.Forms.Integration.ElementHost.Select%2A> method accomplishes this mapping.</span></span>  
  
### <a name="command-keys-and-dialog-box-keys"></a><span data-ttu-id="4d8a2-165">Clés de commande et clés de boîte de dialogue</span><span class="sxs-lookup"><span data-stu-id="4d8a2-165">Command Keys and Dialog Box Keys</span></span>  
 <span data-ttu-id="4d8a2-166">Pour permettre à [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] la première possibilité de traiter les touches de commande et les touches de boîte de dialogue, [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] le prétraitement des commandes est connecté à la méthode <xref:System.Windows.Interop.IKeyboardInputSink.TranslateAccelerator%2A>.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-166">To give [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] the first opportunity to process command keys and dialog keys, [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] command preprocessing is connected to the <xref:System.Windows.Interop.IKeyboardInputSink.TranslateAccelerator%2A> method.</span></span> <span data-ttu-id="4d8a2-167">La substitution de la méthode <xref:System.Windows.Forms.Control.ProcessCmdKey%2A?displayProperty=nameWithType> connecte les deux technologies.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-167">Overriding the <xref:System.Windows.Forms.Control.ProcessCmdKey%2A?displayProperty=nameWithType> method connects the two technologies.</span></span>  
  
 <span data-ttu-id="4d8a2-168">Avec la méthode <xref:System.Windows.Interop.IKeyboardInputSink.TranslateAccelerator%2A>, les éléments hébergés peuvent gérer n’importe quel message de touche, comme WM_KEYDOWN, WM_KEYUP, WM_SYSKEYDOWN ou WM_SYSKEYUP, y compris les touches de commande, telles que TAB, entrée, ÉCHAP et les touches de direction.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-168">With the <xref:System.Windows.Interop.IKeyboardInputSink.TranslateAccelerator%2A> method, the hosted elements can handle any key message, such as WM_KEYDOWN, WM_KEYUP, WM_SYSKEYDOWN, or WM_SYSKEYUP, including command keys, such as TAB, ENTER, ESC, and arrow keys.</span></span> <span data-ttu-id="4d8a2-169">Si un message de clé n’est pas géré, il est envoyé vers le haut de la hiérarchie d’ancêtre [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] pour la gestion.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-169">If a key message is not handled, it is sent up the [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] ancestor hierarchy for handling.</span></span>  
  
### <a name="accelerator-processing"></a><span data-ttu-id="4d8a2-170">Traitement des accélérateurs</span><span class="sxs-lookup"><span data-stu-id="4d8a2-170">Accelerator Processing</span></span>  
 <span data-ttu-id="4d8a2-171">Pour traiter correctement les accélérateurs, [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] traitement des accélérateurs doit être connecté à la classe <xref:System.Windows.Input.AccessKeyManager> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d8a2-171">To process accelerators correctly, [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] accelerator processing must be connected to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Input.AccessKeyManager> class.</span></span> <span data-ttu-id="4d8a2-172">En outre, tous les messages WM_CHAR doivent être routés correctement vers les éléments hébergés.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-172">Additionally, all WM_CHAR messages must be correctly routed to hosted elements.</span></span>  
  
 <span data-ttu-id="4d8a2-173">Étant donné que l’implémentation par défaut <xref:System.Windows.Interop.HwndSource> de la méthode <xref:System.Windows.Interop.IKeyboardInputSink.TranslateChar%2A> retourne `false`, les messages WM_CHAR sont traités à l’aide de la logique suivante :</span><span class="sxs-lookup"><span data-stu-id="4d8a2-173">Because the default <xref:System.Windows.Interop.HwndSource> implementation of the <xref:System.Windows.Interop.IKeyboardInputSink.TranslateChar%2A> method returns `false`, WM_CHAR messages are processed using the following logic:</span></span>  
  
- <span data-ttu-id="4d8a2-174">La méthode <xref:System.Windows.Forms.Control.IsInputChar%2A?displayProperty=nameWithType> est substituée pour garantir que tous les messages WM_CHAR sont transférés aux éléments hébergés.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-174">The <xref:System.Windows.Forms.Control.IsInputChar%2A?displayProperty=nameWithType> method is overridden to ensure that all WM_CHAR messages are forwarded to hosted elements.</span></span>  
  
- <span data-ttu-id="4d8a2-175">Si la touche ALT est enfoncée, le message est WM_SYSCHAR.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-175">If the ALT key is pressed, the message is WM_SYSCHAR.</span></span> [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] <span data-ttu-id="4d8a2-176">ne prétraite pas ce message via la méthode <xref:System.Windows.Forms.Control.IsInputChar%2A>.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-176">does not preprocess this message through the <xref:System.Windows.Forms.Control.IsInputChar%2A> method.</span></span> <span data-ttu-id="4d8a2-177">Par conséquent, la méthode <xref:System.Windows.Forms.Control.ProcessMnemonic%2A> est substituée pour interroger le <xref:System.Windows.Input.AccessKeyManager> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] pour un accélérateur inscrit.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-177">Therefore, the <xref:System.Windows.Forms.Control.ProcessMnemonic%2A> method is overridden to query the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Input.AccessKeyManager> for a registered accelerator.</span></span> <span data-ttu-id="4d8a2-178">Si un accélérateur inscrit est trouvé, <xref:System.Windows.Input.AccessKeyManager> le traite.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-178">If a registered accelerator is found, <xref:System.Windows.Input.AccessKeyManager> processes it.</span></span>  
  
- <span data-ttu-id="4d8a2-179">Si la touche ALT n’est pas enfoncée, la classe [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Input.InputManager> traite l’entrée non gérée.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-179">If the ALT key is not pressed, the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Input.InputManager> class processes the unhandled input.</span></span> <span data-ttu-id="4d8a2-180">Si l’entrée est un accélérateur, le <xref:System.Windows.Input.AccessKeyManager> le traite.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-180">If the input is an accelerator, the <xref:System.Windows.Input.AccessKeyManager> processes it.</span></span> <span data-ttu-id="4d8a2-181">L’événement <xref:System.Windows.Input.InputManager.PostProcessInput> est géré pour les messages WM_CHAR qui n’ont pas été traités.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-181">The <xref:System.Windows.Input.InputManager.PostProcessInput> event is handled for WM_CHAR messages that were not processed.</span></span>  
  
 <span data-ttu-id="4d8a2-182">Quand l’utilisateur appuie sur la touche ALT, les signaux visuels des accélérateurs s’affichent sur l’ensemble du formulaire.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-182">When the user presses the ALT key, accelerator visual cues are shown on the whole form.</span></span> <span data-ttu-id="4d8a2-183">Pour prendre en charge ce comportement, tous les contrôles <xref:System.Windows.Forms.Integration.ElementHost> du formulaire actif reçoivent des messages WM_SYSKEYDOWN, quel que soit le contrôle ayant le focus.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-183">To support this behavior, all <xref:System.Windows.Forms.Integration.ElementHost> controls on the active form receive WM_SYSKEYDOWN messages, regardless of which control has focus.</span></span>  
  
 <span data-ttu-id="4d8a2-184">Les messages sont envoyés uniquement aux contrôles de <xref:System.Windows.Forms.Integration.ElementHost> dans le formulaire actif.</span><span class="sxs-lookup"><span data-stu-id="4d8a2-184">Messages are sent only to <xref:System.Windows.Forms.Integration.ElementHost> controls in the active form.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4d8a2-185">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="4d8a2-185">See also</span></span>

- <xref:System.Windows.Forms.Integration.WindowsFormsHost.EnableWindowsFormsInterop%2A>
- <xref:System.Windows.Forms.Integration.ElementHost.EnableModelessKeyboardInterop%2A>
- <xref:System.Windows.Forms.Integration.ElementHost>
- <xref:System.Windows.Forms.Integration.WindowsFormsHost>
- [<span data-ttu-id="4d8a2-186">Procédure pas à pas : hébergement d'un contrôle composite Windows Forms dans WPF</span><span class="sxs-lookup"><span data-stu-id="4d8a2-186">Walkthrough: Hosting a Windows Forms Composite Control in WPF</span></span>](walkthrough-hosting-a-windows-forms-composite-control-in-wpf.md)
- [<span data-ttu-id="4d8a2-187">Procédure pas à pas : Hébergement d'un contrôle composite WPF dans Windows Forms</span><span class="sxs-lookup"><span data-stu-id="4d8a2-187">Walkthrough: Hosting a WPF Composite Control in Windows Forms</span></span>](walkthrough-hosting-a-wpf-composite-control-in-windows-forms.md)
- [<span data-ttu-id="4d8a2-188">Interopérabilité WPF et Win32</span><span class="sxs-lookup"><span data-stu-id="4d8a2-188">WPF and Win32 Interoperation</span></span>](wpf-and-win32-interoperation.md)

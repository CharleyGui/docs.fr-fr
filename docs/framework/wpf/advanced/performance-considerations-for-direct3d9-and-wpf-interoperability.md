---
title: Considérations relatives aux performances pour Direct3D9 et l’interopérabilité WPF
titleSuffix: ''
ms.date: 03/30/2017
helpviewer_keywords:
- WPF [WPF], Direct3D9 interop performance
- Direct3D9 [WPF interoperability], performance
ms.assetid: ea8baf91-12fe-4b44-ac4d-477110ab14dd
ms.openlocfilehash: 2445732c27d210a41da26303d6a9ce07ef6fcc94
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/24/2020
ms.locfileid: "76743932"
---
# <a name="performance-considerations-for-direct3d9-and-wpf-interoperability"></a><span data-ttu-id="57cb4-102">Considérations sur les performances de l'interopérabilité entre Direct3D9 et WPF</span><span class="sxs-lookup"><span data-stu-id="57cb4-102">Performance Considerations for Direct3D9 and WPF Interoperability</span></span>
<span data-ttu-id="57cb4-103">Vous pouvez héberger le contenu Direct3D9 à l’aide de la classe <xref:System.Windows.Interop.D3DImage>.</span><span class="sxs-lookup"><span data-stu-id="57cb4-103">You can host Direct3D9 content by using the <xref:System.Windows.Interop.D3DImage> class.</span></span> <span data-ttu-id="57cb4-104">L’hébergement de contenu Direct3D9 peut affecter les performances de votre application.</span><span class="sxs-lookup"><span data-stu-id="57cb4-104">Hosting Direct3D9 content can affect the performance of your application.</span></span> <span data-ttu-id="57cb4-105">Cette rubrique décrit les meilleures pratiques pour optimiser les performances lors de l’hébergement de contenu Direct3D9 dans une application Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="57cb4-105">This topic describes best practices to optimize performance when hosting Direct3D9 content in a Windows Presentation Foundation (WPF) application.</span></span> <span data-ttu-id="57cb4-106">Ces meilleures pratiques incluent l’utilisation de <xref:System.Windows.Interop.D3DImage> et des meilleures pratiques lorsque vous utilisez Windows Vista, Windows XP et des affichages à plusieurs écrans.</span><span class="sxs-lookup"><span data-stu-id="57cb4-106">These best practices include how to use <xref:System.Windows.Interop.D3DImage> and best practices when you are using Windows Vista, Windows XP, and multi-monitor displays.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="57cb4-107">Pour obtenir des exemples de code qui illustrent ces meilleures pratiques, consultez [interopérabilité WPF et Direct3D9](wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="57cb4-107">For code examples that demonstrate these best practices, see [WPF and Direct3D9 Interoperation](wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="use-d3dimage-sparingly"></a><span data-ttu-id="57cb4-108">Utiliser D3DImage avec modération</span><span class="sxs-lookup"><span data-stu-id="57cb4-108">Use D3DImage Sparingly</span></span>  
 <span data-ttu-id="57cb4-109">Le contenu Direct3D9 hébergé dans une instance de <xref:System.Windows.Interop.D3DImage> n’est pas restitué aussi rapidement que dans une application Direct3D pure.</span><span class="sxs-lookup"><span data-stu-id="57cb4-109">Direct3D9 content hosted in a <xref:System.Windows.Interop.D3DImage> instance does not render as fast as in a pure Direct3D application.</span></span> <span data-ttu-id="57cb4-110">La copie de la surface et le vidage du tampon de commande peuvent être des opérations coûteuses.</span><span class="sxs-lookup"><span data-stu-id="57cb4-110">Copying the surface and flushing the command buffer can be costly operations.</span></span> <span data-ttu-id="57cb4-111">À mesure que le nombre d’instances de <xref:System.Windows.Interop.D3DImage> augmente, le vidage se produit plus et les performances diminuent.</span><span class="sxs-lookup"><span data-stu-id="57cb4-111">As the number of <xref:System.Windows.Interop.D3DImage> instances increases, more flushing occurs, and performance degrades.</span></span> <span data-ttu-id="57cb4-112">Par conséquent, vous devez utiliser <xref:System.Windows.Interop.D3DImage> avec modération.</span><span class="sxs-lookup"><span data-stu-id="57cb4-112">Therefore, you should use <xref:System.Windows.Interop.D3DImage> sparingly.</span></span>  
  
## <a name="best-practices-on-windows-vista"></a><span data-ttu-id="57cb4-113">Meilleures pratiques sur Windows Vista</span><span class="sxs-lookup"><span data-stu-id="57cb4-113">Best Practices on Windows Vista</span></span>  
 <span data-ttu-id="57cb4-114">Pour de meilleures performances sur Windows Vista avec un affichage configuré pour utiliser le modèle WDDM (Windows Display Driver Model), créez votre surface Direct3D9 sur un appareil `IDirect3DDevice9Ex`.</span><span class="sxs-lookup"><span data-stu-id="57cb4-114">For best performance on Windows Vista with a display that is configured to use the Windows Display Driver Model (WDDM), create your Direct3D9 surface on an `IDirect3DDevice9Ex` device.</span></span> <span data-ttu-id="57cb4-115">Cela active le partage de surface.</span><span class="sxs-lookup"><span data-stu-id="57cb4-115">This enables surface sharing.</span></span> <span data-ttu-id="57cb4-116">La carte vidéo doit prendre en charge les fonctionnalités du pilote `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` et `D3DCAPS2_CANSHARERESOURCE` sur Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="57cb4-116">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` and `D3DCAPS2_CANSHARERESOURCE` driver capabilities on Windows Vista.</span></span> <span data-ttu-id="57cb4-117">Tous les autres paramètres entraînent la copie de la surface par le biais d’un logiciel, ce qui réduit considérablement les performances.</span><span class="sxs-lookup"><span data-stu-id="57cb4-117">Any other settings cause the surface to be copied through software, which reduces performance significantly.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="57cb4-118">Si Windows Vista a un affichage configuré pour utiliser le modèle de pilote d’affichage (XDDM) de Windows XP, la surface est toujours copiée via un logiciel, quels que soient les paramètres.</span><span class="sxs-lookup"><span data-stu-id="57cb4-118">If Windows Vista has a display that is configured to use the Windows XP Display Driver Model (XDDM), the surface is always copied through software, regardless of settings.</span></span> <span data-ttu-id="57cb4-119">Avec les paramètres et la carte vidéo appropriés, vous obtiendrez de meilleures performances sur Windows Vista lorsque vous utilisez le WDDM, car des copies superficielles sont effectuées sur le matériel.</span><span class="sxs-lookup"><span data-stu-id="57cb4-119">With the proper settings and video card, you will see better performance on Windows Vista when you use the WDDM because surface copies are performed in hardware.</span></span>  
  
## <a name="best-practices-on-windows-xp"></a><span data-ttu-id="57cb4-120">Meilleures pratiques sur Windows XP</span><span class="sxs-lookup"><span data-stu-id="57cb4-120">Best Practices on Windows XP</span></span>  
 <span data-ttu-id="57cb4-121">Pour de meilleures performances sur Windows XP, qui utilise le modèle de pilote d’affichage Windows XP (XDDM), créez une surface verrouillable qui se comporte correctement lorsque la méthode `IDirect3DSurface9::GetDC` est appelée.</span><span class="sxs-lookup"><span data-stu-id="57cb4-121">For best performance on Windows XP, which uses the Windows XP Display Driver Model (XDDM), create a lockable surface that behaves correctly when the `IDirect3DSurface9::GetDC` method is called.</span></span> <span data-ttu-id="57cb4-122">En interne, la méthode `BitBlt` transfère la surface entre les appareils dans le matériel.</span><span class="sxs-lookup"><span data-stu-id="57cb4-122">Internally, the `BitBlt` method transfers the surface across devices in hardware.</span></span> <span data-ttu-id="57cb4-123">La méthode `GetDC` fonctionne toujours sur les surfaces XRGB.</span><span class="sxs-lookup"><span data-stu-id="57cb4-123">The `GetDC` method always works on XRGB surfaces.</span></span> <span data-ttu-id="57cb4-124">Toutefois, si l’ordinateur client exécute Windows XP avec SP3 ou SP2, et si le client possède également le correctif logiciel pour la fonctionnalité de fenêtre en couche, cette méthode fonctionne uniquement sur les surfaces ARVB.</span><span class="sxs-lookup"><span data-stu-id="57cb4-124">However, if the client computer is running Windows XP with SP3 or SP2, and if the client also has the hotfix for the layered-window feature, this method only works on ARGB surfaces.</span></span> <span data-ttu-id="57cb4-125">La carte vidéo doit prendre en charge la fonctionnalité de pilote `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES`.</span><span class="sxs-lookup"><span data-stu-id="57cb4-125">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` driver capability.</span></span>  
  
 <span data-ttu-id="57cb4-126">Une profondeur d’affichage du bureau 16 bits peut réduire considérablement les performances.</span><span class="sxs-lookup"><span data-stu-id="57cb4-126">A 16-bit desktop display depth can significantly reduce performance.</span></span> <span data-ttu-id="57cb4-127">Un bureau 32 bits est recommandé.</span><span class="sxs-lookup"><span data-stu-id="57cb4-127">A 32-bit desktop is recommended.</span></span>  
  
 <span data-ttu-id="57cb4-128">Si vous développez pour Windows Vista et Windows XP, testez les performances sur Windows XP.</span><span class="sxs-lookup"><span data-stu-id="57cb4-128">If you are developing for Windows Vista and Windows XP, test the performance on Windows XP.</span></span> <span data-ttu-id="57cb4-129">Le manque de mémoire vidéo sur Windows XP est un problème.</span><span class="sxs-lookup"><span data-stu-id="57cb4-129">Running out of video memory on Windows XP is a concern.</span></span> <span data-ttu-id="57cb4-130">En outre, <xref:System.Windows.Interop.D3DImage> sur Windows XP utilise plus de mémoire vidéo et de bande passante que le WDDM Windows Vista, en raison d’une copie supplémentaire de la mémoire vidéo.</span><span class="sxs-lookup"><span data-stu-id="57cb4-130">In addition, <xref:System.Windows.Interop.D3DImage> on Windows XP uses more video memory and bandwidth than Windows Vista WDDM, due to a necessary extra video memory copy.</span></span> <span data-ttu-id="57cb4-131">Par conséquent, vous pouvez vous attendre à ce que les performances soient moins bonnes sur Windows XP que sur Windows Vista pour le même matériel vidéo.</span><span class="sxs-lookup"><span data-stu-id="57cb4-131">Therefore, you can expect performance to be worse on Windows XP than on Windows Vista for the same video hardware.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="57cb4-132">XDDM est disponible sur Windows XP et Windows Vista. Toutefois, le WDDM est disponible uniquement sur Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="57cb4-132">XDDM is available on both Windows XP and Windows Vista; however, WDDM is available only on Windows Vista.</span></span>  
  
## <a name="general-best-practices"></a><span data-ttu-id="57cb4-133">Meilleures pratiques générales</span><span class="sxs-lookup"><span data-stu-id="57cb4-133">General Best Practices</span></span>  
 <span data-ttu-id="57cb4-134">Lorsque vous créez l’appareil, utilisez l’indicateur de création `D3DCREATE_MULTITHREADED`.</span><span class="sxs-lookup"><span data-stu-id="57cb4-134">When you create the device, use the `D3DCREATE_MULTITHREADED` creation flag.</span></span> <span data-ttu-id="57cb4-135">Cela réduit les performances, mais le système de rendu WPF appelle les méthodes sur cet appareil à partir d’un autre thread.</span><span class="sxs-lookup"><span data-stu-id="57cb4-135">This reduces performance, but the WPF rendering system calls methods on this device from another thread.</span></span> <span data-ttu-id="57cb4-136">Veillez à suivre correctement le protocole de verrouillage, afin que deux threads n’accèdent pas à l’appareil en même temps.</span><span class="sxs-lookup"><span data-stu-id="57cb4-136">Be sure to follow the locking protocol correctly, so that no two threads access the device at the same time.</span></span>  
  
 <span data-ttu-id="57cb4-137">Si votre rendu est effectué sur un thread managé WPF, il est fortement recommandé de créer l’appareil avec l’indicateur de création `D3DCREATE_FPU_PRESERVE`.</span><span class="sxs-lookup"><span data-stu-id="57cb4-137">If your rendering is performed on a WPF managed thread, it is strongly recommended that you create the device with the `D3DCREATE_FPU_PRESERVE` creation flag.</span></span> <span data-ttu-id="57cb4-138">Sans ce paramètre, le rendu D3D peut réduire la précision des opérations WPF double précision et introduire des problèmes de rendu.</span><span class="sxs-lookup"><span data-stu-id="57cb4-138">Without this setting, the D3D rendering can reduce the accuracy of WPF double-precision operations and introduce rendering issues.</span></span>  
  
 <span data-ttu-id="57cb4-139">La mosaïque d’une <xref:System.Windows.Interop.D3DImage> est rapide, à moins que vous ne décarreaux une surface non pow2 sans prise en charge matérielle, ou si vous disposant d’une <xref:System.Windows.Media.DrawingBrush> ou d’un <xref:System.Windows.Media.VisualBrush> contenant un <xref:System.Windows.Interop.D3DImage>.</span><span class="sxs-lookup"><span data-stu-id="57cb4-139">Tiling a <xref:System.Windows.Interop.D3DImage> is fast, unless you tile a non-pow2 surface without hardware support, or if you tile a <xref:System.Windows.Media.DrawingBrush> or <xref:System.Windows.Media.VisualBrush> that contains a <xref:System.Windows.Interop.D3DImage>.</span></span>  
  
## <a name="best-practices-for-multi-monitor-displays"></a><span data-ttu-id="57cb4-140">Meilleures pratiques pour les affichages à plusieurs écrans</span><span class="sxs-lookup"><span data-stu-id="57cb4-140">Best Practices for Multi-Monitor Displays</span></span>  
 <span data-ttu-id="57cb4-141">Si vous utilisez un ordinateur équipé de plusieurs moniteurs, vous devez suivre les meilleures pratiques décrites précédemment.</span><span class="sxs-lookup"><span data-stu-id="57cb4-141">If you are using a computer that has multiple monitors, you should follow the previously described best practices.</span></span> <span data-ttu-id="57cb4-142">Il existe également des considérations supplémentaires sur les performances pour une configuration à plusieurs écrans.</span><span class="sxs-lookup"><span data-stu-id="57cb4-142">There are also some additional performance considerations for a multi-monitor configuration.</span></span>  
  
 <span data-ttu-id="57cb4-143">Lorsque vous créez la mémoire tampon d’arrière-plan, elle est créée sur un appareil et un adaptateur spécifiques, mais WPF peut afficher le tampon d’affichage sur n’importe quel adaptateur.</span><span class="sxs-lookup"><span data-stu-id="57cb4-143">When you create the back buffer, it is created on a specific device and adapter, but WPF may display the front buffer on any adapter.</span></span> <span data-ttu-id="57cb4-144">La copie sur les adaptateurs pour mettre à jour le tampon d’avant peut être très coûteuse.</span><span class="sxs-lookup"><span data-stu-id="57cb4-144">Copying across adapters to update the front buffer can be very expensive.</span></span> <span data-ttu-id="57cb4-145">Sur Windows Vista qui est configuré pour utiliser le WDDM avec plusieurs cartes vidéo et avec un appareil `IDirect3DDevice9Ex`, si le tampon d’entrée est sur un autre adaptateur mais toujours sur la même carte vidéo, il n’y a aucune altération des performances.</span><span class="sxs-lookup"><span data-stu-id="57cb4-145">On Windows Vista that is configured to use the WDDM with multiple video cards and with an `IDirect3DDevice9Ex` device, if the front buffer is on a different adapter but still the same video card, there is no performance penalty.</span></span> <span data-ttu-id="57cb4-146">Toutefois, sur Windows XP et le XDDM avec plusieurs cartes vidéo, il y a une baisse importante des performances lorsque le tampon d’avant est affiché sur un autre adaptateur que la mémoire tampon d’arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="57cb4-146">However, on Windows XP and the XDDM with multiple video cards, there is a significant performance penalty when the front buffer is displayed on a different adapter than the back buffer.</span></span> <span data-ttu-id="57cb4-147">Pour plus d’informations, consultez [interopérabilité WPF et Direct3D9](wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="57cb4-147">For more information, see [WPF and Direct3D9 Interoperation](wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="performance-summary"></a><span data-ttu-id="57cb4-148">Résumé des performances</span><span class="sxs-lookup"><span data-stu-id="57cb4-148">Performance Summary</span></span>  
 <span data-ttu-id="57cb4-149">Le tableau suivant montre les performances de la mise à jour de la mémoire tampon avant en fonction du système d’exploitation, du format de pixel et de la fonctionnalité de verrouillage en surface.</span><span class="sxs-lookup"><span data-stu-id="57cb4-149">The following table shows performance of the front buffer update as a function of operating system, pixel format, and surface lockability.</span></span> <span data-ttu-id="57cb4-150">La mémoire tampon d’arrière-plan et la mémoire tampon d’arrière-plan sont supposées être sur le même adaptateur.</span><span class="sxs-lookup"><span data-stu-id="57cb4-150">The front buffer and back buffer are assumed to be on the same adapter.</span></span> <span data-ttu-id="57cb4-151">En fonction de la configuration de l’adaptateur, les mises à jour matérielles sont généralement beaucoup plus rapides que les mises à jour logicielles.</span><span class="sxs-lookup"><span data-stu-id="57cb4-151">Depending on the adapter configuration, hardware updates are generally much faster than software updates.</span></span>  
  
|<span data-ttu-id="57cb4-152">Format de pixel de surface</span><span class="sxs-lookup"><span data-stu-id="57cb4-152">Surface pixel format</span></span>|<span data-ttu-id="57cb4-153">Windows Vista, WDDM et 9Ex</span><span class="sxs-lookup"><span data-stu-id="57cb4-153">Windows Vista, WDDM and 9Ex</span></span>|<span data-ttu-id="57cb4-154">Autres configurations de Windows Vista</span><span class="sxs-lookup"><span data-stu-id="57cb4-154">Other Windows Vista configurations</span></span>|<span data-ttu-id="57cb4-155">Windows XP SP3 ou SP2 avec correctif logiciel</span><span class="sxs-lookup"><span data-stu-id="57cb4-155">Windows XP SP3 or SP2 w/ hotfix</span></span>|<span data-ttu-id="57cb4-156">Windows XP SP2</span><span class="sxs-lookup"><span data-stu-id="57cb4-156">Windows XP SP2</span></span>|  
|--------------------------|---------------------------------|----------------------------------------|--------------------------------------|--------------------|  
|<span data-ttu-id="57cb4-157">D3DFMT_X8R8G8B8 (non verrouillable)</span><span class="sxs-lookup"><span data-stu-id="57cb4-157">D3DFMT_X8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="57cb4-158">**Mise à jour matérielle**</span><span class="sxs-lookup"><span data-stu-id="57cb4-158">**Hardware Update**</span></span>|<span data-ttu-id="57cb4-159">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="57cb4-159">Software Update</span></span>|<span data-ttu-id="57cb4-160">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="57cb4-160">Software Update</span></span>|<span data-ttu-id="57cb4-161">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="57cb4-161">Software Update</span></span>|  
|<span data-ttu-id="57cb4-162">D3DFMT_X8R8G8B8 (verrouillable)</span><span class="sxs-lookup"><span data-stu-id="57cb4-162">D3DFMT_X8R8G8B8 (lockable)</span></span>|<span data-ttu-id="57cb4-163">**Mise à jour matérielle**</span><span class="sxs-lookup"><span data-stu-id="57cb4-163">**Hardware Update**</span></span>|<span data-ttu-id="57cb4-164">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="57cb4-164">Software Update</span></span>|<span data-ttu-id="57cb4-165">**Mise à jour matérielle**</span><span class="sxs-lookup"><span data-stu-id="57cb4-165">**Hardware Update**</span></span>|<span data-ttu-id="57cb4-166">**Mise à jour matérielle**</span><span class="sxs-lookup"><span data-stu-id="57cb4-166">**Hardware Update**</span></span>|  
|<span data-ttu-id="57cb4-167">D3DFMT_A8R8G8B8 (non verrouillable)</span><span class="sxs-lookup"><span data-stu-id="57cb4-167">D3DFMT_A8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="57cb4-168">**Mise à jour matérielle**</span><span class="sxs-lookup"><span data-stu-id="57cb4-168">**Hardware Update**</span></span>|<span data-ttu-id="57cb4-169">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="57cb4-169">Software Update</span></span>|<span data-ttu-id="57cb4-170">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="57cb4-170">Software Update</span></span>|<span data-ttu-id="57cb4-171">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="57cb4-171">Software Update</span></span>|  
|<span data-ttu-id="57cb4-172">D3DFMT_A8R8G8B8 (verrouillable)</span><span class="sxs-lookup"><span data-stu-id="57cb4-172">D3DFMT_A8R8G8B8 (lockable)</span></span>|<span data-ttu-id="57cb4-173">**Mise à jour matérielle**</span><span class="sxs-lookup"><span data-stu-id="57cb4-173">**Hardware Update**</span></span>|<span data-ttu-id="57cb4-174">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="57cb4-174">Software Update</span></span>|<span data-ttu-id="57cb4-175">**Mise à jour matérielle**</span><span class="sxs-lookup"><span data-stu-id="57cb4-175">**Hardware Update**</span></span>|<span data-ttu-id="57cb4-176">Mise à jour logicielle</span><span class="sxs-lookup"><span data-stu-id="57cb4-176">Software Update</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="57cb4-177">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="57cb4-177">See also</span></span>

- <xref:System.Windows.Interop.D3DImage>
- [<span data-ttu-id="57cb4-178">Interopérabilité WPF et Direct3D9</span><span class="sxs-lookup"><span data-stu-id="57cb4-178">WPF and Direct3D9 Interoperation</span></span>](wpf-and-direct3d9-interoperation.md)
- [<span data-ttu-id="57cb4-179">Procédure pas à pas : création de contenu Direct3D9 à héberger dans WPF</span><span class="sxs-lookup"><span data-stu-id="57cb4-179">Walkthrough: Creating Direct3D9 Content for Hosting in WPF</span></span>](walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md)
- [<span data-ttu-id="57cb4-180">Procédure pas à pas : hébergement de contenu Direct3D9 dans WPF</span><span class="sxs-lookup"><span data-stu-id="57cb4-180">Walkthrough: Hosting Direct3D9 Content in WPF</span></span>](walkthrough-hosting-direct3d9-content-in-wpf.md)

---
title: Vue d'ensemble des événements routés
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- attached events [WPF]
- grouped button set [WPF]
- routed events [WPF]
- events [WPF], routed
- tunneling [WPF]
- events [WPF], attached
- routing strategies for events [WPF]
- button set [WPF], grouped
- bubbling [WPF]
ms.assetid: 1a2189ae-13b4-45b0-b12c-8de2e49c29d2
ms.openlocfilehash: ecd340d00e7f02655dfdcd8eee548309d424a5ea
ms.sourcegitcommit: 944ddc52b7f2632f30c668815f92b378efd38eea
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/03/2019
ms.locfileid: "73458739"
---
# <a name="routed-events-overview"></a><span data-ttu-id="ba041-102">Vue d'ensemble des événements routés</span><span class="sxs-lookup"><span data-stu-id="ba041-102">Routed Events Overview</span></span>

<span data-ttu-id="ba041-103">Cette rubrique explique le concept d’événements routés dans [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ba041-103">This topic describes the concept of routed events in [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)].</span></span> <span data-ttu-id="ba041-104">Elle définit les termes utilisés pour les événements routés, elle explique comment ces événements sont routés via une arborescence d’éléments, elle résume la façon dont sont gérés les événements routés et elle explique comment créer ses propres événements routés personnalisés.</span><span class="sxs-lookup"><span data-stu-id="ba041-104">The topic defines routed events terminology, describes how routed events are routed through a tree of elements, summarizes how you handle routed events, and introduces how to create your own custom routed events.</span></span>

<a name="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="ba041-105">Configuration requise</span><span class="sxs-lookup"><span data-stu-id="ba041-105">Prerequisites</span></span>

<span data-ttu-id="ba041-106">Cette rubrique part du principe que vous avez une connaissance de base du common language runtime (CLR) et de la programmation orientée objet, ainsi que le concept de la manière dont les relations entre les éléments [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] peuvent être conceptuelles comme une arborescence.</span><span class="sxs-lookup"><span data-stu-id="ba041-106">This topic assumes that you have basic knowledge of the common language runtime (CLR) and object-oriented programming, as well as the concept of how the relationships between [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements can be conceptualized as a tree.</span></span> <span data-ttu-id="ba041-107">Pour pouvoir suivre les exemples de cette rubrique, vous devez également connaître le [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] et savoir écrire des applications ou des pages [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] rudimentaires.</span><span class="sxs-lookup"><span data-stu-id="ba041-107">In order to follow the examples in this topic, you should also understand [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] and know how to write very basic [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications or pages.</span></span> <span data-ttu-id="ba041-108">Pour plus d’informations, consultez [procédure pas à pas : ma première application de bureau WPF](../getting-started/walkthrough-my-first-wpf-desktop-application.md) et [vue d’ensemble du langage XAML (WPF)](../../../desktop-wpf/fundamentals/xaml.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-108">For more information, see [Walkthrough: My first WPF desktop application](../getting-started/walkthrough-my-first-wpf-desktop-application.md) and [XAML Overview (WPF)](../../../desktop-wpf/fundamentals/xaml.md).</span></span>

<a name="routing"></a>

## <a name="what-is-a-routed-event"></a><span data-ttu-id="ba041-109">Qu’est-ce qu’un événement routé ?</span><span class="sxs-lookup"><span data-stu-id="ba041-109">What Is a Routed Event?</span></span>

<span data-ttu-id="ba041-110">Les événements routés peuvent être compris d’un point de vue fonctionnel et du point de vue de l’implémentation.</span><span class="sxs-lookup"><span data-stu-id="ba041-110">You can think about routed events either from a functional or implementation perspective.</span></span> <span data-ttu-id="ba041-111">Les deux définitions sont présentées ici pour une meilleure compréhension du concept.</span><span class="sxs-lookup"><span data-stu-id="ba041-111">Both definitions are presented here, because some people find one or the other definition more useful.</span></span>

<span data-ttu-id="ba041-112">Définition du point de vue fonctionnel : un événement routé est un type d’événement qui peut appeler des gestionnaires sur plusieurs écouteurs d’une arborescence d’éléments, au lieu d’appeler uniquement sur l’objet qui a déclenché l’événement.</span><span class="sxs-lookup"><span data-stu-id="ba041-112">Functional definition: A routed event is a type of event that can invoke handlers on multiple listeners in an element tree, rather than just on the object that raised the event.</span></span>

<span data-ttu-id="ba041-113">Définition d’implémentation : un événement routé est un événement CLR qui est stocké par une instance de la classe <xref:System.Windows.RoutedEvent> et qui est traité par le système d’événements [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ba041-113">Implementation definition: A routed event is a CLR event that is backed by an instance of the <xref:System.Windows.RoutedEvent> class and is processed by the [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] event system.</span></span>

<span data-ttu-id="ba041-114">Une application [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] type contient de nombreux éléments.</span><span class="sxs-lookup"><span data-stu-id="ba041-114">A typical [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application contains many elements.</span></span> <span data-ttu-id="ba041-115">Qu’ils soient créés dans le code ou déclarés dans [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], ces éléments sont reliés entre eux au sein d’une arborescence d’éléments.</span><span class="sxs-lookup"><span data-stu-id="ba041-115">Whether created in code or declared in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], these elements exist in an element tree relationship to each other.</span></span> <span data-ttu-id="ba041-116">L’itinéraire de l’événement peut prendre deux directions différentes, en fonction de la définition de l’événement. Toutefois, l’itinéraire part en général de l’élément source et se propage ensuite vers le haut dans l’arborescence d’éléments, jusqu’à atteindre la racine de l’arborescence d’éléments (en général, une page ou une fenêtre).</span><span class="sxs-lookup"><span data-stu-id="ba041-116">The event route can travel in one of two directions depending on the event definition, but generally the route travels from the source element and then "bubbles" upward through the element tree until it reaches the element tree root (typically a page or a window).</span></span> <span data-ttu-id="ba041-117">Le concept de propagation peut vous être familier si vous avez déjà travaillé avec le modèle d’objet DHTML.</span><span class="sxs-lookup"><span data-stu-id="ba041-117">This bubbling concept might be familiar to you if you have worked with the DHTML object model previously.</span></span>

<span data-ttu-id="ba041-118">Prenons l’arborescence d’éléments suivante :</span><span class="sxs-lookup"><span data-stu-id="ba041-118">Consider the following simple element tree:</span></span>

[!code-xaml[EventOvwSupport#GroupButton](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml#groupbutton)]

<span data-ttu-id="ba041-119">Cette arborescence d’éléments produit ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="ba041-119">This element tree produces something like the following:</span></span>

<span data-ttu-id="ba041-120">![Boutons Oui, non et annuler](./media/routedevent-ovw-1.gif "RoutedEvent_ovw_1")</span><span class="sxs-lookup"><span data-stu-id="ba041-120">![Yes, No, and Cancel buttons](./media/routedevent-ovw-1.gif "RoutedEvent_ovw_1")</span></span>

<span data-ttu-id="ba041-121">Dans cette arborescence d’éléments simplifiée, la source d’un événement de <xref:System.Windows.Controls.Primitives.ButtonBase.Click> est l’un des éléments de <xref:System.Windows.Controls.Button>, <xref:System.Windows.Controls.Button> et le premier élément sur lequel l’utilisateur a cliqué est le premier élément qui a la possibilité de gérer l’événement.</span><span class="sxs-lookup"><span data-stu-id="ba041-121">In this simplified element tree, the source of a <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event is one of the <xref:System.Windows.Controls.Button> elements, and whichever <xref:System.Windows.Controls.Button> was clicked is the first element that has the opportunity to handle the event.</span></span> <span data-ttu-id="ba041-122">Toutefois, si aucun gestionnaire attaché à l' <xref:System.Windows.Controls.Button> agit sur l’événement, l’événement se propage vers le haut jusqu’au parent <xref:System.Windows.Controls.Button> dans l’arborescence d’éléments, qui est le <xref:System.Windows.Controls.StackPanel>.</span><span class="sxs-lookup"><span data-stu-id="ba041-122">But if no handler attached to the <xref:System.Windows.Controls.Button> acts on the event, then the event will bubble upwards to the <xref:System.Windows.Controls.Button> parent in the element tree, which is the <xref:System.Windows.Controls.StackPanel>.</span></span> <span data-ttu-id="ba041-123">Éventuellement, l’événement se propage à <xref:System.Windows.Controls.Border>, puis au-delà de la racine de la page de l’arborescence d’éléments (non affiché).</span><span class="sxs-lookup"><span data-stu-id="ba041-123">Potentially, the event bubbles to <xref:System.Windows.Controls.Border>, and then beyond to the page root of the element tree (not shown).</span></span>

<span data-ttu-id="ba041-124">En d’autres termes, l’itinéraire d’événement pour cet événement <xref:System.Windows.Controls.Primitives.ButtonBase.Click> est le suivant :</span><span class="sxs-lookup"><span data-stu-id="ba041-124">In other words, the event route for this <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event is:</span></span>

<span data-ttu-id="ba041-125">Button-->StackPanel-->Border-->...</span><span class="sxs-lookup"><span data-stu-id="ba041-125">Button-->StackPanel-->Border-->...</span></span>

### <a name="top-level-scenarios-for-routed-events"></a><span data-ttu-id="ba041-126">Scénarios de premier niveau pour les événements routés</span><span class="sxs-lookup"><span data-stu-id="ba041-126">Top-level Scenarios for Routed Events</span></span>

<span data-ttu-id="ba041-127">Voici un bref résumé des scénarios qui ont motivé le concept d’événement routé et pourquoi un événement CLR typique n’était pas adapté à ces scénarios :</span><span class="sxs-lookup"><span data-stu-id="ba041-127">The following is a brief summary of the scenarios that motivated the routed event concept, and why a typical CLR event was not adequate for these scenarios:</span></span>

<span data-ttu-id="ba041-128">**Composition et encapsulation des contrôles** : Dans [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], plusieurs contrôles ont un modèle de contenu riche.</span><span class="sxs-lookup"><span data-stu-id="ba041-128">**Control composition and encapsulation:** Various controls in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] have a rich content model.</span></span> <span data-ttu-id="ba041-129">Par exemple, vous pouvez placer une image à l’intérieur d’un <xref:System.Windows.Controls.Button>, ce qui étend efficacement l’arborescence d’éléments visuels du bouton.</span><span class="sxs-lookup"><span data-stu-id="ba041-129">For example, you can place an image inside of a <xref:System.Windows.Controls.Button>, which effectively extends the visual tree of the button.</span></span> <span data-ttu-id="ba041-130">Toutefois, l’image ajoutée ne doit pas interrompre le comportement de test d’atteinte qui amène un bouton à répondre à une <xref:System.Windows.Controls.Primitives.ButtonBase.Click> de son contenu, même si l’utilisateur clique sur des pixels qui font partie techniquement de l’image.</span><span class="sxs-lookup"><span data-stu-id="ba041-130">However, the added image must not break the hit-testing behavior that causes a button to respond to a <xref:System.Windows.Controls.Primitives.ButtonBase.Click> of its content, even if the user clicks on pixels that are technically part of the image.</span></span>

<span data-ttu-id="ba041-131">**Points d’attachement d’un même gestionnaire** : Dans [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)], vous devez attacher le même gestionnaire plusieurs fois pour traiter les événements qui peuvent être déclenchés par plusieurs éléments.</span><span class="sxs-lookup"><span data-stu-id="ba041-131">**Singular handler attachment points:** In [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)], you would have to attach the same handler multiple times to process events that could be raised from multiple elements.</span></span> <span data-ttu-id="ba041-132">Les événements routés vous permettent d’attacher ce gestionnaire une seule fois, comme dans l’exemple précédent, et d’utiliser la logique du gestionnaire pour déterminer d’où provient l’événement, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="ba041-132">Routed events enable you to attach that handler only once, as was shown in the previous example, and use handler logic to determine where the event came from if necessary.</span></span> <span data-ttu-id="ba041-133">Par exemple, ceci pourrait être le gestionnaire du [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] présenté précédemment :</span><span class="sxs-lookup"><span data-stu-id="ba041-133">For instance, this might be the handler for the previously shown [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]:</span></span>

[!code-csharp[EventOvwSupport#GroupButtonCodeBehind](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml.cs#groupbuttoncodebehind)]
[!code-vb[EventOvwSupport#GroupButtonCodeBehind](~/samples/snippets/visualbasic/VS_Snippets_Wpf/EventOvwSupport/visualbasic/default.xaml.vb#groupbuttoncodebehind)]

<span data-ttu-id="ba041-134">**Gestion des classes** : Les événements routés permettent l’utilisation d’un gestionnaire statique défini par la classe.</span><span class="sxs-lookup"><span data-stu-id="ba041-134">**Class handling:** Routed events permit a static handler that is defined by the class.</span></span> <span data-ttu-id="ba041-135">Ce gestionnaire de classe a l’opportunité de gérer un événement avant les autres gestionnaires d’instance attachés.</span><span class="sxs-lookup"><span data-stu-id="ba041-135">This class handler has the opportunity to handle an event before any attached instance handlers can.</span></span>

<span data-ttu-id="ba041-136">**Référencement d’un événement sans réflexion** : Certaines techniques de code et de balisage nécessitent un moyen d’identifier les événements.</span><span class="sxs-lookup"><span data-stu-id="ba041-136">**Referencing an event without reflection:** Certain code and markup techniques require a way to identify a specific event.</span></span> <span data-ttu-id="ba041-137">Un événement routé crée un champ <xref:System.Windows.RoutedEvent> en tant qu’identificateur, ce qui fournit une technique d’identification d’événement robuste qui ne nécessite pas de réflexion statique ou au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="ba041-137">A routed event creates a <xref:System.Windows.RoutedEvent> field as an identifier, which provides a robust event identification technique that does not require static or run-time reflection.</span></span>

### <a name="how-routed-events-are-implemented"></a><span data-ttu-id="ba041-138">Implémentation des événements routés</span><span class="sxs-lookup"><span data-stu-id="ba041-138">How Routed Events Are Implemented</span></span>

<span data-ttu-id="ba041-139">Un événement routé est un événement CLR qui est stocké par une instance de la classe <xref:System.Windows.RoutedEvent> et inscrite auprès du système d’événements [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ba041-139">A routed event is a CLR event that is backed by an instance of the <xref:System.Windows.RoutedEvent> class and registered with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] event system.</span></span> <span data-ttu-id="ba041-140">L’instance <xref:System.Windows.RoutedEvent> obtenue à partir de l’inscription est généralement conservée en tant que `public` `static` `readonly` membre de la classe qui inscrit et par conséquent « possède » l’événement routé.</span><span class="sxs-lookup"><span data-stu-id="ba041-140">The <xref:System.Windows.RoutedEvent> instance obtained from registration is typically retained as a `public` `static` `readonly` field member of the class that registers and thus "owns" the routed event.</span></span> <span data-ttu-id="ba041-141">La connexion à l’événement CLR portant un nom identique (qui est parfois appelé événement « Wrapper ») s’effectue en substituant les implémentations `add` et `remove` pour l’événement CLR.</span><span class="sxs-lookup"><span data-stu-id="ba041-141">The connection to the identically named CLR event (which is sometimes termed the "wrapper" event) is accomplished by overriding the `add` and `remove` implementations for the CLR event.</span></span> <span data-ttu-id="ba041-142">En règle générale, `add` et `remove` sont conservés comme des valeurs implicites par défaut qui utilisent la syntaxe d’événement spécifique au langage pour ajouter et supprimer des gestionnaires de cet événement.</span><span class="sxs-lookup"><span data-stu-id="ba041-142">Ordinarily, the `add` and `remove` are left as an implicit default that uses the appropriate language-specific event syntax for adding and removing handlers of that event.</span></span> <span data-ttu-id="ba041-143">Le mécanisme de connexion et de stockage des événements routés est conceptuellement similaire à la façon dont une propriété de dépendance est une propriété CLR qui est stockée par la classe <xref:System.Windows.DependencyProperty> et inscrite auprès du système de propriétés [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ba041-143">The routed event backing and connection mechanism is conceptually similar to how a dependency property is a CLR property that is backed by the <xref:System.Windows.DependencyProperty> class and registered with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property system.</span></span>

<span data-ttu-id="ba041-144">L’exemple suivant illustre la déclaration d’un événement `Tap` routé personnalisé, y compris l’inscription et l’exposition du champ d’identificateur <xref:System.Windows.RoutedEvent> et les implémentations `add` et `remove` pour l’événement CLR `Tap`.</span><span class="sxs-lookup"><span data-stu-id="ba041-144">The following example shows the declaration for a custom `Tap` routed event, including the registration and exposure of the <xref:System.Windows.RoutedEvent> identifier field and the `add` and `remove` implementations for the `Tap` CLR event.</span></span>

[!code-csharp[RoutedEventCustom#AddRemoveHandler](~/samples/snippets/csharp/VS_Snippets_Wpf/RoutedEventCustom/CSharp/SDKSampleLibrary/class1.cs#addremovehandler)]
[!code-vb[RoutedEventCustom#AddRemoveHandler](~/samples/snippets/visualbasic/VS_Snippets_Wpf/RoutedEventCustom/VB/SDKSampleLibrary/Class1.vb#addremovehandler)]

### <a name="routed-event-handlers-and-xaml"></a><span data-ttu-id="ba041-145">Gestionnaires d’événements routés et XAML</span><span class="sxs-lookup"><span data-stu-id="ba041-145">Routed Event Handlers and XAML</span></span>

<span data-ttu-id="ba041-146">Pour ajouter un gestionnaire à un événement à l’aide de [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], déclarez le nom de l’événement en tant qu’attribut sur l’élément qui joue le rôle d’écouteur d’événements.</span><span class="sxs-lookup"><span data-stu-id="ba041-146">To add a handler for an event using [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], you declare the event name as an attribute on the element that is an event listener.</span></span> <span data-ttu-id="ba041-147">La valeur de l’attribut est le nom de votre méthode de gestionnaire implémentée, qui doit se trouver dans la classe partielle du fichier code-behind.</span><span class="sxs-lookup"><span data-stu-id="ba041-147">The value of the attribute is the name of your implemented handler method, which must exist in the partial class of the code-behind file.</span></span>

[!code-xaml[EventOvwSupport#SimplestSyntax](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml#simplestsyntax)]

<span data-ttu-id="ba041-148">La syntaxe [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pour l’ajout de gestionnaires d’événements CLR standard est la même pour l’ajout de gestionnaires d’événements routés, car vous ajoutez véritablement des gestionnaires au wrapper d’événement CLR, qui a une implémentation d’événement routé sous.</span><span class="sxs-lookup"><span data-stu-id="ba041-148">The [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] syntax for adding standard CLR event handlers is the same for adding routed event handlers, because you are really adding handlers to the CLR event wrapper, which has a routed event implementation underneath.</span></span> <span data-ttu-id="ba041-149">Pour plus d’informations sur l’ajout de gestionnaires d’événements dans [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], consultez [Vue d’ensemble du langage XAML (WPF)](../../../desktop-wpf/fundamentals/xaml.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-149">For more information about adding event handlers in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], see [XAML Overview (WPF)](../../../desktop-wpf/fundamentals/xaml.md).</span></span>

<a name="routing_strategies"></a>

## <a name="routing-strategies"></a><span data-ttu-id="ba041-150">Stratégies de routage</span><span class="sxs-lookup"><span data-stu-id="ba041-150">Routing Strategies</span></span>

<span data-ttu-id="ba041-151">Les événements routés utilisent l’une des trois stratégies de routage suivantes :</span><span class="sxs-lookup"><span data-stu-id="ba041-151">Routed events use one of three routing strategies:</span></span>

- <span data-ttu-id="ba041-152">**Propagation** : Les gestionnaires d’événements de la source d’événements sont appelés.</span><span class="sxs-lookup"><span data-stu-id="ba041-152">**Bubbling:** Event handlers on the event source are invoked.</span></span> <span data-ttu-id="ba041-153">L’événement routé est acheminé ensuite vers des éléments parents successifs jusqu’à atteindre la racine de l’arborescence d’éléments.</span><span class="sxs-lookup"><span data-stu-id="ba041-153">The routed event then routes to successive parent elements until reaching the element tree root.</span></span> <span data-ttu-id="ba041-154">La plupart des événements routés utilisent la stratégie de routage par propagation.</span><span class="sxs-lookup"><span data-stu-id="ba041-154">Most routed events use the bubbling routing strategy.</span></span> <span data-ttu-id="ba041-155">Les événements routés par propagation sont généralement utilisés pour signaler des entrées ou des changements d’état à partir de contrôles distincts ou d’autres éléments d’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ba041-155">Bubbling routed events are generally used to report input or state changes from distinct controls or other UI elements.</span></span>

- <span data-ttu-id="ba041-156">**Direct** : Seul l’élément source a l’opportunité d’appeler les gestionnaires en réponse.</span><span class="sxs-lookup"><span data-stu-id="ba041-156">**Direct:** Only the source element itself is given the opportunity to invoke handlers in response.</span></span> <span data-ttu-id="ba041-157">Cela s’apparente au « routage » que [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] utilise pour les événements.</span><span class="sxs-lookup"><span data-stu-id="ba041-157">This is analogous to the "routing" that [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] uses for events.</span></span> <span data-ttu-id="ba041-158">Toutefois, contrairement à un événement CLR standard, les événements routés directs prennent en charge la gestion de classe (la gestion de classe est expliquée dans une section à venir) et peut être utilisée par <xref:System.Windows.EventSetter> et <xref:System.Windows.EventTrigger>.</span><span class="sxs-lookup"><span data-stu-id="ba041-158">However, unlike a standard CLR event, direct routed events support class handling (class handling is explained in an upcoming section) and can be used by <xref:System.Windows.EventSetter> and <xref:System.Windows.EventTrigger>.</span></span>

- <span data-ttu-id="ba041-159">**Tunneling** : Au début, les gestionnaires d’événements situés à la racine de l’arborescence d’éléments sont appelés.</span><span class="sxs-lookup"><span data-stu-id="ba041-159">**Tunneling:** Initially, event handlers at the element tree root are invoked.</span></span> <span data-ttu-id="ba041-160">L’événement routé passe ensuite par des éléments enfants successifs pour aller vers l’élément de nœud correspondant à la source de l’événement routé (l’élément qui a déclenché l’événement routé).</span><span class="sxs-lookup"><span data-stu-id="ba041-160">The routed event then travels a route through successive child elements along the route, towards the node element that is the routed event source (the element that raised the routed event).</span></span> <span data-ttu-id="ba041-161">Les événements routés de tunneling sont souvent utilisés ou gérés dans le cadre de la composition d’un contrôle, de telle manière que les événements issus de parties composites peuvent être délibérément supprimés ou remplacés par des événements spécifiques au contrôle complet.</span><span class="sxs-lookup"><span data-stu-id="ba041-161">Tunneling routed events are often used or handled as part of the compositing for a control, such that events from composite parts can be deliberately suppressed or replaced by events that are specific to the complete control.</span></span> <span data-ttu-id="ba041-162">Les événements d’entrée fournis dans [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] sont souvent implémentés comme une paire tunneling/propagation.</span><span class="sxs-lookup"><span data-stu-id="ba041-162">Input events provided in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] often come implemented as a tunneling/bubbling pair.</span></span> <span data-ttu-id="ba041-163">Les événements de tunneling sont parfois appelés événements Preview en raison d’une convention de nommage utilisée pour les paires.</span><span class="sxs-lookup"><span data-stu-id="ba041-163">Tunneling events are also sometimes referred to as Preview events, because of a naming convention that is used for the pairs.</span></span>

<a name="why_use"></a>

## <a name="why-use-routed-events"></a><span data-ttu-id="ba041-164">Pourquoi utiliser des événements routés ?</span><span class="sxs-lookup"><span data-stu-id="ba041-164">Why Use Routed Events?</span></span>

<span data-ttu-id="ba041-165">En tant que développeur d’applications, il n’est pas toujours nécessaire de savoir que l’événement que vous gérez est implémenté comme un événement routé.</span><span class="sxs-lookup"><span data-stu-id="ba041-165">As an application developer, you do not always need to know or care that the event you are handling is implemented as a routed event.</span></span> <span data-ttu-id="ba041-166">Les événements routés présentent un comportement particulier, mais ce comportement est en grande partie invisible si vous gérez l’événement sur l’élément à partir duquel il a été déclenché.</span><span class="sxs-lookup"><span data-stu-id="ba041-166">Routed events have special behavior, but that behavior is largely invisible if you are handling an event on the element where it is raised.</span></span>

<span data-ttu-id="ba041-167">Les événements routés deviennent puissants lorsqu’ils sont utilisés dans l’un des scénarios suivants : définition de gestionnaires communs au niveau d’une racine commune, composition de votre propre contrôle ou définition de votre propre classe de contrôle personnalisé.</span><span class="sxs-lookup"><span data-stu-id="ba041-167">Where routed events become powerful is if you use any of the suggested scenarios: defining common handlers at a common root, compositing your own control, or defining your own custom control class.</span></span>

<span data-ttu-id="ba041-168">Les écouteurs et les sources d’événements routés n’ont pas besoin de partager un événement commun dans leur hiérarchie.</span><span class="sxs-lookup"><span data-stu-id="ba041-168">Routed event listeners and routed event sources do not need to share a common event in their hierarchy.</span></span> <span data-ttu-id="ba041-169">Tout <xref:System.Windows.UIElement> ou <xref:System.Windows.ContentElement> peut être un écouteur d’événements pour n’importe quel événement routé.</span><span class="sxs-lookup"><span data-stu-id="ba041-169">Any <xref:System.Windows.UIElement> or <xref:System.Windows.ContentElement> can be an event listener for any routed event.</span></span> <span data-ttu-id="ba041-170">Par conséquent, vous pouvez utiliser l’ensemble des événements routés disponibles sur l’ensemble de l’API de travail comme une « interface » conceptuelle qui permet aux éléments disparates de l’application d’échanger des informations sur les événements.</span><span class="sxs-lookup"><span data-stu-id="ba041-170">Therefore, you can use the full set of routed events available throughout the working API set as a conceptual "interface" whereby disparate elements in the application can exchange event information.</span></span> <span data-ttu-id="ba041-171">Ce concept d’« interface » pour les événements routés s’applique plus particulièrement aux événements d’entrée.</span><span class="sxs-lookup"><span data-stu-id="ba041-171">This "interface" concept for routed events is particularly applicable for input events.</span></span>

<span data-ttu-id="ba041-172">Les événements routés peuvent également servir à communiquer au sein de l’arborescence d’éléments, car les données de l’événement sont propagées vers chaque élément rencontré sur l’itinéraire.</span><span class="sxs-lookup"><span data-stu-id="ba041-172">Routed events can also be used to communicate through the element tree, because the event data for the event is perpetuated to each element in the route.</span></span> <span data-ttu-id="ba041-173">Si un élément change les données d’événement, ce changement est disponible pour l’élément suivant dans l’itinéraire.</span><span class="sxs-lookup"><span data-stu-id="ba041-173">One element could change something in the event data, and that change would be available to the next element in the route.</span></span>

<span data-ttu-id="ba041-174">Outre l’aspect de routage, il existe deux autres raisons pour lesquelles un événement [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] donné peut être implémenté comme un événement routé au lieu d’un événement CLR standard.</span><span class="sxs-lookup"><span data-stu-id="ba041-174">Other than the routing aspect, there are two other reasons that any given [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] event might be implemented as a routed event instead of a standard CLR event.</span></span> <span data-ttu-id="ba041-175">Si vous implémentez vos propres événements, vous pouvez également prendre en compte ces principes :</span><span class="sxs-lookup"><span data-stu-id="ba041-175">If you are implementing your own events, you might also consider these principles:</span></span>

- <span data-ttu-id="ba041-176">Certaines fonctionnalités de création de styles et de modèles de [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], comme <xref:System.Windows.EventSetter> et <xref:System.Windows.EventTrigger> requièrent que l’événement référencé soit un événement routé.</span><span class="sxs-lookup"><span data-stu-id="ba041-176">Certain [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] styling and templating features such as <xref:System.Windows.EventSetter> and <xref:System.Windows.EventTrigger> require the referenced event to be a routed event.</span></span> <span data-ttu-id="ba041-177">Il s’agit du scénario d’identificateur d’événement mentionné précédemment.</span><span class="sxs-lookup"><span data-stu-id="ba041-177">This is the event identifier scenario mentioned earlier.</span></span>

- <span data-ttu-id="ba041-178">Les événements routés prennent en charge un mécanisme de gestion de classe par lequel la classe peut spécifier des méthodes statiques qui ont l’opportunité de gérer des événements routés avant que les gestionnaires d’instance inscrits puissent y accéder.</span><span class="sxs-lookup"><span data-stu-id="ba041-178">Routed events support a class handling mechanism whereby the class can specify static methods that have the opportunity to handle routed events before any registered instance handlers can access them.</span></span> <span data-ttu-id="ba041-179">Ceci est très utile pour la conception de contrôles, car la classe peut appliquer des comportements de classe pilotés par les événements qui ne peuvent pas être supprimés par inadvertance lorsque vous gérez un événement sur une instance.</span><span class="sxs-lookup"><span data-stu-id="ba041-179">This is very useful in control design, because your class can enforce event-driven class behaviors that cannot be accidentally suppressed by handling an event on an instance.</span></span>

<span data-ttu-id="ba041-180">Toutes les considérations ci-dessus sont abordées dans une autre section de cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="ba041-180">Each of the above considerations is discussed in a separate section of this topic.</span></span>

<a name="event_handing"></a>

## <a name="adding-and-implementing-an-event-handler-for-a-routed-event"></a><span data-ttu-id="ba041-181">Ajout et implémentation d’un gestionnaire d’événements pour un événement routé</span><span class="sxs-lookup"><span data-stu-id="ba041-181">Adding and Implementing an Event Handler for a Routed Event</span></span>

<span data-ttu-id="ba041-182">Pour ajouter un gestionnaire d’événements dans [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], ajoutez le nom de l’événement à un élément en tant qu’attribut, et définissez la valeur de l’attribut sur le nom du gestionnaire d’événements qui implémente un délégué, comme dans l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="ba041-182">To add an event handler in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], you simply add the event name to an element as an attribute and set the attribute value as the name of the event handler that implements an appropriate delegate, as in the following example.</span></span>

[!code-xaml[EventOvwSupport#SimplestSyntax](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml#simplestsyntax)]

<span data-ttu-id="ba041-183">`b1SetColor` est le nom du gestionnaire implémenté qui contient le code qui gère l’événement <xref:System.Windows.Controls.Primitives.ButtonBase.Click>.</span><span class="sxs-lookup"><span data-stu-id="ba041-183">`b1SetColor` is the name of the implemented handler that contains the code that handles the <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event.</span></span> <span data-ttu-id="ba041-184">`b1SetColor` doit avoir la même signature que le délégué <xref:System.Windows.RoutedEventHandler>, qui est le délégué de gestionnaire d’événements pour l’événement <xref:System.Windows.Controls.Primitives.ButtonBase.Click>.</span><span class="sxs-lookup"><span data-stu-id="ba041-184">`b1SetColor` must have the same signature as the <xref:System.Windows.RoutedEventHandler> delegate, which is the event handler delegate for the <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event.</span></span> <span data-ttu-id="ba041-185">Le premier paramètre de tous les délégués de gestionnaires d’événements routés spécifie l’élément auquel le gestionnaire d’événements est ajouté, et le deuxième paramètre spécifie les données de l’événement.</span><span class="sxs-lookup"><span data-stu-id="ba041-185">The first parameter of all routed event handler delegates specifies the element to which the event handler is added, and the second parameter specifies the data for the event.</span></span>

[!code-csharp[EventOvwSupport#SimpleHandlerA](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml.cs#simplehandlera)]
[!code-vb[EventOvwSupport#SimpleHandlerA](~/samples/snippets/visualbasic/VS_Snippets_Wpf/EventOvwSupport/visualbasic/default.xaml.vb#simplehandlera)]

<span data-ttu-id="ba041-186"><xref:System.Windows.RoutedEventHandler> est le délégué de gestionnaire d’événements routés de base.</span><span class="sxs-lookup"><span data-stu-id="ba041-186"><xref:System.Windows.RoutedEventHandler> is the basic routed event handler delegate.</span></span> <span data-ttu-id="ba041-187">Pour les événements routés qui conviennent spécialement à certains contrôles ou scénarios, les délégués à utiliser avec les gestionnaires d’événements routés peuvent également devenir plus spécialisés, de manière à pouvoir transmettre des données d’événement spécialisées.</span><span class="sxs-lookup"><span data-stu-id="ba041-187">For routed events that are specialized for certain controls or scenarios, the delegates to use for the routed event handlers also might become more specialized, so that they can transmit specialized event data.</span></span> <span data-ttu-id="ba041-188">Par exemple, dans un scénario d’entrée courant, vous pouvez gérer un événement routé <xref:System.Windows.UIElement.DragEnter>.</span><span class="sxs-lookup"><span data-stu-id="ba041-188">For instance, in a common input scenario, you might handle a <xref:System.Windows.UIElement.DragEnter> routed event.</span></span> <span data-ttu-id="ba041-189">Votre gestionnaire doit implémenter le délégué <xref:System.Windows.DragEventHandler>.</span><span class="sxs-lookup"><span data-stu-id="ba041-189">Your handler should implement the <xref:System.Windows.DragEventHandler> delegate.</span></span> <span data-ttu-id="ba041-190">En utilisant le délégué le plus spécifique, vous pouvez traiter les <xref:System.Windows.DragEventArgs> dans le gestionnaire et lire la propriété <xref:System.Windows.DragEventArgs.Data%2A>, qui contient la charge utile du presse-papiers de l’opération glisser.</span><span class="sxs-lookup"><span data-stu-id="ba041-190">By using the most specific delegate, you can process the <xref:System.Windows.DragEventArgs> in the handler and read the <xref:System.Windows.DragEventArgs.Data%2A> property, which contains the clipboard payload of the drag operation.</span></span>

<span data-ttu-id="ba041-191">Pour un exemple complet montrant comment ajouter un gestionnaire d’événements à un élément à l’aide de [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], consultez [Gérer un événement routé](how-to-handle-a-routed-event.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-191">For a complete example of how to add an event handler to an element using [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], see [Handle a Routed Event](how-to-handle-a-routed-event.md).</span></span>

<span data-ttu-id="ba041-192">L’ajout d’un gestionnaire pour un événement routé dans une application créée dans du code est une opération simple.</span><span class="sxs-lookup"><span data-stu-id="ba041-192">Adding a handler for a routed event in an application that is created in code is straightforward.</span></span> <span data-ttu-id="ba041-193">Les gestionnaires d’événements routés peuvent toujours être ajoutés par le biais d’une méthode d’assistance <xref:System.Windows.UIElement.AddHandler%2A> (qui est la même méthode que celle qui est appelée par le stockage existant pour `add`.) Toutefois, les événements routés [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] existants ont généralement des implémentations de stockage de `add` et de `remove` logique qui autorisent l’ajout des gestionnaires pour les événements routés par une syntaxe d’événement spécifique au langage, qui est plus intuitive que la méthode d’assistance.</span><span class="sxs-lookup"><span data-stu-id="ba041-193">Routed event handlers can always be added through a helper method <xref:System.Windows.UIElement.AddHandler%2A> (which is the same method that the existing backing calls for `add`.) However, existing [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] routed events generally have backing implementations of `add` and `remove` logic that allow the handlers for routed events to be added by a language-specific event syntax, which is more intuitive syntax than the helper method.</span></span> <span data-ttu-id="ba041-194">Voici un exemple d’utilisation de la méthode d’assistance :</span><span class="sxs-lookup"><span data-stu-id="ba041-194">The following is an example usage of the helper method:</span></span>

[!code-csharp[EventOvwSupport#AddHandlerCode](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml.cs#addhandlercode)]
[!code-vb[EventOvwSupport#AddHandlerCode](~/samples/snippets/visualbasic/VS_Snippets_Wpf/EventOvwSupport/visualbasic/default.xaml.vb#addhandlercode)]

<span data-ttu-id="ba041-195">L’exemple suivant illustre la C# syntaxe de l’opérateur (Visual Basic a une syntaxe d’opérateur légèrement différente en raison de la gestion du déréférencement) :</span><span class="sxs-lookup"><span data-stu-id="ba041-195">The next example shows the C# operator syntax (Visual Basic has slightly different operator syntax because of its handling of dereferencing):</span></span>

[!code-csharp[EventOvwSupport#AddHandlerPlusEquals](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml.cs#addhandlerplusequals)]
[!code-vb[EventOvwSupport#AddHandlerPlusEquals](~/samples/snippets/visualbasic/VS_Snippets_Wpf/EventOvwSupport/visualbasic/default.xaml.vb#addhandlerplusequals)]

<span data-ttu-id="ba041-196">Pour obtenir un exemple montrant comment ajouter un gestionnaire d’événements dans le code, consultez [Ajouter un gestionnaire d’événements à l’aide de code](how-to-add-an-event-handler-using-code.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-196">For an example of how to add an event handler in code, see [Add an Event Handler Using Code](how-to-add-an-event-handler-using-code.md).</span></span>

<span data-ttu-id="ba041-197">Si vous utilisez Visual Basic, vous pouvez également utiliser le mot clé `Handles` pour ajouter des gestionnaires dans le cadre des déclarations de gestionnaire.</span><span class="sxs-lookup"><span data-stu-id="ba041-197">If you are using Visual Basic, you can also use the `Handles` keyword to add handlers as part of the handler declarations.</span></span> <span data-ttu-id="ba041-198">Pour plus d’informations, consultez [Gestion des événements Visual Basic et WPF](visual-basic-and-wpf-event-handling.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-198">For more information, see [Visual Basic and WPF Event Handling](visual-basic-and-wpf-event-handling.md).</span></span>

<a name="concept_handled"></a>

### <a name="the-concept-of-handled"></a><span data-ttu-id="ba041-199">Concept du Handled</span><span class="sxs-lookup"><span data-stu-id="ba041-199">The Concept of Handled</span></span>

<span data-ttu-id="ba041-200">Tous les événements routés partagent une classe de base de données d’événements commune, <xref:System.Windows.RoutedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="ba041-200">All routed events share a common event data base class, <xref:System.Windows.RoutedEventArgs>.</span></span> <span data-ttu-id="ba041-201"><xref:System.Windows.RoutedEventArgs> définit la propriété <xref:System.Windows.RoutedEventArgs.Handled%2A>, qui prend une valeur booléenne.</span><span class="sxs-lookup"><span data-stu-id="ba041-201"><xref:System.Windows.RoutedEventArgs> defines the <xref:System.Windows.RoutedEventArgs.Handled%2A> property, which takes a Boolean value.</span></span> <span data-ttu-id="ba041-202">L’objectif de la propriété <xref:System.Windows.RoutedEventArgs.Handled%2A> est de permettre à n’importe quel gestionnaire d’événements sur l’itinéraire de marquer l’événement routé comme *géré*, en définissant la valeur de <xref:System.Windows.RoutedEventArgs.Handled%2A> sur `true`.</span><span class="sxs-lookup"><span data-stu-id="ba041-202">The purpose of the <xref:System.Windows.RoutedEventArgs.Handled%2A> property is to enable any event handler along the route to mark the routed event as *handled*, by setting the value of <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true`.</span></span> <span data-ttu-id="ba041-203">Après avoir été traitées par le gestionnaire au niveau d’un élément de l’itinéraire, les données d’événement partagées sont à nouveau signalées à chaque écouteur se trouvant sur l’itinéraire.</span><span class="sxs-lookup"><span data-stu-id="ba041-203">After being processed by the handler at one element along the route, the shared event data is again reported to each listener along the route.</span></span>

<span data-ttu-id="ba041-204">La valeur de <xref:System.Windows.RoutedEventArgs.Handled%2A> a une incidence sur la façon dont un événement routé est signalé ou traité à mesure qu’il transite dans l’itinéraire.</span><span class="sxs-lookup"><span data-stu-id="ba041-204">The value of <xref:System.Windows.RoutedEventArgs.Handled%2A> affects how a routed event is reported or processed as it travels further along the route.</span></span> <span data-ttu-id="ba041-205">Si <xref:System.Windows.RoutedEventArgs.Handled%2A> est `true` dans les données d’événement pour un événement routé, les gestionnaires qui écoutent cet événement routé sur d’autres éléments ne sont généralement plus appelés pour cette instance d’événement particulière.</span><span class="sxs-lookup"><span data-stu-id="ba041-205">If <xref:System.Windows.RoutedEventArgs.Handled%2A> is `true` in the event data for a routed event, then handlers that listen for that routed event on other elements are generally no longer invoked for that particular event instance.</span></span> <span data-ttu-id="ba041-206">Ceci est vrai à la fois pour les gestionnaires attachés dans [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] et pour ceux ajoutés par des syntaxes d’attachement de gestionnaire d’événements spécifiques au langage, comme `+=` ou `Handles`.</span><span class="sxs-lookup"><span data-stu-id="ba041-206">This is true both for handlers attached in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] and for handlers added by language-specific event handler attachment syntaxes such as `+=` or `Handles`.</span></span> <span data-ttu-id="ba041-207">Pour la plupart des scénarios de gestionnaires courants, le marquage d’un événement comme étant géré en affectant à <xref:System.Windows.RoutedEventArgs.Handled%2A> la valeur `true` « arrêter » le routage pour un itinéraire de tunneling ou un itinéraire de propagation, ainsi que pour tout événement géré à un point de l’itinéraire par un gestionnaire de classe.</span><span class="sxs-lookup"><span data-stu-id="ba041-207">For most common handler scenarios, marking an event as handled by setting <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true` will "stop" routing for either a tunneling route or a bubbling route, and also for any event that is handled at a point in the route by a class handler.</span></span>

<span data-ttu-id="ba041-208">Toutefois, il existe un mécanisme « handledEventsToo » dans lequel les écouteurs peuvent toujours exécuter des gestionnaires en réponse à des événements routés où <xref:System.Windows.RoutedEventArgs.Handled%2A> est `true` dans les données d’événement.</span><span class="sxs-lookup"><span data-stu-id="ba041-208">However, there is a "handledEventsToo" mechanism whereby listeners can still run handlers in response to routed events where <xref:System.Windows.RoutedEventArgs.Handled%2A> is `true` in the event data.</span></span> <span data-ttu-id="ba041-209">En d’autres termes, l’itinéraire d’événement n’est pas réellement arrêté quand les données d’événement sont marquées comme gérées.</span><span class="sxs-lookup"><span data-stu-id="ba041-209">In other words, the event route is not truly stopped by marking the event data as handled.</span></span> <span data-ttu-id="ba041-210">Vous pouvez uniquement utiliser le mécanisme handledEventsToo dans le code ou dans un <xref:System.Windows.EventSetter>:</span><span class="sxs-lookup"><span data-stu-id="ba041-210">You can only use the handledEventsToo mechanism in code, or in an <xref:System.Windows.EventSetter>:</span></span>

- <span data-ttu-id="ba041-211">Dans le code, au lieu d’utiliser une syntaxe d’événement spécifique au langage qui fonctionne pour les événements généraux du CLR, appelez la méthode [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.UIElement.AddHandler%28System.Windows.RoutedEvent%2CSystem.Delegate%2CSystem.Boolean%29> pour ajouter votre gestionnaire.</span><span class="sxs-lookup"><span data-stu-id="ba041-211">In code, instead of using a language-specific event syntax that works for general CLR events, call the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] method <xref:System.Windows.UIElement.AddHandler%28System.Windows.RoutedEvent%2CSystem.Delegate%2CSystem.Boolean%29> to add your handler.</span></span> <span data-ttu-id="ba041-212">Définissez la valeur de `handledEventsToo` sur `true`.</span><span class="sxs-lookup"><span data-stu-id="ba041-212">Specify the value of `handledEventsToo` as `true`.</span></span>

- <span data-ttu-id="ba041-213">Dans un <xref:System.Windows.EventSetter>, définissez l’attribut <xref:System.Windows.EventSetter.HandledEventsToo%2A> sur `true`.</span><span class="sxs-lookup"><span data-stu-id="ba041-213">In an <xref:System.Windows.EventSetter>, set the <xref:System.Windows.EventSetter.HandledEventsToo%2A> attribute to be `true`.</span></span>

<span data-ttu-id="ba041-214">Outre le comportement que <xref:System.Windows.RoutedEventArgs.Handled%2A> État produit dans les événements routés, le concept de <xref:System.Windows.RoutedEventArgs.Handled%2A> a des implications pour la conception de votre application et l’écriture du code du gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="ba041-214">In addition to the behavior that <xref:System.Windows.RoutedEventArgs.Handled%2A> state produces in routed events, the concept of <xref:System.Windows.RoutedEventArgs.Handled%2A> has implications for how you should design your application and write the event handler code.</span></span> <span data-ttu-id="ba041-215">Vous pouvez conceptualiser <xref:System.Windows.RoutedEventArgs.Handled%2A> comme un protocole simple exposé par les événements routés.</span><span class="sxs-lookup"><span data-stu-id="ba041-215">You can conceptualize <xref:System.Windows.RoutedEventArgs.Handled%2A> as being a simple protocol that is exposed by routed events.</span></span> <span data-ttu-id="ba041-216">La façon dont vous utilisez ce protocole dépend de vous, mais la conception conceptuelle de la façon dont la valeur de <xref:System.Windows.RoutedEventArgs.Handled%2A> est destinée à être utilisée est la suivante :</span><span class="sxs-lookup"><span data-stu-id="ba041-216">Exactly how you use this protocol is up to you, but the conceptual design for how the value of <xref:System.Windows.RoutedEventArgs.Handled%2A> is intended to be used is as follows:</span></span>

- <span data-ttu-id="ba041-217">Si un événement routé est marqué comme géré, il n’a pas besoin d’être géré de nouveau par d’autres éléments sur l’itinéraire.</span><span class="sxs-lookup"><span data-stu-id="ba041-217">If a routed event is marked as handled, then it does not need to be handled again by other elements along that route.</span></span>

- <span data-ttu-id="ba041-218">Si un événement routé n’est pas marqué comme géré, alors les autres écouteurs qui étaient antérieurs le long de l’itinéraire ont choisi de ne pas inscrire de gestionnaire, ou les gestionnaires qui ont été inscrits choisissent de ne pas manipuler les données d’événement et de définir <xref:System.Windows.RoutedEventArgs.Handled%2A> sur `true`.</span><span class="sxs-lookup"><span data-stu-id="ba041-218">If a routed event is not marked as handled, then other listeners that were earlier along the route have chosen either not to register a handler, or the handlers that were registered chose not to manipulate the event data and set <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true`.</span></span> <span data-ttu-id="ba041-219">(Ou, il est bien sûr possible que l’écouteur actuel soit le premier point de l’itinéraire.) Les gestionnaires de l’écouteur actuel possèdent désormais trois cours d’action possibles :</span><span class="sxs-lookup"><span data-stu-id="ba041-219">(Or, it is of course possible that the current listener is the first point in the route.) Handlers on the current listener now have three possible courses of action:</span></span>

  - <span data-ttu-id="ba041-220">Ne rien faire. L’événement reste non géré et l’événement est dirigé vers l’écouteur suivant.</span><span class="sxs-lookup"><span data-stu-id="ba041-220">Take no action at all; the event remains unhandled, and the event routes to the next listener.</span></span>

  - <span data-ttu-id="ba041-221">Exécuter du code en réponse à l’événement, mais décider que l’action entreprise n’était pas suffisamment importante pour garantir le marquage de l’événement comme géré.</span><span class="sxs-lookup"><span data-stu-id="ba041-221">Execute code in response to the event, but make the determination that the action taken was not substantial enough to warrant marking the event as handled.</span></span> <span data-ttu-id="ba041-222">L’événement est dirigé vers l’écouteur suivant.</span><span class="sxs-lookup"><span data-stu-id="ba041-222">The event routes to the next listener.</span></span>

  - <span data-ttu-id="ba041-223">Exécuter du code en réponse à l’événement.</span><span class="sxs-lookup"><span data-stu-id="ba041-223">Execute code in response to the event.</span></span> <span data-ttu-id="ba041-224">Marquer l’événement comme géré dans les données d’événement passées au gestionnaire, car l’action entreprise est jugée suffisamment importante pour garantir le marquage de l’événement comme géré.</span><span class="sxs-lookup"><span data-stu-id="ba041-224">Mark the event as handled in the event data passed to the handler, because the action taken was deemed substantial enough to warrant marking as handled.</span></span> <span data-ttu-id="ba041-225">L’événement est encore routé vers l’écouteur suivant, mais avec <xref:System.Windows.RoutedEventArgs.Handled%2A>=`true` dans ses données d’événement, seuls les écouteurs `handledEventsToo` ont la possibilité d’appeler d’autres gestionnaires.</span><span class="sxs-lookup"><span data-stu-id="ba041-225">The event still routes to the next listener, but with <xref:System.Windows.RoutedEventArgs.Handled%2A>=`true` in its event data, so only `handledEventsToo` listeners have the opportunity to invoke further handlers.</span></span>

<span data-ttu-id="ba041-226">Cette conception conceptuelle est renforcée par le comportement de routage mentionné précédemment : il est plus difficile (bien que possible dans le code ou les styles) d’attacher des gestionnaires pour les événements routés qui sont appelés même si un gestionnaire précédent le long de l’itinéraire a déjà défini <xref:System.Windows.RoutedEventArgs.Handled%2A> pour `true`.</span><span class="sxs-lookup"><span data-stu-id="ba041-226">This conceptual design is reinforced by the routing behavior mentioned earlier: it is more difficult (although still possible in code or styles) to attach handlers for routed events that are invoked even if a previous handler along the route has already set <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true`.</span></span>

<span data-ttu-id="ba041-227">Pour plus d’informations sur les <xref:System.Windows.RoutedEventArgs.Handled%2A>, la gestion de classe des événements routés et des recommandations sur le moment où il convient de marquer un événement routé comme <xref:System.Windows.RoutedEventArgs.Handled%2A>, consultez [marquage des événements routés comme gérés et gestion de classe](marking-routed-events-as-handled-and-class-handling.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-227">For more information about <xref:System.Windows.RoutedEventArgs.Handled%2A>, class handling of routed events, and recommendations about when it is appropriate to mark a routed event as <xref:System.Windows.RoutedEventArgs.Handled%2A>, see [Marking Routed Events as Handled, and Class Handling](marking-routed-events-as-handled-and-class-handling.md).</span></span>

<span data-ttu-id="ba041-228">Dans les applications, il est assez courant de gérer un événement routé par propagation sur l’objet qui l’a déclenché, sans se soucier des caractéristiques de routage de l’événement.</span><span class="sxs-lookup"><span data-stu-id="ba041-228">In applications, it is quite common to just handle a bubbling routed event on the object that raised it, and not be concerned with the event's routing characteristics at all.</span></span> <span data-ttu-id="ba041-229">Toutefois, il est recommandé de toujours marquer l’événement routé comme géré (handled) dans les données d’événement, afin d’éviter des effets secondaires si un élément situé plus haut dans l’arborescence d’éléments comportait également un gestionnaire attaché pour le même événement routé.</span><span class="sxs-lookup"><span data-stu-id="ba041-229">However, it is still a good practice to mark the routed event as handled in the event data, to prevent unanticipated side effects just in case an element that is further up the element tree also has a handler attached for that same routed event.</span></span>

<a name="class_handlers"></a>

## <a name="class-handlers"></a><span data-ttu-id="ba041-230">Gestionnaires de classe</span><span class="sxs-lookup"><span data-stu-id="ba041-230">Class Handlers</span></span>

<span data-ttu-id="ba041-231">Si vous définissez une classe qui dérive d’une certaine façon de <xref:System.Windows.DependencyObject>, vous pouvez également définir et attacher un gestionnaire de classe pour un événement routé qui est un membre d’événement déclaré ou hérité de votre classe.</span><span class="sxs-lookup"><span data-stu-id="ba041-231">If you are defining a class that derives in some way from <xref:System.Windows.DependencyObject>, you can also define and attach a class handler for a routed event that is a declared or inherited event member of your class.</span></span> <span data-ttu-id="ba041-232">Les gestionnaires de classe sont appelés avant les gestionnaires d’écouteur d’instance qui sont attachés à une instance de cette classe, chaque fois qu’un événement routé atteint une instance d’élément sur son itinéraire.</span><span class="sxs-lookup"><span data-stu-id="ba041-232">Class handlers are invoked before any instance listener handlers that are attached to an instance of that class, whenever a routed event reaches an element instance in its route.</span></span>

<span data-ttu-id="ba041-233">Certains contrôles [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] disposent d’une gestion de classe inhérente pour certains événements routés.</span><span class="sxs-lookup"><span data-stu-id="ba041-233">Some [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] controls have inherent class handling for certain routed events.</span></span> <span data-ttu-id="ba041-234">Ceci peut donner l’apparence que l’événement routé n’a même pas été déclenché, alors qu’en réalité il est géré par la classe, et peut encore potentiellement être géré par vos gestionnaires d’instance si vous utilisez certaines techniques.</span><span class="sxs-lookup"><span data-stu-id="ba041-234">This might give the outward appearance that the routed event is not ever raised, but in reality it is being class handled, and the routed event can potentially still be handled by your instance handlers if you use certain techniques.</span></span> <span data-ttu-id="ba041-235">En outre, plusieurs classes et contrôles de base exposent des méthodes virtuelles qui peuvent être utilisées pour substituer le comportement de gestion de classe.</span><span class="sxs-lookup"><span data-stu-id="ba041-235">Also, many base classes and controls expose virtual methods that can be used to override class handling behavior.</span></span> <span data-ttu-id="ba041-236">Pour plus d’informations sur la façon de contourner la gestion de classe et sur la définition de votre propre gestion de classe dans une classe personnalisée, consultez [Marquage des événements routés comme gérés et gestion de classe](marking-routed-events-as-handled-and-class-handling.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-236">For more information both on how to work around undesired class handling and on defining your own class handling in a custom class, see [Marking Routed Events as Handled, and Class Handling](marking-routed-events-as-handled-and-class-handling.md).</span></span>

<a name="attached_events"></a>

## <a name="attached-events-in-wpf"></a><span data-ttu-id="ba041-237">Événements attachés dans WPF</span><span class="sxs-lookup"><span data-stu-id="ba041-237">Attached Events in WPF</span></span>

<span data-ttu-id="ba041-238">Le langage [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] définit également un type particulier d’événement appelé *événement attaché*.</span><span class="sxs-lookup"><span data-stu-id="ba041-238">The [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] language also defines a special type of event called an *attached event*.</span></span> <span data-ttu-id="ba041-239">Un événement attaché permet d’ajouter le gestionnaire d’un événement particulier à un élément arbitraire.</span><span class="sxs-lookup"><span data-stu-id="ba041-239">An attached event enables you to add a handler for a particular event to an arbitrary element.</span></span> <span data-ttu-id="ba041-240">L’élément qui gère l’événement n’a pas besoin de définir ou d’hériter de l’événement attaché. En outre, ni l’objet qui déclenche potentiellement l’événement, ni l’instance de gestion de destination ne doivent définir ou « posséder » cet événement comme un membre de classe.</span><span class="sxs-lookup"><span data-stu-id="ba041-240">The element handling the event need not define or inherit the attached event, and neither the object potentially raising the event nor the destination handling instance must define or otherwise "own" that event as a class member.</span></span>

<span data-ttu-id="ba041-241">Le système d’entrée [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] utilise largement les événements attachés.</span><span class="sxs-lookup"><span data-stu-id="ba041-241">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] input system uses attached events extensively.</span></span> <span data-ttu-id="ba041-242">Cependant, presque tous ces événements attachés sont transférés via des éléments de base.</span><span class="sxs-lookup"><span data-stu-id="ba041-242">However, nearly all of these attached events are forwarded through base elements.</span></span> <span data-ttu-id="ba041-243">Les événements d’entrée apparaissent alors comme des événements routés non attachés équivalents qui sont membres de la classe d’élément de base.</span><span class="sxs-lookup"><span data-stu-id="ba041-243">The input events then appear as equivalent non-attached routed events that are members of the base element class.</span></span> <span data-ttu-id="ba041-244">Par exemple, l’événement attaché sous-jacent <xref:System.Windows.Input.Mouse.MouseDown?displayProperty=nameWithType> peut être géré plus facilement sur une <xref:System.Windows.UIElement> donnée à l’aide de <xref:System.Windows.UIElement.MouseDown> sur ce <xref:System.Windows.UIElement> plutôt que de gérer la syntaxe d’événement attaché dans [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] ou dans le code.</span><span class="sxs-lookup"><span data-stu-id="ba041-244">For instance, the underlying attached event <xref:System.Windows.Input.Mouse.MouseDown?displayProperty=nameWithType> can more easily be handled on any given <xref:System.Windows.UIElement> by using <xref:System.Windows.UIElement.MouseDown> on that <xref:System.Windows.UIElement> rather than dealing with attached event syntax either in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] or code.</span></span>

<span data-ttu-id="ba041-245">Pour plus d’informations sur les événements attachés dans [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], consultez [Vue d’ensemble des événements attachés](attached-events-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-245">For more information about attached events in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], see [Attached Events Overview](attached-events-overview.md).</span></span>

<a name="Qualifying_Event_Names_in_XAML_for_Anticipated_Routing"></a>

## <a name="qualified-event-names-in-xaml"></a><span data-ttu-id="ba041-246">Noms qualifiés d’événements en XAML</span><span class="sxs-lookup"><span data-stu-id="ba041-246">Qualified Event Names in XAML</span></span>

<span data-ttu-id="ba041-247">Une autre utilisation de la syntaxe qui ressemble à la syntaxe d’événement attaché *typename*.*eventname*, mais qui n’est pas à proprement parler une utilisation d’événement attaché est lorsque vous attachez des gestionnaires pour les événements routés qui sont déclenchés par des éléments enfants.</span><span class="sxs-lookup"><span data-stu-id="ba041-247">Another syntax usage that resembles *typename*.*eventname* attached event syntax but is not strictly speaking an attached event usage is when you attach handlers for routed events that are raised by child elements.</span></span> <span data-ttu-id="ba041-248">Vous attachez les gestionnaires à un parent commun pour tirer parti du routage d’événements, même si le parent commun ne dispose pas de l’événement routé nécessaire comme membre.</span><span class="sxs-lookup"><span data-stu-id="ba041-248">You attach the handlers to a common parent, to take advantage of event routing, even though the common parent might not have the relevant routed event as a member.</span></span> <span data-ttu-id="ba041-249">Regardons de nouveau cet exemple :</span><span class="sxs-lookup"><span data-stu-id="ba041-249">Consider this example again:</span></span>

[!code-xaml[EventOvwSupport#GroupButton](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/default.xaml#groupbutton)]

<span data-ttu-id="ba041-250">Ici, l’écouteur d’élément parent où le gestionnaire est ajouté est un <xref:System.Windows.Controls.StackPanel>.</span><span class="sxs-lookup"><span data-stu-id="ba041-250">Here, the parent element listener where the handler is added is a <xref:System.Windows.Controls.StackPanel>.</span></span> <span data-ttu-id="ba041-251">Toutefois, il ajoute un gestionnaire pour un événement routé qui a été déclaré et sera déclenché par la classe <xref:System.Windows.Controls.Button> (<xref:System.Windows.Controls.Primitives.ButtonBase> en fait, mais disponible pour <xref:System.Windows.Controls.Button> par héritage).</span><span class="sxs-lookup"><span data-stu-id="ba041-251">However, it is adding a handler for a routed event that was declared and will be raised by the <xref:System.Windows.Controls.Button> class (<xref:System.Windows.Controls.Primitives.ButtonBase> actually, but available to <xref:System.Windows.Controls.Button> through inheritance).</span></span> <span data-ttu-id="ba041-252"><xref:System.Windows.Controls.Button> « est propriétaire » de l’événement, mais le système d’événement routé autorise les gestionnaires pour tous les événements routés à être attachés à n’importe quel écouteur d’instance <xref:System.Windows.UIElement> ou <xref:System.Windows.ContentElement> qui pourrait, par ailleurs, attacher des écouteurs pour un événement common language runtime (CLR).</span><span class="sxs-lookup"><span data-stu-id="ba041-252"><xref:System.Windows.Controls.Button> "owns" the event, but the routed event system permits handlers for any routed event to be attached to any <xref:System.Windows.UIElement> or <xref:System.Windows.ContentElement> instance listener that could otherwise attach listeners for a common language runtime (CLR) event.</span></span> <span data-ttu-id="ba041-253">L’espace de noms xmlns par défaut pour ces noms d’attributs d’événement qualifiés est généralement l’espace de noms xmlns [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] par défaut. Cependant, vous pouvez spécifier des espaces de noms avec préfixe pour les événements routés personnalisés.</span><span class="sxs-lookup"><span data-stu-id="ba041-253">The default xmlns namespace for these qualified event attribute names is typically the default [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] xmlns namespace, but you can also specify prefixed namespaces for custom routed events.</span></span> <span data-ttu-id="ba041-254">Pour plus d’informations sur xmlns, consultez [Espaces de noms XAML et mappage d’espace de noms pour XAML WPF](xaml-namespaces-and-namespace-mapping-for-wpf-xaml.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-254">For more information about xmlns, see [XAML Namespaces and Namespace Mapping for WPF XAML](xaml-namespaces-and-namespace-mapping-for-wpf-xaml.md).</span></span>

<a name="how_event_processing_works"></a>

## <a name="wpf-input-events"></a><span data-ttu-id="ba041-255">Événements d’entrée WPF</span><span class="sxs-lookup"><span data-stu-id="ba041-255">WPF Input Events</span></span>

<span data-ttu-id="ba041-256">Les événements routés sont fréquemment utilisés dans la plateforme [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] pour les événements d’entrée.</span><span class="sxs-lookup"><span data-stu-id="ba041-256">One frequent application of routed events within the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] platform is for input events.</span></span> <span data-ttu-id="ba041-257">Par convention, dans [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], les noms d’événements routés par tunneling comprennent le préfixe « Preview ».</span><span class="sxs-lookup"><span data-stu-id="ba041-257">In [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], tunneling routed events names are prefixed with the word "Preview" by convention.</span></span> <span data-ttu-id="ba041-258">Les événements d’entrée vont souvent par paires, l’un étant l’événement de propagation et l’autre, l’événement de tunneling.</span><span class="sxs-lookup"><span data-stu-id="ba041-258">Input events often come in pairs, with one being the bubbling event and the other being the tunneling event.</span></span> <span data-ttu-id="ba041-259">Par exemple, l’événement <xref:System.Windows.ContentElement.KeyDown> et l’événement <xref:System.Windows.ContentElement.PreviewKeyDown> ont la même signature, le premier étant l’événement d’entrée de propagation et le second étant l’événement d’entrée de tunneling.</span><span class="sxs-lookup"><span data-stu-id="ba041-259">For example, the <xref:System.Windows.ContentElement.KeyDown> event and the <xref:System.Windows.ContentElement.PreviewKeyDown> event have the same signature, with the former being the bubbling input event and the latter being the tunneling input event.</span></span> <span data-ttu-id="ba041-260">Parfois, les événements d’entrée ont uniquement une version par propagation, ou uniquement une version à routage direct.</span><span class="sxs-lookup"><span data-stu-id="ba041-260">Occasionally, input events only have a bubbling version, or perhaps only a direct routed version.</span></span> <span data-ttu-id="ba041-261">Dans la documentation, les rubriques relatives aux événements routés font référence à des événements routés similaires avec d’autres stratégies de routage, et les sections des pages concernant les références managées expliquent plus en détail la stratégie de routage de chaque événement routé.</span><span class="sxs-lookup"><span data-stu-id="ba041-261">In the documentation, routed event topics cross-reference similar routed events with alternative routing strategies if such routed events exist, and sections in the managed reference pages clarify the routing strategy of each routed event.</span></span>

<span data-ttu-id="ba041-262">Les événements d’entrée [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] fournis par paires sont implémentés de telle sorte qu’une seule opération d’entrée, comme un clic de souris, déclenche les deux événements de la paire l’un après l’autre.</span><span class="sxs-lookup"><span data-stu-id="ba041-262">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] input events that come in pairs are implemented so that a single user action from input, such as a mouse button press, will raise both routed events of the pair in sequence.</span></span> <span data-ttu-id="ba041-263">Tout d’abord, l’événement de tunneling est déclenché et suit son itinéraire.</span><span class="sxs-lookup"><span data-stu-id="ba041-263">First, the tunneling event is raised and travels its route.</span></span> <span data-ttu-id="ba041-264">Ensuite, l’événement de propagation est déclenché et suit son itinéraire.</span><span class="sxs-lookup"><span data-stu-id="ba041-264">Then the bubbling event is raised and travels its route.</span></span> <span data-ttu-id="ba041-265">Les deux événements partagent littéralement la même instance de données d’événement, car le <xref:System.Windows.UIElement.RaiseEvent%2A> appel de méthode dans la classe d’implémentation qui déclenche l’événement de propagation écoute les données d’événement à partir de l’événement de tunneling et les réutilise dans le nouvel événement déclenché.</span><span class="sxs-lookup"><span data-stu-id="ba041-265">The two events literally share the same event data instance, because the <xref:System.Windows.UIElement.RaiseEvent%2A> method call in the implementing class that raises the bubbling event listens for the event data from the tunneling event and reuses it in the new raised event.</span></span> <span data-ttu-id="ba041-266">Les écouteurs qui comportent des gestionnaires pour l’événement de tunneling sont les premiers à pouvoir marquer l’événement routé comme géré (d’abord les gestionnaires de classe, ensuite les gestionnaires d’instance).</span><span class="sxs-lookup"><span data-stu-id="ba041-266">Listeners with handlers for the tunneling event have the first opportunity to mark the routed event handled (class handlers first, then instance handlers).</span></span> <span data-ttu-id="ba041-267">Si un élément a marqué l’événement routé comme géré sur l’itinéraire de tunneling, les données d’événement déjà gérées sont envoyées à l’événement de propagation, et les gestionnaires standard attachés pour les événements d’entrée de propagation équivalents ne sont pas appelés.</span><span class="sxs-lookup"><span data-stu-id="ba041-267">If an element along the tunneling route marked the routed event as handled, the already-handled event data is sent on for the bubbling event, and typical handlers attached for the equivalent bubbling input events will not be invoked.</span></span> <span data-ttu-id="ba041-268">Vu de l’extérieur, il peut sembler que l’événement de propagation géré n’a pas encore été déclenché.</span><span class="sxs-lookup"><span data-stu-id="ba041-268">To outward appearances it will be as if the handled bubbling event has not even been raised.</span></span> <span data-ttu-id="ba041-269">Ce comportement de gestion est utile pour la composition de contrôles, où vous pouvez souhaiter que tous les événements d’entrée basés sur les tests d’atteinte ou le focus soient signalés par votre dernier contrôle, plutôt que par ses parties composites.</span><span class="sxs-lookup"><span data-stu-id="ba041-269">This handling behavior is useful for control compositing, where you might want all hit-test based input events or focus-based input events to be reported by your final control, rather than its composite parts.</span></span> <span data-ttu-id="ba041-270">Le dernier élément de contrôle est plus proche de la racine dans la composition et peut donc être le premier à gérer la classe de l’événement de tunneling et éventuellement à « remplacer » l’événement routé par un événement plus spécifique au contrôle dans le code qui stocke la classe de contrôle.</span><span class="sxs-lookup"><span data-stu-id="ba041-270">The final control element is closer to the root in the compositing, and therefore has the opportunity to class handle the tunneling event first and perhaps to "replace" that routed event with a more control-specific event, as part of the code that backs the control class.</span></span>

<span data-ttu-id="ba041-271">En guise d’illustration du traitement des événements d’entrée, prenez l’exemple d’événement d’entrée suivant.</span><span class="sxs-lookup"><span data-stu-id="ba041-271">As an illustration of how input event processing works, consider the following input event example.</span></span> <span data-ttu-id="ba041-272">Dans l’illustration suivante, `leaf element #2` est la source d’un `PreviewMouseDown` puis d’un événement `MouseDown` :</span><span class="sxs-lookup"><span data-stu-id="ba041-272">In the following tree illustration, `leaf element #2` is the source of both a `PreviewMouseDown` and then a `MouseDown` event:</span></span>

![Diagramme de routage d'événements](./media/routed-events-overview/input-event-routing.png)

<span data-ttu-id="ba041-274">L’ordre de traitement des événements est le suivant :</span><span class="sxs-lookup"><span data-stu-id="ba041-274">The order of event processing is as follows:</span></span>

1. <span data-ttu-id="ba041-275">`PreviewMouseDown` (tunneling) sur l’élément racine.</span><span class="sxs-lookup"><span data-stu-id="ba041-275">`PreviewMouseDown` (tunnel) on root element.</span></span>

2. <span data-ttu-id="ba041-276">`PreviewMouseDown` (tunneling) sur l’élément intermédiaire numéro 1.</span><span class="sxs-lookup"><span data-stu-id="ba041-276">`PreviewMouseDown` (tunnel) on intermediate element #1.</span></span>

3. <span data-ttu-id="ba041-277">`PreviewMouseDown` (tunneling) sur l’élément source numéro 2.</span><span class="sxs-lookup"><span data-stu-id="ba041-277">`PreviewMouseDown` (tunnel) on source element #2.</span></span>

4. <span data-ttu-id="ba041-278">`MouseDown` (propagation) sur l’élément source numéro 2.</span><span class="sxs-lookup"><span data-stu-id="ba041-278">`MouseDown` (bubble) on source element #2.</span></span>

5. <span data-ttu-id="ba041-279">`MouseDown` (propagation) sur l’élément intermédiaire numéro 1.</span><span class="sxs-lookup"><span data-stu-id="ba041-279">`MouseDown` (bubble) on intermediate element #1.</span></span>

6. <span data-ttu-id="ba041-280">`MouseDown` (propagation) sur l’élément racine.</span><span class="sxs-lookup"><span data-stu-id="ba041-280">`MouseDown` (bubble) on root element.</span></span>

<span data-ttu-id="ba041-281">Un délégué de gestionnaire d’événements routés fournit des références à deux objets : l’objet qui a déclenché l’événement et l’objet à partir duquel le gestionnaire a été appelé.</span><span class="sxs-lookup"><span data-stu-id="ba041-281">A routed event handler delegate provides references to two objects: the object that raised the event and the object where the handler was invoked.</span></span> <span data-ttu-id="ba041-282">L’objet à partir duquel le gestionnaire a été appelé est celui signalé par le paramètre `sender`.</span><span class="sxs-lookup"><span data-stu-id="ba041-282">The object where the handler was invoked is the object reported by the `sender` parameter.</span></span> <span data-ttu-id="ba041-283">L’objet dans lequel l’événement a été déclenché pour la première fois est signalé par la propriété <xref:System.Windows.RoutedEventArgs.Source%2A> dans les données d’événement.</span><span class="sxs-lookup"><span data-stu-id="ba041-283">The object where the event was first raised is reported by the <xref:System.Windows.RoutedEventArgs.Source%2A> property in the event data.</span></span> <span data-ttu-id="ba041-284">Un événement routé peut toujours être déclenché et géré par le même objet, auquel cas `sender` et <xref:System.Windows.RoutedEventArgs.Source%2A> sont identiques (ce qui est le cas avec les étapes 3 et 4 dans la liste d’exemples de traitement des événements).</span><span class="sxs-lookup"><span data-stu-id="ba041-284">A routed event can still be raised and handled by the same object, in which case `sender` and <xref:System.Windows.RoutedEventArgs.Source%2A> are identical (this is the case with Steps 3 and 4 in the event processing example list).</span></span>

<span data-ttu-id="ba041-285">En raison du tunneling et de la propagation, les éléments parents reçoivent des événements d’entrée où le <xref:System.Windows.RoutedEventArgs.Source%2A> est l’un de leurs éléments enfants.</span><span class="sxs-lookup"><span data-stu-id="ba041-285">Because of tunneling and bubbling, parent elements receive input events where the <xref:System.Windows.RoutedEventArgs.Source%2A> is one of their child elements.</span></span> <span data-ttu-id="ba041-286">Lorsqu’il est important de savoir quel est l’élément source, vous pouvez identifier l’élément source en accédant à la propriété <xref:System.Windows.RoutedEventArgs.Source%2A>.</span><span class="sxs-lookup"><span data-stu-id="ba041-286">When it is important to know what the source element is, you can identify the source element by accessing the <xref:System.Windows.RoutedEventArgs.Source%2A> property.</span></span>

<span data-ttu-id="ba041-287">En général, une fois que l’événement d’entrée est marqué <xref:System.Windows.RoutedEventArgs.Handled%2A>, les gestionnaires supplémentaires ne sont pas appelés.</span><span class="sxs-lookup"><span data-stu-id="ba041-287">Usually, once the input event is marked <xref:System.Windows.RoutedEventArgs.Handled%2A>, further handlers are not invoked.</span></span> <span data-ttu-id="ba041-288">En outre, vous devez marquer les événements d’entrée comme gérés dès qu’un gestionnaire est appelé pour traiter votre gestion logique (et spécifique à l’application) de la signification de l’événement d’entrée.</span><span class="sxs-lookup"><span data-stu-id="ba041-288">Typically, you should mark input events as handled as soon as a handler is invoked that addresses your application-specific logical handling of the meaning of the input event.</span></span>

<span data-ttu-id="ba041-289">L’exception à cette instruction générale relative à l’état de <xref:System.Windows.RoutedEventArgs.Handled%2A> est que les gestionnaires d’événements d’entrée inscrits pour ignorer délibérément l’état de <xref:System.Windows.RoutedEventArgs.Handled%2A> des données d’événement seraient toujours appelés le long de l’itinéraire.</span><span class="sxs-lookup"><span data-stu-id="ba041-289">The exception to this general statement about <xref:System.Windows.RoutedEventArgs.Handled%2A> state is that input event handlers that are registered to deliberately ignore <xref:System.Windows.RoutedEventArgs.Handled%2A> state of the event data would still be invoked along either route.</span></span> <span data-ttu-id="ba041-290">Pour plus d’informations, consultez [Événements Preview](preview-events.md) ou [Marquage des événements routés comme gérés et gestion de classe](marking-routed-events-as-handled-and-class-handling.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-290">For more information, see [Preview Events](preview-events.md) or [Marking Routed Events as Handled, and Class Handling](marking-routed-events-as-handled-and-class-handling.md).</span></span>

<span data-ttu-id="ba041-291">Le modèle de données d’événement partagé entre les événements de tunneling et de propagation, avec le déclenchement séquentiel de l’événement de tunneling puis de l’événement de propagation, est un concept qui n’est pas valable pour tous les événements routés.</span><span class="sxs-lookup"><span data-stu-id="ba041-291">The shared event data model between tunneling and bubbling events, and the sequential raising of first tunneling then bubbling events, is not a concept that is generally true for all routed events.</span></span> <span data-ttu-id="ba041-292">Ce comportement est implémenté selon la manière dont les périphériques d’entrée [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] choisissent de déclencher et de connecter les paires d’événements d’entrée.</span><span class="sxs-lookup"><span data-stu-id="ba041-292">That behavior is specifically implemented by how [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] input devices choose to raise and connect the input event pairs.</span></span> <span data-ttu-id="ba041-293">L’implémentation de vos propres événements d’entrée est un scénario avancé. Toutefois, vous pouvez choisir de suivre ce modèle pour vos propres événements d’entrée.</span><span class="sxs-lookup"><span data-stu-id="ba041-293">Implementing your own input events is an advanced scenario, but you might choose to follow that model for your own input events also.</span></span>

<span data-ttu-id="ba041-294">Certaines classes choisissent de gérer la classe de certains événements d’entrée, généralement dans le but de redéfinir la signification d’un événement d’entrée piloté par l’utilisateur dans le contrôle, et dans le but de déclencher un nouvel événement.</span><span class="sxs-lookup"><span data-stu-id="ba041-294">Certain classes choose to class-handle certain input events, usually with the intent of redefining what a particular user-driven input event means within that control and raising a new event.</span></span> <span data-ttu-id="ba041-295">Pour plus d’informations, consultez [Marquage des événements routés comme gérés et gestion de classe](marking-routed-events-as-handled-and-class-handling.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-295">For more information, see [Marking Routed Events as Handled, and Class Handling](marking-routed-events-as-handled-and-class-handling.md).</span></span>

<span data-ttu-id="ba041-296">Pour plus d’informations sur les entrées et la façon dont elles interagissent avec les événements dans des scénarios d’application standard, consultez [Vue d’ensemble des entrées](input-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-296">For more information on input and how input and events interact in typical application scenarios, see [Input Overview](input-overview.md).</span></span>

<a name="events_styles"></a>

## <a name="eventsetters-and-eventtriggers"></a><span data-ttu-id="ba041-297">EventSetters et EventTriggers</span><span class="sxs-lookup"><span data-stu-id="ba041-297">EventSetters and EventTriggers</span></span>

<span data-ttu-id="ba041-298">Dans les styles, vous pouvez inclure une syntaxe de gestion des événements [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] préalablement déclarée dans le balisage à l’aide d’un <xref:System.Windows.EventSetter>.</span><span class="sxs-lookup"><span data-stu-id="ba041-298">In styles, you can include some pre-declared [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] event handling syntax in the markup by using an <xref:System.Windows.EventSetter>.</span></span> <span data-ttu-id="ba041-299">Lorsque le style est appliqué, le gestionnaire référencé est ajouté à l’instance à laquelle est appliqué le style.</span><span class="sxs-lookup"><span data-stu-id="ba041-299">When the style is applied, the referenced handler is added to the styled instance.</span></span> <span data-ttu-id="ba041-300">Vous pouvez déclarer un <xref:System.Windows.EventSetter> uniquement pour un événement routé.</span><span class="sxs-lookup"><span data-stu-id="ba041-300">You can declare an <xref:System.Windows.EventSetter> only for a routed event.</span></span> <span data-ttu-id="ba041-301">Voici un exemple.</span><span class="sxs-lookup"><span data-stu-id="ba041-301">The following is an example.</span></span> <span data-ttu-id="ba041-302">Notez que la méthode `b1SetColor` référencée ici se trouve dans un fichier code-behind.</span><span class="sxs-lookup"><span data-stu-id="ba041-302">Note that the `b1SetColor` method referenced here is in a code-behind file.</span></span>

[!code-xaml[EventOvwSupport#XAML2](~/samples/snippets/csharp/VS_Snippets_Wpf/EventOvwSupport/CSharp/page2.xaml#xaml2)]

<span data-ttu-id="ba041-303">L’avantage acquis ici est que le style est susceptible de contenir une grande quantité d’autres informations qui peuvent s’appliquer à n’importe quel bouton de votre application, et que l' <xref:System.Windows.EventSetter> faire partie de ce style favorise la réutilisation du code, même au niveau du balisage.</span><span class="sxs-lookup"><span data-stu-id="ba041-303">The advantage gained here is that the style is likely to contain a great deal of other information that could apply to any button in your application, and having the <xref:System.Windows.EventSetter> be part of that style promotes code reuse even at the markup level.</span></span> <span data-ttu-id="ba041-304">En outre, un <xref:System.Windows.EventSetter> extrait les noms de méthode pour les gestionnaires une étape plus loin de l’application générale et du balisage de page.</span><span class="sxs-lookup"><span data-stu-id="ba041-304">Also, an <xref:System.Windows.EventSetter> abstracts method names for handlers one step further away from the general application and page markup.</span></span>

<span data-ttu-id="ba041-305">Une autre syntaxe spécialisée qui combine les fonctionnalités d’événement et d’animation routées de [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] est une <xref:System.Windows.EventTrigger>.</span><span class="sxs-lookup"><span data-stu-id="ba041-305">Another specialized syntax that combines the routed event and animation features of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] is an <xref:System.Windows.EventTrigger>.</span></span> <span data-ttu-id="ba041-306">Comme avec <xref:System.Windows.EventSetter>, seuls les événements routés peuvent être utilisés pour un <xref:System.Windows.EventTrigger>.</span><span class="sxs-lookup"><span data-stu-id="ba041-306">As with <xref:System.Windows.EventSetter>, only routed events may be used for an <xref:System.Windows.EventTrigger>.</span></span> <span data-ttu-id="ba041-307">En général, une <xref:System.Windows.EventTrigger> est déclarée dans le cadre d’un style, mais une <xref:System.Windows.EventTrigger> peut également être déclarée sur des éléments au niveau de la page dans le cadre de la collection de <xref:System.Windows.FrameworkElement.Triggers%2A>, ou dans un <xref:System.Windows.Controls.ControlTemplate>.</span><span class="sxs-lookup"><span data-stu-id="ba041-307">Typically, an <xref:System.Windows.EventTrigger> is declared as part of a style, but an <xref:System.Windows.EventTrigger> can also be declared on page-level elements as part of the <xref:System.Windows.FrameworkElement.Triggers%2A> collection, or in a <xref:System.Windows.Controls.ControlTemplate>.</span></span> <span data-ttu-id="ba041-308">Une <xref:System.Windows.EventTrigger> vous permet de spécifier un <xref:System.Windows.Media.Animation.Storyboard> qui s’exécute chaque fois qu’un événement routé atteint un élément de son itinéraire qui déclare un <xref:System.Windows.EventTrigger> pour cet événement.</span><span class="sxs-lookup"><span data-stu-id="ba041-308">An <xref:System.Windows.EventTrigger> enables you to specify a <xref:System.Windows.Media.Animation.Storyboard> that runs whenever a routed event reaches an element in its route that declares an <xref:System.Windows.EventTrigger> for that event.</span></span> <span data-ttu-id="ba041-309">L’avantage d’une <xref:System.Windows.EventTrigger> sur la simple gestion de l’événement et le fait de démarrer une table de montage séquentiel existante est qu’une <xref:System.Windows.EventTrigger> fournit un meilleur contrôle sur la table de montage séquentiel et son comportement au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="ba041-309">The advantage of an <xref:System.Windows.EventTrigger> over just handling the event and causing it to start an existing storyboard is that an <xref:System.Windows.EventTrigger> provides better control over the storyboard and its run-time behavior.</span></span> <span data-ttu-id="ba041-310">Pour plus d’informations, consultez [Utiliser des déclencheurs d’événements pour contrôler un storyboard après son démarrage](../graphics-multimedia/how-to-use-event-triggers-to-control-a-storyboard-after-it-starts.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-310">For more information, see [Use Event Triggers to Control a Storyboard After It Starts](../graphics-multimedia/how-to-use-event-triggers-to-control-a-storyboard-after-it-starts.md).</span></span>

<a name="more_about"></a>

## <a name="more-about-routed-events"></a><span data-ttu-id="ba041-311">Informations complémentaires sur les événements routés</span><span class="sxs-lookup"><span data-stu-id="ba041-311">More About Routed Events</span></span>

<span data-ttu-id="ba041-312">Cette rubrique traite principalement des concepts de base relatifs aux événements routés, et explique comment et à quel moment répondre aux événements routés qui sont déjà présents dans les différents éléments et contrôles de base.</span><span class="sxs-lookup"><span data-stu-id="ba041-312">This topic mainly discusses routed events from the perspective of describing the basic concepts and offering guidance on how and when to respond to the routed events that are already present in the various base elements and controls.</span></span> <span data-ttu-id="ba041-313">Toutefois, vous pouvez créer vos propres événements routés dans votre classe personnalisée, ainsi que toute la prise en charge nécessaire, telle que les classes et les délégués spécialisés de données d’événement.</span><span class="sxs-lookup"><span data-stu-id="ba041-313">However, you can create your own routed event on your custom class along with all the necessary support, such as specialized event data classes and delegates.</span></span> <span data-ttu-id="ba041-314">Le propriétaire de l’événement routé peut être n’importe quelle classe, mais les événements routés doivent être déclenchés par et gérés par <xref:System.Windows.UIElement> ou <xref:System.Windows.ContentElement> classes dérivées afin d’être utiles.</span><span class="sxs-lookup"><span data-stu-id="ba041-314">The routed event owner can be any class, but routed events must be raised by and handled by <xref:System.Windows.UIElement> or <xref:System.Windows.ContentElement> derived classes in order to be useful.</span></span> <span data-ttu-id="ba041-315">Pour plus d’informations sur les événements personnalisés, consultez [Créer un événement routé personnalisé](how-to-create-a-custom-routed-event.md).</span><span class="sxs-lookup"><span data-stu-id="ba041-315">For more information about custom events, see [Create a Custom Routed Event](how-to-create-a-custom-routed-event.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="ba041-316">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="ba041-316">See also</span></span>

- <xref:System.Windows.EventManager>
- <xref:System.Windows.RoutedEvent>
- <xref:System.Windows.RoutedEventArgs>
- [<span data-ttu-id="ba041-317">Marquage des événements routés comme gérés et gestion de classe</span><span class="sxs-lookup"><span data-stu-id="ba041-317">Marking Routed Events as Handled, and Class Handling</span></span>](marking-routed-events-as-handled-and-class-handling.md)
- [<span data-ttu-id="ba041-318">Vue d’ensemble des entrées</span><span class="sxs-lookup"><span data-stu-id="ba041-318">Input Overview</span></span>](input-overview.md)
- [<span data-ttu-id="ba041-319">Vue d’ensemble des commandes</span><span class="sxs-lookup"><span data-stu-id="ba041-319">Commanding Overview</span></span>](commanding-overview.md)
- [<span data-ttu-id="ba041-320">Propriétés de dépendance personnalisées</span><span class="sxs-lookup"><span data-stu-id="ba041-320">Custom Dependency Properties</span></span>](custom-dependency-properties.md)
- [<span data-ttu-id="ba041-321">Arborescences dans WPF</span><span class="sxs-lookup"><span data-stu-id="ba041-321">Trees in WPF</span></span>](trees-in-wpf.md)
- [<span data-ttu-id="ba041-322">Modèles d’événement faible</span><span class="sxs-lookup"><span data-stu-id="ba041-322">Weak Event Patterns</span></span>](weak-event-patterns.md)

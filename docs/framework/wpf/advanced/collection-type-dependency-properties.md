---
title: Propriétés de dépendance de type collection
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- properties [WPF], dependency
- properties [WPF], collection-type
- dependency properties [WPF]
- collection-type properties [WPF]
ms.assetid: 99f96a42-3ab7-4f64-a16b-2e10d654e97c
ms.openlocfilehash: f7f8c25844f41dd8915c0f4404d6714b4c81233c
ms.sourcegitcommit: 944ddc52b7f2632f30c668815f92b378efd38eea
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/03/2019
ms.locfileid: "73458477"
---
# <a name="collection-type-dependency-properties"></a><span data-ttu-id="612b1-102">Propriétés de dépendance de type collection</span><span class="sxs-lookup"><span data-stu-id="612b1-102">Collection-Type Dependency Properties</span></span>
<span data-ttu-id="612b1-103">Cette rubrique propose des conseils et des modèles suggérés pour l’implémentation d’une propriété de dépendance de type collection.</span><span class="sxs-lookup"><span data-stu-id="612b1-103">This topic provides guidance and suggested patterns for how to implement a dependency property where the type of the property is a collection type.</span></span>  

<a name="implementing"></a>   
## <a name="implementing-a-collection-type-dependency-property"></a><span data-ttu-id="612b1-104">Implémentation d’une propriété de dépendance de type collection</span><span class="sxs-lookup"><span data-stu-id="612b1-104">Implementing a Collection-Type Dependency Property</span></span>  
 <span data-ttu-id="612b1-105">Pour une propriété de dépendance en général, le modèle d’implémentation que vous suivez est le suivant : vous définissez un wrapper de propriété CLR, où cette propriété est stockée par un identificateur de <xref:System.Windows.DependencyProperty> plutôt que comme un champ ou une autre construction.</span><span class="sxs-lookup"><span data-stu-id="612b1-105">For a dependency property in general, the implementation pattern that you follow is that you define a CLR property wrapper, where that property is backed by a <xref:System.Windows.DependencyProperty> identifier rather than a field or other construct.</span></span> <span data-ttu-id="612b1-106">Vous devez suivre ce même modèle quand vous implémentez une propriété de type collection.</span><span class="sxs-lookup"><span data-stu-id="612b1-106">You follow this same pattern when you implement a collection-type property.</span></span> <span data-ttu-id="612b1-107">Toutefois, une propriété de type collection introduit une certaine complexité pour le modèle chaque fois que le type contenu dans la collection est lui-même une <xref:System.Windows.DependencyObject> ou <xref:System.Windows.Freezable> classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="612b1-107">However, a collection-type property introduces some complexity to the pattern whenever the type that is contained within the collection is itself a <xref:System.Windows.DependencyObject> or <xref:System.Windows.Freezable> derived class.</span></span>  
  
<a name="initializing"></a>   
## <a name="initializing-the-collection-beyond-the-default-value"></a><span data-ttu-id="612b1-108">Initialisation de la collection au-delà de la valeur par défaut</span><span class="sxs-lookup"><span data-stu-id="612b1-108">Initializing the Collection Beyond the Default Value</span></span>  
 <span data-ttu-id="612b1-109">Quand vous créez une propriété de dépendance, vous ne spécifiez pas sa valeur par défaut comme étant la valeur de champ initiale.</span><span class="sxs-lookup"><span data-stu-id="612b1-109">When you create a dependency property, you do not specify the property default value as the initial field value.</span></span> <span data-ttu-id="612b1-110">Vous la spécifiez à l’aide des métadonnées de la propriété de dépendance.</span><span class="sxs-lookup"><span data-stu-id="612b1-110">Instead, you specify the default value through the dependency property metadata.</span></span> <span data-ttu-id="612b1-111">Si votre propriété est un type référence, la valeur par défaut spécifiée dans les métadonnées de la propriété de dépendance n’est pas une valeur par défaut par instance, mais bien une valeur par défaut qui s’applique à toutes les instances du type.</span><span class="sxs-lookup"><span data-stu-id="612b1-111">If your property is a reference type, the default value specified in dependency property metadata is not a default value per instance; instead it is a default value that applies to all instances of the type.</span></span> <span data-ttu-id="612b1-112">Ainsi, vous devez prendre garde de ne pas utiliser la collection statique unique définie par les métadonnées de la propriété de type collection comme valeur par défaut active pour les instances créées de votre type.</span><span class="sxs-lookup"><span data-stu-id="612b1-112">Therefore you must be careful to not use the singular static collection defined by the collection property metadata as the working default value for newly created instances of your type.</span></span> <span data-ttu-id="612b1-113">À la place, vous devez vous assurer que vous affectez délibérément à la valeur de collection une collection (instance) unique dans le cadre de votre logique de constructeur de classe.</span><span class="sxs-lookup"><span data-stu-id="612b1-113">Instead, you must make sure that you deliberately set the collection value to a unique (instance) collection as part of your class constructor logic.</span></span> <span data-ttu-id="612b1-114">Sinon, vous créerez une classe singleton involontaire.</span><span class="sxs-lookup"><span data-stu-id="612b1-114">Otherwise you will have created an unintentional singleton class.</span></span>  
  
 <span data-ttu-id="612b1-115">Prenons l'exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="612b1-115">Consider the following example.</span></span> <span data-ttu-id="612b1-116">La section suivante de l’exemple illustre la définition d’une classe `Aquarium`.</span><span class="sxs-lookup"><span data-stu-id="612b1-116">The following section of the example shows the definition for a class `Aquarium`.</span></span> <span data-ttu-id="612b1-117">La classe définit la propriété de dépendance de type collection `AquariumObjects`, qui utilise le type de <xref:System.Collections.Generic.List%601> générique avec une contrainte de type <xref:System.Windows.FrameworkElement>.</span><span class="sxs-lookup"><span data-stu-id="612b1-117">The class defines the collection type dependency property `AquariumObjects`, which uses the generic <xref:System.Collections.Generic.List%601> type with a <xref:System.Windows.FrameworkElement> type constraint.</span></span> <span data-ttu-id="612b1-118">Dans l’appel de <xref:System.Windows.DependencyProperty.Register%28System.String%2CSystem.Type%2CSystem.Type%2CSystem.Windows.PropertyMetadata%29> pour la propriété de dépendance, les métadonnées définissent la valeur par défaut en tant que nouvelle <xref:System.Collections.Generic.List%601>générique.</span><span class="sxs-lookup"><span data-stu-id="612b1-118">In the <xref:System.Windows.DependencyProperty.Register%28System.String%2CSystem.Type%2CSystem.Type%2CSystem.Windows.PropertyMetadata%29> call for the dependency property, the metadata establishes the default value to be a new generic <xref:System.Collections.Generic.List%601>.</span></span>  
  
 [!code-csharp[PropertiesOvwSupport2#CollectionProblemDefinition](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport2/CSharp/page.xaml.cs#collectionproblemdefinition)]
 [!code-vb[PropertiesOvwSupport2#CollectionProblemDefinition](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport2/visualbasic/page.xaml.vb#collectionproblemdefinition)]  
  
 <span data-ttu-id="612b1-119">Cependant, si vous laissez le code tel qu’illustré, cette valeur par défaut de liste unique est partagée pour toutes les instances d’`Aquarium`.</span><span class="sxs-lookup"><span data-stu-id="612b1-119">However, if you just left the code as shown, that single list default value is shared for all instances of `Aquarium`.</span></span> <span data-ttu-id="612b1-120">Si vous avez exécuté le code de test suivant, qui a pour but de vous montrer comment instancier deux instances d’`Aquarium` distinctes et ajouter un `Fish` différent à chacune, vous risquez d’être surpris par le résultat :</span><span class="sxs-lookup"><span data-stu-id="612b1-120">If you ran the following test code, which is intended to show how you would instantiate two separate `Aquarium` instances and add a single different `Fish` to each of them, you would see a surprising result:</span></span>  
  
 [!code-csharp[PropertiesOvwSupport#CollectionProblemTestCode](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page4.xaml.cs#collectionproblemtestcode)]
 [!code-vb[PropertiesOvwSupport#CollectionProblemTestCode](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page4.xaml.vb#collectionproblemtestcode)]  
  
 <span data-ttu-id="612b1-121">Au lieu d’avoir deux collections contenant chacune une unité, vous avez deux collections de deux unités !</span><span class="sxs-lookup"><span data-stu-id="612b1-121">Instead of each collection having a count of one, each collection has a count of two!</span></span> <span data-ttu-id="612b1-122">En effet, chaque `Aquarium` a ajouté son `Fish` à la collection de valeurs par défaut, car il n’y a eu qu’un seul appel de constructeur dans les métadonnées, lequel a donc été partagé entre toutes les instances.</span><span class="sxs-lookup"><span data-stu-id="612b1-122">This is because each `Aquarium` added its `Fish` to the default value collection, which resulted from a single constructor call in the metadata and is therefore shared between all instances.</span></span> <span data-ttu-id="612b1-123">Ce n’est sans doute pas ce que vous vouliez.</span><span class="sxs-lookup"><span data-stu-id="612b1-123">This situation is almost never what you want.</span></span>  
  
 <span data-ttu-id="612b1-124">Pour résoudre ce problème, vous devez réinitialiser la valeur de la propriété de dépendance de type collection à une instance unique, dans le cadre de l’appel de constructeur de classe.</span><span class="sxs-lookup"><span data-stu-id="612b1-124">To correct this problem, you must reset the collection dependency property value to a unique instance, as part of the class constructor call.</span></span> <span data-ttu-id="612b1-125">Étant donné que la propriété est une propriété de dépendance en lecture seule, vous utilisez la méthode <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyPropertyKey%2CSystem.Object%29> pour la définir à l’aide du <xref:System.Windows.DependencyPropertyKey> qui est uniquement accessible dans la classe.</span><span class="sxs-lookup"><span data-stu-id="612b1-125">Because the property is a read-only dependency property, you use the <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyPropertyKey%2CSystem.Object%29> method to set it, using the <xref:System.Windows.DependencyPropertyKey> that is only accessible within the class.</span></span>  
  
 [!code-csharp[PropertiesOvwSupport#CollectionProblemCtor](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page4.xaml.cs#collectionproblemctor)]
 [!code-vb[PropertiesOvwSupport#CollectionProblemCtor](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page4.xaml.vb#collectionproblemctor)]  
  
 <span data-ttu-id="612b1-126">Si vous exécutez à nouveau ce même code de test, vous obtiendrez un résultat plus prévisible, où chaque `Aquarium` prend en charge sa propre collection unique.</span><span class="sxs-lookup"><span data-stu-id="612b1-126">Now, if you ran that same test code again, you could see more expected results, where each `Aquarium` supported its own unique collection.</span></span>  
  
 <span data-ttu-id="612b1-127">Il peut y avoir une légère variation à ce modèle si vous choisissez d’avoir votre propriété de collection en lecture-écriture.</span><span class="sxs-lookup"><span data-stu-id="612b1-127">There would be a slight variation on this pattern if you chose to have your collection property be read-write.</span></span> <span data-ttu-id="612b1-128">Dans ce cas, vous pouvez appeler l’accesseur Set public à partir du constructeur pour effectuer l’initialisation, qui appelle toujours la signature non-clé de <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyProperty%2CSystem.Object%29> dans votre Wrapper Set, à l’aide d’un identificateur de <xref:System.Windows.DependencyProperty> public.</span><span class="sxs-lookup"><span data-stu-id="612b1-128">In that case, you could call the public set accessor from the constructor to do the initialization, which would still be calling the nonkey signature of <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyProperty%2CSystem.Object%29> within your set wrapper, using a public <xref:System.Windows.DependencyProperty> identifier.</span></span>  
  
## <a name="reporting-binding-value-changes-from-collection-properties"></a><span data-ttu-id="612b1-129">Signalement des modifications des valeurs de liaison des propriétés de collection</span><span class="sxs-lookup"><span data-stu-id="612b1-129">Reporting Binding Value Changes from Collection Properties</span></span>  
 <span data-ttu-id="612b1-130">Une propriété de collection qui est elle-même une propriété de dépendance ne signale pas automatiquement les modifications apportées à ses sous-propriétés.</span><span class="sxs-lookup"><span data-stu-id="612b1-130">A collection property that is itself a dependency property does not automatically report changes to its subproperties.</span></span> <span data-ttu-id="612b1-131">Si vous créez des liaisons au sein d’une collection, cela peut empêcher la liaison de signaler les modifications et, de ce fait, invalider certains scénarios de liaison de données.</span><span class="sxs-lookup"><span data-stu-id="612b1-131">If you are creating bindings into a collection, this can prevent the binding from reporting changes, thus invalidating some data binding scenarios.</span></span> <span data-ttu-id="612b1-132">Toutefois, si vous utilisez le type de collection <xref:System.Windows.FreezableCollection%601> comme type de collection, les modifications de sous-propriétés apportées aux éléments contenus dans la collection sont correctement signalées, et la liaison fonctionne comme prévu.</span><span class="sxs-lookup"><span data-stu-id="612b1-132">However, if you use the collection type <xref:System.Windows.FreezableCollection%601> as your collection type, then subproperty changes to contained elements in the collection are properly reported, and binding works as expected.</span></span>  
  
 <span data-ttu-id="612b1-133">Pour activer la liaison de sous-propriétés dans une collection d’objets de dépendance, créez la propriété de collection en tant que type <xref:System.Windows.FreezableCollection%601>, avec une contrainte de type pour cette collection à toute <xref:System.Windows.DependencyObject> classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="612b1-133">To enable subproperty binding in a dependency object collection, create the collection property as type <xref:System.Windows.FreezableCollection%601>, with a type constraint for that collection to any <xref:System.Windows.DependencyObject> derived class.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="612b1-134">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="612b1-134">See also</span></span>

- <xref:System.Windows.FreezableCollection%601>
- [<span data-ttu-id="612b1-135">XAML et classes personnalisées pour WPF</span><span class="sxs-lookup"><span data-stu-id="612b1-135">XAML and Custom Classes for WPF</span></span>](xaml-and-custom-classes-for-wpf.md)
- [<span data-ttu-id="612b1-136">Vue d’ensemble de la liaison de données</span><span class="sxs-lookup"><span data-stu-id="612b1-136">Data Binding Overview</span></span>](../../../desktop-wpf/data/data-binding-overview.md)
- [<span data-ttu-id="612b1-137">Vue d’ensemble des propriétés de dépendance</span><span class="sxs-lookup"><span data-stu-id="612b1-137">Dependency Properties Overview</span></span>](dependency-properties-overview.md)
- [<span data-ttu-id="612b1-138">Propriétés de dépendance personnalisées</span><span class="sxs-lookup"><span data-stu-id="612b1-138">Custom Dependency Properties</span></span>](custom-dependency-properties.md)
- [<span data-ttu-id="612b1-139">Métadonnées de propriété de dépendance</span><span class="sxs-lookup"><span data-stu-id="612b1-139">Dependency Property Metadata</span></span>](dependency-property-metadata.md)

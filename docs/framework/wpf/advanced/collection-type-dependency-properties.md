---
title: Propriétés de dépendance de type collection
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- properties [WPF], dependency
- properties [WPF], collection-type
- dependency properties [WPF]
- collection-type properties [WPF]
ms.assetid: 99f96a42-3ab7-4f64-a16b-2e10d654e97c
ms.openlocfilehash: e783ce4b95b52b86671181dfe4b316d4b91d8fc6
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79141535"
---
# <a name="collection-type-dependency-properties"></a><span data-ttu-id="dfcfd-102">Propriétés de dépendance de type collection</span><span class="sxs-lookup"><span data-stu-id="dfcfd-102">Collection-Type Dependency Properties</span></span>
<span data-ttu-id="dfcfd-103">Cette rubrique propose des conseils et des modèles suggérés pour l’implémentation d’une propriété de dépendance de type collection.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-103">This topic provides guidance and suggested patterns for how to implement a dependency property where the type of the property is a collection type.</span></span>  

<a name="implementing"></a>
## <a name="implementing-a-collection-type-dependency-property"></a><span data-ttu-id="dfcfd-104">Implémentation d’une propriété de dépendance de type collection</span><span class="sxs-lookup"><span data-stu-id="dfcfd-104">Implementing a Collection-Type Dependency Property</span></span>  
 <span data-ttu-id="dfcfd-105">Pour une propriété de dépendance en général, le modèle de mise en œuvre que <xref:System.Windows.DependencyProperty> vous suivez est que vous définissez un emballage de propriété CLR, où cette propriété est soutenue par un identifiant plutôt qu’un champ ou une autre construction.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-105">For a dependency property in general, the implementation pattern that you follow is that you define a CLR property wrapper, where that property is backed by a <xref:System.Windows.DependencyProperty> identifier rather than a field or other construct.</span></span> <span data-ttu-id="dfcfd-106">Vous devez suivre ce même modèle quand vous implémentez une propriété de type collection.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-106">You follow this same pattern when you implement a collection-type property.</span></span> <span data-ttu-id="dfcfd-107">Cependant, une propriété de type collection introduit une certaine complexité au modèle chaque <xref:System.Windows.DependencyObject> <xref:System.Windows.Freezable> fois que le type qui est contenu dans la collection est lui-même une classe ou dérivée.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-107">However, a collection-type property introduces some complexity to the pattern whenever the type that is contained within the collection is itself a <xref:System.Windows.DependencyObject> or <xref:System.Windows.Freezable> derived class.</span></span>  
  
<a name="initializing"></a>
## <a name="initializing-the-collection-beyond-the-default-value"></a><span data-ttu-id="dfcfd-108">Initialisation de la collection au-delà de la valeur par défaut</span><span class="sxs-lookup"><span data-stu-id="dfcfd-108">Initializing the Collection Beyond the Default Value</span></span>  
 <span data-ttu-id="dfcfd-109">Quand vous créez une propriété de dépendance, vous ne spécifiez pas sa valeur par défaut comme étant la valeur de champ initiale.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-109">When you create a dependency property, you do not specify the property default value as the initial field value.</span></span> <span data-ttu-id="dfcfd-110">Vous la spécifiez à l’aide des métadonnées de la propriété de dépendance.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-110">Instead, you specify the default value through the dependency property metadata.</span></span> <span data-ttu-id="dfcfd-111">Si votre propriété est un type référence, la valeur par défaut spécifiée dans les métadonnées de la propriété de dépendance n’est pas une valeur par défaut par instance, mais bien une valeur par défaut qui s’applique à toutes les instances du type.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-111">If your property is a reference type, the default value specified in dependency property metadata is not a default value per instance; instead it is a default value that applies to all instances of the type.</span></span> <span data-ttu-id="dfcfd-112">Ainsi, vous devez prendre garde de ne pas utiliser la collection statique unique définie par les métadonnées de la propriété de type collection comme valeur par défaut active pour les instances créées de votre type.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-112">Therefore you must be careful to not use the singular static collection defined by the collection property metadata as the working default value for newly created instances of your type.</span></span> <span data-ttu-id="dfcfd-113">À la place, vous devez vous assurer que vous affectez délibérément à la valeur de collection une collection (instance) unique dans le cadre de votre logique de constructeur de classe.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-113">Instead, you must make sure that you deliberately set the collection value to a unique (instance) collection as part of your class constructor logic.</span></span> <span data-ttu-id="dfcfd-114">Sinon, vous créerez une classe singleton involontaire.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-114">Otherwise you will have created an unintentional singleton class.</span></span>  
  
 <span data-ttu-id="dfcfd-115">Considérez l'exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-115">Consider the following example.</span></span> <span data-ttu-id="dfcfd-116">La section suivante de l’exemple `Aquarium`montre la définition d’une classe , qui contient un défaut avec la valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-116">The following section of the example shows the definition for a class `Aquarium`, which contains a flaw with the default value.</span></span> <span data-ttu-id="dfcfd-117">La classe définit la propriété `AquariumObjects`de dépendance <xref:System.Collections.Generic.List%601> de type <xref:System.Windows.FrameworkElement> de collecte, qui utilise le type générique avec une contrainte de type.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-117">The class defines the collection type dependency property `AquariumObjects`, which uses the generic <xref:System.Collections.Generic.List%601> type with a <xref:System.Windows.FrameworkElement> type constraint.</span></span> <span data-ttu-id="dfcfd-118">Dans <xref:System.Windows.DependencyProperty.Register%28System.String%2CSystem.Type%2CSystem.Type%2CSystem.Windows.PropertyMetadata%29> l’appel pour la propriété de dépendance, les métadonnées établit la valeur par défaut pour être un nouveau générique <xref:System.Collections.Generic.List%601>.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-118">In the <xref:System.Windows.DependencyProperty.Register%28System.String%2CSystem.Type%2CSystem.Type%2CSystem.Windows.PropertyMetadata%29> call for the dependency property, the metadata establishes the default value to be a new generic <xref:System.Collections.Generic.List%601>.</span></span>

> [!WARNING]
> <span data-ttu-id="dfcfd-119">Le code suivant ne se comporte pas correctement.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-119">The following code does not behave correctly.</span></span>

 [!code-csharp[PropertiesOvwSupport2#CollectionProblemDefinition](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport2/CSharp/page.xaml.cs#collectionproblemdefinition)]
 [!code-vb[PropertiesOvwSupport2#CollectionProblemDefinition](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport2/visualbasic/page.xaml.vb#collectionproblemdefinition)]  
  
 <span data-ttu-id="dfcfd-120">Cependant, si vous laissez le code tel qu’illustré, cette valeur par défaut de liste unique est partagée pour toutes les instances d’`Aquarium`.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-120">However, if you just left the code as shown, that single list default value is shared for all instances of `Aquarium`.</span></span> <span data-ttu-id="dfcfd-121">Si vous avez exécuté le code de test suivant, qui a pour but de vous montrer comment instancier deux instances d’`Aquarium` distinctes et ajouter un `Fish` différent à chacune, vous risquez d’être surpris par le résultat :</span><span class="sxs-lookup"><span data-stu-id="dfcfd-121">If you ran the following test code, which is intended to show how you would instantiate two separate `Aquarium` instances and add a single different `Fish` to each of them, you would see a surprising result:</span></span>  
  
 [!code-csharp[PropertiesOvwSupport#CollectionProblemTestCode](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page4.xaml.cs#collectionproblemtestcode)]
 [!code-vb[PropertiesOvwSupport#CollectionProblemTestCode](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page4.xaml.vb#collectionproblemtestcode)]  
  
 <span data-ttu-id="dfcfd-122">Au lieu d’avoir deux collections contenant chacune une unité, vous avez deux collections de deux unités !</span><span class="sxs-lookup"><span data-stu-id="dfcfd-122">Instead of each collection having a count of one, each collection has a count of two!</span></span> <span data-ttu-id="dfcfd-123">En effet, chaque `Aquarium` a ajouté son `Fish` à la collection de valeurs par défaut, car il n’y a eu qu’un seul appel de constructeur dans les métadonnées, lequel a donc été partagé entre toutes les instances.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-123">This is because each `Aquarium` added its `Fish` to the default value collection, which resulted from a single constructor call in the metadata and is therefore shared between all instances.</span></span> <span data-ttu-id="dfcfd-124">Ce n’est sans doute pas ce que vous vouliez.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-124">This situation is almost never what you want.</span></span>  
  
 <span data-ttu-id="dfcfd-125">Pour résoudre ce problème, vous devez réinitialiser la valeur de la propriété de dépendance de type collection à une instance unique, dans le cadre de l’appel de constructeur de classe.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-125">To correct this problem, you must reset the collection dependency property value to a unique instance, as part of the class constructor call.</span></span> <span data-ttu-id="dfcfd-126">Parce que la propriété est une propriété <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyPropertyKey%2CSystem.Object%29> de dépendance lisible <xref:System.Windows.DependencyPropertyKey> seulement, vous utilisez la méthode pour la définir, en utilisant le qui n’est accessible qu’au sein de la classe.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-126">Because the property is a read-only dependency property, you use the <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyPropertyKey%2CSystem.Object%29> method to set it, using the <xref:System.Windows.DependencyPropertyKey> that is only accessible within the class.</span></span>  
  
 [!code-csharp[PropertiesOvwSupport#CollectionProblemCtor](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page4.xaml.cs#collectionproblemctor)]
 [!code-vb[PropertiesOvwSupport#CollectionProblemCtor](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page4.xaml.vb#collectionproblemctor)]  
  
 <span data-ttu-id="dfcfd-127">Si vous exécutez à nouveau ce même code de test, vous obtiendrez un résultat plus prévisible, où chaque `Aquarium` prend en charge sa propre collection unique.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-127">Now, if you ran that same test code again, you could see more expected results, where each `Aquarium` supported its own unique collection.</span></span>  
  
 <span data-ttu-id="dfcfd-128">Il peut y avoir une légère variation à ce modèle si vous choisissez d’avoir votre propriété de collection en lecture-écriture.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-128">There would be a slight variation on this pattern if you chose to have your collection property be read-write.</span></span> <span data-ttu-id="dfcfd-129">Dans ce cas, vous pouvez appeler l’accesseur de l’ensemble public du constructeur pour <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyProperty%2CSystem.Object%29> faire l’initialisation, qui <xref:System.Windows.DependencyProperty> serait toujours appeler la signature non clé de l’intérieur de votre emballage ensemble, à l’aide d’un identifiant public.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-129">In that case, you could call the public set accessor from the constructor to do the initialization, which would still be calling the nonkey signature of <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyProperty%2CSystem.Object%29> within your set wrapper, using a public <xref:System.Windows.DependencyProperty> identifier.</span></span>  
  
## <a name="reporting-binding-value-changes-from-collection-properties"></a><span data-ttu-id="dfcfd-130">Signalement des modifications des valeurs de liaison des propriétés de collection</span><span class="sxs-lookup"><span data-stu-id="dfcfd-130">Reporting Binding Value Changes from Collection Properties</span></span>  
 <span data-ttu-id="dfcfd-131">Une propriété de collection qui est elle-même une propriété de dépendance ne signale pas automatiquement les modifications apportées à ses sous-propriétés.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-131">A collection property that is itself a dependency property does not automatically report changes to its subproperties.</span></span> <span data-ttu-id="dfcfd-132">Si vous créez des liaisons au sein d’une collection, cela peut empêcher la liaison de signaler les modifications et, de ce fait, invalider certains scénarios de liaison de données.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-132">If you are creating bindings into a collection, this can prevent the binding from reporting changes, thus invalidating some data binding scenarios.</span></span> <span data-ttu-id="dfcfd-133">Toutefois, si vous utilisez <xref:System.Windows.FreezableCollection%601> le type de collection comme type de collection, les modifications de sous-propriété aux éléments contenus de la collection sont correctement signalées, et les œuvres de liaison comme prévu.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-133">However, if you use the collection type <xref:System.Windows.FreezableCollection%601> as your collection type, then subproperty changes to contained elements in the collection are properly reported, and binding works as expected.</span></span>  
  
 <span data-ttu-id="dfcfd-134">Pour permettre une liaison de sous-propriété dans une collection <xref:System.Windows.FreezableCollection%601>d’objets de dépendance, créez <xref:System.Windows.DependencyObject> la propriété de collecte comme type, avec une contrainte de type pour cette collection à n’importe quelle classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="dfcfd-134">To enable subproperty binding in a dependency object collection, create the collection property as type <xref:System.Windows.FreezableCollection%601>, with a type constraint for that collection to any <xref:System.Windows.DependencyObject> derived class.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="dfcfd-135">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="dfcfd-135">See also</span></span>

- <xref:System.Windows.FreezableCollection%601>
- [<span data-ttu-id="dfcfd-136">XAML et les classes personnalisées pour WPF</span><span class="sxs-lookup"><span data-stu-id="dfcfd-136">XAML and Custom Classes for WPF</span></span>](xaml-and-custom-classes-for-wpf.md)
- [<span data-ttu-id="dfcfd-137">Aperçu de la liaison de données</span><span class="sxs-lookup"><span data-stu-id="dfcfd-137">Data Binding Overview</span></span>](../../../desktop-wpf/data/data-binding-overview.md)
- [<span data-ttu-id="dfcfd-138">Aperçu des propriétés de dépendance</span><span class="sxs-lookup"><span data-stu-id="dfcfd-138">Dependency Properties Overview</span></span>](dependency-properties-overview.md)
- [<span data-ttu-id="dfcfd-139">Propriétés de dépendance personnalisées</span><span class="sxs-lookup"><span data-stu-id="dfcfd-139">Custom Dependency Properties</span></span>](custom-dependency-properties.md)
- [<span data-ttu-id="dfcfd-140">Métadonnées de propriété de dépendance</span><span class="sxs-lookup"><span data-stu-id="dfcfd-140">Dependency Property Metadata</span></span>](dependency-property-metadata.md)

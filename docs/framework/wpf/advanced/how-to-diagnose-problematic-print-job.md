---
title: 'Procédure : Diagnostiquer un travail d’impression problématique'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- troubleshooting print job problems [WPF]
- print jobs [WPF], troubleshooting
- print jobs [WPF], diagnosing problems
ms.assetid: b081a170-84c6-48f9-a487-5766a8d58a82
ms.openlocfilehash: c9da2e1daff23ef9ba39d8b5d53cb3be67f35a27
ms.sourcegitcommit: c4e9d05644c9cb89de5ce6002723de107ea2e2c4
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/19/2019
ms.locfileid: "65878206"
---
# <a name="how-to-diagnose-problematic-print-job"></a><span data-ttu-id="97794-102">Procédure : Diagnostiquer un travail d’impression problématique</span><span class="sxs-lookup"><span data-stu-id="97794-102">How to: Diagnose Problematic Print Job</span></span>
<span data-ttu-id="97794-103">Les administrateurs réseau reçoivent souvent des plaintes d’utilisateurs concernant des travaux d’impression qui échouent ou s’impriment lentement.</span><span class="sxs-lookup"><span data-stu-id="97794-103">Network administrators often field complaints from users about print jobs that do not print or print slowly.</span></span> <span data-ttu-id="97794-104">L’ensemble des propriétés du travail d’impression exposées dans le [!INCLUDE[TLA#tla_api#plural](../../../../includes/tlasharptla-apisharpplural-md.md)] du Microsoft .NET Framework fournissent un moyen pour effectuer un diagnostic rapide et à distance des travaux d’impression.</span><span class="sxs-lookup"><span data-stu-id="97794-104">The rich set of print job properties exposed in the [!INCLUDE[TLA#tla_api#plural](../../../../includes/tlasharptla-apisharpplural-md.md)] of Microsoft .NET Framework provide a means for performing a rapid remote diagnosis of print jobs.</span></span>  
  
## <a name="example"></a><span data-ttu-id="97794-105">Exemple</span><span class="sxs-lookup"><span data-stu-id="97794-105">Example</span></span>  
 <span data-ttu-id="97794-106">Voici les principales étapes à suivre pour créer ce type d’utilitaire.</span><span class="sxs-lookup"><span data-stu-id="97794-106">The major steps for creating this kind of utility are as follows.</span></span>  
  
1. <span data-ttu-id="97794-107">Identifiez le travail d’impression à l’origine de la plainte de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="97794-107">Identify the print job that the user is complaining about.</span></span> <span data-ttu-id="97794-108">Les utilisateurs sont rarement en mesure de l’identifier avec précision.</span><span class="sxs-lookup"><span data-stu-id="97794-108">Users often cannot do this precisely.</span></span> <span data-ttu-id="97794-109">Ils peuvent par exemple ne pas connaître les noms des serveurs d’impression ou des imprimantes.</span><span class="sxs-lookup"><span data-stu-id="97794-109">They may not know the names of the print servers or printers.</span></span> <span data-ttu-id="97794-110">Ils peuvent décrire l’emplacement de l’imprimante avec une terminologie différente de celle utilisée dans le paramètre son <xref:System.Printing.PrintQueue.Location%2A> propriété.</span><span class="sxs-lookup"><span data-stu-id="97794-110">They may describe the location of the printer in different terminology than was used in setting its <xref:System.Printing.PrintQueue.Location%2A> property.</span></span> <span data-ttu-id="97794-111">Par conséquent, il est judicieux de générer une liste des travaux envoyés par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="97794-111">Accordingly, it is a good idea to generate a list of the user's currently submitted jobs.</span></span> <span data-ttu-id="97794-112">S’il y en a plusieurs, l’utilisateur peut contacter l’administrateur du système d’impression pour identifier le travail qui pose problème.</span><span class="sxs-lookup"><span data-stu-id="97794-112">If there is more than one, then communication between the user and the print system administrator can be used to pinpoint the job that is having problems.</span></span> <span data-ttu-id="97794-113">La procédure est la suivante.</span><span class="sxs-lookup"><span data-stu-id="97794-113">The substeps are as follows.</span></span>  
  
    1. <span data-ttu-id="97794-114">Répertoriez l’ensemble des serveurs d’impression.</span><span class="sxs-lookup"><span data-stu-id="97794-114">Obtain a list of all print servers.</span></span>  
  
    2. <span data-ttu-id="97794-115">Parcourez les serveurs en boucle pour interroger leurs files d’attente à l’impression.</span><span class="sxs-lookup"><span data-stu-id="97794-115">Loop through the servers to query their print queues.</span></span>  
  
    3. <span data-ttu-id="97794-116">À chaque étape de la boucle de serveur, parcourez en boucle toutes les files d’attente du serveur pour interroger les travaux associés.</span><span class="sxs-lookup"><span data-stu-id="97794-116">Within each pass of the server loop, loop through all the server's queues to query their jobs</span></span>  
  
    4. <span data-ttu-id="97794-117">À chaque étape de la boucle de file d’attente, parcourez les travaux associés et collectez les informations d’identification des travaux ayant été envoyés par l’utilisateur à l’origine de la plainte.</span><span class="sxs-lookup"><span data-stu-id="97794-117">Within each pass of the queue loop, loop through its jobs and gather identifying information about those that were submitted by the complaining user.</span></span>  
  
2. <span data-ttu-id="97794-118">Une fois le travail d’impression problématique identifié, examinez les propriétés pertinentes pour tenter de trouver ce qui pose problème.</span><span class="sxs-lookup"><span data-stu-id="97794-118">When the problematic print job has been identified, examine relevant properties to see what might be the problem.</span></span> <span data-ttu-id="97794-119">Le travail affiche-t-il un état d’erreur ou l’imprimante qui traite la file d’attente a-t-elle été déconnectée avant l’impression du travail ?</span><span class="sxs-lookup"><span data-stu-id="97794-119">For example, is job in an error state or did the printer servicing the queue go offline before the job could print?</span></span>  
  
 <span data-ttu-id="97794-120">Le code ci-dessous constitue une série d’exemples de code.</span><span class="sxs-lookup"><span data-stu-id="97794-120">The code below is series of code examples.</span></span> <span data-ttu-id="97794-121">Le premier exemple de code contient la boucle d’exécution des files d’attente à l’impression.</span><span class="sxs-lookup"><span data-stu-id="97794-121">The first code example contains the loop through the print queues.</span></span> <span data-ttu-id="97794-122">(Étape 1c ci-dessus.) La variable `myPrintQueues` est le <xref:System.Printing.PrintQueueCollection> objet pour le serveur d’impression en cours.</span><span class="sxs-lookup"><span data-stu-id="97794-122">(Step 1c above.) The variable `myPrintQueues` is the <xref:System.Printing.PrintQueueCollection> object for the current print server.</span></span>  
  
 <span data-ttu-id="97794-123">L’exemple de code commence par actualiser l’objet actuel de la file d’attente avec <xref:System.Printing.PrintQueue.Refresh%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="97794-123">The code example begins by refreshing the current print queue object with <xref:System.Printing.PrintQueue.Refresh%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="97794-124">Cela permet de s’assurer que les propriétés de l’objet représentent avec exactitude l’état de l’imprimante physique à laquelle l’objet est associé.</span><span class="sxs-lookup"><span data-stu-id="97794-124">This ensures that the object's properties accurately represent the state of the physical printer that it represents.</span></span> <span data-ttu-id="97794-125">Ensuite, l’application obtient la collection de travaux d’impression actuellement dans la file d’attente à l’aide de <xref:System.Printing.PrintQueue.GetPrintJobInfoCollection%2A>.</span><span class="sxs-lookup"><span data-stu-id="97794-125">Then the application gets the collection of print jobs currently in the print queue by using <xref:System.Printing.PrintQueue.GetPrintJobInfoCollection%2A>.</span></span>  
  
 <span data-ttu-id="97794-126">Ensuite l’application parcourt en boucle le <xref:System.Printing.PrintSystemJobInfo> collection et les compare <xref:System.Printing.PrintSystemJobInfo.Submitter%2A> propriété avec l’alias de l’utilisateur plainte.</span><span class="sxs-lookup"><span data-stu-id="97794-126">Next the application loops through the <xref:System.Printing.PrintSystemJobInfo> collection and compares each <xref:System.Printing.PrintSystemJobInfo.Submitter%2A> property with the alias of the complaining user.</span></span> <span data-ttu-id="97794-127">En cas de correspondance, l’application ajoute les informations d’identification sur le travail dans la chaîne qui s’affiche.</span><span class="sxs-lookup"><span data-stu-id="97794-127">If they match, the application adds identifying information about the job to the string that will be presented.</span></span> <span data-ttu-id="97794-128">(Les variables `userName` et `jobList` sont initialisées plus tôt dans l’application.)</span><span class="sxs-lookup"><span data-stu-id="97794-128">(The `userName` and `jobList` variables are initialized earlier in the application.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#enumeratejobsinqueues)]
 [!code-csharp[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#enumeratejobsinqueues)]
 [!code-vb[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#enumeratejobsinqueues)]  
  
 <span data-ttu-id="97794-129">L’exemple de code suivant récupère l’application à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="97794-129">The next code example picks up the application at Step 2.</span></span> <span data-ttu-id="97794-130">(Voir ci-dessus). Le travail problématique a été identifié et l’application demande les informations d’identification correspondantes.</span><span class="sxs-lookup"><span data-stu-id="97794-130">(See above.) The problematic job has been identified and the application prompts for the information that will identify it.</span></span> <span data-ttu-id="97794-131">À partir de ces informations, il crée <xref:System.Printing.PrintServer>, <xref:System.Printing.PrintQueue>, et <xref:System.Printing.PrintSystemJobInfo> objets.</span><span class="sxs-lookup"><span data-stu-id="97794-131">From this information it creates <xref:System.Printing.PrintServer>, <xref:System.Printing.PrintQueue>, and <xref:System.Printing.PrintSystemJobInfo> objects.</span></span>  
  
 <span data-ttu-id="97794-132">À ce stade, l’application contient une structure en branches correspondant aux deux méthodes de vérification de l’état du travail d’impression :</span><span class="sxs-lookup"><span data-stu-id="97794-132">At this point the application contains a branching structure corresponding to the two ways of checking a print job's status:</span></span>  
  
- <span data-ttu-id="97794-133">Vous pouvez lire les indicateurs de la <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> propriété qui est de type <xref:System.Printing.PrintJobStatus>.</span><span class="sxs-lookup"><span data-stu-id="97794-133">You can read the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property which is of type <xref:System.Printing.PrintJobStatus>.</span></span>  
  
- <span data-ttu-id="97794-134">Vous pouvez lire chaque propriété pertinente comme <xref:System.Printing.PrintSystemJobInfo.IsBlocked%2A> et <xref:System.Printing.PrintSystemJobInfo.IsInError%2A>.</span><span class="sxs-lookup"><span data-stu-id="97794-134">You can read each relevant property such as <xref:System.Printing.PrintSystemJobInfo.IsBlocked%2A> and <xref:System.Printing.PrintSystemJobInfo.IsInError%2A>.</span></span>  
  
 <span data-ttu-id="97794-135">Cet exemple illustre les deux méthodes, l’utilisateur a été auparavant invité à choisir la méthode à utiliser et a répondu par « Y » qu’il souhaitait utiliser les indicateurs de le <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> propriété.</span><span class="sxs-lookup"><span data-stu-id="97794-135">This example demonstrates both methods, so the user was previously prompted as to which method to use and responded with "Y" if he or she wanted to use the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property.</span></span> <span data-ttu-id="97794-136">Voir ci-dessous pour obtenir des informations détaillées sur les deux méthodes.</span><span class="sxs-lookup"><span data-stu-id="97794-136">See below for the details of the two methods.</span></span> <span data-ttu-id="97794-137">Enfin, l’application utilise une méthode appelée **ReportQueueAndJobAvailability** pour déterminer si le travail peut être imprimé à cette heure de la journée.</span><span class="sxs-lookup"><span data-stu-id="97794-137">Finally, the application uses a method called **ReportQueueAndJobAvailability** to report on whether the job can be printed at this time of day.</span></span> <span data-ttu-id="97794-138">Cette méthode est décrite dans l’article [Déterminer si un travail d’impression peut être imprimé à cette heure de la journée](how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day.md).</span><span class="sxs-lookup"><span data-stu-id="97794-138">This method is discussed in [Discover Whether a Print Job Can Be Printed At This Time of Day](how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day.md).</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#identifyanddiagnoseproblematicjob)]
 [!code-csharp[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#identifyanddiagnoseproblematicjob)]
 [!code-vb[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#identifyanddiagnoseproblematicjob)]  
  
 <span data-ttu-id="97794-139">Pour vérifier l’état du travail d’impression à l’aide des indicateurs de le <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> propriété, vérifier chaque indicateur correspondant pour voir si elle est définie.</span><span class="sxs-lookup"><span data-stu-id="97794-139">To check print job status using the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property, you check each relevant flag to see if it is set.</span></span> <span data-ttu-id="97794-140">La méthode standard pour voir si un bit est défini dans un ensemble d’indicateurs binaires consiste à effectuer une opération AND logique en utilisant comme opérandes l’ensemble d’indicateurs et l’indicateur lui-même.</span><span class="sxs-lookup"><span data-stu-id="97794-140">The standard way to see if one bit is set in a set of bit flags is to perform a logical AND operation with the set of flags as one operand and the flag itself as the other.</span></span> <span data-ttu-id="97794-141">Étant donné que l’indicateur lui-même n’a qu’un seul bit de défini, l’opération AND logique ne peut pas trouver plus d’un même bit défini.</span><span class="sxs-lookup"><span data-stu-id="97794-141">Since the flag itself has only one bit set, the result of the logical AND is that, at most, that same bit is set.</span></span> <span data-ttu-id="97794-142">Pour savoir si c’est bien le cas, il suffit de comparer le résultat de l’opération AND logique avec l’indicateur lui-même.</span><span class="sxs-lookup"><span data-stu-id="97794-142">To find out whether it is or not, just compare the result of the logical AND with the flag itself.</span></span> <span data-ttu-id="97794-143">Pour plus d’informations, consultez <xref:System.Printing.PrintJobStatus>, le [& opérateur (C# référence)](~/docs/csharp/language-reference/operators/bitwise-and-shift-operators.md#logical-and-operator-), et <xref:System.FlagsAttribute>.</span><span class="sxs-lookup"><span data-stu-id="97794-143">For more information, see <xref:System.Printing.PrintJobStatus>, the [& Operator (C# Reference)](~/docs/csharp/language-reference/operators/bitwise-and-shift-operators.md#logical-and-operator-), and <xref:System.FlagsAttribute>.</span></span>  
  
 <span data-ttu-id="97794-144">Pour chaque attribut dont le bit est défini, le code l’indique sur l’écran de la console et propose parfois une réponse possible.</span><span class="sxs-lookup"><span data-stu-id="97794-144">For each attribute whose bit is set, the code reports this to the console screen and sometimes suggests a way to respond.</span></span> <span data-ttu-id="97794-145">(La méthode **HandlePausedJob** qui est appelée si le travail ou la file d’attente est suspendu(e) est décrite ci-après.)</span><span class="sxs-lookup"><span data-stu-id="97794-145">(The **HandlePausedJob** method that is called if the job or queue is paused is discussed below.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#spottroubleusingjobattributes)]
 [!code-csharp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#spottroubleusingjobattributes)]
 [!code-vb[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#spottroubleusingjobattributes)]  
  
 <span data-ttu-id="97794-146">Pour vérifier l’état du travail d’impression à l’aide de propriétés distinctes, il vous suffit de lire chaque propriété, et si la propriété est `true`, de l’indiquer sur l’écran de la console et de proposer éventuellement une réponse possible.</span><span class="sxs-lookup"><span data-stu-id="97794-146">To check print job status using separate properties, you simply read each property and, if the property is `true`, report to the console screen and possibly suggest a way to respond.</span></span> <span data-ttu-id="97794-147">(La méthode **HandlePausedJob** qui est appelée si le travail ou la file d’attente est suspendu(e) est décrite ci-après.)</span><span class="sxs-lookup"><span data-stu-id="97794-147">(The **HandlePausedJob** method that is called if the job or queue is paused is discussed below.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#spottroubleusingjobproperties)]
 [!code-csharp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#spottroubleusingjobproperties)]
 [!code-vb[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#spottroubleusingjobproperties)]  
  
 <span data-ttu-id="97794-148">La méthode **HandlePausedJob** permet à l’utilisateur de l’application de relancer à distance des travaux suspendus.</span><span class="sxs-lookup"><span data-stu-id="97794-148">The **HandlePausedJob** method enables the application's user to remotely resume paused jobs.</span></span> <span data-ttu-id="97794-149">Les files d’attente à l’impression étant généralement interrompues pour une bonne raison, la méthode commence par demander à l’utilisateur s’il souhaite la relancer ou non.</span><span class="sxs-lookup"><span data-stu-id="97794-149">Because there might be a good reason why the print queue was paused, the method begins by prompting for a user decision about whether to resume it.</span></span> <span data-ttu-id="97794-150">Si la réponse est « Y », puis le <xref:System.Printing.PrintQueue.Resume%2A?displayProperty=nameWithType> méthode est appelée.</span><span class="sxs-lookup"><span data-stu-id="97794-150">If the answer is "Y", then the <xref:System.Printing.PrintQueue.Resume%2A?displayProperty=nameWithType> method is called.</span></span>  
  
 <span data-ttu-id="97794-151">Ensuite, l’utilisateur doit décider si le travail lui-même doit reprendre, au cas où il aurait été suspendu indépendamment de la file d’attente à l’impression.</span><span class="sxs-lookup"><span data-stu-id="97794-151">Next the user is prompted to decide if the job itself should be resumed, just in case it is paused independently of the print queue.</span></span> <span data-ttu-id="97794-152">(Comparez <xref:System.Printing.PrintQueue.IsPaused%2A?displayProperty=nameWithType> et <xref:System.Printing.PrintSystemJobInfo.IsPaused%2A?displayProperty=nameWithType>.) Si la réponse est « Y », puis <xref:System.Printing.PrintSystemJobInfo.Resume%2A?displayProperty=nameWithType> est appelée ; sinon <xref:System.Printing.PrintSystemJobInfo.Cancel%2A> est appelée.</span><span class="sxs-lookup"><span data-stu-id="97794-152">(Compare <xref:System.Printing.PrintQueue.IsPaused%2A?displayProperty=nameWithType> and <xref:System.Printing.PrintSystemJobInfo.IsPaused%2A?displayProperty=nameWithType>.) If the answer is "Y", then <xref:System.Printing.PrintSystemJobInfo.Resume%2A?displayProperty=nameWithType> is called; otherwise <xref:System.Printing.PrintSystemJobInfo.Cancel%2A> is called.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#handlepausedjob)]
 [!code-csharp[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#handlepausedjob)]
 [!code-vb[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#handlepausedjob)]  
  
## <a name="see-also"></a><span data-ttu-id="97794-153">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="97794-153">See also</span></span>

- <xref:System.Printing.PrintJobStatus>
- <xref:System.Printing.PrintSystemJobInfo>
- <xref:System.FlagsAttribute>
- <xref:System.Printing.PrintQueue>
- [<span data-ttu-id="97794-154">& Opérateur (C# référence)</span><span class="sxs-lookup"><span data-stu-id="97794-154">& Operator (C# Reference)</span></span>](~/docs/csharp/language-reference/operators/bitwise-and-shift-operators.md#logical-and-operator-)
- [<span data-ttu-id="97794-155">Documents dans WPF</span><span class="sxs-lookup"><span data-stu-id="97794-155">Documents in WPF</span></span>](documents-in-wpf.md)
- [<span data-ttu-id="97794-156">Vue d’ensemble de l’impression</span><span class="sxs-lookup"><span data-stu-id="97794-156">Printing Overview</span></span>](printing-overview.md)

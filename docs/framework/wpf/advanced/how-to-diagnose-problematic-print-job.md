---
title: "Comment : diagnostiquer un travail d'impression problématique"
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- troubleshooting print job problems [WPF]
- print jobs [WPF], troubleshooting
- print jobs [WPF], diagnosing problems
ms.assetid: b081a170-84c6-48f9-a487-5766a8d58a82
ms.openlocfilehash: 15de5d9ec8dc4016753b9d4cbed6fb0c64571774
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79186047"
---
# <a name="how-to-diagnose-problematic-print-job"></a><span data-ttu-id="8b8d7-102">Comment : diagnostiquer un travail d'impression problématique</span><span class="sxs-lookup"><span data-stu-id="8b8d7-102">How to: Diagnose Problematic Print Job</span></span>
<span data-ttu-id="8b8d7-103">Les administrateurs réseau reçoivent souvent des plaintes d’utilisateurs concernant des travaux d’impression qui échouent ou s’impriment lentement.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-103">Network administrators often field complaints from users about print jobs that do not print or print slowly.</span></span> <span data-ttu-id="8b8d7-104">Le riche ensemble de propriétés d’emploi d’impression exposées dans les API de Microsoft .NET Framework fournissent un moyen d’effectuer un diagnostic rapide à distance des travaux d’impression.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-104">The rich set of print job properties exposed in the APIs of Microsoft .NET Framework provide a means for performing a rapid remote diagnosis of print jobs.</span></span>  
  
## <a name="example"></a><span data-ttu-id="8b8d7-105"> Exemple</span><span class="sxs-lookup"><span data-stu-id="8b8d7-105">Example</span></span>  
 <span data-ttu-id="8b8d7-106">Voici les principales étapes à suivre pour créer ce type d’utilitaire.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-106">The major steps for creating this kind of utility are as follows.</span></span>  
  
1. <span data-ttu-id="8b8d7-107">Identifiez le travail d’impression à l’origine de la plainte de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-107">Identify the print job that the user is complaining about.</span></span> <span data-ttu-id="8b8d7-108">Les utilisateurs sont rarement en mesure de l’identifier avec précision.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-108">Users often cannot do this precisely.</span></span> <span data-ttu-id="8b8d7-109">Ils peuvent par exemple ne pas connaître les noms des serveurs d’impression ou des imprimantes.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-109">They may not know the names of the print servers or printers.</span></span> <span data-ttu-id="8b8d7-110">Ils peuvent décrire l’emplacement de l’imprimante dans <xref:System.Printing.PrintQueue.Location%2A> une terminologie différente de celle utilisée pour définir sa propriété.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-110">They may describe the location of the printer in different terminology than was used in setting its <xref:System.Printing.PrintQueue.Location%2A> property.</span></span> <span data-ttu-id="8b8d7-111">Par conséquent, il est judicieux de générer une liste des travaux envoyés par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-111">Accordingly, it is a good idea to generate a list of the user's currently submitted jobs.</span></span> <span data-ttu-id="8b8d7-112">S’il y en a plusieurs, l’utilisateur peut contacter l’administrateur du système d’impression pour identifier le travail qui pose problème.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-112">If there is more than one, then communication between the user and the print system administrator can be used to pinpoint the job that is having problems.</span></span> <span data-ttu-id="8b8d7-113">La procédure est la suivante.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-113">The substeps are as follows.</span></span>  
  
    1. <span data-ttu-id="8b8d7-114">Répertoriez l’ensemble des serveurs d’impression.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-114">Obtain a list of all print servers.</span></span>  
  
    2. <span data-ttu-id="8b8d7-115">Parcourez les serveurs en boucle pour interroger leurs files d’attente à l’impression.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-115">Loop through the servers to query their print queues.</span></span>  
  
    3. <span data-ttu-id="8b8d7-116">À chaque étape de la boucle de serveur, parcourez en boucle toutes les files d’attente du serveur pour interroger les travaux associés.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-116">Within each pass of the server loop, loop through all the server's queues to query their jobs</span></span>  
  
    4. <span data-ttu-id="8b8d7-117">À chaque étape de la boucle de file d’attente, parcourez les travaux associés et collectez les informations d’identification des travaux ayant été envoyés par l’utilisateur à l’origine de la plainte.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-117">Within each pass of the queue loop, loop through its jobs and gather identifying information about those that were submitted by the complaining user.</span></span>  
  
2. <span data-ttu-id="8b8d7-118">Une fois le travail d’impression problématique identifié, examinez les propriétés pertinentes pour tenter de trouver ce qui pose problème.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-118">When the problematic print job has been identified, examine relevant properties to see what might be the problem.</span></span> <span data-ttu-id="8b8d7-119">Le travail affiche-t-il un état d’erreur ou l’imprimante qui traite la file d’attente a-t-elle été déconnectée avant l’impression du travail ?</span><span class="sxs-lookup"><span data-stu-id="8b8d7-119">For example, is job in an error state or did the printer servicing the queue go offline before the job could print?</span></span>  
  
 <span data-ttu-id="8b8d7-120">Le code ci-dessous constitue une série d’exemples de code.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-120">The code below is series of code examples.</span></span> <span data-ttu-id="8b8d7-121">Le premier exemple de code contient la boucle d’exécution des files d’attente à l’impression.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-121">The first code example contains the loop through the print queues.</span></span> <span data-ttu-id="8b8d7-122">(Étape 1c ci-dessus.) La `myPrintQueues` variable <xref:System.Printing.PrintQueueCollection> est l’objet pour le serveur d’impression actuel.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-122">(Step 1c above.) The variable `myPrintQueues` is the <xref:System.Printing.PrintQueueCollection> object for the current print server.</span></span>  
  
 <span data-ttu-id="8b8d7-123">L’exemple de code commence par <xref:System.Printing.PrintQueue.Refresh%2A?displayProperty=nameWithType>rafraîchir l’objet actuel de file d’attente d’impression avec .</span><span class="sxs-lookup"><span data-stu-id="8b8d7-123">The code example begins by refreshing the current print queue object with <xref:System.Printing.PrintQueue.Refresh%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="8b8d7-124">Cela permet de s’assurer que les propriétés de l’objet représentent avec exactitude l’état de l’imprimante physique à laquelle l’objet est associé.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-124">This ensures that the object's properties accurately represent the state of the physical printer that it represents.</span></span> <span data-ttu-id="8b8d7-125">Ensuite, l’application obtient la collection de travaux <xref:System.Printing.PrintQueue.GetPrintJobInfoCollection%2A>d’impression actuellement dans la file d’attente d’impression en utilisant .</span><span class="sxs-lookup"><span data-stu-id="8b8d7-125">Then the application gets the collection of print jobs currently in the print queue by using <xref:System.Printing.PrintQueue.GetPrintJobInfoCollection%2A>.</span></span>  
  
 <span data-ttu-id="8b8d7-126">Ensuite, l’application <xref:System.Printing.PrintSystemJobInfo> boucle à travers <xref:System.Printing.PrintSystemJobInfo.Submitter%2A> la collection et compare chaque propriété avec le pseudonyme de l’utilisateur plaignant.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-126">Next the application loops through the <xref:System.Printing.PrintSystemJobInfo> collection and compares each <xref:System.Printing.PrintSystemJobInfo.Submitter%2A> property with the alias of the complaining user.</span></span> <span data-ttu-id="8b8d7-127">En cas de correspondance, l’application ajoute les informations d’identification sur le travail dans la chaîne qui s’affiche.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-127">If they match, the application adds identifying information about the job to the string that will be presented.</span></span> <span data-ttu-id="8b8d7-128">(Les variables `userName` et `jobList` sont initialisées plus tôt dans l’application.)</span><span class="sxs-lookup"><span data-stu-id="8b8d7-128">(The `userName` and `jobList` variables are initialized earlier in the application.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#enumeratejobsinqueues)]
 [!code-csharp[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#enumeratejobsinqueues)]
 [!code-vb[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#enumeratejobsinqueues)]  
  
 <span data-ttu-id="8b8d7-129">L’exemple de code suivant récupère l’application à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-129">The next code example picks up the application at Step 2.</span></span> <span data-ttu-id="8b8d7-130">(Voir ci-dessus.) Le travail problématique a été identifié et la demande invite à l’information qui l’identifiera.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-130">(See above.) The problematic job has been identified and the application prompts for the information that will identify it.</span></span> <span data-ttu-id="8b8d7-131">A partir de <xref:System.Printing.PrintServer> <xref:System.Printing.PrintQueue>cette <xref:System.Printing.PrintSystemJobInfo> information, il crée , , et des objets.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-131">From this information it creates <xref:System.Printing.PrintServer>, <xref:System.Printing.PrintQueue>, and <xref:System.Printing.PrintSystemJobInfo> objects.</span></span>  
  
 <span data-ttu-id="8b8d7-132">À ce stade, l’application contient une structure en branches correspondant aux deux méthodes de vérification de l’état du travail d’impression :</span><span class="sxs-lookup"><span data-stu-id="8b8d7-132">At this point the application contains a branching structure corresponding to the two ways of checking a print job's status:</span></span>  
  
- <span data-ttu-id="8b8d7-133">Vous pouvez lire les <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> drapeaux de <xref:System.Printing.PrintJobStatus>la propriété qui est de type .</span><span class="sxs-lookup"><span data-stu-id="8b8d7-133">You can read the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property which is of type <xref:System.Printing.PrintJobStatus>.</span></span>  
  
- <span data-ttu-id="8b8d7-134">Vous pouvez lire chaque <xref:System.Printing.PrintSystemJobInfo.IsBlocked%2A> propriété <xref:System.Printing.PrintSystemJobInfo.IsInError%2A>pertinente telle que et .</span><span class="sxs-lookup"><span data-stu-id="8b8d7-134">You can read each relevant property such as <xref:System.Printing.PrintSystemJobInfo.IsBlocked%2A> and <xref:System.Printing.PrintSystemJobInfo.IsInError%2A>.</span></span>  
  
 <span data-ttu-id="8b8d7-135">Cet exemple montre les deux méthodes, de sorte que l’utilisateur a été précédemment invité à quelle <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> méthode à utiliser et a répondu avec "Y" s’ils voulaient utiliser les drapeaux de la propriété.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-135">This example demonstrates both methods, so the user was previously prompted as to which method to use and responded with "Y" if they wanted to use the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property.</span></span> <span data-ttu-id="8b8d7-136">Voir ci-dessous pour obtenir des informations détaillées sur les deux méthodes.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-136">See below for the details of the two methods.</span></span> <span data-ttu-id="8b8d7-137">Enfin, l’application utilise une méthode appelée **ReportQueueAndJobAvailability** pour déterminer si le travail peut être imprimé à cette heure de la journée.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-137">Finally, the application uses a method called **ReportQueueAndJobAvailability** to report on whether the job can be printed at this time of day.</span></span> <span data-ttu-id="8b8d7-138">Cette méthode est décrite dans l’article [Déterminer si un travail d’impression peut être imprimé à cette heure de la journée](how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day.md).</span><span class="sxs-lookup"><span data-stu-id="8b8d7-138">This method is discussed in [Discover Whether a Print Job Can Be Printed At This Time of Day](how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day.md).</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#identifyanddiagnoseproblematicjob)]
 [!code-csharp[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#identifyanddiagnoseproblematicjob)]
 [!code-vb[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#identifyanddiagnoseproblematicjob)]  
  
 <span data-ttu-id="8b8d7-139">Pour vérifier l’état d’impression de travail en utilisant les drapeaux de la <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> propriété, vous vérifiez chaque drapeau pertinent pour voir si elle est définie.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-139">To check print job status using the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property, you check each relevant flag to see if it is set.</span></span> <span data-ttu-id="8b8d7-140">La méthode standard pour voir si un bit est défini dans un ensemble d’indicateurs binaires consiste à effectuer une opération AND logique en utilisant comme opérandes l’ensemble d’indicateurs et l’indicateur lui-même.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-140">The standard way to see if one bit is set in a set of bit flags is to perform a logical AND operation with the set of flags as one operand and the flag itself as the other.</span></span> <span data-ttu-id="8b8d7-141">Étant donné que l’indicateur lui-même n’a qu’un seul bit de défini, l’opération AND logique ne peut pas trouver plus d’un même bit défini.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-141">Since the flag itself has only one bit set, the result of the logical AND is that, at most, that same bit is set.</span></span> <span data-ttu-id="8b8d7-142">Pour savoir si c’est bien le cas, il suffit de comparer le résultat de l’opération AND logique avec l’indicateur lui-même.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-142">To find out whether it is or not, just compare the result of the logical AND with the flag itself.</span></span> <span data-ttu-id="8b8d7-143">Pour plus d’informations, voir <xref:System.Printing.PrintJobStatus>, [l’opérateur& (référence C)](../../../csharp/language-reference/operators/bitwise-and-shift-operators.md#logical-and-operator-), et <xref:System.FlagsAttribute>.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-143">For more information, see <xref:System.Printing.PrintJobStatus>, the [& Operator (C# Reference)](../../../csharp/language-reference/operators/bitwise-and-shift-operators.md#logical-and-operator-), and <xref:System.FlagsAttribute>.</span></span>  
  
 <span data-ttu-id="8b8d7-144">Pour chaque attribut dont le bit est défini, le code l’indique sur l’écran de la console et propose parfois une réponse possible.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-144">For each attribute whose bit is set, the code reports this to the console screen and sometimes suggests a way to respond.</span></span> <span data-ttu-id="8b8d7-145">(La méthode **HandlePausedJob** qui est appelée si le travail ou la file d’attente est suspendu(e) est décrite ci-après.)</span><span class="sxs-lookup"><span data-stu-id="8b8d7-145">(The **HandlePausedJob** method that is called if the job or queue is paused is discussed below.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#spottroubleusingjobattributes)]
 [!code-csharp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#spottroubleusingjobattributes)]
 [!code-vb[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#spottroubleusingjobattributes)]  
  
 <span data-ttu-id="8b8d7-146">Pour vérifier l’état du travail d’impression à l’aide de propriétés distinctes, il vous suffit de lire chaque propriété, et si la propriété est `true`, de l’indiquer sur l’écran de la console et de proposer éventuellement une réponse possible.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-146">To check print job status using separate properties, you simply read each property and, if the property is `true`, report to the console screen and possibly suggest a way to respond.</span></span> <span data-ttu-id="8b8d7-147">(La méthode **HandlePausedJob** qui est appelée si le travail ou la file d’attente est suspendu(e) est décrite ci-après.)</span><span class="sxs-lookup"><span data-stu-id="8b8d7-147">(The **HandlePausedJob** method that is called if the job or queue is paused is discussed below.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#spottroubleusingjobproperties)]
 [!code-csharp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#spottroubleusingjobproperties)]
 [!code-vb[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#spottroubleusingjobproperties)]  
  
 <span data-ttu-id="8b8d7-148">La méthode **HandlePausedJob** permet à l’utilisateur de l’application de relancer à distance des travaux suspendus.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-148">The **HandlePausedJob** method enables the application's user to remotely resume paused jobs.</span></span> <span data-ttu-id="8b8d7-149">Les files d’attente à l’impression étant généralement interrompues pour une bonne raison, la méthode commence par demander à l’utilisateur s’il souhaite la relancer ou non.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-149">Because there might be a good reason why the print queue was paused, the method begins by prompting for a user decision about whether to resume it.</span></span> <span data-ttu-id="8b8d7-150">Si la réponse est "Y", alors la <xref:System.Printing.PrintQueue.Resume%2A?displayProperty=nameWithType> méthode est appelée.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-150">If the answer is "Y", then the <xref:System.Printing.PrintQueue.Resume%2A?displayProperty=nameWithType> method is called.</span></span>  
  
 <span data-ttu-id="8b8d7-151">Ensuite, l’utilisateur doit décider si le travail lui-même doit reprendre, au cas où il aurait été suspendu indépendamment de la file d’attente à l’impression.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-151">Next the user is prompted to decide if the job itself should be resumed, just in case it is paused independently of the print queue.</span></span> <span data-ttu-id="8b8d7-152">(Comparer <xref:System.Printing.PrintQueue.IsPaused%2A?displayProperty=nameWithType> <xref:System.Printing.PrintSystemJobInfo.IsPaused%2A?displayProperty=nameWithType>et .) Si la réponse est <xref:System.Printing.PrintSystemJobInfo.Resume%2A?displayProperty=nameWithType> "Y", alors est appelé; autrement <xref:System.Printing.PrintSystemJobInfo.Cancel%2A> est appelé.</span><span class="sxs-lookup"><span data-stu-id="8b8d7-152">(Compare <xref:System.Printing.PrintQueue.IsPaused%2A?displayProperty=nameWithType> and <xref:System.Printing.PrintSystemJobInfo.IsPaused%2A?displayProperty=nameWithType>.) If the answer is "Y", then <xref:System.Printing.PrintSystemJobInfo.Resume%2A?displayProperty=nameWithType> is called; otherwise <xref:System.Printing.PrintSystemJobInfo.Cancel%2A> is called.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#handlepausedjob)]
 [!code-csharp[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#handlepausedjob)]
 [!code-vb[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#handlepausedjob)]  
  
## <a name="see-also"></a><span data-ttu-id="8b8d7-153">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="8b8d7-153">See also</span></span>

- <xref:System.Printing.PrintJobStatus>
- <xref:System.Printing.PrintSystemJobInfo>
- <xref:System.FlagsAttribute>
- <xref:System.Printing.PrintQueue>
- [<span data-ttu-id="8b8d7-154">& opérateur (référence C)</span><span class="sxs-lookup"><span data-stu-id="8b8d7-154">& Operator (C# Reference)</span></span>](../../../csharp/language-reference/operators/bitwise-and-shift-operators.md#logical-and-operator-)
- [<span data-ttu-id="8b8d7-155">Documents dans WPF</span><span class="sxs-lookup"><span data-stu-id="8b8d7-155">Documents in WPF</span></span>](documents-in-wpf.md)
- [<span data-ttu-id="8b8d7-156">Vue d'ensemble de l'impression</span><span class="sxs-lookup"><span data-stu-id="8b8d7-156">Printing Overview</span></span>](printing-overview.md)

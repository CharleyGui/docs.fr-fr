---
title: 'Procédure : Déterminer si un travail d’impression peut être imprimé à cette heure de la journée'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- print queues [WPF], timing
- printers [WPF], availability
- print jobs [WPF], timing
ms.assetid: 7e9c8ec1-abf6-4b3d-b1c6-33b35d3c4063
ms.openlocfilehash: 859dc75169e443d07361951692a428507886fa2e
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/22/2019
ms.locfileid: "69947808"
---
# <a name="how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day"></a><span data-ttu-id="1cfab-102">Procédure : Déterminer si un travail d’impression peut être imprimé à cette heure de la journée</span><span class="sxs-lookup"><span data-stu-id="1cfab-102">How to: Discover Whether a Print Job Can Be Printed At This Time of Day</span></span>
<span data-ttu-id="1cfab-103">Les files d’attente à l’impression ne sont pas toujours disponibles pendant 24 heures par jour.</span><span class="sxs-lookup"><span data-stu-id="1cfab-103">Print queues are not always available for 24 hours a day.</span></span> <span data-ttu-id="1cfab-104">Ils ont des propriétés d’heure de début et de fin qui peuvent être définies pour les rendre indisponibles à certaines heures de la journée.</span><span class="sxs-lookup"><span data-stu-id="1cfab-104">They have start and end time properties that can be set to make them unavailable at certain times of day.</span></span> <span data-ttu-id="1cfab-105">Cette fonctionnalité peut être utilisée, par exemple, pour réserver une imprimante à l’usage exclusif d’un certain service après 17h00.</span><span class="sxs-lookup"><span data-stu-id="1cfab-105">This feature can be used, for example, to reserve a printer for the exclusive use of a certain department after 5 P.M..</span></span> <span data-ttu-id="1cfab-106">Ce service dispose d’une file d’attente différente de celle utilisée par les autres services.</span><span class="sxs-lookup"><span data-stu-id="1cfab-106">That department would have a different queue servicing the printer than other departments use.</span></span> <span data-ttu-id="1cfab-107">La file d’attente des autres services est définie pour être indisponible après 17h00, tandis que la file d’attente pour le service favorisé peut être configurée pour être disponible à tout moment.</span><span class="sxs-lookup"><span data-stu-id="1cfab-107">The queue for the other departments would be set to be unavailable after 5 P.M., while queue for the favored department could be set to be available at all times.</span></span>  
  
 <span data-ttu-id="1cfab-108">En outre, les travaux d’impression peuvent être configurés pour être imprimables uniquement dans un intervalle de temps spécifié.</span><span class="sxs-lookup"><span data-stu-id="1cfab-108">Moreover, print jobs themselves can be set to be printable only within a specified span of time.</span></span>  
  
 <span data-ttu-id="1cfab-109">Les <xref:System.Printing.PrintQueue> classes <xref:System.Printing.PrintSystemJobInfo> et exposées dans les API de Microsoft .NET Framework fournissent un moyen de vérifier à distance si un travail d’impression donné peut imprimer sur une file d’attente donnée à l’heure actuelle.</span><span class="sxs-lookup"><span data-stu-id="1cfab-109">The <xref:System.Printing.PrintQueue> and <xref:System.Printing.PrintSystemJobInfo> classes exposed in the APIs of Microsoft .NET Framework provide a means for remotely checking whether a given print job can print on a given queue at the current time.</span></span>  
  
## <a name="example"></a><span data-ttu-id="1cfab-110">Exemple</span><span class="sxs-lookup"><span data-stu-id="1cfab-110">Example</span></span>  
 <span data-ttu-id="1cfab-111">L’exemple ci-dessous est un exemple qui peut diagnostiquer les problèmes liés à un travail d’impression.</span><span class="sxs-lookup"><span data-stu-id="1cfab-111">The example below is a sample that can diagnose problems with a print job.</span></span>  
  
 <span data-ttu-id="1cfab-112">Il existe deux étapes principales pour ce type de fonction, comme suit.</span><span class="sxs-lookup"><span data-stu-id="1cfab-112">There are two major steps for this kind of function as follows.</span></span>  
  
1. <span data-ttu-id="1cfab-113">Lisez les <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> propriétés <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> et de l' <xref:System.Printing.PrintQueue> objet pour déterminer si l’heure actuelle est comprise entre ces deux éléments.</span><span class="sxs-lookup"><span data-stu-id="1cfab-113">Read the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties of the <xref:System.Printing.PrintQueue> to determine whether the current time is between them.</span></span>  
  
2. <span data-ttu-id="1cfab-114">Lisez les <xref:System.Printing.PrintSystemJobInfo.StartTimeOfDay%2A> propriétés <xref:System.Printing.PrintSystemJobInfo.UntilTimeOfDay%2A> et de l' <xref:System.Printing.PrintSystemJobInfo> objet pour déterminer si l’heure actuelle est comprise entre ces deux éléments.</span><span class="sxs-lookup"><span data-stu-id="1cfab-114">Read the <xref:System.Printing.PrintSystemJobInfo.StartTimeOfDay%2A> and <xref:System.Printing.PrintSystemJobInfo.UntilTimeOfDay%2A> properties of the <xref:System.Printing.PrintSystemJobInfo> to determine whether the current time is between them.</span></span>  
  
 <span data-ttu-id="1cfab-115">Mais les complications proviennent du fait que ces propriétés ne sont <xref:System.DateTime> pas des objets.</span><span class="sxs-lookup"><span data-stu-id="1cfab-115">But complications arise from the fact that these properties are not <xref:System.DateTime> objects.</span></span> <span data-ttu-id="1cfab-116">Au lieu de <xref:System.Int32> cela, il s’agit d’objets qui expriment l’heure de la journée comme nombre de minutes depuis minuit.</span><span class="sxs-lookup"><span data-stu-id="1cfab-116">Instead they are <xref:System.Int32> objects that express the time of day as the number of minutes since midnight.</span></span> <span data-ttu-id="1cfab-117">En outre, ce n’est pas minuit dans le fuseau horaire actuel, mais minuit UTC (temps universel coordonné).</span><span class="sxs-lookup"><span data-stu-id="1cfab-117">Moreover, this is not midnight in the current time zone, but midnight UTC (Coordinated Universal Time).</span></span>  
  
 <span data-ttu-id="1cfab-118">Le premier exemple de code présente la méthode statique **ReportQueueAndJobAvailability**, qui est passée <xref:System.Printing.PrintSystemJobInfo> à un et appelle les méthodes d’assistance pour déterminer si le travail peut imprimer à l’heure actuelle et, dans le cas contraire, s’il peut imprimer.</span><span class="sxs-lookup"><span data-stu-id="1cfab-118">The first code example presents the static method **ReportQueueAndJobAvailability**, which is passed a <xref:System.Printing.PrintSystemJobInfo> and calls helper methods to determine whether the job can print at the current time and, if not, when it can print.</span></span> <span data-ttu-id="1cfab-119">Notez qu’un <xref:System.Printing.PrintQueue> n’est pas passé à la méthode.</span><span class="sxs-lookup"><span data-stu-id="1cfab-119">Notice that a <xref:System.Printing.PrintQueue> is not passed to the method.</span></span> <span data-ttu-id="1cfab-120">Cela est dû au <xref:System.Printing.PrintSystemJobInfo> fait que le comprend une référence à la <xref:System.Printing.PrintSystemJobInfo.HostingPrintQueue%2A> file d’attente dans sa propriété.</span><span class="sxs-lookup"><span data-stu-id="1cfab-120">This is because the <xref:System.Printing.PrintSystemJobInfo> includes a reference to the queue in its <xref:System.Printing.PrintSystemJobInfo.HostingPrintQueue%2A> property.</span></span>  
  
 <span data-ttu-id="1cfab-121">Les méthodes subordonnées incluent la méthode **ReportAvailabilityAtThisTime** surchargée qui peut accepter <xref:System.Printing.PrintQueue> un ou <xref:System.Printing.PrintSystemJobInfo> un comme paramètre.</span><span class="sxs-lookup"><span data-stu-id="1cfab-121">The subordinate methods include the overloaded **ReportAvailabilityAtThisTime** method which can take either a <xref:System.Printing.PrintQueue> or a <xref:System.Printing.PrintSystemJobInfo> as a parameter.</span></span> <span data-ttu-id="1cfab-122">Il y a également un **TimeConverter. ConvertToLocalHumanReadableTime**.</span><span class="sxs-lookup"><span data-stu-id="1cfab-122">There is also a **TimeConverter.ConvertToLocalHumanReadableTime**.</span></span> <span data-ttu-id="1cfab-123">Toutes ces méthodes sont décrites ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="1cfab-123">All of these methods are discussed below.</span></span>  
  
 <span data-ttu-id="1cfab-124">La méthode **ReportQueueAndJobAvailability** commence par vérifier si la file d’attente ou le travail d’impression n’est pas disponible pour l’instant.</span><span class="sxs-lookup"><span data-stu-id="1cfab-124">The **ReportQueueAndJobAvailability** method begins by checking to see if either the queue or the print job is unavailable at this time.</span></span> <span data-ttu-id="1cfab-125">Si l’un de ces éléments n’est pas disponible, il vérifie ensuite si la file d’attente n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="1cfab-125">If either of them is unavailable, it then checks to see if the queue unavailable.</span></span> <span data-ttu-id="1cfab-126">S’il n’est pas disponible, la méthode signale ce fait et l’heure à laquelle la file d’attente redevient disponible.</span><span class="sxs-lookup"><span data-stu-id="1cfab-126">If it is not available, then the method reports this fact and the time when the queue will become available again.</span></span> <span data-ttu-id="1cfab-127">Il vérifie ensuite la tâche et, si elle est indisponible, elle signale la prochaine période quand elle peut imprimer.</span><span class="sxs-lookup"><span data-stu-id="1cfab-127">It then checks the job and if it is unavailable, it reports the next time span when it when it can print.</span></span> <span data-ttu-id="1cfab-128">Enfin, la méthode indique l’heure la plus proche à laquelle le travail peut imprimer.</span><span class="sxs-lookup"><span data-stu-id="1cfab-128">Finally, the method reports the earliest time when the job can print.</span></span> <span data-ttu-id="1cfab-129">Il s’agit de la version la plus récente de deux fois.</span><span class="sxs-lookup"><span data-stu-id="1cfab-129">This is the later of following two times.</span></span>  
  
- <span data-ttu-id="1cfab-130">Heure à laquelle la file d’attente à l’impression est ensuite disponible.</span><span class="sxs-lookup"><span data-stu-id="1cfab-130">The time when the print queue is next available.</span></span>  
  
- <span data-ttu-id="1cfab-131">Heure à laquelle le travail d’impression est disponible.</span><span class="sxs-lookup"><span data-stu-id="1cfab-131">The time when the print job is next available.</span></span>  
  
 <span data-ttu-id="1cfab-132">Lors du signalement des heures de <xref:System.DateTime.ToShortTimeString%2A> la journée, la méthode est également appelée car cette méthode supprime les années, les mois et les jours de la sortie.</span><span class="sxs-lookup"><span data-stu-id="1cfab-132">When reporting times of day, the <xref:System.DateTime.ToShortTimeString%2A> method is also called because this method suppresses the years, months, and days from the output.</span></span> <span data-ttu-id="1cfab-133">Vous ne pouvez pas limiter la disponibilité d’une file d’attente à l’impression ou d’un travail d’impression à des années, des mois ou des jours spécifiques.</span><span class="sxs-lookup"><span data-stu-id="1cfab-133">You cannot restrict the availability of either a print queue or a print job to particular years, months, or days.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#reportqueueandjobavailability)]
 [!code-csharp[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#reportqueueandjobavailability)]
 [!code-vb[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#reportqueueandjobavailability)]  
  
 <span data-ttu-id="1cfab-134">Les deux surcharges de la méthode **ReportAvailabilityAtThisTime** sont identiques, à l’exception du type qui leur est passé, <xref:System.Printing.PrintQueue> c’est pourquoi seule la version est présentée ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="1cfab-134">The two overloads of the **ReportAvailabilityAtThisTime** method are identical except for the type passed to them, so only the <xref:System.Printing.PrintQueue> version is presented below.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="1cfab-135">Le fait que les méthodes soient identiques à l’exception du type soulève la question de la raison pour laquelle l’exemple ne crée pas de méthode générique **\<ReportAvailabilityAtThisTime T >** .</span><span class="sxs-lookup"><span data-stu-id="1cfab-135">The fact that the methods are identical except for type raises the question of why the sample does not create a generic method **ReportAvailabilityAtThisTime\<T>**.</span></span> <span data-ttu-id="1cfab-136">En effet, une telle méthode devrait être restreinte à une classe qui a les propriétés **StartTimeOfDay** et **UntilTimeOfDay** que la méthode appelle, mais une méthode générique ne peut être limitée qu’à une seule classe et la seule classe commune aux deux et, dans l’arborescence d' <xref:System.Printing.PrintSystemObject> héritage, n’a pas de propriétés de ce type. <xref:System.Printing.PrintSystemJobInfo> <xref:System.Printing.PrintQueue></span><span class="sxs-lookup"><span data-stu-id="1cfab-136">The reason is that such a method would have to be restricted to a class that has the **StartTimeOfDay** and **UntilTimeOfDay** properties that the method calls, but a generic method can only be restricted to a single class and the only class common to both <xref:System.Printing.PrintQueue> and <xref:System.Printing.PrintSystemJobInfo> in the inheritance tree is <xref:System.Printing.PrintSystemObject> which has no such properties.</span></span>  
  
 <span data-ttu-id="1cfab-137">La méthode **ReportAvailabilityAtThisTime** (présentée dans l’exemple de code ci-dessous) commence par <xref:System.Boolean> initialiser une `true`variable Sentinel à.</span><span class="sxs-lookup"><span data-stu-id="1cfab-137">The **ReportAvailabilityAtThisTime** method (presented in the code example below) begins by initializing a <xref:System.Boolean> sentinel variable to `true`.</span></span> <span data-ttu-id="1cfab-138">Elle est réinitialisée `false`à, si la file d’attente n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="1cfab-138">It will be reset to `false`, if the queue is not available.</span></span>  
  
 <span data-ttu-id="1cfab-139">Ensuite, la méthode vérifie si les heures de début et de fin sont identiques.</span><span class="sxs-lookup"><span data-stu-id="1cfab-139">Next, the method checks to see if the start and "until" times are identical.</span></span> <span data-ttu-id="1cfab-140">Si c’est le cas, la file d’attente est toujours disponible, `true`de sorte que la méthode retourne.</span><span class="sxs-lookup"><span data-stu-id="1cfab-140">If they are, the queue is always available, so the method returns `true`.</span></span>  
  
 <span data-ttu-id="1cfab-141">Si la file d’attente n’est pas disponible tout le temps, la méthode <xref:System.DateTime.UtcNow%2A> utilise la propriété statique pour obtenir l’heure <xref:System.DateTime> actuelle en tant qu’objet.</span><span class="sxs-lookup"><span data-stu-id="1cfab-141">If the queue is not available all the time, the method uses the static <xref:System.DateTime.UtcNow%2A> property to get the current time as a <xref:System.DateTime> object.</span></span> <span data-ttu-id="1cfab-142">(L’heure locale n’est pas nécessaire, <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> car <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> les propriétés et sont elles-mêmes en heure UTC.)</span><span class="sxs-lookup"><span data-stu-id="1cfab-142">(We do not need local time because the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties are themselves in UTC time.)</span></span>  
  
 <span data-ttu-id="1cfab-143">Toutefois, ces deux propriétés ne sont <xref:System.DateTime> pas des objets.</span><span class="sxs-lookup"><span data-stu-id="1cfab-143">However, these two properties are not <xref:System.DateTime> objects.</span></span> <span data-ttu-id="1cfab-144">Il s' <xref:System.Int32>agit de s exprimant le temps en tant que nombre de minutes-après l’heure UTC-minuit.</span><span class="sxs-lookup"><span data-stu-id="1cfab-144">They are <xref:System.Int32>s expressing the time as the number of minutes-after-UTC-midnight.</span></span> <span data-ttu-id="1cfab-145">Nous devons donc convertir notre <xref:System.DateTime> objet en minutes-après-minuit.</span><span class="sxs-lookup"><span data-stu-id="1cfab-145">So we do have to convert our <xref:System.DateTime> object to minutes-after-midnight.</span></span> <span data-ttu-id="1cfab-146">Lorsque cela est fait, la méthode vérifie simplement si «Now» se trouve entre les heures de début et de fin de la file d’attente, définit la sentinelle sur false si «Now» n’est pas entre les deux fois, et retourne la sentinelle.</span><span class="sxs-lookup"><span data-stu-id="1cfab-146">When that is done, the method simply checks to see whether "now" is between the queue's start and "until" times, sets the sentinel to false if "now" is not between the two times, and returns the sentinel.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#PrintQueueStartUntil](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#printqueuestartuntil)]
 [!code-csharp[DiagnoseProblematicPrintJob#PrintQueueStartUntil](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#printqueuestartuntil)]
 [!code-vb[DiagnoseProblematicPrintJob#PrintQueueStartUntil](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#printqueuestartuntil)]  
  
 <span data-ttu-id="1cfab-147">La méthode **TimeConverter. ConvertToLocalHumanReadableTime** (présentée dans l’exemple de code ci-dessous) n’utilise aucune des méthodes introduites avec Microsoft .NET Framework. la discussion est donc brève.</span><span class="sxs-lookup"><span data-stu-id="1cfab-147">The **TimeConverter.ConvertToLocalHumanReadableTime** method (presented in the code example below) does not use any methods introduced with Microsoft .NET Framework, so the discussion is brief.</span></span> <span data-ttu-id="1cfab-148">La méthode a une tâche de conversion double: elle doit prendre un entier exprimant minutes-après-minuit et la convertir en heure explicite et elle doit être convertie en heure locale.</span><span class="sxs-lookup"><span data-stu-id="1cfab-148">The method has a double conversion task: it must take an integer expressing minutes-after-midnight and convert it to a human-readable time and it must convert this to the local time.</span></span> <span data-ttu-id="1cfab-149">Pour ce faire, il commence par créer <xref:System.DateTime> un objet qui a la valeur UTC minuit, puis il utilise <xref:System.DateTime.AddMinutes%2A> la méthode pour ajouter les minutes passées à la méthode.</span><span class="sxs-lookup"><span data-stu-id="1cfab-149">It accomplishes this by first creating a <xref:System.DateTime> object that is set to midnight UTC and then it uses the <xref:System.DateTime.AddMinutes%2A> method to add the minutes that were passed to the method.</span></span> <span data-ttu-id="1cfab-150">Cela retourne un nouveau <xref:System.DateTime> exprimant l’heure d’origine passée à la méthode.</span><span class="sxs-lookup"><span data-stu-id="1cfab-150">This returns a new <xref:System.DateTime> expressing the original time that was passed to the method.</span></span> <span data-ttu-id="1cfab-151">La <xref:System.DateTime.ToLocalTime%2A> méthode convertit ensuite ce en heure locale.</span><span class="sxs-lookup"><span data-stu-id="1cfab-151">The <xref:System.DateTime.ToLocalTime%2A> method then converts this to local time.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#TimeConverter](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#timeconverter)]
 [!code-csharp[DiagnoseProblematicPrintJob#TimeConverter](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#timeconverter)]
 [!code-vb[DiagnoseProblematicPrintJob#TimeConverter](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#timeconverter)]  
  
## <a name="see-also"></a><span data-ttu-id="1cfab-152">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="1cfab-152">See also</span></span>

- <xref:System.DateTime>
- <xref:System.Printing.PrintSystemJobInfo>
- <xref:System.Printing.PrintQueue>
- [<span data-ttu-id="1cfab-153">Documents dans WPF</span><span class="sxs-lookup"><span data-stu-id="1cfab-153">Documents in WPF</span></span>](documents-in-wpf.md)
- [<span data-ttu-id="1cfab-154">Vue d’ensemble de l’impression</span><span class="sxs-lookup"><span data-stu-id="1cfab-154">Printing Overview</span></span>](printing-overview.md)

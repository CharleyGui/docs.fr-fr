---
title: Configuration de la journalisation des messages
ms.date: 03/30/2017
helpviewer_keywords:
- message logging [WCF]
ms.assetid: 0ff4c857-8f09-4b85-9dc0-89084706e4c9
ms.openlocfilehash: 5b4da744151d8b667c0f944b1a0d51d1251bfae5
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/28/2019
ms.locfileid: "64652011"
---
# <a name="configuring-message-logging"></a><span data-ttu-id="cd886-102">Configuration de la journalisation des messages</span><span class="sxs-lookup"><span data-stu-id="cd886-102">Configuring Message Logging</span></span>
<span data-ttu-id="cd886-103">Cette rubrique contient des instructions permettant de configurer l'enregistrement des messages en fonction de différentes situations.</span><span class="sxs-lookup"><span data-stu-id="cd886-103">This topic describes how you can configure message logging for different scenarios.</span></span>  
  
## <a name="enabling-message-logging"></a><span data-ttu-id="cd886-104">Activation de la journalisation des messages</span><span class="sxs-lookup"><span data-stu-id="cd886-104">Enabling Message Logging</span></span>  
 <span data-ttu-id="cd886-105">Windows Communication Foundation (WCF) ne consigne pas les messages par défaut.</span><span class="sxs-lookup"><span data-stu-id="cd886-105">Windows Communication Foundation (WCF) does not log messages by default.</span></span> <span data-ttu-id="cd886-106">Pour activer la journalisation des messages, vous devez ajouter un écouteur de suivi à la source de suivi `System.ServiceModel.MessageLogging` et définir les attributs de l'élément `<messagelogging>` dans le fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="cd886-106">To activate message logging, you must add a trace listener to the `System.ServiceModel.MessageLogging` trace source and set attributes for the `<messagelogging>` element in the configuration file.</span></span>  
  
 <span data-ttu-id="cd886-107">L'exemple suivant indique comment activer la journalisation et spécifier des options supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="cd886-107">The following example shows how to enable logging and specify additional options.</span></span>  
  
```xml  
<system.diagnostics>  
  <sources>  
    <source name="System.ServiceModel.MessageLogging">  
      <listeners>  
         <add name="messages"  
              type="System.Diagnostics.XmlWriterTraceListener"  
              initializeData="c:\logs\messages.svclog" />  
        </listeners>  
    </source>  
  </sources>  
</system.diagnostics>  
  
<system.serviceModel>  
  <diagnostics>  
    <messageLogging   
         logEntireMessage="true"   
         logMalformedMessages="false"  
         logMessagesAtServiceLevel="true"   
         logMessagesAtTransportLevel="false"  
         maxMessagesToLog="3000"  
         maxSizeOfMessageToLog="2000"/>  
  </diagnostics>  
</system.serviceModel>  
```  
  
 <span data-ttu-id="cd886-108">Pour plus d’informations sur les paramètres de journalisation des messages, consultez [paramètres recommandés pour le suivi et la journalisation des messages](../../../../docs/framework/wcf/diagnostics/tracing/recommended-settings-for-tracing-and-message-logging.md).</span><span class="sxs-lookup"><span data-stu-id="cd886-108">For more information about message logging settings, see [Recommended Settings for Tracing and Message Logging](../../../../docs/framework/wcf/diagnostics/tracing/recommended-settings-for-tracing-and-message-logging.md).</span></span>  
  
 <span data-ttu-id="cd886-109">Vous pouvez utiliser la méthode `add` afin d'indiquer le nom et type de l'écouteur de suivi à utiliser.</span><span class="sxs-lookup"><span data-stu-id="cd886-109">You can use `add` to specify the name and type of the listener you want to use.</span></span> <span data-ttu-id="cd886-110">Dans l'exemple de configuration, nous avons attribué le nom « messages » à l'écouteur et ajouté l'écouteur de suivi standard .NET Framework (`System.Diagnostics.XmlWriterTraceListener`) comme type à utiliser.</span><span class="sxs-lookup"><span data-stu-id="cd886-110">In the example configuration, the Listener is named "messages" and adds the standard .NET Framework trace listener (`System.Diagnostics.XmlWriterTraceListener`) as the type to use.</span></span> <span data-ttu-id="cd886-111">Si vous utilisez `System.Diagnostics.XmlWriterTraceListener`, vous devez spécifier l'emplacement et le nom du fichier de sortie dans le fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="cd886-111">If you use `System.Diagnostics.XmlWriterTraceListener`, you must specify the output file location and name in the configuration file.</span></span> <span data-ttu-id="cd886-112">Pour ce faire, il suffit d'affecter le nom du fichier journal à `initializeData`.</span><span class="sxs-lookup"><span data-stu-id="cd886-112">This is done by setting `initializeData` to the name of the log file.</span></span> <span data-ttu-id="cd886-113">Si cette consigne n'est pas respectée, le système lèvera une exception.</span><span class="sxs-lookup"><span data-stu-id="cd886-113">Otherwise, the system throws an exception.</span></span> <span data-ttu-id="cd886-114">Vous pouvez également implémenter un écouteur personnalisé qui enregistrera les journaux dans un fichier par défaut.</span><span class="sxs-lookup"><span data-stu-id="cd886-114">You can also implement a custom listener that emits logs to a default file.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="cd886-115">Puisque la journalisation des messages accède à l'espace disque, vous devez limiter le nombre des messages à enregistrer pour chaque service.</span><span class="sxs-lookup"><span data-stu-id="cd886-115">Because message logging accesses disk space, you should limit the number of messages that are written to disk for a particular service.</span></span> <span data-ttu-id="cd886-116">Cette limite atteinte, un message de suivi sera généré au niveau des informations et les messages cesseront d'être enregistrés.</span><span class="sxs-lookup"><span data-stu-id="cd886-116">When the message limit is reached, a trace at the Information level is produced and all message logging activities stop.</span></span>  
  
 <span data-ttu-id="cd886-117">Les niveaux d'enregistrement ainsi que d'autres options sont abordés dans la section Niveaux d'enregistrement et autres options.</span><span class="sxs-lookup"><span data-stu-id="cd886-117">The logging level, as well as the additional options, are discussed in the Logging Level and Options section.</span></span>  
  
 <span data-ttu-id="cd886-118">L'attribut `switchValue` d'une `source` est uniquement valable dans le cadre du suivi.</span><span class="sxs-lookup"><span data-stu-id="cd886-118">The `switchValue` attribute of a `source` is only valid for tracing.</span></span> <span data-ttu-id="cd886-119">Si vous spécifiez un attribut `switchValue` pour la source de suivi `System.ServiceModel.MessageLogging` comme suit, cela sera sans effet.</span><span class="sxs-lookup"><span data-stu-id="cd886-119">If you specify a `switchValue` attribute for the `System.ServiceModel.MessageLogging` trace source as follows, it has no effect.</span></span>  
  
```xml  
<source name="System.ServiceModel.MessageLogging" switchValue="Verbose">  
```  
  
 <span data-ttu-id="cd886-120">Si vous souhaitez désactiver la source de suivi, vous devrez utiliser à la place les attributs `logMessagesAtServiceLevel`, `logMalformedMessages`et `logMessagesAtTransportLevel` de l'élément `messageLogging`.</span><span class="sxs-lookup"><span data-stu-id="cd886-120">If you want to disable the trace source, you should use the `logMessagesAtServiceLevel`, `logMalformedMessages`, and `logMessagesAtTransportLevel` attributes of the `messageLogging` element instead.</span></span> <span data-ttu-id="cd886-121">Vous devez affecter à tous ces attributs la valeur `false`.</span><span class="sxs-lookup"><span data-stu-id="cd886-121">You should set all these attributes to `false`.</span></span> <span data-ttu-id="cd886-122">Pour ce faire, il suffit d'utiliser le fichier de configuration figurant dans l'exemple de code précédent avec l'Éditeur de configuration ou WMI.</span><span class="sxs-lookup"><span data-stu-id="cd886-122">This can be done by using the configuration file in the previous code example, through the Configuration Editor UI interface, or using WMI.</span></span> <span data-ttu-id="cd886-123">Pour plus d’informations sur l’outil Éditeur de Configuration, consultez [l’outil Éditeur de Configuration (SvcConfigEditor.exe)](../../../../docs/framework/wcf/configuration-editor-tool-svcconfigeditor-exe.md).</span><span class="sxs-lookup"><span data-stu-id="cd886-123">For more information about the Configuration Editor tool, see [Configuration Editor Tool (SvcConfigEditor.exe)](../../../../docs/framework/wcf/configuration-editor-tool-svcconfigeditor-exe.md).</span></span> <span data-ttu-id="cd886-124">Pour plus d’informations sur WMI, consultez [à l’aide de Windows Management Instrumentation pour les Diagnostics](../../../../docs/framework/wcf/diagnostics/wmi/index.md).</span><span class="sxs-lookup"><span data-stu-id="cd886-124">For more information about WMI, see [Using Windows Management Instrumentation for Diagnostics](../../../../docs/framework/wcf/diagnostics/wmi/index.md).</span></span>  
  
## <a name="logging-levels-and-options"></a><span data-ttu-id="cd886-125">Niveaux d'enregistrement et options supplémentaires</span><span class="sxs-lookup"><span data-stu-id="cd886-125">Logging Levels and Options</span></span>  
 <span data-ttu-id="cd886-126">Pour les messages entrants, leur enregistrement intervient immédiatement après leur création, immédiatement avant leur arrivée dans le code utilisateur au niveau du service et lorsque des erreurs sont détectées les concernant.</span><span class="sxs-lookup"><span data-stu-id="cd886-126">For incoming messages, logging happens immediately after the message is formed, immediately before the message gets to user code in the service level, and when malformed messages are detected.</span></span>  
  
 <span data-ttu-id="cd886-127">Pour les messages sortants, leur enregistrement intervient immédiatement après leur départ du code utilisateur et immédiatement avant leur transmission.</span><span class="sxs-lookup"><span data-stu-id="cd886-127">For outgoing messages, logging happens immediately after the message leaves user code and immediately before the message goes on the wire.</span></span>  
  
 <span data-ttu-id="cd886-128">WCF journalise les messages à deux niveaux différents, service et transport.</span><span class="sxs-lookup"><span data-stu-id="cd886-128">WCF logs messages at two different levels, service and transport.</span></span> <span data-ttu-id="cd886-129">Les messages erronés sont également enregistrés.</span><span class="sxs-lookup"><span data-stu-id="cd886-129">Malformed messages are also logged.</span></span> <span data-ttu-id="cd886-130">Ces trois niveaux sont indépendants les uns des autres et peuvent être activés séparément dans la configuration.</span><span class="sxs-lookup"><span data-stu-id="cd886-130">The three categories are independent from each other and can be activated separately in configuration.</span></span>  
  
 <span data-ttu-id="cd886-131">Vous pouvez contrôler le niveau d'enregistrement en définissant les attributs `logMessagesAtServiceLevel`, `logMalformedMessages` et `logMessagesAtTransportLevel` de l'élément `messageLogging`.</span><span class="sxs-lookup"><span data-stu-id="cd886-131">You can control the logging level by setting the `logMessagesAtServiceLevel`, `logMalformedMessages`, and `logMessagesAtTransportLevel` attributes of the `messageLogging` element.</span></span>  
  
### <a name="service-level"></a><span data-ttu-id="cd886-132">Niveau service</span><span class="sxs-lookup"><span data-stu-id="cd886-132">Service Level</span></span>  
 <span data-ttu-id="cd886-133">Les messages enregistrés à ce niveau sont ceux qui sont sur le point d'arriver (côté destinataire) dans le code utilisateur ou de quitter ce dernier (côté expéditeur).</span><span class="sxs-lookup"><span data-stu-id="cd886-133">Messages logged at this layer are about to enter (on receiving) or leave (on sending) user code.</span></span> <span data-ttu-id="cd886-134">Si des filtres ont été définis, seuls les messages respectant les critères définis par ces filtres seront enregistrés.</span><span class="sxs-lookup"><span data-stu-id="cd886-134">If filters have been defined, only messages that match the filters are logged.</span></span> <span data-ttu-id="cd886-135">Dans le cas contraire, tous les messages du niveau service seront enregistrés.</span><span class="sxs-lookup"><span data-stu-id="cd886-135">Otherwise, all messages at the service level are logged.</span></span> <span data-ttu-id="cd886-136">Les messages d'infrastructure (transactions, canal homologue et sécurité) sont également enregistrés à ce niveau, à l'exception des messages de messagerie fiable.</span><span class="sxs-lookup"><span data-stu-id="cd886-136">Infrastructure messages (transactions, peer channel, and security) are also logged at this level, except for Reliable Messaging messages.</span></span> <span data-ttu-id="cd886-137">Pour les messages transmis en flux continu, seuls les en-têtes sont enregistrés.</span><span class="sxs-lookup"><span data-stu-id="cd886-137">On streamed messages, only the headers are logged.</span></span> <span data-ttu-id="cd886-138">Les messages sécurisés sont également enregistrés et déchiffrés à ce niveau.</span><span class="sxs-lookup"><span data-stu-id="cd886-138">In addition, secure messages are logged decrypted at this level.</span></span>  
  
### <a name="transport-level"></a><span data-ttu-id="cd886-139">Niveau transport</span><span class="sxs-lookup"><span data-stu-id="cd886-139">Transport Level</span></span>  
 <span data-ttu-id="cd886-140">Les messages enregistrés à ce niveau sont prêts à être encodés ou décodés pour ou après transmission.</span><span class="sxs-lookup"><span data-stu-id="cd886-140">Messages logged at this layer are ready to be encoded or decoded for or after transportation on the wire.</span></span> <span data-ttu-id="cd886-141">Si des filtres ont été définis, seuls les messages respectant les critères définis par ces filtres seront enregistrés.</span><span class="sxs-lookup"><span data-stu-id="cd886-141">If filters have been defined, only messages that match the filters are logged.</span></span> <span data-ttu-id="cd886-142">Dans le cas contraire, tous les messages de niveau transport seront enregistrés.</span><span class="sxs-lookup"><span data-stu-id="cd886-142">Otherwise, all messages at the transport layer are logged.</span></span> <span data-ttu-id="cd886-143">Tous les messages d'infrastructure sont enregistrés à ce niveau, notamment les messages de messagerie fiable.</span><span class="sxs-lookup"><span data-stu-id="cd886-143">All infrastructure messages are logged at this layer, including reliable messaging messages.</span></span> <span data-ttu-id="cd886-144">Pour les messages transmis en flux continu, seuls les en-têtes sont enregistrés.</span><span class="sxs-lookup"><span data-stu-id="cd886-144">On streamed messages, only the headers are logged.</span></span> <span data-ttu-id="cd886-145">Les messages sécurisés sont également enregistrés à ce niveau sous leur forme chiffrée, sauf si un transport sécurisé tel qu'HTTPS est utilisé.</span><span class="sxs-lookup"><span data-stu-id="cd886-145">In addition, secure messages are logged as encrypted at this level, except if a secure transport such as HTTPS is used.</span></span>  
  
### <a name="malformed-level"></a><span data-ttu-id="cd886-146">Niveau erreurs</span><span class="sxs-lookup"><span data-stu-id="cd886-146">Malformed Level</span></span>  
 <span data-ttu-id="cd886-147">Messages mal formés sont des messages qui ont été rejetés par la pile WCF à n’importe quel stade du traitement.</span><span class="sxs-lookup"><span data-stu-id="cd886-147">Malformed messages are messages that are rejected by the WCF stack at any stage of processing.</span></span> <span data-ttu-id="cd886-148">Les messages mal formés sont enregistrés en l'état : sous leur forme chiffrée lorsqu'ils le sont, dans un langage XML incorrect et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="cd886-148">Malformed messages are logged as-is: encrypted if they are so, with non-proper XML, and so on.</span></span> <span data-ttu-id="cd886-149">`maxSizeOfMessageToLog` définit la taille du message à enregistrer sous forme de CDATA.</span><span class="sxs-lookup"><span data-stu-id="cd886-149">`maxSizeOfMessageToLog` defined the size of the message to be logged as CDATA.</span></span> <span data-ttu-id="cd886-150">Par défaut, `maxSizeOfMessageToLog` est égal à 256K.</span><span class="sxs-lookup"><span data-stu-id="cd886-150">By default, `maxSizeOfMessageToLog` is equal to 256K.</span></span> <span data-ttu-id="cd886-151">Pour plus d’informations sur cet attribut, consultez la section autres Options.</span><span class="sxs-lookup"><span data-stu-id="cd886-151">For more information about this attribute, see the Other Options section.</span></span>  
  
### <a name="other-options"></a><span data-ttu-id="cd886-152">Autres options</span><span class="sxs-lookup"><span data-stu-id="cd886-152">Other Options</span></span>  
 <span data-ttu-id="cd886-153">Outre les niveaux d'enregistrement, l'utilisateur peut spécifier les options suivantes :</span><span class="sxs-lookup"><span data-stu-id="cd886-153">In addition to the logging levels, the user can specify the following options:</span></span>  
  
- <span data-ttu-id="cd886-154">Consigner le Message entier (`logEntireMessage` attribut) : Cette valeur spécifie si le message entier (en-tête et corps) est enregistré.</span><span class="sxs-lookup"><span data-stu-id="cd886-154">Log Entire Message (`logEntireMessage` attribute): This value specifies whether the entire message (message header and body) is logged.</span></span> <span data-ttu-id="cd886-155">La valeur par défaut est `false`, ce qui signifie que seul l'en-tête est enregistré.</span><span class="sxs-lookup"><span data-stu-id="cd886-155">The default value is `false`, meaning that only the header is logged.</span></span> <span data-ttu-id="cd886-156">Ce paramètre affecte les niveaux service et transport de journalisation des messages.</span><span class="sxs-lookup"><span data-stu-id="cd886-156">This setting affects service and transport message logging levels..</span></span>  
  
- <span data-ttu-id="cd886-157">Messages maximal à enregistrer (`maxMessagesToLog` attribut) : Cette valeur spécifie le nombre maximal de messages à enregistrer.</span><span class="sxs-lookup"><span data-stu-id="cd886-157">Max messages to log (`maxMessagesToLog` attribute): This value specifies the maximum number of messages to log.</span></span> <span data-ttu-id="cd886-158">Tous les messages (service, transport et messages erronés) sont comptabilisés en fonction de cette limite.</span><span class="sxs-lookup"><span data-stu-id="cd886-158">All messages (service, transport, and malformed messages) are counted towards this quota.</span></span> <span data-ttu-id="cd886-159">Une fois cette limite atteinte, un message de suivi est généré et aucun message supplémentaire n'est enregistré.</span><span class="sxs-lookup"><span data-stu-id="cd886-159">When the quota is reached, a trace is emitted and no additional message is logged.</span></span> <span data-ttu-id="cd886-160">La valeur par défaut est 10 000.</span><span class="sxs-lookup"><span data-stu-id="cd886-160">The default value is 10000.</span></span>  
  
- <span data-ttu-id="cd886-161">Taille maximale de message à consigner (`maxSizeOfMessageToLog` attribut) : Cette valeur spécifie la taille maximale des messages à consigner en octets.</span><span class="sxs-lookup"><span data-stu-id="cd886-161">Max size of message to log (`maxSizeOfMessageToLog` attribute): This value specifies the maximum size of messages to log in bytes.</span></span> <span data-ttu-id="cd886-162">Les messages qui dépassent cette taille ne sont pas enregistrés et aucune opération les concernant n'est exécutée.</span><span class="sxs-lookup"><span data-stu-id="cd886-162">Messages that exceed the size limit are not logged, and no other activity is performed for that message.</span></span> <span data-ttu-id="cd886-163">Ce paramètre affecte tous les niveaux de suivi.</span><span class="sxs-lookup"><span data-stu-id="cd886-163">This setting affects all trace levels.</span></span> <span data-ttu-id="cd886-164">Si le suivi ServiceModel est activé, un message d'avertissement de suivi est généré au premier point d'enregistrement (ServiceModelSend \* ou TransportReceive) pour informer l'utilisateur de ce dépassement.</span><span class="sxs-lookup"><span data-stu-id="cd886-164">If ServiceModel tracing is on, a Warning level trace is emitted at the first logging point (ServiceModelSend\* or TransportReceive) to notify the user.</span></span> <span data-ttu-id="cd886-165">La valeur par défaut pour les messages de niveau de service et de niveau de transport est 256K, alors que la valeur par défaut pour les messages erronés est 4K.</span><span class="sxs-lookup"><span data-stu-id="cd886-165">The default value for service level and transport level messages is 256K, while the default value for malformed messages is 4K.</span></span>  
  
    > [!CAUTION]
    >  <span data-ttu-id="cd886-166">La taille de message calculée pour être comparée à `maxSizeOfMessageToLog` est celle présente dans la mémoire avant la sérialisation.</span><span class="sxs-lookup"><span data-stu-id="cd886-166">The message size that is computed to compare against `maxSizeOfMessageToLog` is the message size in memory before serialization.</span></span> <span data-ttu-id="cd886-167">Cette taille peut différer de la taille de chaîne des messages effectivement enregistrée et est, dans de nombreux cas, supérieure à leur grandeur réelle.</span><span class="sxs-lookup"><span data-stu-id="cd886-167">This size can differ from the actual length of the message string that is being logged, and in many occasions is bigger than the actual size.</span></span> <span data-ttu-id="cd886-168">Par conséquent, certains messages peuvent ne pas être enregistrés.</span><span class="sxs-lookup"><span data-stu-id="cd886-168">As a result, messages may not be logged.</span></span> <span data-ttu-id="cd886-169">Vous pouvez compenser ce phénomène en augmentant la valeur de l'attribut `maxSizeOfMessageToLog` de 10 %.</span><span class="sxs-lookup"><span data-stu-id="cd886-169">You can account for this fact by specifying the `maxSizeOfMessageToLog` attribute to be 10% larger than the expected message size.</span></span> <span data-ttu-id="cd886-170">En outre, si des messages erronés sont enregistrés, l'espace disque réel utilisé par les journaux de message peut atteindre jusqu'à 5 fois la valeur spécifiée par `maxSizeOfMessageToLog`.</span><span class="sxs-lookup"><span data-stu-id="cd886-170">In addition, if malformed messages are logged, the actual disk space utilized by the message logs can be up to 5 times the size of the value specified by `maxSizeOfMessageToLog`.</span></span>  
  
 <span data-ttu-id="cd886-171">Si aucun écouteur de suivi n'est défini dans le fichier de configuration, aucune sortie d'enregistrement n'est générée, quel que soit le niveau d'enregistrement spécifié.</span><span class="sxs-lookup"><span data-stu-id="cd886-171">If no trace listener is defined in the configuration file, no logging output is generated regardless of the specified logging level.</span></span>  
  
 <span data-ttu-id="cd886-172">Les options de journalisation des messages, telles que les attributs présentés de cette section, peuvent être changées en cours d'exécution à l'aide de Windows Management Instrumentation (WMI).</span><span class="sxs-lookup"><span data-stu-id="cd886-172">Message logging options, such as the attributes described in this section, can be changed at runtime using Windows Management Instrumentation (WMI).</span></span> <span data-ttu-id="cd886-173">Cela est possible en accédant à la [AppDomainInfo](../../../../docs/framework/wcf/diagnostics/wmi/appdomaininfo.md) instance, ce qui expose ces propriétés booléennes : `LogMessagesAtServiceLevel`, `LogMessagesAtTransportLevel`, et `LogMalformedMessages`.</span><span class="sxs-lookup"><span data-stu-id="cd886-173">This can be done by accessing the [AppDomainInfo](../../../../docs/framework/wcf/diagnostics/wmi/appdomaininfo.md) instance, which exposes these Boolean properties: `LogMessagesAtServiceLevel`, `LogMessagesAtTransportLevel`, and `LogMalformedMessages`.</span></span> <span data-ttu-id="cd886-174">Par conséquent, si vous configurez un écouteur de suivi pour l'enregistrement des messages, mais affectez la valeur `false` à ces options dans la configuration, vous pourrez leur affecter ultérieurement la valeur `true` pendant l'exécution de l'application.</span><span class="sxs-lookup"><span data-stu-id="cd886-174">Therefore, if you configure a trace listener for message logging, but set these options to `false` in configuration, you can later change them to `true` when the application is running.</span></span> <span data-ttu-id="cd886-175">Ceci permet en fait d'activer l'enregistrement des messages pendant l'exécution.</span><span class="sxs-lookup"><span data-stu-id="cd886-175">This effectively enables message logging at runtime.</span></span> <span data-ttu-id="cd886-176">De la même façon, si vous activez l'enregistrement des messages dans votre fichier de configuration, vous pouvez le désactiver pendant l'exécution à l'aide de WMI.</span><span class="sxs-lookup"><span data-stu-id="cd886-176">Similarly, if you enable message logging in your configuration file, you can disable it at runtime using WMI.</span></span> <span data-ttu-id="cd886-177">Pour plus d’informations, consultez [à l’aide de Windows Management Instrumentation pour les Diagnostics](../../../../docs/framework/wcf/diagnostics/wmi/index.md).</span><span class="sxs-lookup"><span data-stu-id="cd886-177">For more information, see [Using Windows Management Instrumentation for Diagnostics](../../../../docs/framework/wcf/diagnostics/wmi/index.md).</span></span>  
  
 <span data-ttu-id="cd886-178">Le champ `source` d'un journal de message indique le contexte de journalisation des messages : envoi / réception d'un message de demande, demande-réponse ou demande unidirectionnelle au niveau de la couche de modèle de service ou de transport, ou message mal formé.</span><span class="sxs-lookup"><span data-stu-id="cd886-178">The `source` field in a message log specifies in which context the message is logged: when sending/receiving a request message, for a request-reply or 1-way request, at service model or transport layer, or in the case of a malformed message.</span></span>  
  
 <span data-ttu-id="cd886-179">Pour les messages erronés, `source` est égal à `Malformed`.</span><span class="sxs-lookup"><span data-stu-id="cd886-179">For malformed messages, `source`  is equal to `Malformed`.</span></span> <span data-ttu-id="cd886-180">Dans les autres cas, la valeur de ce champ varie en fonction du contexte.</span><span class="sxs-lookup"><span data-stu-id="cd886-180">Otherwise, source has the following values based on the context.</span></span>  
  
 <span data-ttu-id="cd886-181">Dans le cadre d'une demande-réponse</span><span class="sxs-lookup"><span data-stu-id="cd886-181">For Request/Reply</span></span>  
  
||<span data-ttu-id="cd886-182">Envoyer la demande</span><span class="sxs-lookup"><span data-stu-id="cd886-182">Send Request</span></span>|<span data-ttu-id="cd886-183">Recevoir la demande</span><span class="sxs-lookup"><span data-stu-id="cd886-183">Receive Request</span></span>|<span data-ttu-id="cd886-184">Envoyer la réponse</span><span class="sxs-lookup"><span data-stu-id="cd886-184">Send Reply</span></span>|<span data-ttu-id="cd886-185">Recevoir la réponse</span><span class="sxs-lookup"><span data-stu-id="cd886-185">Receive Reply</span></span>|  
|-|------------------|---------------------|----------------|-------------------|  
|<span data-ttu-id="cd886-186">Dans le cadre d'une couche de modèle de service</span><span class="sxs-lookup"><span data-stu-id="cd886-186">Service Model layer</span></span>|<span data-ttu-id="cd886-187">Service</span><span class="sxs-lookup"><span data-stu-id="cd886-187">Service</span></span><br /><br /> <span data-ttu-id="cd886-188">Niveau</span><span class="sxs-lookup"><span data-stu-id="cd886-188">Level</span></span><br /><br /> <span data-ttu-id="cd886-189">Envoyer</span><span class="sxs-lookup"><span data-stu-id="cd886-189">Send</span></span><br /><br /> <span data-ttu-id="cd886-190">Demande</span><span class="sxs-lookup"><span data-stu-id="cd886-190">Request</span></span>|<span data-ttu-id="cd886-191">Service</span><span class="sxs-lookup"><span data-stu-id="cd886-191">Service</span></span><br /><br /> <span data-ttu-id="cd886-192">Niveau</span><span class="sxs-lookup"><span data-stu-id="cd886-192">Level</span></span><br /><br /> <span data-ttu-id="cd886-193">Receive</span><span class="sxs-lookup"><span data-stu-id="cd886-193">Receive</span></span><br /><br /> <span data-ttu-id="cd886-194">Demande</span><span class="sxs-lookup"><span data-stu-id="cd886-194">Request</span></span>|<span data-ttu-id="cd886-195">Service</span><span class="sxs-lookup"><span data-stu-id="cd886-195">Service</span></span><br /><br /> <span data-ttu-id="cd886-196">Niveau</span><span class="sxs-lookup"><span data-stu-id="cd886-196">Level</span></span><br /><br /> <span data-ttu-id="cd886-197">Envoyer</span><span class="sxs-lookup"><span data-stu-id="cd886-197">Send</span></span><br /><br /> <span data-ttu-id="cd886-198">Reply</span><span class="sxs-lookup"><span data-stu-id="cd886-198">Reply</span></span>|<span data-ttu-id="cd886-199">Service</span><span class="sxs-lookup"><span data-stu-id="cd886-199">Service</span></span><br /><br /> <span data-ttu-id="cd886-200">Niveau</span><span class="sxs-lookup"><span data-stu-id="cd886-200">Level</span></span><br /><br /> <span data-ttu-id="cd886-201">Receive</span><span class="sxs-lookup"><span data-stu-id="cd886-201">Receive</span></span><br /><br /> <span data-ttu-id="cd886-202">Reply</span><span class="sxs-lookup"><span data-stu-id="cd886-202">Reply</span></span>|  
|<span data-ttu-id="cd886-203">Dans le cadre d'une couche de transport</span><span class="sxs-lookup"><span data-stu-id="cd886-203">Transport layer</span></span>|<span data-ttu-id="cd886-204">Transport</span><span class="sxs-lookup"><span data-stu-id="cd886-204">Transport</span></span><br /><br /> <span data-ttu-id="cd886-205">Envoyer</span><span class="sxs-lookup"><span data-stu-id="cd886-205">Send</span></span>|<span data-ttu-id="cd886-206">Transport</span><span class="sxs-lookup"><span data-stu-id="cd886-206">Transport</span></span><br /><br /> <span data-ttu-id="cd886-207">Receive</span><span class="sxs-lookup"><span data-stu-id="cd886-207">Receive</span></span>|<span data-ttu-id="cd886-208">Transport</span><span class="sxs-lookup"><span data-stu-id="cd886-208">Transport</span></span><br /><br /> <span data-ttu-id="cd886-209">Envoyer</span><span class="sxs-lookup"><span data-stu-id="cd886-209">Send</span></span>|<span data-ttu-id="cd886-210">Transport</span><span class="sxs-lookup"><span data-stu-id="cd886-210">Transport</span></span><br /><br /> <span data-ttu-id="cd886-211">Receive</span><span class="sxs-lookup"><span data-stu-id="cd886-211">Receive</span></span>|  
  
 <span data-ttu-id="cd886-212">Dans le cadre d'une demande unidirectionnelle</span><span class="sxs-lookup"><span data-stu-id="cd886-212">For One-way Request</span></span>  
  
||<span data-ttu-id="cd886-213">Envoyer la demande</span><span class="sxs-lookup"><span data-stu-id="cd886-213">Send Request</span></span>|<span data-ttu-id="cd886-214">Recevoir la demande</span><span class="sxs-lookup"><span data-stu-id="cd886-214">Receive Request</span></span>|  
|-|------------------|---------------------|  
|<span data-ttu-id="cd886-215">Dans le cadre d'une couche de modèle de service</span><span class="sxs-lookup"><span data-stu-id="cd886-215">Service Model layer</span></span>|<span data-ttu-id="cd886-216">Service</span><span class="sxs-lookup"><span data-stu-id="cd886-216">Service</span></span><br /><br /> <span data-ttu-id="cd886-217">Niveau</span><span class="sxs-lookup"><span data-stu-id="cd886-217">Level</span></span><br /><br /> <span data-ttu-id="cd886-218">Envoyer</span><span class="sxs-lookup"><span data-stu-id="cd886-218">Send</span></span><br /><br /> <span data-ttu-id="cd886-219">Datagramme</span><span class="sxs-lookup"><span data-stu-id="cd886-219">Datagram</span></span>|<span data-ttu-id="cd886-220">Service</span><span class="sxs-lookup"><span data-stu-id="cd886-220">Service</span></span><br /><br /> <span data-ttu-id="cd886-221">Niveau</span><span class="sxs-lookup"><span data-stu-id="cd886-221">Level</span></span><br /><br /> <span data-ttu-id="cd886-222">Receive</span><span class="sxs-lookup"><span data-stu-id="cd886-222">Receive</span></span><br /><br /> <span data-ttu-id="cd886-223">Datagramme</span><span class="sxs-lookup"><span data-stu-id="cd886-223">Datagram</span></span>|  
|<span data-ttu-id="cd886-224">Dans le cadre d'une couche de transport</span><span class="sxs-lookup"><span data-stu-id="cd886-224">Transport layer</span></span>|<span data-ttu-id="cd886-225">Transport</span><span class="sxs-lookup"><span data-stu-id="cd886-225">Transport</span></span><br /><br /> <span data-ttu-id="cd886-226">Envoyer</span><span class="sxs-lookup"><span data-stu-id="cd886-226">Send</span></span>|<span data-ttu-id="cd886-227">Transport</span><span class="sxs-lookup"><span data-stu-id="cd886-227">Transport</span></span><br /><br /> <span data-ttu-id="cd886-228">Receive</span><span class="sxs-lookup"><span data-stu-id="cd886-228">Receive</span></span>|  
  
## <a name="message-filters"></a><span data-ttu-id="cd886-229">Filtres de message</span><span class="sxs-lookup"><span data-stu-id="cd886-229">Message Filters</span></span>  
 <span data-ttu-id="cd886-230">Les filtres de message sont définis dans l'élément de configuration `messageLogging` de la section de configuration `diagnostics`.</span><span class="sxs-lookup"><span data-stu-id="cd886-230">Message filters are defined in the `messageLogging` configuration element of the `diagnostics` configuration section.</span></span> <span data-ttu-id="cd886-231">Ils sont appliqués aux niveaux service et transport.</span><span class="sxs-lookup"><span data-stu-id="cd886-231">They are applied at the service and transport level.</span></span> <span data-ttu-id="cd886-232">Lorsqu'un ou plusieurs filtres sont définis, seuls les messages qui correspondent au moins à l'un des filtres sont enregistrés.</span><span class="sxs-lookup"><span data-stu-id="cd886-232">When one or more filters are defined, only messages that match at least one of the filters are logged.</span></span> <span data-ttu-id="cd886-233">Si aucun filtre n'est défini, tous les messages passent.</span><span class="sxs-lookup"><span data-stu-id="cd886-233">If no filter is defined, all messages pass through.</span></span>  
  
 <span data-ttu-id="cd886-234">Les filtres prennent en charge la syntaxe XPath complète et s'appliquent dans l'ordre dans lequel ils apparaissent dans le fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="cd886-234">Filters support the full XPath syntax and are applied in the order they appear in the configuration file.</span></span> <span data-ttu-id="cd886-235">Un filtre syntaxiquement incorrect provoque la levée d'une exception de configuration.</span><span class="sxs-lookup"><span data-stu-id="cd886-235">A syntactically incorrect filter results in a configuration exception.</span></span>  
  
 <span data-ttu-id="cd886-236">Les filtres fournissent également une fonctionnalité de sécurité qui utilise l’attribut `nodeQuota` et qui limite le nombre maximal de nœuds dans XPath DOM pouvant être examinés pour comparaison avec les filtres définis.</span><span class="sxs-lookup"><span data-stu-id="cd886-236">Filters also provide a safety feature using the `nodeQuota` attribute, which limits the maximum number of nodes in the XPath DOM that can be examined to match the filter.</span></span>  
  
 <span data-ttu-id="cd886-237">L'exemple de code suivant illustre comment configurer un filtre afin que seuls les messages contenant une section d'en-tête SOAP soient enregistrés.</span><span class="sxs-lookup"><span data-stu-id="cd886-237">The following example shows how to configure a filter that records only messages that have a SOAP header section.</span></span>  
  
```xml  
<messageLogging logEntireMessage="true"  
    logMalformedMessages="true"   
    logMessagesAtServiceLevel="true"  
    logMessagesAtTransportLevel="true"  
    maxMessagesToLog="420">  
    <filters>  
        <add nodeQuota="10" xmlns:soap="http://www.w3.org/2003/05/soap-envelope">  
                 /soap:Envelope/soap:Header  
        </add>  
     </filters>  
</messageLogging>  
```  
  
 <span data-ttu-id="cd886-238">Les filtres ne peuvent pas être appliqués au corps d'un message.</span><span class="sxs-lookup"><span data-stu-id="cd886-238">Filters cannot be applied to the body of a message.</span></span> <span data-ttu-id="cd886-239">Les filtres qui tentent de manipuler le corps d'un message sont supprimés de la liste des filtres.</span><span class="sxs-lookup"><span data-stu-id="cd886-239">Filters that attempt to manipulate the body of a message are removed from the list of filters.</span></span> <span data-ttu-id="cd886-240">Un événement signalant cette suppression est également déclenché.</span><span class="sxs-lookup"><span data-stu-id="cd886-240">An event is also emitted that indicates this.</span></span> <span data-ttu-id="cd886-241">L'exemple de filtre suivant serait supprimé de la table de filtres.</span><span class="sxs-lookup"><span data-stu-id="cd886-241">For example, the following filter would be removed from the filter table.</span></span>  
  
```xml  
<add xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">/s:Envelope/s:Body[contains(text(), "Hello")]</add>  
```  
  
## <a name="configuring-a-custom-listener"></a><span data-ttu-id="cd886-242">Configuration d'un écouteur personnalisé</span><span class="sxs-lookup"><span data-stu-id="cd886-242">Configuring a Custom Listener</span></span>  
 <span data-ttu-id="cd886-243">Vous pouvez également configurer un écouteur personnalisé en utilisant d'autres options.</span><span class="sxs-lookup"><span data-stu-id="cd886-243">You can also configure a custom listener with additional options.</span></span> <span data-ttu-id="cd886-244">Un écouteur personnalisé peut être utile pour filtrer les éléments PII spécifiques à l'application des messages avant leur enregistrement.</span><span class="sxs-lookup"><span data-stu-id="cd886-244">A custom listener can be useful in filtering application-specific PII elements from messages before logging.</span></span> <span data-ttu-id="cd886-245">L'exemple de code suivant contient une configuration d'écouteur personnalisé.</span><span class="sxs-lookup"><span data-stu-id="cd886-245">The following example demonstrates a custom listener configuration.</span></span>  
  
```xml  
<system.diagnostics>  
   <sources>  
     <source name="System.ServiceModel.MessageLogging">  
           <listeners>  
             <add name="MyListener"   
                    type="YourCustomListener"  
                    initializeData="c:\logs\messages.svclog"  
                    maxDiskSpace="1000"/>  
           </listeners>  
     </source>  
   </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="cd886-246">N'oubliez pas que l'attribut `type` doit avoir la valeur « nom d'assembly qualifié de ce type ».</span><span class="sxs-lookup"><span data-stu-id="cd886-246">You should be aware that the `type` attribute should be set to a qualified assembly name of the type.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cd886-247">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="cd886-247">See also</span></span>

- [<span data-ttu-id="cd886-248">\<messageLogging></span><span class="sxs-lookup"><span data-stu-id="cd886-248">\<messageLogging></span></span>](../../../../docs/framework/configure-apps/file-schema/wcf/messagelogging.md)
- [<span data-ttu-id="cd886-249">Journalisation des messages</span><span class="sxs-lookup"><span data-stu-id="cd886-249">Message Logging</span></span>](../../../../docs/framework/wcf/diagnostics/message-logging.md)
- [<span data-ttu-id="cd886-250">Paramètres recommandés pour le suivi et la journalisation des messages</span><span class="sxs-lookup"><span data-stu-id="cd886-250">Recommended Settings for Tracing and Message Logging</span></span>](../../../../docs/framework/wcf/diagnostics/tracing/recommended-settings-for-tracing-and-message-logging.md)

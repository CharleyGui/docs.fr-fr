---
title: Vue d'ensemble du flux de messages
ms.date: 03/30/2017
ms.assetid: fb0899e1-84cc-4d90-b45b-dc5a50063943
ms.openlocfilehash: cb2924b62fce62620b664efa34208deb12dd34b7
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/26/2020
ms.locfileid: "96285536"
---
# <a name="message-flow-overview"></a><span data-ttu-id="d9cb6-102">Vue d'ensemble du flux de messages</span><span class="sxs-lookup"><span data-stu-id="d9cb6-102">Message Flow Overview</span></span>

<span data-ttu-id="d9cb6-103">Dans un système distribué contenant des services interconnectés, il est nécessaire de déterminer les relations de causalité entre les services.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-103">In a distributed system containing interconnected services, it is necessary to determine causal relationships between the services.</span></span> <span data-ttu-id="d9cb6-104">Il est important de comprendre les différents composants faisant partie d'un flux de demandes pour prendre en charge des scénarios critiques, tels que le contrôle d'état, la résolution des problèmes et l'analyse de la cause première.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-104">It is important to understand the various components that were part of a request flow to support critical scenarios such as health monitoring, troubleshooting, and root cause analysis.</span></span> <span data-ttu-id="d9cb6-105">Pour activer la corrélation des suivis entre différents services, la prise en prendre en charge des fonctionnalités suivantes a été ajoutée dans .NET Framework 4 :</span><span class="sxs-lookup"><span data-stu-id="d9cb6-105">To enable the correlation of traces between various services, in the .NET Framework 4 we added support through the following features:</span></span>

- <span data-ttu-id="d9cb6-106">Traçage analytique : fonctionnalité de suivi très performante et à faible niveau de commentaires à l’aide du suivi d’événements Windows (ETW).</span><span class="sxs-lookup"><span data-stu-id="d9cb6-106">Analytic tracing: A high performance and low verbosity tracing feature using Event Tracing for Windows (ETW).</span></span>

- <span data-ttu-id="d9cb6-107">Modèle d'activité de bout en bout pour les services WCF/WF : cette fonctionnalité prend en charge la corrélation des suivis générés par les espaces de noms  <xref:System.ServiceModel> et <xref:System.Workflow.ComponentModel>.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-107">End-to-end activity model for WCF/WF services: This feature supports correlation of traces generated by the <xref:System.ServiceModel> and <xref:System.Workflow.ComponentModel> namespaces.</span></span>

- <span data-ttu-id="d9cb6-108">Suivi ETW pour WF : cette fonctionnalité utilise les enregistrements de suivi générés par les services WF pour offrir plus de visibilité dans l’avancement et l’état actuel du workflow.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-108">ETW tracking for WF: This feature uses tracking records generated by WF services to provide visibility into the workflow’s current state and progress.</span></span>

 <span data-ttu-id="d9cb6-109">Les erreurs enregistrées dans un enregistrement de suivi peuvent être utilisées pour rechercher les erreurs de code ou les messages qui ne sont pas correctement formés.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-109">Errors logged in a tracking or tracing record can be used to find code defects or incorrectly formed messages.</span></span> <span data-ttu-id="d9cb6-110">La propriété ActivityId du nœud Correlation dans l'en-tête de message de l'événement peut être utilisée pour déterminer l'activité générant une erreur.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-110">The ActivityId property of the Correlation node in the event’s message header can be used to determine the faulting activity.</span></span> <span data-ttu-id="d9cb6-111">Pour activer le suivi de workflow par ID d’activité, consultez [configuration du suivi du workflow des messages](./etw/configuring-message-flow-tracing.md).</span><span class="sxs-lookup"><span data-stu-id="d9cb6-111">To enable message flow tracing by activity ID, see [Configuring Message Flow Tracing](./etw/configuring-message-flow-tracing.md).</span></span> <span data-ttu-id="d9cb6-112">Cette rubrique montre comment activer le suivi de flux de messages dans le projet créé dans le didacticiel Mise en route.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-112">This topic demonstrates how to enable message flow tracing in the project created in the Getting Started tutorial.</span></span>

### <a name="to-enable-message-flow-tracing-in-the-getting-started-tutorial"></a><span data-ttu-id="d9cb6-113">Pour activer le suivi de flux de messages dans le didacticiel Mise en route</span><span class="sxs-lookup"><span data-stu-id="d9cb6-113">To enable message flow tracing in the Getting Started tutorial</span></span>

1. <span data-ttu-id="d9cb6-114">Ouvrez observateur d’événements en cliquant sur **Démarrer**, **exécuter**, puis en entrant `eventvwr.exe` .</span><span class="sxs-lookup"><span data-stu-id="d9cb6-114">Open Event Viewer by clicking **Start**, **Run**, and entering `eventvwr.exe`.</span></span>

2. <span data-ttu-id="d9cb6-115">Si vous n’avez pas activé le traçage analytique, développez **journaux des applications et des services**, **Microsoft**, **Windows**, serveur d’applications **-applications**.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-115">If you haven’t enabled analytic tracing, expand **Applications and Services Logs**, **Microsoft**, **Windows**, **Application Server-Applications**.</span></span> <span data-ttu-id="d9cb6-116">Sélectionnez **Afficher**, **afficher les journaux d’analyse et de débogage**.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-116">Select **View**, **Show Analytic and Debug Logs**.</span></span> <span data-ttu-id="d9cb6-117">Cliquez avec le bouton droit sur **analyse** et sélectionnez **activer le journal**.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-117">Right-click **Analytic** and select **Enable Log**.</span></span> <span data-ttu-id="d9cb6-118">Laissez l'Observateur d'événements ouvert pour visualiser les suivis.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-118">Leave Event Viewer open so that traces can be viewed.</span></span>

3. <span data-ttu-id="d9cb6-119">Ouvrez l’exemple créé dans le [didacticiel prise en main](../getting-started-tutorial.md) dans Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-119">Open the sample created in the [Getting Started Tutorial](../getting-started-tutorial.md) in Visual Studio 2012.</span></span> <span data-ttu-id="d9cb6-120">Notez que vous devez exécuter Visual Studio 2012 en tant qu’administrateur afin de pouvoir créer le service.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-120">Note that you must run Visual Studio 2012 as an administrator so that the service can be created.</span></span> <span data-ttu-id="d9cb6-121">Si vous avez installé les exemples WCF, vous pouvez ouvrir le [prise en main](../samples/getting-started-sample.md), qui contient le projet terminé créé dans le didacticiel.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-121">If you have the WCF samples installed, you can open the [Getting Started](../samples/getting-started-sample.md), which contains the completed project created in the tutorial.</span></span>

4. <span data-ttu-id="d9cb6-122">Cliquez avec le bouton droit sur le projet de **service** , puis sélectionnez **Ajouter**, **nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-122">Right-click the **Service** project and select **Add**, **New Item**.</span></span> <span data-ttu-id="d9cb6-123">Sélectionnez **fichier de configuration** de l’application, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-123">Select **Application Configuration File** and click **OK**.</span></span>

5. <span data-ttu-id="d9cb6-124">Ajoutez le code suivant au fichier App.Conf créé à l'étape précédente.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-124">Add the following code to the App.Config file created in the previous step.</span></span>

    ```xml
    <system.serviceModel>
      <diagnostics>
        <endToEndTracing propagateActivity="true" messageFlowTracing="true"/>
      </diagnostics>
    </system.serviceModel>
    ```

6. <span data-ttu-id="d9cb6-125">Exécutez l'application serveur sans déboguer en appuyant sur Ctrl+F5.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-125">Execute the server application without debugging by pressing CTRL+F5.</span></span> <span data-ttu-id="d9cb6-126">Exécutez le projet client en cliquant avec le bouton droit sur le projet **client** et en sélectionnant **Déboguer**, **Démarrer une nouvelle instance**.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-126">Execute the client project by right-clicking the **Client** project and selecting **Debug**, **Start New Instance**.</span></span>

7. <span data-ttu-id="d9cb6-127">Pour suivre les événements du client vers le serveur, ajoutez le code suivant au fichier de configuration de l'application dans le projet Client.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-127">To trace the events from the client to the server, add the following to the application configuration file in the Client project.</span></span>

    ```xml
    <diagnostics>
      <endToEndTracing propagateActivity="true" messageFlowTracing="true"/>
    </diagnostics>
    ```

8. <span data-ttu-id="d9cb6-128">Dans le fichier Program.cs du projet client, ajoutez l'instruction Using suivante.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-128">In Program.cs in the client, add the following Using statement.</span></span>

    ```csharp
    using System.Diagnostics;
    ```

9. <span data-ttu-id="d9cb6-129">Dans la méthode Main du fichier program.cs du projet client, définissez le GUID de suivi à propager dans le journal des événements.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-129">In the Main method in the program.cs file in the client project, set the Trace GUID to be propagated in the event log.</span></span>

    ```csharp
    Guid guid = Guid.NewGuid();
    Trace.CorrelationManager.ActivityId = guid;
    ```

10. <span data-ttu-id="d9cb6-130">Actualisez et examinez le journal d' **analyse**  .</span><span class="sxs-lookup"><span data-stu-id="d9cb6-130">Refresh and examine the **Analytic**  log.</span></span>  <span data-ttu-id="d9cb6-131">Recherchez un événement présentant l'ID 220.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-131">Look for an event with Event ID 220.</span></span>  <span data-ttu-id="d9cb6-132">Sélectionnez l’événement, puis cliquez sur l’onglet **Détails** dans le volet de visualisation.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-132">Select the event, and click the **Details** tab in the preview pane.</span></span> <span data-ttu-id="d9cb6-133">Cet événement contiendra l'ID de corrélation pour l'activité appelante.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-133">This event will contain the correlation ID for the calling activity.</span></span>

    ```xml
    <Correlation ActivityID="{A066CCF1-8AB3-459B-B62F-F79F957A5036}" />
    ```

    > [!NOTE]
    > <span data-ttu-id="d9cb6-134">Tous les événements ayant le même GUID dans l'ActivityID sont liés à une seule demande.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-134">All events with the same GUID in the ActivityID are related to one request.</span></span> <span data-ttu-id="d9cb6-135">Il peut être utilisé pour mettre en corrélation les messages d'un client spécifique avec un service spécifique.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-135">This can be used to correlate messages from a specific client to a specific service.</span></span> <span data-ttu-id="d9cb6-136">Si le client a appelé un autre service, ce même client peut être identifié par ActivityID.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-136">If the client called another service, then the same client could be identified by ActivityID.</span></span>

11. <span data-ttu-id="d9cb6-137">Dans certains cas, l'ActivityID peut varier du GUID d'origine au nouvel ActivityID.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-137">In some cases, the ActivityID can change from the original GUID to a new ActivityID.</span></span> <span data-ttu-id="d9cb6-138">Le cas échéant, un événement de transfert est émis.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-138">In that case, a transfer event is emitted.</span></span> <span data-ttu-id="d9cb6-139">Cet événement porte l'ID 499 et contiendra les données suivantes dans l'en-tête.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-139">This event ID is 499, and the event will contain the following data in the header.</span></span>

    ```xml
    <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
        <System>
            <Provider Name="Microsoft-Windows-Application Server-Applications" Guid="{c651f5f6-1c0d-492e-8ae1-b4efd7c9d503}" />
            <EventID>499</EventID>
            ...
            <Correlation ActivityID="{A066CCF1-8AB3-459B-B62F-F79F957A5036}" RelatedActivityID="{85FC0930-9C49-42DA-804B-A7368104BD1B}" />
            ...
       </System>
    </Event>
    ```

    > [!NOTE]
    > <span data-ttu-id="d9cb6-140">L'événement de transfère enregistre la modification de l'ActivityID actif du GUID spécifié en tant qu'ActivityID dans le GUID spécifié comme RelatedActivityID.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-140">The transfer event records the change of the active ActivityID from the GUID specified as the ActivityID to the GUID specified as RelatedActivityID.</span></span> <span data-ttu-id="d9cb6-141">Une fois l'événement de transfert émis, tous les événements contiendront le nouveau GUID en tant qu'ActivityID.</span><span class="sxs-lookup"><span data-stu-id="d9cb6-141">After the transfer event is emitted, all events will contain the new GUID as the ActivityID.</span></span>

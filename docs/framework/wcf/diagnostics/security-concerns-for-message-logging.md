---
title: Problèmes de sécurité relatifs à la journalisation des messages
ms.date: 03/30/2017
ms.assetid: 21f513f2-815b-47f3-85a6-03c008510038
ms.openlocfilehash: c5db9fbf0dfb91ecb903660ebfb42c33f55b27bc
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/22/2019
ms.locfileid: "69933611"
---
# <a name="security-concerns-for-message-logging"></a><span data-ttu-id="1a747-102">Problèmes de sécurité relatifs à la journalisation des messages</span><span class="sxs-lookup"><span data-stu-id="1a747-102">Security Concerns for Message Logging</span></span>
<span data-ttu-id="1a747-103">Cette rubrique contient des instructions permettant de protéger des données sensibles afin d'éviter qu'elles ne soient visibles dans les journaux des messages et de protéger les événements générés par l'enregistrement des messages.</span><span class="sxs-lookup"><span data-stu-id="1a747-103">This topic describes how you can protect sensitive data from being exposed in message logs, as well as events generated by message logging.</span></span>  
  
## <a name="security-concerns"></a><span data-ttu-id="1a747-104">Problèmes de sécurité</span><span class="sxs-lookup"><span data-stu-id="1a747-104">Security Concerns</span></span>  
  
### <a name="logging-sensitive-information"></a><span data-ttu-id="1a747-105">Enregistrement des informations sensibles</span><span class="sxs-lookup"><span data-stu-id="1a747-105">Logging Sensitive Information</span></span>  
 <span data-ttu-id="1a747-106">Windows Communication Foundation (WCF) ne modifie pas les données dans les en-têtes et le corps spécifiques à l’application.</span><span class="sxs-lookup"><span data-stu-id="1a747-106">Windows Communication Foundation (WCF) does not modify any data in application-specific headers and body.</span></span> <span data-ttu-id="1a747-107">WCF n’effectue pas non plus le suivi des informations personnelles dans les en-têtes spécifiques à l’application ou les données de corps.</span><span class="sxs-lookup"><span data-stu-id="1a747-107">WCF also does not track personal information in application-specific headers or body data.</span></span>  
  
 <span data-ttu-id="1a747-108">Lorsque la journalisation des messages est activée, les informations personnelles contenues dans les en-têtes spécifiques aux applications (par exemple, une chaîne de requête) et les données relatives au corps (par exemple, un numéro de carte de crédit) peuvent être visibles dans les journaux.</span><span class="sxs-lookup"><span data-stu-id="1a747-108">When message logging is enabled, personal information in application-specific headers, such as, a query string; and body information, such as, a credit card number, can become visible in the logs.</span></span> <span data-ttu-id="1a747-109">Le responsable du déploiement d'applications est chargé d'appliquer le contrôle d'accès sur les fichiers journaux et de configuration.</span><span class="sxs-lookup"><span data-stu-id="1a747-109">The application deployer is responsible for enforcing access control on the configuration and log files.</span></span> <span data-ttu-id="1a747-110">Si vous ne souhaitez pas que ce type d'informations soit visible, vous devez désactiver la journalisation, ou filtrer une partie des données en cas de partage des journaux.</span><span class="sxs-lookup"><span data-stu-id="1a747-110">If you do not want this kind of information to be visible, you should disable logging, or filter out part of the data if you want to share the logs.</span></span>  
  
 <span data-ttu-id="1a747-111">Les conseils suivants vous permettent d'éviter l'exposition involontaire du contenu d'un fichier journal :</span><span class="sxs-lookup"><span data-stu-id="1a747-111">The following tips can help you to prevent the content of a log file from being exposed unintentionally:</span></span>  
  
- <span data-ttu-id="1a747-112">Assurez-vous que les fichiers journaux sont protégés par des listes de contrôle d'accès (ACL, Access Control Lists), à la fois dans les scénarios auto-hébergés et hébergés sur le Web.</span><span class="sxs-lookup"><span data-stu-id="1a747-112">Ensure that the log files are protected by Access Control Lists (ACL) both in Web-host and self-host scenarios.</span></span>  
  
- <span data-ttu-id="1a747-113">Choisissez une extension de fichier qui ne peut pas être facilement fournie à l’aide d’une demande Web.</span><span class="sxs-lookup"><span data-stu-id="1a747-113">Choose a file extension that cannot be easily served using a Web request.</span></span> <span data-ttu-id="1a747-114">Par exemple, l’extension de fichier .xml n’est pas un choix sûr.</span><span class="sxs-lookup"><span data-stu-id="1a747-114">For example, the .xml file extension is not a safe choice.</span></span> <span data-ttu-id="1a747-115">Consultez le guide d'administration IIS (Internet Information Services) pour obtenir la liste des extensions qui peuvent être fournies.</span><span class="sxs-lookup"><span data-stu-id="1a747-115">You can check the Internet Information Services (IIS) administration guide to see a list of extensions that can be served.</span></span>  
  
- <span data-ttu-id="1a747-116">Spécifiez un chemin d'accès absolu pour l'emplacement de fichier journal, qui doit se trouver hors du répertoire public de la racine virtuelle de l'hôte Web afin d'empêcher tout intervenant externe d'y accéder à l'aide d'un navigateur Web.</span><span class="sxs-lookup"><span data-stu-id="1a747-116">Specify an absolute path for the log file location, which should be outside of the Web host vroot public directory to prevent it from being accessed by an external party using a Web browser.</span></span>  
  
 <span data-ttu-id="1a747-117">Par défaut, les clés et informations personnelles, telles que le nom d'utilisateur et le mot de passe, ne sont pas enregistrées dans les traces et les messages consignés.</span><span class="sxs-lookup"><span data-stu-id="1a747-117">By default, keys and personally identifiable information (PII) such as username and password are not logged in traces and logged messages.</span></span> <span data-ttu-id="1a747-118">Toutefois, un administrateur d'ordinateur peut utiliser l'attribut `enableLoggingKnownPII` dans l'élément `machineSettings` du fichier Machine.config pour autoriser les applications s'exécutant sur l'ordinateur à enregistrer les informations personnelles connues.</span><span class="sxs-lookup"><span data-stu-id="1a747-118">A machine administrator, however, can use the `enableLoggingKnownPII` attribute in the `machineSettings` element of the Machine.config file to permit applications running on the machine to log known personally identifiable information (PII).</span></span> <span data-ttu-id="1a747-119">La configuration suivante montre comment procéder :</span><span class="sxs-lookup"><span data-stu-id="1a747-119">The following configuration demonstrates how to do this:</span></span>  
  
```xml  
<configuration>  
   <system.serviceModel>  
      <machineSettings enableLoggingKnownPii="true"/>  
   </system.serviceModel>  
</configuration>   
```  
  
 <span data-ttu-id="1a747-120">Un responsable du déploiement d'applications peut ensuite utiliser l'attribut `logKnownPii` dans le fichier App.config ou Web.config pour activer la journalisation PII comme suit :</span><span class="sxs-lookup"><span data-stu-id="1a747-120">An application deployer can then use the `logKnownPii` attribute in either the App.config or Web.config file to enable PII logging as follows:</span></span>  
  
```xml  
<system.diagnostics>  
  <sources>  
      <source name="System.ServiceModel.MessageLogging"  
        logKnownPii="true">  
        <listeners>  
                 <add name="messages"  
                 type="System.Diagnostics.XmlWriterTraceListener"  
                 initializeData="c:\logs\messages.svclog" />  
          </listeners>  
      </source>  
    </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="1a747-121">La journalisation PII est uniquement activée lorsque les deux paramètres ont la valeur `true`.</span><span class="sxs-lookup"><span data-stu-id="1a747-121">Only when both settings are `true` is PII logging enabled.</span></span> <span data-ttu-id="1a747-122">La combinaison de deux commutateurs offre la souplesse nécessaire pour enregistrer les informations personnelles connues pour chaque application.</span><span class="sxs-lookup"><span data-stu-id="1a747-122">The combination of two switches allows the flexibility to log known PII for each application.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="1a747-123">Dans [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)], les indicateurs `logEntireMessage` et `logKnownPii` doivent également être définis avec la valeur `true` dans le fichier Web.config ou App.config pour activer la journalisation PII, comme indiqué dans l'exemple suivant `<system.serviceModel><messageLogging logEntireMessage="true" logKnownPii="true" …`.</span><span class="sxs-lookup"><span data-stu-id="1a747-123">In [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] the `logEntireMessage` and `logKnownPii` flags must also be set to `true` in the Web.config file or the App.config file to enable PII logging, as show in the following example `<system.serviceModel><messageLogging logEntireMessage="true" logKnownPii="true" …`.</span></span>  
  
 <span data-ttu-id="1a747-124">Sachez que si vous spécifiez plusieurs sources personnalisées dans un fichier de configuration, seuls les attributs de la première sont lus.</span><span class="sxs-lookup"><span data-stu-id="1a747-124">You should be aware that if you specify two or more custom sources in a configuration file, only the attributes of the first source are read.</span></span> <span data-ttu-id="1a747-125">Les autres sont ignorés.</span><span class="sxs-lookup"><span data-stu-id="1a747-125">The others are ignored.</span></span> <span data-ttu-id="1a747-126">Cela signifie que, pour le fichier App.config suivant, les informations personnelles ne sont pas enregistrées pour les deux sources même si la journalisation PII est explicitement activée pour la deuxième source.</span><span class="sxs-lookup"><span data-stu-id="1a747-126">This means that, for the following App.config, file, PII is not logged for both sources even though PII logging is explicitly enabled for the second source.</span></span>  
  
```xml  
<system.diagnostics>  
   <sources>  
      <source name="System.ServiceModel.MessageLogging"  
              logKnownPii="false">  
              <listeners>  
                 <add name="messages"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\messages.svclog" />  
              </listeners>  
            </source>  
      <source name="System.ServiceModel"   
              logKnownPii="true">  
              <listeners>  
                 <add name="traces"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\traces.svclog" />  
              </listeners>  
      </source>  
   </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="1a747-127">Si l'élément `<machineSettings enableLoggingKnownPii="Boolean"/>` existe en dehors du fichier Machine.config, le système lève un <xref:System.Configuration.ConfigurationErrorsException>.</span><span class="sxs-lookup"><span data-stu-id="1a747-127">If the `<machineSettings enableLoggingKnownPii="Boolean"/>` element exists outside the Machine.config file, the system throws a <xref:System.Configuration.ConfigurationErrorsException>.</span></span>  
  
 <span data-ttu-id="1a747-128">Les modifications ne sont effectives qu'au démarrage ou redémarrage de l'application.</span><span class="sxs-lookup"><span data-stu-id="1a747-128">The changes are effective only when the application starts or restarts.</span></span> <span data-ttu-id="1a747-129">Un événement est enregistré au démarrage lorsque les deux attributs ont la valeur `true`.</span><span class="sxs-lookup"><span data-stu-id="1a747-129">An event is logged at startup when both attributes are set to `true`.</span></span> <span data-ttu-id="1a747-130">Un événement est également enregistré si `logKnownPii` a la valeur `true` mais que `enableLoggingKnownPii` a la valeur `false`.</span><span class="sxs-lookup"><span data-stu-id="1a747-130">An event is also logged if `logKnownPii` is set to `true` but `enableLoggingKnownPii` is `false`.</span></span>  
  
 <span data-ttu-id="1a747-131">L'administrateur d'ordinateur et le responsable du déploiement d'applications doivent observer la plus grande prudence lorsqu'ils utilisent ces deux commutateurs.</span><span class="sxs-lookup"><span data-stu-id="1a747-131">The machine administrator and application deployer should exercise extreme caution when using these two switches.</span></span> <span data-ttu-id="1a747-132">Si la journalisation PII est activée, les clés de sécurité et les informations personnelles sont enregistrées.</span><span class="sxs-lookup"><span data-stu-id="1a747-132">If PII logging is enabled, security keys and PII are logged.</span></span> <span data-ttu-id="1a747-133">Si elle est désactivée, les données sensibles et spécifiques aux applications sont toujours enregistrées dans les corps et en-têtes des messages.</span><span class="sxs-lookup"><span data-stu-id="1a747-133">If it is disabled, sensitive and application-specific data is still logged in message headers and bodies.</span></span> <span data-ttu-id="1a747-134">Pour une discussion plus approfondie sur la confidentialité et la protection des informations d’identification personnelle, consultez [confidentialité des utilisateurs](https://go.microsoft.com/fwlink/?LinkID=94647).</span><span class="sxs-lookup"><span data-stu-id="1a747-134">For a more thorough discussion about privacy and protecting PII from being exposed, see [User Privacy](https://go.microsoft.com/fwlink/?LinkID=94647).</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="1a747-135">Les informations personnelles ne sont pas masquées dans les messages malformés.</span><span class="sxs-lookup"><span data-stu-id="1a747-135">PII is not hidden in malformed messages.</span></span> <span data-ttu-id="1a747-136">Les messages de ce type sont consignés en l'état sans aucune modification.</span><span class="sxs-lookup"><span data-stu-id="1a747-136">Such messaged are logged as-is without any modification.</span></span> <span data-ttu-id="1a747-137">Les attributs précédemment mentionnés n'ont aucun effet sur cela.</span><span class="sxs-lookup"><span data-stu-id="1a747-137">Attributes mentioned previously have no effect on this.</span></span>  
  
### <a name="custom-trace-listener"></a><span data-ttu-id="1a747-138">Écouteur de suivi personnalisé</span><span class="sxs-lookup"><span data-stu-id="1a747-138">Custom Trace Listener</span></span>  
 <span data-ttu-id="1a747-139">L'ajout d'un écouteur de suivi personnalisé sur la source de suivi de journalisation des messages est un privilège qui doit être réservé à l'administrateur.</span><span class="sxs-lookup"><span data-stu-id="1a747-139">Adding a custom trace listener on the Message Logging trace source is a privilege that should be restricted to the administrator.</span></span> <span data-ttu-id="1a747-140">En effet, des écouteurs personnalisés malveillants peuvent être configurés pour envoyer des messages à distance, ce qui se traduit par la divulgation d'informations sensibles.</span><span class="sxs-lookup"><span data-stu-id="1a747-140">This is because malicious custom listeners can be configured to send messages remotely, which leads to sensitive information disclosure.</span></span> <span data-ttu-id="1a747-141">De plus, si vous configurez un écouteur personnalisé pour envoyer des messages sur le câble, par exemple vers une base de données distante, vous devez appliquer le contrôle d'accès approprié sur les journaux de messages de l'ordinateur distant.</span><span class="sxs-lookup"><span data-stu-id="1a747-141">In addition, if you configure a custom listener to send messages on the wire, such as, to a remote database, you should enforce proper access control on the message logs in the remote machine.</span></span>  
  
## <a name="events-triggered-by-message-logging"></a><span data-ttu-id="1a747-142">Événements déclenchés par la journalisation des messages</span><span class="sxs-lookup"><span data-stu-id="1a747-142">Events Triggered by Message Logging</span></span>  
 <span data-ttu-id="1a747-143">La section suivante répertorie tous les événements émis par la journalisation des messages.</span><span class="sxs-lookup"><span data-stu-id="1a747-143">The following lists all the events emitted by message logging.</span></span>  
  
- <span data-ttu-id="1a747-144">Journalisation des messages activée: Cet événement est émis lorsque la journalisation des messages est activée dans la configuration ou via WMI.</span><span class="sxs-lookup"><span data-stu-id="1a747-144">Message logging on: This event is emitted when message logging is enabled in configuration, or through WMI.</span></span> <span data-ttu-id="1a747-145">Le contenu de l'événement est "La journalisation des messages a été activée.</span><span class="sxs-lookup"><span data-stu-id="1a747-145">The content of the event is "Message logging has been turned on.</span></span> <span data-ttu-id="1a747-146">Des informations sensibles peuvent être enregistrées en clair, même si elles ont été chiffrées sur le câble, par exemple, corps de message."</span><span class="sxs-lookup"><span data-stu-id="1a747-146">Sensitive information may be logged in clear text, even if they were encrypted on the wire, for example, message bodies."</span></span>  
  
- <span data-ttu-id="1a747-147">Désactivation de la journalisation des messages: Cet événement est émis lorsque la journalisation des messages est désactivée via WMI.</span><span class="sxs-lookup"><span data-stu-id="1a747-147">Message logging off: This event is emitted when message logging is disabled through WMI.</span></span> <span data-ttu-id="1a747-148">Le contenu de l'événement est "La journalisation des messages a été activée."</span><span class="sxs-lookup"><span data-stu-id="1a747-148">The content of the event is "Message logging has been turned off."</span></span>  
  
- <span data-ttu-id="1a747-149">Consigner les informations d’identification connues sur: Cet événement est émis lorsque la journalisation des PII connues est activée.</span><span class="sxs-lookup"><span data-stu-id="1a747-149">Log Known PII On: This event is emitted when logging of known PII is enabled.</span></span> <span data-ttu-id="1a747-150">Cela se produit lorsque `enableLoggingKnownPii` l’attribut dans `machineSettings` l’élément du fichier machine. `true`config a la valeur et que l' `logKnownPii` attribut de l' `source` élément dans le fichier app. config ou Web. config a la valeur `true`.</span><span class="sxs-lookup"><span data-stu-id="1a747-150">This happens when the `enableLoggingKnownPii` attribute in the `machineSettings` element of the Machine.config file is set to `true`, and the `logKnownPii` attribute of the `source` element in either the App.config or Web.config file is set to `true`.</span></span>  
  
- <span data-ttu-id="1a747-151">Consigner les informations d’identification connues non autorisées: Cet événement est émis lorsque la journalisation des PII connues n’est pas autorisée.</span><span class="sxs-lookup"><span data-stu-id="1a747-151">Log Known PII Not Allowed: This event is emitted when logging of known PII is not allowed.</span></span> <span data-ttu-id="1a747-152">Cela se produit lorsque `logKnownPii` l’attribut de `source` l’élément dans le fichier app. config ou Web. `true`config a la valeur, mais que `enableLoggingKnownPii` l’attribut dans `machineSettings` l’élément du fichier machine. config a la valeur `false`.</span><span class="sxs-lookup"><span data-stu-id="1a747-152">This happens when the `logKnownPii` attribute of the `source` element in either the App.config or Web.config file is set to `true`, but the `enableLoggingKnownPii` attribute in the `machineSettings` element of the Machine.config file is set to `false`.</span></span> <span data-ttu-id="1a747-153">Aucune exception n'est levée.</span><span class="sxs-lookup"><span data-stu-id="1a747-153">No exception is thrown.</span></span>  
  
 <span data-ttu-id="1a747-154">Ces événements peuvent être affichés dans l'outil Observateur d'événements fourni avec Windows.</span><span class="sxs-lookup"><span data-stu-id="1a747-154">These events can be viewed in the Event Viewer tool that comes with Windows.</span></span> <span data-ttu-id="1a747-155">Pour plus d’informations, consultez journalisation des [événements](../../../../docs/framework/wcf/diagnostics/event-logging/index.md).</span><span class="sxs-lookup"><span data-stu-id="1a747-155">For more information on this, see [Event Logging](../../../../docs/framework/wcf/diagnostics/event-logging/index.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1a747-156">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="1a747-156">See also</span></span>

- [<span data-ttu-id="1a747-157">Journalisation des messages</span><span class="sxs-lookup"><span data-stu-id="1a747-157">Message Logging</span></span>](../../../../docs/framework/wcf/diagnostics/message-logging.md)
- [<span data-ttu-id="1a747-158">Problèmes de sécurité et conseils utiles pour le suivi</span><span class="sxs-lookup"><span data-stu-id="1a747-158">Security Concerns and Useful Tips for Tracing</span></span>](../../../../docs/framework/wcf/diagnostics/tracing/security-concerns-and-useful-tips-for-tracing.md)

---
title: Windows Service Host
ms.date: 03/30/2017
helpviewer_keywords:
- NT Service
- NT Service Host Sample [Windows Communication Foundation]
ms.assetid: 1b2f45c5-2bed-4979-b0ee-8f9efcfec028
ms.openlocfilehash: 4d5e29f51ab49c142beb97060b719f26b050e767
ms.sourcegitcommit: 5fb5b6520b06d7f5e6131ec2ad854da302a28f2e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/03/2019
ms.locfileid: "74715014"
---
# <a name="windows-service-host"></a><span data-ttu-id="0b5aa-102">Windows Service Host</span><span class="sxs-lookup"><span data-stu-id="0b5aa-102">Windows Service Host</span></span>
<span data-ttu-id="0b5aa-103">Cet exemple illustre un service Windows Communication Foundation (WCF) hébergé dans un service Windows managé.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-103">This sample demonstrates a Windows Communication Foundation (WCF) service hosted in a managed Windows Service.</span></span> <span data-ttu-id="0b5aa-104">Les services Windows sont contrôlés à l’aide de l’applet services du **panneau** de configuration et peuvent être configurés pour démarrer automatiquement après un redémarrage du système.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-104">Windows Services are controlled using the Services applet in **Control Panel** and can be configured to start up automatically after a system reboot.</span></span> <span data-ttu-id="0b5aa-105">L'exemple se compose d'un programme client et d'un programme de service Windows.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-105">The sample consists of a client program and an Windows Service program.</span></span> <span data-ttu-id="0b5aa-106">Le service est implémenté en tant que programme .exe et contient son propre code d'hébergement.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-106">The service is implemented as an .exe program and contains its own hosting code.</span></span> <span data-ttu-id="0b5aa-107">Dans d'autres environnements d'hébergement, tels que WAS (Windows Process Activation Services) ou IIS (Internet Information Services), vous n'avez pas besoin d'écrire le code d'hébergement.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-107">In other hosting environments, such as Windows Process Activation Services (WAS) or Internet Information Services (IIS), it is not necessary for you to write hosting code.</span></span>

> [!NOTE]
> <span data-ttu-id="0b5aa-108">La procédure d'installation ainsi que les instructions de génération correspondant à cet exemple figurent en fin de rubrique.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-108">The set-up procedure and build instructions for this sample are located at the end of this topic.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="0b5aa-109">Les exemples peuvent déjà être installés sur votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-109">The samples may already be installed on your computer.</span></span> <span data-ttu-id="0b5aa-110">Recherchez le répertoire (par défaut) suivant avant de continuer.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-110">Check for the following (default) directory before continuing.</span></span>  
>   
> `<InstallDrive>:\WF_WCF_Samples`  
>   
> <span data-ttu-id="0b5aa-111">Si ce répertoire n’existe pas, accédez à [Windows Communication Foundation (WCF) et Windows Workflow Foundation (WF) exemples pour .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) pour télécharger tous les exemples Windows Communication Foundation (WCF) et [!INCLUDE[wf1](../../../../includes/wf1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0b5aa-111">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="0b5aa-112">Cet exemple se trouve dans le répertoire suivant.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-112">This sample is located in the following directory.</span></span>  
>   
> `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Services\Hosting\WindowsService`  
  
 <span data-ttu-id="0b5aa-113">Après avoir généré ce service, il doit être installé avec l'utilitaire Installutil.exe comme tout autre service Windows.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-113">After building this service, it must be installed with the Installutil.exe utility like any other Windows Service.</span></span> <span data-ttu-id="0b5aa-114">Si vous voulez apporter des modifications au service, vous devez d'abord le désinstaller avec `installutil /u`.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-114">If you are going to make changes to the service, you must first uninstall it with `installutil /u`.</span></span> <span data-ttu-id="0b5aa-115">Les fichiers Setup.bat et Cleanup.bat inclus dans cet exemple sont les commandes pour installer et démarrer le service Windows, et pour fermer et désinstaller le service Windows.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-115">The Setup.bat and Cleanup.bat files included in this sample are the commands to install and start up the Windows Service, and to shut down and uninstall the Windows Service.</span></span> <span data-ttu-id="0b5aa-116">Le service WCF ne peut répondre aux clients que si le service Windows est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-116">The WCF service can only respond to clients if the Windows Service is running.</span></span> <span data-ttu-id="0b5aa-117">Si vous arrêtez le service Windows à l’aide de l’applet services du **panneau de configuration** et que vous exécutez le client, une exception <xref:System.ServiceModel.EndpointNotFoundException> se produit lorsqu’un client tente d’accéder au service.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-117">If you stop the Windows Service by using the Services applet from **Control Panel** and run the client, a <xref:System.ServiceModel.EndpointNotFoundException> exception occurs when a client attempts to access the service.</span></span> <span data-ttu-id="0b5aa-118">Si vous redémarrez le service Windows et exécutez à nouveau le client, la communication réussit.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-118">If you restart the Windows Service and rerun the client, communication succeeds.</span></span>  
  
 <span data-ttu-id="0b5aa-119">Le code de service comprend une classe installer, une classe d’implémentation de service WCF qui implémente le contrat ICalculator et une classe de service Windows qui agit comme hôte au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-119">The service code includes an installer class, a WCF service implementation class which implements the ICalculator contract, and a Windows Service class that acts as the run-time host.</span></span> <span data-ttu-id="0b5aa-120">La classe Installer, qui hérite de <xref:System.Configuration.Install.Installer>, permet à l'outil Installutil.exe d'installer le programme comme un service NT.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-120">The installer class, which inherits from <xref:System.Configuration.Install.Installer>, allows the program to be installed as an NT service by the Installutil.exe tool.</span></span> <span data-ttu-id="0b5aa-121">La classe d’implémentation de service, `WcfCalculatorService`, est un service WCF qui implémente un contrat de service de base.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-121">The service implementation class, `WcfCalculatorService`, is an WCF service that implements a basic service contract.</span></span> <span data-ttu-id="0b5aa-122">Ce service WCF est hébergé dans une classe de service Windows appelée `WindowsCalculatorService`.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-122">This WCF service is hosted inside a Windows Service class called `WindowsCalculatorService`.</span></span> <span data-ttu-id="0b5aa-123">Pour prétendre au titre de service Windows, la classe hérite de <xref:System.ServiceProcess.ServiceBase> et implémente les méthodes <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> et <xref:System.ServiceProcess.ServiceBase.OnStop>.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-123">To qualify as a Windows Service, the class inherits from <xref:System.ServiceProcess.ServiceBase> and implements the <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> and <xref:System.ServiceProcess.ServiceBase.OnStop> methods.</span></span> <span data-ttu-id="0b5aa-124">Dans <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>, un objet <xref:System.ServiceModel.ServiceHost> est créé pour le type `WcfCalculatorService` et ouvert.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-124">In <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>, a <xref:System.ServiceModel.ServiceHost> object is created for the `WcfCalculatorService` type and opened.</span></span> <span data-ttu-id="0b5aa-125">Dans <xref:System.ServiceProcess.ServiceBase.OnStop>, le ServiceHost est fermé en appelant la méthode <xref:System.ServiceModel.Channels.CommunicationObject.Close%28System.TimeSpan%29> de l'objet <xref:System.ServiceModel.ServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-125">In <xref:System.ServiceProcess.ServiceBase.OnStop>, the ServiceHost is closed by calling the <xref:System.ServiceModel.Channels.CommunicationObject.Close%28System.TimeSpan%29> method of the <xref:System.ServiceModel.ServiceHost> object.</span></span> <span data-ttu-id="0b5aa-126">L’adresse de base de l’hôte est configurée à l’aide de l’élément [\<add >](../../../../docs/framework/configure-apps/file-schema/wcf/add-of-baseaddresses.md) , qui est un enfant de [\<baseAddresses >](../../../../docs/framework/configure-apps/file-schema/wcf/baseaddresses.md), qui est un enfant de l’élément\<[Host >](../../../../docs/framework/configure-apps/file-schema/wcf/host.md) , qui est un enfant de l’élément\<[service >](../../../../docs/framework/configure-apps/file-schema/wcf/service.md) .</span><span class="sxs-lookup"><span data-stu-id="0b5aa-126">The host's base address is configured using the [\<add>](../../../../docs/framework/configure-apps/file-schema/wcf/add-of-baseaddresses.md) element, which is a child of [\<baseAddresses>](../../../../docs/framework/configure-apps/file-schema/wcf/baseaddresses.md), which is a child of the [\<host>](../../../../docs/framework/configure-apps/file-schema/wcf/host.md) element, which is a child of the [\<service>](../../../../docs/framework/configure-apps/file-schema/wcf/service.md) element.</span></span>  
  
 <span data-ttu-id="0b5aa-127">Le point de terminaison défini utilise l’adresse de base et une [\<wsHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md).</span><span class="sxs-lookup"><span data-stu-id="0b5aa-127">The endpoint that is defined uses the base address and a [\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md).</span></span> <span data-ttu-id="0b5aa-128">L'exemple suivant illustre la configuration de l'adresse de base ainsi que le point de terminaison qui expose le CalculatorService.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-128">The following sample shows the configuration of the base address as well as the endpoint that exposes the CalculatorService.</span></span>  
  
```xml  
<services>  
  <service name="Microsoft.ServiceModel.Samples.WcfCalculatorService"  
           behaviorConfiguration="CalculatorServiceBehavior">  
    <host>  
      <baseAddresses>  
        <add baseAddress="http://localhost:8000/ServiceModelSamples/service"/>  
      </baseAddresses>  
    </host>  
    <!-- This endpoint is exposed at the base address provided by host: http://localhost:8000/ServiceModelSamples/service.  -->  
    <endpoint address=""  
              binding="wsHttpBinding"  
              contract="Microsoft.ServiceModel.Samples.ICalculator" />  
    ...  
  </service>  
</services>  
```  
  
 <span data-ttu-id="0b5aa-129">Lorsque vous exécutez l'exemple, les requêtes et réponses de l'opération s'affichent dans les fenêtres de console du service et du client.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-129">When you run the sample, the operation requests and responses are displayed in both the service and client console windows.</span></span> <span data-ttu-id="0b5aa-130">Appuyez sur ENTER dans chaque fenêtre de console pour arrêter le service et le client.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-130">Press ENTER in each console window to shut down the service and client.</span></span>  
  
### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="0b5aa-131">Pour configurer, générer et exécuter l'exemple</span><span class="sxs-lookup"><span data-stu-id="0b5aa-131">To set up, build, and run the sample</span></span>  
  
1. <span data-ttu-id="0b5aa-132">Assurez-vous d’avoir effectué la [procédure d’installation unique pour les exemples de Windows Communication Foundation](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).</span><span class="sxs-lookup"><span data-stu-id="0b5aa-132">Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).</span></span>  
  
2. <span data-ttu-id="0b5aa-133">Pour générer l’édition C# ou Visual Basic .NET de la solution, conformez-vous aux instructions figurant dans [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).</span><span class="sxs-lookup"><span data-stu-id="0b5aa-133">To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).</span></span>  
  
3. <span data-ttu-id="0b5aa-134">Une fois la solution générée, exécutez Setup. bat à partir d’une invite de commandes Visual Studio 2012 avec élévation de privilèges pour installer le service Windows à l’aide de l’outil installutil. exe.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-134">After the solution has been built, run Setup.bat from an elevated Visual Studio 2012 command prompt to install the Windows service using the Installutil.exe tool.</span></span> <span data-ttu-id="0b5aa-135">Le service doit apparaître dans Services.</span><span class="sxs-lookup"><span data-stu-id="0b5aa-135">The service should appear in Services.</span></span>  
  
4. <span data-ttu-id="0b5aa-136">Pour exécuter l’exemple dans une configuration à un ou plusieurs ordinateurs, suivez les instructions de [la section exécution des exemples de Windows Communication Foundation](../../../../docs/framework/wcf/samples/running-the-samples.md).</span><span class="sxs-lookup"><span data-stu-id="0b5aa-136">To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0b5aa-137">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="0b5aa-137">See also</span></span>

- [<span data-ttu-id="0b5aa-138">Hébergement AppFabric et exemples de persistance</span><span class="sxs-lookup"><span data-stu-id="0b5aa-138">AppFabric Hosting and Persistence Samples</span></span>](https://go.microsoft.com/fwlink/?LinkId=193961)

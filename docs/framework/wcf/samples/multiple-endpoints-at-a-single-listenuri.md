---
title: Multiple Endpoints at a Single ListenUri
ms.date: 03/30/2017
ms.assetid: 911ffad4-4d47-4430-b7c2-79192ce6bcbd
ms.openlocfilehash: 8e26cc18ed35c446dda120c678dd7e879c756c0f
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79183486"
---
# <a name="multiple-endpoints-at-a-single-listenuri"></a><span data-ttu-id="d2a3f-102">Multiple Endpoints at a Single ListenUri</span><span class="sxs-lookup"><span data-stu-id="d2a3f-102">Multiple Endpoints at a Single ListenUri</span></span>
<span data-ttu-id="d2a3f-103">Cet exemple présente un service qui héberge plusieurs points de terminaison au niveau d'un `ListenUri` unique.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-103">This sample demonstrates a service that hosts multiple endpoints at a single `ListenUri`.</span></span> <span data-ttu-id="d2a3f-104">Cet échantillon est basé sur le [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) qui met en œuvre un service de calculatrice.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-104">This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) that implements a calculator service.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d2a3f-105">La procédure d'installation ainsi que les instructions de génération relatives à cet exemple figurent à la fin de cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-105">The setup procedure and build instructions for this sample are located at the end of this topic.</span></span>  
  
 <span data-ttu-id="d2a3f-106">Comme le démontre l’échantillon [de plusieurs points d’end,](../../../../docs/framework/wcf/samples/multiple-endpoints.md) un service peut héberger plusieurs points de terminaison, chacun avec des adresses différentes et peut-être aussi des fixations différentes.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-106">As demonstrated in the [Multiple Endpoints](../../../../docs/framework/wcf/samples/multiple-endpoints.md) sample, a service can host multiple endpoints, each with different addresses and possibly also different bindings.</span></span> <span data-ttu-id="d2a3f-107">Cet exemple montre qu'il est possible d'héberger plusieurs points de terminaison à la même adresse.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-107">This sample shows that it is possible to host multiple endpoints at the same address.</span></span> <span data-ttu-id="d2a3f-108">Il montre également les différences entre les deux types d'adresses d'un point de terminaison : `EndpointAddress` et `ListenUri`.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-108">This sample also demonstrates the differences between the two kinds of addresses that a service endpoint has: `EndpointAddress` and `ListenUri`.</span></span>  
  
 <span data-ttu-id="d2a3f-109">`EndpointAddress` est l'adresse logique d'un service.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-109">The `EndpointAddress` is the logical address of a service.</span></span> <span data-ttu-id="d2a3f-110">Il s'agit de l'adresse à laquelle les messages SOAP sont adressés.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-110">It is the address that SOAP messages are addressed to.</span></span> <span data-ttu-id="d2a3f-111">`ListenUri` est l'adresse physique du service.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-111">The `ListenUri` is the physical address of the service.</span></span> <span data-ttu-id="d2a3f-112">Elle comporte les informations sur l'adresse et le port sur lesquels le point de terminaison de service écoute réellement les messages sur l'ordinateur actuel.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-112">It has the port and address information where the service endpoint actually listens for messages on the current machine.</span></span> <span data-ttu-id="d2a3f-113">Dans la plupart des cas, il n'est pas nécessaire que ces adresses différèrent ; lorsque `ListenUri` n'est pas spécifié de manière explicite, la valeur par défaut est l'URI de `EndpointAddress` du point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-113">In most cases, there is no need for these addresses to differ; when a `ListenUri` is not explicitly specified, it defaults to the URI of the `EndpointAddress` of the endpoint.</span></span> <span data-ttu-id="d2a3f-114">Dans certains cas, il est utile de les distinguer, par exemple lors de la configuration d'un routeur, qui peut accepter des messages adressé à un certain nombre de services différents.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-114">In a few cases, it is useful to distinguish them, such as when configuring a router, which might accept messages addressed to a number of different services.</span></span>  
  
## <a name="service"></a><span data-ttu-id="d2a3f-115">Service</span><span class="sxs-lookup"><span data-stu-id="d2a3f-115">Service</span></span>  
 <span data-ttu-id="d2a3f-116">Le service dans cet exemple a deux contrats : `ICalculator` et `IEcho`.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-116">The service in this sample has two contracts, `ICalculator` and `IEcho`.</span></span> <span data-ttu-id="d2a3f-117">Outre le point de terminaison habituel `IMetadataExchange`, il existe également trois points de terminaison d'application, tel qu'indiqué dans le code suivant.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-117">In addition to the customary `IMetadataExchange` endpoint, there are three application endpoints, as shown in the following code.</span></span>  
  
```xml  
<endpoint address="urn:Stuff"  
        binding="wsHttpBinding"  
        contract="Microsoft.ServiceModel.Samples.ICalculator"
        listenUri="http://localhost/servicemodelsamples/service.svc" />  
<endpoint address="urn:Stuff"  
        binding="wsHttpBinding"  
        contract="Microsoft.ServiceModel.Samples.IEcho"
        listenUri="http://localhost/servicemodelsamples/service.svc" />  
<endpoint address="urn:OtherEcho"  
        binding="wsHttpBinding"  
        contract="Microsoft.ServiceModel.Samples.IEcho"
        listenUri="http://localhost/servicemodelsamples/service.svc" />  
```  
  
 <span data-ttu-id="d2a3f-118">Les trois points de terminaison sont hébergés au niveau du même `ListenUri` et utilisent le même `binding` - les mêmes points de terminaison au niveau du même `ListenUri` doivent avoir la même liaison, car ils partagent une pile de canaux unique qui écoute les messages à cette adresse physique sur l'ordinateur.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-118">All three endpoints are hosted at the same `ListenUri` and use the same `binding` - endpoints at the same `ListenUri` must have the same binding, because they are sharing a single channel stack that listens for messages at that physical address on the machine.</span></span> <span data-ttu-id="d2a3f-119">L'`address` de chaque point de terminaison est une adresse URN ; bien que les adresses représentent généralement des emplacements physiques, il peut en fait s'agir de n'importe quel type d'URI, car l'adresse est utilisée à des fins de correspondance et de filtrage, tel qu'indiqué dans cet exemple.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-119">The `address` of each endpoint is a URN; though typically addresses represent physical locations, in fact the address can be any kind of URI, because the address is used for matching and filtering purposes as is demonstrated in this sample.</span></span>  
  
 <span data-ttu-id="d2a3f-120">Parce que les trois points `ListenUri`de terminaison partagent le même , quand un message arrive là, Windows Communication Foundation (WCF) doit décider quel point de terminaison le message est destiné à.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-120">Because all three endpoints share the same `ListenUri`, when a message arrives there, Windows Communication Foundation (WCF) must decide which endpoint the message is destined for.</span></span> <span data-ttu-id="d2a3f-121">Chaque point de terminaison comporte un filtre de messages composé de deux parties : le filtre d'adresse et le filtre de contrat.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-121">Each endpoint has a message filter that is comprised of two parts: the address filter and the contract filter.</span></span> <span data-ttu-id="d2a3f-122">Le filtre d'adresse met en correspondance le `To` du message SOAP et l'adresse du point de terminaison de service.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-122">The address filter matches the `To` of the SOAP message to the address of the service endpoint.</span></span> <span data-ttu-id="d2a3f-123">Par exemple, seuls les messages adressés `To "Urn:OtherEcho"` sont des candidats pour le troisième point de terminaison de ce service.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-123">For example, only messages addressed `To "Urn:OtherEcho"` are candidates for the third endpoint of this service.</span></span> <span data-ttu-id="d2a3f-124">Le filtre de contrat correspond aux actions associées aux opérations d'un contrat spécifique.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-124">The contract filter matches the Actions associated with the operations of a particular contract.</span></span> <span data-ttu-id="d2a3f-125">Par exemple, des messages avec l'action de `IEcho`.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-125">For example, messages with the action of `IEcho`.</span></span> <span data-ttu-id="d2a3f-126">`Echo` correspond aux filtres de contrat du deuxième et du troisième point de terminaison de ce service, car ces deux points de terminaison hébergent le contrat `IEcho`.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-126">`Echo` matches the contract filters of both the second and third endpoints of this service, because both of those endpoints host the `IEcho` contract.</span></span>  
  
 <span data-ttu-id="d2a3f-127">La combinaison du filtre d'adresse et du filtre de contrat permet donc d'acheminer chaque message qui arrive au niveau du `ListenUri` de ce service vers le point de terminaison approprié.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-127">Thus the combination of address filter and contract filter makes it possible to route each message that arrives at this service's `ListenUri` to the correct endpoint.</span></span> <span data-ttu-id="d2a3f-128">Le troisième point de terminaison se distingue des deux autres en ce sens qu'il accepte des messages envoyés à une adresse différente des autres points de terminaison.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-128">The third endpoint is differentiated from the other two because it accepts messages sent to a different address from the other endpoints.</span></span> <span data-ttu-id="d2a3f-129">Le premier et le deuxième point de terminaison se distinguent l'un de l'autre par leurs contrats (l'action du message entrant).</span><span class="sxs-lookup"><span data-stu-id="d2a3f-129">The first and second endpoints are differentiated from each other based on their contracts (the Action of the incoming message).</span></span>  
  
## <a name="client"></a><span data-ttu-id="d2a3f-130">Client</span><span class="sxs-lookup"><span data-stu-id="d2a3f-130">Client</span></span>  
 <span data-ttu-id="d2a3f-131">À l'instar des points de terminaison sur le serveur, les points de terminaison de client ont également deux adresses différentes.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-131">Just as endpoints on the server have two different addresses, client endpoints also have two addresses.</span></span> <span data-ttu-id="d2a3f-132">Sur le serveur et le client, l'adresse logique est appelée `EndpointAddress`.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-132">On both server and client, the logical address is called the `EndpointAddress`.</span></span> <span data-ttu-id="d2a3f-133">Mais si l'adresse physique est appelée `ListenUri` sur le serveur, elle est appelée `Via` sur le client.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-133">But whereas the physical address is called the `ListenUri` on the server, on the client, the physical address is called the `Via`.</span></span>  
  
 <span data-ttu-id="d2a3f-134">Tout comme sur le serveur, ces deux adresses sont par défaut les mêmes.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-134">As on the server, by default, these two addresses are the same.</span></span> <span data-ttu-id="d2a3f-135">`Via` permet de spécifier sur le client un `ClientViaBehavior` différent de l'adresse du point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-135">To specify a `Via` on the client that is different from the endpoint's address, `ClientViaBehavior` is used:</span></span>  
  
```csharp  
Uri via = new Uri("http://localhost/ServiceModelSamples/service.svc");  
CalculatorClient calcClient = new CalculatorClient();  
calcClient.ChannelFactory.Endpoint.Behaviors.Add(  
        new ClientViaBehavior(via));  
```  
  
 <span data-ttu-id="d2a3f-136">Comme habituellement, l'adresse provient du fichier configuration client généré par Svcutil.exe.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-136">As usual, the address comes from the client configuration file, which was generated by Svcutil.exe.</span></span> <span data-ttu-id="d2a3f-137">`Via` (qui correspond au `ListenUri` du service) n'apparaît pas dans les métadonnées du service et ces informations doivent donc être communiquées au client hors bande (à l'instar de l'adresse de métadonnées du service).</span><span class="sxs-lookup"><span data-stu-id="d2a3f-137">The `Via` (which corresponds to the `ListenUri` of the service) does not appear in the service's metadata and so this information must be communicated to the client out-of-band (just like the service's metadata address).</span></span>  
  
 <span data-ttu-id="d2a3f-138">Le client dans cet exemple envoie des messages à chacun des trois points de terminaison d'application du serveur afin de montrer qu'il peut communiquer avec (et différencier) les trois, même s'ils ont tous le même `Via`.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-138">The client in this sample sends messages to each of the server's three application endpoints, to demonstrate that it can communicate with (and differentiate) all three endpoints, even though they all have the same `Via`.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="d2a3f-139">Pour configurer, générer et exécuter l'exemple</span><span class="sxs-lookup"><span data-stu-id="d2a3f-139">To set up, build, and run the sample</span></span>  
  
1. <span data-ttu-id="d2a3f-140">Assurez-vous d’avoir effectué la [procédure d’installation unique pour les échantillons de la Fondation De communication Windows.](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</span><span class="sxs-lookup"><span data-stu-id="d2a3f-140">Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).</span></span>  
  
2. <span data-ttu-id="d2a3f-141">Pour générer l’édition C# ou Visual Basic .NET de la solution, conformez-vous aux instructions figurant dans [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).</span><span class="sxs-lookup"><span data-stu-id="d2a3f-141">To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).</span></span>  
  
3. <span data-ttu-id="d2a3f-142">Pour exécuter l’échantillon dans une configuration mono-ou cross-machine, suivez les instructions dans [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).</span><span class="sxs-lookup"><span data-stu-id="d2a3f-142">To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="d2a3f-143">Si vous utilisez plusieurs ordinateurs, vous devez remplacer localhost dans le fichier Client.cs par le nom de l'ordinateur de service.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-143">For cross-machine, you must replace localhost in the Client.cs file with the name of the service machine.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="d2a3f-144">Les exemples peuvent déjà être installés sur votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-144">The samples may already be installed on your machine.</span></span> <span data-ttu-id="d2a3f-145">Recherchez le répertoire (par défaut) suivant avant de continuer.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-145">Check for the following (default) directory before continuing.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples`  
>
> <span data-ttu-id="d2a3f-146">Si ce répertoire n’existe pas, rendez-vous sur [Windows Communication Foundation (WCF) et Windows Workflow Foundation (WF) Samples pour .NET Framework 4 pour](https://www.microsoft.com/download/details.aspx?id=21459) télécharger tous les Windows Communication Foundation (WCF) et [!INCLUDE[wf1](../../../../includes/wf1-md.md)] des échantillons.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-146">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="d2a3f-147">Cet exemple se trouve dans le répertoire suivant.</span><span class="sxs-lookup"><span data-stu-id="d2a3f-147">This sample is located in the following directory.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Services\MultipleEndpointsSingleUri`  

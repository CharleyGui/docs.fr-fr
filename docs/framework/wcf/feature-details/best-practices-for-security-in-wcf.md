---
title: Meilleures pratiques pour la sécurité dans WCF
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- best practices [WCF], security
ms.assetid: 3639de41-1fa7-4875-a1d7-f393e4c8bd69
ms.openlocfilehash: c99ab5e1e72aefc688df1692091e60caf930d5e4
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/09/2020
ms.locfileid: "84597616"
---
# <a name="best-practices-for-security-in-wcf"></a><span data-ttu-id="86e0c-102">Meilleures pratiques pour la sécurité dans WCF</span><span class="sxs-lookup"><span data-stu-id="86e0c-102">Best Practices for Security in WCF</span></span>
<span data-ttu-id="86e0c-103">Les sections suivantes répertorient les bonnes pratiques à prendre en compte durant la création d’applications sécurisées à l’aide de WCF (Windows Communication Foundation).</span><span class="sxs-lookup"><span data-stu-id="86e0c-103">The following sections list the best practices to consider when creating secure applications using Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="86e0c-104">Pour plus d’informations sur la sécurité, consultez [Considérations relatives à la sécurité](security-considerations-in-wcf.md), [Considérations sur la sécurité des données](security-considerations-for-data.md) et [Considérations sur la sécurité des métadonnées](security-considerations-with-metadata.md).</span><span class="sxs-lookup"><span data-stu-id="86e0c-104">For more information about security, see [Security Considerations](security-considerations-in-wcf.md), [Security Considerations for Data](security-considerations-for-data.md), and [Security Considerations with Metadata](security-considerations-with-metadata.md).</span></span>  
  
## <a name="identify-services-performing-windows-authentication-with-spns"></a><span data-ttu-id="86e0c-105">Identifier les services d'authentification Windows avec les SPN</span><span class="sxs-lookup"><span data-stu-id="86e0c-105">Identify Services Performing Windows Authentication with SPNs</span></span>  
 <span data-ttu-id="86e0c-106">Les services peuvent être identifiés avec les noms d'utilisateur principaux (UPN) ou les noms de principaux du service (SPN).</span><span class="sxs-lookup"><span data-stu-id="86e0c-106">Services can be identified with either user principal names (UPNs) or service principal names (SPNs).</span></span> <span data-ttu-id="86e0c-107">Les services qui s'exécutent sous des comptes d'ordinateur, tels que les services réseau, ont une identité SPN qui correspond à l'ordinateur en question.</span><span class="sxs-lookup"><span data-stu-id="86e0c-107">Services running under machine accounts such as network service have an SPN identity corresponding to the machine they're running.</span></span> <span data-ttu-id="86e0c-108">Les services qui s'exécutent sous des comptes d'utilisateur ont une identité UPN qui correspond à l'utilisateur en question, bien que l'outil `setspn` puisse être utilisé pour assigner un SPN au compte d'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="86e0c-108">Services running under user accounts have a UPN identity corresponding to the user they're running as, although the `setspn` tool can be used to assign an SPN to the user account.</span></span> <span data-ttu-id="86e0c-109">La configuration d'un service de sorte qu'il puisse être identifié par son SPN et la configuration des clients qui se connectent au service pour utiliser ce SPN peuvent compliquer certaines attaques.</span><span class="sxs-lookup"><span data-stu-id="86e0c-109">Configuring a service so it can be identified via SPN and configuring the clients connecting to the service to use that SPN can make certain attacks more difficult.</span></span> <span data-ttu-id="86e0c-110">Cette recommandation s’applique aux liaisons utilisant la négociation SSPI ou Kerberos.</span><span class="sxs-lookup"><span data-stu-id="86e0c-110">This guidance applies to bindings using Kerberos or SSPI negotiation.</span></span>  <span data-ttu-id="86e0c-111">Les clients doivent toujours spécifier un SPN dans le cas où SSPI revient à NTLM.</span><span class="sxs-lookup"><span data-stu-id="86e0c-111">Clients should still specify an SPN in the case where SSPI falls back to NTLM.</span></span>  
  
## <a name="verify-service-identities-in-wsdl"></a><span data-ttu-id="86e0c-112">Vérifier les identités des services dans WSDL</span><span class="sxs-lookup"><span data-stu-id="86e0c-112">Verify Service Identities in WSDL</span></span>  
 <span data-ttu-id="86e0c-113">WS-SecurityPolicy permet aux services de publier des informations concernant leurs propres identités dans les métadonnées.</span><span class="sxs-lookup"><span data-stu-id="86e0c-113">WS-SecurityPolicy allows services to publish information about their own identities in metadata.</span></span> <span data-ttu-id="86e0c-114">Quand elles sont récupérées via `svcutil` ou d’autres méthodes telles que <xref:System.ServiceModel.Description.WsdlImporter>, ces informations d’identité sont traduites en propriétés d’identité des adresses du point de terminaison de service WCF.</span><span class="sxs-lookup"><span data-stu-id="86e0c-114">When retrieved via `svcutil` or other methods such as <xref:System.ServiceModel.Description.WsdlImporter>, this identity information is translated to the identity properties of the WCF service endpoint addresses.</span></span> <span data-ttu-id="86e0c-115">Les clients qui ne vérifient pas l'exactitude et la validité de ces identités de service contournent efficacement l'authentification des services.</span><span class="sxs-lookup"><span data-stu-id="86e0c-115">Clients which do not verify that these service identities are correct and valid effectively bypass service authentication.</span></span> <span data-ttu-id="86e0c-116">Un service malveillant peut exploiter ces clients pour transférer des informations d'identification et exécuter d'autres attaques « de l'intercepteur » en modifiant l'identité prétendue dans son WSDL.</span><span class="sxs-lookup"><span data-stu-id="86e0c-116">A malicious service can exploit such clients to execute credential forwarding and other "man in the middle" attacks by changing the identity claimed in its WSDL.</span></span>  
  
## <a name="use-x509-certificates-instead-of-ntlm"></a><span data-ttu-id="86e0c-117">Utiliser des certificats X509 au lieu de NTLM</span><span class="sxs-lookup"><span data-stu-id="86e0c-117">Use X509 Certificates Instead of NTLM</span></span>  
 <span data-ttu-id="86e0c-118">WCF propose deux mécanismes d’authentification pair à pair : les certificats X509 (utilisés par le canal homologue) et l’authentification Windows, où une négociation SSPI passe à une version antérieure, de Kerberos à NTLM.</span><span class="sxs-lookup"><span data-stu-id="86e0c-118">WCF offers two mechanisms for peer-to-peer authentication: X509 certificates (used by peer channel) and Windows authentication where an SSPI negotiation downgrades from Kerberos to NTLM.</span></span>  <span data-ttu-id="86e0c-119">L'authentification basée sur des certificats utilisant des tailles de clé de 1 024 bits ou plus est préférée à NTLM pour plusieurs raisons :</span><span class="sxs-lookup"><span data-stu-id="86e0c-119">Certificate-based authentication using key sizes of 1024 bits or more is preferred to NTLM for several reasons:</span></span>  
  
- <span data-ttu-id="86e0c-120">la disponibilité de l'authentification mutuelle ;</span><span class="sxs-lookup"><span data-stu-id="86e0c-120">the availability of mutual authentication,</span></span>  
  
- <span data-ttu-id="86e0c-121">l'utilisation d'algorithmes de chiffrement plus robustes ;</span><span class="sxs-lookup"><span data-stu-id="86e0c-121">the use of stronger cryptographic algorithms, and</span></span>  
  
- <span data-ttu-id="86e0c-122">la plus grande complexité liée à l'utilisation des informations d'identification X509 transférées.</span><span class="sxs-lookup"><span data-stu-id="86e0c-122">the greater difficulty of utilizing forwarded X509 credentials.</span></span>  

## <a name="always-revert-after-impersonation"></a><span data-ttu-id="86e0c-123">Toujours rétablir après l'emprunt d'identité</span><span class="sxs-lookup"><span data-stu-id="86e0c-123">Always Revert After Impersonation</span></span>  
 <span data-ttu-id="86e0c-124">Lorsque vous utilisez des API qui activent l'emprunt d'identité d'un client, veillez à rétablir l'identité d'origine.</span><span class="sxs-lookup"><span data-stu-id="86e0c-124">When using APIs that enable impersonation of a client, be sure to revert to the original identity.</span></span> <span data-ttu-id="86e0c-125">Par exemple, quand vous utilisez <xref:System.Security.Principal.WindowsIdentity> et <xref:System.Security.Principal.WindowsImpersonationContext>, employez l’instruction C# `using` ou l’instruction Visual Basic `Using`, comme indiqué dans le code suivant.</span><span class="sxs-lookup"><span data-stu-id="86e0c-125">For example, when using the <xref:System.Security.Principal.WindowsIdentity> and <xref:System.Security.Principal.WindowsImpersonationContext>, use the C# `using` statement or the Visual Basic`Using` statement, as shown in the following code.</span></span> <span data-ttu-id="86e0c-126">La classe <xref:System.Security.Principal.WindowsImpersonationContext> implémente l'interface <xref:System.IDisposable>, et par conséquent, le common language runtime (CLR) rétablit automatiquement l'identité d'origine dès que le code quitte le bloc `using`.</span><span class="sxs-lookup"><span data-stu-id="86e0c-126">The <xref:System.Security.Principal.WindowsImpersonationContext> class implements the <xref:System.IDisposable> interface, and therefore the common language runtime (CLR) automatically reverts to the original identity once the code leaves the `using` block.</span></span>  
  
 [!code-csharp[c_SecurityBestPractices#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securitybestpractices/cs/source.cs#1)]
 [!code-vb[c_SecurityBestPractices#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securitybestpractices/vb/source.vb#1)]  
  
## <a name="impersonate-only-as-needed"></a><span data-ttu-id="86e0c-127">Personnifier uniquement si nécessaire</span><span class="sxs-lookup"><span data-stu-id="86e0c-127">Impersonate Only as Needed</span></span>  
 <span data-ttu-id="86e0c-128">À l'aide de la méthode <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> de la classe <xref:System.Security.Principal.WindowsIdentity>, il est possible d'utiliser l'emprunt d'identité dans une étendue très contrôlée.</span><span class="sxs-lookup"><span data-stu-id="86e0c-128">Using the <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method of the <xref:System.Security.Principal.WindowsIdentity> class, it is possible to use impersonation in a very controlled scope.</span></span> <span data-ttu-id="86e0c-129">Cette approche s'oppose à l'utilisation de la propriété <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> du <xref:System.ServiceModel.OperationBehaviorAttribute> qui autorise l'emprunt d'identité pour l'étendue de l'opération entière.</span><span class="sxs-lookup"><span data-stu-id="86e0c-129">This is in contrast to using the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property of the <xref:System.ServiceModel.OperationBehaviorAttribute>, which allows impersonation for the scope of the entire operation.</span></span> <span data-ttu-id="86e0c-130">Si possible, contrôlez l'étendue de l'emprunt d'identité en utilisant la méthode <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> plus précise.</span><span class="sxs-lookup"><span data-stu-id="86e0c-130">Whenever possible, control the scope of impersonation by using the more precise <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method.</span></span>  
  
## <a name="obtain-metadata-from-trusted-sources"></a><span data-ttu-id="86e0c-131">Obtenir des métadonnées de sources fiables</span><span class="sxs-lookup"><span data-stu-id="86e0c-131">Obtain Metadata from Trusted Sources</span></span>  
 <span data-ttu-id="86e0c-132">Soyez sûr de la source de vos métadonnées et vérifiez qu'elles n'ont pas été falsifiées.</span><span class="sxs-lookup"><span data-stu-id="86e0c-132">Be sure you trust the source of your metadata and make sure that no one has tampered with the metadata.</span></span> <span data-ttu-id="86e0c-133">Les métadonnées récupérées à l'aide du protocole HTTP sont envoyées en texte clair et peuvent être falsifiées.</span><span class="sxs-lookup"><span data-stu-id="86e0c-133">Metadata retrieved using the HTTP protocol is sent in clear text and can be tampered with.</span></span> <span data-ttu-id="86e0c-134">Si le service utilise les propriétés <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> et <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A>, utilisez l'URL que le créateur du service vous a fournie pour télécharger les données à l'aide du protocole HTTPS.</span><span class="sxs-lookup"><span data-stu-id="86e0c-134">If the service uses the <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> and <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A> properties, use the URL supplied by the service creator to download the data using the HTTPS protocol.</span></span>  
  
## <a name="publish-metadata-using-security"></a><span data-ttu-id="86e0c-135">Publier des métadonnées à l'aide de la sécurité</span><span class="sxs-lookup"><span data-stu-id="86e0c-135">Publish Metadata Using Security</span></span>  
 <span data-ttu-id="86e0c-136">Pour empêcher la falsification des métadonnées publiées d'un service, sécurisez le point de terminaison d'échange de métadonnées avec la sécurité de transport ou au niveau du message.</span><span class="sxs-lookup"><span data-stu-id="86e0c-136">To prevent tampering with a service's published metadata, secure the metadata exchange endpoint with transport or message-level security.</span></span> <span data-ttu-id="86e0c-137">Pour plus d’informations, consultez [Publication de points de terminaison de métadonnées](../publishing-metadata-endpoints.md) et [Guide pratique pour publier les métadonnées d’un service à l’aide de code](how-to-publish-metadata-for-a-service-using-code.md).</span><span class="sxs-lookup"><span data-stu-id="86e0c-137">For more information, see [Publishing Metadata Endpoints](../publishing-metadata-endpoints.md) and [How to: Publish Metadata for a Service Using Code](how-to-publish-metadata-for-a-service-using-code.md).</span></span>  
  
## <a name="ensure-use-of-local-issuer"></a><span data-ttu-id="86e0c-138">Utiliser un émetteur local</span><span class="sxs-lookup"><span data-stu-id="86e0c-138">Ensure Use of Local Issuer</span></span>  
 <span data-ttu-id="86e0c-139">Si une liaison et une adresse d’émetteur sont spécifiées pour une liaison donnée, l’émetteur local n’est pas utilisé pour les points de terminaison qui utilisent cette liaison.</span><span class="sxs-lookup"><span data-stu-id="86e0c-139">If an issuer address and binding are specified for a given binding, the local issuer is not used for endpoints that use that binding.</span></span> <span data-ttu-id="86e0c-140">Les clients qui prévoient d’utiliser systématiquement l’émetteur local doivent s’assurer de ne pas utiliser de liaison de ce type ou de modifier la liaison afin que l’adresse de l’émetteur ait la valeur null.</span><span class="sxs-lookup"><span data-stu-id="86e0c-140">Clients who expect to always use the local issuer should ensure that they do not use such a binding or that they modify the binding such that the issuer address is null.</span></span>  
  
## <a name="saml-token-size-quotas"></a><span data-ttu-id="86e0c-141">Quotas de taille de jeton SAML</span><span class="sxs-lookup"><span data-stu-id="86e0c-141">SAML Token Size Quotas</span></span>  
 <span data-ttu-id="86e0c-142">Lorsque les jetons SAML (Security Assertions Markup Language) sont sérialisés dans des messages, soit lorsqu'ils sont délivrés par un service de jeton de sécurité (STS), soit lorsque les clients les présentent à des services dans le cadre de l'authentification, le quota de taille maximale de message doit être suffisamment grand pour accommoder le jeton SAML et les autres parties de message.</span><span class="sxs-lookup"><span data-stu-id="86e0c-142">When Security Assertions Markup Language (SAML) tokens are serialized in messages, either when they are issued by a Security Token Service (STS) or when clients present them to services as part of authentication, the maximum message size quota must be sufficiently large to accommodate the SAML token and the other message parts.</span></span> <span data-ttu-id="86e0c-143">Dans un cas normal, les quotas de taille de message par défaut sont suffisants.</span><span class="sxs-lookup"><span data-stu-id="86e0c-143">In normal cases, the default message size quotas are sufficient.</span></span> <span data-ttu-id="86e0c-144">Toutefois, dans les cas où un jeton SAML est grand parce qu'il contient des centaines de revendications, les quotas doivent être augmentés pour accommoder le jeton sérialisé.</span><span class="sxs-lookup"><span data-stu-id="86e0c-144">However, in cases where a SAML token is large because it contains hundreds of claims, the quotas should be increased to accommodate the serialized token.</span></span> <span data-ttu-id="86e0c-145">Pour plus d’informations sur les quotas, consultez [Considérations sur la sécurité des données](security-considerations-for-data.md).</span><span class="sxs-lookup"><span data-stu-id="86e0c-145">For more information about quotas, see [Security Considerations for Data](security-considerations-for-data.md).</span></span>  
  
## <a name="set-securitybindingelementincludetimestamp-to-true-on-custom-bindings"></a><span data-ttu-id="86e0c-146">Affectation de la valeur True à SecurityBindingElement.IncludeTimestamp sur des liaisons personnalisées</span><span class="sxs-lookup"><span data-stu-id="86e0c-146">Set SecurityBindingElement.IncludeTimestamp to True on Custom Bindings</span></span>  
 <span data-ttu-id="86e0c-147">Lorsque vous créez une liaison personnalisée, vous devez affecter la valeur <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> à `true`.</span><span class="sxs-lookup"><span data-stu-id="86e0c-147">When you create a custom binding, you must set <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> to `true`.</span></span> <span data-ttu-id="86e0c-148">Sinon, si <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> a la valeur `false` et que le client utilise un jeton basé sur une clé asymétrique comme un certificat X509, le message ne sera pas signé.</span><span class="sxs-lookup"><span data-stu-id="86e0c-148">Otherwise, if <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> is set to `false`, and the client is using an asymmetric key-based token such as an X509 certificate, the message will not be signed.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="86e0c-149">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="86e0c-149">See also</span></span>

- [<span data-ttu-id="86e0c-150">Security Considerations</span><span class="sxs-lookup"><span data-stu-id="86e0c-150">Security Considerations</span></span>](security-considerations-in-wcf.md)
- [<span data-ttu-id="86e0c-151">Considérations relatives à la sécurité des données</span><span class="sxs-lookup"><span data-stu-id="86e0c-151">Security Considerations for Data</span></span>](security-considerations-for-data.md)
- [<span data-ttu-id="86e0c-152">Considérations sur la sécurité des métadonnées</span><span class="sxs-lookup"><span data-stu-id="86e0c-152">Security Considerations with Metadata</span></span>](security-considerations-with-metadata.md)

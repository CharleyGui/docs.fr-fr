---
title: Résolution des problèmes de messagerie en file d'attente
ms.date: 03/30/2017
ms.assetid: a5f2836f-018d-42f5-a571-1e97e64ea5b0
ms.openlocfilehash: 7990d4b9847ee2f35b9fe6269bb211763c4c80b6
ms.sourcegitcommit: 011314e0c8eb4cf4a11d92078f58176c8c3efd2d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/09/2020
ms.locfileid: "77095006"
---
# <a name="troubleshooting-queued-messaging"></a><span data-ttu-id="b8099-102">Résolution des problèmes de messagerie en file d'attente</span><span class="sxs-lookup"><span data-stu-id="b8099-102">Troubleshooting Queued Messaging</span></span>

<span data-ttu-id="b8099-103">Cette section contient des questions courantes et une aide pour la résolution des problèmes liés à l’utilisation des files d’attente dans Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="b8099-103">This section contains common questions and troubleshooting help for using queues in Windows Communication Foundation (WCF).</span></span>

## <a name="common-questions"></a><span data-ttu-id="b8099-104">Questions courantes</span><span class="sxs-lookup"><span data-stu-id="b8099-104">Common Questions</span></span>

<span data-ttu-id="b8099-105">**Q :** J’ai utilisé la version bêta 1 de WCF et j’ai installé le correctif MSMQ.</span><span class="sxs-lookup"><span data-stu-id="b8099-105">**Q:** I used WCF Beta 1 and I installed the MSMQ hotfix.</span></span> <span data-ttu-id="b8099-106">Est-ce que je dois supprimer le correctif logiciel ?</span><span class="sxs-lookup"><span data-stu-id="b8099-106">Do I need to remove the hotfix?</span></span>

<span data-ttu-id="b8099-107">**R :** Oui.</span><span class="sxs-lookup"><span data-stu-id="b8099-107">**A:** Yes.</span></span> <span data-ttu-id="b8099-108">Ce correctif logiciel n'est plus pris en charge.</span><span class="sxs-lookup"><span data-stu-id="b8099-108">This hotfix is no longer supported.</span></span> <span data-ttu-id="b8099-109">WCF fonctionne désormais sur MSMQ sans nécessiter de correctif logiciel.</span><span class="sxs-lookup"><span data-stu-id="b8099-109">WCF now works on MSMQ without a hotfix requirement.</span></span>

<span data-ttu-id="b8099-110">**Q :** Il existe deux liaisons pour MSMQ : <xref:System.ServiceModel.NetMsmqBinding> et <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.</span><span class="sxs-lookup"><span data-stu-id="b8099-110">**Q:** There are two bindings for MSMQ: <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.</span></span> <span data-ttu-id="b8099-111">Laquelle dois-je utiliser et à quel moment ?</span><span class="sxs-lookup"><span data-stu-id="b8099-111">What should I use and when?</span></span>

<span data-ttu-id="b8099-112">**R :** Utilisez la <xref:System.ServiceModel.NetMsmqBinding> lorsque vous souhaitez utiliser MSMQ comme transport pour la communication en file d’attente entre deux applications WCF.</span><span class="sxs-lookup"><span data-stu-id="b8099-112">**A:** Use the <xref:System.ServiceModel.NetMsmqBinding> when you want to use MSMQ as a transport for queued communication between two WCF applications.</span></span> <span data-ttu-id="b8099-113">Utilisez la <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> lorsque vous souhaitez utiliser des applications MSMQ existantes pour communiquer avec les nouvelles applications WCF.</span><span class="sxs-lookup"><span data-stu-id="b8099-113">Use the <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> when you want to use existing MSMQ applications to communicate with new WCF applications.</span></span>

<span data-ttu-id="b8099-114">**Q :** Dois-je mettre à niveau MSMQ pour utiliser les liaisons <xref:System.ServiceModel.NetMsmqBinding> et `MsmqIntegration` ?</span><span class="sxs-lookup"><span data-stu-id="b8099-114">**Q:** Do I have to upgrade MSMQ to use the <xref:System.ServiceModel.NetMsmqBinding> and `MsmqIntegration` bindings?</span></span>

<span data-ttu-id="b8099-115">**R :** Non.</span><span class="sxs-lookup"><span data-stu-id="b8099-115">**A:** No.</span></span> <span data-ttu-id="b8099-116">Les deux liaisons fonctionnent avec MSMQ 3,0 sur Windows XP et Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="b8099-116">Both bindings work with MSMQ 3.0 on Windows XP and Windows Server 2003.</span></span> <span data-ttu-id="b8099-117">Certaines fonctionnalités des liaisons deviennent disponibles lorsque vous effectuez une mise à niveau vers MSMQ 4,0 dans Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="b8099-117">Certain features of the bindings become available when you upgrade to MSMQ 4.0 in Windows Vista.</span></span>

<span data-ttu-id="b8099-118">**Q :** Quelles sont les fonctionnalités des liaisons <xref:System.ServiceModel.NetMsmqBinding> et <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> sont disponibles dans MSMQ 4,0, mais pas dans MSMQ 3,0 ?</span><span class="sxs-lookup"><span data-stu-id="b8099-118">**Q:** What features of the <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> bindings are available in MSMQ 4.0 but not in MSMQ 3.0?</span></span>

<span data-ttu-id="b8099-119">**R :** Les fonctionnalités suivantes sont disponibles dans MSMQ 4,0, mais pas dans MSMQ 3,0 :</span><span class="sxs-lookup"><span data-stu-id="b8099-119">**A:** The following features are available in MSMQ 4.0 but not in MSMQ 3.0:</span></span>

- <span data-ttu-id="b8099-120">La file d'attente de lettres mortes personnalisée est uniquement prise en charge sur MSMQ 4.0.</span><span class="sxs-lookup"><span data-stu-id="b8099-120">Custom dead-letter queue is supported only on MSMQ 4.0.</span></span>

- <span data-ttu-id="b8099-121">MSMQ 3.0 et 4.0 gèrent les messages incohérents différemment.</span><span class="sxs-lookup"><span data-stu-id="b8099-121">MSMQ 3.0 and 4.0 handle poison messages differently.</span></span>

- <span data-ttu-id="b8099-122">Seul MSMQ 4.0 prend en charge la lecture transactionnelle à distance.</span><span class="sxs-lookup"><span data-stu-id="b8099-122">Only MSMQ 4.0 supports remote transacted read.</span></span>

<span data-ttu-id="b8099-123">Pour plus d’informations, consultez différences entre les [fonctionnalités de mise en file d’attente dans Windows Vista, Windows Server 2003 et Windows XP](../../../../docs/framework/wcf/feature-details/diff-in-queue-in-vista-server-2003-windows-xp.md).</span><span class="sxs-lookup"><span data-stu-id="b8099-123">For more information, see [Differences in Queuing Features in Windows Vista, Windows Server 2003, and Windows XP](../../../../docs/framework/wcf/feature-details/diff-in-queue-in-vista-server-2003-windows-xp.md).</span></span>

<span data-ttu-id="b8099-124">**Q :** Puis-je utiliser MSMQ 3,0 sur l’un des côtés d’une communication en file d’attente et MSMQ 4,0 de l’autre côté ?</span><span class="sxs-lookup"><span data-stu-id="b8099-124">**Q:** Can I use MSMQ 3.0 on one side of a queued communication and MSMQ 4.0 on the other side?</span></span>

<span data-ttu-id="b8099-125">**R :** Oui.</span><span class="sxs-lookup"><span data-stu-id="b8099-125">**A:** Yes.</span></span>

<span data-ttu-id="b8099-126">**Q :** Je souhaite intégrer des applications MSMQ existantes à de nouveaux clients ou serveurs WCF.</span><span class="sxs-lookup"><span data-stu-id="b8099-126">**Q:** I want to integrate existing MSMQ applications with new WCF clients or servers.</span></span> <span data-ttu-id="b8099-127">Est-ce que je dois mettre à niveau les deux côtés de mon infrastructure MSMQ ?</span><span class="sxs-lookup"><span data-stu-id="b8099-127">Do I need to upgrade both sides of my MSMQ infrastructure?</span></span>

<span data-ttu-id="b8099-128">**R :** Non.</span><span class="sxs-lookup"><span data-stu-id="b8099-128">**A:** No.</span></span> <span data-ttu-id="b8099-129">Vous n'êtes pas obligé d'effectuer la mise à niveau vers MSMQ 4.0 sur l'un ou l'autre des côtés.</span><span class="sxs-lookup"><span data-stu-id="b8099-129">You do not have to upgrade to MSMQ 4.0 on either side.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="b8099-130">Dépannage</span><span class="sxs-lookup"><span data-stu-id="b8099-130">Troubleshooting</span></span>

<span data-ttu-id="b8099-131">Cette section contient les solutions aux problèmes les plus courants.</span><span class="sxs-lookup"><span data-stu-id="b8099-131">This section contains answers to most common troubleshooting issues.</span></span> <span data-ttu-id="b8099-132">Certains problèmes correspondant à des restrictions connues sont également décrits dans les notes de publication.</span><span class="sxs-lookup"><span data-stu-id="b8099-132">Some issues that are known limitations are also described in the release notes.</span></span>

<span data-ttu-id="b8099-133">**Q :** J’essaie d’utiliser une file d’attente privée et j’obtiens l’exception suivante : `System.InvalidOperationException`: l’URL n’est pas valide.</span><span class="sxs-lookup"><span data-stu-id="b8099-133">**Q:** I am trying to use a private queue and I get the following exception: `System.InvalidOperationException`: The URL is invalid.</span></span> <span data-ttu-id="b8099-134">L'URL de la file d'attente ne peut pas contenir le caractère « $ ».</span><span class="sxs-lookup"><span data-stu-id="b8099-134">The URL for the queue cannot contain the '$' character.</span></span> <span data-ttu-id="b8099-135">Utilisez la syntaxe dans net.msmq://machine/private/queueName pour adresser une file d'attente privée.</span><span class="sxs-lookup"><span data-stu-id="b8099-135">Use the syntax in net.msmq://machine/private/queueName to address a private queue.</span></span>

<span data-ttu-id="b8099-136">**R :** Vérifiez la file d’attente Uniform Resource Identifier (URI) dans votre configuration et votre code.</span><span class="sxs-lookup"><span data-stu-id="b8099-136">**A:** Check the queue Uniform Resource Identifier (URI) in your configuration and code.</span></span> <span data-ttu-id="b8099-137">N'utilisez pas le caractère « $ » dans l'URI.</span><span class="sxs-lookup"><span data-stu-id="b8099-137">Do not use the "$" character in the URI.</span></span> <span data-ttu-id="b8099-138">Par exemple, pour adresser une file d’attente privée nommée OrdersQueue, spécifiez l’URI en tant que `net.msmq://localhost/private/ordersQueue`.</span><span class="sxs-lookup"><span data-stu-id="b8099-138">For example, to address a private queue named OrdersQueue, specify the URI as `net.msmq://localhost/private/ordersQueue`.</span></span>

<span data-ttu-id="b8099-139">**Q :** L’appel de `ServiceHost.Open()` sur mon application en file d’attente lève l’exception suivante : `System.ArgumentException`: une adresse de base ne peut pas contenir une chaîne de requête d’URI.</span><span class="sxs-lookup"><span data-stu-id="b8099-139">**Q:** Calling `ServiceHost.Open()` on my queued application throws the following exception: `System.ArgumentException`: A base address cannot contain a URI query string.</span></span> <span data-ttu-id="b8099-140">Pourquoi ?</span><span class="sxs-lookup"><span data-stu-id="b8099-140">Why?</span></span>

<span data-ttu-id="b8099-141">**R :** Vérifiez l’URI de la file d’attente dans votre fichier de configuration et dans votre code.</span><span class="sxs-lookup"><span data-stu-id="b8099-141">**A:** Check the queue URI in your configuration file and in your code.</span></span> <span data-ttu-id="b8099-142">Alors que les files d'attente MSMQ prennent en charge l'utilisation du caractère '?', les Uri interprètent ce dernier comme le début d'une requête de chaîne.</span><span class="sxs-lookup"><span data-stu-id="b8099-142">While MSMQ queues support the use of the '?' character, URIs interpret this character as the beginning of a string query.</span></span> <span data-ttu-id="b8099-143">Pour éviter ce problème, utilisez des noms de file d'attente qui ne comportent pas de caractère '?'.</span><span class="sxs-lookup"><span data-stu-id="b8099-143">To avoid this issue, use queue names that do not contain '?' characters.</span></span>

<span data-ttu-id="b8099-144">**Q :** Mon envoi a réussi mais aucune opération de service n’est appelée sur le récepteur.</span><span class="sxs-lookup"><span data-stu-id="b8099-144">**Q:** My send succeeded but no service operation is invoked on the receiver.</span></span> <span data-ttu-id="b8099-145">Pourquoi ?</span><span class="sxs-lookup"><span data-stu-id="b8099-145">Why?</span></span>

<span data-ttu-id="b8099-146">**R :** Pour déterminer la réponse, utilisez la liste de vérification suivante :</span><span class="sxs-lookup"><span data-stu-id="b8099-146">**A:** To determine the answer, work through the following check list:</span></span>

- <span data-ttu-id="b8099-147">Vérifiez que les spécifications de la file d’attente transactionnelle sont compatibles avec les garanties spécifiées.</span><span class="sxs-lookup"><span data-stu-id="b8099-147">Check that the transactional queue requirements are compatible with the assurances specified.</span></span> <span data-ttu-id="b8099-148">Notez les principes suivants :</span><span class="sxs-lookup"><span data-stu-id="b8099-148">Note the following principles:</span></span>

  - <span data-ttu-id="b8099-149">Vous pouvez envoyer des messages durables (datagrammes et sessions) avec des garanties « exactement une fois » (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`) uniquement à une file d’attente transactionnelle.</span><span class="sxs-lookup"><span data-stu-id="b8099-149">You can send durable messages (datagrams and sessions) with "exactly once" assurances (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`) only to a transactional queue.</span></span>

  - <span data-ttu-id="b8099-150">Vous pouvez envoyer des sessions uniquement avec des garanties « exactly-once ».</span><span class="sxs-lookup"><span data-stu-id="b8099-150">You can send sessions only with "exactly once" assurances.</span></span>

  - <span data-ttu-id="b8099-151">Une transaction est requise pour recevoir des messages dans une session provenant d’une file d’attente transactionnelle.</span><span class="sxs-lookup"><span data-stu-id="b8099-151">A transaction is required to receive messages in a session from a transactional queue.</span></span>

  - <span data-ttu-id="b8099-152">Vous pouvez envoyer ou recevoir des messages volatils ou durables (datagrammes uniquement) sans garanties (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`) qu’à une file d’attente non transactionnelle.</span><span class="sxs-lookup"><span data-stu-id="b8099-152">You can send or receive volatile or durable messages (datagrams only) with no assurances (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`) only to a non-transactional queue.</span></span>

- <span data-ttu-id="b8099-153">Vérifiez la file d'attente de lettres mortes.</span><span class="sxs-lookup"><span data-stu-id="b8099-153">Check the dead-letter queue.</span></span> <span data-ttu-id="b8099-154">Si vous y trouvez les messages, déterminez pourquoi ils n'ont pas été remis.</span><span class="sxs-lookup"><span data-stu-id="b8099-154">If you find the messages there, determine why they were not delivered.</span></span>

- <span data-ttu-id="b8099-155">Recherchez dans les files d'attente sortantes d'éventuels problèmes de connectivité ou d'adressage.</span><span class="sxs-lookup"><span data-stu-id="b8099-155">Check the outgoing queues for connectivity or addressing problems.</span></span>

<span data-ttu-id="b8099-156">**Q :** J’ai spécifié une file d’attente de lettres mortes personnalisée, mais lorsque je démarre l’application expéditeur, j’obtiens une exception indiquant que la file d’attente de lettres mortes est introuvable ou que l’application émettrice n’a pas d’autorisation sur la file d’attente de lettres mortes.</span><span class="sxs-lookup"><span data-stu-id="b8099-156">**Q:** I have specified a custom dead-letter queue, but when I start the sender application, I get an exception that either the dead-letter queue is not found, or the sending application has no permission to the dead-letter queue.</span></span> <span data-ttu-id="b8099-157">Que se passe-t-il ?</span><span class="sxs-lookup"><span data-stu-id="b8099-157">Why is this happening?</span></span>

<span data-ttu-id="b8099-158">**R :** L’URI de la file d’attente de lettres mortes personnalisée doit inclure un « localhost » ou le nom de l’ordinateur dans le premier segment, par exemple, net. msmq://localhost/private/myAppdead-letter queue.</span><span class="sxs-lookup"><span data-stu-id="b8099-158">**A:** The custom dead-letter queue URI must include a "localhost" or the computer name in the first segment, for example, net.msmq://localhost/private/myAppdead-letter queue.</span></span>

<span data-ttu-id="b8099-159">**Q :** Est-il toujours nécessaire de définir une file d’attente de lettres mortes personnalisée, ou existe-t-il une file d’attente de lettres mortes par défaut ?</span><span class="sxs-lookup"><span data-stu-id="b8099-159">**Q:** Is it always necessary to define a custom dead-letter queue, or is there a default dead-letter queue?</span></span>

<span data-ttu-id="b8099-160">**R :** Si les assurances sont « exactement une fois » (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`) et si vous ne spécifiez pas de file d’attente de lettres mortes personnalisée, la valeur par défaut est une file d’attente de lettres mortes transactionnelle à l’ensemble du système.</span><span class="sxs-lookup"><span data-stu-id="b8099-160">**A:** If assurances are "exactly once" (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`), and if you do not specify a custom dead-letter queue, the default is a system-wide transactional dead-letter queue.</span></span>

<span data-ttu-id="b8099-161">Si les garanties sont None (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`), la valeur par défaut est aucune fonctionnalité de file d’attente de lettres mortes.</span><span class="sxs-lookup"><span data-stu-id="b8099-161">If assurances are none (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`), then the default is no dead-letter queue functionality.</span></span>

<span data-ttu-id="b8099-162">**Q :** Mon service lève une exception dans SvcHost. Open avec un message « EndpointListener Requirements ne peut pas être respecté par ListenerFactory ».</span><span class="sxs-lookup"><span data-stu-id="b8099-162">**Q:** My service throws on SvcHost.Open with a message "EndpointListener requirements cannot be met by the ListenerFactory".</span></span> <span data-ttu-id="b8099-163">Pourquoi ?</span><span class="sxs-lookup"><span data-stu-id="b8099-163">Why?</span></span>

<span data-ttu-id="b8099-164">R.</span><span class="sxs-lookup"><span data-stu-id="b8099-164">A.</span></span> <span data-ttu-id="b8099-165">Consultez votre contrat de service.</span><span class="sxs-lookup"><span data-stu-id="b8099-165">Check your service contract.</span></span> <span data-ttu-id="b8099-166">Vous avez peut-être oublié de placer « IsOneWay =`true`» sur toutes les opérations de service.</span><span class="sxs-lookup"><span data-stu-id="b8099-166">You may have forgotten to put "IsOneWay=`true`" on all the service operations.</span></span> <span data-ttu-id="b8099-167">Les files d'attente prennent uniquement en charge les opérations de service monodirectionnelles.</span><span class="sxs-lookup"><span data-stu-id="b8099-167">Queues support only one-way service operations.</span></span>

<span data-ttu-id="b8099-168">**Q :** Il y a des messages dans la file d’attente, mais aucune opération de service n’est appelée.</span><span class="sxs-lookup"><span data-stu-id="b8099-168">**Q:** There are messages in the queue but no service operation is invoked.</span></span> <span data-ttu-id="b8099-169">Quel est le problème ?</span><span class="sxs-lookup"><span data-stu-id="b8099-169">What is the problem?</span></span>

<span data-ttu-id="b8099-170">**R :** Déterminez si votre hôte de service a généré une erreur.</span><span class="sxs-lookup"><span data-stu-id="b8099-170">**A:** Determine if your service host is faulted.</span></span> <span data-ttu-id="b8099-171">Vous pouvez le vérifier en examinant le suivi ou en implémentant `IErrorHandler`.</span><span class="sxs-lookup"><span data-stu-id="b8099-171">You can check by looking at the trace or implementing `IErrorHandler`.</span></span> <span data-ttu-id="b8099-172">L'hôte de service provoque une erreur, par défaut, si un message incohérent est détecté.</span><span class="sxs-lookup"><span data-stu-id="b8099-172">Service host faults, by default, if a poison message is detected.</span></span>

<span data-ttu-id="b8099-173">**Q :** La file d’attente contient des messages, mais mon service hébergé sur le Web n’est pas activé.</span><span class="sxs-lookup"><span data-stu-id="b8099-173">**Q:** There are messages in the queue but my Web-hosted queued service is not getting activated.</span></span> <span data-ttu-id="b8099-174">Pourquoi ?</span><span class="sxs-lookup"><span data-stu-id="b8099-174">Why?</span></span>

<span data-ttu-id="b8099-175">**R :** La raison la plus courante est l’autorisation.</span><span class="sxs-lookup"><span data-stu-id="b8099-175">**A:** The most common reason is permissions.</span></span>

1. <span data-ttu-id="b8099-176">Vérifiez que le processus `NetMsmqActivator` s'exécute et que des autorisations de lecture et de recherche sont attribuées à l'identité du processus `NetMsmqActivator` sur la file d'attente.</span><span class="sxs-lookup"><span data-stu-id="b8099-176">Ensure that the `NetMsmqActivator` process is running and the identity of the `NetMsmqActivator` process is given read and seek permission on the queue.</span></span>

2. <span data-ttu-id="b8099-177">Si `NetMsmqActivator` surveille les files d'attente sur un ordinateur distant, assurez-vous que `NetMsmqActivator` ne s'exécute pas sous un jeton restreint.</span><span class="sxs-lookup"><span data-stu-id="b8099-177">If the `NetMsmqActivator` is monitoring queues on a remote machine, ensure that `NetMsmqActivator` does not run under a restricted token.</span></span> <span data-ttu-id="b8099-178">Pour exécuter `NetMsmqActivator` avec un jeton non restreint :</span><span class="sxs-lookup"><span data-stu-id="b8099-178">To run the `NetMsmqActivator` with an unrestricted token:</span></span>

    ```console
    sc sidtype NetMsmqActivator unrestricted
    ```

<span data-ttu-id="b8099-179">Pour les problèmes d’hôte Web non liés à la sécurité, reportez-vous à : [hébergement Web d’une application en file d’attente](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md).</span><span class="sxs-lookup"><span data-stu-id="b8099-179">For non-security related Web host issues refer to: [Web Hosting a Queued Application](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md).</span></span>

<span data-ttu-id="b8099-180">**Q :** Quel est le moyen le plus simple d’accéder aux sessions ?</span><span class="sxs-lookup"><span data-stu-id="b8099-180">**Q:** What is the easiest way to access sessions?</span></span>

<span data-ttu-id="b8099-181">**R :** Définissez la saisie semi-automatique =`true` sur l’opération qui correspond au dernier message de la session, puis définissez la saisie semi-automatique =`false` sur toutes les opérations de service restantes.</span><span class="sxs-lookup"><span data-stu-id="b8099-181">**A:** Set AutoComplete=`true` on the operation that corresponds to the last message in the session, and set AutoComplete=`false` on all remaining service operations.</span></span>

<span data-ttu-id="b8099-182">**Q :** Pourquoi mon service lève-t-il une `ProtocolException` lors de la lecture d’une file d’attente contenant à la fois des messages de session en file d’attente et des messages de datagramme en file d’attente ?</span><span class="sxs-lookup"><span data-stu-id="b8099-182">**Q:** Why does my service throw a `ProtocolException` when reading from a queue that contains both queued session messages and queued datagram messages?</span></span>

<span data-ttu-id="b8099-183">**R :** Il existe une différence fondamentale dans la façon dont les messages de session en file d’attente et les messages de datagramme en file d’attente sont composés.</span><span class="sxs-lookup"><span data-stu-id="b8099-183">**A:** There is a fundamental difference in the way queued session messages and queued datagram messages are composed.</span></span> <span data-ttu-id="b8099-184">De ce fait, un service conçu pour lire un message de session en file d'attente ne peut pas recevoir de message de datagramme en file d'attente et un service conçu pour lire un message de datagramme en file d'attente ne peut pas recevoir de message de session.</span><span class="sxs-lookup"><span data-stu-id="b8099-184">Because of this, a service that is expecting to read a queued session message cannot receive a queued datagram message and a service expecting to read a queued datagram message cannot receive a session message.</span></span> <span data-ttu-id="b8099-185">La tentative de lire les deux types de messages à partir de la même file d'attente lève l'exception suivante :</span><span class="sxs-lookup"><span data-stu-id="b8099-185">Attempting to read both types of messages from the same queue throws the following exception:</span></span>

```console
System.ServiceModel.MsmqPoisonMessageException: The transport channel detected a poison message. This occurred because the message exceeded the maximum number of delivery attempts or because the channel detected a fundamental problem with the message. The inner exception may contain additional information.
---> System.ServiceModel.ProtocolException: An incoming MSMQ message contained invalid or unexpected .NET Message Framing information in its body. The message cannot be received. Ensure that the sender is using a compatible service contract with a matching SessionMode.
```

<span data-ttu-id="b8099-186">La file d'attente de lettres mortes du système, ainsi que toutes les files d'attente de lettres mortes personnalisées, sont particulièrement exposées à ce problème si une application envoie à la fois des messages de session en file d'attente et des messages de datagramme en file d'attente depuis le même ordinateur.</span><span class="sxs-lookup"><span data-stu-id="b8099-186">The system dead-letter queue, as well as any custom dead-letter queue, is particularly susceptible to this issue if an application sends both queued session messages and queued datagram messages from the same computer.</span></span> <span data-ttu-id="b8099-187">Si un message ne peut pas être envoyé avec succès, il est déplacé vers la file d'attente de lettres mortes.</span><span class="sxs-lookup"><span data-stu-id="b8099-187">If a message cannot be sent successfully, it is moved to the dead-letter queue.</span></span> <span data-ttu-id="b8099-188">Dans ces circonstances, il est possible d'avoir à la fois des messages de session et de datagramme dans la file d'attente de lettres mortes.</span><span class="sxs-lookup"><span data-stu-id="b8099-188">Under these circumstances, it is possible to have both session and datagram messages in the dead-letter queue.</span></span> <span data-ttu-id="b8099-189">Il n'existe aucun moyen de séparer les deux types de messages pendant l'exécution lors de la lecture à partir d'une file d'attente, par conséquent, les applications ne doivent pas envoyer à la fois des messages de session en file d'attente et des messages de datagramme en file d'attente depuis le même ordinateur.</span><span class="sxs-lookup"><span data-stu-id="b8099-189">There is no way to separate both types of messages at runtime when reading from a queue, therefore, applications should not send both queued session messages and queued datagram messages from the same computer.</span></span>

### <a name="msmq-integration-specific-troubleshooting"></a><span data-ttu-id="b8099-190">Intégration de MSMQ : Dépannage spécifique</span><span class="sxs-lookup"><span data-stu-id="b8099-190">MSMQ Integration: Specific Troubleshooting</span></span>

<span data-ttu-id="b8099-191">**Q :** Lorsque j’envoie un message, ou lorsque j’ouvre l’hôte de service, j’obtiens une erreur indiquant que le schéma est incorrect.</span><span class="sxs-lookup"><span data-stu-id="b8099-191">**Q:** When I send a message, or when I open the service host, I get an error that indicates the scheme is wrong.</span></span> <span data-ttu-id="b8099-192">Pourquoi ?</span><span class="sxs-lookup"><span data-stu-id="b8099-192">Why?</span></span>

<span data-ttu-id="b8099-193">**R :** Lorsque vous utilisez la liaison d’intégration MSMQ, vous devez utiliser le schéma msmq. formatname.</span><span class="sxs-lookup"><span data-stu-id="b8099-193">**A:** When you use the MSMQ integration binding, you must use the msmq.formatname scheme.</span></span> <span data-ttu-id="b8099-194">Par exemple, msmq.formatname:DIRECT=OS:. \private $ \OrdersQueue.</span><span class="sxs-lookup"><span data-stu-id="b8099-194">For example, msmq.formatname:DIRECT=OS:.\private$\OrdersQueue.</span></span> <span data-ttu-id="b8099-195">Mais lorsque vous spécifiez la file d'attente de lettres mortes personnalisée, vous devez utiliser le modèle net.msmq.</span><span class="sxs-lookup"><span data-stu-id="b8099-195">But when you specify the custom dead-letter queue, you must use the net.msmq scheme.</span></span>

<span data-ttu-id="b8099-196">**Q :** Lorsque j’utilise un nom de format public ou privé et que j’ouvre l’hôte de service sur Windows Vista, j’obtiens une erreur.</span><span class="sxs-lookup"><span data-stu-id="b8099-196">**Q:** When I use a public or private format name and open the service host on Windows Vista, I get an error.</span></span> <span data-ttu-id="b8099-197">Pourquoi ?</span><span class="sxs-lookup"><span data-stu-id="b8099-197">Why?</span></span>

<span data-ttu-id="b8099-198">**R :** Le canal d’intégration WCF sur Windows Vista vérifie si une sous-file d’attente peut être ouverte pour la file d’attente d’application principale pour la gestion des messages incohérents.</span><span class="sxs-lookup"><span data-stu-id="b8099-198">**A:** The WCF integration channel on Windows Vista checks to see if a subqueue can be opened for the main application queue for handling poison messages.</span></span> <span data-ttu-id="b8099-199">Le nom de la sous-file d’attente est dérivé d’un URI MSMQ. FormatName passé à l’écouteur.</span><span class="sxs-lookup"><span data-stu-id="b8099-199">The subqueue name is derived from an msmq.formatname URI passed to the listener.</span></span> <span data-ttu-id="b8099-200">Le nom de la sous-file d’attente dans MSMQ ne peut être qu’un nom de format direct.</span><span class="sxs-lookup"><span data-stu-id="b8099-200">The subqueue name in MSMQ can only be a direct format name.</span></span> <span data-ttu-id="b8099-201">Donc vous obtenez l'erreur.</span><span class="sxs-lookup"><span data-stu-id="b8099-201">So you see the error.</span></span> <span data-ttu-id="b8099-202">Remplacez l'URI de la file d'attente par un nom de format direct.</span><span class="sxs-lookup"><span data-stu-id="b8099-202">Change the queue URI to a direct format name.</span></span>

<span data-ttu-id="b8099-203">**Q :** Lors de la réception d’un message à partir d’une application MSMQ, le message se trouve dans la file d’attente et n’est pas lu par l’application WCF de réception.</span><span class="sxs-lookup"><span data-stu-id="b8099-203">**Q:** When receiving a message from an MSMQ application, the message sits in the queue and is not read by the receiving WCF application.</span></span> <span data-ttu-id="b8099-204">Pourquoi ?</span><span class="sxs-lookup"><span data-stu-id="b8099-204">Why?</span></span>

<span data-ttu-id="b8099-205">**R :** Vérifiez si le message a un corps.</span><span class="sxs-lookup"><span data-stu-id="b8099-205">**A:** Check to see whether the message has a body.</span></span> <span data-ttu-id="b8099-206">Si le message n'a aucun corps, le canal d'intégration MSMQ l'ignore.</span><span class="sxs-lookup"><span data-stu-id="b8099-206">If the message has no body, the MSMQ integration channel ignores the message.</span></span> <span data-ttu-id="b8099-207">Implémentez `IErrorHandler` pour être averti des exceptions et vérifiez les suivis.</span><span class="sxs-lookup"><span data-stu-id="b8099-207">Implement `IErrorHandler` to be notified of exceptions and check the traces.</span></span>

### <a name="security-related-troubleshooting"></a><span data-ttu-id="b8099-208">Résolution des problèmes liés à la sécurité</span><span class="sxs-lookup"><span data-stu-id="b8099-208">Security-Related Troubleshooting</span></span>

<span data-ttu-id="b8099-209">**Q :** Lorsque j’exécute l’exemple qui utilise une liaison par défaut en mode groupe de travail, les messages semblent être envoyés mais ne sont jamais reçus par le destinataire.</span><span class="sxs-lookup"><span data-stu-id="b8099-209">**Q:** When I run the sample that uses a default binding in workgroup mode, messages seem to get sent but are never received by the receiver.</span></span>

<span data-ttu-id="b8099-210">**R :** Par défaut, les messages sont signés à l’aide d’un certificat MSMQ interne qui requiert le service d’annuaire Active Directory.</span><span class="sxs-lookup"><span data-stu-id="b8099-210">**A:** By default, messages are signed using an MSMQ internal certificate that requires the Active Directory directory service.</span></span> <span data-ttu-id="b8099-211">En mode groupe de travail, parce qu'Active Directory n'est pas disponible, la signature des messages échoue.</span><span class="sxs-lookup"><span data-stu-id="b8099-211">In workgroup mode, because Active Directory is not available, signing the message fails.</span></span> <span data-ttu-id="b8099-212">Par conséquent, le message arrive dans la file d’attente de lettres mortes et la cause de l’échec, par exemple « signature incorrecte », est indiquée.</span><span class="sxs-lookup"><span data-stu-id="b8099-212">So the message lands in the dead-letter queue and failure cause, such as "Bad signature", is indicated.</span></span>

<span data-ttu-id="b8099-213">La solution à ce problème consiste à désactiver la sécurité.</span><span class="sxs-lookup"><span data-stu-id="b8099-213">The workaround is to turn off security.</span></span> <span data-ttu-id="b8099-214">Pour ce faire, définissez <xref:System.ServiceModel.NetMsmqSecurity.Mode%2A> = <xref:System.ServiceModel.NetMsmqSecurityMode.None> pour qu’il fonctionne en mode groupe de travail.</span><span class="sxs-lookup"><span data-stu-id="b8099-214">This is done by setting <xref:System.ServiceModel.NetMsmqSecurity.Mode%2A> = <xref:System.ServiceModel.NetMsmqSecurityMode.None> to make it work in workgroup mode.</span></span>

<span data-ttu-id="b8099-215">Une autre solution consiste à obtenir <xref:System.ServiceModel.MsmqTransportSecurity> de la propriété <xref:System.ServiceModel.NetMsmqSecurity.Transport%2A> et à lui affecter la valeur <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate>, puis à définir le certificat client.</span><span class="sxs-lookup"><span data-stu-id="b8099-215">Another workaround is to get the <xref:System.ServiceModel.MsmqTransportSecurity> from the <xref:System.ServiceModel.NetMsmqSecurity.Transport%2A> property and set it to <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate>, and set the client certificate.</span></span>

<span data-ttu-id="b8099-216">Une autre solution consiste à installer MSMQ avec l'intégration Active Directory.</span><span class="sxs-lookup"><span data-stu-id="b8099-216">Yet another workaround is to install MSMQ with Active Directory integration.</span></span>

<span data-ttu-id="b8099-217">**Q :** Lorsque j’envoie un message avec la liaison par défaut (sécurité de transport activée) dans Active Directory vers une file d’attente, j’obtiens un message « certificat interne introuvable ».</span><span class="sxs-lookup"><span data-stu-id="b8099-217">**Q:** When I send a message with default binding (transport security turned on) in Active Directory to a queue, I get an "internal certificate not found" message.</span></span> <span data-ttu-id="b8099-218">Comment la corriger ?</span><span class="sxs-lookup"><span data-stu-id="b8099-218">How do I fix this?</span></span>

<span data-ttu-id="b8099-219">**R :** Cela signifie que le certificat de Active Directory pour l’expéditeur doit être renouvelé.</span><span class="sxs-lookup"><span data-stu-id="b8099-219">**A:** This means that the certificate in Active Directory for the sender must be renewed.</span></span> <span data-ttu-id="b8099-220">Pour ce faire, ouvrez le **panneau de configuration**, **Outils d’administration**, gestion de l' **ordinateur**, cliquez avec le bouton droit sur **MSMQ**, puis sélectionnez **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="b8099-220">To do so, open **Control Panel**, **Administrative Tools**, **Computer Management**, right-click **MSMQ**, and select **Properties**.</span></span> <span data-ttu-id="b8099-221">Sélectionnez l’onglet **certificat utilisateur** , puis cliquez sur le bouton **renouveler** .</span><span class="sxs-lookup"><span data-stu-id="b8099-221">Select the **User Certificate** tab and click the **Renew** button.</span></span>

<span data-ttu-id="b8099-222">**Q :** Lorsque j’envoie un message à l’aide de <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate> et que vous spécifiez le certificat à utiliser, j’obtiens un message « certificat non valide ».</span><span class="sxs-lookup"><span data-stu-id="b8099-222">**Q:** When I send a message using <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate> and specify the certificate to use, I get an "Invalid certificate" message.</span></span> <span data-ttu-id="b8099-223">Comment la corriger ?</span><span class="sxs-lookup"><span data-stu-id="b8099-223">How do I fix this?</span></span>

<span data-ttu-id="b8099-224">**R :** Vous ne pouvez pas utiliser un magasin de certificats de l’ordinateur local avec le mode certificat.</span><span class="sxs-lookup"><span data-stu-id="b8099-224">**A:** You cannot use a local machine certificate store with certificate mode.</span></span> <span data-ttu-id="b8099-225">Vous devez copier le certificat du magasin de certificats de l'ordinateur vers le magasin de l'utilisateur actuel à l'aide du composant logiciel enfichable Certificat.</span><span class="sxs-lookup"><span data-stu-id="b8099-225">You have to copy the certificate from the machine certificate store to the current user store using the Certificate snap-in.</span></span> <span data-ttu-id="b8099-226">Pour obtenir le composant logiciel enfichable Certificat :</span><span class="sxs-lookup"><span data-stu-id="b8099-226">To get the Certificate snap-in:</span></span>

1. <span data-ttu-id="b8099-227">Cliquez sur **Démarrer**, sélectionnez **exécuter**, tapez `mmc`, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="b8099-227">Click **Start**, select **Run**, type `mmc`, and click **OK**.</span></span>

2. <span data-ttu-id="b8099-228">Dans **Microsoft Management Console**, ouvrez le menu **fichier** et sélectionnez **Ajouter/supprimer un composant logiciel enfichable**.</span><span class="sxs-lookup"><span data-stu-id="b8099-228">In the **Microsoft Management Console**, open the **File** menu and select **Add/Remove Snap-in**.</span></span>

3. <span data-ttu-id="b8099-229">Dans la boîte de dialogue **Ajouter/supprimer un composant logiciel enfichable** , cliquez sur le bouton **Ajouter** .</span><span class="sxs-lookup"><span data-stu-id="b8099-229">In the **Add/Remove Snap-in** dialog box, click the **Add** button.</span></span>

4. <span data-ttu-id="b8099-230">Dans la boîte de dialogue **Ajout d’un composant logiciel enfichable autonome** , sélectionnez certificats, puis cliquez sur **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="b8099-230">In the **Add Standalone Snap-in** dialog box, select Certificates and click **Add**.</span></span>

5. <span data-ttu-id="b8099-231">Dans la boîte de dialogue composant logiciel enfichable **certificats** , sélectionnez **mon compte d’utilisateur,** puis cliquez sur **Terminer**.</span><span class="sxs-lookup"><span data-stu-id="b8099-231">In the **Certificates** snap-in dialog box, select **My user account,** and click **Finish**.</span></span>

6. <span data-ttu-id="b8099-232">Ensuite, ajoutez un deuxième composant logiciel enfichable certificats à l’aide des étapes précédentes, mais cette fois, sélectionnez **compte d’ordinateur** , puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="b8099-232">Next, add a second Certificates snap-in using the previous steps, but this time select **Computer account** and click **Next**.</span></span>

7. <span data-ttu-id="b8099-233">Sélectionnez **Ordinateur local**, puis cliquez sur **Terminer**.</span><span class="sxs-lookup"><span data-stu-id="b8099-233">Select **Local Computer** and click **Finish**.</span></span> <span data-ttu-id="b8099-234">Vous pouvez à présent glisser et déposer des certificats depuis le magasin de certificats de l’ordinateur vers le magasin de l’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="b8099-234">You can now drag and drop certificates from the machine certificate store to the current user store.</span></span>

<span data-ttu-id="b8099-235">**Q :** Lorsque mon service lit à partir d’une file d’attente sur un autre ordinateur en mode groupe de travail, j’obtiens une exception « accès refusé ».</span><span class="sxs-lookup"><span data-stu-id="b8099-235">**Q:** When my service reads from a queue on another computer in workgroup mode, I get an "access denied" exception.</span></span>

<span data-ttu-id="b8099-236">**R :** En mode groupe de travail, pour qu’une application distante ait accès à la file d’attente, elle doit avoir l’autorisation d’accéder à la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="b8099-236">**A:** In workgroup mode, for a remote application to gain access to the queue, the application must have permission to access the queue.</span></span> <span data-ttu-id="b8099-237">Ajoutez « connexion anonyme » à la liste de contrôle d’accès (ACL) de la file d’attente et accordez-lui l’autorisation lecture.</span><span class="sxs-lookup"><span data-stu-id="b8099-237">Add "Anonymous login" to the queue's access control list (ACL) and give it read permission.</span></span>

<span data-ttu-id="b8099-238">**Q :** Lorsqu’un client de service réseau (ou un client qui n’a pas de compte de domaine) envoie un message mis en file d’attente, l’envoi échoue avec un certificat non valide.</span><span class="sxs-lookup"><span data-stu-id="b8099-238">**Q:** When a network service client (or any client that does not have a domain account) sends a queued message, the send fails with an invalid certificate.</span></span> <span data-ttu-id="b8099-239">Comment la corriger ?</span><span class="sxs-lookup"><span data-stu-id="b8099-239">How do I fix this?</span></span>

<span data-ttu-id="b8099-240">**R :** Vérifiez la configuration de la liaison.</span><span class="sxs-lookup"><span data-stu-id="b8099-240">**A:** Check the binding configuration.</span></span> <span data-ttu-id="b8099-241">Pour la liaison par défaut, la sécurité de transport MSMQ est activée afin de signer le message.</span><span class="sxs-lookup"><span data-stu-id="b8099-241">The default binding has MSMQ transport security turned on to sign the message.</span></span> <span data-ttu-id="b8099-242">Désactivez-la.</span><span class="sxs-lookup"><span data-stu-id="b8099-242">Turn it off.</span></span>

### <a name="remote-transacted-receives"></a><span data-ttu-id="b8099-243">Réceptions avec transactions distantes</span><span class="sxs-lookup"><span data-stu-id="b8099-243">Remote Transacted Receives</span></span>

<span data-ttu-id="b8099-244">**Q :** Lorsque j’ai une file d’attente sur l’ordinateur A et un service WCF qui lit les messages d’une file d’attente sur l’ordinateur B (scénario de réception avec transaction distante), les messages ne sont pas lus à partir de la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="b8099-244">**Q:** When I have a queue on machine A, and a WCF service that reads messages from a queue on machine B (the remote transacted receive scenario), messages are not read from the queue.</span></span> <span data-ttu-id="b8099-245">Les informations de traçage indiquent que la réception a échoué avec le message « Impossible d’importer la transaction ».</span><span class="sxs-lookup"><span data-stu-id="b8099-245">Tracing information indicates the receive failed with the message "Transaction cannot be imported."</span></span> <span data-ttu-id="b8099-246">Que puis-je faire pour résoudre ce problème ?</span><span class="sxs-lookup"><span data-stu-id="b8099-246">What can I do to fix this?</span></span>

<span data-ttu-id="b8099-247">**R :** Il existe trois raisons possibles :</span><span class="sxs-lookup"><span data-stu-id="b8099-247">**A:** There are three possible reasons for this:</span></span>

- <span data-ttu-id="b8099-248">Si vous êtes en mode domaine, la réception avec transaction distante requiert l'accès réseau MSDTC (Microsoft Distributed Transaction Coordinator).</span><span class="sxs-lookup"><span data-stu-id="b8099-248">If you are in domain mode, remote transacted receive requires Microsoft Distributed Transaction Coordinator (MSDTC) network access.</span></span> <span data-ttu-id="b8099-249">Vous pouvez l’activer à l’aide de l' **Ajout/suppression de composants**.</span><span class="sxs-lookup"><span data-stu-id="b8099-249">You can enable this using **Add/Remove Components**.</span></span>

  ![Capture d’écran montrant l’activation de l’accès DTC réseau.](./media/troubleshooting-queued-messaging/enable-distributed-transaction-coordinator-access.jpg)

- <span data-ttu-id="b8099-251">Vérifiez le mode d’authentification pour communiquer avec le gestionnaire de transactions.</span><span class="sxs-lookup"><span data-stu-id="b8099-251">Check the authentication mode for communicating with the transaction manager.</span></span> <span data-ttu-id="b8099-252">Si vous êtes en mode groupe de travail, vous devez sélectionner « aucune authentification requise ».</span><span class="sxs-lookup"><span data-stu-id="b8099-252">If you are in workgroup mode, "No Authentication Required" must be selected.</span></span> <span data-ttu-id="b8099-253">Si vous êtes en mode de domaine, vous devez sélectionner « authentification mutuelle requise ».</span><span class="sxs-lookup"><span data-stu-id="b8099-253">If you are in domain mode, then "Mutual Authentication Required" must be selected.</span></span>

  <span data-ttu-id="b8099-254">![Activation des transactions XA](../../../../docs/framework/wcf/feature-details/media/4f3695e0-fb0b-4c5b-afac-75f8860d2bb0.jpg "4f3695e0-fb0b-4c5b-afac-75f8860d2bb0")</span><span class="sxs-lookup"><span data-stu-id="b8099-254">![Enabling XA transactions](../../../../docs/framework/wcf/feature-details/media/4f3695e0-fb0b-4c5b-afac-75f8860d2bb0.jpg "4f3695e0-fb0b-4c5b-afac-75f8860d2bb0")</span></span>

- <span data-ttu-id="b8099-255">Assurez-vous que MSDTC figure dans la liste des exceptions dans les paramètres du **pare-feu de connexion Internet** .</span><span class="sxs-lookup"><span data-stu-id="b8099-255">Make sure that MSDTC is in the list of exceptions in the **Internet Connection Firewall** settings.</span></span>

- <span data-ttu-id="b8099-256">Vérifiez que vous utilisez Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="b8099-256">Ensure that you are using Windows Vista.</span></span> <span data-ttu-id="b8099-257">MSMQ sur Windows Vista prend en charge la lecture transactionnelle à distance.</span><span class="sxs-lookup"><span data-stu-id="b8099-257">MSMQ on Windows Vista supports remote transacted read.</span></span> <span data-ttu-id="b8099-258">MSMQ sur les mises en production antérieures de Windows ne prend pas en charge la lecture avec transaction distante.</span><span class="sxs-lookup"><span data-stu-id="b8099-258">MSMQ on earlier Windows releases does not support remote transacted read.</span></span>

<span data-ttu-id="b8099-259">**Q :** Lorsque le service lisant à partir de la file d’attente est un service réseau, par exemple, dans un hôte Web, pourquoi est-ce que j’obtiens une exception d’accès refusé est déclenchée lors de la lecture à partir de la file d’attente ?</span><span class="sxs-lookup"><span data-stu-id="b8099-259">**Q:** When the service reading from the queue is a network service, for example, in a Web host, why do I get an access-denied exception is raised when reading from the queue?</span></span>

<span data-ttu-id="b8099-260">**R :** L’accès en lecture au service réseau doit être ajouté à la liste de contrôle d’accès de file d’attente pour garantir qu’un service réseau peut lire à partir de la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="b8099-260">**A:** Network service read access must be added to the queue ACL to ensure that a network service can read from the queue.</span></span>

<span data-ttu-id="b8099-261">**Q :** Puis-je utiliser le service d’activation MSMQ pour activer des applications basées sur des messages dans une file d’attente sur un ordinateur distant ?</span><span class="sxs-lookup"><span data-stu-id="b8099-261">**Q:** Can I use the MSMQ activation service to activate applications based on messages in a queue on a remote machine?</span></span>

<span data-ttu-id="b8099-262">**R :** Oui.</span><span class="sxs-lookup"><span data-stu-id="b8099-262">**A:** Yes.</span></span> <span data-ttu-id="b8099-263">Pour cela, vous devez configurer le service d'activation MSMQ afin qu'il s'exécute comme un service réseau, puis ajouter l'accès au service réseau à la file d'attente sur l'ordinateur distant.</span><span class="sxs-lookup"><span data-stu-id="b8099-263">To do this, you must configure the MSMQ activation service to run as a network service, and add network service access to the queue on the remote machine.</span></span>

## <a name="using-custom-msmq-bindings-with-receivecontext-enabled"></a><span data-ttu-id="b8099-264">Utilisation de liaisons MSMQ personnalisées avec ReceiveContext activé</span><span class="sxs-lookup"><span data-stu-id="b8099-264">Using Custom MSMQ Bindings with ReceiveContext Enabled</span></span>

<span data-ttu-id="b8099-265">Lors de l’utilisation d’une liaison MSMQ personnalisée avec <xref:System.ServiceModel.Channels.ReceiveContext> activé, le traitement d’un message entrant utilise un thread de pool de threads, car le MSMQ natif ne prend pas en charge l’achèvement d’e/s pour les réceptions <xref:System.ServiceModel.Channels.ReceiveContext> asynchrones.</span><span class="sxs-lookup"><span data-stu-id="b8099-265">When using a custom MSMQ binding with <xref:System.ServiceModel.Channels.ReceiveContext> enabled, processing an incoming message uses a thread pool thread because native MSMQ doesn't support I/O completion for asynchronous <xref:System.ServiceModel.Channels.ReceiveContext> receives.</span></span> <span data-ttu-id="b8099-266">Cela est dû au fait que le traitement d’un tel message utilise des transactions internes pour <xref:System.ServiceModel.Channels.ReceiveContext> et que MSMQ ne prend pas en charge le traitement asynchrone.</span><span class="sxs-lookup"><span data-stu-id="b8099-266">This is because processing such a message uses internal transactions for <xref:System.ServiceModel.Channels.ReceiveContext> and MSMQ doesn't support asynchronous processing.</span></span> <span data-ttu-id="b8099-267">Pour contourner ce problème, vous pouvez ajouter un <xref:System.ServiceModel.Description.SynchronousReceiveBehavior> au point de terminaison pour forcer le traitement synchrone ou affecter la valeur 1 à <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.MaxPendingReceives%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8099-267">To work around this issue, you can add a <xref:System.ServiceModel.Description.SynchronousReceiveBehavior> to the endpoint to force synchronous processing or set <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.MaxPendingReceives%2A> to 1.</span></span>

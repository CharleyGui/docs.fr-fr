---
title: Sécurisation des messages à l'aide de la sécurité de message
ms.date: 03/30/2017
ms.assetid: a17ebe67-836b-4c52-9a81-2c3d58e225ee
ms.openlocfilehash: 9ba8923d23140bb951a4993739ec267ad6f6a4c4
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/22/2019
ms.locfileid: "69911776"
---
# <a name="securing-messages-using-message-security"></a><span data-ttu-id="c6d5a-102">Sécurisation des messages à l'aide de la sécurité de message</span><span class="sxs-lookup"><span data-stu-id="c6d5a-102">Securing Messages Using Message Security</span></span>
<span data-ttu-id="c6d5a-103">Cette section traite de la sécurité des messages WCF <xref:System.ServiceModel.NetMsmqBinding>lors de l’utilisation de.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-103">This section discusses WCF message security when using <xref:System.ServiceModel.NetMsmqBinding>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="c6d5a-104">Avant de lire cette rubrique, il est recommandé de lire [concepts de sécurité](../../../../docs/framework/wcf/feature-details/security-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="c6d5a-104">Before reading through this topic, it is recommended that you read [Security Concepts](../../../../docs/framework/wcf/feature-details/security-concepts.md).</span></span>  
  
 <span data-ttu-id="c6d5a-105">L’illustration suivante fournit un modèle conceptuel de communication en file d’attente à l’aide de WCF.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-105">The following illustration provides a conceptual model of queued communication using WCF.</span></span> <span data-ttu-id="c6d5a-106">Cette illustration et la terminologie permettent d'expliquer</span><span class="sxs-lookup"><span data-stu-id="c6d5a-106">This illustration and terminology are used to explain</span></span>  
  
 <span data-ttu-id="c6d5a-107">les concepts de sécurité de transport.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-107">transport security concepts.</span></span>  
  
 <span data-ttu-id="c6d5a-108">![Diagramme d’application en file d’attente](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "File d’attente distribuée-figure")</span><span class="sxs-lookup"><span data-stu-id="c6d5a-108">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="c6d5a-109">Lors de l’envoi de messages en file d’attente à l’aide de WCF, le message WCF est joint en tant que corps du message de Message Queuing (MSMQ).</span><span class="sxs-lookup"><span data-stu-id="c6d5a-109">When sending queued messages using WCF, the WCF message is attached as a body of the Message Queuing (MSMQ) message.</span></span> <span data-ttu-id="c6d5a-110">Alors que la sécurité de transport sécurise le message MSMQ entier, la sécurité de message (ou SOAP) sécurise uniquement le corps du message MSMQ.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-110">While transport security secures the entire MSMQ message, message (or SOAP) security only secures the body of the MSMQ message.</span></span>  
  
 <span data-ttu-id="c6d5a-111">Le concept clé de la sécurité de message est que le client sécurise le message pour l'application réceptrice (service), contrairement à la sécurité de transport où le client sécurise le message pour la file d'attente cible.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-111">The key concept of message security is that the client secures the message for the receiving application (service), unlike transport security where the client secures the message for the Target Queue.</span></span> <span data-ttu-id="c6d5a-112">Par conséquent, MSMQ ne joue aucun rôle lors de la sécurisation du message WCF à l’aide de la sécurité de message.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-112">As such, MSMQ plays no part when securing the WCF message using message security.</span></span>  
  
 <span data-ttu-id="c6d5a-113">La sécurité des messages WCF ajoute des en-têtes de sécurité au message WCF qui s’intègrent avec les infrastructures de sécurité existantes, telles qu’un certificat ou le protocole Kerberos.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-113">WCF message security adds security headers to the WCF message that integrate with existing security infrastructures, such as a certificate or the Kerberos protocol.</span></span>  
  
## <a name="message-credential-type"></a><span data-ttu-id="c6d5a-114">Type d'informations d'identification de message</span><span class="sxs-lookup"><span data-stu-id="c6d5a-114">Message Credential Type</span></span>  
 <span data-ttu-id="c6d5a-115">Grâce à la sécurité de message, le service et le client peuvent présenter des informations d'identification pour s'authentifier mutuellement.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-115">Using message security, the service and client can present credentials to authenticate each another.</span></span> <span data-ttu-id="c6d5a-116">Vous pouvez sélectionner la sécurité de message en définissant le mode <xref:System.ServiceModel.NetMsmqBinding.Security%2A> sur `Message` ou sur `Both` (c'est-à-dire en utilisant la sécurité de transport et la sécurité de message).</span><span class="sxs-lookup"><span data-stu-id="c6d5a-116">You can select message security by setting the <xref:System.ServiceModel.NetMsmqBinding.Security%2A> mode to `Message` or `Both` (that is, use both transport security and message security).</span></span>  
  
 <span data-ttu-id="c6d5a-117">Le service peut utiliser la propriété <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> pour inspecter les informations d'identification permettant d'authentifier le client.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-117">The service can use the <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> property to inspect the credential used to authenticate the client.</span></span> <span data-ttu-id="c6d5a-118">Elle peut également être utilisée pour des vérifications d'autorisation supplémentaires que le service choisit d'implémenter.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-118">This can also be used for further authorization checks that the service chooses to implement.</span></span>  
  
 <span data-ttu-id="c6d5a-119">Cette section présente les différents types d'informations d'identification et explique comment les utiliser avec les files d'attente.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-119">This section explains the different credential types and how to use them with queues.</span></span>  
  
### <a name="certificate"></a><span data-ttu-id="c6d5a-120">Certificat</span><span class="sxs-lookup"><span data-stu-id="c6d5a-120">Certificate</span></span>  
 <span data-ttu-id="c6d5a-121">Le type d'informations d'identification de certificat utilise un certificat X.509 pour identifier le service et le client.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-121">The certificate credential type uses an X.509 certificate to identify the service and the client.</span></span>  
  
 <span data-ttu-id="c6d5a-122">Dans un scénario classique, un certificat valide est émis pour le client et le service par une autorité de certification de confiance.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-122">In a typical scenario, the client and the service are issued a valid certificate by a trusted certification authority.</span></span> <span data-ttu-id="c6d5a-123">Lorsque la connexion est établie, le client authentifie la validité du service à l'aide du certificat du service pour décider s'il peut faire confiance au service.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-123">Then the connection is established, the client authenticates the validity of the service using the service's certificate to decide whether it can trust the service.</span></span> <span data-ttu-id="c6d5a-124">De la même façon, le service utilise le certificat du client pour valider l'approbation du client.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-124">Similarly, the service uses the client's certificate to validate the client trust.</span></span>  
  
 <span data-ttu-id="c6d5a-125">Étant donné la nature déconnectée des files d'attente, le client et le service peuvent ne pas être en ligne au même moment.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-125">Given the disconnected nature of queues, the client and the service may not be online at the same time.</span></span> <span data-ttu-id="c6d5a-126">Par conséquent, le client et le service doivent échanger des certificats hors bande.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-126">As such, the client and service have to exchange certificates out-of-band.</span></span> <span data-ttu-id="c6d5a-127">En particulier, le client, du fait qu'il détient le certificat du service (lequel peut être chaîné à une autorité de certification) dans son magasin approuvé, doit croire qu'il communique avec le service correct.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-127">In particular, the client, by virtue of holding the service's certificate (which can be chained to a certification authority) in its trusted store, must trust that it is communicating with the correct service.</span></span> <span data-ttu-id="c6d5a-128">Pour authentifier le client, le service utilise le certificat X.509 joint au message pour le mettre en correspondance avec le certificat dans son magasin afin de vérifier l'authenticité du client.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-128">For authenticating the client, the service uses the X.509 certificate attached with the message to matches it with the certificate in its store to verify the authenticity of the client.</span></span> <span data-ttu-id="c6d5a-129">De nouveau, le certificat doit être chaîné à une autorité de certification.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-129">Again, the certificate must be chained to a certification authority.</span></span>  
  
 <span data-ttu-id="c6d5a-130">Sur un ordinateur exécutant Windows, les certificats sont conservés dans plusieurs types de magasins.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-130">On a computer running Windows, certificates are held in several kinds of stores.</span></span> <span data-ttu-id="c6d5a-131">Pour plus d’informations sur les différents magasins, consultez [magasins de certificats](https://go.microsoft.com/fwlink/?LinkId=87787).</span><span class="sxs-lookup"><span data-stu-id="c6d5a-131">For more information about the different stores, see [Certificate stores](https://go.microsoft.com/fwlink/?LinkId=87787).</span></span>  
  
### <a name="windows"></a><span data-ttu-id="c6d5a-132">Windows</span><span class="sxs-lookup"><span data-stu-id="c6d5a-132">Windows</span></span>  
 <span data-ttu-id="c6d5a-133">Le type d'informations d'identification de message Windows utilise le protocole Kerberos.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-133">Windows message credential type uses the Kerberos protocol.</span></span>  
  
 <span data-ttu-id="c6d5a-134">Le protocole Kerberos est un mécanisme de sécurité qui authentifie les utilisateurs sur un domaine et permet aux utilisateurs authentifiés d'établir des contextes sécurisés avec d'autres entités sur un domaine.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-134">The Kerberos protocol is a security mechanism that authenticates users on a domain and allows the authenticated users to establish secure contexts with other entities on a domain.</span></span>  
  
 <span data-ttu-id="c6d5a-135">Le problème lié à l'utilisation du protocole Kerberos pour la communication mise en file d'attente est que les tickets qui contiennent l'identité du client que le centre de distribution de clés distribue sont relativement éphémères.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-135">The problem with using the Kerberos protocol for queued communication is that the tickets that contain client identity that the Key Distribution Center (KDC) distributes are relatively short-lived.</span></span> <span data-ttu-id="c6d5a-136">Une *durée de vie* est associée au ticket Kerberos qui indique la validité du ticket.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-136">A *lifetime* is associated with the Kerberos ticket that indicates the validity of the ticket.</span></span> <span data-ttu-id="c6d5a-137">Ainsi, étant donné la latence élevée, vous ne pouvez pas être sûr que le jeton est encore valide pour le service qui authentifie le client.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-137">As such, given high latency, you cannot be sure that the token is still valid for the service that authenticates the client.</span></span>  
  
 <span data-ttu-id="c6d5a-138">Notez que lors de l'utilisation de ce type d'informations d'identification, le service doit s'exécuter sous le compte SERVICE.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-138">Note that when using this credential type, the service must be running under the SERVICE account.</span></span>  
  
 <span data-ttu-id="c6d5a-139">Le protocole Kerberos est utilisé par défaut lors du choix des informations d'identification d'un message.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-139">The Kerberos protocol is used by default when choosing message credential.</span></span> <span data-ttu-id="c6d5a-140">Pour plus d’informations, consultez [exploration de Kerberos, protocole pour la sécurité distribuée dans Windows 2000](https://go.microsoft.com/fwlink/?LinkId=87790).</span><span class="sxs-lookup"><span data-stu-id="c6d5a-140">For more information, see [Exploring Kerberos, the Protocol for Distributed Security in Windows 2000](https://go.microsoft.com/fwlink/?LinkId=87790).</span></span>  
  
### <a name="username-password"></a><span data-ttu-id="c6d5a-141">Username Password</span><span class="sxs-lookup"><span data-stu-id="c6d5a-141">Username Password</span></span>  
 <span data-ttu-id="c6d5a-142">À l'aide de cette propriété, le client peut s'authentifier auprès du serveur en utilisant un mot de passe de nom d'utilisateur dans l'en-tête de sécurité du message.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-142">Using this property, the client can authenticate to the server using a username password in the security header of the message.</span></span>  
  
### <a name="issuedtoken"></a><span data-ttu-id="c6d5a-143">IssuedToken</span><span class="sxs-lookup"><span data-stu-id="c6d5a-143">IssuedToken</span></span>  
 <span data-ttu-id="c6d5a-144">Le client peut utiliser le service de jeton de sécurité pour émettre un jeton qui peut ensuite être joint au message pour que le service authentifie le client.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-144">The client can use the security token service to issue a token that can then be attached to the message for the service to authenticate the client.</span></span>  
  
## <a name="using-transport-and-message-security"></a><span data-ttu-id="c6d5a-145">Utilisation de la sécurité de transport et de message</span><span class="sxs-lookup"><span data-stu-id="c6d5a-145">Using Transport and Message Security</span></span>  
 <span data-ttu-id="c6d5a-146">Lorsque vous utilisez à la fois la sécurité de transport et la sécurité de message, le certificat utilisé pour sécuriser le message au niveau du transport et du message SOAP doit être le même.</span><span class="sxs-lookup"><span data-stu-id="c6d5a-146">When using both transport security and message security, the certificate used to secure the message both at the transport and the SOAP message level must be the same.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c6d5a-147">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="c6d5a-147">See also</span></span>

- [<span data-ttu-id="c6d5a-148">Sécurisation des messages à l’aide de la sécurité de transport</span><span class="sxs-lookup"><span data-stu-id="c6d5a-148">Securing Messages Using Transport Security</span></span>](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)
- [<span data-ttu-id="c6d5a-149">Sécurité du message sur Message Queuing</span><span class="sxs-lookup"><span data-stu-id="c6d5a-149">Message Security over Message Queuing</span></span>](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)
- [<span data-ttu-id="c6d5a-150">Concepts relatifs à la sécurité</span><span class="sxs-lookup"><span data-stu-id="c6d5a-150">Security Concepts</span></span>](../../../../docs/framework/wcf/feature-details/security-concepts.md)
- [<span data-ttu-id="c6d5a-151">Sécurisation des services et des clients</span><span class="sxs-lookup"><span data-stu-id="c6d5a-151">Securing Services and Clients</span></span>](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)

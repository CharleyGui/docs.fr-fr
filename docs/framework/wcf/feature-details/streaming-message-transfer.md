---
title: Transfert des messages par diffusion en continu
ms.date: 03/30/2017
ms.assetid: 72a47a51-e5e7-4b76-b24a-299d51e0ae5a
ms.openlocfilehash: 4b90e5bf15f5cb1c4684a3ba224371f6cc232034
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/26/2020
ms.locfileid: "96246327"
---
# <a name="streaming-message-transfer"></a><span data-ttu-id="80821-102">Transfert des messages par diffusion en continu</span><span class="sxs-lookup"><span data-stu-id="80821-102">Streaming Message Transfer</span></span>

<span data-ttu-id="80821-103">Les transports Windows Communication Foundation (WCF) prennent en charge deux modes de transfert des messages :</span><span class="sxs-lookup"><span data-stu-id="80821-103">Windows Communication Foundation (WCF) transports support two modes for transferring messages:</span></span>  
  
- <span data-ttu-id="80821-104">Les transferts mis en mémoire tampon conservent la totalité des messages en mémoire tampon tant que leur transfert n'est pas terminé.</span><span class="sxs-lookup"><span data-stu-id="80821-104">Buffered transfers hold the entire message in a memory buffer until the transfer is complete.</span></span> <span data-ttu-id="80821-105">Un message mis en mémoire tampon doit être entièrement remis pour que son destinataire puisse le lire.</span><span class="sxs-lookup"><span data-stu-id="80821-105">A buffered message must be completely delivered before a receiver can read it.</span></span>  
  
- <span data-ttu-id="80821-106">Les transferts en flux continu exposent les messages sous forme de flux.</span><span class="sxs-lookup"><span data-stu-id="80821-106">Streamed transfers expose the message as a stream.</span></span> <span data-ttu-id="80821-107">Le destinataire commence à traiter les messages avant que ceux-ci ne soient complètement remis.</span><span class="sxs-lookup"><span data-stu-id="80821-107">The receiver starts processing the message before it is completely delivered.</span></span>  
  
- <span data-ttu-id="80821-108">Les transferts en flux continu permettent d'améliorer l'évolutivité d'un service car ils évitent d'avoir à recourir à de grandes mémoires tampon.</span><span class="sxs-lookup"><span data-stu-id="80821-108">Streamed transfers can improve the scalability of a service by eliminating the requirement for large memory buffers.</span></span> <span data-ttu-id="80821-109">Utilisez ce mode de transfert pour améliorer l'évolutivité en fonction de la taille des messages à transférer.</span><span class="sxs-lookup"><span data-stu-id="80821-109">Whether changing the transfer mode improves scalability depends on the size of the messages being transferred.</span></span> <span data-ttu-id="80821-110">Préférez le transfert en flux continu pour les messages de grande taille.</span><span class="sxs-lookup"><span data-stu-id="80821-110">Large message sizes favor using streamed transfers.</span></span>  
  
 <span data-ttu-id="80821-111">Par défaut, les transports HTTP, TCP/IP et les transports de canal nommé utilisent les transferts mis en mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="80821-111">By default, the HTTP, TCP/IP, and named pipe transports use buffered transfers.</span></span> <span data-ttu-id="80821-112">Cette rubrique contient des instructions permettant de faire basculer ces transports d'un mode de transfert mis en mémoire tampon à un mode de transfert en flux continu et présente les conséquences d'une telle modification.</span><span class="sxs-lookup"><span data-stu-id="80821-112">This document describes how to switch these transports from a buffered to streamed transfer mode and the consequences of doing so.</span></span>  
  
## <a name="enabling-streamed-transfers"></a><span data-ttu-id="80821-113">Activation des transferts avec diffusion en continu</span><span class="sxs-lookup"><span data-stu-id="80821-113">Enabling Streamed Transfers</span></span>  

 <span data-ttu-id="80821-114">L’activation de l’un ou l’autre de ces modes s’effectue au niveau de l’élément de liaison du transport.</span><span class="sxs-lookup"><span data-stu-id="80821-114">Selecting between buffered and streamed transfer modes is done on the binding element of the transport.</span></span> <span data-ttu-id="80821-115">La propriété <xref:System.ServiceModel.TransferMode> de l'élément de liaison peut avoir la valeur `Buffered`, `Streamed`, `StreamedRequest` ou `StreamedResponse`.</span><span class="sxs-lookup"><span data-stu-id="80821-115">The binding element has a <xref:System.ServiceModel.TransferMode> property that can be set to `Buffered`, `Streamed`, `StreamedRequest`, or `StreamedResponse`.</span></span> <span data-ttu-id="80821-116">L'affectation de `Streamed` au mode de transfert permet d'assurer la communication en mode de diffusion en continu dans les deux sens.</span><span class="sxs-lookup"><span data-stu-id="80821-116">Setting the transfer mode to `Streamed` enables streaming communication in both directions.</span></span> <span data-ttu-id="80821-117">L'affectation au mode de transfert de la valeur `StreamedRequest` ou `StreamedResponse` permet d'assurer des communications en flux continu dans le sens spécifié uniquement.</span><span class="sxs-lookup"><span data-stu-id="80821-117">Setting the transfer mode to `StreamedRequest` or `StreamedResponse` enables streaming communication in the indicated direction only.</span></span>  
  
 <span data-ttu-id="80821-118">Les liaisons <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.NetTcpBinding> et <xref:System.ServiceModel.NetNamedPipeBinding> exposent la propriété <xref:System.ServiceModel.TransferMode>.</span><span class="sxs-lookup"><span data-stu-id="80821-118">The <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.NetTcpBinding>, and <xref:System.ServiceModel.NetNamedPipeBinding> bindings expose the <xref:System.ServiceModel.TransferMode> property.</span></span> <span data-ttu-id="80821-119">Pour les autres transports, vous devez créer une liaison personnalisée pour pouvoir définir le mode de transfert.</span><span class="sxs-lookup"><span data-stu-id="80821-119">For other transports, you must create a custom binding to set the transfer mode.</span></span>  
  
 <span data-ttu-id="80821-120">La décision d'utiliser des transferts mis en mémoire tampon ou diffusés en continu est une décision locale du point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="80821-120">The decision to use either buffered or streamed transfers is a local decision of the endpoint.</span></span> <span data-ttu-id="80821-121">Pour les transports HTTP, le mode de transfert n'est pas propagé à la totalité de la connexion ni aux serveurs ni autres intermédiaires.</span><span class="sxs-lookup"><span data-stu-id="80821-121">For HTTP transports, the transfer mode does not propagate across a connection, or to servers and other intermediaries.</span></span> <span data-ttu-id="80821-122">La description de l'interface de service ne reflète pas le mode de transfert défini.</span><span class="sxs-lookup"><span data-stu-id="80821-122">Setting the transfer mode is not reflected in the description of the service interface.</span></span> <span data-ttu-id="80821-123">Après création d'une classe client pour le service, vous devez modifier son fichier de configuration pour pouvoir passer du mode de transfert en flux continu au mode de transfert mis en mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="80821-123">After generating a client class for a service, you must edit the configuration file for services intended to be used with streamed transfers to set the mode.</span></span> <span data-ttu-id="80821-124">Pour les transports TCP et les transports de canal nommé, le mode de transfert est propagé sous forme d'assertion de stratégie.</span><span class="sxs-lookup"><span data-stu-id="80821-124">For TCP and named pipe transports, the transfer mode is propagated as a policy assertion.</span></span>  
  
 <span data-ttu-id="80821-125">Pour obtenir des exemples de code, consultez [Comment : activer la diffusion en continu](how-to-enable-streaming.md).</span><span class="sxs-lookup"><span data-stu-id="80821-125">For code samples, see [How to: Enable Streaming](how-to-enable-streaming.md).</span></span>  
  
## <a name="enabling-asynchronous-streaming"></a><span data-ttu-id="80821-126">Activation de la diffusion en continu asynchrone</span><span class="sxs-lookup"><span data-stu-id="80821-126">Enabling Asynchronous Streaming</span></span>  

 <span data-ttu-id="80821-127">Pour activer la diffusion en continu asynchrone, ajoutez le comportement de point de terminaison <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior> à l'hôte de service et affectez à sa propriété <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.AsynchronousSendEnabled%2A> la valeur `true`.</span><span class="sxs-lookup"><span data-stu-id="80821-127">To enable asynchronous streaming, add the  <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior> endpoint behavior to the service host and set its <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.AsynchronousSendEnabled%2A> property to `true`.</span></span>  
  
 <span data-ttu-id="80821-128">Cette version de WCF ajoute aussi la diffusion en continu asynchrone du côté expéditeur.</span><span class="sxs-lookup"><span data-stu-id="80821-128">This version of WCF also adde the capability of true asynchronous streaming on the send side.</span></span> <span data-ttu-id="80821-129">Cela améliore l'extensibilité du service dans les scénarios où des messages sont diffusés en continu à plusieurs clients, dont certains sont lents dans la lecture ; probablement en raison de la congestion du réseau ou ne lisent pas du tout.</span><span class="sxs-lookup"><span data-stu-id="80821-129">This improves scalability of the service in scenarios where it is streaming messages to multiple clients some of which are slow in reading; possibly due to network congestion or are not reading at all.</span></span> <span data-ttu-id="80821-130">Dans ces scénarios, WCF ne bloque plus les threads individuels sur le service par client.</span><span class="sxs-lookup"><span data-stu-id="80821-130">In these scenarios WCF no longer blocks individual threads on the service per client.</span></span> <span data-ttu-id="80821-131">Cela garantit que le service peut gérer beaucoup plus de clients fournissant ainsi l'extensibilité du service.</span><span class="sxs-lookup"><span data-stu-id="80821-131">This ensures that the service is able to process many more clients thereby improving the scalability of the service.</span></span>  
  
## <a name="restrictions-on-streamed-transfers"></a><span data-ttu-id="80821-132">Restrictions relatives aux transferts en flux continu</span><span class="sxs-lookup"><span data-stu-id="80821-132">Restrictions on Streamed Transfers</span></span>  

 <span data-ttu-id="80821-133">L'utilisation du mode de transfert en flux continu provoque l'application de restrictions supplémentaires de la part de l'exécution.</span><span class="sxs-lookup"><span data-stu-id="80821-133">Using the streamed transfer mode causes the run time to enforce additional restrictions.</span></span>  
  
 <span data-ttu-id="80821-134">Le contrat des opérations intervenant sur un transport en flux continu peut contenir au maximum un paramètre d'entrée ou de sortie.</span><span class="sxs-lookup"><span data-stu-id="80821-134">Operations that occur across a streamed transport can have a contract with at most one input or output parameter.</span></span> <span data-ttu-id="80821-135">Ce paramètre incarne l'intégralité du corps des messages et doit être un <xref:System.ServiceModel.Channels.Message>, un type dérivé de <xref:System.IO.Stream> ou une implémentation de <xref:System.Xml.Serialization.IXmlSerializable>.</span><span class="sxs-lookup"><span data-stu-id="80821-135">That parameter corresponds to the entire body of the message and must be a <xref:System.ServiceModel.Channels.Message>, a derived type of <xref:System.IO.Stream>, or an <xref:System.Xml.Serialization.IXmlSerializable> implementation.</span></span> <span data-ttu-id="80821-136">Disposer d'une valeur de retour pour une opération équivaut à disposer d'un paramètre de sortie.</span><span class="sxs-lookup"><span data-stu-id="80821-136">Having a return value for an operation is equivalent to having an output parameter.</span></span>  
  
 <span data-ttu-id="80821-137">Certaines fonctionnalités WCF, telles que la messagerie fiable, les transactions et la sécurité au niveau du message SOAP, s’appuient sur la mise en mémoire tampon des messages pour les transmissions.</span><span class="sxs-lookup"><span data-stu-id="80821-137">Some WCF features, such as reliable messaging, transactions, and SOAP message-level security, rely on buffering messages for transmissions.</span></span> <span data-ttu-id="80821-138">L’utilisation de ces fonctionnalités peut réduire, voire annuler les gains en termes de performances obtenus grâce au flux continu.</span><span class="sxs-lookup"><span data-stu-id="80821-138">Using these features may reduce or eliminate the performance benefits gained by using streaming.</span></span> <span data-ttu-id="80821-139">Pour sécuriser le transport en flux continu, utilisez la sécurité de niveau transport uniquement ou la sécurité de niveau transport et le sécurité de niveau message avec authentification uniquement.</span><span class="sxs-lookup"><span data-stu-id="80821-139">To secure a streamed transport, use transport-level security only or use transport-level security plus authentication-only message security.</span></span>  
  
 <span data-ttu-id="80821-140">Les en-têtes SOAP sont toujours mis en mémoire tampon, même lorsque le mode de transfert a la valeur flux continu.</span><span class="sxs-lookup"><span data-stu-id="80821-140">SOAP headers are always buffered, even when the transfer mode is set to streamed.</span></span> <span data-ttu-id="80821-141">La taille des en-têtes de message ne doit pas dépasser la taille du quota de transport `MaxBufferSize`.</span><span class="sxs-lookup"><span data-stu-id="80821-141">The headers for a message must not exceed the size of the `MaxBufferSize` transport quota.</span></span> <span data-ttu-id="80821-142">Pour plus d’informations sur ce paramètre, consultez [quotas de transport](transport-quotas.md).</span><span class="sxs-lookup"><span data-stu-id="80821-142">For more information about this setting, see [Transport Quotas](transport-quotas.md).</span></span>  
  
## <a name="differences-between-buffered-and-streamed-transfers"></a><span data-ttu-id="80821-143">Différences entre les transferts mis en mémoire tampon et les transferts en flux continu</span><span class="sxs-lookup"><span data-stu-id="80821-143">Differences Between Buffered and Streamed Transfers</span></span>  

 <span data-ttu-id="80821-144">Modifier le mode de transfert de mis en mémoire tampon à flux continu modifie également la forme du canal natif des transports TCP et des transports de canal nommé.</span><span class="sxs-lookup"><span data-stu-id="80821-144">Changing the transfer mode from buffered to streamed also changes the native channel shape of the TCP and named pipe transports.</span></span> <span data-ttu-id="80821-145">Pour les transferts mis en mémoire tampon, la forme du canal natif est <xref:System.ServiceModel.Channels.IDuplexSessionChannel>.</span><span class="sxs-lookup"><span data-stu-id="80821-145">For buffered transfers, the native channel shape is <xref:System.ServiceModel.Channels.IDuplexSessionChannel>.</span></span> <span data-ttu-id="80821-146">Pour les transferts en flux continu, les canaux natifs correspondent à <xref:System.ServiceModel.Channels.IRequestChannel> et à <xref:System.ServiceModel.Channels.IReplyChannel>.</span><span class="sxs-lookup"><span data-stu-id="80821-146">For streamed transfers, the native channels are <xref:System.ServiceModel.Channels.IRequestChannel> and <xref:System.ServiceModel.Channels.IReplyChannel>.</span></span> <span data-ttu-id="80821-147">Modifier le mode de transfert d'une application existante utilisant directement ces transports (c'est-à-dire sans passer par un contrat de service) nécessite de modifier la forme de canal escomptée des fabrications et écouteurs de canal.</span><span class="sxs-lookup"><span data-stu-id="80821-147">Changing the transfer mode in an existing application that uses these transports directly (that is, not through a service contract) requires changing the expected channel shape for channel factories and listeners.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="80821-148">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="80821-148">See also</span></span>

- [<span data-ttu-id="80821-149">Procédure : activer le streaming</span><span class="sxs-lookup"><span data-stu-id="80821-149">How to: Enable Streaming</span></span>](how-to-enable-streaming.md)

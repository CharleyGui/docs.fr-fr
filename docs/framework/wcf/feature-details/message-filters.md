---
title: Filtres de message
ms.date: 03/30/2017
helpviewer_keywords:
- routing [WCF], message filters
ms.assetid: cb33ba49-8b1f-4099-8acb-240404a46d9a
ms.openlocfilehash: a953dea9224d75907c593d87f06a0b0888f0af2d
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79184663"
---
# <a name="message-filters"></a><span data-ttu-id="4acba-102">Filtres de message</span><span class="sxs-lookup"><span data-stu-id="4acba-102">Message Filters</span></span>
<span data-ttu-id="4acba-103">Pour implémenter le routage basé sur le contenu, le service de routage utilise des implémentations <xref:System.ServiceModel.Dispatcher.MessageFilter> qui inspectent des sections particulières d'un message, telles que l'adresse, le nom du point de terminaison ou une instruction XPath spécifique.</span><span class="sxs-lookup"><span data-stu-id="4acba-103">To implement content-based routing, the Routing Service uses <xref:System.ServiceModel.Dispatcher.MessageFilter> implementations that inspect specific sections of a message, such as the address, endpoint name, or a specific XPath statement.</span></span> <span data-ttu-id="4acba-104">Si aucun des filtres de message fournis avec [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] ne répond à vos besoins, vous pouvez créer un filtre personnalisé en créant une nouvelle implémentation de la classe <xref:System.ServiceModel.Dispatcher.MessageFilter> de base.</span><span class="sxs-lookup"><span data-stu-id="4acba-104">If none of the message filters provided with [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] meet your needs, you can create a custom filter by creating a new implementation of the base <xref:System.ServiceModel.Dispatcher.MessageFilter> class.</span></span>  
  
 <span data-ttu-id="4acba-105">Lors de la configuration du service de routage, vous devez définir des éléments de filtre (objets)<xref:System.ServiceModel.Routing.Configuration.FilterElement> qui décrivent le type de **MessageFilter** et toutes les données à l’appui nécessaires pour créer le filtre, tels que des valeurs de chaîne spécifiques à rechercher dans le message.</span><span class="sxs-lookup"><span data-stu-id="4acba-105">When configuring the Routing Service, you must define filter elements (<xref:System.ServiceModel.Routing.Configuration.FilterElement> objects) that describe the type of **MessageFilter** and any supporting data required to create the filter, such as specific string values to search for within the message.</span></span> <span data-ttu-id="4acba-106">Notez que la création des éléments de filtre définit uniquement le filtre de message individuel ; pour que les filtres permettent d'évaluer et de router des messages, vous devez également définir une table de filtres (<xref:System.ServiceModel.Routing.Configuration.FilterTableEntryCollection>).</span><span class="sxs-lookup"><span data-stu-id="4acba-106">Note that creating the filter elements only defines the individual message filters; to use the filters to evaluate and route messages you must also define a filter table (<xref:System.ServiceModel.Routing.Configuration.FilterTableEntryCollection>).</span></span>  
  
 <span data-ttu-id="4acba-107">Chaque entrée dans la table de filtres référence un élément de filtre et spécifie le point de terminaison client vers lequel un message sera routé si celui-ci correspond au filtre.</span><span class="sxs-lookup"><span data-stu-id="4acba-107">Each entry in the filter table references a filter element and specifies the client endpoint that a message will be routed to if the message matches the filter.</span></span> <span data-ttu-id="4acba-108">Les entrées de table de filtres vous permettent également de spécifier une collection de points de terminaison de sauvegarde (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>). Cette collection définit une liste des points de terminaison auxquels le message est transmis en cas d’échec de transmission lors de l’envoi au point de terminaison primaire.</span><span class="sxs-lookup"><span data-stu-id="4acba-108">The filter table entries also allow you to specify a collection of backup endpoints (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>), which defines a list of endpoints that the message will be transmitted to in the event of a transmission failure when sending to the primary endpoint.</span></span> <span data-ttu-id="4acba-109">Ces points de terminaison sont testés dans l'ordre spécifié jusqu'à la réussite de l'un d'eux.</span><span class="sxs-lookup"><span data-stu-id="4acba-109">These endpoints will be tried in the order specified until one succeeds.</span></span>  
  
## <a name="message-filters"></a><span data-ttu-id="4acba-110">Filtres de message</span><span class="sxs-lookup"><span data-stu-id="4acba-110">Message Filters</span></span>  
 <span data-ttu-id="4acba-111">Les filtres de message utilisés par le service de routage fournissent des fonctionnalités communes de sélection de message, par exemple, évaluer le nom du point de terminaison auquel un message a été envoyé, l'action SOAP, l'adresse ou le préfixe d'adresse auquel le message a été envoyé.</span><span class="sxs-lookup"><span data-stu-id="4acba-111">The message filters used by the Routing Service provide common message selection functionality, such as evaluating the name of the endpoint that a message was sent to, the SOAP action, or the address or address prefix that the message was sent to.</span></span> <span data-ttu-id="4acba-112">Il est également possible de joindre deux filtres par une condition `AND`, de manière à router les messages vers un seul point de terminaison si le message correspond aux deux filtres.</span><span class="sxs-lookup"><span data-stu-id="4acba-112">Filters can also be joined with an `AND` condition, so that messages will only be routed to an endpoint if the message matches both filters.</span></span> <span data-ttu-id="4acba-113">Vous pouvez aussi créer des filtres personnalisés en créant votre propre implémentation de <xref:System.ServiceModel.Dispatcher.MessageFilter>.</span><span class="sxs-lookup"><span data-stu-id="4acba-113">You can also create custom filters by creating your own implementation of <xref:System.ServiceModel.Dispatcher.MessageFilter>.</span></span>  
  
 <span data-ttu-id="4acba-114">Le tableau suivant répertorie le <xref:System.ServiceModel.Routing.Configuration.FilterType> utilisé par le service de routage, la classe qui implémente le filtre de message spécifique, et les paramètres <xref:System.ServiceModel.Routing.Configuration.FilterElement.FilterData%2A> requis.</span><span class="sxs-lookup"><span data-stu-id="4acba-114">The following table lists the <xref:System.ServiceModel.Routing.Configuration.FilterType> used by the Routing Service, the class that implements the specific message filter, and the required <xref:System.ServiceModel.Routing.Configuration.FilterElement.FilterData%2A> parameters.</span></span>  
  
|<span data-ttu-id="4acba-115">Type de filtre</span><span class="sxs-lookup"><span data-stu-id="4acba-115">Filter  Type</span></span>|<span data-ttu-id="4acba-116">Description</span><span class="sxs-lookup"><span data-stu-id="4acba-116">Description</span></span>|<span data-ttu-id="4acba-117">Signification des données de filtre</span><span class="sxs-lookup"><span data-stu-id="4acba-117">Filter Data Meaning</span></span>|<span data-ttu-id="4acba-118">Exemple de filtre</span><span class="sxs-lookup"><span data-stu-id="4acba-118">Example Filter</span></span>|  
|------------------|-----------------|-------------------------|--------------------|  
|<span data-ttu-id="4acba-119">Action</span><span class="sxs-lookup"><span data-stu-id="4acba-119">Action</span></span>|<span data-ttu-id="4acba-120">Utilise la classe <xref:System.ServiceModel.Dispatcher.ActionMessageFilter> pour filtrer les messages qui contiennent une action spécifique.</span><span class="sxs-lookup"><span data-stu-id="4acba-120">Uses the <xref:System.ServiceModel.Dispatcher.ActionMessageFilter> class to match messages containing a specific action.</span></span>|<span data-ttu-id="4acba-121">Action à laquelle appliquer un filtre.</span><span class="sxs-lookup"><span data-stu-id="4acba-121">The action to filter upon.</span></span>|<span data-ttu-id="4acba-122">\<filtre name "action1" filterType"Action" filterData""http://namespace/contract/operation/></span><span class="sxs-lookup"><span data-stu-id="4acba-122">\<filter name="action1" filterType="Action" filterData="http://namespace/contract/operation" /></span></span>|  
|<span data-ttu-id="4acba-123">EndpointAddress</span><span class="sxs-lookup"><span data-stu-id="4acba-123">EndpointAddress</span></span>|<span data-ttu-id="4acba-124">Utilise <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter> la classe, avec <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter.IncludeHostNameInComparison%2A>  ==  `true` pour faire correspondre les messages contenant une adresse spécifique.</span><span class="sxs-lookup"><span data-stu-id="4acba-124">Uses the <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter> class, with <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter.IncludeHostNameInComparison%2A> == `true` to match messages containing a specific address.</span></span>|<span data-ttu-id="4acba-125">Adresse à laquelle appliquer un filtre (dans l'en-tête À).</span><span class="sxs-lookup"><span data-stu-id="4acba-125">The address to filter upon (in the To header).</span></span>|<span data-ttu-id="4acba-126">\<filtre name"address1" filterType "EndpointAddress" filterData""http://host/vdir/s.svc/b/></span><span class="sxs-lookup"><span data-stu-id="4acba-126">\<filter name="address1" filterType="EndpointAddress" filterData="http://host/vdir/s.svc/b"  /></span></span>|  
|<span data-ttu-id="4acba-127">EndpointAddressPrefix</span><span class="sxs-lookup"><span data-stu-id="4acba-127">EndpointAddressPrefix</span></span>|<span data-ttu-id="4acba-128">Utilise <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter> la classe, avec <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter.IncludeHostNameInComparison%2A>  ==  `true` pour faire correspondre les messages contenant un préfixe d’adresse spécifique.</span><span class="sxs-lookup"><span data-stu-id="4acba-128">Uses the <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter> class, with <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter.IncludeHostNameInComparison%2A> == `true` to match messages containing a specific address prefix.</span></span>|<span data-ttu-id="4acba-129">Adresse à laquelle appliquer un filtre utilisant le plus long préfixe correspondant.</span><span class="sxs-lookup"><span data-stu-id="4acba-129">The address to filter upon using longest prefix matching.</span></span>|<span data-ttu-id="4acba-130">\<filtre name"prefix1" filterType"EndpointAddressPrefix" filterData""http://host//></span><span class="sxs-lookup"><span data-stu-id="4acba-130">\<filter name="prefix1" filterType="EndpointAddressPrefix" filterData="http://host/" /></span></span>|  
|<span data-ttu-id="4acba-131">and</span><span class="sxs-lookup"><span data-stu-id="4acba-131">And</span></span>|<span data-ttu-id="4acba-132">Utilise la classe <xref:System.ServiceModel.Dispatcher.StrictAndMessageFilter> qui évalue toujours les deux conditions avant de retourner.</span><span class="sxs-lookup"><span data-stu-id="4acba-132">Uses the <xref:System.ServiceModel.Dispatcher.StrictAndMessageFilter> class that always evaluates both conditions before returning.</span></span>|<span data-ttu-id="4acba-133">filterData n’est pas utilisé; au lieu de filtre1 et filter2 ont les noms des filtres de message correspondants (également dans le tableau), qui devrait être **et**ed ensemble.</span><span class="sxs-lookup"><span data-stu-id="4acba-133">filterData is not used; instead filter1 and filter2 have the names of the corresponding message filters (also in the table), which should be **AND**ed together.</span></span>|<span data-ttu-id="4acba-134">\<filtre nom "et1" filtreType""Et" filtre1"address1" filter2"action1" /></span><span class="sxs-lookup"><span data-stu-id="4acba-134">\<filter name="and1" filterType="And" filter1="address1" filter2="action1" /></span></span>|  
|<span data-ttu-id="4acba-135">Custom</span><span class="sxs-lookup"><span data-stu-id="4acba-135">Custom</span></span>|<span data-ttu-id="4acba-136">Type défini par l'utilisateur qui étend la classe <xref:System.ServiceModel.Dispatcher.MessageFilter> et possède un constructeur qui prend une chaîne.</span><span class="sxs-lookup"><span data-stu-id="4acba-136">A user-defined type that extends the <xref:System.ServiceModel.Dispatcher.MessageFilter> class and has a constructor taking a string.</span></span>|<span data-ttu-id="4acba-137">L'attribut customType est le nom de type qualifié complet de la classe à créer ; filterData est la chaîne à passer au constructeur lors de la création du filtre.</span><span class="sxs-lookup"><span data-stu-id="4acba-137">The customType attribute is the fully qualified type name of the class to create; filterData is the string to pass to the constructor when creating the filter.</span></span>|<span data-ttu-id="4acba-138">\<filtre name "custom1" filterType"Custom" customType'"CustomAssembly.CustomMsgFilter, CustomAssembly" filterData'"Custom Data" /></span><span class="sxs-lookup"><span data-stu-id="4acba-138">\<filter name="custom1" filterType="Custom" customType="CustomAssembly.CustomMsgFilter, CustomAssembly" filterData="Custom Data" /></span></span>|  
|<span data-ttu-id="4acba-139">EndpointName</span><span class="sxs-lookup"><span data-stu-id="4acba-139">EndpointName</span></span>|<span data-ttu-id="4acba-140">Utilise la classe <xref:System.ServiceModel.Dispatcher.EndpointNameMessageFilter> pour filtrer les messages en fonction du nom du point de terminaison de service sur lequel ils sont arrivés.</span><span class="sxs-lookup"><span data-stu-id="4acba-140">Uses the <xref:System.ServiceModel.Dispatcher.EndpointNameMessageFilter> class to match messages based on the name of the service endpoint they arrived on.</span></span>|<span data-ttu-id="4acba-141">Le nom du critère de service, par exemple : « serviceEndpoint1 ».</span><span class="sxs-lookup"><span data-stu-id="4acba-141">The name of the service endpoint, for example: "serviceEndpoint1".</span></span>  <span data-ttu-id="4acba-142">Ce doit être l'un des points de terminaison exposés sur le service de routage.</span><span class="sxs-lookup"><span data-stu-id="4acba-142">This should be one of the endpoints exposed on the Routing Service.</span></span>|<span data-ttu-id="4acba-143">\<filtre name "stock1" filterType"Endpoint" filterData"SvcEndpoint" /></span><span class="sxs-lookup"><span data-stu-id="4acba-143">\<filter name="stock1" filterType="Endpoint" filterData="SvcEndpoint" /></span></span>|  
|<span data-ttu-id="4acba-144">MatchAll</span><span class="sxs-lookup"><span data-stu-id="4acba-144">MatchAll</span></span>|<span data-ttu-id="4acba-145">Utilise la classe <xref:System.ServiceModel.Dispatcher.MatchAllMessageFilter>.</span><span class="sxs-lookup"><span data-stu-id="4acba-145">Uses the <xref:System.ServiceModel.Dispatcher.MatchAllMessageFilter> class.</span></span> <span data-ttu-id="4acba-146">Ce filtre correspond à tous les messages entrants.</span><span class="sxs-lookup"><span data-stu-id="4acba-146">This filter matches all arriving messages.</span></span>|<span data-ttu-id="4acba-147">filterData n'est pas utilisé.</span><span class="sxs-lookup"><span data-stu-id="4acba-147">filterData is not used.</span></span> <span data-ttu-id="4acba-148">Ce filtre correspondra toujours à tous les messages.</span><span class="sxs-lookup"><span data-stu-id="4acba-148">This filter will always match all messages.</span></span>|<span data-ttu-id="4acba-149">\<nom de filtre "matchAll1" filtreType"MatchAll" /></span><span class="sxs-lookup"><span data-stu-id="4acba-149">\<filter name="matchAll1" filterType="MatchAll" /></span></span>|  
|<span data-ttu-id="4acba-150">XPath</span><span class="sxs-lookup"><span data-stu-id="4acba-150">XPath</span></span>|<span data-ttu-id="4acba-151">Utilise la classe <xref:System.ServiceModel.Dispatcher.XPathMessageFilter> pour filtrer des requêtes XPath spécifiques dans le message.</span><span class="sxs-lookup"><span data-stu-id="4acba-151">Uses the <xref:System.ServiceModel.Dispatcher.XPathMessageFilter> class to match specific XPath queries within the message.</span></span>|<span data-ttu-id="4acba-152">Requête XPath à utiliser lors de la mise en correspondance des messages.</span><span class="sxs-lookup"><span data-stu-id="4acba-152">The XPath query to use when matching messages.</span></span>|<span data-ttu-id="4acba-153">\<nom de filtre "XPath1" filterType"XPath" filterData"//ns:element" /></span><span class="sxs-lookup"><span data-stu-id="4acba-153">\<filter name="XPath1" filterType="XPath" filterData="//ns:element" /></span></span>|  
  
 <span data-ttu-id="4acba-154">L’exemple suivant définit des entrées de filtre qui utilisent les filtres de message XPath, EndpointName et PrefixEndpointAddress.</span><span class="sxs-lookup"><span data-stu-id="4acba-154">The following example defines filter entries that use the XPath, EndpointName, and PrefixEndpointAddress message filters.</span></span> <span data-ttu-id="4acba-155">Cet exemple montre également l'utilisation d'un filtre personnalisé pour les entrées RoundRobinFilter1 et RoundRobinFilter2.</span><span class="sxs-lookup"><span data-stu-id="4acba-155">This example also demonstrates using a custom filter for the RoundRobinFilter1 and RoundRobinFilter2 entries.</span></span>  
  
```xml  
<filters>  
     <filter name="XPathFilter" filterType="XPath"
             filterData="/s12:Envelope/s12:Header/custom:RoundingCalculator = 1"/>  
     <filter name="EndpointNameFilter" filterType="EndpointName"
             filterData="calculatorEndpoint"/>  
     <filter name="PrefixAddressFilter" filterType="PrefixEndpointAddress"
             filterData="http://localhost/routingservice/router/rounding/"/>  
     <filter name="RoundRobinFilter1" filterType="Custom"
             customType="RoutingServiceFilters.RoundRobinMessageFilter,
             RoutingService" filterData="group1"/>  
     <filter name="RoundRobinFilter2" filterType="Custom"
             customType="RoutingServiceFilters.RoundRobinMessageFilter,
             RoutingService" filterData="group1"/>  
</filters>  
```  
  
> [!NOTE]
> <span data-ttu-id="4acba-156">La simple définition d'un filtre n'entraîne pas l'évaluation des messages par rapport au filtre.</span><span class="sxs-lookup"><span data-stu-id="4acba-156">Simply defining a filter does not cause messages to be evaluated against the filter.</span></span> <span data-ttu-id="4acba-157">Le filtre doit être ajouté à une table de filtres, associée ensuite au point de terminaison de service exposé par le service de routage.</span><span class="sxs-lookup"><span data-stu-id="4acba-157">The filter must be added to a filter table, which is then associated with the service endpoint exposed by the Routing Service.</span></span>  
  
### <a name="namespace-table"></a><span data-ttu-id="4acba-158">Table d'espace de noms</span><span class="sxs-lookup"><span data-stu-id="4acba-158">Namespace Table</span></span>  
 <span data-ttu-id="4acba-159">Lors de l'utilisation d'un Filtre XPath, les données de filtre qui contiennent la requête XPath peuvent devenir extrêmement volumineuses en raison de l'utilisation d'espaces de noms.</span><span class="sxs-lookup"><span data-stu-id="4acba-159">When using an XPath filter, the filter data that contains the XPath query can become extremely large due to the use of namespaces.</span></span> <span data-ttu-id="4acba-160">Pour pallier ce problème, le service de routage offre la possibilité de définir vos propres préfixes d'espace de noms à l'aide de la table d'espace de noms.</span><span class="sxs-lookup"><span data-stu-id="4acba-160">To alleviate this problem the Routing Service provides the ability to define your own namespace prefixes by using the namespace table.</span></span>  
  
 <span data-ttu-id="4acba-161">La table d’espace de noms est une collection d’objets <xref:System.ServiceModel.Routing.Configuration.NamespaceElement> qui définit les préfixes d’espaces de noms communs qui peuvent être utilisés dans un XPath.</span><span class="sxs-lookup"><span data-stu-id="4acba-161">The namespace table is a collection of <xref:System.ServiceModel.Routing.Configuration.NamespaceElement> objects that defines the namespace prefixes for common namespaces that can be used in an XPath.</span></span> <span data-ttu-id="4acba-162">Voici les espaces de noms et les préfixes d'espace de noms par défaut contenus dans la table d'espace de noms.</span><span class="sxs-lookup"><span data-stu-id="4acba-162">The following are the default namespaces and namespace prefixes that are contained in the namespace table.</span></span>  
  
|<span data-ttu-id="4acba-163">Préfixe</span><span class="sxs-lookup"><span data-stu-id="4acba-163">Prefix</span></span>|<span data-ttu-id="4acba-164">Espace de noms</span><span class="sxs-lookup"><span data-stu-id="4acba-164">Namespace</span></span>|  
|------------|---------------|  
|<span data-ttu-id="4acba-165">s11</span><span class="sxs-lookup"><span data-stu-id="4acba-165">s11</span></span>|`http://schemas.xmlsoap.org/soap/envelope`|  
|<span data-ttu-id="4acba-166">s12</span><span class="sxs-lookup"><span data-stu-id="4acba-166">s12</span></span>|`http://www.w3.org/2003/05/soap-envelope`|  
|<span data-ttu-id="4acba-167">wsaAugust2004</span><span class="sxs-lookup"><span data-stu-id="4acba-167">wsaAugust2004</span></span>|`http://schemas.xmlsoap.org/ws/2004/08/addressing`|  
|<span data-ttu-id="4acba-168">wsa10</span><span class="sxs-lookup"><span data-stu-id="4acba-168">wsa10</span></span>|`http://www.w3.org/2005/08/addressing`|  
|<span data-ttu-id="4acba-169">sm</span><span class="sxs-lookup"><span data-stu-id="4acba-169">sm</span></span>|`http://schemas.microsoft.com/serviceModel/2004/05/xpathfunctions`|  
|<span data-ttu-id="4acba-170">tempuri</span><span class="sxs-lookup"><span data-stu-id="4acba-170">tempuri</span></span>|`http://tempuri.org`|  
|<span data-ttu-id="4acba-171">ser</span><span class="sxs-lookup"><span data-stu-id="4acba-171">ser</span></span>|`http://schemas.microsoft.com/2003/10/Serialization`|  
  
 <span data-ttu-id="4acba-172">Si vous prévoyez d’utiliser un espace de noms spécifique dans vos requêtes XPath, vous pouvez l’ajouter à la table d’espace de noms avec un préfixe d’espace de noms unique, et utiliser ce préfixe à la place de l’espace de noms complet dans toutes les requêtes XPath.</span><span class="sxs-lookup"><span data-stu-id="4acba-172">When you know that you will be using a specific namespace in your XPath queries, you can add it to the namespace table along with a unique namespace prefix and use the prefix in any XPath query instead of the full namespace.</span></span> <span data-ttu-id="4acba-173">L’exemple suivant définit un préfixe de `"http://my.custom.namespace"`"custom" pour l’espace de nom , qui est ensuite utilisé dans la requête XPath contenue dans filterData.</span><span class="sxs-lookup"><span data-stu-id="4acba-173">The following example defines a prefix of "custom" for the namespace `"http://my.custom.namespace"`, which is then used in the XPath query contained in filterData.</span></span>  
  
```xml  
<namespaceTable>  
     <add prefix="custom" namespace="http://my.custom.namespace/"/>  
</namespaceTable>  
<filters>  
     <filter name="XPathFilter" filterType="XPath" filterData="/s12:Envelope/s12:Header/custom:RoundingCalculator = 1"/>  
</filters>  
```  
  
## <a name="filter-tables"></a><span data-ttu-id="4acba-174">Tables de filtres</span><span class="sxs-lookup"><span data-stu-id="4acba-174">Filter Tables</span></span>  
 <span data-ttu-id="4acba-175">Tandis que chaque élément de filtre définit une comparaison logique qui peut s'appliquer à un message, la table de filtres fournit l'association entre l'élément de filtre et le point de terminaison de client de destination.</span><span class="sxs-lookup"><span data-stu-id="4acba-175">While each filter element defines a logical comparison that can be applied to a message, the filter table provides the association between the filter element and the destination client endpoint.</span></span> <span data-ttu-id="4acba-176">Une table de filtres est une collection nommée d'objets <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement> qui définissent l'association entre un filtre, un point de terminaison de destination primaire et une liste d'autres points de terminaison de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="4acba-176">A filter table is a named collection of <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement> objects that define the association between a filter, a primary destination endpoint, and a list of alternative backup endpoints.</span></span> <span data-ttu-id="4acba-177">Les entrées de la table de filtres vous permettent également de spécifier une priorité facultative pour chaque condition de filtre.</span><span class="sxs-lookup"><span data-stu-id="4acba-177">The filter table entries also allow you to specify an optional priority for each filter condition.</span></span> <span data-ttu-id="4acba-178">L'exemple suivant définit deux filtres, puis une table de filtres qui associe chaque filtre à un point de terminaison de destination.</span><span class="sxs-lookup"><span data-stu-id="4acba-178">The following example defines two filters and then defines a filter table that associates each filter with a destination endpoint.</span></span>  
  
```xml  
<routing>  
     <filters>  
       <filter name="AddAction" filterType="Action" filterData="Add" />  
       <filter name="SubtractAction" filterType="Action" filterData="Subtract" />  
     </filters>  
     <filterTables>  
       <table name="routingTable1">  
         <filters>  
           <add filterName="AddAction" endpointName="Addition" />  
           <add filterName="SubtractAction" endpointName="Subtraction" />  
         </filters>  
       </table>  
     </filterTables>
</routing>  
```  
  
### <a name="filter-evaluation-priority"></a><span data-ttu-id="4acba-179">Priorité d'évaluation du filtre</span><span class="sxs-lookup"><span data-stu-id="4acba-179">Filter Evaluation Priority</span></span>  
 <span data-ttu-id="4acba-180">Par défaut, toutes les entrées de la table de filtres sont évaluées simultanément, et le message qui est évalué est routé vers le ou les points de terminaison associés à chaque entrée de filtre correspondante.</span><span class="sxs-lookup"><span data-stu-id="4acba-180">By default, all entries in the filter table are evaluated simultaneously, and the message being evaluated is routed to the endpoint(s) associated with each matching filter entry.</span></span> <span data-ttu-id="4acba-181">Si plusieurs filtres doivent avoir la valeur `true`, et si le message est en mode monodirectionnel ou duplex, le message est envoyé en mode multidiffusion aux points de terminaison de tous les filtres correspondants.</span><span class="sxs-lookup"><span data-stu-id="4acba-181">If multiple filters evaluate to `true`, and the message is one-way or duplex, the message is multicast to the endpoints for all matching filters.</span></span> <span data-ttu-id="4acba-182">Les messages demande-réponse ne peuvent pas être envoyés en mode multidiffusion parce que seule une réponse peut être retournée au client.</span><span class="sxs-lookup"><span data-stu-id="4acba-182">Request-reply messages cannot be multicast because only one reply can be returned to the client.</span></span>  
  
 <span data-ttu-id="4acba-183">Une logique de routage plus complexe peut être implémentée en spécifiant des niveaux de priorité pour chaque filtre ; le service de routage évalue en premier tous les filtres au niveau de priorité le plus élevé.</span><span class="sxs-lookup"><span data-stu-id="4acba-183">More complex routing logic can be implemented by specifying priority levels for each filter; the Routing Service evaluates all filters at the highest priority level first.</span></span> <span data-ttu-id="4acba-184">Si un message correspond à un filtre de ce niveau, aucun filtre de priorité plus faible n'est traité.</span><span class="sxs-lookup"><span data-stu-id="4acba-184">If a message matches a filter of this level, no filters of a lower priority are processed.</span></span> <span data-ttu-id="4acba-185">Par exemple, un message entrant monodirectionnel est évalué par rapport à tous les filtres avec une priorité de niveau 2.</span><span class="sxs-lookup"><span data-stu-id="4acba-185">For example, an incoming one-way message is first evaluated against all filters with a priority of 2.</span></span> <span data-ttu-id="4acba-186">Le message ne correspond à aucun filtre à ce niveau de priorité, donc le message est ensuite comparé aux filtres avec une priorité de niveau 1.</span><span class="sxs-lookup"><span data-stu-id="4acba-186">The message does not match any filter at this priority level, so next the message is compared against filters with a priority of 1.</span></span> <span data-ttu-id="4acba-187">Deux filtres de priorité 1 correspondent au message, et parce qu'il s'agit d'un message monodirectionnel, il est routé vers les deux points de terminaison de destination.</span><span class="sxs-lookup"><span data-stu-id="4acba-187">Two priority 1 filters match the message, and because it is a one-way message it is routed to both destination endpoints.</span></span>  <span data-ttu-id="4acba-188">Étant donné qu'une correspondance a été trouvée parmi les filtres de priorité 1, aucun filtre de priorité 0 n'est évalué.</span><span class="sxs-lookup"><span data-stu-id="4acba-188">Because a match was found among the priority 1 filters, no filters of priority 0 are evaluated.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="4acba-189">Si aucune priorité n'est spécifiée, la valeur de priorité 0 est utilisée par défaut.</span><span class="sxs-lookup"><span data-stu-id="4acba-189">If no priority is specified, the default priority of 0 is used.</span></span>  
  
 <span data-ttu-id="4acba-190">L'exemple suivant définit une table de filtres qui spécifie des priorités de 2, 1 et 0 pour les filtres référencés dans la table.</span><span class="sxs-lookup"><span data-stu-id="4acba-190">The following example defines a filter table that specifies priorities of 2, 1, and 0 for the filters referenced in the table.</span></span>  
  
```xml  
<filterTables>  
     <filterTable name="filterTable1">  
          <add filterName="XPathFilter" endpointName="roundingCalcEndpoint"
               priority="2"/>  
          <add filterName="EndpointNameFilter" endpointName="regularCalcEndpoint"
               priority="1"/>  
          <add filterName="PrefixAddressFilter" endpointName="roundingCalcEndpoint"
               priority="1"/>  
          <add filterName="MatchAllMessageFilter" endpointName="defaultCalcEndpoint"
               priority="0"/>  
     </filterTable>  
</filterTables>  
```  
  
 <span data-ttu-id="4acba-191">Dans l’exemple précédent, si un message correspond au XPathFilter, il est routé vers le roundingCalcEndpoint et aucun filtre supplémentaire dans la table n’est évalué car tous les autres filtres sont de priorité plus faible.</span><span class="sxs-lookup"><span data-stu-id="4acba-191">In the preceding example, if a message matches the XPathFilter, it will be routed to the roundingCalcEndpoint and no further filters in the table will be evaluated because all other filters are of a lower priority.</span></span> <span data-ttu-id="4acba-192">Toutefois, si le message ne correspond pas au XPathFilter, il est alors évalué par rapport à tous les filtres suivants de priorité plus faible, EndpointNameFilter et PrefixAddressFilter.</span><span class="sxs-lookup"><span data-stu-id="4acba-192">However, if the message does not match the XPathFilter it will then be evaluated against all filters of the next lower priority, EndpointNameFilter and PrefixAddressFilter.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="4acba-193">Si possible, utilisez des filtres exclusifs au lieu de spécifier une priorité. En effet, l'évaluation des priorités risque d'entraîner une dégradation des performances.</span><span class="sxs-lookup"><span data-stu-id="4acba-193">When possible, use exclusive filters instead of specifying a priority because priority evaluation can result in performance degradation.</span></span>  
  
### <a name="backup-lists"></a><span data-ttu-id="4acba-194">Listes de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="4acba-194">Backup Lists</span></span>  
 <span data-ttu-id="4acba-195">Chaque filtre de la table de filtres peut éventuellement spécifier une liste de sauvegarde, qui est une collection nommée de points de terminaison (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>).</span><span class="sxs-lookup"><span data-stu-id="4acba-195">Each filter in the filter table can optionally specify a backup list, which is a named collection of endpoints (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>).</span></span> <span data-ttu-id="4acba-196">Cette collection contient une liste ordonnée des points de terminaison auxquels le message sera transmis en cas de <xref:System.ServiceModel.CommunicationException> lors de l’envoi au point de terminaison primaire spécifié dans la propriété <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement.EndpointName%2A>.</span><span class="sxs-lookup"><span data-stu-id="4acba-196">This collection contains an ordered list of endpoints that the message will be transmitted to in the event of a <xref:System.ServiceModel.CommunicationException> when sending to the primary endpoint specified in <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement.EndpointName%2A>.</span></span> <span data-ttu-id="4acba-197">L’exemple suivant définit une liste de sauvegarde nommée "backupServiceEndpoints" qui contient deux points de terminaison.</span><span class="sxs-lookup"><span data-stu-id="4acba-197">The following example defines a backup list named "backupServiceEndpoints" that contains two endpoints.</span></span>  
  
```xml  
<filterTables>  
     <filterTable name="filterTable1">  
          <add filterName="MatchAllFilter1" endpointName="Destination" backupList="backupEndpointList"/>  
     </filterTable>  
</filterTables>  
<backupLists>  
     <backupList name="backupEndpointList">  
          <add endpointName="backupServiceQueue" />  
          <add endpointName="alternateServiceQueue" />  
     </backupList>  
</backupLists>  
```  
  
 <span data-ttu-id="4acba-198">Dans l’exemple précédent, si un envoi au critère d’évaluation principal "Destination" échoue, le service de routage va essayer d’envoyer à chaque point de terminaison dans la séquence qu’ils sont répertoriés, d’abord l’envoi à la sauvegardeServiceQueue et par la suite l’envoi à d’autresServiceQueue si le envoyer à la sauvegardeServiceQueue échoue.</span><span class="sxs-lookup"><span data-stu-id="4acba-198">In the preceding example, if a send to the primary endpoint "Destination" fails, the Routing Service will try sending to each endpoint in the sequence they are listed, first sending to backupServiceQueue and subsequently sending to alternateServiceQueue if the send to backupServiceQueue fails.</span></span> <span data-ttu-id="4acba-199">Si tous les points de terminaison de sauvegarde échouent, une erreur est retournée.</span><span class="sxs-lookup"><span data-stu-id="4acba-199">If all backup endpoints fail, a fault is returned.</span></span>

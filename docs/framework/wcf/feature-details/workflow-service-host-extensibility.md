---
title: Extensibilité de l'hôte du service de workflow
ms.date: 03/30/2017
ms.assetid: c0e8f7bb-cb13-49ec-852f-b85d7c23972f
ms.openlocfilehash: 4c2edec8c23e27f019b95223c998c72069384c75
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/09/2020
ms.locfileid: "84594892"
---
# <a name="workflow-service-host-extensibility"></a><span data-ttu-id="c6d06-102">Extensibilité de l'hôte du service de workflow</span><span class="sxs-lookup"><span data-stu-id="c6d06-102">Workflow Service Host Extensibility</span></span>
[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] <span data-ttu-id="c6d06-103">fournit la classe <xref:System.ServiceModel.Activities.WorkflowServiceHost> pour l'hébergement de services de workflow.</span><span class="sxs-lookup"><span data-stu-id="c6d06-103">provides the <xref:System.ServiceModel.Activities.WorkflowServiceHost> class for hosting workflow services.</span></span> <span data-ttu-id="c6d06-104">Cette classe est utilisée lorsque vous auto-hébergez un service de workflow dans une application managée ou un service Windows.</span><span class="sxs-lookup"><span data-stu-id="c6d06-104">This class is used when you are self-hosting a workflow service in a managed application or a Windows service.</span></span> <span data-ttu-id="c6d06-105">Cette classe est également utilisée lors de l'hébergement d'un service de workflow dans les services IIS (Internet Information Services) ou WAS (Windows Process Activation Service).</span><span class="sxs-lookup"><span data-stu-id="c6d06-105">This class is also used when hosting a workflow service with Internet Information Services (IIS) or Windows Process Activation Service (WAS).</span></span> <span data-ttu-id="c6d06-106">La classe <xref:System.ServiceModel.Activities.WorkflowServiceHost> fournit des points d’extension qui vous permettent d’ajouter des extensions personnalisées, de modifier le comportement inactif et d’héberger des workflows sans service (workflows qui n’utilisent aucune activité de messagerie).</span><span class="sxs-lookup"><span data-stu-id="c6d06-106">The <xref:System.ServiceModel.Activities.WorkflowServiceHost> class provides extension points that allow you to add custom extensions, change the idle behavior, and host non-service workflows (workflows that do not use messaging activities).</span></span>  
  
## <a name="workflow-service-host-extensions"></a><span data-ttu-id="c6d06-107">Extensions de l'hôte du service de workflow</span><span class="sxs-lookup"><span data-stu-id="c6d06-107">Workflow Service Host Extensions</span></span>  
 <span data-ttu-id="c6d06-108">Le <xref:System.ServiceModel.Activities.WorkflowServiceHost> contient une propriété <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> de type <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager> qui fournit des méthodes pour ajouter des extensions au <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="c6d06-108">The <xref:System.ServiceModel.Activities.WorkflowServiceHost> contains a <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> property of type <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager> that provides methods to add extensions to the <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span></span> <span data-ttu-id="c6d06-109">Utilisez la méthode <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> pour ajouter une extension pour chaque instance du service de workflow.</span><span class="sxs-lookup"><span data-stu-id="c6d06-109">Use the <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> method to add an extension for each workflow service instance.</span></span> <span data-ttu-id="c6d06-110">Le délégué spécifié est appelé pour créer une extension lorsqu’une instance du service de workflow est créée ou chargée à partir d’un magasin de persistance.</span><span class="sxs-lookup"><span data-stu-id="c6d06-110">The delegate specified is called to create a new extension when a workflow service instance is created or loaded from a persistence store.</span></span> <span data-ttu-id="c6d06-111">Utilisez la méthode <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> pour ajouter une extension pour chaque hôte du service de workflow. Une instance de l'extension est partagée pour toutes les instances du service de workflow.</span><span class="sxs-lookup"><span data-stu-id="c6d06-111">Use the <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> method to add an extension for each workflow service host, one instance of the extension is shared for all workflow service instances.</span></span>  
  
## <a name="react-to-unhandled-exceptions"></a><span data-ttu-id="c6d06-112">Réagir aux exceptions non gérées</span><span class="sxs-lookup"><span data-stu-id="c6d06-112">React to Unhandled Exceptions</span></span>  
 <span data-ttu-id="c6d06-113">Le <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> vous permet de spécifier l'action à entreprendre si une exception non gérée est levée dans un service de workflow.</span><span class="sxs-lookup"><span data-stu-id="c6d06-113">The <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> enables you to specify the action to take if an unhandled exception occurs within a workflow service.</span></span> <span data-ttu-id="c6d06-114">La propriété <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior.Action%2A> spécifie l'une des valeurs de <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction> :</span><span class="sxs-lookup"><span data-stu-id="c6d06-114">The <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior.Action%2A> property specifies one of the <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction> values:</span></span>  
  
- <span data-ttu-id="c6d06-115"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Abandon> : abandonne l'instance de service de workflow.</span><span class="sxs-lookup"><span data-stu-id="c6d06-115"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Abandon> – Aborts the workflow service instance.</span></span>  
  
- <span data-ttu-id="c6d06-116"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.AbandonAndSuspend> : restaure le dernier état persistant et interrompt l'instance du service de workflow.</span><span class="sxs-lookup"><span data-stu-id="c6d06-116"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.AbandonAndSuspend> – Rolls back to the last persisted state and suspends the workflow service instance.</span></span> <span data-ttu-id="c6d06-117">Cela ne se produit que si le workflow a déjà été persistant au moins une fois.</span><span class="sxs-lookup"><span data-stu-id="c6d06-117">This only occurs if the workflow has already been persisted at least once.</span></span> <span data-ttu-id="c6d06-118">Dans le cas contraire, l'instance de workflow est annulée.</span><span class="sxs-lookup"><span data-stu-id="c6d06-118">If not the workflow instance is aborted.</span></span>  
  
- <span data-ttu-id="c6d06-119"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel> : annule l'instance.</span><span class="sxs-lookup"><span data-stu-id="c6d06-119"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel> – Cancels the instance.</span></span>  
  
- <span data-ttu-id="c6d06-120"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Terminate> : met fin à l'instance.</span><span class="sxs-lookup"><span data-stu-id="c6d06-120"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Terminate> – Terminates the instance.</span></span>  
  
 <span data-ttu-id="c6d06-121">Ce comportement peut être configuré dans le code, comme indiqué dans l'exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="c6d06-121">This behavior can be configured in code as shown in the following example.</span></span>  
  
```csharp  
host.Description.Behaviors.Add(new WorkflowUnhandledExceptionBehavior { Action = WorkflowUnhandledExceptionAction.Abandon });  
```  
  
 <span data-ttu-id="c6d06-122">Il peut également être configuré dans un fichier de configuration, comme illustré dans l'exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="c6d06-122">It can also be configured in a configuration file as shown in the following example.</span></span>  
  
```xml
<behaviors>  
      <serviceBehaviors>  
        <behavior>  
          <serviceMetadata httpGetEnabled="True"/>  
          <serviceDebug includeExceptionDetailInFaults="False" />  
          <workflowUnhandledExceptionBehavior action="Abandon" />
        </behavior>  
      </serviceBehaviors>  
</behaviors>
```  
  
## <a name="hosting-non-service-workflows"></a><span data-ttu-id="c6d06-123">Hébergement de workflows sans service</span><span class="sxs-lookup"><span data-stu-id="c6d06-123">Hosting Non-Service Workflows</span></span>  
 <span data-ttu-id="c6d06-124"><xref:System.ServiceModel.Activities.WorkflowServiceHost> peut être utilisé pour héberger des workflows sans service, ou des workflows qui ne commencent pas non plus par une activité <xref:System.ServiceModel.Activities.Receive> ou qui n'utilisent pas les activités de messagerie.</span><span class="sxs-lookup"><span data-stu-id="c6d06-124"><xref:System.ServiceModel.Activities.WorkflowServiceHost> can be used to host non-service workflows, or workflows that either do not begin with a <xref:System.ServiceModel.Activities.Receive> activity or workflows that do not use the messaging activities.</span></span> <span data-ttu-id="c6d06-125">Les services de workflow commencent normalement par une activité <xref:System.ServiceModel.Activities.Receive>.</span><span class="sxs-lookup"><span data-stu-id="c6d06-125">Workflow services normally begin with a <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="c6d06-126">Lorsque le <xref:System.ServiceModel.Activities.WorkflowServiceHost> reçoit un message pour un service de workflow, si celui-ci n'est pas déjà en cours d'exécution (ou persistant), une nouvelle instance du service de workflow est créée.</span><span class="sxs-lookup"><span data-stu-id="c6d06-126">When the <xref:System.ServiceModel.Activities.WorkflowServiceHost> receives a message for a workflow service, if it is not already running (or persisted) a new workflow service instance is created.</span></span> <span data-ttu-id="c6d06-127">Si un workflow ne commence pas par une activité Receive, il ne peut pas être démarré par l'envoi d'un message parce qu'il n'existe aucune activité pour recevoir le message.</span><span class="sxs-lookup"><span data-stu-id="c6d06-127">If a workflow does not begin with a Receive activity, it cannot be started by sending a message because there is no activity to receive the message.</span></span> <span data-ttu-id="c6d06-128">Pour héberger un workflow sans service, dérivez une classe à partir de <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> et substituez les méthodes <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A>, <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> et <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A>.</span><span class="sxs-lookup"><span data-stu-id="c6d06-128">To host a non-service workflow, derive a class from <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> and override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A>, <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A>, and <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A>.</span></span> <span data-ttu-id="c6d06-129">Substituez <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A> si vous souhaitez fournir un ID d'instance préféré.</span><span class="sxs-lookup"><span data-stu-id="c6d06-129">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A> if you want to provide a preferred instance ID.</span></span> <span data-ttu-id="c6d06-130">Substituez la méthode <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> pour créer un contexte de création de workflow personnalisé ou remplir une instance du <xref:System.ServiceModel.Activities.WorkflowCreationContext> existant.</span><span class="sxs-lookup"><span data-stu-id="c6d06-130">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> to create a custom workflow creation context or populate an instance of the existing <xref:System.ServiceModel.Activities.WorkflowCreationContext>.</span></span> <span data-ttu-id="c6d06-131">Substituez la méthode <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A> pour extraire manuellement le signet du message entrant.</span><span class="sxs-lookup"><span data-stu-id="c6d06-131">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A> to manually extract the bookmark from the incoming message.</span></span> <span data-ttu-id="c6d06-132">Si vous remplacez cette méthode, vous devez invoquer <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> dans son corps pour qu'il réponde au message envoyé au WorkflowHostingEndpoint.</span><span class="sxs-lookup"><span data-stu-id="c6d06-132">If you override this method, you must invoke <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> in its body so as to respond to the message sent to the WorkflowHostingEndpoint.</span></span> <span data-ttu-id="c6d06-133">Faute de cela, la limite <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> sera peut-être dépassée.</span><span class="sxs-lookup"><span data-stu-id="c6d06-133">If you do not do so, a <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> limit may be eventually exceeded.</span></span> <span data-ttu-id="c6d06-134">Dans les contrats duplex, vous pouvez détecter votre échec d'appel de <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> car le client ne reçoit pas de réponse.</span><span class="sxs-lookup"><span data-stu-id="c6d06-134">In two-way contracts, you may be able to detect your   failure to invoke <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> because of the client’s failure to receive a response.</span></span> <span data-ttu-id="c6d06-135">Dans les contrats unidirectionnels, vous pouvez ne détecter l'échec de l'appel de <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> qu'une fois qu'il est trop tard, c'est-à-dire après le dépassement de la valeur limite <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A>.</span><span class="sxs-lookup"><span data-stu-id="c6d06-135">In one-way contracts, you may not recognize the mistake of failing to call <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> until it’s too late, after the <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> throttle limit is exceeded.</span></span> <span data-ttu-id="c6d06-136">Pour plus d’informations, consultez le [signet de reprise WorkflowHostingEndpoint](../../windows-workflow-foundation/samples/workflowhostingendpoint-resume-bookmark.md)pour créer une nouvelle instance d’un Workflow sans service, déclarer un contrat de service qui définit une opération qui crée une nouvelle instance.</span><span class="sxs-lookup"><span data-stu-id="c6d06-136">For more information, please see the [WorkflowHostingEndpoint Resume Bookmark](../../windows-workflow-foundation/samples/workflowhostingendpoint-resume-bookmark.md)To create a new instance of a non-service workflow, declare a service contract that defines an operation that creates a new instance.</span></span> <span data-ttu-id="c6d06-137">L’opération de création doit prendre un IDictionary \<string, object> pour passer tous les paramètres de flux de travail requis.</span><span class="sxs-lookup"><span data-stu-id="c6d06-137">The creation operation should take an IDictionary\<string, object> to pass any required workflow parameters.</span></span> <span data-ttu-id="c6d06-138">Ce contrat est implémenté de manière implicite par la classe dérivée de <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>.</span><span class="sxs-lookup"><span data-stu-id="c6d06-138">This contract is implicitly implemented by the <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-derived class.</span></span> <span data-ttu-id="c6d06-139">Lorsque vous hébergez le workflow, ajoutez à l'hôte une instance de la classe dérivée de <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> en appelant la méthode <xref:System.ServiceModel.Activities.WorkflowServiceHost.AddServiceEndpoint%2A>, puis appelez <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A>.</span><span class="sxs-lookup"><span data-stu-id="c6d06-139">When hosting the workflow, add an instance of the <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-derived class to the host by calling <xref:System.ServiceModel.Activities.WorkflowServiceHost.AddServiceEndpoint%2A> and call <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A>.</span></span> <span data-ttu-id="c6d06-140">Pour créer une instance du workflow, créez un objet <xref:System.ServiceModel.ChannelFactory%601> de votre type de contrat de service et appelez <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A>.</span><span class="sxs-lookup"><span data-stu-id="c6d06-140">To create an instance of the workflow, create a <xref:System.ServiceModel.ChannelFactory%601> of your service contract type and call <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A>.</span></span> <span data-ttu-id="c6d06-141">Vous pouvez ensuite appeler l'opération de création définie dans votre contrat de service.</span><span class="sxs-lookup"><span data-stu-id="c6d06-141">You can then call the create operation defined in your service contract.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c6d06-142">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="c6d06-142">See also</span></span>

- [<span data-ttu-id="c6d06-143">Services de workflow</span><span class="sxs-lookup"><span data-stu-id="c6d06-143">Workflow Services</span></span>](workflow-services.md)
- [<span data-ttu-id="c6d06-144">Activités de messagerie</span><span class="sxs-lookup"><span data-stu-id="c6d06-144">Messaging Activities</span></span>](messaging-activities.md)

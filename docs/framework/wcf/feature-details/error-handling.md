---
title: Gestion des erreurs
ms.date: 03/30/2017
ms.assetid: c948841a-7db9-40ae-9b78-587d216cbcaf
ms.openlocfilehash: 9c7d6814a6bf1189fd85de5eb440ec4a6840447e
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/15/2020
ms.locfileid: "90539981"
---
# <a name="error-handling-in-windows-communication-foundation-wcf"></a><span data-ttu-id="c6d42-102">Gestion des erreurs dans les Windows Communication Foundation (WCF)</span><span class="sxs-lookup"><span data-stu-id="c6d42-102">Error handling in Windows Communication Foundation (WCF)</span></span>

<span data-ttu-id="c6d42-103">Lorsqu'un service rencontre une exception ou une erreur inattendue, il existe plusieurs manières de concevoir une solution de gestion des exceptions.</span><span class="sxs-lookup"><span data-stu-id="c6d42-103">When a service encounters an unexpected exception or error, there are multiple ways to design an exception-handling solution.</span></span> <span data-ttu-id="c6d42-104">Bien qu’il n’existe aucune solution de gestion des erreurs « correcte » ou « meilleure pratique », il existe plusieurs chemins valides à prendre en compte.</span><span class="sxs-lookup"><span data-stu-id="c6d42-104">While there is no single "correct" or "best practice" error-handling solution, there are multiple valid paths for one to consider.</span></span> <span data-ttu-id="c6d42-105">Il est généralement recommandé d’implémenter une solution hybride qui associe plusieurs approches de la liste ci-dessous, en fonction de la complexité de l’implémentation WCF, du type et de la fréquence des exceptions, de la nature gérée et non gérée des exceptions, ainsi que des exigences de suivi, de journalisation ou de stratégie associées.</span><span class="sxs-lookup"><span data-stu-id="c6d42-105">It is normally recommended that one implement a hybrid solution that combines multiple approaches from the list below, depending on the complexity of the WCF implementation, the type and frequency of the exceptions, the handled vs. unhandled nature of the exceptions, and any associated tracing, logging, or policy requirements.</span></span>

<span data-ttu-id="c6d42-106">Ces solutions sont expliquées plus en détail dans le reste de cette section.</span><span class="sxs-lookup"><span data-stu-id="c6d42-106">These solutions are explained more deeply in the rest of this section.</span></span>

## <a name="the-microsoft-enterprise-library"></a><span data-ttu-id="c6d42-107">Microsoft Enterprise Library</span><span class="sxs-lookup"><span data-stu-id="c6d42-107">The Microsoft Enterprise Library</span></span>

<span data-ttu-id="c6d42-108">Le bloc d’application de gestion des exceptions Microsoft Enterprise Library permet d’implémenter des modèles communs de conception et de créer une stratégie cohérente de traitement des exceptions qui se produisent dans toutes les couches de l’architecture d’une application d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c6d42-108">The Microsoft Enterprise Library Exception Handling Application Block helps implement common design patterns and create a consistent strategy for processing exceptions that occur in all architectural layers of an enterprise application.</span></span> <span data-ttu-id="c6d42-109">Il est conçu pour prendre en charge le code spécifique contenu dans les instructions catch des composants de l'application.</span><span class="sxs-lookup"><span data-stu-id="c6d42-109">It is designed to support the typical code contained in catch statements in application components.</span></span> <span data-ttu-id="c6d42-110">Au lieu de répéter ce code (par exemple le code qui stocke les informations sur l'exception) dans des blocs catch identiques d'une application, le bloc d'application de gestion des exceptions permet aux développeurs d'encapsuler cette logique comme gestionnaires d'exceptions réutilisables.</span><span class="sxs-lookup"><span data-stu-id="c6d42-110">Instead of repeating this code (such as code that logs exception information) in identical catch blocks throughout an application, the Exception Handling Application Block allows developers to encapsulate this logic as reusable exception handlers.</span></span>

<span data-ttu-id="c6d42-111">Cette bibliothèque comprend un gestionnaire d'exceptions du contrat d'erreur prêt à l'emploi.</span><span class="sxs-lookup"><span data-stu-id="c6d42-111">This Library includes out-of-the-box a Fault Contract Exception Handler.</span></span> <span data-ttu-id="c6d42-112">Ce gestionnaire d’exceptions est conçu pour être utilisé dans les limites de service WCF et génère un nouveau contrat d’erreur à partir de l’exception.</span><span class="sxs-lookup"><span data-stu-id="c6d42-112">This exception handler is designed for use at WCF service boundaries, and generates a new Fault Contract from the exception.</span></span>

<span data-ttu-id="c6d42-113">Les blocs d'application visent à incorporer les meilleures pratiques fréquemment utilisées et à fournir une approche commune pour la gestion des exceptions dans votre application.</span><span class="sxs-lookup"><span data-stu-id="c6d42-113">Application blocks aim to incorporate commonly used best practices and provide a common approach for exception handling throughout your application.</span></span> <span data-ttu-id="c6d42-114">D'autre part, les gestionnaires d'erreurs personnalisés et les contrats d'erreur développés s'avèrent également très utiles.</span><span class="sxs-lookup"><span data-stu-id="c6d42-114">On the other hand, custom error handlers and fault contracts developed on one’s own can also be very useful.</span></span> <span data-ttu-id="c6d42-115">Par exemple, les gestionnaires d'erreurs personnalisés offrent la possibilité de promouvoir automatiquement toutes les exceptions en FaultExceptions et également d'ajouter des fonctions d'enregistrement à votre application.</span><span class="sxs-lookup"><span data-stu-id="c6d42-115">For instance, custom error handlers provide an excellent opportunity to automatically promote all exceptions to FaultExceptions and also to add logging capabilities to your application.</span></span>

<span data-ttu-id="c6d42-116">Pour plus d’informations, consultez [Microsoft Enterprise Library](/previous-versions/msp-n-p/ff632023(v=pandp.10)).</span><span class="sxs-lookup"><span data-stu-id="c6d42-116">For more information, please see [Microsoft Enterprise Library](/previous-versions/msp-n-p/ff632023(v=pandp.10)).</span></span>

## <a name="dealing-with-expected-exceptions"></a><span data-ttu-id="c6d42-117">Traitement des exceptions attendues</span><span class="sxs-lookup"><span data-stu-id="c6d42-117">Dealing with expected exceptions</span></span>

<span data-ttu-id="c6d42-118">La bonne marche à suivre consiste à intercepter les exceptions attendues dans chaque opération ou point d’extensibilité approprié, à déterminer si elles peuvent être récupérées à partir de et à retourner l’erreur personnalisée appropriée dans un FaultException \<T> .</span><span class="sxs-lookup"><span data-stu-id="c6d42-118">The proper course of action is to catch expected exceptions in every operation or relevant extensibility point, decide whether they can be recovered from, and return the proper custom fault in a FaultException\<T>.</span></span>
  
## <a name="dealing-with-unexpected-exceptions-using-an-ierrorhandler"></a><span data-ttu-id="c6d42-119">Traitement des exceptions inattendues à l’aide d’un IErrorHandler</span><span class="sxs-lookup"><span data-stu-id="c6d42-119">Dealing with unexpected exceptions using an IErrorHandler</span></span>

<span data-ttu-id="c6d42-120">Pour traiter les exceptions inattendues, il est recommandé de « raccorder » un IErrorHandler.</span><span class="sxs-lookup"><span data-stu-id="c6d42-120">To deal with unexpected exceptions, the recommended course of action is to "hook" an IErrorHandler.</span></span> <span data-ttu-id="c6d42-121">Les gestionnaires d’erreurs interceptent uniquement les exceptions au niveau du runtime WCF (la couche « modèle de service »), et non au niveau de la couche du canal.</span><span class="sxs-lookup"><span data-stu-id="c6d42-121">Error handlers only catch exceptions at the WCF runtime level (the "service model" layer), not at the channel layer.</span></span> <span data-ttu-id="c6d42-122">La seule manière de connecter un IErrorHandler au niveau de canal consiste à créer un canal personnalisé, ce qui est déconseillé dans la plupart des scénarios.</span><span class="sxs-lookup"><span data-stu-id="c6d42-122">The only way to hook an IErrorHandler at the channel level is to create a custom channel, which is not recommended in most scenarios.</span></span>

<span data-ttu-id="c6d42-123">Une « exception inattendue » n’est généralement ni une exception irrécupérable ni une exception de traitement ; au lieu de cela, il s’agit d’une exception d’utilisateur inattendue.</span><span class="sxs-lookup"><span data-stu-id="c6d42-123">An "unexpected exception" is generally neither an irrecoverable exception nor a processing exception; it is, instead, an unexpected user exception.</span></span> <span data-ttu-id="c6d42-124">Une exception irrécupérable (telle qu’une exception de mémoire insuffisante), généralement gérée automatiquement par le [Gestionnaire d’exceptions de modèle de service](xref:System.ServiceModel.Dispatcher.ExceptionHandler) , ne peut généralement pas être gérée correctement, et la seule raison de gérer une telle exception peut être d’effectuer une journalisation supplémentaire ou de retourner une exception standard au client.</span><span class="sxs-lookup"><span data-stu-id="c6d42-124">An irrecoverable exception (such as an out-of-memory exception) – one generally handled by the [Service Model Exception Handler](xref:System.ServiceModel.Dispatcher.ExceptionHandler) automatically – cannot generally be handled gracefully, and the only reason to handle such an exception at all may be do additional logging or to return a standard exception to the client.</span></span> <span data-ttu-id="c6d42-125">Une exception de traitement se produit dans le traitement du message (par exemple, au niveau de la sérialisation, de l'encodeur ou du formateur), généralement elle ne peut pas être gérée dans un IErrorHandler, car il est trop tôt ou trop tard pour que le gestionnaire d'erreurs intervienne lorsque ces exceptions se produisent.</span><span class="sxs-lookup"><span data-stu-id="c6d42-125">A processing exception occurs in the processing of the message – for example, at the serialization, encoder, or formatter level – generally cannot be handled at an IErrorHandler, because it is generally either too early or too late for the error handler to intervene by the time these exceptions occur.</span></span> <span data-ttu-id="c6d42-126">De même, les exceptions de transport ne peuvent pas être gérées dans un IErrorHandler.</span><span class="sxs-lookup"><span data-stu-id="c6d42-126">Similarly, transport exceptions cannot be handled at an IErrorHandler.</span></span>

<span data-ttu-id="c6d42-127">Avec un IErrorHandler, vous pouvez explicitement contrôler le comportement de votre application lorsqu'une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="c6d42-127">With an IErrorHandler, you can explicitly control the behavior of your application when an exception is thrown.</span></span> <span data-ttu-id="c6d42-128">Ces options sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="c6d42-128">You may:</span></span>  

1. <span data-ttu-id="c6d42-129">Décidez si vous souhaitez envoyer une erreur au client ou non.</span><span class="sxs-lookup"><span data-stu-id="c6d42-129">Decide whether or not to send a fault to the client.</span></span>

2. <span data-ttu-id="c6d42-130">Remplacez une exception par une erreur.</span><span class="sxs-lookup"><span data-stu-id="c6d42-130">Replace an exception with a fault.</span></span>

3. <span data-ttu-id="c6d42-131">Remplacez une erreur par une autre erreur.</span><span class="sxs-lookup"><span data-stu-id="c6d42-131">Replace a fault with another fault.</span></span>

4. <span data-ttu-id="c6d42-132">Effectuez la journalisation ou le suivi.</span><span class="sxs-lookup"><span data-stu-id="c6d42-132">Perform logging or tracing.</span></span>

5. <span data-ttu-id="c6d42-133">Exécuter d’autres activités personnalisées.</span><span class="sxs-lookup"><span data-stu-id="c6d42-133">Perform other custom activities.</span></span>

<span data-ttu-id="c6d42-134">Pour installer un gestionnaire d'erreurs personnalisé, ajoutez-le à la propriété ErrorHandlers des répartiteurs de canal de votre service.</span><span class="sxs-lookup"><span data-stu-id="c6d42-134">One can install a custom error handler by adding it to the ErrorHandlers property of the channel dispatchers for your service.</span></span>  <span data-ttu-id="c6d42-135">Il est possible d’avoir plusieurs gestionnaire d’erreurs et ils sont appelés dans l’ordre où ils sont ajoutés à cette collection.</span><span class="sxs-lookup"><span data-stu-id="c6d42-135">It is possible to have more than one error handler and they are called in the order they are added to this collection.</span></span>

<span data-ttu-id="c6d42-136">IErrorHandler.ProvideFault contrôle le message d'erreur qui est envoyé au client.</span><span class="sxs-lookup"><span data-stu-id="c6d42-136">IErrorHandler.ProvideFault controls the fault message that is sent to the client.</span></span> <span data-ttu-id="c6d42-137">Cette méthode est appelée quel que soit le type de l'exception levée par une opération dans votre service.</span><span class="sxs-lookup"><span data-stu-id="c6d42-137">This method is called regardless of the type of the exception thrown by an operation in your service.</span></span> <span data-ttu-id="c6d42-138">Si aucune opération n’est effectuée ici, WCF utilise son comportement par défaut et continue comme s’il n’existait aucun gestionnaire d’erreurs personnalisé en place.</span><span class="sxs-lookup"><span data-stu-id="c6d42-138">If no operation is performed here, WCF assumes its default behavior and continues as if there were no custom error handlers in place.</span></span>

<span data-ttu-id="c6d42-139">Un domaine dans lequel vous pouvez adopter cette approche est lorsque vous souhaitez créer une place centrale de conversion des exceptions en erreurs avant qu'elles ne soient envoyées au client (en veillant à ce que l'instance ne soit pas supprimée et le canal déplacé vers l'état d'erreur).</span><span class="sxs-lookup"><span data-stu-id="c6d42-139">One area that you could perhaps use this approach is when you want to create a central place for converting exceptions to faults before they are sent to the client (ensuring that the instance is not disposed and the channel is not moved to the Faulted state).</span></span>

<span data-ttu-id="c6d42-140">La méthode IErrorHandler. HandleError est généralement utilisée pour implémenter des comportements liés aux erreurs, tels que la journalisation des erreurs, les notifications système, l’arrêt de l’application, etc. IErrorHandler. HandleError peut être appelé à plusieurs emplacements à l’intérieur du service et, en fonction de l’endroit où l’erreur est levée, la méthode HandleError peut ou non être appelée par le même thread que l’opération. aucune garantie n’est faite à cet égard.</span><span class="sxs-lookup"><span data-stu-id="c6d42-140">The IErrorHandler.HandleError method is usually used to implement error-related behaviors such as error logging, system notifications, shutting down the application, etc. IErrorHandler.HandleError can be called at multiple places inside the service, and depending on where the error is thrown, the HandleError method may or may not be called by the same thread as the operation; no guarantees are made in this regard.</span></span>

## <a name="dealing-with-exceptions-outside-wcf"></a><span data-ttu-id="c6d42-141">Gestion des exceptions en dehors de WCF</span><span class="sxs-lookup"><span data-stu-id="c6d42-141">Dealing with exceptions outside WCF</span></span>

<span data-ttu-id="c6d42-142">Souvent, des exceptions de configuration, des exceptions de chaîne de connexion à la base de données, et d'autres exceptions similaires peuvent se produire dans le contexte d'une application WCF, mais elles ne sont pas des exceptions provoquées par le modèle de service ou le service Web.</span><span class="sxs-lookup"><span data-stu-id="c6d42-142">Often, configuration exceptions, database connection string exceptions, and other similar exceptions may occur within the context of a WCF application, but are themselves are not exceptions caused by the service model or the web service itself.</span></span> <span data-ttu-id="c6d42-143">Ces exceptions sont des exceptions « normales » externes au service Web et doivent être traitées de la même façon que les autres exceptions externes de l’environnement doivent être gérées.</span><span class="sxs-lookup"><span data-stu-id="c6d42-143">These exceptions are "regular" exceptions external to the web service, and should be handled just as other external exceptions in the environment are to be handled.</span></span>

## <a name="tracing-exceptions"></a><span data-ttu-id="c6d42-144">Suivi d'exceptions</span><span class="sxs-lookup"><span data-stu-id="c6d42-144">Tracing exceptions</span></span>

<span data-ttu-id="c6d42-145">Le suivi est le seul emplacement « Catch-All » dans lequel il est possible de voir toutes les exceptions.</span><span class="sxs-lookup"><span data-stu-id="c6d42-145">Tracing is the only "catch-all" place where one can potentially see all exceptions.</span></span> <span data-ttu-id="c6d42-146">Pour plus d'informations sur le suivi et l'enregistrement des exceptions, consultez Suivi et enregistrement.</span><span class="sxs-lookup"><span data-stu-id="c6d42-146">For more information on tracing and logging exceptions, see Tracing and Logging.</span></span>

## <a name="uri-template-errors-when-using-webgetattribute-and-webinvokeattribute"></a><span data-ttu-id="c6d42-147">Erreurs de modèle d'URI lors de l'utilisation de WebGetAttribute et WebInvokeAttribute</span><span class="sxs-lookup"><span data-stu-id="c6d42-147">URI template errors when using WebGetAttribute and WebInvokeAttribute</span></span>

<span data-ttu-id="c6d42-148">Les attributs WebGet et WebInvoke vous permettent de spécifier un modèle d'URI qui mappe les composants de l'adresse de requête aux paramètres d'opération.</span><span class="sxs-lookup"><span data-stu-id="c6d42-148">The WebGet and WebInvoke attributes allow you to specify a URI template that maps components of the request address to operation parameters.</span></span> <span data-ttu-id="c6d42-149">Par exemple, le modèle d'URI « weather/{state}/{city} » mappe l'adresse de requête dans les jetons de littéraux, un état de paramètre nommé et un paramètre nommé city.</span><span class="sxs-lookup"><span data-stu-id="c6d42-149">For example, the URI template "weather/{state}/{city}" maps the request address into literal tokens, a parameter named state, and a parameter named city.</span></span> <span data-ttu-id="c6d42-150">Ces paramètres peuvent être liés par nom à certains des paramètres formels de l'opération.</span><span class="sxs-lookup"><span data-stu-id="c6d42-150">These parameters might then be bound by name to some of the formal parameters of the operation.</span></span>

<span data-ttu-id="c6d42-151">Les paramètres de modèle s'affichent au format de chaînes dans l'URI et les paramètres formels d'un contrat typé peuvent être des types non-chaînes.</span><span class="sxs-lookup"><span data-stu-id="c6d42-151">The template parameters appear in the form of strings within the URI while the formal parameters of a typed contract might be of non-string types.</span></span> <span data-ttu-id="c6d42-152">Par conséquent, une conversion doit avoir lieu avant que l'opération puisse être appelée.</span><span class="sxs-lookup"><span data-stu-id="c6d42-152">Therefore, a conversion needs to take place before the operation can be invoked.</span></span> <span data-ttu-id="c6d42-153">Un [tableau de formats de conversion](wcf-web-http-programming-model-overview.md) est disponible.</span><span class="sxs-lookup"><span data-stu-id="c6d42-153">A [table of conversion formats](wcf-web-http-programming-model-overview.md) is available.</span></span>

<span data-ttu-id="c6d42-154">Cependant, si la conversion échoue, il n'existe aucun moyen d'indiquer à l'opération qu'une erreur s'est produite.</span><span class="sxs-lookup"><span data-stu-id="c6d42-154">However, if the conversion fails, then there's no way to let the operation know that something has gone wrong.</span></span> <span data-ttu-id="c6d42-155">Conversion de type plutôt que de surfaces sous la forme d'un échec de distribution.</span><span class="sxs-lookup"><span data-stu-id="c6d42-155">The type conversion instead surfaces in the form of a dispatch failure.</span></span>

<span data-ttu-id="c6d42-156">Une erreur de distribution de conversion de type peut être inspectée de la même façon que d'autres types d'erreurs de distribution en installant un gestionnaire d'erreurs.</span><span class="sxs-lookup"><span data-stu-id="c6d42-156">A type conversion dispatch failure can be inspected the same as with many other types of dispatch failures by installing an error handler.</span></span> <span data-ttu-id="c6d42-157">Le point d'extensibilité d'IErrorHandler est appelé pour gérer les exceptions au niveau de service.</span><span class="sxs-lookup"><span data-stu-id="c6d42-157">The IErrorHandler extensibility point is called to handle service-level exceptions.</span></span> <span data-ttu-id="c6d42-158">À partir de là, choisissez la réponse à renvoyer à l’appelant, et effectuez des tâches et des rapports personnalisés.</span><span class="sxs-lookup"><span data-stu-id="c6d42-158">From there, the response to be sent back to the caller – as well as perform any custom tasks and reporting – may be chosen.</span></span>

## <a name="see-also"></a><span data-ttu-id="c6d42-159">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="c6d42-159">See also</span></span>

- [<span data-ttu-id="c6d42-160">Programmation WCF de base</span><span class="sxs-lookup"><span data-stu-id="c6d42-160">Basic WCF Programming</span></span>](../basic-wcf-programming.md)

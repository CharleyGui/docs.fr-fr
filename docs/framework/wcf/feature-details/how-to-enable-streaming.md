---
title: 'Procédure : activer le streaming'
description: Découvrez comment activer les messages diffusés en continu dans WCF plutôt que les transferts mis en mémoire tampon par défaut, qui doivent être complètement reçus avant d’être traités.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 6ca2cf4b-c7a1-49d8-a79b-843a90556ba4
ms.openlocfilehash: 7f77c406e1cfd4def116a1abe24aa92be74c6abe
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/26/2020
ms.locfileid: "96237740"
---
# <a name="how-to-enable-streaming"></a><span data-ttu-id="41f9b-103">Procédure : activer le streaming</span><span class="sxs-lookup"><span data-stu-id="41f9b-103">How to: Enable Streaming</span></span>

<span data-ttu-id="41f9b-104">Windows Communication Foundation (WCF) peut envoyer des messages à l’aide de transferts mis en mémoire tampon ou en continu.</span><span class="sxs-lookup"><span data-stu-id="41f9b-104">Windows Communication Foundation (WCF) can send messages using either buffered or streamed transfers.</span></span> <span data-ttu-id="41f9b-105">En mode de transfert par mise en mémoire tampon, un message doit être complètement remis avant qu'un récepteur puisse le lire.</span><span class="sxs-lookup"><span data-stu-id="41f9b-105">In the default buffered-transfer mode, a message must be completely delivered before a receiver can read it.</span></span> <span data-ttu-id="41f9b-106">En mode de transfert par diffusion en continu, le récepteur peut commencer à traiter le message avant qu'il ne soit complètement remis.</span><span class="sxs-lookup"><span data-stu-id="41f9b-106">In streaming transfer mode, the receiver can begin to process the message before it is completely delivered.</span></span> <span data-ttu-id="41f9b-107">Le mode de diffusion en continu est utile lorsque les informations passées sont volumineuses et peuvent être traitées en série.</span><span class="sxs-lookup"><span data-stu-id="41f9b-107">The streaming mode is useful when the information that is passed is lengthy and can be processed serially.</span></span> <span data-ttu-id="41f9b-108">Le mode de diffusion en continu est également utile lorsque le message est trop volumineux pour être mis entièrement en mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="41f9b-108">Streaming mode is also useful when the message is too large to be entirely buffered.</span></span>  
  
 <span data-ttu-id="41f9b-109">Pour activer la diffusion en continu, définissez le `OperationContract` convenablement et activez la diffusion en continu au niveau du transport.</span><span class="sxs-lookup"><span data-stu-id="41f9b-109">To enable streaming, define the `OperationContract` appropriately and enable streaming at the transport level.</span></span>  
  
### <a name="to-stream-data"></a><span data-ttu-id="41f9b-110">Pour transmettre des données en continu</span><span class="sxs-lookup"><span data-stu-id="41f9b-110">To stream data</span></span>  
  
1. <span data-ttu-id="41f9b-111">Pour transmettre des données en continu le `OperationContract` du service doit satisfaire deux spécifications :</span><span class="sxs-lookup"><span data-stu-id="41f9b-111">To stream data, the `OperationContract` for the service must satisfy two requirements:</span></span>  
  
    1. <span data-ttu-id="41f9b-112">Le paramètre qui gère les données diffusées en continu doit être le seul paramètre dans la méthode.</span><span class="sxs-lookup"><span data-stu-id="41f9b-112">The parameter that holds the data to be streamed must be the only parameter in the method.</span></span> <span data-ttu-id="41f9b-113">Par exemple, si le message d'entrée est celui à diffuser en continu, l'opération ne doit avoir qu'un seul paramètre d'entrée.</span><span class="sxs-lookup"><span data-stu-id="41f9b-113">For example, if the input message is the one to be streamed, the operation must have exactly one input parameter.</span></span> <span data-ttu-id="41f9b-114">De la même façon, si le message de sortie doit être diffusé en continu, l'opération ne doit avoir qu'un seul paramètre de sortie ou qu'une seule valeur de retour.</span><span class="sxs-lookup"><span data-stu-id="41f9b-114">Similarly, if the output message is to be streamed, the operation must have either exactly one output parameter or a return value.</span></span>  
  
    2. <span data-ttu-id="41f9b-115">Au moins l'un des types de paramètre et de valeur de retour doit être <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message>ou <xref:System.Xml.Serialization.IXmlSerializable>.</span><span class="sxs-lookup"><span data-stu-id="41f9b-115">At least one of the types of the parameter and return value must be either <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message>, or <xref:System.Xml.Serialization.IXmlSerializable>.</span></span>  
  
     <span data-ttu-id="41f9b-116">Ce qui suit est un exemple de contrat de diffusion des données en continu.</span><span class="sxs-lookup"><span data-stu-id="41f9b-116">The following is an example of a contract for streamed data.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#1)]
     [!code-vb[c_HowTo_EnableStreaming#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#1)]  
  
     <span data-ttu-id="41f9b-117">L'opération `GetStream` reçoit des données d'entrée mises en mémoire tampon sous la forme d'une chaîne (`string`) mise en mémoire tampon et retourne `Stream`, soit des données diffusées en continu.</span><span class="sxs-lookup"><span data-stu-id="41f9b-117">The `GetStream` operation receives some buffered input data as a `string`, which is buffered, and returns a `Stream`, which is streamed.</span></span> <span data-ttu-id="41f9b-118">Inversement, `UploadStream` utilise `Stream` (transmis en continu) et retourne `bool` (mis en mémoire tampon).</span><span class="sxs-lookup"><span data-stu-id="41f9b-118">Conversely `UploadStream` takes in a `Stream` (streamed) and returns a `bool` (buffered).</span></span> <span data-ttu-id="41f9b-119">`EchoStream` prend et retourne `Stream` et constitue un exemple d'opération dont les messages d'entrée et de sortie sont tous deux diffusés en continu.</span><span class="sxs-lookup"><span data-stu-id="41f9b-119">`EchoStream` takes and returns `Stream` and is an example of an operation whose input and output messages are both streamed.</span></span> <span data-ttu-id="41f9b-120">Enfin, `GetReversedStream` ne prend pas d'entrée et retourne `Stream` (diffusion en continu).</span><span class="sxs-lookup"><span data-stu-id="41f9b-120">Finally, `GetReversedStream` takes no inputs and returns a `Stream` (streamed).</span></span>  
  
2. <span data-ttu-id="41f9b-121">La diffusion en continu doit être activée sur la liaison.</span><span class="sxs-lookup"><span data-stu-id="41f9b-121">Streaming must be enabled on the binding.</span></span> <span data-ttu-id="41f9b-122">Affectez à une propriété `TransferMode` l'une des valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="41f9b-122">You set a `TransferMode` property, which can take one of the following values:</span></span>  
  
    1. <span data-ttu-id="41f9b-123">`Buffered`,</span><span class="sxs-lookup"><span data-stu-id="41f9b-123">`Buffered`,</span></span>  
  
    2. <span data-ttu-id="41f9b-124">`Streamed`, qui active la communication par diffusion en continu dans les deux directions.</span><span class="sxs-lookup"><span data-stu-id="41f9b-124">`Streamed`, which enables streaming communication in both directions.</span></span>  
  
    3. <span data-ttu-id="41f9b-125">`StreamedRequest`, qui active la diffusion en continu de la demande uniquement.</span><span class="sxs-lookup"><span data-stu-id="41f9b-125">`StreamedRequest`, which enables streaming the request only.</span></span>  
  
    4. <span data-ttu-id="41f9b-126">`StreamedResponse`, qui active la diffusion en continu de la réponse uniquement.</span><span class="sxs-lookup"><span data-stu-id="41f9b-126">`StreamedResponse`, which enables streaming the response only.</span></span>  
  
     <span data-ttu-id="41f9b-127">La `BasicHttpBinding` expose la propriété `TransferMode` sur la liaison, tout comme `NetTcpBinding` et `NetNamedPipeBinding`.</span><span class="sxs-lookup"><span data-stu-id="41f9b-127">The `BasicHttpBinding` exposes the `TransferMode` property on the binding, as does `NetTcpBinding` and `NetNamedPipeBinding`.</span></span> <span data-ttu-id="41f9b-128">La propriété `TransferMode` peut également être définie sur l’élément de liaison de transport et utilisée dans une liaison personnalisée.</span><span class="sxs-lookup"><span data-stu-id="41f9b-128">The `TransferMode` property can also be set on the transport binding element and used in a custom binding.</span></span>  
  
     <span data-ttu-id="41f9b-129">Les exemples suivants indiquent comment définir le `TransferMode` par code et en modifiant le fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="41f9b-129">The following samples show how to set `TransferMode` by code and by changing the configuration file.</span></span> <span data-ttu-id="41f9b-130">Les exemples attribuent également à la propriété `maxReceivedMessageSize` la valeur 64 Mo, qui limite la taille maximale autorisée des messages en réception.</span><span class="sxs-lookup"><span data-stu-id="41f9b-130">The samples also both set the `maxReceivedMessageSize` property to 64 MB, which places a cap on the maximum allowable size of messages on receive.</span></span> <span data-ttu-id="41f9b-131">La valeur par défaut de `maxReceivedMessageSize` est 64 Ko, ce qui est habituellement trop bas pour les scénarios de diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="41f9b-131">The default `maxReceivedMessageSize` is 64 KB, which is usually too low for streaming scenarios.</span></span> <span data-ttu-id="41f9b-132">Définissez ce paramètre de quota correctement selon la taille maximale des messages que votre application est susceptible de recevoir.</span><span class="sxs-lookup"><span data-stu-id="41f9b-132">Set this quota setting as appropriate depending on the maximum size of messages your application expects to receive.</span></span> <span data-ttu-id="41f9b-133">Notez également que la `maxBufferSize` contrôle la taille maximale mise en mémoire tampon ; il convient de définir convenablement cette valeur.</span><span class="sxs-lookup"><span data-stu-id="41f9b-133">Also note that `maxBufferSize` controls the maximum size that is buffered, and set it appropriately.</span></span>  
  
    1. <span data-ttu-id="41f9b-134">L’extrait de code de configuration suivant tiré de l’exemple présente l’affectation du mode de diffusion en continu à la propriété `TransferMode` sur la `basicHttpBinding` et sur une liaison HTTP personnalisée.</span><span class="sxs-lookup"><span data-stu-id="41f9b-134">The following configuration snippet from the sample shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-xml[c_HowTo_EnableStreaming#103](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/common/app.config#103)]
  
    2. <span data-ttu-id="41f9b-135">L'extrait de code suivant affiche l'affectation à la propriété `TransferMode` la diffusion en continu sur la `basicHttpBinding` et sur une liaison HTTP personnalisée.</span><span class="sxs-lookup"><span data-stu-id="41f9b-135">The following code snippet shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#2)]
         [!code-vb[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#2)]  
  
    3. <span data-ttu-id="41f9b-136">L’extrait de code suivant affiche l’affectation à la propriété `TransferMode` de la diffusion en continu une liaison TCP personnalisée.</span><span class="sxs-lookup"><span data-stu-id="41f9b-136">The following code snippet shows setting the `TransferMode` property to streaming on a custom TCP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#3)]
         [!code-vb[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#3)]  
  
3. <span data-ttu-id="41f9b-137">Les opérations `GetStream`, `UploadStream` et `EchoStream` concernent toutes l'envoi de données directement à partir d'un fichier ou l'enregistrement des données reçues directement dans un fichier.</span><span class="sxs-lookup"><span data-stu-id="41f9b-137">The operations `GetStream`, `UploadStream`, and `EchoStream` all deal with sending data directly from a file or saving received data directly to a file.</span></span> <span data-ttu-id="41f9b-138">Le code suivant concerne `GetStream`.</span><span class="sxs-lookup"><span data-stu-id="41f9b-138">The following code is for `GetStream`.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#4)]
     [!code-vb[c_HowTo_EnableStreaming#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#4)]  
  
### <a name="writing-a-custom-stream"></a><span data-ttu-id="41f9b-139">Écriture d'un flux personnalisé</span><span class="sxs-lookup"><span data-stu-id="41f9b-139">Writing a custom stream</span></span>  
  
1. <span data-ttu-id="41f9b-140">Pour effectuer un traitement spécial sur chaque bloc d'un flux alors qu'il est envoyé ou reçu, dérivez une classe de flux personnalisé de <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="41f9b-140">To do special processing on each chunk of a data stream as it is being sent or received, derive a custom stream class from <xref:System.IO.Stream>.</span></span> <span data-ttu-id="41f9b-141">Pour donner un exemple d'un flux personnalisé, le code suivant contient une méthode `GetReversedStream` et une classe `ReverseStream`-.</span><span class="sxs-lookup"><span data-stu-id="41f9b-141">As an example of a custom stream, the following code contains a `GetReversedStream` method and a `ReverseStream` class-.</span></span>  
  
     <span data-ttu-id="41f9b-142">`GetReversedStream` crée et retourne une nouvelle instance de `ReverseStream`.</span><span class="sxs-lookup"><span data-stu-id="41f9b-142">`GetReversedStream` creates and returns a new instance of `ReverseStream`.</span></span> <span data-ttu-id="41f9b-143">Le traitement réel se produit lorsque le système lit l'objet `ReverseStream`.</span><span class="sxs-lookup"><span data-stu-id="41f9b-143">The actual processing happens as the system reads from the `ReverseStream` object.</span></span> <span data-ttu-id="41f9b-144">La méthode `ReverseStream.Read` lit un bloc d'octets du fichier sous-jacent, les inverse, puis retourne les octets inversés.</span><span class="sxs-lookup"><span data-stu-id="41f9b-144">The `ReverseStream.Read` method reads a chunk of bytes from the underlying file, reverses them, then returns the reversed bytes.</span></span> <span data-ttu-id="41f9b-145">Cette méthode n'inverse pas l'ensemble du contenu du fichier, mais uniquement un bloc d'octets à la fois.</span><span class="sxs-lookup"><span data-stu-id="41f9b-145">This method does not reverse the entire file content; it reverses one chunk of bytes at a time.</span></span> <span data-ttu-id="41f9b-146">Cet exemple montre comment vous pouvez traiter un flux pendant que le contenu est lu ou écrit à partir du flux.</span><span class="sxs-lookup"><span data-stu-id="41f9b-146">This example shows how you can perform stream processing as the content is being read to or written from the stream.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#2)]
     [!code-vb[c_HowTo_EnableStreaming#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#2)]  
  
## <a name="see-also"></a><span data-ttu-id="41f9b-147">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="41f9b-147">See also</span></span>

- [<span data-ttu-id="41f9b-148">Données volumineuses et diffusion en continu</span><span class="sxs-lookup"><span data-stu-id="41f9b-148">Large Data and Streaming</span></span>](large-data-and-streaming.md)
- [<span data-ttu-id="41f9b-149">STREAM</span><span class="sxs-lookup"><span data-stu-id="41f9b-149">Stream</span></span>](../samples/stream.md)

---
title: Définition et spécification des erreurs
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- handling faults [WCF], specifying
- handling faults [WCF], defining
ms.assetid: c00c84f1-962d-46a7-b07f-ebc4f80fbfc1
ms.openlocfilehash: 67096c4531d13bc66f584c09c458c0a5a2a41c6b
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/26/2020
ms.locfileid: "96260901"
---
# <a name="defining-and-specifying-faults"></a><span data-ttu-id="76a4d-102">Définition et spécification des erreurs</span><span class="sxs-lookup"><span data-stu-id="76a4d-102">Defining and Specifying Faults</span></span>

<span data-ttu-id="76a4d-103">Les erreurs SOAP acheminent des informations de condition d'erreur d'un service à un client et, dans le cas duplex, d'un client à un service d'une manière interopérable.</span><span class="sxs-lookup"><span data-stu-id="76a4d-103">SOAP faults convey error condition information from a service to a client and, in the duplex case, from a client to a service in an interoperable way.</span></span> <span data-ttu-id="76a4d-104">Cette rubrique explique quand et comment définir le contenu d'erreur personnalisé et spécifier quelles opérations peuvent les retourner.</span><span class="sxs-lookup"><span data-stu-id="76a4d-104">This topic discusses when and how to define custom fault content and specify which operations can return them.</span></span> <span data-ttu-id="76a4d-105">Pour plus d’informations sur la façon dont un service ou un client duplex peut envoyer ces erreurs et comment un client ou une application de service gère ces erreurs, consultez [envoi et réception d’erreurs](sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="76a4d-105">For more information about how a service, or duplex client, can send those faults and how a client or service application handles these faults, see [Sending and Receiving Faults](sending-and-receiving-faults.md).</span></span> <span data-ttu-id="76a4d-106">Pour obtenir une vue d’ensemble de la gestion des erreurs dans les applications Windows Communication Foundation (WCF), consultez [spécification et gestion des erreurs dans les contrats et les services](specifying-and-handling-faults-in-contracts-and-services.md).</span><span class="sxs-lookup"><span data-stu-id="76a4d-106">For an overview of error handling in Windows Communication Foundation (WCF) applications, see [Specifying and Handling Faults in Contracts and Services](specifying-and-handling-faults-in-contracts-and-services.md).</span></span>  
  
## <a name="overview"></a><span data-ttu-id="76a4d-107">Vue d'ensemble</span><span class="sxs-lookup"><span data-stu-id="76a4d-107">Overview</span></span>  

 <span data-ttu-id="76a4d-108">Les erreurs SOAP déclarées sont celles dans lesquelles une opération contient un <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> qui spécifie un type d'erreur SOAP personnalisé.</span><span class="sxs-lookup"><span data-stu-id="76a4d-108">Declared SOAP faults are those in which an operation has a <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> that specifies a custom SOAP fault type.</span></span> <span data-ttu-id="76a4d-109">Les erreurs SOAP non déclarées sont celles qui ne sont pas spécifiées dans le contrat d'une opération.</span><span class="sxs-lookup"><span data-stu-id="76a4d-109">Undeclared SOAP faults are those that are not specified in the contract for an operation.</span></span> <span data-ttu-id="76a4d-110">Cette rubrique vous permet d'identifier ces conditions d'erreur et crée un contrat d'erreur pour votre service que les clients peuvent utiliser pour traiter correctement ces conditions d'erreur lorsqu'elles sont notifiées par des erreurs SOAP personnalisées.</span><span class="sxs-lookup"><span data-stu-id="76a4d-110">This topic helps you identify those error conditions and create a fault contract for your service that clients can use to properly handle those error conditions when notified by custom SOAP faults.</span></span> <span data-ttu-id="76a4d-111">Les tâches de base sont, dans l’ordre :</span><span class="sxs-lookup"><span data-stu-id="76a4d-111">The basic tasks are, in order:</span></span>  
  
1. <span data-ttu-id="76a4d-112">Définir les conditions d'erreur qu'un client de votre service doit connaître.</span><span class="sxs-lookup"><span data-stu-id="76a4d-112">Define the error conditions that a client of your service should know about.</span></span>  
  
2. <span data-ttu-id="76a4d-113">Définir le contenu personnalisé des erreurs SOAP pour ces conditions d'erreur.</span><span class="sxs-lookup"><span data-stu-id="76a4d-113">Define the custom content of the SOAP faults for those error conditions.</span></span>  
  
3. <span data-ttu-id="76a4d-114">Marquer vos opérations afin que les erreurs SOAP spécifiques qu'elles génèrent soient exposées aux clients dans WSDL.</span><span class="sxs-lookup"><span data-stu-id="76a4d-114">Mark your operations so that the specific SOAP faults that they throw are exposed to clients in WSDL.</span></span>  
  
### <a name="defining-error-conditions-that-clients-should-know-about"></a><span data-ttu-id="76a4d-115">Définition des conditions d'erreur que les clients doivent connaître</span><span class="sxs-lookup"><span data-stu-id="76a4d-115">Defining Error Conditions That Clients Should Know About</span></span>  

 <span data-ttu-id="76a4d-116">Les erreurs SOAP sont des messages décrits publiquement qui contiennent des informations d'erreur pour une opération particulière.</span><span class="sxs-lookup"><span data-stu-id="76a4d-116">SOAP faults are publicly described messages that carry fault information for a particular operation.</span></span> <span data-ttu-id="76a4d-117">Comme elles sont décrites avec d'autres messages d'opération dans WSDL, les clients savent et, par conséquent, s'attendent à gérer ces erreurs lors de l'appel d'une opération.</span><span class="sxs-lookup"><span data-stu-id="76a4d-117">Because they are described along with other operation messages in WSDL, clients know and, therefore, expect to handle such faults when invoking an operation.</span></span> <span data-ttu-id="76a4d-118">Toutefois, étant donné que les services WCF sont écrits en code managé, le choix des conditions d’erreur dans le code managé qui doivent être converties en erreurs et retournées au client vous permet de séparer les conditions d’erreur et les bogues dans votre service de la conversation d’erreur formelle que vous avez avec un client.</span><span class="sxs-lookup"><span data-stu-id="76a4d-118">But because WCF services are written in managed code, deciding which error conditions in managed code are to be converted into faults and returned to the client provides you the opportunity to separate error conditions and bugs in your service from the formal error conversation you have with a client.</span></span>  
  
 <span data-ttu-id="76a4d-119">Par exemple, l'exemple de code suivant affiche une opération qui accepte deux entiers et retourne un autre entier.</span><span class="sxs-lookup"><span data-stu-id="76a4d-119">For example, the following code example shows an operation that takes two integers and returns another integer.</span></span> <span data-ttu-id="76a4d-120">Plusieurs exceptions peuvent être levées dans ce contexte, donc lorsque vous concevez le contrat d'erreur, vous devez déterminer quelles conditions d'erreur sont importantes pour votre client.</span><span class="sxs-lookup"><span data-stu-id="76a4d-120">Several exceptions can be thrown here, so when designing the fault contract, you must determine which error conditions are important for your client.</span></span> <span data-ttu-id="76a4d-121">Dans ce cas, le service doit détecter l'exception <xref:System.DivideByZeroException?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="76a4d-121">In this case, the service should detect the <xref:System.DivideByZeroException?displayProperty=nameWithType> exception.</span></span>  
  
```csharp  
[ServiceContract]  
public class CalculatorService  
{  
    [OperationContract]
    int Divide(int a, int b)  
    {  
      if (b==0) throw new Exception("Division by zero!");  
      return a/b;  
    }  
}  
```  
  
```vb
<ServiceContract> _
Public Class CalculatorService
    <OperationContract> _
    Public Function Divide(a As Integer, b As Integer) As Integer
        If b = 0 Then Throw New DivideByZeroException("Division by zero!")
        Return a / b
    End Function
End Class
```
  
 <span data-ttu-id="76a4d-122">Dans l'exemple précédent, l'opération retourne une erreur SOAP personnalisée qui est spécifique à une division par zéro, une erreur personnalisée qui est spécifique aux opérations de mathématique mais qui contient des informations spécifiques à une division par zéro, des erreurs multiples pour plusieurs situations d'erreur différentes ou aucune erreur SOAP.</span><span class="sxs-lookup"><span data-stu-id="76a4d-122">In the preceding example the operation can either return a custom SOAP fault that is specific to dividing by zero, a custom fault that is specific to math operations but that contains information specific to dividing by zero, multiple faults for several different error situations, or no SOAP fault at all.</span></span>  
  
### <a name="define-the-content-of-error-conditions"></a><span data-ttu-id="76a4d-123">Définir le contenu des conditions d'erreur</span><span class="sxs-lookup"><span data-stu-id="76a4d-123">Define the Content of Error Conditions</span></span>  

 <span data-ttu-id="76a4d-124">Une fois qu'une condition d'erreur a été identifiée comme une condition qui peut retourner de façon utile une erreur SOAP personnalisée, l'étape suivante consiste à définir le contenu de cette erreur et garantir que la structure de contenu peut être sérialisée.</span><span class="sxs-lookup"><span data-stu-id="76a4d-124">Once an error condition has been identified as one that can usefully return a custom SOAP fault, the next step is to define the contents of that fault and ensure that the content structure can be serialized.</span></span> <span data-ttu-id="76a4d-125">L'exemple de code dans la section précédente affiche une erreur spécifique à une opération `Divide`, mais s'il y a d'autres opérations sur le service `Calculator`, une erreur SOAP personnalisée unique peut informer le client de toutes les conditions d'erreur de calculatrice, y compris `Divide`.</span><span class="sxs-lookup"><span data-stu-id="76a4d-125">The code example in the preceding section shows an error specific to a `Divide` operation, but if there are other operations on the `Calculator` service, then a single custom SOAP fault can inform the client of all calculator error conditions, `Divide` included.</span></span> <span data-ttu-id="76a4d-126">L'exemple de code suivant affiche la création d'une erreur SOAP personnalisée, `MathFault`, qui peut signaler des erreurs faites à l'aide de toutes les opérations mathématique, y compris `Divide`.</span><span class="sxs-lookup"><span data-stu-id="76a4d-126">The following code example shows the creation of a custom SOAP fault, `MathFault`, which can report errors made using all math operations, including `Divide`.</span></span> <span data-ttu-id="76a4d-127">Si la classe peut spécifier une opération (la propriété `Operation`) et une valeur qui décrit le problème (la propriété `ProblemType`), la classe et ces propriétés doivent être sérialisables pour être transférées au client dans une erreur SOAP personnalisée.</span><span class="sxs-lookup"><span data-stu-id="76a4d-127">While the class can specify an operation (the `Operation` property) and a value that describes the problem (the `ProblemType` property), the class and these properties must be serializable to be transferred to the client in a custom SOAP fault.</span></span> <span data-ttu-id="76a4d-128">Par conséquent, les attributs <xref:System.Runtime.Serialization.DataContractAttribute?displayProperty=nameWithType> et <xref:System.Runtime.Serialization.DataMemberAttribute?displayProperty=nameWithType> sont utilisés pour rendre le type et ses propriétés sérialisables et aussi interopérables que possible.</span><span class="sxs-lookup"><span data-stu-id="76a4d-128">Therefore, the <xref:System.Runtime.Serialization.DataContractAttribute?displayProperty=nameWithType> and <xref:System.Runtime.Serialization.DataMemberAttribute?displayProperty=nameWithType> attributes are used to make the type and its properties serializable and as interoperable as possible.</span></span>  
  
 [!code-csharp[Faults#2](../../../samples/snippets/csharp/VS_Snippets_CFX/faults/cs/service.cs#2)]
 [!code-vb[Faults#2](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faults/vb/service.vb#2)]  
  
 <span data-ttu-id="76a4d-129">Pour plus d’informations sur la façon de garantir que vos données sont sérialisables, consultez [spécification de transfert de données dans les contrats de service](./feature-details/specifying-data-transfer-in-service-contracts.md).</span><span class="sxs-lookup"><span data-stu-id="76a4d-129">For more information about how to ensure your data is serializable, see [Specifying Data Transfer in Service Contracts](./feature-details/specifying-data-transfer-in-service-contracts.md).</span></span> <span data-ttu-id="76a4d-130">Pour obtenir la liste de la prise en charge de la sérialisation <xref:System.Runtime.Serialization.DataContractSerializer?displayProperty=nameWithType> fournie par, consultez [types pris en charge par le sérialiseur de contrat de données](./feature-details/types-supported-by-the-data-contract-serializer.md).</span><span class="sxs-lookup"><span data-stu-id="76a4d-130">For a list of the serialization support that <xref:System.Runtime.Serialization.DataContractSerializer?displayProperty=nameWithType> provides, see [Types Supported by the Data Contract Serializer](./feature-details/types-supported-by-the-data-contract-serializer.md).</span></span>  
  
### <a name="mark-operations-to-establish-the-fault-contract"></a><span data-ttu-id="76a4d-131">Marquer des opérations pour établir le contrat d'erreur</span><span class="sxs-lookup"><span data-stu-id="76a4d-131">Mark Operations to Establish the Fault Contract</span></span>  

 <span data-ttu-id="76a4d-132">Une fois qu'une structure de données sérialisable retournée dans le cadre d'une erreur SOAP personnalisée est définie, la dernière étape consiste à marquer votre contrat d'opération comme ayant retourné une erreur SOAP de ce type.</span><span class="sxs-lookup"><span data-stu-id="76a4d-132">Once a serializable data structure that is returned as part of a custom SOAP fault is defined, the last step is to mark your operation contract as throwing a SOAP fault of that type.</span></span> <span data-ttu-id="76a4d-133">Pour cela, utilisez l'attribut <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> et passez le type du type de données personnalisé que vous avez construit.</span><span class="sxs-lookup"><span data-stu-id="76a4d-133">To do this, use the <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> attribute and pass the type of the custom data type that you have constructed.</span></span> <span data-ttu-id="76a4d-134">L'exemple de code suivant montre comment utiliser l'attribut <xref:System.ServiceModel.FaultContractAttribute> pour spécifier que l'opération `Divide` peut retourner une erreur SOAP de type `MathFault`.</span><span class="sxs-lookup"><span data-stu-id="76a4d-134">The following code example shows how to use the <xref:System.ServiceModel.FaultContractAttribute> attribute to specify that the `Divide` operation can return a SOAP fault of type `MathFault`.</span></span> <span data-ttu-id="76a4d-135">D'autres opérations de mathématique peuvent désormais aussi spécifier qu'elles peuvent retourner une `MathFault`.</span><span class="sxs-lookup"><span data-stu-id="76a4d-135">Other math-based operations can now also specify that they can return a `MathFault`.</span></span>  
  
 [!code-csharp[Faults#1](../../../samples/snippets/csharp/VS_Snippets_CFX/faults/cs/service.cs#1)]
 [!code-vb[Faults#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faults/vb/service.vb#1)]  
  
 <span data-ttu-id="76a4d-136">Une opération peut spécifier qu'elle retourne plusieurs erreurs personnalisées en marquant cette opération avec plusieurs attributs <xref:System.ServiceModel.FaultContractAttribute>.</span><span class="sxs-lookup"><span data-stu-id="76a4d-136">An operation can specify that it returns more than one custom fault by marking that operation with more than one <xref:System.ServiceModel.FaultContractAttribute> attribute.</span></span>  
  
 <span data-ttu-id="76a4d-137">L’étape suivante, pour implémenter le contrat d’erreur dans votre implémentation d’opération, est décrite dans la rubrique [envoi et réception d’erreurs](sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="76a4d-137">The next step, to implement the fault contract in your operation implementation, is described in the topic [Sending and Receiving Faults](sending-and-receiving-faults.md).</span></span>  
  
#### <a name="soap-wsdl-and-interoperability-considerations"></a><span data-ttu-id="76a4d-138">Considérations sur SOAP, WSDL et l'interopérabilité</span><span class="sxs-lookup"><span data-stu-id="76a4d-138">SOAP, WSDL, and Interoperability Considerations</span></span>  

 <span data-ttu-id="76a4d-139">Dans certaines circonstances, en particulier lors de l'interaction avec d'autres plateformes, il peut être important de contrôler la manière dont se manifeste une erreur dans un message SOAP ou sa description dans les métadonnées WSDL.</span><span class="sxs-lookup"><span data-stu-id="76a4d-139">In some circumstances, especially when interoperating with other platforms, it may be important to control the way a fault appears in a SOAP message or the way it is described in the WSDL metadata.</span></span>  
  
 <span data-ttu-id="76a4d-140">L'attribut <xref:System.ServiceModel.FaultContractAttribute> a une propriété <xref:System.ServiceModel.FaultContractAttribute.Name%2A> qui autorise le contrôle du nom d'élément d'erreur WSDL généré dans les métadonnées pour cette erreur.</span><span class="sxs-lookup"><span data-stu-id="76a4d-140">The <xref:System.ServiceModel.FaultContractAttribute> attribute has a <xref:System.ServiceModel.FaultContractAttribute.Name%2A> property that allows control of the WSDL fault element name that is generated in the metadata for that fault.</span></span>  
  
 <span data-ttu-id="76a4d-141">Selon la norme SOAP, une erreur peut avoir une `Action`, un `Code` et une `Reason`.</span><span class="sxs-lookup"><span data-stu-id="76a4d-141">According to the SOAP standard, a fault can have an `Action`, a `Code`, and a `Reason`.</span></span> <span data-ttu-id="76a4d-142">`Action` est contrôlé par la propriété <xref:System.ServiceModel.FaultContractAttribute.Action%2A>.</span><span class="sxs-lookup"><span data-stu-id="76a4d-142">The `Action` is controlled by the <xref:System.ServiceModel.FaultContractAttribute.Action%2A> property.</span></span> <span data-ttu-id="76a4d-143">La propriété <xref:System.ServiceModel.FaultException.Code%2A> et la propriété <xref:System.ServiceModel.FaultException.Reason%2A> sont deux propriétés de la classe <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> qui est la classe parente du <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> générique.</span><span class="sxs-lookup"><span data-stu-id="76a4d-143">The <xref:System.ServiceModel.FaultException.Code%2A> property and <xref:System.ServiceModel.FaultException.Reason%2A> property are both properties of the <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> class, which is the parent class of the generic <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType>.</span></span> <span data-ttu-id="76a4d-144">La propriété `Code` comprend un membre <xref:System.ServiceModel.FaultCode.SubCode%2A>.</span><span class="sxs-lookup"><span data-stu-id="76a4d-144">The `Code` property includes a <xref:System.ServiceModel.FaultCode.SubCode%2A> member.</span></span>  
  
 <span data-ttu-id="76a4d-145">Lors de l'accès à des non-services sources d'erreurs, certaines limitations existent.</span><span class="sxs-lookup"><span data-stu-id="76a4d-145">When accessing non-services that generate faults, certain limitations exist.</span></span> <span data-ttu-id="76a4d-146">WCF prend en charge uniquement les erreurs avec des types de détail que le schéma décrit et qui sont compatibles avec les contrats de données.</span><span class="sxs-lookup"><span data-stu-id="76a4d-146">WCF supports only faults with detail types that the schema describes and that are compatible with data contracts.</span></span> <span data-ttu-id="76a4d-147">Par exemple, comme indiqué ci-dessus, WCF ne prend pas en charge les erreurs qui utilisent des attributs XML dans leurs types détaillés, ou des erreurs avec plusieurs éléments de niveau supérieur dans la section détail.</span><span class="sxs-lookup"><span data-stu-id="76a4d-147">For example, as mentioned above, WCF does not support faults that use XML attributes in their detail types, or faults with more than one top-level element in the detail section.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="76a4d-148">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="76a4d-148">See also</span></span>

- <xref:System.ServiceModel.FaultContractAttribute>
- <xref:System.Runtime.Serialization.DataContractAttribute>
- <xref:System.Runtime.Serialization.DataMemberAttribute>
- [<span data-ttu-id="76a4d-149">Spécification et gestion des erreurs dans les contrats et les services</span><span class="sxs-lookup"><span data-stu-id="76a4d-149">Specifying and Handling Faults in Contracts and Services</span></span>](specifying-and-handling-faults-in-contracts-and-services.md)
- [<span data-ttu-id="76a4d-150">Envoi et réception des erreurs</span><span class="sxs-lookup"><span data-stu-id="76a4d-150">Sending and Receiving Faults</span></span>](sending-and-receiving-faults.md)
- [<span data-ttu-id="76a4d-151">Procédure : Déclarer des erreurs dans les contrats de service</span><span class="sxs-lookup"><span data-stu-id="76a4d-151">How to: Declare Faults in Service Contracts</span></span>](how-to-declare-faults-in-service-contracts.md)
- [<span data-ttu-id="76a4d-152">Fonctionnement des niveaux de protection</span><span class="sxs-lookup"><span data-stu-id="76a4d-152">Understanding Protection Level</span></span>](understanding-protection-level.md)
- [<span data-ttu-id="76a4d-153">Procédure : définir la propriété ProtectionLevel</span><span class="sxs-lookup"><span data-stu-id="76a4d-153">How to: Set the ProtectionLevel Property</span></span>](how-to-set-the-protectionlevel-property.md)
- [<span data-ttu-id="76a4d-154">Spécification du transfert de données dans des contrats de service</span><span class="sxs-lookup"><span data-stu-id="76a4d-154">Specifying Data Transfer in Service Contracts</span></span>](./feature-details/specifying-data-transfer-in-service-contracts.md)

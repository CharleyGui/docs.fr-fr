---
title: Envoi et réception des erreurs
description: Découvrez comment un service ou un client duplex peut envoyer des erreurs SOAP lorsqu’une condition d’erreur se produit et comment un client ou une application de service gère ces erreurs.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- handling faults [WCF], sending
ms.assetid: 7be6fb96-ce2a-450b-aebe-f932c6a4bc5d
ms.openlocfilehash: 23f63fde2755a29cd545d3aefe699cad8dbecb3b
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/23/2020
ms.locfileid: "85244320"
---
# <a name="sending-and-receiving-faults"></a><span data-ttu-id="b6766-103">Envoi et réception des erreurs</span><span class="sxs-lookup"><span data-stu-id="b6766-103">Sending and Receiving Faults</span></span>

<span data-ttu-id="b6766-104">Les erreurs SOAP acheminent des informations de condition d'erreur d'un service à un client et, dans le cas duplex, d'un client à un service d'une manière interopérable.</span><span class="sxs-lookup"><span data-stu-id="b6766-104">SOAP faults convey error condition information from a service to a client and in the duplex case from a client to a service in an interoperable way.</span></span> <span data-ttu-id="b6766-105">En général un service définit le contenu des erreurs personnalisées et spécifie quelles opérations peuvent les retourner.</span><span class="sxs-lookup"><span data-stu-id="b6766-105">Typically a service defines custom fault content and specifies which operations can return them.</span></span> <span data-ttu-id="b6766-106">(Pour plus d’informations, consultez [définition et spécification des erreurs](defining-and-specifying-faults.md).) Cette rubrique explique comment un service ou un client duplex peut envoyer ces Erreurs lorsque la condition d’erreur correspondante s’est produite et comment un client ou une application de service gère ces erreurs.</span><span class="sxs-lookup"><span data-stu-id="b6766-106">(For more information, see [Defining and Specifying Faults](defining-and-specifying-faults.md).) This topic discusses how a service or duplex client can send those faults when the corresponding error condition has occurred and how a client or service application handles these faults.</span></span> <span data-ttu-id="b6766-107">Pour obtenir une vue d’ensemble de la gestion des erreurs dans les applications Windows Communication Foundation (WCF), consultez [spécification et gestion des erreurs dans les contrats et les services](specifying-and-handling-faults-in-contracts-and-services.md).</span><span class="sxs-lookup"><span data-stu-id="b6766-107">For an overview of error handling in Windows Communication Foundation (WCF) applications, see [Specifying and Handling Faults in Contracts and Services](specifying-and-handling-faults-in-contracts-and-services.md).</span></span>

## <a name="sending-soap-faults"></a><span data-ttu-id="b6766-108">Envoi d'erreurs SOAP</span><span class="sxs-lookup"><span data-stu-id="b6766-108">Sending SOAP Faults</span></span>

<span data-ttu-id="b6766-109">Les erreurs SOAP déclarées sont celles dans lesquelles une opération contient un <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> qui spécifie un type d'erreur SOAP personnalisé.</span><span class="sxs-lookup"><span data-stu-id="b6766-109">Declared SOAP faults are those in which an operation has a <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> that specifies a custom SOAP fault type.</span></span> <span data-ttu-id="b6766-110">Les erreurs SOAP non déclarées sont celles qui ne sont pas spécifiées dans le contrat d'une opération.</span><span class="sxs-lookup"><span data-stu-id="b6766-110">Undeclared SOAP faults are those that are not specified in the contract for an operation.</span></span>

### <a name="sending-declared-faults"></a><span data-ttu-id="b6766-111">Envoi d'erreurs déclarées</span><span class="sxs-lookup"><span data-stu-id="b6766-111">Sending Declared Faults</span></span>

<span data-ttu-id="b6766-112">Pour envoyer une erreur SOAP déclarée, détectez la condition d'erreur pour laquelle l'erreur SOAP est appropriée et levez une nouvelle <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> où le paramètre de type est un nouvel objet du type spécifié dans le <xref:System.ServiceModel.FaultContractAttribute> pour cette opération.</span><span class="sxs-lookup"><span data-stu-id="b6766-112">To send a declared SOAP fault, detect the error condition for which the SOAP fault is appropriate and throw a new <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> where the type parameter is a new object of the type specified in the <xref:System.ServiceModel.FaultContractAttribute> for that operation.</span></span> <span data-ttu-id="b6766-113">L'exemple de code suivant illustre l'utilisation de <xref:System.ServiceModel.FaultContractAttribute> pour spécifier que l'opération `SampleMethod` peut retourner une erreur SOAP avec le type de détail `GreetingFault`.</span><span class="sxs-lookup"><span data-stu-id="b6766-113">The following code example shows the use of <xref:System.ServiceModel.FaultContractAttribute> to specify that the `SampleMethod` operation can return a SOAP fault with the detail type of `GreetingFault`.</span></span>

[!code-csharp[FaultContractAttribute#4](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/services.cs#4)]
[!code-vb[FaultContractAttribute#4](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/services.vb#4)]

<span data-ttu-id="b6766-114">Pour acheminer les informations sur l'erreur `GreetingFault` au client, interceptez la condition d'erreur appropriée et levez une nouvelle <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> de type `GreetingFault` avec un nouvel objet `GreetingFault` comme argument, comme dans l'exemple de code suivant.</span><span class="sxs-lookup"><span data-stu-id="b6766-114">To convey the `GreetingFault` error information to the client, catch the appropriate error condition and throw a new <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> of type `GreetingFault` with a new `GreetingFault` object as the argument, as in the following code example.</span></span> <span data-ttu-id="b6766-115">Si le client est une application cliente WCF, il rencontre cette erreur en tant qu’exception managée où le type est <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> de type `GreetingFault` .</span><span class="sxs-lookup"><span data-stu-id="b6766-115">If the client is an WCF client application, it experiences this as a managed exception where the type is <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> of type `GreetingFault`.</span></span>

[!code-csharp[FaultContractAttribute#5](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/services.cs#5)]
[!code-vb[FaultContractAttribute#5](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/services.vb#5)]

### <a name="sending-undeclared-faults"></a><span data-ttu-id="b6766-116">Envoi d'erreurs non déclarées</span><span class="sxs-lookup"><span data-stu-id="b6766-116">Sending Undeclared Faults</span></span>

<span data-ttu-id="b6766-117">L’envoi d’erreurs non déclarées peut être très utile pour diagnostiquer et déboguer rapidement les problèmes dans les applications WCF, mais son utilité en tant qu’outil de débogage est limitée.</span><span class="sxs-lookup"><span data-stu-id="b6766-117">Sending undeclared faults can be very useful to quickly diagnose and debug problems in WCF applications, but its usefulness as a debugging tool is limited.</span></span> <span data-ttu-id="b6766-118">Plus généralement, lors du débogage il est recommandé d'utiliser la propriété <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b6766-118">More generally, when debugging it is recommended that you use the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="b6766-119">Lorsque vous définissez cette valeur à « true », les clients rencontrent des erreurs telles que des exceptions <xref:System.ServiceModel.FaultException%601> de type <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="b6766-119">When you set this value to true, clients experience such faults as <xref:System.ServiceModel.FaultException%601> exceptions of type <xref:System.ServiceModel.ExceptionDetail>.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b6766-120">Étant donné que les exceptions managées peuvent exposer des informations d’application internes, le paramétrage <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> ou <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> `true` peut permettre aux clients WCF d’obtenir des informations sur les exceptions d’opération de service internes, y compris l’identification personnelle ou d’autres informations sensibles.</span><span class="sxs-lookup"><span data-stu-id="b6766-120">Because managed exceptions can expose internal application information, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` can permit WCF clients to obtain information about internal service operation exceptions, including personally identifiable or other sensitive information.</span></span>
>
> <span data-ttu-id="b6766-121">Par conséquent, l'affectation de la valeur <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> à <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> ou `true` est uniquement recommandée comme une façon de déboguer temporairement une application de service.</span><span class="sxs-lookup"><span data-stu-id="b6766-121">Therefore, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` is only recommended as a way of temporarily debugging a service application.</span></span> <span data-ttu-id="b6766-122">De plus, le WSDL pour une méthode qui retourne des exceptions managées non prises en charge de cette façon ne contient pas le contrat pour le <xref:System.ServiceModel.FaultException%601> de type <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="b6766-122">In addition, the WSDL for a method that returns unhandled managed exceptions in this way does not contain the contract for the <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="b6766-123">Les clients doivent attendre une erreur SOAP inconnue (retournée aux clients WCF en tant qu' <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> objets) pour obtenir correctement les informations de débogage.</span><span class="sxs-lookup"><span data-stu-id="b6766-123">Clients must expect the possibility of an unknown SOAP fault (returned to WCF clients as <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> objects) to obtain the debugging information properly.</span></span>

<span data-ttu-id="b6766-124">Pour envoyer une erreur SOAP non déclarée, levez un objet <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> (autrement dit, pas le type générique <xref:System.ServiceModel.FaultException%601>) et passez la chaîne au constructeur.</span><span class="sxs-lookup"><span data-stu-id="b6766-124">To send an undeclared SOAP fault, throw a <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> object (that is, not the generic type <xref:System.ServiceModel.FaultException%601>) and pass the string to the constructor.</span></span> <span data-ttu-id="b6766-125">Cela est exposé aux applications clientes WCF en tant qu' <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> exception levée lorsque la chaîne est disponible en appelant la <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType> méthode.</span><span class="sxs-lookup"><span data-stu-id="b6766-125">This is exposed to the WCF client applications as a thrown <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> exception where the string is available by calling the <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType> method.</span></span>

> [!NOTE]
> <span data-ttu-id="b6766-126">Si vous déclarez une erreur SOAP de type chaîne et que vous la levez ensuite dans votre service en tant que <xref:System.ServiceModel.FaultException%601> où le paramètre de type est un <xref:System.String?displayProperty=nameWithType>, la valeur de chaîne est assignée à la propriété <xref:System.ServiceModel.FaultException%601.Detail%2A?displayProperty=nameWithType> et n'est pas disponible à partir de <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b6766-126">If you declare a SOAP fault of type string, and then throw this in your service as a <xref:System.ServiceModel.FaultException%601> where the type parameter is a <xref:System.String?displayProperty=nameWithType> the string value is assigned to the <xref:System.ServiceModel.FaultException%601.Detail%2A?displayProperty=nameWithType> property, and is not available from <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType>.</span></span>

## <a name="handling-faults"></a><span data-ttu-id="b6766-127">Gestion des erreurs</span><span class="sxs-lookup"><span data-stu-id="b6766-127">Handling Faults</span></span>

<span data-ttu-id="b6766-128">Dans les clients WCF, les erreurs SOAP qui se produisent pendant la communication qui présentent un intérêt pour les applications clientes sont levées en tant qu’exceptions managées.</span><span class="sxs-lookup"><span data-stu-id="b6766-128">In WCF clients, SOAP faults that occur during communication that are of interest to client applications are raised as managed exceptions.</span></span> <span data-ttu-id="b6766-129">Bien qu’il existe de nombreuses exceptions qui peuvent se produire pendant l’exécution d’un programme, les applications utilisant le modèle de programmation client WCF peuvent s’attendre à gérer les exceptions des deux types suivants à la suite de la communication.</span><span class="sxs-lookup"><span data-stu-id="b6766-129">While there are many exceptions that can occur during the execution of any program, applications using the WCF client programming model can expect to handle exceptions of the following two types as a result of communication.</span></span>

- <xref:System.TimeoutException>

- <xref:System.ServiceModel.CommunicationException>

<span data-ttu-id="b6766-130">Les objets <xref:System.TimeoutException> sont levés lorsqu'une opération dépasse le délai d'attente spécifié.</span><span class="sxs-lookup"><span data-stu-id="b6766-130"><xref:System.TimeoutException> objects are thrown when an operation exceeds the specified timeout period.</span></span>

<span data-ttu-id="b6766-131">Les objets <xref:System.ServiceModel.CommunicationException> sont levés lorsqu'il existe une condition d'erreur de communication récupérable sur le service ou le client.</span><span class="sxs-lookup"><span data-stu-id="b6766-131"><xref:System.ServiceModel.CommunicationException> objects are thrown when there is some recoverable communication error condition on either the service or the client.</span></span>

<span data-ttu-id="b6766-132">La classe <xref:System.ServiceModel.CommunicationException> a deux types dérivés importants, <xref:System.ServiceModel.FaultException> et le type <xref:System.ServiceModel.FaultException%601> générique.</span><span class="sxs-lookup"><span data-stu-id="b6766-132">The <xref:System.ServiceModel.CommunicationException> class has two important derived types, <xref:System.ServiceModel.FaultException> and the generic <xref:System.ServiceModel.FaultException%601> type.</span></span>

<span data-ttu-id="b6766-133">Les exceptions <xref:System.ServiceModel.FaultException> sont levées lorsqu'un écouteur reçoit une erreur inattendue ou qui n'est spécifiée dans le contrat d'opération ; habituellement, cela se produit lorsque l'application est déboguée et que le service a la propriété <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> définie à `true`.</span><span class="sxs-lookup"><span data-stu-id="b6766-133"><xref:System.ServiceModel.FaultException> exceptions are thrown when a listener receives a fault that is not expected or specified in the operation contract; usually this occurs when the application is being debugged and the service has the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property set to `true`.</span></span>

<span data-ttu-id="b6766-134">Les exceptions <xref:System.ServiceModel.FaultException%601> sont levées sur le client lorsqu'une erreur spécifiée dans le contrat d'opération est reçue en réponse à une opération bidirectionnelle (autrement dit, une méthode avec un attribut <xref:System.ServiceModel.OperationContractAttribute> ayant la valeur <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A> affectée à la propriété `false`).</span><span class="sxs-lookup"><span data-stu-id="b6766-134"><xref:System.ServiceModel.FaultException%601> exceptions are thrown on the client when a fault that is specified in the operation contract is received in response to a two-way operation (that is, a method with an <xref:System.ServiceModel.OperationContractAttribute> attribute with <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A> set to `false`).</span></span>

> [!NOTE]
> <span data-ttu-id="b6766-135">Lorsqu’un service WCF a la <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> propriété ou définie sur `true` le client se comporte comme un non déclaré <xref:System.ServiceModel.FaultException%601> de type <xref:System.ServiceModel.ExceptionDetail> .</span><span class="sxs-lookup"><span data-stu-id="b6766-135">When an WCF service has the <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property set to `true` the client experiences this as an undeclared <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="b6766-136">Les clients peuvent intercepter cette erreur spécifique ou gérer l'erreur dans un bloc catch pour <xref:System.ServiceModel.FaultException>.</span><span class="sxs-lookup"><span data-stu-id="b6766-136">Clients can either catch this specific fault or handle the fault in a catch block for <xref:System.ServiceModel.FaultException>.</span></span>

<span data-ttu-id="b6766-137">En général, seules les exceptions <xref:System.ServiceModel.FaultException%601>, <xref:System.TimeoutException> et <xref:System.ServiceModel.CommunicationException> sont dignes d'intérêt pour les clients et les services.</span><span class="sxs-lookup"><span data-stu-id="b6766-137">Typically, only <xref:System.ServiceModel.FaultException%601>, <xref:System.TimeoutException>, and <xref:System.ServiceModel.CommunicationException> exceptions are of interest to clients and services.</span></span>

> [!NOTE]
> <span data-ttu-id="b6766-138">D'autres exceptions, bien sûr, se produisent.</span><span class="sxs-lookup"><span data-stu-id="b6766-138">Other exceptions, of course, do occur.</span></span> <span data-ttu-id="b6766-139">Les exceptions inattendues incluent des défaillances catastrophiques telles que <xref:System.OutOfMemoryException?displayProperty=nameWithType> ; en général, les applications ne doivent pas intercepter de telles méthodes.</span><span class="sxs-lookup"><span data-stu-id="b6766-139">Unexpected exceptions include catastrophic failures like <xref:System.OutOfMemoryException?displayProperty=nameWithType>; typically applications should not catch such methods.</span></span>

### <a name="catch-fault-exceptions-in-the-correct-order"></a><span data-ttu-id="b6766-140">Interception des exceptions dans l'ordre correct</span><span class="sxs-lookup"><span data-stu-id="b6766-140">Catch Fault Exceptions in the Correct Order</span></span>

<span data-ttu-id="b6766-141">Étant donné que <xref:System.ServiceModel.FaultException%601> dérive de <xref:System.ServiceModel.FaultException> et que <xref:System.ServiceModel.FaultException> dérive de <xref:System.ServiceModel.CommunicationException>, il est important d'intercepter ces exceptions dans l'ordre approprié.</span><span class="sxs-lookup"><span data-stu-id="b6766-141">Because <xref:System.ServiceModel.FaultException%601> derives from <xref:System.ServiceModel.FaultException>, and <xref:System.ServiceModel.FaultException> derives from <xref:System.ServiceModel.CommunicationException>, it is important to catch these exceptions in the proper order.</span></span> <span data-ttu-id="b6766-142">Si, par exemple, vous avez un bloc try/catch dans lequel vous interceptez d'abord <xref:System.ServiceModel.CommunicationException>, toutes les erreurs SOAP spécifiées et non spécifiées sont gérées à cet emplacement ; les blocs catch suivants destinés à gérer une exception <xref:System.ServiceModel.FaultException%601> personnalisée ne sont jamais appelés.</span><span class="sxs-lookup"><span data-stu-id="b6766-142">If, for example, you have a try/catch block in which you first catch <xref:System.ServiceModel.CommunicationException>, all specified and unspecified SOAP faults are handled there; any subsequent catch blocks to handle a custom <xref:System.ServiceModel.FaultException%601> exception are never invoked.</span></span>

<span data-ttu-id="b6766-143">Souvenez-vous qu'une opération peut retourner une quantité d'erreurs spécifiées quelconque.</span><span class="sxs-lookup"><span data-stu-id="b6766-143">Remember that one operation can return any number of specified faults.</span></span> <span data-ttu-id="b6766-144">Chaque erreur est un type unique et doit être gérée séparément.</span><span class="sxs-lookup"><span data-stu-id="b6766-144">Each fault is a unique type and must be handled separately.</span></span>

### <a name="handle-exceptions-when-closing-the-channel"></a><span data-ttu-id="b6766-145">Gestion des exceptions lors de la fermeture du canal</span><span class="sxs-lookup"><span data-stu-id="b6766-145">Handle Exceptions When Closing the Channel</span></span>

<span data-ttu-id="b6766-146">La majeure partie de la discussion précédente concerne les erreurs envoyées au cours du traitement des messages d’application, autrement dit, les messages envoyés explicitement par le client lorsque l’application cliente appelle des opérations sur l’objet client WCF.</span><span class="sxs-lookup"><span data-stu-id="b6766-146">Most of the preceding discussion has to do with faults sent in the course of processing application messages, that is, messages explicitly sent by the client when the client application calls operations on the WCF client object.</span></span>

<span data-ttu-id="b6766-147">Même avec les objets locaux, l'élimination de l'objet peut déclencher ou masquer des exceptions qui se produisent pendant le processus de recyclage.</span><span class="sxs-lookup"><span data-stu-id="b6766-147">Even with local objects disposing the object can either raise or mask exceptions that occur during the recycling process.</span></span> <span data-ttu-id="b6766-148">Un résultat similaire peut se produire lorsque vous utilisez des objets clients WCF.</span><span class="sxs-lookup"><span data-stu-id="b6766-148">Something similar can occur when you use WCF client objects.</span></span> <span data-ttu-id="b6766-149">Lorsque vous appelez des opérations, vous envoyez des messages sur une connexion établie.</span><span class="sxs-lookup"><span data-stu-id="b6766-149">When you call operations you are sending messages over an established connection.</span></span> <span data-ttu-id="b6766-150">La fermeture du canal peut lever des exceptions si la connexion ne peut pas être fermée proprement ou si elle est déjà fermée, même si toutes les opérations ont été retournées correctement.</span><span class="sxs-lookup"><span data-stu-id="b6766-150">Closing the channel can throw exceptions if the connection cannot be cleanly closed or is already closed, even if all the operations returned properly.</span></span>

<span data-ttu-id="b6766-151">En général, les canaux d'objets clients sont fermés dans les cas suivants :</span><span class="sxs-lookup"><span data-stu-id="b6766-151">Typically, client object channels are closed in one of the following ways:</span></span>

- <span data-ttu-id="b6766-152">Lorsque l’objet client WCF est recyclé.</span><span class="sxs-lookup"><span data-stu-id="b6766-152">When the WCF client object is recycled.</span></span>

- <span data-ttu-id="b6766-153">Lorsque l'application cliente appelle <xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b6766-153">When the client application calls <xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType>.</span></span>

- <span data-ttu-id="b6766-154">Lorsque l'application cliente appelle <xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b6766-154">When the client application calls <xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType>.</span></span>

- <span data-ttu-id="b6766-155">Lorsque l'application cliente appelle une opération qui est une opération de fin pour une session.</span><span class="sxs-lookup"><span data-stu-id="b6766-155">When the client application calls an operation that is a terminating operation for a session.</span></span>

<span data-ttu-id="b6766-156">Dans tous les cas, la fermeture du canal fait en sorte que celui-ci commence à fermer tous les canaux sous-jacents qui peuvent envoyer des messages pour prendre en charge la fonctionnalité complexe au niveau application.</span><span class="sxs-lookup"><span data-stu-id="b6766-156">In all cases, closing the channel instructs the channel to begin closing any underlying channels that may be sending messages to support complex functionality at the application level.</span></span> <span data-ttu-id="b6766-157">Par exemple, lorsqu’un contrat requiert des sessions, une liaison tente d’établir une session en échangeant des messages avec le canal de service jusqu’à ce qu’une session soit établie.</span><span class="sxs-lookup"><span data-stu-id="b6766-157">For example, when a contract requires sessions a binding attempts to establish a session by exchanging messages with the service channel until a session is established.</span></span> <span data-ttu-id="b6766-158">Lorsque le canal est fermé, le canal de session sous-jacent signale au service que la session est terminée.</span><span class="sxs-lookup"><span data-stu-id="b6766-158">When the channel is closed, the underlying session channel notifies the service that the session is terminated.</span></span> <span data-ttu-id="b6766-159">Dans ce cas, si le canal a déjà abandonné, est déjà fermé ou est inutilisable (par exemple, lorsqu'un câble réseau est débranché), le canal client ne peut pas signaler au canal de service que la session est terminée et une exception peut être déclenchée.</span><span class="sxs-lookup"><span data-stu-id="b6766-159">In this case, if the channel has already aborted, closed, or is otherwise unusable (for example, when a network cable is unplugged), the client channel cannot inform the service channel that the session is terminated and an exception can result.</span></span>

### <a name="abort-the-channel-if-necessary"></a><span data-ttu-id="b6766-160">Abandon du canal si nécessaire</span><span class="sxs-lookup"><span data-stu-id="b6766-160">Abort the Channel If Necessary</span></span>

<span data-ttu-id="b6766-161">La fermeture du canal pouvant également lever des exceptions, en plus d'intercepter les exceptions dans l'ordre correct il est important d'abandonner le canal utilisé pour effectuer l'appel dans le bloc catch.</span><span class="sxs-lookup"><span data-stu-id="b6766-161">Because closing the channel can also throw exceptions, then, it is recommended that in addition to catching fault exceptions in the correct order, it is important to abort the channel that was used in making the call in the catch block.</span></span>

<span data-ttu-id="b6766-162">Si l'erreur achemine des informations d'erreur spécifiques à une opération et qu'il est encore possible que d'autres puissent l'utiliser, il n'est pas nécessaire d'abandonner le canal (bien que ces cas soient rares).</span><span class="sxs-lookup"><span data-stu-id="b6766-162">If the fault conveys error information specific to an operation and it remains possible that others can use it, there is no need to abort the channel (although these cases are rare).</span></span> <span data-ttu-id="b6766-163">Dans tous les autres cas, il est recommandé d'abandonner le canal.</span><span class="sxs-lookup"><span data-stu-id="b6766-163">In all other cases, it is recommended that you abort the channel.</span></span> <span data-ttu-id="b6766-164">Pour obtenir un exemple qui illustre tous ces points, consultez [exceptions attendues](./samples/expected-exceptions.md).</span><span class="sxs-lookup"><span data-stu-id="b6766-164">For a sample that demonstrates all of these points, see [Expected Exceptions](./samples/expected-exceptions.md).</span></span>

<span data-ttu-id="b6766-165">L'exemple de code suivant indique comment gérer des exceptions SOAP dans une application cliente de base, y compris une erreur déclarée et une erreur non déclarée.</span><span class="sxs-lookup"><span data-stu-id="b6766-165">The following code example shows how to handle SOAP fault exceptions in a basic client application, including a declared fault and an undeclared fault.</span></span>

> [!NOTE]
> <span data-ttu-id="b6766-166">Cet exemple de code n'utilise pas la construction `using`.</span><span class="sxs-lookup"><span data-stu-id="b6766-166">This sample code does not use the `using` construct.</span></span> <span data-ttu-id="b6766-167">Étant donné que la fermeture des canaux peut lever des exceptions, il est recommandé que les applications créent d’abord un client WCF, puis ouvrent, utilisent et ferment le client WCF dans le même bloc try.</span><span class="sxs-lookup"><span data-stu-id="b6766-167">Because closing channels can throw exceptions, it is recommended that applications create a WCF client first, and then open, use, and close the WCF client in the same try block.</span></span> <span data-ttu-id="b6766-168">Pour plus d’informations, consultez [vue d’ensemble du client WCF](wcf-client-overview.md) et [utilisation de Close et Abort pour libérer des ressources clientes WCF](./samples/use-close-abort-release-wcf-client-resources.md).</span><span class="sxs-lookup"><span data-stu-id="b6766-168">For details, see [WCF Client Overview](wcf-client-overview.md) and [Use Close and Abort to release WCF client resources](./samples/use-close-abort-release-wcf-client-resources.md).</span></span>

[!code-csharp[FaultContractAttribute#3](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/client.cs#3)]
[!code-vb[FaultContractAttribute#3](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/client.vb#3)]

## <a name="see-also"></a><span data-ttu-id="b6766-169">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="b6766-169">See also</span></span>

- <xref:System.ServiceModel.FaultException>
- <xref:System.ServiceModel.FaultException%601>
- <xref:System.ServiceModel.CommunicationException?displayProperty=nameWithType>
- [<span data-ttu-id="b6766-170">Expected Exceptions</span><span class="sxs-lookup"><span data-stu-id="b6766-170">Expected Exceptions</span></span>](./samples/expected-exceptions.md)
- [<span data-ttu-id="b6766-171">Utiliser la fermeture et l’abandon pour libérer des ressources de client WCF</span><span class="sxs-lookup"><span data-stu-id="b6766-171">Use Close and Abort to release WCF client resources</span></span>](./samples/use-close-abort-release-wcf-client-resources.md)

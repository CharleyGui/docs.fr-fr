---
title: Spécification et gestion des erreurs dans les contrats et les services
ms.date: 03/30/2017
helpviewer_keywords:
- handling faults [WCF]
ms.assetid: a9696563-d404-4905-942d-1e0834c26dea
ms.openlocfilehash: b9d6a4e2bb6b7e5c750ff7dad92934c4337c0083
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/28/2019
ms.locfileid: "64605939"
---
# <a name="specifying-and-handling-faults-in-contracts-and-services"></a><span data-ttu-id="bf329-102">Spécification et gestion des erreurs dans les contrats et les services</span><span class="sxs-lookup"><span data-stu-id="bf329-102">Specifying and Handling Faults in Contracts and Services</span></span>
<span data-ttu-id="bf329-103">Applications Windows Communication Foundation (WCF) gérer les situations d’erreur en mappant les objets exception managés aux objets erreur SOAP et les objets erreur SOAP aux objets exception managés.</span><span class="sxs-lookup"><span data-stu-id="bf329-103">Windows Communication Foundation (WCF) applications handle error situations by mapping managed exception objects to SOAP fault objects and SOAP fault objects to managed exception objects.</span></span> <span data-ttu-id="bf329-104">Les rubriques de cette section expliquent comment concevoir des contrats pour exposer des conditions d'erreur en tant qu'erreurs SOAP personnalisées, comment retourner de telles erreurs dans le cadre de l'implémentation du service et comment les clients interceptent de telles erreurs.</span><span class="sxs-lookup"><span data-stu-id="bf329-104">The topics in this section discuss how to design contracts to expose error conditions as custom SOAP faults, how to return such faults as part of service implementation, and how clients catch such faults.</span></span>  
  
## <a name="error-handling-overview"></a><span data-ttu-id="bf329-105">Vue d'ensemble de la gestion des erreurs</span><span class="sxs-lookup"><span data-stu-id="bf329-105">Error Handling Overview</span></span>  
 <span data-ttu-id="bf329-106">Dans toutes les applications managées, les erreurs de traitement sont représentées par des objets <xref:System.Exception>.</span><span class="sxs-lookup"><span data-stu-id="bf329-106">In all managed applications, processing errors are represented by <xref:System.Exception> objects.</span></span> <span data-ttu-id="bf329-107">Dans les applications basées sur SOAP telles que les applications WCF, méthodes de service communiquent des informations d’erreur de traitement à l’aide de messages d’erreur SOAP.</span><span class="sxs-lookup"><span data-stu-id="bf329-107">In SOAP-based applications such as WCF applications, service methods communicate processing error information using SOAP fault messages.</span></span> <span data-ttu-id="bf329-108">Les erreurs SOAP sont des types de messages inclus dans les métadonnées d'une opération de service et créent, par conséquent, un contrat d'erreur permettant aux clients d'améliorer la fiabilité ou l'interactivité de leur opération.</span><span class="sxs-lookup"><span data-stu-id="bf329-108">SOAP faults are message types that are included in the metadata for a service operation and therefore create a fault contract that clients can use to make their operation more robust or interactive.</span></span> <span data-ttu-id="bf329-109">En outre, étant donné que les erreurs SOAP sont exprimées aux clients au format XML, il est un système de type hautement interopérable permettant aux clients sur n’importe quelle plateforme SOAP, augmentant la portée de votre application WCF.</span><span class="sxs-lookup"><span data-stu-id="bf329-109">In addition, because SOAP faults are expressed to clients in XML form, it is a highly interoperable type system that clients on any SOAP platform can use, increasing the reach of your WCF application.</span></span>  
  
 <span data-ttu-id="bf329-110">Étant donné que les applications WCF s’exécutent sous les deux types de systèmes d’erreur, les informations d’exception gérées qui sont envoyées au client doivent être converties d’exceptions en erreurs SOAP sur le service, envoyées et converties d’erreurs SOAP en exceptions dans les clients WCF.</span><span class="sxs-lookup"><span data-stu-id="bf329-110">Because WCF applications run under both types of error systems, any managed exception information that is sent to the client must be converted from exceptions into SOAP faults on the service, sent, and converted from SOAP faults to fault exceptions in WCF clients.</span></span> <span data-ttu-id="bf329-111">Dans le cas de clients duplex, les contrats clients peuvent aussi renvoyer des erreurs SOAP à un service.</span><span class="sxs-lookup"><span data-stu-id="bf329-111">In the case of duplex clients, client contracts can also send SOAP faults back to a service.</span></span> <span data-ttu-id="bf329-112">Dans les deux cas, vous pouvez utiliser les comportements d'exception de service par défaut ou vous pouvez contrôler explicitement si (et comment) les exceptions sont mappées aux messages d'erreur.</span><span class="sxs-lookup"><span data-stu-id="bf329-112">In either case, you can use the default service exception behaviors, or you can explicitly control whether—and how—exceptions are mapped to fault messages.</span></span>  
  
 <span data-ttu-id="bf329-113">Deux types d’erreurs SOAP peuvent être envoyés : *déclaré* et *non déclaré*.</span><span class="sxs-lookup"><span data-stu-id="bf329-113">Two types of SOAP faults can be sent: *declared* and *undeclared*.</span></span> <span data-ttu-id="bf329-114">Les erreurs SOAP déclarées sont celles dans lesquelles une opération contient un attribut <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> qui spécifie un type d'erreur SOAP personnalisé.</span><span class="sxs-lookup"><span data-stu-id="bf329-114">Declared SOAP faults are those in which an operation has a <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> attribute that specifies a custom SOAP fault type.</span></span> <span data-ttu-id="bf329-115">*Non déclaré* erreurs SOAP ne sont pas spécifiées dans le contrat pour une opération.</span><span class="sxs-lookup"><span data-stu-id="bf329-115">*Undeclared* SOAP faults are not specified in the contract for an operation.</span></span>  
  
 <span data-ttu-id="bf329-116">Il est vivement recommandé que les opérations de service déclarent leurs erreurs en utilisant l'attribut <xref:System.ServiceModel.FaultContractAttribute> pour spécifier de manière formelle toutes les erreurs SOAP qu'un client peut s'attendre à recevoir dans le cours normal de l'opération.</span><span class="sxs-lookup"><span data-stu-id="bf329-116">It is strongly recommended that service operations declare their faults by using the <xref:System.ServiceModel.FaultContractAttribute> attribute to formally specify all SOAP faults that a client can expect to receive in the normal course of an operation.</span></span> <span data-ttu-id="bf329-117">Il est également recommandé de retourner dans une erreur SOAP uniquement les informations qu'un client doit connaître pour réduire la divulgation d'informations.</span><span class="sxs-lookup"><span data-stu-id="bf329-117">It is also recommended that you return in a SOAP fault only the information that a client must know to minimize information disclosure.</span></span>  
  
 <span data-ttu-id="bf329-118">En général, les services (et les clients duplex) exécutent les étapes suivantes pour intégrer la gestion des erreurs dans leurs applications :</span><span class="sxs-lookup"><span data-stu-id="bf329-118">Typically, services (and duplex clients) take the following steps to successfully integrate error handling into their applications:</span></span>  
  
- <span data-ttu-id="bf329-119">Mappage des conditions d'exception aux erreurs SOAP personnalisées.</span><span class="sxs-lookup"><span data-stu-id="bf329-119">Map exception conditions to custom SOAP faults.</span></span>  
  
- <span data-ttu-id="bf329-120">Les clients et les services envoient et reçoivent des erreurs SOAP comme exceptions.</span><span class="sxs-lookup"><span data-stu-id="bf329-120">Clients and services send and receive SOAP faults as exceptions.</span></span>  
  
 <span data-ttu-id="bf329-121">En outre, services et des clients WCF peuvent utiliser les erreurs soap non déclarées pour le débogage et d’étendre le comportement d’erreur par défaut.</span><span class="sxs-lookup"><span data-stu-id="bf329-121">In addition, WCF clients and services can use undeclared soap faults for debugging purposes and can extend the default error behavior.</span></span> <span data-ttu-id="bf329-122">Les sections suivantes traitent de ces tâches et de ces concepts.</span><span class="sxs-lookup"><span data-stu-id="bf329-122">The following sections discuss these tasks and concepts.</span></span>  
  
## <a name="map-exceptions-to-soap-faults"></a><span data-ttu-id="bf329-123">Mappage d'exceptions aux erreurs SOAP</span><span class="sxs-lookup"><span data-stu-id="bf329-123">Map Exceptions to SOAP Faults</span></span>  
 <span data-ttu-id="bf329-124">La première étape pour créer une opération qui gère des conditions d'erreur consiste à décider à quelles conditions une application cliente doit être informée des erreurs.</span><span class="sxs-lookup"><span data-stu-id="bf329-124">The first step in creating an operation that handles error conditions is to decide under what conditions a client application should be informed about errors.</span></span> <span data-ttu-id="bf329-125">Certaines opérations ont des conditions d'erreur spécifiques à leurs fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="bf329-125">Some operations have error conditions specific to their functionality.</span></span> <span data-ttu-id="bf329-126">Par exemple, une opération `PurchaseOrder` peut retourner des informations spécifiques aux clients qui ne sont plus autorisés à initialiser une commande fournisseur.</span><span class="sxs-lookup"><span data-stu-id="bf329-126">For example, a `PurchaseOrder` operation might return specific information to customers who are no longer permitted to initiate a purchase order.</span></span> <span data-ttu-id="bf329-127">Dans d'autres cas, comme pour un service `Calculator`, une erreur SOAP `MathFault` plus générale peut-être en mesure de décrire toutes les conditions d'erreur à travers un service entier.</span><span class="sxs-lookup"><span data-stu-id="bf329-127">In other cases, such as a `Calculator` service, a more general `MathFault` SOAP fault may be able to describe all error conditions across an entire service.</span></span> <span data-ttu-id="bf329-128">Une fois les conditions d'erreur des clients de votre service identifiées, une erreur SOAP personnalisée peut être construite et l'opération peut être marquée comme retournant cette erreur SOAP lorsque la condition d'erreur correspondante se produit.</span><span class="sxs-lookup"><span data-stu-id="bf329-128">Once the error conditions of clients of your service are identified, a custom SOAP fault can be constructed and the operation can be marked as returning that SOAP fault when its corresponding error condition arises.</span></span>  
  
 <span data-ttu-id="bf329-129">Pour plus d’informations sur cette étape du développement de votre service ou client, consultez [définition et spécification des erreurs](../../../docs/framework/wcf/defining-and-specifying-faults.md).</span><span class="sxs-lookup"><span data-stu-id="bf329-129">For more information about this step of developing your service or client, see [Defining and Specifying Faults](../../../docs/framework/wcf/defining-and-specifying-faults.md).</span></span>  
  
## <a name="clients-and-services-handle-soap-faults-as-exceptions"></a><span data-ttu-id="bf329-130">Clients et services gérant les erreurs SOAP en tant qu'exceptions</span><span class="sxs-lookup"><span data-stu-id="bf329-130">Clients and Services Handle SOAP Faults as Exceptions</span></span>  
 <span data-ttu-id="bf329-131">Identification des conditions d’erreur opération, la définition des erreurs SOAP personnalisées et la marquer pour qu’elles retournent ces erreurs sont les premières étapes dans réussie gestion des erreurs dans les applications WCF.</span><span class="sxs-lookup"><span data-stu-id="bf329-131">Identifying operation error conditions, defining custom SOAP faults, and marking those operations as returning those faults are the first steps in successful error handling in WCF applications.</span></span> <span data-ttu-id="bf329-132">L'étape suivante consiste à implémenter correctement l'émission et la réception de ces erreurs.</span><span class="sxs-lookup"><span data-stu-id="bf329-132">The next step is to properly implement the sending and receiving of these faults.</span></span> <span data-ttu-id="bf329-133">En général les services envoient des erreurs pour signaler aux applications clientes des conditions d'erreur, mais les clients duplex peuvent également envoyer des erreurs SOAP aux services.</span><span class="sxs-lookup"><span data-stu-id="bf329-133">Typically services send faults to inform client applications about error conditions, but duplex clients can also send SOAP faults to services.</span></span>  
  
 <span data-ttu-id="bf329-134">Pour plus d’informations, consultez [Sending and Receiving Faults](../../../docs/framework/wcf/sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="bf329-134">For more information, see [Sending and Receiving Faults](../../../docs/framework/wcf/sending-and-receiving-faults.md).</span></span>  
  
## <a name="undeclared-soap-faults-and-debugging"></a><span data-ttu-id="bf329-135">Erreurs SOAP non déclarées et débogage</span><span class="sxs-lookup"><span data-stu-id="bf329-135">Undeclared SOAP Faults and Debugging</span></span>  
 <span data-ttu-id="bf329-136">Les erreurs SOAP déclarées sont extrêmement utiles pour construire des applications fiables, interopérables et distribuées.</span><span class="sxs-lookup"><span data-stu-id="bf329-136">Declared SOAP faults are extremely useful for building robust, interoperable, distributed applications.</span></span> <span data-ttu-id="bf329-137">Toutefois, il est parfois utile pour un service (ou un client duplex) d'envoyer une erreur SOAP non déclarée, c'est-à-dire une erreur qui n'est pas mentionnée dans WSDL (Web Services Description Language) pour une opération.</span><span class="sxs-lookup"><span data-stu-id="bf329-137">However, in some cases it is useful for a service (or duplex client) to send an undeclared SOAP fault, one that is not mentioned in the Web Services Description Language (WSDL) for that operation.</span></span> <span data-ttu-id="bf329-138">Par exemple, lors du développement d'un service, des situations inattendues peuvent se produire et il peut s'avérer utile de renvoyer des informations au client à des fins de débogage.</span><span class="sxs-lookup"><span data-stu-id="bf329-138">For example, when developing a service, unexpected situations can occur in which it is useful for debugging purposes to send information back to the client.</span></span> <span data-ttu-id="bf329-139">En outre, vous pouvez définir le <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> propriété ou le <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> propriété `true` pour autoriser les clients WCF pour obtenir des informations sur les exceptions d’opération de service interne.</span><span class="sxs-lookup"><span data-stu-id="bf329-139">In addition, you can set the <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property or the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property to `true` to permit WCF clients to obtain information about internal service operation exceptions.</span></span> <span data-ttu-id="bf329-140">Envoi d’erreurs individuelles et de définir les propriétés de comportement de débogage sont décrites dans [Sending and Receiving Faults](../../../docs/framework/wcf/sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="bf329-140">Both sending individual faults and setting the debugging behavior properties are described in [Sending and Receiving Faults](../../../docs/framework/wcf/sending-and-receiving-faults.md).</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="bf329-141">Étant donné que les exceptions managées peuvent exposer des informations d’application internes, paramètre <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> ou <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> à `true` peut autoriser les clients WCF pour obtenir des informations sur les exceptions d’opération de service interne, y compris personnelle identifiables ou autres informations sensibles.</span><span class="sxs-lookup"><span data-stu-id="bf329-141">Because managed exceptions can expose internal application information, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` can permit WCF clients to obtain information about internal service operation exceptions, including personally identifiable or other sensitive information.</span></span>  
>   
>  <span data-ttu-id="bf329-142">Par conséquent, affecter à <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> ou à <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> la valeur `true` est recommandé uniquement pour déboguer temporairement une application de service.</span><span class="sxs-lookup"><span data-stu-id="bf329-142">Therefore, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` is recommended only as a way to temporarily debug a service application.</span></span> <span data-ttu-id="bf329-143">De plus, le WSDL pour une méthode qui retourne des exceptions managées non prises en charge de cette façon ne contient pas le contrat pour le <xref:System.ServiceModel.FaultException%601> de type <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="bf329-143">In addition, the WSDL for a method that returns unhandled managed exceptions in this way does not contain the contract for the <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="bf329-144">Les clients doivent attendre une erreur SOAP inconnue (retournée aux clients WCF en tant que <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> objets) pour obtenir les informations de débogage correctement.</span><span class="sxs-lookup"><span data-stu-id="bf329-144">Clients must expect the possibility of an unknown SOAP fault (returned to WCF clients as <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> objects) to obtain the debugging information properly.</span></span>  
  
## <a name="customizing-error-handling-with-ierrorhandler"></a><span data-ttu-id="bf329-145">Personnalisation de la gestion des erreurs avec IErrorHandler</span><span class="sxs-lookup"><span data-stu-id="bf329-145">Customizing Error Handling with IErrorHandler</span></span>  
 <span data-ttu-id="bf329-146">Si vous avez des spécifications spéciales pour personnaliser le message de réponse au client lorsqu'une exception au niveau de l'application se produit ou pour effectuer un traitement personnalisé après avoir retourné le message de réponse, implémentez l'interface <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="bf329-146">If you have special requirements to either customize the response message to the client when an application-level exception happens or perform some custom processing after the response message is returned, implement the <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType> interface.</span></span>  
  
## <a name="fault-serialization-issues"></a><span data-ttu-id="bf329-147">Problèmes de sérialisation d'erreur</span><span class="sxs-lookup"><span data-stu-id="bf329-147">Fault Serialization Issues</span></span>  
 <span data-ttu-id="bf329-148">Lors de la désérialisation d'un contrat d'erreur, WCF essaie d'abord de faire correspondre le nom du contrat d'erreur figurant dans le message SOAP avec le type de contrat d'erreur.</span><span class="sxs-lookup"><span data-stu-id="bf329-148">When deserializing a fault contract, WCF first attempts to match the fault contract name in the SOAP message with the fault contract type.</span></span> <span data-ttu-id="bf329-149">S'il ne trouve pas de correspondance exacte, il recherche ensuite un type compatible dans la liste des contrats d'erreur disponibles, par ordre alphabétique.</span><span class="sxs-lookup"><span data-stu-id="bf329-149">If it cannot find an exact match it will then search the list of available fault contracts in alphabetical order for a compatible type.</span></span> <span data-ttu-id="bf329-150">Si deux contrats d'erreur sont des types compatibles (l'un étant une sous-classe de l'autre, par exemple), il est possible que le mauvais soit utilisé pour désérialiser l'erreur.</span><span class="sxs-lookup"><span data-stu-id="bf329-150">If two fault contracts are compatible types (one is a subclass of another, for example) the wrong type may be used to de-serialize the fault.</span></span> <span data-ttu-id="bf329-151">Cela ne se produit que lorsque le contrat  d'erreur ne spécifie pas de nom, d'espace de noms et d'action.</span><span class="sxs-lookup"><span data-stu-id="bf329-151">This only occurs if the fault contract does not specify a name, namespace, and action.</span></span> <span data-ttu-id="bf329-152">Pour éviter la survenue de ce problème, qualifiez toujours les contrats d'erreur en spécifiant les attributs de nom, d'espace de noms et d'action.</span><span class="sxs-lookup"><span data-stu-id="bf329-152">To prevent this issue from occurring, always fully qualify fault contracts by specifying the name, namespace, and action attributes.</span></span> <span data-ttu-id="bf329-153">En outre, si vous avez défini un certain nombre de contrats d'erreur connexes dérivés d'une classe de base partagée, veillez à marquer tout nouveau membre avec `[DataMember(IsRequired=true)]`.</span><span class="sxs-lookup"><span data-stu-id="bf329-153">Additionally if you have defined a number of related fault contracts derived from a shared base class, make sure to mark any new members with `[DataMember(IsRequired=true)]`.</span></span> <span data-ttu-id="bf329-154">Pour plus d'informations sur cet attribut `IsRequired`, consultez <xref:System.Runtime.Serialization.DataMemberAttribute>.</span><span class="sxs-lookup"><span data-stu-id="bf329-154">For more information on this `IsRequired` attribute see, <xref:System.Runtime.Serialization.DataMemberAttribute>.</span></span> <span data-ttu-id="bf329-155">Cela empêchera une classe de base d'être un type compatible et forcera la désérialisation de l'erreur vers le type dérivé approprié.</span><span class="sxs-lookup"><span data-stu-id="bf329-155">This will prevent a base class from being a compatible type and force the fault to be deserialized into the correct derived type.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="bf329-156">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="bf329-156">See also</span></span>

- <xref:System.ServiceModel.FaultException>
- <xref:System.ServiceModel.FaultContractAttribute>
- <xref:System.ServiceModel.FaultException>
- <xref:System.Xml.Serialization.XmlSerializer>
- <xref:System.ServiceModel.XmlSerializerFormatAttribute>
- <xref:System.ServiceModel.FaultContractAttribute>
- <xref:System.ServiceModel.CommunicationException>
- <xref:System.ServiceModel.FaultContractAttribute.Action%2A>
- <xref:System.ServiceModel.FaultException.Code%2A>
- <xref:System.ServiceModel.FaultException.Reason%2A>
- <xref:System.ServiceModel.FaultCode.SubCode%2A>
- <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A>
- [<span data-ttu-id="bf329-157">Définition et spécification des erreurs</span><span class="sxs-lookup"><span data-stu-id="bf329-157">Defining and Specifying Faults</span></span>](../../../docs/framework/wcf/defining-and-specifying-faults.md)

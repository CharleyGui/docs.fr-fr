---
title: 'Comment : créer un authentificateur de jetons de sécurité personnalisé'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
ms.assetid: 10e245f7-d31e-42e7-82a2-d5780325d372
ms.openlocfilehash: b8e964b1124bb19faa79b0dc5e4ecebd83a56acf
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/07/2019
ms.locfileid: "70797066"
---
# <a name="how-to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="4e7cf-102">Comment : créer un authentificateur de jetons de sécurité personnalisé</span><span class="sxs-lookup"><span data-stu-id="4e7cf-102">How to: create a custom security token authenticator</span></span>
<span data-ttu-id="4e7cf-103">Cette rubrique indique comment créer un authentificateur de jetons de sécurité personnalisé et comment l'intégrer à un gestionnaire de jetons de sécurité personnalisé.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-103">This topic shows how to create a custom security token authenticator and how to integrate it with a custom security token manager.</span></span> <span data-ttu-id="4e7cf-104">Un authentificateur de jetons de sécurité valide le contenu du jeton de sécurité fourni par le message entrant.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-104">A security token authenticator validates the content of a security token provided with an incoming message.</span></span> <span data-ttu-id="4e7cf-105">Lorsque le processus de validation réussit, l’authentificateur retourne une collection d’instances <xref:System.IdentityModel.Policy.IAuthorizationPolicy> qui, après évaluation, retourne un ensemble de revendications.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-105">If the validation succeeds, the authenticator returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances that, when evaluated, returns a set of claims.</span></span>  
  
 <span data-ttu-id="4e7cf-106">Pour utiliser un authentificateur de jetons de sécurité personnalisé dans Windows Communication Foundation (WCF), vous devez d’abord créer des informations d’identification personnalisées et des implémentations de gestionnaire de jetons de sécurité.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-106">To use a custom security token authenticator in Windows Communication Foundation (WCF), you must first create custom credentials and security token manager implementations.</span></span> <span data-ttu-id="4e7cf-107">Pour plus d’informations sur la création d’informations d’identification personnalisées et d' [un gestionnaire de jetons de sécurité, consultez Procédure pas à pas : Création d’informations d’identification](walkthrough-creating-custom-client-and-service-credentials.md)de client et de service personnalisées.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-107">For more information about creating custom credentials and a security token manager, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>
  
## <a name="procedures"></a><span data-ttu-id="4e7cf-108">Procédures</span><span class="sxs-lookup"><span data-stu-id="4e7cf-108">Procedures</span></span>  
  
#### <a name="to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="4e7cf-109">Pour créer un authentificateur de jetons de sécurité personnalisé</span><span class="sxs-lookup"><span data-stu-id="4e7cf-109">To create a custom security token authenticator</span></span>  
  
1. <span data-ttu-id="4e7cf-110">Définissez une nouvelle classe dérivée de la classe <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-110">Define a new class derived from the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> class.</span></span>  
  
2. <span data-ttu-id="4e7cf-111">Remplacez la méthode <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> .</span><span class="sxs-lookup"><span data-stu-id="4e7cf-111">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> method.</span></span> <span data-ttu-id="4e7cf-112">La méthode retourne la valeur `true` ou `false` selon si l'authentificateur personnalisé peut ou non valider le type de jeton entrant.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-112">The method returns `true` or `false` depending on whether the custom authenticator can validate the incoming token type or not.</span></span>  
  
3. <span data-ttu-id="4e7cf-113">Remplacez la méthode <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> .</span><span class="sxs-lookup"><span data-stu-id="4e7cf-113">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> method.</span></span> <span data-ttu-id="4e7cf-114">Cette méthode doit valider le contenu des jetons de manière adéquate.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-114">This method needs to validate the token contents appropriately.</span></span> <span data-ttu-id="4e7cf-115">Si le jeton passe l'étape de validation, il retourne une collection d'instances <xref:System.IdentityModel.Policy.IAuthorizationPolicy>.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-115">If the token passes the validation step, it returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances.</span></span> <span data-ttu-id="4e7cf-116">L'exemple suivant utilise une implémentation de la stratégie d'autorisation personnalisée, laquelle sera créée au cours de la procédure suivante.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-116">The following example uses a custom authorization policy implementation that will be created in the next procedure.</span></span>  
  
     [!code-csharp[C_CustomTokenAuthenticator#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#1)]
     [!code-vb[C_CustomTokenAuthenticator#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#1)]  
  
 <span data-ttu-id="4e7cf-117">Le code précédent retourne une collection de stratégies d’autorisation dans la méthode <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29>.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-117">The previous code returns a collection of authorization policies in the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="4e7cf-118">WCF ne fournit pas d’implémentation publique de cette interface.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-118">WCF does not provide a public implementation of this interface.</span></span> <span data-ttu-id="4e7cf-119">La procédure suivante indique comment procéder à cette implémentation publique, si requis par vos propres exigences.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-119">The following procedure shows how to do so for your own requirements.</span></span>  
  
#### <a name="to-create-a-custom-authorization-policy"></a><span data-ttu-id="4e7cf-120">Pour créer une stratégie d'autorisation personnalisée</span><span class="sxs-lookup"><span data-stu-id="4e7cf-120">To create a custom authorization policy</span></span>  
  
1. <span data-ttu-id="4e7cf-121">Définissez une nouvelle classe qui implémente l'interface <xref:System.IdentityModel.Policy.IAuthorizationPolicy>.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-121">Define a new class implementing the <xref:System.IdentityModel.Policy.IAuthorizationPolicy> interface.</span></span>  
  
2. <span data-ttu-id="4e7cf-122">Implémentez la propriété en lecture seule <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A>.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-122">Implement the <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> read-only property.</span></span> <span data-ttu-id="4e7cf-123">L'une des solutions permettant d'implémenter cette propriété consiste à générer un identificateur global unique (Globally Unique Identifier, GUID) dans le constructeur de classe, puis de retourner cette propriété à chaque fois que sa valeur est demandée.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-123">One way to implement this property is to generate a globally unique identifier (GUID) in the class constructor and return it every time the value for this property is requested.</span></span>  
  
3. <span data-ttu-id="4e7cf-124">Implémentez la propriété en lecture seule <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A>.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-124">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> read-only property.</span></span> <span data-ttu-id="4e7cf-125">Cette propriété doit retourner l'émetteur correspondant à tous les ensembles de revendications obtenus à partir du jeton.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-125">This property needs to return an issuer of the claim sets that are obtained from the token.</span></span> <span data-ttu-id="4e7cf-126">Cet émetteur doit correspondre à l'émetteur du jeton ou à une autorité chargée de valider le contenu des jetons.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-126">This issuer should correspond to the issuer of the token or an authority that is responsible for validating the token contents.</span></span> <span data-ttu-id="4e7cf-127">L'exemple suivant utilise la revendication d'émetteur passée à cette classe à partir de l'authentificateur de jetons de sécurité personnalisé créé au cours de la procédure précédente.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-127">The following example uses the issuer claim that passed to this class from the custom security token authenticator created in the previous procedure.</span></span> <span data-ttu-id="4e7cf-128">L'authentificateur de jetons de sécurité personnalisé utilise l'ensemble des revendications fournies par le système (ensemble retourné par la propriété <xref:System.IdentityModel.Claims.ClaimSet.System%2A>) pour représenter l'émetteur de jeton de nom d'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-128">The custom security token authenticator uses the system-provided claim set (returned by the <xref:System.IdentityModel.Claims.ClaimSet.System%2A> property) to represent the issuer of the username token.</span></span>  
  
4. <span data-ttu-id="4e7cf-129">Implémentez la méthode <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A>.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-129">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> method.</span></span> <span data-ttu-id="4e7cf-130">Cette méthode remplit une instance de la classe <xref:System.IdentityModel.Policy.EvaluationContext> (passée sous forme d’argument) avec les revendications basées sur le contenu des jetons de sécurité entrants.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-130">This method populates an instance of the <xref:System.IdentityModel.Policy.EvaluationContext> class (passed in as an argument) with claims that are based on the incoming security token content.</span></span> <span data-ttu-id="4e7cf-131">Cette méthode retourne la valeur `true` lorsque ce processus se déroule dans le cadre d'une évaluation.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-131">The method returns `true` when it is done with the evaluation.</span></span> <span data-ttu-id="4e7cf-132">Lorsque l'implémentation s'appuie sur des stratégies d'autorisation fournissant des informations supplémentaires au contexte d'évaluation, cette méthode peut retourner la valeur `false` si les informations requises ne figurent pas encore dans le contexte d'évaluation.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-132">In cases when the implementation relies on the presence of other authorization policies that provide additional information to the evaluation context, this method can return `false` if the required information is not present yet in the evaluation context.</span></span> <span data-ttu-id="4e7cf-133">Dans ce cas, WCF appelle à nouveau la méthode après l’évaluation de toutes les autres stratégies d’autorisation générées pour le message entrant si au moins l’une de ces stratégies d’autorisation a modifié le contexte d’évaluation.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-133">In that case, WCF will call the method again after evaluating all other authorization policies generated for the incoming message if at least one of those authorization policies modified the evaluation context.</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#3)]
     [!code-vb[c_CustomTokenAuthenticator#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#3)]  

 <span data-ttu-id="4e7cf-134">[Procédure pas à pas : Création d’informations d’identification](walkthrough-creating-custom-client-and-service-credentials.md) de client et de service personnalisées décrit comment créer des informations d’identification personnalisées et un gestionnaire de jetons de sécurité personnalisé.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-134">[Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md) describes how to create custom credentials and a custom security token manager.</span></span> <span data-ttu-id="4e7cf-135">Pour utiliser l'authentificateur de jetons de sécurité personnalisés créé ici, une implémentation du gestionnaire de jetons de sécurité est modifiée pour retourner l'authentificateur personnalisé à partir de la méthode <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A>.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-135">To use the custom security token authenticator created here, an implementation of the security token manager is modified to return the custom authenticator from the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method.</span></span> <span data-ttu-id="4e7cf-136">La méthode retourne un authentificateur lorsqu’une exigence de jeton de sécurité appropriée est passée.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-136">The method returns an authenticator when an appropriate security token requirement is passed in.</span></span>  
  
#### <a name="to-integrate-a-custom-security-token-authenticator-with-a-custom-security-token-manager"></a><span data-ttu-id="4e7cf-137">Pour intégrer un authentificateur de jetons de sécurité personnalisés à un gestionnaire de jetons de sécurité personnalisés</span><span class="sxs-lookup"><span data-stu-id="4e7cf-137">To integrate a custom security token authenticator with a custom security token manager</span></span>  
  
1. <span data-ttu-id="4e7cf-138">Remplacez la méthode <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> dans votre implémentation de gestionnaire de jetons de sécurité personnalisés.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-138">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method in your custom security token manager implementation.</span></span>  
  
2. <span data-ttu-id="4e7cf-139">Ajoutez de la logique à la méthode pour lui permettre de retourner votre authentificateur de jetons de sécurité personnalisés basée sur le paramètre <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>.</span><span class="sxs-lookup"><span data-stu-id="4e7cf-139">Add logic to the method to enable it to return your custom security token authenticator based on the <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parameter.</span></span> <span data-ttu-id="4e7cf-140">L’exemple suivant retourne un authentificateur de jetons de sécurité personnalisé si le type du jeton correspond à un nom d’utilisateur (représenté par la propriété <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A>) et si la direction de message pour laquelle l’authentificateur de jetons de sécurité est demandé correspond à entrée (représentée par le champ <xref:System.ServiceModel.Description.MessageDirection.Input> ).</span><span class="sxs-lookup"><span data-stu-id="4e7cf-140">The following example returns a custom security token authenticator if the token requirements token type is a user name (represented by the <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> property) and the message direction for which the security token authenticator is being requested is input (represented by the <xref:System.ServiceModel.Description.MessageDirection.Input> field).</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#2)]
     [!code-vb[c_CustomTokenAuthenticator#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#2)]  
 
## <a name="see-also"></a><span data-ttu-id="4e7cf-141">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="4e7cf-141">See also</span></span>

- <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>
- <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>
- <xref:System.IdentityModel.Selectors.SecurityTokenManager>
- <xref:System.IdentityModel.Tokens.UserNameSecurityToken>
- [<span data-ttu-id="4e7cf-142">Procédure pas à pas : Création d’informations d’identification de client et de service personnalisées</span><span class="sxs-lookup"><span data-stu-id="4e7cf-142">Walkthrough: Creating Custom Client and Service Credentials</span></span>](walkthrough-creating-custom-client-and-service-credentials.md)
- [<span data-ttu-id="4e7cf-143">Guide pratique : Créer un fournisseur de jetons de sécurité personnalisé</span><span class="sxs-lookup"><span data-stu-id="4e7cf-143">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)

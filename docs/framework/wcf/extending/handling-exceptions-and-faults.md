---
title: Gestion des exceptions et des erreurs
ms.date: 03/30/2017
ms.assetid: a64d01c6-f221-4f58-93e5-da4e87a5682e
ms.openlocfilehash: bca77b575be65513f9a792352e14e3f9bd7b4904
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79185631"
---
# <a name="handling-exceptions-and-faults"></a><span data-ttu-id="843a8-102">Gestion des exceptions et des erreurs</span><span class="sxs-lookup"><span data-stu-id="843a8-102">Handling Exceptions and Faults</span></span>
<span data-ttu-id="843a8-103">Les exceptions sont utilisées pour communiquer localement des erreurs au sein du service ou de l'implémentation cliente.</span><span class="sxs-lookup"><span data-stu-id="843a8-103">Exceptions are used to communicate errors locally within the service or the client implementation.</span></span> <span data-ttu-id="843a8-104">Les erreurs, en revanche, sont utilisées pour communiquer des erreurs au-delà des limites du service, notamment du serveur au client ou vice versa.</span><span class="sxs-lookup"><span data-stu-id="843a8-104">Faults, on the other hand, are used to communicate errors across service boundaries, such as from the server to the client or vice versa.</span></span> <span data-ttu-id="843a8-105">En plus des erreurs, les canaux de transport utilisent souvent des mécanismes propres au transport pour communiquer des erreurs de niveau transport.</span><span class="sxs-lookup"><span data-stu-id="843a8-105">In addition to faults, transport channels often use transport-specific mechanisms to communicate transport-level errors.</span></span> <span data-ttu-id="843a8-106">Par exemple, le transport HTTP utilise des codes d'état tels que 404 pour communiquer une URL de point de terminaison inexistante (il n'existe aucun point de terminaison pour renvoyer une erreur).</span><span class="sxs-lookup"><span data-stu-id="843a8-106">For example, HTTP transport uses status codes such as 404 to communicate a non-existing endpoint URL (there is no endpoint to send back a fault).</span></span> <span data-ttu-id="843a8-107">Ce document se compose de trois sections qui fournissent des indications aux auteurs de canaux personnalisés.</span><span class="sxs-lookup"><span data-stu-id="843a8-107">This document consists of three sections that provide guidance to custom channel authors.</span></span> <span data-ttu-id="843a8-108">La première section indique quand et comment définir et lever des exceptions.</span><span class="sxs-lookup"><span data-stu-id="843a8-108">The first section provides guidance on when and how to define and throw exceptions.</span></span> <span data-ttu-id="843a8-109">La deuxième section fournir des indications sur la génération et la consommation des erreurs.</span><span class="sxs-lookup"><span data-stu-id="843a8-109">The second section provides guidance around generating and consuming faults.</span></span> <span data-ttu-id="843a8-110">La troisième section explique comment fournir des informations de suivi afin d'aider l'utilisateur de votre canal personnalisé à résoudre les problèmes des applications en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="843a8-110">The third section explains how to provide trace information to aid the user of your custom channel in troubleshooting running applications.</span></span>  
  
## <a name="exceptions"></a><span data-ttu-id="843a8-111">Exceptions</span><span class="sxs-lookup"><span data-stu-id="843a8-111">Exceptions</span></span>  
 <span data-ttu-id="843a8-112">Il y a deux choses à ne pas oublier pour lever une exception : primo, elle doit être d'un type qui permet aux utilisateurs d'écrire le code correct pouvant réagir convenablement à l'exception.</span><span class="sxs-lookup"><span data-stu-id="843a8-112">There are two things to keep in mind when throwing an exception: First it has to be of a type that allows users to write correct code that can react appropriately to the exception.</span></span> <span data-ttu-id="843a8-113">Secondo, elle doit fournir suffisamment d'informations à l'utilisateur afin qu'il comprenne ce qui ne s'est pas produit correctement, l'impact de l'échec et la manière d'y remédier.</span><span class="sxs-lookup"><span data-stu-id="843a8-113">Second, it has to provide enough information for the user to understand what went wrong, the failure impact, and how to fix it.</span></span> <span data-ttu-id="843a8-114">Les sections suivantes donnent des conseils sur les types d’exceptions et les messages pour les canaux de la Fondation de communication Windows (WCF).</span><span class="sxs-lookup"><span data-stu-id="843a8-114">The following sections give guidance around exception types and messages for Windows Communication Foundation (WCF) channels.</span></span> <span data-ttu-id="843a8-115">Des indications générales sur les exceptions dans .NET sont également données dans le document Règles de conception pour les exceptions.</span><span class="sxs-lookup"><span data-stu-id="843a8-115">There is also general guidance around exceptions in .NET in the Design Guidelines for Exceptions document.</span></span>  
  
### <a name="exception-types"></a><span data-ttu-id="843a8-116">Types d'exceptions</span><span class="sxs-lookup"><span data-stu-id="843a8-116">Exception Types</span></span>  
 <span data-ttu-id="843a8-117">Toutes les exceptions levées par les canaux doivent être soit <xref:System.TimeoutException?displayProperty=nameWithType>, <xref:System.ServiceModel.CommunicationException?displayProperty=nameWithType>, soit un type dérivé de <xref:System.ServiceModel.CommunicationException>.</span><span class="sxs-lookup"><span data-stu-id="843a8-117">All exceptions thrown by channels must be either a <xref:System.TimeoutException?displayProperty=nameWithType>, <xref:System.ServiceModel.CommunicationException?displayProperty=nameWithType>, or a type derived from <xref:System.ServiceModel.CommunicationException>.</span></span> <span data-ttu-id="843a8-118">(Les exceptions telles que <xref:System.ObjectDisposedException> peuvent également être levées, mais uniquement pour indiquer que le code appelant a utilisé le canal incorrectement.</span><span class="sxs-lookup"><span data-stu-id="843a8-118">(Exceptions such as <xref:System.ObjectDisposedException> may also be thrown, but only to indicate that the calling code has misused the channel.</span></span> <span data-ttu-id="843a8-119">Si un canal est utilisé correctement, il ne doit lancer que les exceptions données.) WCF fournit sept types <xref:System.ServiceModel.CommunicationException> d’exception qui dérivent et sont conçus pour être utilisés par les canaux.</span><span class="sxs-lookup"><span data-stu-id="843a8-119">If a channel is used correctly, it must only throw the given exceptions.) WCF provides seven exception types that derive from <xref:System.ServiceModel.CommunicationException> and are designed to be used by channels.</span></span> <span data-ttu-id="843a8-120">Il existe d'autres exceptions dérivées de <xref:System.ServiceModel.CommunicationException> conçues pour être utilisées par d'autres parties du système.</span><span class="sxs-lookup"><span data-stu-id="843a8-120">There are other <xref:System.ServiceModel.CommunicationException>-derived exceptions that are designed to be used by other parts of the system.</span></span> <span data-ttu-id="843a8-121">Ces types d'exceptions sont :</span><span class="sxs-lookup"><span data-stu-id="843a8-121">These exception types are:</span></span>  
  
|<span data-ttu-id="843a8-122">Type d’exception</span><span class="sxs-lookup"><span data-stu-id="843a8-122">Exception Type</span></span>|<span data-ttu-id="843a8-123">Signification</span><span class="sxs-lookup"><span data-stu-id="843a8-123">Meaning</span></span>|<span data-ttu-id="843a8-124">Contenu d'exception interne</span><span class="sxs-lookup"><span data-stu-id="843a8-124">Inner Exception Content</span></span>|<span data-ttu-id="843a8-125">Planification d’une stratégie de récupération</span><span class="sxs-lookup"><span data-stu-id="843a8-125">Recovery Strategy</span></span>|  
|--------------------|-------------|-----------------------------|-----------------------|  
|<xref:System.ServiceModel.AddressAlreadyInUseException>|<span data-ttu-id="843a8-126">L'adresse de point de terminaison spécifiée pour l'écoute est déjà utilisée.</span><span class="sxs-lookup"><span data-stu-id="843a8-126">The endpoint address specified for listening is already in use.</span></span>|<span data-ttu-id="843a8-127">Le cas échéant, fournit plus de détails à propos de l'erreur de transport qui a provoqué cette exception.</span><span class="sxs-lookup"><span data-stu-id="843a8-127">If present, provides more details about the transport error that caused this exception.</span></span> <span data-ttu-id="843a8-128">Par exemple,</span><span class="sxs-lookup"><span data-stu-id="843a8-128">For example.</span></span> <span data-ttu-id="843a8-129"><xref:System.IO.PipeException>, <xref:System.Net.HttpListenerException>, ou <xref:System.Net.Sockets.SocketException>.</span><span class="sxs-lookup"><span data-stu-id="843a8-129"><xref:System.IO.PipeException>, <xref:System.Net.HttpListenerException>, or <xref:System.Net.Sockets.SocketException>.</span></span>|<span data-ttu-id="843a8-130">Essayez une autre adresse.</span><span class="sxs-lookup"><span data-stu-id="843a8-130">Try a different address.</span></span>|  
|<xref:System.ServiceModel.AddressAccessDeniedException>|<span data-ttu-id="843a8-131">L'accès à l'adresse de point de terminaison spécifiée pour l'écoute n'est pas autorisé au processus.</span><span class="sxs-lookup"><span data-stu-id="843a8-131">The process is not allowed access to the endpoint address specified for listening.</span></span>|<span data-ttu-id="843a8-132">Le cas échéant, fournit plus de détails à propos de l'erreur de transport qui a provoqué cette exception.</span><span class="sxs-lookup"><span data-stu-id="843a8-132">If present, provides more details about the transport error that caused this exception.</span></span> <span data-ttu-id="843a8-133">Par exemple, <xref:System.IO.PipeException> ou <xref:System.Net.HttpListenerException>.</span><span class="sxs-lookup"><span data-stu-id="843a8-133">For example, <xref:System.IO.PipeException>, or <xref:System.Net.HttpListenerException>.</span></span>|<span data-ttu-id="843a8-134">Essayez avec d'autres informations d'identification.</span><span class="sxs-lookup"><span data-stu-id="843a8-134">Try with different credentials.</span></span>|  
|<xref:System.ServiceModel.CommunicationObjectFaultedException>|<span data-ttu-id="843a8-135">L’utilisation <xref:System.ServiceModel.ICommunicationObject> est dans l’état défectueux (pour plus d’informations, voir [Comprendre les changements d’état](understanding-state-changes.md)).</span><span class="sxs-lookup"><span data-stu-id="843a8-135">The <xref:System.ServiceModel.ICommunicationObject> being used is in the Faulted state (for more information, see [Understanding State Changes](understanding-state-changes.md)).</span></span> <span data-ttu-id="843a8-136">Notez que lorsqu'un objet avec plusieurs appels en attente passe dans l'état Faulted, un seul appel lève une exception liée à l'échec et le reste des appels lèvent une <xref:System.ServiceModel.CommunicationObjectFaultedException>.</span><span class="sxs-lookup"><span data-stu-id="843a8-136">Note that when an object with multiple pending calls transitions to the Faulted state, only one call throws an exception that is related to the failure and the rest of the calls throw a <xref:System.ServiceModel.CommunicationObjectFaultedException>.</span></span> <span data-ttu-id="843a8-137">Cette exception est généralement levée parce qu'une application oublie une certaine exception et essaie d'utiliser un objet déjà dans un état Faulted, éventuellement sur un thread autre que celui qui a intercepté l'exception d'origine.</span><span class="sxs-lookup"><span data-stu-id="843a8-137">This exception is typically thrown because an application overlooks some exception and tries to use an already faulted object, possibly on a thread other than the one that caught the original exception.</span></span>|<span data-ttu-id="843a8-138">Le cas échéant, fournit des détails à propos de l'exception interne.</span><span class="sxs-lookup"><span data-stu-id="843a8-138">If present provides details about the inner exception.</span></span>|<span data-ttu-id="843a8-139">Créez un nouvel objet.</span><span class="sxs-lookup"><span data-stu-id="843a8-139">Create a new object.</span></span> <span data-ttu-id="843a8-140">Notez qu'en fonction de ce qui a provoqué l'erreur de <xref:System.ServiceModel.ICommunicationObject> au départ, il existe peut-être d'autre travail requis à récupérer.</span><span class="sxs-lookup"><span data-stu-id="843a8-140">Note that depending on what caused the <xref:System.ServiceModel.ICommunicationObject> to fault in the first place, there may be other work required to recover.</span></span>|  
|<xref:System.ServiceModel.CommunicationObjectAbortedException>|<span data-ttu-id="843a8-141">L’utilisation <xref:System.ServiceModel.ICommunicationObject> a été avortée (pour plus d’informations, voir [Comprendre les changements d’état](understanding-state-changes.md)).</span><span class="sxs-lookup"><span data-stu-id="843a8-141">The <xref:System.ServiceModel.ICommunicationObject> being used has been Aborted (for more information, see [Understanding State Changes](understanding-state-changes.md)).</span></span> <span data-ttu-id="843a8-142">Semblable à <xref:System.ServiceModel.CommunicationObjectFaultedException>, son exception indique que l'application a appelé <xref:System.ServiceModel.ICommunicationObject.Abort%2A> sur l'objet, peut-être à partir d'un autre thread, et l'objet n'est plus utilisable pour cette raison.</span><span class="sxs-lookup"><span data-stu-id="843a8-142">Similar to <xref:System.ServiceModel.CommunicationObjectFaultedException>, his exception indicates the application has called <xref:System.ServiceModel.ICommunicationObject.Abort%2A> on the object, possibly from another thread, and the object is no longer usable for that reason.</span></span>|<span data-ttu-id="843a8-143">Le cas échéant, fournit des détails à propos de l'exception interne.</span><span class="sxs-lookup"><span data-stu-id="843a8-143">If present provides details about the inner exception.</span></span>|<span data-ttu-id="843a8-144">Créez un nouvel objet.</span><span class="sxs-lookup"><span data-stu-id="843a8-144">Create a new object.</span></span> <span data-ttu-id="843a8-145">Notez qu'en fonction de ce qui a provoqué l'abandon de <xref:System.ServiceModel.ICommunicationObject> au départ, il existe peut-être d'autre travail requis à récupérer.</span><span class="sxs-lookup"><span data-stu-id="843a8-145">Note that depending on what caused the <xref:System.ServiceModel.ICommunicationObject> to abort in the first place, there may be other work required to recover.</span></span>|  
|<xref:System.ServiceModel.EndpointNotFoundException>|<span data-ttu-id="843a8-146">Le point de terminaison distant cible n'écoute pas.</span><span class="sxs-lookup"><span data-stu-id="843a8-146">The target remote endpoint is not listening.</span></span> <span data-ttu-id="843a8-147">Cette erreur peut être due au fait qu'une partie de l'adresse de point de terminaison est incorrecte ou ne peut pas être résolue ou au fait que le point de terminaison est arrêté.</span><span class="sxs-lookup"><span data-stu-id="843a8-147">This can result from any part of the endpoint address being incorrect, irresolvable, or the endpoint being down.</span></span> <span data-ttu-id="843a8-148">Des exemples incluent l'erreur DNS, l'indisponibilité du gestionnaire de files d'attente et la non-exécution du service.</span><span class="sxs-lookup"><span data-stu-id="843a8-148">Examples include DNS error, Queue Manager not available, and service not running.</span></span>|<span data-ttu-id="843a8-149">L'exception interne fournit des détails, en général à partir du transport sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="843a8-149">The inner exception provides details, typically from the underlying transport.</span></span>|<span data-ttu-id="843a8-150">Essayez une autre adresse.</span><span class="sxs-lookup"><span data-stu-id="843a8-150">Try a different address.</span></span> <span data-ttu-id="843a8-151">L'expéditeur peut également patienter un instant et réessayer au cas où le service serait interrompu.</span><span class="sxs-lookup"><span data-stu-id="843a8-151">Alternatively, the sender may wait a while and try again in case the service was down</span></span>|  
|<xref:System.ServiceModel.ProtocolException>|<span data-ttu-id="843a8-152">Les protocoles de communication, tels qu'ils sont décrits par la stratégie du point de terminaison, ne correspondent pas entre des points de terminaison.</span><span class="sxs-lookup"><span data-stu-id="843a8-152">The communication protocols, as described by the endpoint’s policy, are mismatched between endpoints.</span></span> <span data-ttu-id="843a8-153">Par exemple, incompatibilité du type de contenu de tramage ou dépassement de la taille maximale des messages.</span><span class="sxs-lookup"><span data-stu-id="843a8-153">For example, framing content type mismatch or max message size exceeded.</span></span>|<span data-ttu-id="843a8-154">Le cas échéant, fournit plus d'informations sur l'erreur de protocole spécifique.</span><span class="sxs-lookup"><span data-stu-id="843a8-154">If present provides more information about the specific protocol error.</span></span> <span data-ttu-id="843a8-155">Par exemple, <xref:System.ServiceModel.QuotaExceededException> est l'exception interne lorsque la cause de l'erreur est un dépassement de MaxReceivedMessageSize.</span><span class="sxs-lookup"><span data-stu-id="843a8-155">For example, <xref:System.ServiceModel.QuotaExceededException> is the inner exception when the error cause is exceeding MaxReceivedMessageSize.</span></span>|<span data-ttu-id="843a8-156">Récupération : Vérifiez que les paramètres de l'expéditeur et du protocole reçu correspondent.</span><span class="sxs-lookup"><span data-stu-id="843a8-156">Recovery: Ensure sender and received protocol settings match.</span></span> <span data-ttu-id="843a8-157">Une façon d'y parvenir consiste à importer de nouveau les métadonnées du point de terminaison de service (stratégie) et à utiliser la liaison générée pour recréer le canal.</span><span class="sxs-lookup"><span data-stu-id="843a8-157">One way to do this is to re-import the service endpoint’s metadata (policy) and use the generated binding to recreate the channel.</span></span>|  
|<xref:System.ServiceModel.ServerTooBusyException>|<span data-ttu-id="843a8-158">Le point de terminaison distant écoute mais n'est pas préparé pour traiter des messages.</span><span class="sxs-lookup"><span data-stu-id="843a8-158">The remote endpoint is listening but is not prepared to process messages.</span></span>|<span data-ttu-id="843a8-159">Le cas échéant, l'exception interne fournit des détails sur l'erreur SOAP ou sur l'erreur de niveau transport.</span><span class="sxs-lookup"><span data-stu-id="843a8-159">If present, the inner Exception provides the SOAP fault or transport-level error details.</span></span>|<span data-ttu-id="843a8-160">Récupération : attendez et retentez l'opération ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="843a8-160">Recovery: Wait and retry the operation later.</span></span>|  
|<xref:System.TimeoutException>|<span data-ttu-id="843a8-161">L'opération n'a pas réussi à s'effectuer à l'issue du délai d'attente.</span><span class="sxs-lookup"><span data-stu-id="843a8-161">The operation failed to complete within the timeout period.</span></span>|<span data-ttu-id="843a8-162">Fournit éventuellement des détails à propos du délai d'attente.</span><span class="sxs-lookup"><span data-stu-id="843a8-162">May provide details about the timeout.</span></span>|<span data-ttu-id="843a8-163">Attendez et retentez l'opération ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="843a8-163">Wait and retry the operation later.</span></span>|  
  
 <span data-ttu-id="843a8-164">Définissez un nouveau type d'exception uniquement si ce type correspond à une stratégie de récupération spécifique différente de tous les types d'exceptions existants.</span><span class="sxs-lookup"><span data-stu-id="843a8-164">Define a new exception type only if that type corresponds to a specific recovery strategy different from all of the existing exception types.</span></span> <span data-ttu-id="843a8-165">Si vous définissez un nouveau type d'exception, il doit dériver de <xref:System.ServiceModel.CommunicationException> ou d'une de ses classes dérivées.</span><span class="sxs-lookup"><span data-stu-id="843a8-165">If you do define a new exception type, it must derive from <xref:System.ServiceModel.CommunicationException> or one of its derived classes.</span></span>  
  
### <a name="exception-messages"></a><span data-ttu-id="843a8-166">Messages d’exception</span><span class="sxs-lookup"><span data-stu-id="843a8-166">Exception Messages</span></span>  
 <span data-ttu-id="843a8-167">Les messages d'exception sont destinés à l'utilisateur et non au programme, ils doivent donc fournir des informations suffisantes pour aider l'utilisateur à comprendre et résoudre le problème.</span><span class="sxs-lookup"><span data-stu-id="843a8-167">Exception messages are targeted at the user not the program so they should provide sufficient information to help the user understand and solve the problem.</span></span> <span data-ttu-id="843a8-168">Les trois parties essentielles d'un bon message d'exception sont :</span><span class="sxs-lookup"><span data-stu-id="843a8-168">The three essential parts of a good exception message are:</span></span>  
  
 <span data-ttu-id="843a8-169">Ce qui s'est passé.</span><span class="sxs-lookup"><span data-stu-id="843a8-169">What happened.</span></span> <span data-ttu-id="843a8-170">Fournissez une description claire du problème à l'aide de termes qui sont en rapport avec l'expérience de l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="843a8-170">Provide a clear description of the problem using terms that relate to the user’s experience.</span></span> <span data-ttu-id="843a8-171">Par exemple, « Section de configuration non valide » serait un mauvais message d'exception.</span><span class="sxs-lookup"><span data-stu-id="843a8-171">For example, a bad exception message would be "Invalid configuration section".</span></span> <span data-ttu-id="843a8-172">En effet, il laisse l'utilisateur se demander quelle section de configuration est incorrecte et pourquoi elle l'est.</span><span class="sxs-lookup"><span data-stu-id="843a8-172">This leaves the user wondering which configuration section is incorrect and why it is incorrect.</span></span> <span data-ttu-id="843a8-173">Un message amélioré serait "Section de configuration invalide \<customBinding>".</span><span class="sxs-lookup"><span data-stu-id="843a8-173">An improved message would be "Invalid configuration section \<customBinding>".</span></span> <span data-ttu-id="843a8-174">Un message encore meilleur serait : « Impossible d’ajouter le transport nommé monTransport à la liaison nommée maLiaison parce que la liaison possède déjà un transport nommé monTransport ».</span><span class="sxs-lookup"><span data-stu-id="843a8-174">An even better message would be "Cannot add the transport named myTransport to the binding named myBinding because the binding already has a transport named myTransport".</span></span> <span data-ttu-id="843a8-175">Il s'agit d'un message très spécifique qui utilise des termes et des noms que l'utilisateur peut facilement identifier dans le fichier de configuration de l'application.</span><span class="sxs-lookup"><span data-stu-id="843a8-175">This is a very specific message using terms and names that the user can easily identify in the application’s configuration file.</span></span> <span data-ttu-id="843a8-176">Toutefois, il existe encore quelques composants clés manquants.</span><span class="sxs-lookup"><span data-stu-id="843a8-176">However, there are still a few key components missing.</span></span>  
  
 <span data-ttu-id="843a8-177">L'importance de l'erreur.</span><span class="sxs-lookup"><span data-stu-id="843a8-177">The significance of the error.</span></span> <span data-ttu-id="843a8-178">Si le message n'indique pas clairement ce que l'erreur signifie, il est probable que l'utilisateur se demande s'il s'agit d'une erreur irrécupérable ou si elle peut être ignorée.</span><span class="sxs-lookup"><span data-stu-id="843a8-178">Unless the message states clearly what the error means, the user is likely to wonder whether it is a fatal error or if it can be ignored.</span></span> <span data-ttu-id="843a8-179">En général, les messages doivent amener la signification ou l'importance de l'erreur.</span><span class="sxs-lookup"><span data-stu-id="843a8-179">In general, messages should lead with the meaning or significance of the error.</span></span> <span data-ttu-id="843a8-180">Pour améliorer l'exemple précédent, le message pourrait être : « ServiceHost n'a pas pu s'ouvrir en raison d'une erreur de configuration : impossible d'ajouter le transport nommé monTransport à la liaison nommée maLiaison parce que la liaison possède déjà un transport nommé monTransport ».</span><span class="sxs-lookup"><span data-stu-id="843a8-180">To improve the previous example, the message could be "ServiceHost failed to Open due to a configuration error: Cannot add the transport named myTransport to the binding named myBinding because the binding already has a transport named myTransport".</span></span>  
  
 <span data-ttu-id="843a8-181">Comment l'utilisateur doit résoudre le problème.</span><span class="sxs-lookup"><span data-stu-id="843a8-181">How the user should correct the problem.</span></span> <span data-ttu-id="843a8-182">La partie la plus importante du message est l'aide apportée à l'utilisateur afin de résoudre le problème.</span><span class="sxs-lookup"><span data-stu-id="843a8-182">The most important part of the message is helping the user fix the problem.</span></span> <span data-ttu-id="843a8-183">Le message doit inclure des indications ou conseils sur ce qu'il doit vérifier ou corriger pour remédier au problème.</span><span class="sxs-lookup"><span data-stu-id="843a8-183">The message should include some guidance or hints about what to check or fix to remedy the problem.</span></span> <span data-ttu-id="843a8-184">Exemple : « ServiceHost n'a pas pu s'ouvrir en raison d'une erreur de configuration : impossible d'ajouter le transport nommé monTransport à la liaison nommée maLiaison parce que la liaison possède déjà un transport nommé monTransport.</span><span class="sxs-lookup"><span data-stu-id="843a8-184">For example, "ServiceHost failed to Open due to a configuration error: Cannot add the transport named myTransport to the binding named myBinding because the binding already has a transport named myTransport.</span></span> <span data-ttu-id="843a8-185">Vérifiez que la liaison comporte un seul transport ».</span><span class="sxs-lookup"><span data-stu-id="843a8-185">Please ensure there is only one transport in the binding".</span></span>  
  
## <a name="communicating-faults"></a><span data-ttu-id="843a8-186">Communication des erreurs</span><span class="sxs-lookup"><span data-stu-id="843a8-186">Communicating Faults</span></span>  
 <span data-ttu-id="843a8-187">SOAP 1.1 et SOAP 1.2 définissent une structure spécifique pour les erreurs.</span><span class="sxs-lookup"><span data-stu-id="843a8-187">SOAP 1.1 and SOAP 1.2 both define a specific structure for faults.</span></span> <span data-ttu-id="843a8-188">Il existe des différences entre les deux spécifications mais en général, les types Message et MessageFault sont utilisés pour créer et consommer des erreurs.</span><span class="sxs-lookup"><span data-stu-id="843a8-188">There are some differences between the two specifications but in general, the Message and MessageFault types are used to create and consume faults.</span></span>  
  
 <span data-ttu-id="843a8-189">![Gestion des exceptions et des défauts](./media/wcfc-soap1-1andsoap1-2faultcomparisonc.gif "wcfc_SOAP1-1AndSOAP1-2FaultComparisonc")</span><span class="sxs-lookup"><span data-stu-id="843a8-189">![Handling exceptions and faults](./media/wcfc-soap1-1andsoap1-2faultcomparisonc.gif "wcfc_SOAP1-1AndSOAP1-2FaultComparisonc")</span></span>  
<span data-ttu-id="843a8-190">Erreur SOAP 1.2 (à gauche) et erreur SOAP 1.1 (à droite).</span><span class="sxs-lookup"><span data-stu-id="843a8-190">SOAP 1.2 Fault (left) and SOAP 1.1 Fault (right).</span></span> <span data-ttu-id="843a8-191">Notez que dans SOAP 1.1, seul l'élément Fault fait l'objet d'une qualification dans l'espace de noms.</span><span class="sxs-lookup"><span data-stu-id="843a8-191">Note that in SOAP 1.1 only the Fault element is namespace qualified.</span></span>  
  
 <span data-ttu-id="843a8-192">SOAP définit un message d'erreur comme un message qui contient uniquement un élément d'erreur (un élément dont le nom est `<env:Fault>`) en tant qu'enfant de `<env:Body>`.</span><span class="sxs-lookup"><span data-stu-id="843a8-192">SOAP defines a fault message as a message that contains only a fault element (an element whose name is `<env:Fault>`) as a child of `<env:Body>`.</span></span> <span data-ttu-id="843a8-193">Le contenu de l'élément d'erreur diffère légèrement entre SOAP 1.1 et SOAP 1.2, comme indiqué à la figure 1.</span><span class="sxs-lookup"><span data-stu-id="843a8-193">The contents of the fault element differ slightly between SOAP 1.1 and SOAP 1.2 as shown in figure 1.</span></span> <span data-ttu-id="843a8-194">Toutefois, la classe <xref:System.ServiceModel.Channels.MessageFault?displayProperty=nameWithType> normalise ces différences dans un modèle objet :</span><span class="sxs-lookup"><span data-stu-id="843a8-194">However, the <xref:System.ServiceModel.Channels.MessageFault?displayProperty=nameWithType> class normalizes these differences into one object model:</span></span>  
  
```csharp
public abstract class MessageFault  
{  
    protected MessageFault();  
  
    public virtual string Actor { get; }  
    public virtual string Node { get; }  
    public static string DefaultAction { get; }  
    public abstract FaultCode Code { get; }  
    public abstract bool HasDetail { get; }  
    public abstract FaultReason Reason { get; }  
  
    public T GetDetail<T>();  
    public T GetDetail<T>( XmlObjectSerializer serializer);  
    public System.Xml.XmlDictionaryReader GetReaderAtDetailContents();  
  
    // other methods omitted  
}  
```  
  
 <span data-ttu-id="843a8-195">La propriété `Code` correspond à `env:Code` (ou `faultCode` dans SOAP 1.1) et identifie le type de l'erreur.</span><span class="sxs-lookup"><span data-stu-id="843a8-195">The `Code` property corresponds to the `env:Code` (or `faultCode` in SOAP 1.1) and identifies the type of the fault.</span></span> <span data-ttu-id="843a8-196">SOAP 1.2 définit cinq valeurs autorisées pour `faultCode` (par exemple, Expéditeur et Destinataire) et définit un élément `Subcode` qui peut contenir une valeur de sous-code.</span><span class="sxs-lookup"><span data-stu-id="843a8-196">SOAP 1.2 defines five allowable values for `faultCode` (for example, Sender and Receiver) and defines a `Subcode` element which can contain any subcode value.</span></span> <span data-ttu-id="843a8-197">(Voir les [spécifications SOAP 1.2](https://www.w3.org/TR/soap12-part1/#tabsoapfaultcodes) pour la liste des codes de défaut autorisés et leur signification.) SOAP 1.1 a un mécanisme légèrement `faultCode` différent: Il définit quatre valeurs (par exemple, Client et Serveur) qui peuvent être `faultCodes`étendues soit en définissant des éléments entièrement nouveaux ou en utilisant la notation point pour créer plus spécifique , par exemple, Client.Authentication.</span><span class="sxs-lookup"><span data-stu-id="843a8-197">(See the [SOAP 1.2 specification](https://www.w3.org/TR/soap12-part1/#tabsoapfaultcodes) for the list of allowable fault codes and their meaning.) SOAP 1.1 has a slightly different mechanism: It defines four `faultCode` values (for example, Client and Server) that can be extended either by defining entirely new ones or by using the dot notation to create more specific `faultCodes`, for example, Client.Authentication.</span></span>  
  
 <span data-ttu-id="843a8-198">Lorsque vous utilisez MessageFault pour programmer les erreurs, FaultCode.Name et FaultCode.Namespace correspondent au nom et à l'espace de noms de SOAP 1.2 `env:Code` ou de SOAP 1.1 `faultCode`.</span><span class="sxs-lookup"><span data-stu-id="843a8-198">When you use MessageFault to program faults, the FaultCode.Name and FaultCode.Namespace maps to the name and namespace of the SOAP 1.2 `env:Code` or the SOAP 1.1 `faultCode`.</span></span> <span data-ttu-id="843a8-199">FaultCode.SubCode correspond à `env:Subcode` pour SOAP 1.2 et à null pour SOAP 1.1.</span><span class="sxs-lookup"><span data-stu-id="843a8-199">The FaultCode.SubCode maps to `env:Subcode` for SOAP 1.2 and is null for SOAP 1.1.</span></span>  
  
 <span data-ttu-id="843a8-200">Vous devez créer des sous-codes d'erreur (ou de nouveaux codes d'erreur si vous utilisez SOAP 1.1) s'il s'avère intéressant de distinguer une erreur par programme.</span><span class="sxs-lookup"><span data-stu-id="843a8-200">You should create new fault subcodes (or new fault codes if using SOAP 1.1) if it is interesting to programmatically distinguish a fault.</span></span> <span data-ttu-id="843a8-201">Cela revient à créer un type d'exception.</span><span class="sxs-lookup"><span data-stu-id="843a8-201">This is analogous to creating a new exception type.</span></span> <span data-ttu-id="843a8-202">Vous devez éviter d'utiliser la notation par point avec les codes d'erreur SOAP 1.1.</span><span class="sxs-lookup"><span data-stu-id="843a8-202">You should avoid using the dot notation with SOAP 1.1 fault codes.</span></span> <span data-ttu-id="843a8-203">(Le [profil de base WS-I](http://www.ws-i.org/Profiles/BasicProfile-1.1-2004-08-24.html#SOAP_Custom_Fault_Codes) décourage également l’utilisation de la notation de point de code de défaut.)</span><span class="sxs-lookup"><span data-stu-id="843a8-203">(The [WS-I Basic Profile](http://www.ws-i.org/Profiles/BasicProfile-1.1-2004-08-24.html#SOAP_Custom_Fault_Codes) also discourages the use of the fault code dot notation.)</span></span>  
  
```csharp
public class FaultCode  
{  
    public FaultCode(string name);  
    public FaultCode(string name, FaultCode subCode);  
    public FaultCode(string name, string ns);  
    public FaultCode(string name, string ns, FaultCode subCode);  
  
    public bool IsPredefinedFault { get; }  
    public bool IsReceiverFault { get; }  
    public bool IsSenderFault { get; }  
    public string Name { get; }  
    public string Namespace { get; }  
    public FaultCode SubCode { get; }  
  
//  methods omitted  
  
}  
```  
  
 <span data-ttu-id="843a8-204">La propriété `Reason` correspond à `env:Reason` (ou à `faultString` dans SOAP 1.1) et constitue une description explicite de la condition d'erreur analogue au message d'une exception.</span><span class="sxs-lookup"><span data-stu-id="843a8-204">The `Reason` property corresponds to the `env:Reason` (or `faultString` in SOAP 1.1) a human-readable description of the error condition analogous to an exception’s message.</span></span> <span data-ttu-id="843a8-205">La classe `FaultReason` (et SOAP `env:Reason/faultString`) possède la prise en charge intégrée de plusieurs traductions dans l'intérêt de la globalisation.</span><span class="sxs-lookup"><span data-stu-id="843a8-205">The `FaultReason` class (and SOAP `env:Reason/faultString`) has built-in support for having multiple translations in the interest of globalization.</span></span>  
  
```csharp
public class FaultReason  
{  
    public FaultReason(FaultReasonText translation);  
    public FaultReason(IEnumerable<FaultReasonText> translations);  
    public FaultReason(string text);  
  
    public SynchronizedReadOnlyCollection<FaultReasonText> Translations
    {
       get;
    }  
  
 }  
```  
  
 <span data-ttu-id="843a8-206">Le contenu du détail de la faille est `GetDetail` \<exposé sur MessageFault à l’aide de diverses méthodes, y compris le T> et `GetReaderAtDetailContents`().</span><span class="sxs-lookup"><span data-stu-id="843a8-206">The fault detail contents are exposed on MessageFault using various methods including the `GetDetail`\<T> and `GetReaderAtDetailContents`().</span></span> <span data-ttu-id="843a8-207">Le détail de l'erreur est un élément opaque permettant de transmettre des informations supplémentaires à propos de l'erreur.</span><span class="sxs-lookup"><span data-stu-id="843a8-207">The fault detail is an opaque element for carrying additional detail about the fault.</span></span> <span data-ttu-id="843a8-208">Il s'avère utile s'il existe des informations structurées arbitraires que vous souhaitez transmettre avec l'erreur.</span><span class="sxs-lookup"><span data-stu-id="843a8-208">This is useful if there is some arbitrary structured detail that you want to carry with the fault.</span></span>  
  
### <a name="generating-faults"></a><span data-ttu-id="843a8-209">Génération des erreurs</span><span class="sxs-lookup"><span data-stu-id="843a8-209">Generating Faults</span></span>  
 <span data-ttu-id="843a8-210">Cette section explique le processus de génération d'une erreur en réponse à une condition d'erreur détectée dans un canal ou dans une propriété de message créée par le canal.</span><span class="sxs-lookup"><span data-stu-id="843a8-210">This section explains the process of generating a fault in response to an error condition detected in a channel or in a message property created by the channel.</span></span> <span data-ttu-id="843a8-211">Le renvoi d'une erreur en réponse à un message de demande qui contient des données non valides est un exemple type.</span><span class="sxs-lookup"><span data-stu-id="843a8-211">A typical example is sending back a fault in response to a request message that contains invalid data.</span></span>  
  
 <span data-ttu-id="843a8-212">Lors de la génération d'une erreur, le canal personnalisé ne doit pas envoyer directement l'erreur, il doit plutôt lever une exception et laisser la couche au-dessus décider s'il faut convertir cette exception en erreur et comment l'envoyer.</span><span class="sxs-lookup"><span data-stu-id="843a8-212">When generating a fault, the custom channel should not send the fault directly, rather, it should throw an exception and let the layer above decide whether to convert that exception to a fault and how to send it.</span></span> <span data-ttu-id="843a8-213">Pour faciliter cette conversion, le canal doit fournir une implémentation `FaultConverter` qui peut convertir l'exception levée par le canal personnalisé en erreur appropriée.</span><span class="sxs-lookup"><span data-stu-id="843a8-213">To aid in this conversion, the channel should provide a `FaultConverter` implementation that can convert the exception thrown by the custom channel to the appropriate fault.</span></span> <span data-ttu-id="843a8-214">`FaultConverter` est défini comme :</span><span class="sxs-lookup"><span data-stu-id="843a8-214">`FaultConverter` is defined as:</span></span>  
  
```csharp
public class FaultConverter  
{  
    public static FaultConverter GetDefaultFaultConverter(  
                                   MessageVersion version);  
    protected abstract bool OnTryCreateFaultMessage(  
                                   Exception exception,
                                   out Message message);  
    public bool TryCreateFaultMessage(  
                                   Exception exception,
                                   out Message message);  
}  
```  
  
 <span data-ttu-id="843a8-215">Chaque canal qui génère des erreurs personnalisées doit implémenter `FaultConverter` et le retourner à partir d'un appel à `GetProperty<FaultConverter>`.</span><span class="sxs-lookup"><span data-stu-id="843a8-215">Each channel that generates custom faults must implement `FaultConverter` and return it from a call to `GetProperty<FaultConverter>`.</span></span> <span data-ttu-id="843a8-216">L'implémentation `OnTryCreateFaultMessage` personnalisée doit soit convertir l'exception en erreur, soit déléguer au `FaultConverter` du canal interne.</span><span class="sxs-lookup"><span data-stu-id="843a8-216">The custom `OnTryCreateFaultMessage` implementation must either convert the exception to a fault or delegate to the inner channel’s `FaultConverter`.</span></span> <span data-ttu-id="843a8-217">Si le canal est un transport, il doit soit convertir `FaultConverter` l’exception, soit le délégué à l’encoder ou à la valeur par défaut `FaultConverter` prévue dans WCF .</span><span class="sxs-lookup"><span data-stu-id="843a8-217">If the channel is a transport it must either convert the exception or delegate to the encoder’s `FaultConverter` or the default `FaultConverter` provided in WCF .</span></span> <span data-ttu-id="843a8-218">Le `FaultConverter` par défaut convertit les erreurs correspondant aux messages d'erreur spécifiés par WS-Addressing et SOAP.</span><span class="sxs-lookup"><span data-stu-id="843a8-218">The default `FaultConverter` converts errors corresponding to fault messages specified by WS-Addressing and SOAP.</span></span> <span data-ttu-id="843a8-219">Voici un exemple d'implémentation `OnTryCreateFaultMessage` :</span><span class="sxs-lookup"><span data-stu-id="843a8-219">Here is an example `OnTryCreateFaultMessage` implementation.</span></span>  
  
```csharp
public override bool OnTryCreateFaultMessage(Exception exception,
                                             out Message message)  
{  
    if (exception is ...)  
    {  
        message = ...;  
        return true;  
    }  
  
#if IMPLEMENTING_TRANSPORT_CHANNEL  
    FaultConverter encoderConverter =
                    this.encoder.GetProperty<FaultConverter>();  
    if ((encoderConverter != null) &&
        (encoderConverter.TryCreateFaultMessage(  
         exception, out message)))  
    {  
        return true;  
    }  
  
    FaultConverter defaultConverter =
                   FaultConverter.GetDefaultFaultConverter(  
                   this.channel.messageVersion);  
    return defaultConverter.TryCreateFaultMessage(  
                   exception,
                   out message);  
#else  
    FaultConverter inner =
                   this.innerChannel.GetProperty<FaultConverter>();  
    if (inner != null)  
    {  
        return inner.TryCreateFaultMessage(exception, out message);  
    }  
    else  
    {  
        message = null;  
        return false;  
    }  
#endif  
}  
```  
  
 <span data-ttu-id="843a8-220">Une conséquence de ce modèle est que les exceptions levées entre des couches pour les conditions d'erreur qui requièrent des erreurs doivent contenir suffisamment d'informations pour que le générateur d'erreurs correspondant crée l'erreur correcte.</span><span class="sxs-lookup"><span data-stu-id="843a8-220">An implication of this pattern is that exceptions thrown between layers for error conditions that require faults must contain enough information for the corresponding fault generator to create the correct fault.</span></span> <span data-ttu-id="843a8-221">En tant qu'auteur de canal personnalisé, vous pouvez définir des types d'exceptions qui correspondent aux différentes conditions d'erreur si de telles exceptions n'existent pas déjà.</span><span class="sxs-lookup"><span data-stu-id="843a8-221">As a custom channel author, you may define exception types that correspond to different fault conditions if such exceptions do not already exist.</span></span> <span data-ttu-id="843a8-222">Notez que les exceptions qui traversent les couches du canal doivent communiquer la condition d'erreur plutôt que des données d'erreur opaques.</span><span class="sxs-lookup"><span data-stu-id="843a8-222">Note that exceptions traversing channel layers should communicate the error condition rather than opaque fault data.</span></span>  
  
### <a name="fault-categories"></a><span data-ttu-id="843a8-223">Catégories d'erreur</span><span class="sxs-lookup"><span data-stu-id="843a8-223">Fault Categories</span></span>  
 <span data-ttu-id="843a8-224">Il existe en général trois catégories d'erreurs :</span><span class="sxs-lookup"><span data-stu-id="843a8-224">There are generally three categories of faults:</span></span>  
  
1. <span data-ttu-id="843a8-225">Erreurs envahissant toute la pile.</span><span class="sxs-lookup"><span data-stu-id="843a8-225">Faults that are pervasive throughout the entire stack.</span></span> <span data-ttu-id="843a8-226">Ces erreurs pouvant être rencontrées au niveau de toute couche dans la pile des canaux, par exemple InvalidCardinalityAddressingException.</span><span class="sxs-lookup"><span data-stu-id="843a8-226">These faults could be encountered at any layer in the channel stack, for example InvalidCardinalityAddressingException.</span></span>  
  
2. <span data-ttu-id="843a8-227">Erreurs pouvant être rencontrées n’importe où au-dessus d’une certaine couche de la pile, par exemple, certaines erreurs en rapport avec une transaction transmise ou avec des rôles de sécurité.</span><span class="sxs-lookup"><span data-stu-id="843a8-227">Faults that can be encountered anywhere above a certain layer in the stack for example some errors that pertain to a flowed transaction or to security roles.</span></span>  
  
3. <span data-ttu-id="843a8-228">Erreurs dirigées vers une couche unique dans la pile, par exemple, erreurs comme les erreurs de numéro de séquence WS-RM.</span><span class="sxs-lookup"><span data-stu-id="843a8-228">Faults that are directed at a single layer in the stack, for example errors like WS-RM sequence number faults.</span></span>  
  
 <span data-ttu-id="843a8-229">Catégorie 1.</span><span class="sxs-lookup"><span data-stu-id="843a8-229">Category 1.</span></span> <span data-ttu-id="843a8-230">Les erreurs sont en général des erreurs WS-Addressing et SOAP.</span><span class="sxs-lookup"><span data-stu-id="843a8-230">Faults are generally WS-Addressing and SOAP faults.</span></span> <span data-ttu-id="843a8-231">La `FaultConverter` classe de base fournie par WCF convertit les erreurs correspondant à des messages de défaut spécifiés par WS-Addressing et SOAP de sorte que vous n’avez pas à gérer la conversion de ces exceptions vous-même.</span><span class="sxs-lookup"><span data-stu-id="843a8-231">The base `FaultConverter` class provided by WCF converts errors corresponding to fault messages specified by WS-Addressing and SOAP so you do not have to handle conversion of these exceptions yourself.</span></span>  
  
 <span data-ttu-id="843a8-232">Catégorie 2.</span><span class="sxs-lookup"><span data-stu-id="843a8-232">Category 2.</span></span> <span data-ttu-id="843a8-233">Les erreurs se produisent lorsqu'une couche ajoute une propriété au message qui ne consomme pas complètement les informations de message en rapport avec cette couche.</span><span class="sxs-lookup"><span data-stu-id="843a8-233">Faults occur when a layer adds a property to the message that does not completely consume message information that pertains to that layer.</span></span> <span data-ttu-id="843a8-234">Les erreurs peuvent être détectées ultérieurement lorsqu'une couche supérieure demande la propriété de message pour traiter davantage les informations de message.</span><span class="sxs-lookup"><span data-stu-id="843a8-234">Errors may be detected later when a higher layer asks the message property to process message information further.</span></span> <span data-ttu-id="843a8-235">De tels canaux doivent implémenter `GetProperty`, spécifié précédemment, pour permettre à la couche supérieure de renvoyer l'erreur correcte.</span><span class="sxs-lookup"><span data-stu-id="843a8-235">Such channels should implement the `GetProperty` specified previously to enable the higher layer to send back the correct fault.</span></span> <span data-ttu-id="843a8-236">TransactionMessageProperty en est un exemple.</span><span class="sxs-lookup"><span data-stu-id="843a8-236">An example of this is the TransactionMessageProperty.</span></span> <span data-ttu-id="843a8-237">Cette propriété est ajoutée au message sans valider pleinement toutes les données dans l’en-tête (cette opération peut impliquer de contacter le coordinateur de transactions distribuées (DTC).</span><span class="sxs-lookup"><span data-stu-id="843a8-237">This property is added to the message without fully validating all the data in the header (doing so may involve contacting the distributed transaction coordinator (DTC).</span></span>  
  
 <span data-ttu-id="843a8-238">Catégorie 3.</span><span class="sxs-lookup"><span data-stu-id="843a8-238">Category 3.</span></span> <span data-ttu-id="843a8-239">Les erreurs sont uniquement générées et envoyées par une couche unique dans le processeur.</span><span class="sxs-lookup"><span data-stu-id="843a8-239">Faults are only generated and sent by a single layer in the processor.</span></span> <span data-ttu-id="843a8-240">Par conséquent, toutes les exceptions sont contenues dans la couche.</span><span class="sxs-lookup"><span data-stu-id="843a8-240">Therefore all the exceptions are contained within the layer.</span></span> <span data-ttu-id="843a8-241">Pour améliorer la cohérence parmi les canaux et faciliter la maintenance, votre canal personnalisé doit utiliser le modèle spécifié précédemment pour générer les messages d'erreur même pour des erreurs internes.</span><span class="sxs-lookup"><span data-stu-id="843a8-241">To improve consistency among channels and ease maintenance, your custom channel should use the pattern specified previously to generate fault messages even for internal faults.</span></span>  
  
### <a name="interpreting-received-faults"></a><span data-ttu-id="843a8-242">Interprétation des erreurs reçues</span><span class="sxs-lookup"><span data-stu-id="843a8-242">Interpreting Received Faults</span></span>  
 <span data-ttu-id="843a8-243">Cette section fournit des indications pour générer l'exception appropriée lors de la réception d'un message d'erreur.</span><span class="sxs-lookup"><span data-stu-id="843a8-243">This section provides guidance for generating the appropriate exception when receiving a fault message.</span></span> <span data-ttu-id="843a8-244">L’arbre de décision pour le traitement d’un message à chaque couche de la pile est le suivant :</span><span class="sxs-lookup"><span data-stu-id="843a8-244">The decision tree for processing a message at every layer in the stack is as follows:</span></span>  
  
1. <span data-ttu-id="843a8-245">Si la couche considère le message comme non valide, elle doit effectuer son traitement des messages non valides.</span><span class="sxs-lookup"><span data-stu-id="843a8-245">If the layer considers the message to be invalid, the layer should do its ‘invalid message’ processing.</span></span> <span data-ttu-id="843a8-246">Un tel traitement est spécifique à la couche mais peut inclure le déplacement du message, le suivi ou la levée d'une exception par la suite convertie en erreur.</span><span class="sxs-lookup"><span data-stu-id="843a8-246">Such processing is specific to the layer but could include dropping the message, tracing, or throwing an exception that gets converted to a fault.</span></span> <span data-ttu-id="843a8-247">Par exemple, la sécurité reçoit un message qui n'est pas correctement sécurisé ou RM reçoit un message avec un mauvais numéro de séquence.</span><span class="sxs-lookup"><span data-stu-id="843a8-247">Examples include security receiving a message that is not secured properly, or RM receiving a message with a bad sequence number.</span></span>  
  
2. <span data-ttu-id="843a8-248">Sinon, si le message est un message d'erreur qui s'applique spécifiquement à la couche, et que le message n'est pas explicite en dehors de l'interaction de la couche, la couche doit gérer la condition d'erreur.</span><span class="sxs-lookup"><span data-stu-id="843a8-248">Otherwise, if the message is a fault message that applies specifically to the layer, and the message is not meaningful outside the layer’s interaction, the layer should handle the error condition.</span></span> <span data-ttu-id="843a8-249">Exemple : une erreur de séquence RM refusée non significative pour les couches au-dessus du canal RM et qui implique de provoquer une erreur dans le canal RM et de lever à partir d'opérations en attente.</span><span class="sxs-lookup"><span data-stu-id="843a8-249">An example of this is an RM Sequence Refused fault that is meaningless to layers above the RM channel and that implies faulting the RM channel and throwing from pending operations.</span></span>  
  
3. <span data-ttu-id="843a8-250">Sinon, le message doit être retourné à partir de Request() ou Receive().</span><span class="sxs-lookup"><span data-stu-id="843a8-250">Otherwise, the message should be returned from Request() or Receive().</span></span> <span data-ttu-id="843a8-251">Cela inclut les cas où la couche reconnaît l'erreur, mais l'erreur indique juste qu'une demande a échoué et n'implique pas de provoquer une erreur dans le canal et de lever à partir d'opérations en attente.</span><span class="sxs-lookup"><span data-stu-id="843a8-251">This includes cases where the layer recognizes the fault, but the fault just indicates that a request failed and does not imply faulting the channel and throwing from pending operations.</span></span> <span data-ttu-id="843a8-252">Pour améliorer la facilité d'utilisation dans un tel cas, la couche doit implémenter `GetProperty<FaultConverter>` et retourner une classe dérivée `FaultConverter` qui peut convertir l'erreur en exception en remplaçant `OnTryCreateException`.</span><span class="sxs-lookup"><span data-stu-id="843a8-252">To improve usability in such a case, the layer should implement `GetProperty<FaultConverter>` and return a `FaultConverter` derived class that can convert the fault to an exception by overriding `OnTryCreateException`.</span></span>  
  
 <span data-ttu-id="843a8-253">Le modèle objet suivant prend en charge la conversion des messages en exceptions :</span><span class="sxs-lookup"><span data-stu-id="843a8-253">The following object model supports converting messages to exceptions:</span></span>  
  
```csharp
public class FaultConverter  
{  
    public static FaultConverter GetDefaultFaultConverter(  
                                  MessageVersion version);  
    protected abstract bool OnTryCreateException(  
                                 Message message,
                                 MessageFault fault,
                                 out Exception exception);  
    public bool TryCreateException(  
                                 Message message,
                                 MessageFault fault,
                                 out Exception exception);  
}  
```  
  
 <span data-ttu-id="843a8-254">Une couche du canal peut implémenter `GetProperty<FaultConverter>` pour prendre en charge la conversion des messages d'erreur en exceptions.</span><span class="sxs-lookup"><span data-stu-id="843a8-254">A channel layer can implement `GetProperty<FaultConverter>` to support converting fault messages to exceptions.</span></span> <span data-ttu-id="843a8-255">Pour cela, remplacez `OnTryCreateException` et inspectez le message d'erreur.</span><span class="sxs-lookup"><span data-stu-id="843a8-255">To do so, override `OnTryCreateException` and inspect the fault message.</span></span> <span data-ttu-id="843a8-256">En cas de reconnaissance, effectuez la conversion, sinon demandez au canal interne de le convertir.</span><span class="sxs-lookup"><span data-stu-id="843a8-256">If recognized, do the conversion, otherwise ask the inner channel to convert it.</span></span> <span data-ttu-id="843a8-257">Les canaux de transport doivent déléguer à `FaultConverter.GetDefaultFaultConverter` pour obtenir le FaultConverter SOAP/WS-Addressing par défaut.</span><span class="sxs-lookup"><span data-stu-id="843a8-257">Transport channels should delegate to `FaultConverter.GetDefaultFaultConverter` to get the default SOAP/WS-Addressing FaultConverter.</span></span>  
  
 <span data-ttu-id="843a8-258">Une implémentation type ressemble à celle-ci :</span><span class="sxs-lookup"><span data-stu-id="843a8-258">A typical implementation looks like this:</span></span>  
  
```csharp
public override bool OnTryCreateException(  
                            Message message,
                            MessageFault fault,
                            out Exception exception)  
{  
    if (message.Action == "...")  
    {  
        exception = ...;  
        return true;  
    }  
    // OR  
    if ((fault.Code.Name == "...") && (fault.Code.Namespace == "..."))  
    {  
        exception = ...;  
        return true;  
    }  
  
    if (fault.IsMustUnderstand)  
    {  
        if (fault.WasHeaderNotUnderstood(  
                   message.Headers, "...", "..."))  
        {  
            exception = new ProtocolException(...);  
            return true;  
        }  
    }  
  
#if IMPLEMENTING_TRANSPORT_CHANNEL  
    FaultConverter encoderConverter =
              this.encoder.GetProperty<FaultConverter>();  
    if ((encoderConverter != null) &&
        (encoderConverter.TryCreateException(  
                              message, fault, out exception)))  
    {  
        return true;  
    }  
  
    FaultConverter defaultConverter =  
             FaultConverter.GetDefaultFaultConverter(  
                             this.channel.messageVersion);  
    return defaultConverter.TryCreateException(  
                             message, fault, out exception);  
#else  
    FaultConverter inner =
                    this.innerChannel.GetProperty<FaultConverter>();  
    if (inner != null)  
    {  
        return inner.TryCreateException(message, fault, out exception);  
    }  
    else  
    {  
        exception = null;  
        return false;  
    }  
#endif  
}  
```  
  
 <span data-ttu-id="843a8-259">Pour les conditions d'erreur spécifiques dont les scénarios de récupération diffèrent, envisagez de définir une classe dérivée de `ProtocolException`.</span><span class="sxs-lookup"><span data-stu-id="843a8-259">For specific fault conditions that have distinct recovery scenarios, consider defining a derived class of `ProtocolException`.</span></span>  
  
### <a name="mustunderstand-processing"></a><span data-ttu-id="843a8-260">Traitement de MustUnderstand</span><span class="sxs-lookup"><span data-stu-id="843a8-260">MustUnderstand Processing</span></span>  
 <span data-ttu-id="843a8-261">SOAP définit une erreur générale pour signaler qu'un en-tête requis n'a pas été compris par le destinataire.</span><span class="sxs-lookup"><span data-stu-id="843a8-261">SOAP defines a general fault for signaling that a required header was not understood by the receiver.</span></span> <span data-ttu-id="843a8-262">Cette erreur est connu en tant qu'erreur `mustUnderstand`.</span><span class="sxs-lookup"><span data-stu-id="843a8-262">This fault is known as the `mustUnderstand` fault.</span></span> <span data-ttu-id="843a8-263">Dans WCF, les `mustUnderstand` canaux personnalisés ne génèrent jamais de défauts.</span><span class="sxs-lookup"><span data-stu-id="843a8-263">In WCF, custom channels never generate `mustUnderstand` faults.</span></span> <span data-ttu-id="843a8-264">Au lieu de cela, le répartiteur WCF, qui est situé en haut de la pile de communication WCF, vérifie pour voir que tous les en-têtes qui ont été marqués comme MustUnderstand-true ont été compris par la pile sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="843a8-264">Instead, the WCF Dispatcher, which is located at the top of the WCF communication stack, checks to see that all headers that were marked as MustUnderstand=true were understood by the underlying stack.</span></span> <span data-ttu-id="843a8-265">Si certains n'ont pas été compris, une erreur `mustUnderstand` est générée à ce stade.</span><span class="sxs-lookup"><span data-stu-id="843a8-265">If any were not understood, a `mustUnderstand` fault is generated at that point.</span></span> <span data-ttu-id="843a8-266">(L'utilisateur peut choisir de désactiver ce traitement `mustUnderstand` et de faire recevoir à l'application tous les en-têtes de message.</span><span class="sxs-lookup"><span data-stu-id="843a8-266">(The user can choose to turn off this `mustUnderstand` processing and have the application receive all message headers.</span></span> <span data-ttu-id="843a8-267">Dans ce cas, la `mustUnderstand` demande est responsable de l’exécution du traitement.) La faute générée comprend un en-tête NotUnderstood qui contient les noms de tous les en-têtes avec MustUnderstand-true qui n’ont pas été compris.</span><span class="sxs-lookup"><span data-stu-id="843a8-267">In that case the application is responsible for performing `mustUnderstand` processing.) The generated fault includes a NotUnderstood header that contains the names of all headers with MustUnderstand=true that were not understood.</span></span>  
  
 <span data-ttu-id="843a8-268">Si votre canal de protocole envoie un en-tête personnalisé avec MustUnderstand=true et reçoit une erreur `mustUnderstand`, il doit déterminer si cette erreur est due à l'en-tête qu'il a envoyé.</span><span class="sxs-lookup"><span data-stu-id="843a8-268">If your protocol channel sends a custom header with MustUnderstand=true and receives a `mustUnderstand` fault, it must figure out whether that fault is due to the header it sent.</span></span> <span data-ttu-id="843a8-269">Il existe deux membres sur la classe `MessageFault` qui s'avèrent utiles à cette fin :</span><span class="sxs-lookup"><span data-stu-id="843a8-269">There are two members on the `MessageFault` class that are useful for this:</span></span>  
  
```csharp
public class MessageFault  
{  
    ...  
    public bool IsMustUnderstandFault { get; }  
    public static bool WasHeaderNotUnderstood(MessageHeaders headers,
        string name, string ns) { }  
    ...  
  
}  
```  
  
 <span data-ttu-id="843a8-270">`IsMustUnderstandFault` retourne `true` si l'erreur est une erreur `mustUnderstand`.</span><span class="sxs-lookup"><span data-stu-id="843a8-270">`IsMustUnderstandFault` returns `true` if the fault is a `mustUnderstand` fault.</span></span> <span data-ttu-id="843a8-271">`WasHeaderNotUnderstood` retourne la valeur `true` si l'en-tête avec le nom et l'espace de noms spécifiés est inclus dans l'erreur en tant qu'en-tête NotUnderstood.</span><span class="sxs-lookup"><span data-stu-id="843a8-271">`WasHeaderNotUnderstood` returns `true` if the header with the specified name and namespace is included in the fault as a NotUnderstood header.</span></span>  <span data-ttu-id="843a8-272">Sinon, `false`est retourné.</span><span class="sxs-lookup"><span data-stu-id="843a8-272">Otherwise, it returns `false`.</span></span>  
  
 <span data-ttu-id="843a8-273">Si un canal émet un en-tête marqué MustUnderstand = true, puis cette couche doit également implémenter le modèle de l'API de la génération de l'exception et doit convertir les erreurs `mustUnderstand` provoquées par cet en-tête en une exception plus utile comme décrit précédemment.</span><span class="sxs-lookup"><span data-stu-id="843a8-273">If a channel emits a header that is marked MustUnderstand = true, then that layer should also implement the Exception Generation API pattern and should convert `mustUnderstand` faults caused by that header to a more useful exception as described previously.</span></span>  
  
## <a name="tracing"></a><span data-ttu-id="843a8-274">Traçage</span><span class="sxs-lookup"><span data-stu-id="843a8-274">Tracing</span></span>  
 <span data-ttu-id="843a8-275">.NET Framework fournit un mécanisme pour suivre l'exécution des programmes afin de faciliter le diagnostic des applications de production ou des problèmes intermittents lorsqu'il n'est pas possible de joindre juste un débogueur et de parcourir le code.</span><span class="sxs-lookup"><span data-stu-id="843a8-275">The .NET Framework provides a mechanism to trace program execution as a way to aid diagnosing production applications or intermittent problems where it is not possible to just attach a debugger and step through the code.</span></span> <span data-ttu-id="843a8-276">Les composants principaux de ce mécanisme sont dans l'espace de noms <xref:System.Diagnostics?displayProperty=nameWithType> et se composent de :</span><span class="sxs-lookup"><span data-stu-id="843a8-276">The core components of this mechanism are in the <xref:System.Diagnostics?displayProperty=nameWithType> namespace and consist of:</span></span>  
  
- <span data-ttu-id="843a8-277"><xref:System.Diagnostics.TraceSource?displayProperty=nameWithType>, qui est la source d'informations de suivi à écrire, <xref:System.Diagnostics.TraceListener?displayProperty=nameWithType>, qui est une classe de base abstraite pour les écouteurs concrets qui reçoivent les informations à suivre à partir de <xref:System.Diagnostics.TraceSource> et qui les transmettent à une destination spécifique à l'écouteur.</span><span class="sxs-lookup"><span data-stu-id="843a8-277"><xref:System.Diagnostics.TraceSource?displayProperty=nameWithType>, which is the source of trace information to be written, <xref:System.Diagnostics.TraceListener?displayProperty=nameWithType>, which is an abstract base class for concrete listeners that receive the information to be traced from the <xref:System.Diagnostics.TraceSource> and output it to a listener-specific destination.</span></span> <span data-ttu-id="843a8-278">Par exemple, <xref:System.Diagnostics.XmlWriterTraceListener> transmet les informations de suivi à un fichier XML.</span><span class="sxs-lookup"><span data-stu-id="843a8-278">For example, <xref:System.Diagnostics.XmlWriterTraceListener> outputs trace information to an XML file.</span></span> <span data-ttu-id="843a8-279">Enfin, <xref:System.Diagnostics.TraceSwitch?displayProperty=nameWithType>, qui permet à l'utilisateur de l'application de contrôler les commentaires de suivi et qui est en général spécifié dans la configuration.</span><span class="sxs-lookup"><span data-stu-id="843a8-279">Finally, <xref:System.Diagnostics.TraceSwitch?displayProperty=nameWithType>, which lets the application user control the tracing verbosity and is typically specified in configuration.</span></span>  
  
- <span data-ttu-id="843a8-280">En plus des composants de base, vous pouvez utiliser [l’outil De visionnement de traces de service (SvcTraceViewer.exe)](../service-trace-viewer-tool-svctraceviewer-exe.md) pour visualiser et rechercher des traces WCF.</span><span class="sxs-lookup"><span data-stu-id="843a8-280">In addition to the core components, you can use the [Service Trace Viewer Tool (SvcTraceViewer.exe)](../service-trace-viewer-tool-svctraceviewer-exe.md) to view and search WCF traces.</span></span> <span data-ttu-id="843a8-281">L’outil est conçu spécifiquement pour les fichiers <xref:System.Diagnostics.XmlWriterTraceListener>de trace générés par WCF et écrits à l’aide de .</span><span class="sxs-lookup"><span data-stu-id="843a8-281">The tool is designed specifically for trace files generated by WCF and written out using <xref:System.Diagnostics.XmlWriterTraceListener>.</span></span> <span data-ttu-id="843a8-282">La figure suivante montre les divers composants impliqués dans le suivi.</span><span class="sxs-lookup"><span data-stu-id="843a8-282">The following figure shows the various components involved in tracing.</span></span>  
  
 <span data-ttu-id="843a8-283">![Gestion des exceptions et des défauts](./media/wcfc-tracinginchannelsc.gif "wcfc_TracingInChannelsc")</span><span class="sxs-lookup"><span data-stu-id="843a8-283">![Handling exceptions and faults](./media/wcfc-tracinginchannelsc.gif "wcfc_TracingInChannelsc")</span></span>  
  
### <a name="tracing-from-a-custom-channel"></a><span data-ttu-id="843a8-284">Suivi à partir d'un canal personnalisé</span><span class="sxs-lookup"><span data-stu-id="843a8-284">Tracing from a Custom Channel</span></span>  
 <span data-ttu-id="843a8-285">Les canaux personnalisés doivent écrire des messages de suivi pour faciliter le diagnostic des problèmes lorsqu'il n'est pas possible de joindre un débogueur à l'application en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="843a8-285">Custom channels should write out trace messages to assist in diagnosing problems when it is not possible to attach a debugger to the running application.</span></span> <span data-ttu-id="843a8-286">Cela implique deux tâches de niveau élevé : instanciation de <xref:System.Diagnostics.TraceSource> et appel de ses méthodes pour écrire des suivis.</span><span class="sxs-lookup"><span data-stu-id="843a8-286">This involves two high level tasks: Instantiating a <xref:System.Diagnostics.TraceSource> and calling its methods to write traces.</span></span>  
  
 <span data-ttu-id="843a8-287">Lorsque vous instanciez <xref:System.Diagnostics.TraceSource>, la chaîne que vous spécifiez devient le nom de cette source.</span><span class="sxs-lookup"><span data-stu-id="843a8-287">When instantiating a <xref:System.Diagnostics.TraceSource>, the string you specify becomes the name of that source.</span></span> <span data-ttu-id="843a8-288">Ce nom est utilisé pour configurer (activer/désactiver/définir le niveau de suivi) la source de suivi.</span><span class="sxs-lookup"><span data-stu-id="843a8-288">This name is used to configure (enable/disable/set tracing level) the trace source.</span></span> <span data-ttu-id="843a8-289">Il apparaît également dans la sortie de suivi elle-même.</span><span class="sxs-lookup"><span data-stu-id="843a8-289">It also appears in the trace output itself.</span></span> <span data-ttu-id="843a8-290">Les canaux personnalisés doivent utiliser un nom de source unique pour aider les lecteurs de la sortie de suivi à comprendre la provenance des informations de suivi.</span><span class="sxs-lookup"><span data-stu-id="843a8-290">Custom channels should use a unique source name to help readers of the trace output understand where the trace information comes from.</span></span> <span data-ttu-id="843a8-291">L'usage consiste à utiliser le nom de l'assembly qui écrit les informations en tant que nom de la source de suivi.</span><span class="sxs-lookup"><span data-stu-id="843a8-291">Using the name of the assembly that is writing the information as the name of the trace source is the common practice.</span></span> <span data-ttu-id="843a8-292">Par exemple, WCF utilise System.ServiceModel comme source de traces pour obtenir des informations écrites à partir de l’assemblage System.ServiceModel.</span><span class="sxs-lookup"><span data-stu-id="843a8-292">For example, WCF uses System.ServiceModel as the trace source for information written from the System.ServiceModel assembly.</span></span>  
  
 <span data-ttu-id="843a8-293">Une fois que vous avez une source de suivi, vous appelez ses méthodes <xref:System.Diagnostics.TraceSource.TraceData%2A>, <xref:System.Diagnostics.TraceSource.TraceEvent%2A>ou <xref:System.Diagnostics.TraceSource.TraceInformation%2A> pour écrire des entrées de suivi dans les écouteurs de suivi.</span><span class="sxs-lookup"><span data-stu-id="843a8-293">Once you have a trace source, you call its <xref:System.Diagnostics.TraceSource.TraceData%2A>, <xref:System.Diagnostics.TraceSource.TraceEvent%2A>, or <xref:System.Diagnostics.TraceSource.TraceInformation%2A> methods to write trace entries to the trace listeners.</span></span> <span data-ttu-id="843a8-294">Pour chaque entrée de suivi que vous écrivez, vous devez classifier le type d'événement comme l'un des types d'événements définis dans <xref:System.Diagnostics.TraceEventType>.</span><span class="sxs-lookup"><span data-stu-id="843a8-294">For each trace entry you write, you need to classify the type of event as one of the event types defined in <xref:System.Diagnostics.TraceEventType>.</span></span> <span data-ttu-id="843a8-295">Cette classification et le paramètre du niveau de suivi dans la configuration déterminent si l'entrée de suivi est envoyée à l'écouteur.</span><span class="sxs-lookup"><span data-stu-id="843a8-295">This classification and the trace level setting in configuration determine whether the trace entry is output to the listener.</span></span> <span data-ttu-id="843a8-296">Par exemple, affecter au niveau de suivi dans la configuration la valeur `Warning` permet d'écrire les entrées de suivi `Warning`, `Error` et `Critical` mais de bloquer les entrées Informations et En clair.</span><span class="sxs-lookup"><span data-stu-id="843a8-296">For example, setting the trace level in configuration to `Warning` allows `Warning`, `Error` and `Critical` trace entries to be written but blocks Information and Verbose entries.</span></span> <span data-ttu-id="843a8-297">Voici un exemple d'instanciation d'une source de suivi et d'écriture d'une entrée au niveau Informations :</span><span class="sxs-lookup"><span data-stu-id="843a8-297">Here is an example of instantiating a trace source and writing out an entry at Information level:</span></span>  
  
```csharp
using System.Diagnostics;  
//...  
TraceSource udpSource = new TraceSource("Microsoft.Samples.Udp");  
//...  
udpsource.TraceInformation("UdpInputChannel received a message");  
```  
  
> [!IMPORTANT]
> <span data-ttu-id="843a8-298">Il est fortement recommandé de spécifier un nom unique pour la source de suivi dans votre canal personnalisé afin d'aider les lecteurs de sortie de suivi à comprendre la provenance du résultat.</span><span class="sxs-lookup"><span data-stu-id="843a8-298">It is highly recommended that you specify a trace source name that is unique to your custom channel to help trace output readers understand where the output came from.</span></span>  
  
#### <a name="integrating-with-the-trace-viewer"></a><span data-ttu-id="843a8-299">Intégration au Trace Viewer</span><span class="sxs-lookup"><span data-stu-id="843a8-299">Integrating with the Trace Viewer</span></span>  
 <span data-ttu-id="843a8-300">Les traces générées par votre canal peuvent être produites dans un format lisible par [l’outil De visionnement de traces de service (SvcTraceViewer.exe)](../service-trace-viewer-tool-svctraceviewer-exe.md) en utilisant <xref:System.Diagnostics.XmlWriterTraceListener?displayProperty=nameWithType> comme auditeur de traces.</span><span class="sxs-lookup"><span data-stu-id="843a8-300">Traces generated by your channel can be output in a format readable by the [Service Trace Viewer Tool (SvcTraceViewer.exe)](../service-trace-viewer-tool-svctraceviewer-exe.md) by using <xref:System.Diagnostics.XmlWriterTraceListener?displayProperty=nameWithType> as the trace listener.</span></span> <span data-ttu-id="843a8-301">En tant que développeur de canal, vous n'avez pas à le faire.</span><span class="sxs-lookup"><span data-stu-id="843a8-301">This is not something you, as the channel developer, need to do.</span></span> <span data-ttu-id="843a8-302">Il incombe plutôt à l'utilisateur de l'application (ou à la personne qui résout les problèmes de l'application) de configurer cet écouteur de suivi dans le fichier de configuration de l'application.</span><span class="sxs-lookup"><span data-stu-id="843a8-302">Rather, it is the application user (or the person troubleshooting the application) that needs to configure this trace listener in the application’s configuration file.</span></span> <span data-ttu-id="843a8-303">Par exemple, la configuration suivante génère des informations de suivi à partir de <xref:System.ServiceModel?displayProperty=nameWithType> et `Microsoft.Samples.Udp` dans le fichier nommé `TraceEventsFile.e2e` :</span><span class="sxs-lookup"><span data-stu-id="843a8-303">For example, the following configuration outputs trace information from both <xref:System.ServiceModel?displayProperty=nameWithType> and `Microsoft.Samples.Udp` to the file named `TraceEventsFile.e2e`:</span></span>  
  
```xml  
<configuration>  
  <system.diagnostics>  
    <sources>  
      <!-- configure System.ServiceModel trace source -->  
      <source name="System.ServiceModel" switchValue="Verbose"
              propagateActivity="true">  
        <listeners>  
          <add name="e2e" />  
        </listeners>  
      </source>  
      <!-- configure Microsoft.Samples.Udp trace source -->  
      <source name="Microsoft.Samples.Udp" switchValue="Verbose" >  
        <listeners>  
          <add name="e2e" />  
        </listeners>  
      </source>  
    </sources>  
    <!--   
    Define a shared trace listener that outputs to TraceFile.e2e  
    The listener name is e2e   
    -->  
    <sharedListeners>  
      <add name="e2e" type="System.Diagnostics.XmlWriterTraceListener"  
        initializeData=".\TraceFile.e2e"/>  
    </sharedListeners>  
    <trace autoflush="true" />  
  </system.diagnostics>  
</configuration>  
```  
  
#### <a name="tracing-structured-data"></a><span data-ttu-id="843a8-304">Suivi de données structurées</span><span class="sxs-lookup"><span data-stu-id="843a8-304">Tracing Structured Data</span></span>  
 <span data-ttu-id="843a8-305"><xref:System.Diagnostics.TraceSource?displayProperty=nameWithType> possède une méthode <xref:System.Diagnostics.TraceSource.TraceData%2A> qui prend un ou plusieurs objets à inclure dans l'entrée de suivi.</span><span class="sxs-lookup"><span data-stu-id="843a8-305"><xref:System.Diagnostics.TraceSource?displayProperty=nameWithType> has a <xref:System.Diagnostics.TraceSource.TraceData%2A> method that takes one or more objects that are to be included in the trace entry.</span></span> <span data-ttu-id="843a8-306">En général, la méthode <xref:System.Object.ToString%2A?displayProperty=nameWithType> est appelée sur chaque objet et la chaîne obtenue est écrite dans le cadre de l'entrée de suivi.</span><span class="sxs-lookup"><span data-stu-id="843a8-306">In general, the <xref:System.Object.ToString%2A?displayProperty=nameWithType> method is called on each object and the resulting string is written as part of the trace entry.</span></span> <span data-ttu-id="843a8-307">Lorsque vous utilisez <xref:System.Diagnostics.XmlWriterTraceListener?displayProperty=nameWithType> pour générer des suivis, vous pouvez passer <xref:System.Xml.XPath.IXPathNavigable?displayProperty=nameWithType> en tant qu'objet de données à <xref:System.Diagnostics.TraceSource.TraceData%2A>.</span><span class="sxs-lookup"><span data-stu-id="843a8-307">When using <xref:System.Diagnostics.XmlWriterTraceListener?displayProperty=nameWithType> to output traces, you can pass an <xref:System.Xml.XPath.IXPathNavigable?displayProperty=nameWithType> as the data object to <xref:System.Diagnostics.TraceSource.TraceData%2A>.</span></span> <span data-ttu-id="843a8-308">L'entrée de suivi obtenue inclut le XML fourni par <xref:System.Xml.XPath.XPathNavigator?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="843a8-308">The resulting trace entry includes the XML provided by the <xref:System.Xml.XPath.XPathNavigator?displayProperty=nameWithType>.</span></span> <span data-ttu-id="843a8-309">Voici un exemple d'entrée avec des données d'application XML :</span><span class="sxs-lookup"><span data-stu-id="843a8-309">Here is an example entry with XML application data:</span></span>  
  
```xml  
<E2ETraceEvent xmlns="http://schemas.microsoft.com/2004/06/E2ETraceEvent">  
  <System xmlns="...">  
    <EventID>12</EventID>  
    <Type>3</Type>  
    <SubType Name="Information">0</SubType>  
    <Level>8</Level>  
    <TimeCreated SystemTime="2006-01-13T22:58:03.0654832Z" />  
    <Source Name="Microsoft.ServiceModel.Samples.Udp" />  
    <Correlation ActivityID="{00000000-0000-0000-0000-000000000000}" />  
    <Execution  ProcessName="UdpTestConsole"
                ProcessID="3348" ThreadID="4" />  
    <Channel />  
    <Computer>COMPUTER-LT01</Computer>  
  </System>  
<!-- XML application data -->  
  <ApplicationData>  
  <TraceData>  
   <DataItem>  
   <TraceRecord
     Severity="Information"  
     xmlns="…">  
        <TraceIdentifier>some trace id</TraceIdentifier>  
        <Description>EndReceive called</Description>  
        <AppDomain>UdpTestConsole.exe</AppDomain>  
        <Source>UdpInputChannel</Source>  
      </TraceRecord>  
    </DataItem>  
  </TraceData>  
  </ApplicationData>  
</E2ETraceEvent>  
```  
  
 <span data-ttu-id="843a8-310">Le visualiseur de trace WCF `TraceRecord` comprend le schéma de l’élément montré précédemment et extrait les données de ses éléments enfant et les affiche dans un format tabulaire.</span><span class="sxs-lookup"><span data-stu-id="843a8-310">The WCF trace viewer understands the schema of the `TraceRecord` element shown previously and extracts the data from its child elements and displays it in a tabular format.</span></span> <span data-ttu-id="843a8-311">Votre canal doit utiliser ce schéma lors du suivi de données d'application structurées pour aider les utilisateurs de Svctraceviewer.exe à lire les données.</span><span class="sxs-lookup"><span data-stu-id="843a8-311">Your channel should use this schema when tracing structured application data to help Svctraceviewer.exe users read the data.</span></span>

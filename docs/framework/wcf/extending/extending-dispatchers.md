---
title: Extension des répartiteurs
ms.date: 03/30/2017
helpviewer_keywords:
- dispatcher extensions [WCF]
ms.assetid: d0ad15ac-fa12-4f27-80e8-7ac2271e5985
ms.openlocfilehash: 9250ca09fb5e28655e39f8d91d991fdb3bffcdbd
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/07/2019
ms.locfileid: "70795748"
---
# <a name="extending-dispatchers"></a><span data-ttu-id="4723a-102">Extension des répartiteurs</span><span class="sxs-lookup"><span data-stu-id="4723a-102">Extending Dispatchers</span></span>
<span data-ttu-id="4723a-103">Les répartiteurs sont chargés d'extraire des messages entrants des canaux sous-jacents, de les traduire dans des appels de méthode dans le code d'application et de renvoyer les résultats à l'appelant.</span><span class="sxs-lookup"><span data-stu-id="4723a-103">Dispatchers are responsible for pulling incoming messages out of the underlying channels, translating them into method invocations in application code, and sending the results back to the caller.</span></span> <span data-ttu-id="4723a-104">Les extensions de répartiteurs vous permettent de modifier ce traitement.</span><span class="sxs-lookup"><span data-stu-id="4723a-104">Dispatcher extensions allow you to modify this processing.</span></span>  <span data-ttu-id="4723a-105">Vous pouvez implémenter des inspecteurs de messages ou de paramètres qui inspectent ou modifient le contenu des messages ou des paramètres.</span><span class="sxs-lookup"><span data-stu-id="4723a-105">You can implement message or parameter inspectors that inspect or modify the contents of messages or parameters.</span></span>  <span data-ttu-id="4723a-106">Vous pouvez modifier la manière dont les messages sont acheminés vers les opérations ou fournir d'autres fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="4723a-106">You can change the way messages are routed to operations or provide some other functionality.</span></span>

<span data-ttu-id="4723a-107">Cette rubrique explique comment utiliser les <xref:System.ServiceModel.Dispatcher.DispatchRuntime> classes et <xref:System.ServiceModel.Dispatcher.DispatchOperation> dans une application de service Windows Communication Foundation (WCF) pour modifier le comportement d’exécution par défaut d’un répartiteur ou pour intercepter ou modifier des messages, des paramètres ou un retour. valeurs avant ou après l’envoi ou la récupération de la couche de canal.</span><span class="sxs-lookup"><span data-stu-id="4723a-107">This topic describes how to use the <xref:System.ServiceModel.Dispatcher.DispatchRuntime> and <xref:System.ServiceModel.Dispatcher.DispatchOperation> classes in a Windows Communication Foundation (WCF) service application to modify the default execution behavior of a dispatcher or to intercept or modify messages, parameters, or return values prior to or subsequent to sending or retrieving them from the channel layer.</span></span> <span data-ttu-id="4723a-108">Pour plus d’informations sur le traitement des messages du runtime client équivalent, consultez [extension des clients](extending-clients.md).</span><span class="sxs-lookup"><span data-stu-id="4723a-108">For more information about the equivalent client runtime message processing, see [Extending Clients](extending-clients.md).</span></span> <span data-ttu-id="4723a-109">Pour comprendre le rôle <xref:System.ServiceModel.IExtensibleObject%601> joué par les types dans l’accès à l’état partagé entre différents objets de personnalisation du runtime, consultez [objets extensibles](extensible-objects.md).</span><span class="sxs-lookup"><span data-stu-id="4723a-109">To understand the role that <xref:System.ServiceModel.IExtensibleObject%601> types play in accessing shared state between various runtime customization objects, see [Extensible Objects](extensible-objects.md).</span></span>

## <a name="dispatchers"></a><span data-ttu-id="4723a-110">Répartiteurs</span><span class="sxs-lookup"><span data-stu-id="4723a-110">Dispatchers</span></span>

<span data-ttu-id="4723a-111">La couche de modèle de service effectue la conversion entre le modèle de programmation du développeur et l'échange de message sous-jacent, ou communément, couche de canal.</span><span class="sxs-lookup"><span data-stu-id="4723a-111">The service model layer performs the conversion between the developer’s programming model and the underlying message exchange, commonly called the channel layer.</span></span> <span data-ttu-id="4723a-112">Dans WCF, les répartiteurs de canal et<xref:System.ServiceModel.Dispatcher.ChannelDispatcher> de <xref:System.ServiceModel.Dispatcher.EndpointDispatcher>point de terminaison (et, respectivement) sont les composants de service chargés d’accepter de nouveaux canaux, de recevoir des messages, de distribuer et d’appeler des opérations et de traiter les réponses.</span><span class="sxs-lookup"><span data-stu-id="4723a-112">In WCF the channel and endpoint dispatchers (<xref:System.ServiceModel.Dispatcher.ChannelDispatcher> and <xref:System.ServiceModel.Dispatcher.EndpointDispatcher>, respectively) are the service components responsible for accepting new channels, receiving messages, operation dispatch and invocation, and response processing.</span></span> <span data-ttu-id="4723a-113">Les objets de répartiteur sont des objets de récepteur, mais les implémentations de contrat de rappel dans les services duplex exposent également leurs objets de répartiteur pour l’inspection, le changement ou l’extension.</span><span class="sxs-lookup"><span data-stu-id="4723a-113">Dispatcher objects are receiver objects, but callback contract implementations in duplex services also expose their dispatcher objects for inspection, modification, or extension.</span></span>

<span data-ttu-id="4723a-114">Le répartiteur de canal (et le <xref:System.ServiceModel.Channels.IChannelListener>d'accompagnement) extrait des messages hors du canal sous-jacent et passe les messages à leurs répartiteurs de point de terminaison respectifs.</span><span class="sxs-lookup"><span data-stu-id="4723a-114">The channel dispatcher (and companion <xref:System.ServiceModel.Channels.IChannelListener>) pulls messages out of the underling channel and passes the messages to their respective endpoint dispatchers.</span></span> <span data-ttu-id="4723a-115">Chaque répartiteur de point de terminaison a un <xref:System.ServiceModel.Dispatcher.DispatchRuntime> qui route des messages au <xref:System.ServiceModel.Dispatcher.DispatchOperation> approprié, chargé d'appeler la méthode qui implémente l'opération.</span><span class="sxs-lookup"><span data-stu-id="4723a-115">Each endpoint dispatcher has a <xref:System.ServiceModel.Dispatcher.DispatchRuntime> that routes messages to the appropriate <xref:System.ServiceModel.Dispatcher.DispatchOperation>, which is responsible for calling the method that implements the operation.</span></span> <span data-ttu-id="4723a-116">Différentes classes d'extension facultatives et requises sont appelées.</span><span class="sxs-lookup"><span data-stu-id="4723a-116">Various optional and required extension classes are invoked along the way.</span></span> <span data-ttu-id="4723a-117">Cette rubrique explique comment ces morceaux s'ajustent les uns aux autres et comment vous pouvez modifier des propriétés et brancher votre propre code pour étendre les fonctionnalités de base.</span><span class="sxs-lookup"><span data-stu-id="4723a-117">This topic explains how these pieces fit together, and how you might modify properties and plug your own code in to extend the base functionality.</span></span>

<span data-ttu-id="4723a-118">Les propriétés de répartiteur et les objets de personnalisation modifiés sont insérés en utilisant un service, un point de terminaison, un contrat ou les objets de comportement de l'opération.</span><span class="sxs-lookup"><span data-stu-id="4723a-118">Dispatcher properties and modified customization objects are inserted by using service, endpoint, contract, or operation behavior objects.</span></span> <span data-ttu-id="4723a-119">Cette rubrique ne décrit pas comment utiliser des comportements.</span><span class="sxs-lookup"><span data-stu-id="4723a-119">This topic does not describe how to use behaviors.</span></span> <span data-ttu-id="4723a-120">Pour plus d’informations sur les types utilisés pour insérer des modifications de répartiteur, consultez [configuration et extension du runtime à l’aide de comportements](configuring-and-extending-the-runtime-with-behaviors.md).</span><span class="sxs-lookup"><span data-stu-id="4723a-120">For more information about the types used to insert dispatcher modifications, see [Configuring and Extending the Runtime with Behaviors](configuring-and-extending-the-runtime-with-behaviors.md).</span></span>

<span data-ttu-id="4723a-121">Le graphique suivant fournit une vue d'ensemble des éléments architecturaux dans un service.</span><span class="sxs-lookup"><span data-stu-id="4723a-121">The following graphic provides a high-level view of the architectural items in a service.</span></span>

<span data-ttu-id="4723a-122">![Architecture du runtime de dispatch](./media/wcfc-dispatchruntimearchc.gif "wcfc_DispatchRuntimeArchc")</span><span class="sxs-lookup"><span data-stu-id="4723a-122">![The dispatch runtime architecture](./media/wcfc-dispatchruntimearchc.gif "wcfc_DispatchRuntimeArchc")</span></span>

### <a name="channel-dispatchers"></a><span data-ttu-id="4723a-123">Répartiteurs de canal</span><span class="sxs-lookup"><span data-stu-id="4723a-123">Channel Dispatchers</span></span>

<span data-ttu-id="4723a-124">Un objet <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> est créé pour associer un objet <xref:System.ServiceModel.Channels.IChannelListener> à un URI donné (appelé « URI d'écoute ») avec une instance d'un service.</span><span class="sxs-lookup"><span data-stu-id="4723a-124">A <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> object is created to associate an <xref:System.ServiceModel.Channels.IChannelListener> at a particular URI (called a listen URI) with an instance of a service.</span></span> <span data-ttu-id="4723a-125">Chaque objet <xref:System.ServiceModel.ServiceHost> peut avoir de nombreux objets <xref:System.ServiceModel.Dispatcher.ChannelDispatcher>, chacun étant associé à un seul écouteur et à un seul URI d'écoute.</span><span class="sxs-lookup"><span data-stu-id="4723a-125">Each <xref:System.ServiceModel.ServiceHost> object can have many <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> objects, each associated with only one listener and listen URI.</span></span> <span data-ttu-id="4723a-126">Lorsqu'un message arrive, le <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> interroge chacun des objets <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> associés pour déterminer si le point de terminaison peut accepter le message, et passe le message à celui-ci.</span><span class="sxs-lookup"><span data-stu-id="4723a-126">When a message arrives, the <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> queries each of the associated <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> objects whether the endpoint can accept the message, and passes the message to the one that can.</span></span>

<span data-ttu-id="4723a-127">Toutes les propriétés qui contrôlent la durée de vie et le comportement d'une session de canal sont disponibles pour l'inspection ou la modification sur l'objet <xref:System.ServiceModel.Dispatcher.ChannelDispatcher>.</span><span class="sxs-lookup"><span data-stu-id="4723a-127">All properties that control the lifetime and behavior of a channel session are available for inspection or modification on the <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> object.</span></span> <span data-ttu-id="4723a-128">Cela inclut les initialiseurs de canal personnalisés, l'écouteur de canal, l'hôte, le <xref:System.ServiceModel.InstanceContext>associé, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="4723a-128">These include custom channel initializers, the channel listener, the host, the associated <xref:System.ServiceModel.InstanceContext>, and so on.</span></span>

### <a name="endpoint-dispatchers"></a><span data-ttu-id="4723a-129">Répartiteurs de point de terminaison</span><span class="sxs-lookup"><span data-stu-id="4723a-129">Endpoint Dispatchers</span></span>

<span data-ttu-id="4723a-130">L'objet <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> est chargé du traitement des messages à partir d'un <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> lorsque l'adresse de destination d'un message correspond à la propriété <xref:System.ServiceModel.Dispatcher.EndpointDispatcher.AddressFilter%2A> et que l'action de message correspond à la propriété <xref:System.ServiceModel.Dispatcher.EndpointDispatcher.ContractFilter%2A>.</span><span class="sxs-lookup"><span data-stu-id="4723a-130">The <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> object is responsible for processing messages from a <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> when the destination address of a message matches the <xref:System.ServiceModel.Dispatcher.EndpointDispatcher.AddressFilter%2A> and the message action matches the <xref:System.ServiceModel.Dispatcher.EndpointDispatcher.ContractFilter%2A> property.</span></span> <span data-ttu-id="4723a-131">Si deux objets <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> peuvent accepter un message, la valeur de la propriété <xref:System.ServiceModel.Dispatcher.EndpointDispatcher.FilterPriority%2A> détermine le point de terminaison dont la priorité est la plus élevée.</span><span class="sxs-lookup"><span data-stu-id="4723a-131">If two <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> objects can accept a message, the <xref:System.ServiceModel.Dispatcher.EndpointDispatcher.FilterPriority%2A> property value determines the higher priority endpoint.</span></span>

<span data-ttu-id="4723a-132">Utilisez <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> pour acquérir les deux principaux points d’extension de modèle de service, les classes <xref:System.ServiceModel.Dispatcher.DispatchRuntime> et <xref:System.ServiceModel.Dispatcher.DispatchOperation>, que vous pouvez utiliser pour personnaliser le traitement du répartiteur.</span><span class="sxs-lookup"><span data-stu-id="4723a-132">Use the <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> to acquire the two main service model extension points – the <xref:System.ServiceModel.Dispatcher.DispatchRuntime> and <xref:System.ServiceModel.Dispatcher.DispatchOperation> classes – that you can use to customize the processing of the dispatcher.</span></span> <span data-ttu-id="4723a-133">La classe <xref:System.ServiceModel.Dispatcher.DispatchRuntime> permet aux utilisateurs d'intercepter et d'étendre le répartiteur à l'étendue du contrat (autrement dit, pour tous les messages dans un contrat).</span><span class="sxs-lookup"><span data-stu-id="4723a-133">The <xref:System.ServiceModel.Dispatcher.DispatchRuntime> class allows users to intercept and extend the dispatcher at the contract scope (that is, for all messages in a contract).</span></span> <span data-ttu-id="4723a-134">La classe <xref:System.ServiceModel.Dispatcher.DispatchOperation> permet aux utilisateurs d'intercepter et d'étendre le répartiteur à une étendue d'opération (autrement dit, pour tous les messages dans une opération).</span><span class="sxs-lookup"><span data-stu-id="4723a-134">The <xref:System.ServiceModel.Dispatcher.DispatchOperation> class allows users to intercept and extend the dispatcher at an operation scope (that is, for all messages in an operation).</span></span>

## <a name="scenarios"></a><span data-ttu-id="4723a-135">Scénarios</span><span class="sxs-lookup"><span data-stu-id="4723a-135">Scenarios</span></span>

<span data-ttu-id="4723a-136">Plusieurs raisons d'étendre le répartiteur existent :</span><span class="sxs-lookup"><span data-stu-id="4723a-136">There a number of reasons to extend the dispatcher:</span></span>

- <span data-ttu-id="4723a-137">Validation personnalisée des messages.</span><span class="sxs-lookup"><span data-stu-id="4723a-137">Custom Message Validation.</span></span> <span data-ttu-id="4723a-138">Les utilisateurs peuvent s'assurer qu'un message est valide pour un schéma spécifique.</span><span class="sxs-lookup"><span data-stu-id="4723a-138">Users can enforce that a message is valid for a certain schema.</span></span> <span data-ttu-id="4723a-139">Cela peut être accompli en implémentant les interfaces d'intercepteur de messages.</span><span class="sxs-lookup"><span data-stu-id="4723a-139">This can be done by implementing the message interceptor interfaces.</span></span> <span data-ttu-id="4723a-140">Pour obtenir un exemple, consultez [inspecteurs de messages](../samples/message-inspectors.md).</span><span class="sxs-lookup"><span data-stu-id="4723a-140">For an example, see [Message Inspectors](../samples/message-inspectors.md).</span></span>

- <span data-ttu-id="4723a-141">Enregistrement personnalisé des messages.</span><span class="sxs-lookup"><span data-stu-id="4723a-141">Custom Message Logging.</span></span> <span data-ttu-id="4723a-142">Les utilisateurs peuvent inspecter et enregistrer des jeux de messages d'application qui transitent par un point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="4723a-142">Users can inspect and log some set of application messages that flow through an endpoint.</span></span> <span data-ttu-id="4723a-143">Cela peut également être accompli à l'aide des interfaces de l'intercepteur de messages.</span><span class="sxs-lookup"><span data-stu-id="4723a-143">This can also be accomplished with the message interceptor interfaces.</span></span>

- <span data-ttu-id="4723a-144">Transformations personnalisées des messages.</span><span class="sxs-lookup"><span data-stu-id="4723a-144">Custom Message Transformations.</span></span> <span data-ttu-id="4723a-145">Les utilisateurs peuvent appliquer certaines transformations au message dans l'exécution (par exemple, pour le contrôle de la version).</span><span class="sxs-lookup"><span data-stu-id="4723a-145">Users can apply certain transformations to the message in the runtime (for example, for versioning).</span></span> <span data-ttu-id="4723a-146">Cela peut, à nouveau, être accompli à l'aide des interfaces de l'intercepteur de messages.</span><span class="sxs-lookup"><span data-stu-id="4723a-146">This can be accomplished, again, with the message interceptor interfaces.</span></span>

- <span data-ttu-id="4723a-147">Modèle personnalisé de données.</span><span class="sxs-lookup"><span data-stu-id="4723a-147">Custom Data Model.</span></span> <span data-ttu-id="4723a-148">Les utilisateurs peuvent avoir un modèle de sérialisation de données autre que celui pris en charge par défaut dans <xref:System.Runtime.Serialization.DataContractSerializer?displayProperty=nameWithType>WCF <xref:System.Xml.Serialization.XmlSerializer?displayProperty=nameWithType>(à savoir, les messages bruts,, et).</span><span class="sxs-lookup"><span data-stu-id="4723a-148">Users can have a data serialization model other than those supported by default in WCF (namely, <xref:System.Runtime.Serialization.DataContractSerializer?displayProperty=nameWithType>, <xref:System.Xml.Serialization.XmlSerializer?displayProperty=nameWithType>, and raw messages).</span></span> <span data-ttu-id="4723a-149">Cela peut être accompli en implémentant les interfaces du module de formatage de messages.</span><span class="sxs-lookup"><span data-stu-id="4723a-149">This can be done by implement the message formatter interfaces.</span></span> <span data-ttu-id="4723a-150">Pour obtenir un exemple, consultez [formateur d’opérations et sélecteur d’opérations](../samples/operation-formatter-and-operation-selector.md).</span><span class="sxs-lookup"><span data-stu-id="4723a-150">For an example, see [Operation Formatter and Operation Selector](../samples/operation-formatter-and-operation-selector.md).</span></span>

- <span data-ttu-id="4723a-151">Validation personnalisée des paramètres.</span><span class="sxs-lookup"><span data-stu-id="4723a-151">Custom Parameter Validation.</span></span> <span data-ttu-id="4723a-152">Les utilisateurs peuvent s’assurer que les paramètres typés sont valides (contrairement à XML).</span><span class="sxs-lookup"><span data-stu-id="4723a-152">Users can enforce that typed parameters are valid (as opposed to XML).</span></span> <span data-ttu-id="4723a-153">Cela peut être accompli à l'aide des interfaces de l'inspecteur de paramètres.</span><span class="sxs-lookup"><span data-stu-id="4723a-153">This can be done using the parameter inspector interfaces.</span></span>

- <span data-ttu-id="4723a-154">Distribution personnalisée d'opérations.</span><span class="sxs-lookup"><span data-stu-id="4723a-154">Custom Operation Dispatching.</span></span> <span data-ttu-id="4723a-155">Les utilisateurs peuvent implémenter la distribution sur autre chose qu'une action. par exemple, sur le corps ou sur une propriété de message personnalisée.</span><span class="sxs-lookup"><span data-stu-id="4723a-155">Users can implement dispatching on something other than action – for example, on the body element, or on a custom message property.</span></span> <span data-ttu-id="4723a-156">Cela peut s'effectuer à l'aide de l'interface <xref:System.ServiceModel.Dispatcher.IDispatchOperationSelector>.</span><span class="sxs-lookup"><span data-stu-id="4723a-156">This can be done using the <xref:System.ServiceModel.Dispatcher.IDispatchOperationSelector> interface.</span></span> <span data-ttu-id="4723a-157">Pour obtenir un exemple, consultez [formateur d’opérations et sélecteur d’opérations](../samples/operation-formatter-and-operation-selector.md).</span><span class="sxs-lookup"><span data-stu-id="4723a-157">For an example, see [Operation Formatter and Operation Selector](../samples/operation-formatter-and-operation-selector.md).</span></span>

- <span data-ttu-id="4723a-158">mise en pool d’objet</span><span class="sxs-lookup"><span data-stu-id="4723a-158">Object Pooling.</span></span> <span data-ttu-id="4723a-159">Les utilisateurs peuvent regrouper des instances plutôt qu'allouer une nouvelle instance pour chaque appel.</span><span class="sxs-lookup"><span data-stu-id="4723a-159">Users can pool instances rather than allocating a new one for every call.</span></span> <span data-ttu-id="4723a-160">Cela peut être implémenté à l'aide des interfaces du fournisseur d'instances.</span><span class="sxs-lookup"><span data-stu-id="4723a-160">This can be implemented using the instance provider interfaces.</span></span> <span data-ttu-id="4723a-161">Pour obtenir un exemple, consultez [regroupement](../samples/pooling.md).</span><span class="sxs-lookup"><span data-stu-id="4723a-161">For an example, see [Pooling](../samples/pooling.md).</span></span>

- <span data-ttu-id="4723a-162">Bail d'instances.</span><span class="sxs-lookup"><span data-stu-id="4723a-162">Instance Leasing.</span></span> <span data-ttu-id="4723a-163">Les utilisateurs peuvent implémenter un modèle de bail pour la durée de vie de l'instance, semblable à celui de .NET Framework Remoting.</span><span class="sxs-lookup"><span data-stu-id="4723a-163">Users can implement a leasing pattern for instance lifetime, similar to that of .NET Framework Remoting.</span></span> <span data-ttu-id="4723a-164">Cela peut s'effectuer à l'aide des interfaces de durée de vie de contexte d'instance.</span><span class="sxs-lookup"><span data-stu-id="4723a-164">This can be done using the instance context lifetime interfaces.</span></span>

- <span data-ttu-id="4723a-165">Gestion personnalisée des erreurs.</span><span class="sxs-lookup"><span data-stu-id="4723a-165">Custom Error Handling.</span></span> <span data-ttu-id="4723a-166">Les utilisateurs peuvent contrôler à la fois, comment les erreurs locales sont traitées et comment les erreurs sont retournées aux clients.</span><span class="sxs-lookup"><span data-stu-id="4723a-166">Users can control how both local errors are processed and how faults are communicated back to clients.</span></span> <span data-ttu-id="4723a-167">Cela peut être implémenté à l'aide des interfaces <xref:System.ServiceModel.Dispatcher.IErrorHandler>.</span><span class="sxs-lookup"><span data-stu-id="4723a-167">This can be implemented using the <xref:System.ServiceModel.Dispatcher.IErrorHandler> interfaces.</span></span>

- <span data-ttu-id="4723a-168">Comportements d'autorisation personnalisés.</span><span class="sxs-lookup"><span data-stu-id="4723a-168">Custom Authorization Behaviors.</span></span> <span data-ttu-id="4723a-169">Les utilisateurs peuvent implémenter un contrôle d'accès personnalisé en étendant les morceaux d'exécution Contrat ou Opération et en ajoutant des vérifications de sécurité en fonction des jetons présents dans le message.</span><span class="sxs-lookup"><span data-stu-id="4723a-169">Users can implement custom access control by extending the Contract or Operation run-time pieces and adding security checks based upon the tokens present in the message.</span></span> <span data-ttu-id="4723a-170">Cela peut être accompli en utilisant soit les interfaces de l'intercepteur de messages, soit les interfaces de l'intercepteur de paramètres.</span><span class="sxs-lookup"><span data-stu-id="4723a-170">This can be accomplished using either the message interceptor or parameter interceptor interfaces.</span></span> <span data-ttu-id="4723a-171">Pour obtenir des exemples, consultez extensibilité de la [sécurité](../samples/security-extensibility.md).</span><span class="sxs-lookup"><span data-stu-id="4723a-171">For examples, see [Security Extensibility](../samples/security-extensibility.md).</span></span>

  > [!CAUTION]
  > <span data-ttu-id="4723a-172">Étant donné que la modification des propriétés de sécurité risque de compromettre la sécurité des applications WCF, il est fortement recommandé d’effectuer des modifications liées à la sécurité avec soin et de tester minutieusement avant le déploiement.</span><span class="sxs-lookup"><span data-stu-id="4723a-172">Because altering security properties has the potential to compromise the security of WCF applications, it is strongly recommended that you undertake security-related modifications with care and test thoroughly prior to deployment.</span></span>

- <span data-ttu-id="4723a-173">Validateurs d'exécution WCF personnalisés.</span><span class="sxs-lookup"><span data-stu-id="4723a-173">Custom WCF Runtime Validators.</span></span> <span data-ttu-id="4723a-174">Vous pouvez installer des validateurs personnalisés qui examinent des services, des contrats et des liaisons pour appliquer des stratégies au niveau de l’entreprise en ce qui concerne les applications WCF.</span><span class="sxs-lookup"><span data-stu-id="4723a-174">You can install custom validators that examine services, contracts, and bindings to enforce enterprise-level policies with respect to WCF applications.</span></span> <span data-ttu-id="4723a-175">(Par exemple, consultez [procédure : Verrouiller les points de terminaison dans l'](how-to-lock-down-endpoints-in-the-enterprise.md)entreprise.)</span><span class="sxs-lookup"><span data-stu-id="4723a-175">(For example, see [How to: Lock Down Endpoints in the Enterprise](how-to-lock-down-endpoints-in-the-enterprise.md).)</span></span>

### <a name="using-the-dispatchruntime-class"></a><span data-ttu-id="4723a-176">Utilisation de la classe DispatchRuntime</span><span class="sxs-lookup"><span data-stu-id="4723a-176">Using the DispatchRuntime Class</span></span>

<span data-ttu-id="4723a-177">Utilisez la classe <xref:System.ServiceModel.Dispatcher.DispatchRuntime> pour modifier le comportement par défaut d'un service ou d'un point de terminaison individuel, ou insérer des objets qui implémentent des changements personnalisés vers un ou deux des processus de service (ou processus client, dans le cas d'un client duplex) suivants :</span><span class="sxs-lookup"><span data-stu-id="4723a-177">Use the <xref:System.ServiceModel.Dispatcher.DispatchRuntime> class either to modify the default behavior of a service or individual endpoint, or to insert objects that implement custom modifications to one or both of the following service processes (or client processes in the case of a duplex client):</span></span>

- <span data-ttu-id="4723a-178">La transformation de messages entrants dans les objets et la diffusion de ces objets comme appels de méthode sur un objet de service.</span><span class="sxs-lookup"><span data-stu-id="4723a-178">The transformation of incoming messages into objects and releasing those objects as method invocations on a service object.</span></span>

- <span data-ttu-id="4723a-179">La transformation d'objets reçu de la réponse à un appel d'opération de service dans des messages sortants.</span><span class="sxs-lookup"><span data-stu-id="4723a-179">The transformation of objects received from the response to a service operation invocation into outbound messages.</span></span>

<span data-ttu-id="4723a-180"><xref:System.ServiceModel.Dispatcher.DispatchRuntime> vous permet d'intercepter et d'étendre le canal ou le répartiteur de point de terminaison pour tous les messages à travers un contrat particulier, même lorsqu'un message n'est pas reconnu.</span><span class="sxs-lookup"><span data-stu-id="4723a-180">The <xref:System.ServiceModel.Dispatcher.DispatchRuntime> enables you to intercept and extend the channel or endpoint dispatcher for all messages across a particular contract, even when a message is not recognized.</span></span> <span data-ttu-id="4723a-181">Lorsqu'un message arrive et qu'il ne correspond à aucun message déclaré dans le contrat, il est distribué à l'opération retournée par la propriété <xref:System.ServiceModel.Dispatcher.DispatchRuntime.UnhandledDispatchOperation%2A>.</span><span class="sxs-lookup"><span data-stu-id="4723a-181">When a message arrives that does not match any declared in the contract it is dispatched to the operation returned by the <xref:System.ServiceModel.Dispatcher.DispatchRuntime.UnhandledDispatchOperation%2A> property.</span></span> <span data-ttu-id="4723a-182">Pour intercepter ou étendre à travers tous les messages une opération particulière, consultez la classe <xref:System.ServiceModel.Dispatcher.DispatchOperation>.</span><span class="sxs-lookup"><span data-stu-id="4723a-182">To intercept or extend across all messages for a particular operation, see the <xref:System.ServiceModel.Dispatcher.DispatchOperation> class.</span></span>

<span data-ttu-id="4723a-183">Il existe quatre domaines principaux d'extensibilité de répartiteur exposés par la classe <xref:System.ServiceModel.Dispatcher.DispatchRuntime> :</span><span class="sxs-lookup"><span data-stu-id="4723a-183">There are four main areas of dispatcher extensibility exposed by the <xref:System.ServiceModel.Dispatcher.DispatchRuntime> class:</span></span>

1. <span data-ttu-id="4723a-184">Les composants de canal utilisent les propriétés de <xref:System.ServiceModel.Dispatcher.DispatchRuntime> et celles du répartiteur de canal associé retournées par la propriété <xref:System.ServiceModel.Dispatcher.DispatchRuntime.ChannelDispatcher%2A> pour personnaliser la façon dont le répartiteur de canal accepte et ferme des canaux.</span><span class="sxs-lookup"><span data-stu-id="4723a-184">Channel components use the properties of the <xref:System.ServiceModel.Dispatcher.DispatchRuntime> and those of the associated channel dispatcher returned by the <xref:System.ServiceModel.Dispatcher.DispatchRuntime.ChannelDispatcher%2A> property to customize how the channel dispatcher accepts and closes channels.</span></span> <span data-ttu-id="4723a-185">Cette catégorie inclut les propriétés <xref:System.ServiceModel.Dispatcher.ChannelDispatcher.ChannelInitializers%2A> et <xref:System.ServiceModel.Dispatcher.DispatchRuntime.InputSessionShutdownHandlers%2A>.</span><span class="sxs-lookup"><span data-stu-id="4723a-185">This category includes the <xref:System.ServiceModel.Dispatcher.ChannelDispatcher.ChannelInitializers%2A> and <xref:System.ServiceModel.Dispatcher.DispatchRuntime.InputSessionShutdownHandlers%2A> properties.</span></span>

2. <span data-ttu-id="4723a-186">Les composants de message sont personnalisés pour chaque message traité.</span><span class="sxs-lookup"><span data-stu-id="4723a-186">Message components are customized for each message processed.</span></span> <span data-ttu-id="4723a-187">Cette catégorie inclut les propriétés <xref:System.ServiceModel.Dispatcher.DispatchRuntime.MessageInspectors%2A>, <xref:System.ServiceModel.Dispatcher.DispatchRuntime.OperationSelector%2A>, <xref:System.ServiceModel.Dispatcher.DispatchRuntime.Operations%2A> et <xref:System.ServiceModel.Dispatcher.ChannelDispatcher.ErrorHandlers%2A>.</span><span class="sxs-lookup"><span data-stu-id="4723a-187">This category includes the <xref:System.ServiceModel.Dispatcher.DispatchRuntime.MessageInspectors%2A>, <xref:System.ServiceModel.Dispatcher.DispatchRuntime.OperationSelector%2A>, <xref:System.ServiceModel.Dispatcher.DispatchRuntime.Operations%2A>, and the <xref:System.ServiceModel.Dispatcher.ChannelDispatcher.ErrorHandlers%2A> properties.</span></span>

3. <span data-ttu-id="4723a-188">Les composants d'instance personnalisent la création, la durée de vie et la suppression des instances du type de service.</span><span class="sxs-lookup"><span data-stu-id="4723a-188">Instance components customize the creation, lifetime, and disposal of instances of the service type.</span></span> <span data-ttu-id="4723a-189">Pour plus d'informations sur la durée de vie de l'objet de service, consultez la propriété <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A>.</span><span class="sxs-lookup"><span data-stu-id="4723a-189">For more information about service object lifetimes, see the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> property.</span></span> <span data-ttu-id="4723a-190">Cette catégorie inclut les propriétés <xref:System.ServiceModel.Dispatcher.DispatchRuntime.InstanceContextInitializers%2A> et <xref:System.ServiceModel.Dispatcher.DispatchRuntime.InstanceProvider%2A>.</span><span class="sxs-lookup"><span data-stu-id="4723a-190">This category includes the <xref:System.ServiceModel.Dispatcher.DispatchRuntime.InstanceContextInitializers%2A> and the <xref:System.ServiceModel.Dispatcher.DispatchRuntime.InstanceProvider%2A> properties.</span></span>

4. <span data-ttu-id="4723a-191">Les composants relatifs à la sécurité peuvent utiliser les propriétés suivantes :</span><span class="sxs-lookup"><span data-stu-id="4723a-191">Security-related components can use the following properties:</span></span>

    - <span data-ttu-id="4723a-192"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.SecurityAuditLogLocation%2A> indique où les événements d'audit sont écrits.</span><span class="sxs-lookup"><span data-stu-id="4723a-192"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.SecurityAuditLogLocation%2A> indicates where audit events are written.</span></span>

    - <span data-ttu-id="4723a-193"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.ImpersonateCallerForAllOperations%2A> contrôle si le service essaie d'emprunter l'identité à l'aide des informations d'identification fournies par le message entrant.</span><span class="sxs-lookup"><span data-stu-id="4723a-193"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.ImpersonateCallerForAllOperations%2A> controls whether the service attempts to impersonate using the credentials provided by the incoming message.</span></span>

    - <span data-ttu-id="4723a-194"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.MessageAuthenticationAuditLevel%2A> contrôle si les événements d'authentification de message réussis sont écrits dans le journal des événements spécifié par <xref:System.ServiceModel.Dispatcher.DispatchRuntime.SecurityAuditLogLocation%2A>.</span><span class="sxs-lookup"><span data-stu-id="4723a-194"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.MessageAuthenticationAuditLevel%2A> controls whether successful message authentication events are written to the event log specified by <xref:System.ServiceModel.Dispatcher.DispatchRuntime.SecurityAuditLogLocation%2A>.</span></span>

    - <span data-ttu-id="4723a-195"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.PrincipalPermissionMode%2A> contrôle la façon dont la propriété <xref:System.Threading.Thread.CurrentPrincipal%2A> est définie.</span><span class="sxs-lookup"><span data-stu-id="4723a-195"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.PrincipalPermissionMode%2A> controls how the <xref:System.Threading.Thread.CurrentPrincipal%2A> property is set.</span></span>

    - <span data-ttu-id="4723a-196"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.ServiceAuthorizationAuditLevel%2A> spécifie comment l'audit d'événements d'autorisation est effectué.</span><span class="sxs-lookup"><span data-stu-id="4723a-196"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.ServiceAuthorizationAuditLevel%2A> specifies how the auditing of authorization events is performed.</span></span>

    - <span data-ttu-id="4723a-197"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.SuppressAuditFailure%2A> spécifie s'il faut supprimer les exceptions non critiques qui se produisent pendant le processus d'enregistrement.</span><span class="sxs-lookup"><span data-stu-id="4723a-197"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.SuppressAuditFailure%2A> specifies whether to suppress non-critical exceptions that occur during the logging process.</span></span>

<span data-ttu-id="4723a-198">Généralement, des objets d'extension personnalisés sont affectés à une propriété <xref:System.ServiceModel.Dispatcher.DispatchRuntime> ou insérés dans une collection par un comportement de service (un objet qui implémente <xref:System.ServiceModel.Description.IServiceBehavior>), un comportement de contrat (un objet qui implémente <xref:System.ServiceModel.Description.IContractBehavior>) ou un comportement de point de terminaison (un objet qui implémente <xref:System.ServiceModel.Description.IEndpointBehavior>).</span><span class="sxs-lookup"><span data-stu-id="4723a-198">Typically, custom extension objects are assigned to a <xref:System.ServiceModel.Dispatcher.DispatchRuntime> property or inserted into a collection by a service behavior (an object that implements <xref:System.ServiceModel.Description.IServiceBehavior>), a contract behavior (an object that implements <xref:System.ServiceModel.Description.IContractBehavior>), or an endpoint behavior (an object that implements <xref:System.ServiceModel.Description.IEndpointBehavior>).</span></span> <span data-ttu-id="4723a-199">Puis, l’objet de comportement installé est ajouté à la collection appropriée de comportements soit via le programme soit en implémentant un objet <xref:System.ServiceModel.Configuration.BehaviorExtensionElement> personnalisé pour que le comportement soit inséré à l’aide d’un fichier de configuration d’application.</span><span class="sxs-lookup"><span data-stu-id="4723a-199">Then the installing behavior object is added to the appropriate collection of behaviors either programmatically or by implementing a custom <xref:System.ServiceModel.Configuration.BehaviorExtensionElement> object to enable the behavior to be inserted using an application configuration file.</span></span>

<span data-ttu-id="4723a-200">Les clients duplex (clients qui implémentent un contrat de rappel spécifié par un service duplex) ont également un objet <xref:System.ServiceModel.Dispatcher.DispatchRuntime> qui peut être accédé à l'aide de la propriété <xref:System.ServiceModel.Dispatcher.ClientRuntime.CallbackDispatchRuntime%2A>.</span><span class="sxs-lookup"><span data-stu-id="4723a-200">Duplex clients (clients that implement a callback contract specified by a duplex service) also have a <xref:System.ServiceModel.Dispatcher.DispatchRuntime> object that can be accessed using the <xref:System.ServiceModel.Dispatcher.ClientRuntime.CallbackDispatchRuntime%2A> property.</span></span>

### <a name="using-the-dispatchoperation-class"></a><span data-ttu-id="4723a-201">Utilisation de la classe DispatchOperation</span><span class="sxs-lookup"><span data-stu-id="4723a-201">Using the DispatchOperation Class</span></span>

<span data-ttu-id="4723a-202">La classe <xref:System.ServiceModel.Dispatcher.DispatchOperation> est l’emplacement des modifications d’exécution et le point d’insertion des extensions personnalisées qui sont limitées à une seule opération de service.</span><span class="sxs-lookup"><span data-stu-id="4723a-202">The <xref:System.ServiceModel.Dispatcher.DispatchOperation> class is the location for run-time modifications and the insertion point for custom extensions that are scoped to only one service operation.</span></span> <span data-ttu-id="4723a-203">(Pour modifier le comportement d'exécution du service pour tous les messages d'un contrat, utilisez la classe <xref:System.ServiceModel.Dispatcher.DispatchRuntime>.)</span><span class="sxs-lookup"><span data-stu-id="4723a-203">(To modify service run-time behavior for all messages in a contract, use the <xref:System.ServiceModel.Dispatcher.DispatchRuntime> class.)</span></span>

<span data-ttu-id="4723a-204">Installez des changements <xref:System.ServiceModel.Dispatcher.DispatchOperation> à l'aide d'un objet de comportement de service personnalisé.</span><span class="sxs-lookup"><span data-stu-id="4723a-204">Install <xref:System.ServiceModel.Dispatcher.DispatchOperation> modifications using a custom service behavior object.</span></span>

<span data-ttu-id="4723a-205">Utilisez la propriété <xref:System.ServiceModel.Dispatcher.DispatchRuntime.Operations%2A> pour localiser l'objet <xref:System.ServiceModel.Dispatcher.DispatchOperation> qui représente une opération de service particulière.</span><span class="sxs-lookup"><span data-stu-id="4723a-205">Use the <xref:System.ServiceModel.Dispatcher.DispatchRuntime.Operations%2A> property to locate the <xref:System.ServiceModel.Dispatcher.DispatchOperation> object that represents a particular service operation.</span></span>

<span data-ttu-id="4723a-206">La propriétés suivantes contrôlent l'exécution au niveau de l'opération :</span><span class="sxs-lookup"><span data-stu-id="4723a-206">The following properties control runtime execution at the operation level:</span></span>

- <span data-ttu-id="4723a-207">Les propriétés <xref:System.ServiceModel.Dispatcher.DispatchOperation.Action%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.ReplyAction%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.FaultContractInfos%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.IsOneWay%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.IsTerminating%2A> et <xref:System.ServiceModel.Dispatcher.DispatchOperation.Name%2A> obtiennent les valeurs respectives pour l'opération.</span><span class="sxs-lookup"><span data-stu-id="4723a-207">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.Action%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.ReplyAction%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.FaultContractInfos%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.IsOneWay%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.IsTerminating%2A>, and <xref:System.ServiceModel.Dispatcher.DispatchOperation.Name%2A> properties obtain the respective values for the operation.</span></span>

- <span data-ttu-id="4723a-208"><xref:System.ServiceModel.Dispatcher.DispatchOperation.TransactionAutoComplete%2A> et <xref:System.ServiceModel.Dispatcher.DispatchOperation.TransactionRequired%2A> spécifient le comportement de la transaction.</span><span class="sxs-lookup"><span data-stu-id="4723a-208">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.TransactionAutoComplete%2A> and <xref:System.ServiceModel.Dispatcher.DispatchOperation.TransactionRequired%2A> specify transaction behavior.</span></span>

- <span data-ttu-id="4723a-209">Les propriétés <xref:System.ServiceModel.Dispatcher.DispatchOperation.ReleaseInstanceBeforeCall%2A> et <xref:System.ServiceModel.Dispatcher.DispatchOperation.ReleaseInstanceAfterCall%2A> contrôlent la durée de vie de l'objet de service défini par l'utilisateur relatif à <xref:System.ServiceModel.InstanceContext>.</span><span class="sxs-lookup"><span data-stu-id="4723a-209">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.ReleaseInstanceBeforeCall%2A> and <xref:System.ServiceModel.Dispatcher.DispatchOperation.ReleaseInstanceAfterCall%2A> properties control the lifetime of the user-defined service object relative to the <xref:System.ServiceModel.InstanceContext>.</span></span>

- <span data-ttu-id="4723a-210">Les propriétés <xref:System.ServiceModel.Dispatcher.DispatchOperation.DeserializeRequest%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.SerializeReply%2A>et <xref:System.ServiceModel.Dispatcher.DispatchOperation.Formatter%2A> activent le contrôle explicite sur la conversion des messages en objets et vice versa.</span><span class="sxs-lookup"><span data-stu-id="4723a-210">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.DeserializeRequest%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.SerializeReply%2A>, and the <xref:System.ServiceModel.Dispatcher.DispatchOperation.Formatter%2A> properties enable explicit control over the conversion from messages to objects and objects to messages.</span></span>

- <span data-ttu-id="4723a-211">La propriété <xref:System.ServiceModel.Dispatcher.DispatchOperation.Impersonation%2A> spécifie le niveau d'emprunt d'identité de l'opération.</span><span class="sxs-lookup"><span data-stu-id="4723a-211">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.Impersonation%2A> property specifies the operation impersonation level.</span></span>

- <span data-ttu-id="4723a-212">La propriété <xref:System.ServiceModel.Dispatcher.DispatchOperation.CallContextInitializers%2A> insère des extensions de contexte d’appel personnalisées pour l’opération.</span><span class="sxs-lookup"><span data-stu-id="4723a-212">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.CallContextInitializers%2A> property inserts custom call context extensions for the operation.</span></span>

- <span data-ttu-id="4723a-213">La propriété <xref:System.ServiceModel.Dispatcher.DispatchOperation.AutoDisposeParameters%2A> contrôle à quel moment les objets de paramètre sont détruits.</span><span class="sxs-lookup"><span data-stu-id="4723a-213">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.AutoDisposeParameters%2A> property controls when parameter objects are destroyed.</span></span>

- <span data-ttu-id="4723a-214">La propriété <xref:System.ServiceModel.Dispatcher.DispatchOperation.Invoker%2A> insère un objet de méthode d'appel personnalisé.</span><span class="sxs-lookup"><span data-stu-id="4723a-214">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.Invoker%2A> property to insert a custom invoker object.</span></span>

- <span data-ttu-id="4723a-215">La propriété <xref:System.ServiceModel.Dispatcher.DispatchOperation.ParameterInspectors%2A> vous permet d'insérer un inspecteur de paramètre personnalisé que vous pouvez utiliser pour inspecter ou modifier des paramètres et des valeurs de retour.</span><span class="sxs-lookup"><span data-stu-id="4723a-215">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.ParameterInspectors%2A> property enables you to insert a custom parameter inspector that you can use to inspect or modify parameters and return values.</span></span>

## <a name="see-also"></a><span data-ttu-id="4723a-216">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="4723a-216">See also</span></span>

- <xref:System.ServiceModel.Dispatcher.DispatchRuntime>
- <xref:System.ServiceModel.Dispatcher.DispatchOperation>
- [<span data-ttu-id="4723a-217">Guide pratique pour Inspecter et modifier des messages sur le service</span><span class="sxs-lookup"><span data-stu-id="4723a-217">How to: Inspect and Modify Messages on the Service</span></span>](how-to-inspect-and-modify-messages-on-the-service.md)
- [<span data-ttu-id="4723a-218">Guide pratique pour Inspecter ou modifier des paramètres</span><span class="sxs-lookup"><span data-stu-id="4723a-218">How to: Inspect or Modify Parameters</span></span>](how-to-inspect-or-modify-parameters.md)
- [<span data-ttu-id="4723a-219">Guide pratique : Verrouiller les points de terminaison dans l’entreprise</span><span class="sxs-lookup"><span data-stu-id="4723a-219">How to: Lock Down Endpoints in the Enterprise</span></span>](how-to-lock-down-endpoints-in-the-enterprise.md)

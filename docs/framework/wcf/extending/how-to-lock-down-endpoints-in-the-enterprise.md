---
title: 'Procédure : verrouiller des points de terminaison dans l’entreprise'
ms.date: 03/30/2017
ms.assetid: 1b7eaab7-da60-4cf7-9d6a-ec02709cf75d
ms.openlocfilehash: d2a0299dd67e6efe3e3d9e6bae81265d4ad314ee
ms.sourcegitcommit: 581ab03291e91983459e56e40ea8d97b5189227e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/27/2019
ms.locfileid: "70040276"
---
# <a name="how-to-lock-down-endpoints-in-the-enterprise"></a><span data-ttu-id="4eff8-102">Procédure : verrouiller des points de terminaison dans l’entreprise</span><span class="sxs-lookup"><span data-stu-id="4eff8-102">How to: Lock Down Endpoints in the Enterprise</span></span>

<span data-ttu-id="4eff8-103">Les entreprises de grande taille exigent souvent que les applications soient développées conformément à leurs stratégies de sécurité.</span><span class="sxs-lookup"><span data-stu-id="4eff8-103">Large enterprises often require that applications are developed in compliance with enterprise security policies.</span></span> <span data-ttu-id="4eff8-104">La rubrique suivante explique comment développer et installer un validateur de point de terminaison client qui peut être utilisé pour valider toutes les applications clientes Windows Communication Foundation (WCF) installées sur les ordinateurs.</span><span class="sxs-lookup"><span data-stu-id="4eff8-104">The following topic discusses how to develop and install a client endpoint validator that can be used to validate all Windows Communication Foundation (WCF) client applications installed on computers.</span></span>

<span data-ttu-id="4eff8-105">Dans ce cas, le validateur est un validateur client, car ce comportement de point de terminaison est ajouté à la section client [ \<commonBehaviors >](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) dans le fichier machine. config.</span><span class="sxs-lookup"><span data-stu-id="4eff8-105">In this case, the validator is a client validator because this endpoint behavior is added to the client [\<commonBehaviors>](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) section in the machine.config file.</span></span> <span data-ttu-id="4eff8-106">WCF charge uniquement les comportements de point de terminaison communs pour les applications clientes et charge uniquement les comportements de service communs pour les applications de service.</span><span class="sxs-lookup"><span data-stu-id="4eff8-106">WCF loads common endpoint behaviors only for client applications and loads common service behaviors only for service applications.</span></span> <span data-ttu-id="4eff8-107">Pour installer ce même validateur pour les applications de service, le validateur doit être un comportement de service.</span><span class="sxs-lookup"><span data-stu-id="4eff8-107">To install this same validator for service applications, the validator must be a service behavior.</span></span> <span data-ttu-id="4eff8-108">Pour plus d’informations, consultez la [ \<section > commonBehaviors](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) .</span><span class="sxs-lookup"><span data-stu-id="4eff8-108">For more information, see the [\<commonBehaviors>](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) section.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="4eff8-109">Les comportements de service ou de point de terminaison <xref:System.Security.AllowPartiallyTrustedCallersAttribute> non marqués avec l’attribut (APTCA) qui sont ajoutés à la [ \<section commonBehaviors >](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) d’un fichier de configuration ne sont pas exécutés quand l’application s’exécute dans un environnement de confiance partielle, et non une exception est levée lorsque cela se produit.</span><span class="sxs-lookup"><span data-stu-id="4eff8-109">Service or endpoint behaviors not marked with the <xref:System.Security.AllowPartiallyTrustedCallersAttribute> attribute (APTCA) that are added to the [\<commonBehaviors>](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) section of a configuration file are not run when the application runs in a partial trust environment, and no exception is thrown when this occurs.</span></span> <span data-ttu-id="4eff8-110">Pour appliquer l'exécution des comportements courants tels que les validateurs, vous devez effectuer l'une des actions suivantes :</span><span class="sxs-lookup"><span data-stu-id="4eff8-110">To enforce the running of common behaviors such as validators, you must either:</span></span>
>
> - <span data-ttu-id="4eff8-111">Marquez votre comportement courant avec <xref:System.Security.AllowPartiallyTrustedCallersAttribute> l’attribut afin qu’il puisse s’exécuter lorsqu’il est déployé comme une application de confiance partielle.</span><span class="sxs-lookup"><span data-stu-id="4eff8-111">Mark your common behavior with the <xref:System.Security.AllowPartiallyTrustedCallersAttribute> attribute so that it can run when deployed as a Partial Trust application.</span></span> <span data-ttu-id="4eff8-112">Notez qu'une entrée de Registre peut être définie sur l'ordinateur pour interdire l'exécution des assemblys marqués avec l'attribut APTCA.</span><span class="sxs-lookup"><span data-stu-id="4eff8-112">Note that a registry entry can be set on the computer to prevent APTCA-marked assemblies from running..</span></span>
>
> - <span data-ttu-id="4eff8-113">Assurez-vous que si l’application est déployée comme une application de confiance totale, les utilisateurs ne peuvent pas modifier les paramètres de sécurité d’accès du code pour exécuter l’application dans un environnement de confiance partielle.</span><span class="sxs-lookup"><span data-stu-id="4eff8-113">Ensure that if the application is deployed as a fully-trusted application that users cannot modify the code-access security settings to run the application in a Partial Trust environment.</span></span> <span data-ttu-id="4eff8-114">S'ils peuvent le faire, le validateur personnalisé ne s'exécute pas et aucune exception n'est levée.</span><span class="sxs-lookup"><span data-stu-id="4eff8-114">If they can do so, the custom validator does not run and no exception is thrown.</span></span> <span data-ttu-id="4eff8-115">Pour une façon de procéder, consultez l’option `levelfinal` à l’aide de l' [outil stratégie de sécurité d’accès du code (Caspol. exe)](https://go.microsoft.com/fwlink/?LinkId=248222).</span><span class="sxs-lookup"><span data-stu-id="4eff8-115">For one way to ensure this, see the `levelfinal` option using [Code Access Security Policy Tool (Caspol.exe)](https://go.microsoft.com/fwlink/?LinkId=248222).</span></span>
>
> <span data-ttu-id="4eff8-116">Pour plus d’informations, consultez [meilleures pratiques de confiance partielle](../../../../docs/framework/wcf/feature-details/partial-trust-best-practices.md) et [scénarios de déploiement pris en charge](../../../../docs/framework/wcf/feature-details/supported-deployment-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="4eff8-116">For more information, see [Partial Trust Best Practices](../../../../docs/framework/wcf/feature-details/partial-trust-best-practices.md) and [Supported Deployment Scenarios](../../../../docs/framework/wcf/feature-details/supported-deployment-scenarios.md).</span></span>

### <a name="to-create-the-endpoint-validator"></a><span data-ttu-id="4eff8-117">Pour créer le validateur de point de terminaison</span><span class="sxs-lookup"><span data-stu-id="4eff8-117">To create the endpoint validator</span></span>

1. <span data-ttu-id="4eff8-118">Créez un objet <xref:System.ServiceModel.Description.IEndpointBehavior> avec les étapes de validation souhaitées dans la méthode <xref:System.ServiceModel.Description.IEndpointBehavior.Validate%2A>.</span><span class="sxs-lookup"><span data-stu-id="4eff8-118">Create an <xref:System.ServiceModel.Description.IEndpointBehavior> with the desired validation steps in the <xref:System.ServiceModel.Description.IEndpointBehavior.Validate%2A> method.</span></span> <span data-ttu-id="4eff8-119">Le code suivant fournit un exemple.</span><span class="sxs-lookup"><span data-stu-id="4eff8-119">The following code provides an example.</span></span> <span data-ttu-id="4eff8-120">(Est extrait de l’exemple [Security validation.)](../../../../docs/framework/wcf/samples/security-validation.md) `InternetClientValidatorBehavior`</span><span class="sxs-lookup"><span data-stu-id="4eff8-120">(The `InternetClientValidatorBehavior` is taken from the [Security Validation](../../../../docs/framework/wcf/samples/security-validation.md) sample.)</span></span>

    [!code-csharp[LockdownValidation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/internetclientvalidatorbehavior.cs#2)]

2. <span data-ttu-id="4eff8-121">Créez un objet <xref:System.ServiceModel.Configuration.BehaviorExtensionElement> qui enregistre le validateur de point de terminaison créé à l'étape 1.</span><span class="sxs-lookup"><span data-stu-id="4eff8-121">Create new <xref:System.ServiceModel.Configuration.BehaviorExtensionElement> that registers the endpoint validator created in step 1.</span></span> <span data-ttu-id="4eff8-122">L'exemple de code suivant illustre ce point.</span><span class="sxs-lookup"><span data-stu-id="4eff8-122">The following code example shows this.</span></span> <span data-ttu-id="4eff8-123">(Le code d’origine de cet exemple se trouve dans l’exemple [Security validation](../../../../docs/framework/wcf/samples/security-validation.md) .)</span><span class="sxs-lookup"><span data-stu-id="4eff8-123">(The original code for this example is in the [Security Validation](../../../../docs/framework/wcf/samples/security-validation.md) sample.)</span></span>

    [!code-csharp[LockdownValidation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/internetclientvalidatorelement.cs#3)]

3. <span data-ttu-id="4eff8-124">Assurez-vous que l'assembly compilé est signé avec un nom fort.</span><span class="sxs-lookup"><span data-stu-id="4eff8-124">Make sure the compiled assembly is signed with a strong name.</span></span> <span data-ttu-id="4eff8-125">Pour plus d’informations, consultez l' [outil Strong Name Tool (SN. EXE)](https://go.microsoft.com/fwlink/?LinkId=248217) et les commandes du compilateur pour votre langage.</span><span class="sxs-lookup"><span data-stu-id="4eff8-125">For details, see the [Strong Name Tool (SN.EXE)](https://go.microsoft.com/fwlink/?LinkId=248217) and the compiler commands for your language.</span></span>

### <a name="to-install-the-validator-into-the-target-computer"></a><span data-ttu-id="4eff8-126">Pour installer le validateur dans l'ordinateur cible</span><span class="sxs-lookup"><span data-stu-id="4eff8-126">To install the validator into the target computer</span></span>

1. <span data-ttu-id="4eff8-127">Installez le validateur de point de terminaison à l'aide du mécanisme approprié.</span><span class="sxs-lookup"><span data-stu-id="4eff8-127">Install the endpoint validator using the appropriate mechanism.</span></span> <span data-ttu-id="4eff8-128">Dans une entreprise, cela peut s'effectuer en utilisant la stratégie de groupe ou SMS (Systems Management Server).</span><span class="sxs-lookup"><span data-stu-id="4eff8-128">In an enterprise, this can be using Group Policy and Systems Management Server (SMS).</span></span>

2. <span data-ttu-id="4eff8-129">Installez l’assembly avec nom fort dans le Global Assembly Cache à l’aide de [Gacutil. exe (outil global assembly cache)](../../../../docs/framework/tools/gacutil-exe-gac-tool.md).</span><span class="sxs-lookup"><span data-stu-id="4eff8-129">Install the strongly-named assembly into the global assembly cache using the [Gacutil.exe (Global Assembly Cache Tool)](../../../../docs/framework/tools/gacutil-exe-gac-tool.md).</span></span>

3. <span data-ttu-id="4eff8-130">Utilisez les types d'espaces de noms <xref:System.Configuration?displayProperty=nameWithType> pour :</span><span class="sxs-lookup"><span data-stu-id="4eff8-130">Use the <xref:System.Configuration?displayProperty=nameWithType> namespace types to:</span></span>

    1. <span data-ttu-id="4eff8-131">Ajoutez l’extension à la [ \<section > BehaviorExtensions](../../../../docs/framework/configure-apps/file-schema/wcf/behaviorextensions.md) à l’aide d’un nom de type qualifié complet et verrouillez l’élément.</span><span class="sxs-lookup"><span data-stu-id="4eff8-131">Add the extension to the [\<behaviorExtensions>](../../../../docs/framework/configure-apps/file-schema/wcf/behaviorextensions.md) section using a fully-qualified type name and lock the element.</span></span>

         [!code-csharp[LockdownValidation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#5)]

    2. <span data-ttu-id="4eff8-132">Ajoutez l’élément de comportement à `EndpointBehaviors` la propriété de la [ \<section > commonBehaviors](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) et verrouillez l’élément.</span><span class="sxs-lookup"><span data-stu-id="4eff8-132">Add the behavior element to the `EndpointBehaviors` property of the [\<commonBehaviors>](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) section and lock the element.</span></span> <span data-ttu-id="4eff8-133">(Pour installer le validateur sur le service, le validateur doit être un <xref:System.ServiceModel.Description.IServiceBehavior> et être ajouté à la propriété `ServiceBehaviors`.) L'exemple de code suivant illustre la configuration appropriée après les étapes a.</span><span class="sxs-lookup"><span data-stu-id="4eff8-133">(To install the validator on the service, the validator must be an <xref:System.ServiceModel.Description.IServiceBehavior> and added to the `ServiceBehaviors` property.) The following code example shows the proper configuration after steps a.</span></span> <span data-ttu-id="4eff8-134">et b., à la seule exception qu'il n'y a pas de nom fort.</span><span class="sxs-lookup"><span data-stu-id="4eff8-134">and b., with the sole exception that there is no strong name.</span></span>

        [!code-csharp[LockdownValidation#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#6)]

    3. <span data-ttu-id="4eff8-135">Enregistrez le fichier machine.config.</span><span class="sxs-lookup"><span data-stu-id="4eff8-135">Save the machine.config file.</span></span> <span data-ttu-id="4eff8-136">L'exemple de code suivant exécute l'ensemble des tâches dans l'étape 3, mais enregistre une copie du fichier machine.config modifié localement.</span><span class="sxs-lookup"><span data-stu-id="4eff8-136">The following code example performs all the tasks in step 3 but saves a copy of the modified machine.config file locally.</span></span>

        [!code-csharp[LockdownValidation#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#7)]

## <a name="example"></a><span data-ttu-id="4eff8-137">Exemple</span><span class="sxs-lookup"><span data-stu-id="4eff8-137">Example</span></span>

<span data-ttu-id="4eff8-138">L'exemple de code suivant indique comment ajouter un comportement commun au fichier machine.config et enregistrer une copie sur le disque.</span><span class="sxs-lookup"><span data-stu-id="4eff8-138">The following code example shows how to add a common behavior to the machine.config file and save a copy to the disk.</span></span> <span data-ttu-id="4eff8-139">Est extrait de l’exemple [Security validation.](../../../../docs/framework/wcf/samples/security-validation.md) `InternetClientValidatorBehavior`</span><span class="sxs-lookup"><span data-stu-id="4eff8-139">The `InternetClientValidatorBehavior` is taken from the [Security Validation](../../../../docs/framework/wcf/samples/security-validation.md) sample.</span></span>

[!code-csharp[LockdownValidation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#1)]

## <a name="net-framework-security"></a><span data-ttu-id="4eff8-140">Sécurité .NET Framework</span><span class="sxs-lookup"><span data-stu-id="4eff8-140">.NET Framework Security</span></span>

<span data-ttu-id="4eff8-141">Vous pouvez également chiffrer les éléments du fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="4eff8-141">You may also want to encrypt the configuration file elements.</span></span> <span data-ttu-id="4eff8-142">Pour plus d'informations, consultez la section Voir aussi.</span><span class="sxs-lookup"><span data-stu-id="4eff8-142">For more information, see the See Also section.</span></span>

## <a name="see-also"></a><span data-ttu-id="4eff8-143">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="4eff8-143">See also</span></span>

- [<span data-ttu-id="4eff8-144">Chiffrement des éléments du fichier de configuration à l’aide de DPAPI</span><span class="sxs-lookup"><span data-stu-id="4eff8-144">Encrypting configuration file elements using DPAPI</span></span>](https://go.microsoft.com/fwlink/?LinkId=94954)
- [<span data-ttu-id="4eff8-145">Chiffrement des éléments du fichier de configuration à l’aide de RSA</span><span class="sxs-lookup"><span data-stu-id="4eff8-145">Encrypting configuration file elements using RSA</span></span>](https://go.microsoft.com/fwlink/?LinkId=94955)

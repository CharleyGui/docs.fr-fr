---
title: 'Procédure : utiliser des certificats X.509 distincts pour les signatures et le chiffrement'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, extensibility
- ClientCredentials class
- ClientCredentialsSecurityTokenManager class
ms.assetid: 0b06ce4e-7835-4d82-8baf-d525c71a0e49
ms.openlocfilehash: e464aff46f311ede1cd629fb459ade9a6e627d59
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/07/2019
ms.locfileid: "70796959"
---
# <a name="how-to-use-separate-x509-certificates-for-signing-and-encryption"></a><span data-ttu-id="274bd-102">Procédure : utiliser des certificats X.509 distincts pour les signatures et le chiffrement</span><span class="sxs-lookup"><span data-stu-id="274bd-102">How to: Use Separate X.509 Certificates for Signing and Encryption</span></span>

<span data-ttu-id="274bd-103">Cette rubrique montre comment configurer Windows Communication Foundation (WCF) pour utiliser des certificats différents pour la signature et le chiffrement des messages sur le client et le service.</span><span class="sxs-lookup"><span data-stu-id="274bd-103">This topic shows how to configure Windows Communication Foundation (WCF) to use different certificates for message signing and encryption on both the client and service.</span></span>

<span data-ttu-id="274bd-104">Pour permettre l’utilisation de certificats distincts pour la signature et le chiffrement, les informations d’identification d’un client ou d’un service personnalisé (ou les deux) doivent être créées, car WCF ne fournit pas d’API pour définir plusieurs certificats de client ou de service.</span><span class="sxs-lookup"><span data-stu-id="274bd-104">To enable separate certificates to be used for signing and encryption, a custom client or service credentials (or both) must be created because WCF does not provide an API to set multiple client or service certificates.</span></span> <span data-ttu-id="274bd-105">En outre, un gestionnaire de jetons de sécurité doit être configuré pour permettre l'exploitation des informations de l'ensemble des certificats et la création d'un fournisseur de jetons de sécurité qui convienne à l'utilisation des clés et à la direction des messages spécifiées.</span><span class="sxs-lookup"><span data-stu-id="274bd-105">Additionally, a security token manager must be provided to leverage the multiple certificates' information and to create an appropriate security token provider for specified key usage and message direction.</span></span>

<span data-ttu-id="274bd-106">Le diagramme suivant montre les classes principales utilisées, les classes (indiquées par une flèche pointant vers le haut) desquelles ils héritent et les types de retour de certaines méthodes et propriétés.</span><span class="sxs-lookup"><span data-stu-id="274bd-106">The following diagram shows the main classes used, the classes they inherit from (shown by an upward-pointing arrow), and the return types of certain methods and properties.</span></span>

- <span data-ttu-id="274bd-107">`MyClientCredentials` est une implémentation personnalisée de <xref:System.ServiceModel.Description.ClientCredentials>.</span><span class="sxs-lookup"><span data-stu-id="274bd-107">`MyClientCredentials` is a custom implementation of <xref:System.ServiceModel.Description.ClientCredentials>.</span></span>

  - <span data-ttu-id="274bd-108">Toutes ses propriétés indiquées dans le diagramme retournent des instances de <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.</span><span class="sxs-lookup"><span data-stu-id="274bd-108">Its properties shown in the diagram all return instances of <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.</span></span>

  - <span data-ttu-id="274bd-109">Sa méthode <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> retourne une instance de `MyClientCredentialsSecurityTokenManager`.</span><span class="sxs-lookup"><span data-stu-id="274bd-109">Its method <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> returns an instance of `MyClientCredentialsSecurityTokenManager`.</span></span>

- <span data-ttu-id="274bd-110">`MyClientCredentialsSecurityTokenManager` est une implémentation personnalisée de <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="274bd-110">`MyClientCredentialsSecurityTokenManager` is a custom implementation of <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span></span>

  - <span data-ttu-id="274bd-111">Sa méthode <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> retourne une instance de <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider>.</span><span class="sxs-lookup"><span data-stu-id="274bd-111">Its method <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> returns an instance of <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider>.</span></span>

<span data-ttu-id="274bd-112">![Graphique illustrant l’utilisation des informations d’identification du client](./media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif "e4971edd-a59f-4571-B36F-7e6b2f0d610f")</span><span class="sxs-lookup"><span data-stu-id="274bd-112">![Chart showing how client credentials are used](./media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif "e4971edd-a59f-4571-b36f-7e6b2f0d610f")</span></span>

<span data-ttu-id="274bd-113">Pour plus d’informations sur les informations d’identification [personnalisées, consultez Procédure pas à pas : Création d’informations d’identification](walkthrough-creating-custom-client-and-service-credentials.md)de client et de service personnalisées.</span><span class="sxs-lookup"><span data-stu-id="274bd-113">For more information about custom credentials, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>

<span data-ttu-id="274bd-114">De plus, vous devez créer un vérificateur d’identité personnalisé et le lier à un élément de liaison de sécurité dans une liaison personnalisée.</span><span class="sxs-lookup"><span data-stu-id="274bd-114">In addition, you must create a custom identity verifier, and link it to a security binding element in a custom binding.</span></span> <span data-ttu-id="274bd-115">Vous devez également utiliser les informations d'identification personnalisées au lieu des informations d'identification par défaut.</span><span class="sxs-lookup"><span data-stu-id="274bd-115">You must also use the custom credentials instead of the default credentials.</span></span>

<span data-ttu-id="274bd-116">Le diagramme suivant indique les classes impliquées dans la liaison personnalisée, et comment le vérificateur d'identité personnalisé est lié.</span><span class="sxs-lookup"><span data-stu-id="274bd-116">The following diagram shows the classes involved in the custom binding, and how the custom identity verifier is linked.</span></span> <span data-ttu-id="274bd-117">Plusieurs éléments de liaison sont impliqués, qui héritent tous de <xref:System.ServiceModel.Channels.BindingElement>.</span><span class="sxs-lookup"><span data-stu-id="274bd-117">There are several binding elements involved, all of which inherit from <xref:System.ServiceModel.Channels.BindingElement>.</span></span> <span data-ttu-id="274bd-118"><xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> a la propriété <xref:System.ServiceModel.Channels.LocalClientSecuritySettings>, qui retourne une instance de <xref:System.ServiceModel.Security.IdentityVerifier>, à partir de laquelle `MyIdentityVerifier` est personnalisé.</span><span class="sxs-lookup"><span data-stu-id="274bd-118">The <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> has the <xref:System.ServiceModel.Channels.LocalClientSecuritySettings> property, which returns an instance of <xref:System.ServiceModel.Security.IdentityVerifier>, from which `MyIdentityVerifier` is customized.</span></span>

<span data-ttu-id="274bd-119">![Graphique présentant un élément de liaison personnalisé](./media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif "dddea4a2-0bb4-4921-9bf4-20d4d82c3da5")</span><span class="sxs-lookup"><span data-stu-id="274bd-119">![Chart showing a custom binding element](./media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif "dddea4a2-0bb4-4921-9bf4-20d4d82c3da5")</span></span>

<span data-ttu-id="274bd-120">Pour plus d’informations sur la création d’un vérificateur d’identité personnalisé, consultez Procédure : [Guide pratique : Créer un vérificateur](how-to-create-a-custom-client-identity-verifier.md)d’identité client personnalisé.</span><span class="sxs-lookup"><span data-stu-id="274bd-120">For more information about creating a custom identity verifier, see How to: [How to: Create a Custom Client Identity Verifier](how-to-create-a-custom-client-identity-verifier.md).</span></span>

### <a name="to-use-separate-certificates-for-signing-and-encryption"></a><span data-ttu-id="274bd-121">Pour utiliser différents certificats dans les signatures et le chiffrement</span><span class="sxs-lookup"><span data-stu-id="274bd-121">To use separate certificates for signing and encryption</span></span>

1. <span data-ttu-id="274bd-122">Définissez une nouvelle classe d'informations d'identification client qui hérite de la classe <xref:System.ServiceModel.Description.ClientCredentials>.</span><span class="sxs-lookup"><span data-stu-id="274bd-122">Define a new client credentials class that inherits from the <xref:System.ServiceModel.Description.ClientCredentials> class.</span></span> <span data-ttu-id="274bd-123">Implémentez quatre nouvelles propriétés pour autoriser la spécification de plusieurs certificats : `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate` et `ServiceEncryptingCertificate`.</span><span class="sxs-lookup"><span data-stu-id="274bd-123">Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`.</span></span> <span data-ttu-id="274bd-124">Substituez également la méthode <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> pour retourner une instance de la classe <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> personnalisée définie à l'étape suivante.</span><span class="sxs-lookup"><span data-stu-id="274bd-124">Also override the <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class that is defined in the next step.</span></span>

     [!code-csharp[c_FourCerts#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#1)]
     [!code-vb[c_FourCerts#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#1)]

2. <span data-ttu-id="274bd-125">Définissez un nouveau gestionnaire de jetons de sécurité client qui hérite de la classe <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="274bd-125">Define a new client security token manager that inherits from the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="274bd-126">Remplacez la méthode <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> pour créer un fournisseur de jetons de sécurité approprié.</span><span class="sxs-lookup"><span data-stu-id="274bd-126">Override the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider.</span></span> <span data-ttu-id="274bd-127">Le paramètre `requirement`, qui correspond à un type <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>, indique la direction des messages et spécifie les paramètres d'utilisation des clés.</span><span class="sxs-lookup"><span data-stu-id="274bd-127">The `requirement` parameter (a <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>) provides the message direction and key usage.</span></span>

     [!code-csharp[c_FourCerts#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#2)]
     [!code-vb[c_FourCerts#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#2)]

3. <span data-ttu-id="274bd-128">Définissez une nouvelle classe d'informations d'identification de service qui hérite de la classe <xref:System.ServiceModel.Description.ServiceCredentials>.</span><span class="sxs-lookup"><span data-stu-id="274bd-128">Define a new service credentials class that inherits from the <xref:System.ServiceModel.Description.ServiceCredentials> class.</span></span> <span data-ttu-id="274bd-129">Implémentez quatre nouvelles propriétés pour autoriser la spécification de plusieurs certificats : `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate` et `ServiceEncryptingCertificate`.</span><span class="sxs-lookup"><span data-stu-id="274bd-129">Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`.</span></span> <span data-ttu-id="274bd-130">Substituez également la méthode <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A> pour retourner une instance de la classe <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> personnalisée définie à l'étape suivante.</span><span class="sxs-lookup"><span data-stu-id="274bd-130">Also override the <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class that is defined in the next step.</span></span>

     [!code-csharp[c_FourCerts#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#3)]
     [!code-vb[c_FourCerts#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#3)]

4. <span data-ttu-id="274bd-131">Définissez un nouveau gestionnaire de jetons de sécurité service qui hérite de la classe <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="274bd-131">Define a new service security token manager that inherits from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="274bd-132">Remplacez la méthode <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> pour créer un fournisseur de jetons de sécurité qui convienne à la direction passée des messages et aux paramètres d'utilisation des clés.</span><span class="sxs-lookup"><span data-stu-id="274bd-132">Override the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider given the passed-in message direction and key usage.</span></span>

     [!code-csharp[c_FourCerts#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#4)]
     [!code-vb[c_FourCerts#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#4)]

### <a name="to-use-multiple-certificates-on-the-client"></a><span data-ttu-id="274bd-133">Pour utiliser plusieurs certificats sur le client</span><span class="sxs-lookup"><span data-stu-id="274bd-133">To use multiple certificates on the client</span></span>

1. <span data-ttu-id="274bd-134">Créez une liaison personnalisée.</span><span class="sxs-lookup"><span data-stu-id="274bd-134">Create a custom binding.</span></span> <span data-ttu-id="274bd-135">L’élément de liaison de sécurité doit fonctionner en mode duplex pour permettre aux différents fournisseurs de jetons de sécurité d’être présents pendant les requêtes et les réponses.</span><span class="sxs-lookup"><span data-stu-id="274bd-135">The security binding element must operate in duplex mode to allow different security token providers to be present for requests and responses.</span></span> <span data-ttu-id="274bd-136">Pour ce faire, utilisez des méthodes de transfert compatibles avec le mode duplex ou utilisez l'élément <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement>, tel qu'illustré dans le code suivant.</span><span class="sxs-lookup"><span data-stu-id="274bd-136">One way to do this is to use a duplex-capable transport or to use the <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code.</span></span> <span data-ttu-id="274bd-137">Liez le <xref:System.ServiceModel.Security.IdentityVerifier> personnalisé défini à l’étape suivante à l’élément de liaison de sécurité.</span><span class="sxs-lookup"><span data-stu-id="274bd-137">Link the customized <xref:System.ServiceModel.Security.IdentityVerifier> which is defined in the next step to the security binding element.</span></span> <span data-ttu-id="274bd-138">Remplacez les informations d'identification du client par défaut par les informations d'identification du client personnalisées créées précédemment.</span><span class="sxs-lookup"><span data-stu-id="274bd-138">Replace the default client credentials with the customized client credentials previously created.</span></span>

     [!code-csharp[c_FourCerts#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#5)]
     [!code-vb[c_FourCerts#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#5)]

2. <span data-ttu-id="274bd-139">Définissez un <xref:System.ServiceModel.Security.IdentityVerifier> personnalisé.</span><span class="sxs-lookup"><span data-stu-id="274bd-139">Define a custom <xref:System.ServiceModel.Security.IdentityVerifier>.</span></span> <span data-ttu-id="274bd-140">Le service dispose de plusieurs identités, différents certificats étant utilisés pour chiffrer la demande et signer la réponse.</span><span class="sxs-lookup"><span data-stu-id="274bd-140">The service has multiple identities because different certificates are used to encrypt the request and to sign the response.</span></span>

    > [!NOTE]
    > <span data-ttu-id="274bd-141">Dans l'exemple suivant, le vérificateur d'identité personnalisé spécifié n'effectue pas de contrôle d'identité de point de terminaison à des fins d'authentification.</span><span class="sxs-lookup"><span data-stu-id="274bd-141">In the following sample, the provided custom identity verifier does not perform any endpoint identity checking for demonstration purposes.</span></span> <span data-ttu-id="274bd-142">Cette pratique est déconseillée lors de la rédaction d'un code de production.</span><span class="sxs-lookup"><span data-stu-id="274bd-142">This is not recommended practice for production code.</span></span>

     [!code-csharp[c_FourCerts#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#6)]
     [!code-vb[c_FourCerts#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#6)]

### <a name="to-use-multiple-certificates-on-the-service"></a><span data-ttu-id="274bd-143">Pour utiliser plusieurs certificats sur le service</span><span class="sxs-lookup"><span data-stu-id="274bd-143">To use multiple certificates on the service</span></span>

1. <span data-ttu-id="274bd-144">Créez une liaison personnalisée.</span><span class="sxs-lookup"><span data-stu-id="274bd-144">Create a custom binding.</span></span> <span data-ttu-id="274bd-145">L’élément de liaison de sécurité doit fonctionner en mode duplex pour permettre aux différents fournisseurs de jetons de sécurité d’être présents pendant les requêtes et les réponses.</span><span class="sxs-lookup"><span data-stu-id="274bd-145">The security binding element must operate in a duplex mode to allow different security token providers to be present for requests and responses.</span></span> <span data-ttu-id="274bd-146">Comme pour le client, utilisez des méthodes de transfert compatibles avec le mode duplex ou utilisez l'élément <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement>, tel qu'illustré dans le code suivant.</span><span class="sxs-lookup"><span data-stu-id="274bd-146">As with the client, use a duplex-capable transport or use <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code.</span></span> <span data-ttu-id="274bd-147">Remplacez les informations d'identification du service par défaut par les informations d'identification du service personnalisées créées précédemment.</span><span class="sxs-lookup"><span data-stu-id="274bd-147">Replace the default service credentials with the customized service credentials previously created.</span></span>

     [!code-csharp[c_FourCerts#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#7)]
     [!code-vb[c_FourCerts#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#7)]

## <a name="see-also"></a><span data-ttu-id="274bd-148">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="274bd-148">See also</span></span>

- <xref:System.ServiceModel.Description.ClientCredentials>
- <xref:System.ServiceModel.Description.ServiceCredentials>
- <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>
- <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>
- <xref:System.ServiceModel.Security.IdentityVerifier>
- [<span data-ttu-id="274bd-149">Procédure pas à pas : Création d’informations d’identification de client et de service personnalisées</span><span class="sxs-lookup"><span data-stu-id="274bd-149">Walkthrough: Creating Custom Client and Service Credentials</span></span>](walkthrough-creating-custom-client-and-service-credentials.md)

---
title: Substituts de contrats de données
ms.date: 03/30/2017
helpviewer_keywords:
- data contracts [WCF], surrogates
ms.assetid: 8c31134c-46c5-4ed7-94af-bab0ac0dfce5
ms.openlocfilehash: 7b1e8585755bbbff900bd621d8bc3a25fd23961c
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/28/2019
ms.locfileid: "64587503"
---
# <a name="data-contract-surrogates"></a><span data-ttu-id="2e3e6-102">Substituts de contrats de données</span><span class="sxs-lookup"><span data-stu-id="2e3e6-102">Data Contract Surrogates</span></span>
<span data-ttu-id="2e3e6-103">Le contrat de données *substitut* est une fonctionnalité avancée reposant sur le modèle de contrat de données.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-103">The data contract *surrogate* is an advanced feature built upon the Data Contract model.</span></span> <span data-ttu-id="2e3e6-104">Cette fonctionnalité est destinée à la personnalisation et à la substitution de type dans les situations où les utilisateurs souhaitent changer la manière dont un type est sérialisé, désérialisé ou projeté dans des métadonnées.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-104">This feature is designed to be used for type customization and substitution in situations where users want to change how a type is serialized, deserialized or projected into metadata.</span></span> <span data-ttu-id="2e3e6-105">On peut par exemple utiliser un substitut lorsque aucun contrat de données n'a été spécifié pour le type, que les champs et propriétés ne sont pas marqués avec l'attribut <xref:System.Runtime.Serialization.DataMemberAttribute> ou que les utilisateurs souhaitent créer des variations de schéma de manière dynamique.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-105">Some scenarios where a surrogate may be used is when a data contract has not been specified for the type, fields and properties are not marked with the <xref:System.Runtime.Serialization.DataMemberAttribute> attribute or users wish to dynamically create schema variations.</span></span>  
  
 <span data-ttu-id="2e3e6-106">La sérialisation et la désérialisation sont accomplies avec le substitut de contrat de données lors de l’utilisation de <xref:System.Runtime.Serialization.DataContractSerializer> pour effectuer la conversion à partir du .NET Framework vers un format approprié, tel que XML.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-106">Serialization and deserialization are accomplished with the data contract surrogate when using <xref:System.Runtime.Serialization.DataContractSerializer> to convert from .NET Framework to a suitable format, such as XML.</span></span> <span data-ttu-id="2e3e6-107">Le substitut de contrat de données peut également être utilisé pour modifier les métadonnées exportées pour les types, lors de la production de représentations de métadonnées telles que des documents XSD (XML Schema Documents).</span><span class="sxs-lookup"><span data-stu-id="2e3e6-107">Data contract surrogate can also be used to modify the metadata exported for types, when producing metadata representations such as XML Schema Documents (XSD).</span></span> <span data-ttu-id="2e3e6-108">Lors de l'importation, le code est créé à partir des métadonnées et le substitut peut être utilisé dans ce cas pour personnaliser également le code généré.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-108">Upon import, code is created from metadata and the surrogate can be used in this case to customize the generated code as well.</span></span>  
  
## <a name="how-the-surrogate-works"></a><span data-ttu-id="2e3e6-109">Fonctionnement du substitut</span><span class="sxs-lookup"><span data-stu-id="2e3e6-109">How the Surrogate Works</span></span>  
 <span data-ttu-id="2e3e6-110">Un substitut mappe un type (le type « d'origine ») à un autre type (le type « substitué »).</span><span class="sxs-lookup"><span data-stu-id="2e3e6-110">A surrogate works by mapping one type (the "original" type) to another type (the "surrogated" type).</span></span> <span data-ttu-id="2e3e6-111">L'exemple suivant illustre le type `Inventory` d'origine et un nouveau type `InventorySurrogated` de substitution.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-111">The following example shows the original type `Inventory` and a new surrogate `InventorySurrogated` type.</span></span> <span data-ttu-id="2e3e6-112">Le type `Inventory` n'est pas sérialisable, mais le type `InventorySurrogated` l'est :</span><span class="sxs-lookup"><span data-stu-id="2e3e6-112">The `Inventory` type is not serializable but the `InventorySurrogated` type is:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#1)]  
  
 <span data-ttu-id="2e3e6-113">Aucun contrat de données n'ayant été défini pour cette classe, vous devez convertir la classe en une classe de substitution avec un contrat de données.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-113">Because a data contract has not been defined for this class, convert the class to a surrogate class with a data contract.</span></span> <span data-ttu-id="2e3e6-114">La classe de substitution est illustrée dans l'exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="2e3e6-114">The surrogated class is shown in the following example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#2)]  
  
## <a name="implementing-the-idatacontractsurrogate"></a><span data-ttu-id="2e3e6-115">Implémentation de l'IDataContractSurrogate</span><span class="sxs-lookup"><span data-stu-id="2e3e6-115">Implementing the IDataContractSurrogate</span></span>  
 <span data-ttu-id="2e3e6-116">Pour utiliser le substitut de contrat de données, implémentez l'interface <xref:System.Runtime.Serialization.IDataContractSurrogate>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-116">To use the data contract surrogate, implement the <xref:System.Runtime.Serialization.IDataContractSurrogate> interface.</span></span>  
  
 <span data-ttu-id="2e3e6-117">Vous trouverez ci-dessous une vue d'ensemble de chaque méthode de <xref:System.Runtime.Serialization.IDataContractSurrogate> avec une implémentation possible.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-117">The following is an overview of each method of <xref:System.Runtime.Serialization.IDataContractSurrogate> with a possible implementation.</span></span>  
  
### <a name="getdatacontracttype"></a><span data-ttu-id="2e3e6-118">GetDataContractType</span><span class="sxs-lookup"><span data-stu-id="2e3e6-118">GetDataContractType</span></span>  
 <span data-ttu-id="2e3e6-119">La méthode <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> établit une correspondance entre les types.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-119">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method maps one type to another.</span></span> <span data-ttu-id="2e3e6-120">Cette méthode est requise pour la sérialisation, la désérialisation, l'importation et l'exportation.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-120">This method is required for serialization, deserialization, import, and export.</span></span>  
  
 <span data-ttu-id="2e3e6-121">La première tâche consiste à définir les types qui seront mappés à d'autres types.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-121">The first task is defining what types will be mapped to other types.</span></span> <span data-ttu-id="2e3e6-122">Exemple :</span><span class="sxs-lookup"><span data-stu-id="2e3e6-122">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#3)]  
  
- <span data-ttu-id="2e3e6-123">Lors de la sérialisation, le mappage retourné par cette méthode est utilisé par la suite pour transformer l'instance d'origine en une instance de substitution en appelant la méthode <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-123">On serialization, the mapping returned by this method is subsequently used to transform the original instance to a surrogated instance by calling the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method.</span></span>  
  
- <span data-ttu-id="2e3e6-124">Lors de la désérialisation, le mappage retourné par cette méthode est utilisé par le sérialiseur afin de désérialiser en une instance du type de substitution.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-124">On deserialization, the mapping returned by this method is used by the serializer to deserialize into an instance of the surrogate type.</span></span> <span data-ttu-id="2e3e6-125">La méthode appelle par la suite <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> pour transformer l'instance substituée en une instance du type d'origine.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-125">It subsequently calls <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> to transform the surrogated instance into an instance of the original type.</span></span>  
  
- <span data-ttu-id="2e3e6-126">Lors de l'exportation, le type de substitution retourné par cette méthode est reflété afin d'obtenir le contrat de données à utiliser pour générer les métadonnées.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-126">On export, the surrogate type returned by this method is reflected to get the data contract to use for generating metadata.</span></span>  
  
- <span data-ttu-id="2e3e6-127">Lors de l'importation, le type initial est modifié en un type de substitution qui est reflété afin d'obtenir le contrat de données à utiliser à des fins telles que le référencement de prise en charge.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-127">On import, the initial type is changed to a surrogate type that is reflected to get the data contract to use for purposes like referencing support.</span></span>  
  
 <span data-ttu-id="2e3e6-128">Le paramètre <xref:System.Type> est le type de l'objet sérialisé, désérialisé, importé ou exporté.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-128">The <xref:System.Type> parameter is the type of the object that is being serialized, deserialized, imported, or exported.</span></span> <span data-ttu-id="2e3e6-129">La méthode <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> doit retourner le type d'entrée si le substitut ne gère pas le type.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-129">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method must return the input type if the surrogate does not handle the type.</span></span> <span data-ttu-id="2e3e6-130">Autrement, retournez le type substitué approprié.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-130">Otherwise, return the appropriate surrogated type.</span></span> <span data-ttu-id="2e3e6-131">S'il existe plusieurs types de substitution, de nombreux mappages peuvent être définis dans cette méthode.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-131">If several surrogate types exist, numerous mappings can be defined in this method.</span></span>  
  
 <span data-ttu-id="2e3e6-132">La méthode <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> n'est pas appelée pour les primitives de contrat de données intégrées, telles que <xref:System.Int32> ou <xref:System.String>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-132">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method is not called for built-in data contract primitives, such as <xref:System.Int32> or <xref:System.String>.</span></span> <span data-ttu-id="2e3e6-133">Pour d'autres types, tels que les tableaux, les types définis par l'utilisateur et autres structures de données, cette méthode sera appelée pour chaque type.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-133">For other types, such as arrays, user-defined types, and other data structures, this method will be called for each type.</span></span>  
  
 <span data-ttu-id="2e3e6-134">Dans l'exemple précédent, la méthode vérifie si les paramètres `type` et `Inventory` sont comparables.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-134">In the previous example, the method checks if the `type` parameter and `Inventory` are comparable.</span></span> <span data-ttu-id="2e3e6-135">Si c'est le cas, la méthode le mappe à `InventorySurrogated`.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-135">If so, the method maps it to `InventorySurrogated`.</span></span> <span data-ttu-id="2e3e6-136">Chaque fois qu’une sérialisation, une désérialisation, un schéma d’importation ou un schéma d’exportation est appelé(e), cette fonction est appelée en premier afin de déterminer le mappage entre les types.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-136">Whenever a serialization, deserialization, import schema, or export schema is called, this function is called first to determine the mapping between types.</span></span>  
  
### <a name="getobjecttoserialize-method"></a><span data-ttu-id="2e3e6-137">Méthode GetObjectToSerialize</span><span class="sxs-lookup"><span data-stu-id="2e3e6-137">GetObjectToSerialize Method</span></span>  
 <span data-ttu-id="2e3e6-138">La méthode <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> convertit l'instance de type d'origine en instance de type substitué.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-138">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method converts the original type instance to the surrogated type instance.</span></span> <span data-ttu-id="2e3e6-139">La méthode est requise pour la sérialisation.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-139">The method is required for serialization.</span></span>  
  
 <span data-ttu-id="2e3e6-140">L'étape suivante consiste à définir la façon dont les données physiques seront mappées de l'instance d'origine au substitut en implémentant la méthode <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-140">The next step is to define the way the physical data will be mapped from the original instance to the surrogate by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method.</span></span> <span data-ttu-id="2e3e6-141">Exemple :</span><span class="sxs-lookup"><span data-stu-id="2e3e6-141">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#4)]  
  
 <span data-ttu-id="2e3e6-142">La méthode <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> est appelée lorsqu'un objet est sérialisé.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-142">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method is called when an object is serialized.</span></span> <span data-ttu-id="2e3e6-143">Cette méthode transfère des données du type d'origine aux champs du type substitué.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-143">This method transfers data from the original type to the fields of the surrogated type.</span></span> <span data-ttu-id="2e3e6-144">Les champs peuvent être mappés directement à des champs de substitution, ou des manipulations des données d'origine peuvent être stockées dans le substitut.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-144">Fields can be directly mapped to surrogate fields, or manipulations of the original data may be stored in the surrogate.</span></span> <span data-ttu-id="2e3e6-145">Certaines utilisations possibles incluent : mappage direct des champs, exécution d'opérations sur les données à stocker dans les champs substitués, ou stockage du XML du type d'origine dans le champ substitué.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-145">Some possible uses include: directly mapping the fields, performing operations on the data to be stored in the surrogated fields, or storing the XML of the original type in the surrogated field.</span></span>  
  
 <span data-ttu-id="2e3e6-146">Le paramètre `targetType` fait référence au type déclaré du membre.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-146">The `targetType` parameter refers to the declared type of the member.</span></span> <span data-ttu-id="2e3e6-147">Ce paramètre est le type substitué retourné par la méthode <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-147">This parameter is the surrogated type returned by the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method.</span></span> <span data-ttu-id="2e3e6-148">Le sérialiseur n'applique pas l'impératif selon lequel l'objet retourné doit être assignable à ce type.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-148">The serializer does not enforce that the object returned is assignable to this type.</span></span> <span data-ttu-id="2e3e6-149">Le `obj` paramètre est l’objet à sérialiser et sera convertie en son substitut si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-149">The `obj` parameter is the object to serialize, and will be converted to its surrogate if necessary.</span></span> <span data-ttu-id="2e3e6-150">Cette méthode doit retourner l'objet d'entrée si le substitué ne gère pas l'objet.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-150">This method must return the input object if the surrogated does not handle the object.</span></span> <span data-ttu-id="2e3e6-151">Autrement, le nouvel objet de substitution sera retourné.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-151">Otherwise, the new surrogate object will be returned.</span></span> <span data-ttu-id="2e3e6-152">Le substitut n'est pas appelé si l'objet est null.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-152">The surrogate is not called if the object is null.</span></span> <span data-ttu-id="2e3e6-153">Plusieurs mappages de substitution pour différentes instances peuvent être définis dans cette méthode.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-153">Numerous surrogate mappings for different instances may be defined within this method.</span></span>  
  
 <span data-ttu-id="2e3e6-154">Lorsque vous créez un <xref:System.Runtime.Serialization.DataContractSerializer>, vous pouvez faire en sorte qu'il conserve les références d'objets.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-154">When creating a <xref:System.Runtime.Serialization.DataContractSerializer>, you can instruct it to preserve object references.</span></span> <span data-ttu-id="2e3e6-155">(Pour plus d’informations, consultez [sérialisation et désérialisation](../../../../docs/framework/wcf/feature-details/serialization-and-deserialization.md).) Vous devez pour cela affecter au paramètre `preserveObjectReferences` dans son constructeur la valeur `true`.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-155">(For more information, see [Serialization and Deserialization](../../../../docs/framework/wcf/feature-details/serialization-and-deserialization.md).) This is done by setting the `preserveObjectReferences` parameter in its constructor to `true`.</span></span> <span data-ttu-id="2e3e6-156">Dans ce cas, le substitut est appelé une seule fois pour un objet puisque toutes les sérialisations suivantes écrivent simplement la référence dans le flux.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-156">In that case, the surrogate is called only once for an object since all subsequent serializations just write the reference into the stream.</span></span> <span data-ttu-id="2e3e6-157">Si `preserveObjectReferences` a la valeur `false`, le substitut est appelé chaque fois qu'une instance est rencontrée.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-157">If `preserveObjectReferences` is set to `false`, then the surrogate is called every time an instance is encountered.</span></span>  
  
 <span data-ttu-id="2e3e6-158">Si le type de l'instance sérialisé diffère du type déclaré, les informations de type sont écrites dans le flux, par exemple `xsi:type` pour autoriser l'instance à être désérialisée à l'autre extrémité.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-158">If the type of the instance serialized differs from the declared type, type information is written into the stream, for example, `xsi:type` to allow the instance to be deserialized at the other end.</span></span> <span data-ttu-id="2e3e6-159">Ce processus se produit que l'objet soit substitué ou non.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-159">This process occurs whether the object is surrogated or not.</span></span>  
  
 <span data-ttu-id="2e3e6-160">L'exemple ci-dessus convertit les données de l'instance `Inventory` en données `InventorySurrogated`.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-160">The example above converts the data of the `Inventory` instance to that of `InventorySurrogated`.</span></span> <span data-ttu-id="2e3e6-161">Il vérifie le type de l'objet et effectue les manipulations nécessaires pour effectuer la conversion au type substitué.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-161">It checks the type of the object and performs the necessary manipulations to convert to the surrogated type.</span></span> <span data-ttu-id="2e3e6-162">Dans ce cas, les champs de la classe `Inventory` sont copiés directement vers les champs de la classe `InventorySurrogated`.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-162">In this case, the fields of the `Inventory` class are directly copied over to the `InventorySurrogated` class fields.</span></span>  
  
### <a name="getdeserializedobject-method"></a><span data-ttu-id="2e3e6-163">Méthode GetDeserializedObject</span><span class="sxs-lookup"><span data-stu-id="2e3e6-163">GetDeserializedObject Method</span></span>  
 <span data-ttu-id="2e3e6-164">La méthode <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> convertit l'instance de type substitué en instance de type d'origine.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-164">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> method converts the surrogated type instance to the original type instance.</span></span> <span data-ttu-id="2e3e6-165">Elle est requise pour la désérialisation.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-165">It is required for deserialization.</span></span>  
  
 <span data-ttu-id="2e3e6-166">La tâche suivante consiste à définir la façon dont les données physiques seront mappées de l’instance de substitution à l’original.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-166">The next task is to define the way the physical data will be mapped from the surrogate instance to the original.</span></span> <span data-ttu-id="2e3e6-167">Exemple :</span><span class="sxs-lookup"><span data-stu-id="2e3e6-167">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#5)]  
  
 <span data-ttu-id="2e3e6-168">Cette méthode est appelée uniquement pendant la désérialisation d'un objet.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-168">This method is called only during the deserialization of an object.</span></span> <span data-ttu-id="2e3e6-169">Elle fournit un mappage de données inverse pour la désérialisation du type de substitution à son type d'origine.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-169">It provides reverse data mapping for the deserialization from the surrogate type back to its original type.</span></span> <span data-ttu-id="2e3e6-170">Elle est semblable à la méthode `GetObjectToSerialize`, et on peut l'utiliser afin d'échanger directement des données de champs, effectuer des opérations sur les données et stocker des données XML.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-170">Similar to the `GetObjectToSerialize` method, some possible uses may be to directly exchange field data, perform operations on the data, and store XML data.</span></span> <span data-ttu-id="2e3e6-171">Lors de la désérialisation, vous risquez de ne pas toujours obtenir les valeurs de données exactes de l'original en raison des manipulations liées à la conversion des données.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-171">When  deserializing, you may not always obtain the exact data values from original due to manipulations in the data conversion.</span></span>  
  
 <span data-ttu-id="2e3e6-172">Le paramètre `targetType` fait référence au type déclaré du membre.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-172">The `targetType` parameter refers to the declared type of the member.</span></span> <span data-ttu-id="2e3e6-173">Ce paramètre est le type substitué retourné par la méthode `GetDataContractType`.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-173">This parameter is the surrogated type returned by the `GetDataContractType` method.</span></span> <span data-ttu-id="2e3e6-174">Le `obj` paramètre fait référence à l’objet qui a été désérialisé.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-174">The `obj` parameter refers to the object that has been deserialized.</span></span> <span data-ttu-id="2e3e6-175">L'objet peut être reconverti en son type d'origine s'il est substitué.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-175">The object can be converted back to its original type if it is surrogated.</span></span> <span data-ttu-id="2e3e6-176">Cette méthode retourne l'objet d'entrée si le substitue ne gère pas l'objet.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-176">This method returns the input object if the surrogate does not handle the object.</span></span> <span data-ttu-id="2e3e6-177">Autrement, l'objet désérialisé sera retourné une fois sa conversion achevée.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-177">Otherwise, the deserialized object will be returned once its conversion has been completed.</span></span> <span data-ttu-id="2e3e6-178">S'il existe plusieurs types de substitution, vous pouvez fournir la conversion de données du type de substitution au type principal pour chacun d'entre eux en indiquant chaque type et sa conversion.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-178">If several surrogate types exist, you may provide data conversion from surrogate to primary type for each by indicating each type and its conversion.</span></span>  
  
 <span data-ttu-id="2e3e6-179">Lors du retour d'un objet, les tables d'objets internes sont mises à jour avec l'objet retourné par ce substitut.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-179">When returning an object, the internal object tables are updated with the object returned by this surrogate.</span></span> <span data-ttu-id="2e3e6-180">Toute référence ultérieure à une instance obtiendra l'instance substituée à partir des tables d'objets.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-180">Any subsequent references to an instance will obtain the surrogated instance from the object tables.</span></span>  
  
 <span data-ttu-id="2e3e6-181">L'exemple précédent reconvertit des objets de type `InventorySurrogated` en type `Inventory` initial.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-181">The previous example converts objects of type `InventorySurrogated` back to the initial type `Inventory`.</span></span> <span data-ttu-id="2e3e6-182">Dans ce cas, les données sont retransférées directement à partir de `InventorySurrogated` vers ses champs correspondants dans `Inventory`.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-182">In this case, data is directly transferred back from `InventorySurrogated` to its corresponding fields in `Inventory`.</span></span> <span data-ttu-id="2e3e6-183">Étant donné qu'il n'y a pas de manipulations de données, chacun des champs membres contiendra les mêmes valeurs qu'avant la sérialisation.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-183">Because there are no data manipulations, the each of the member fields will contain the same values as before the serialization.</span></span>  
  
### <a name="getcustomdatatoexport-method"></a><span data-ttu-id="2e3e6-184">Méthode GetCustomDataToExport</span><span class="sxs-lookup"><span data-stu-id="2e3e6-184">GetCustomDataToExport Method</span></span>  
 <span data-ttu-id="2e3e6-185">Lors de l'exportation d'un schéma, la méthode <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> est facultative.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-185">When exporting a schema, the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> method is optional.</span></span> <span data-ttu-id="2e3e6-186">Elle est utilisée pour insérer des conseils ou des données supplémentaires dans le schéma exporté.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-186">It is used to insert additional data or hints into the exported schema.</span></span> <span data-ttu-id="2e3e6-187">Les données supplémentaires peuvent être insérées au niveau du membre ou au niveau du type.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-187">Additional data can be inserted at the member level or type level.</span></span> <span data-ttu-id="2e3e6-188">Exemple :</span><span class="sxs-lookup"><span data-stu-id="2e3e6-188">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#6)]  
  
 <span data-ttu-id="2e3e6-189">Cette méthode (avec deux surcharges) autorise l'inclusion d'informations supplémentaires dans les métadonnées au niveau du membre ou au niveau du type.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-189">This method (with two overloads) enables the inclusion of extra information into the metadata either at the member or type level.</span></span> <span data-ttu-id="2e3e6-190">Il est possible d'inclure des conseils relatifs au caractère public ou privé d'un membre et des commentaires qui seraient conservés durant toute l'exportation et l'importation du schéma.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-190">It is possible to include hints about whether a member is public or private, and comments which would be preserved throughout the export and import of the schema.</span></span> <span data-ttu-id="2e3e6-191">De telles informations seraient perdues sans cette méthode.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-191">Such information would be lost without this method.</span></span> <span data-ttu-id="2e3e6-192">Cette méthode ne provoque pas l'insertion ou la suppression de membres ou de types, mais elle ajoute plutôt des données supplémentaires aux schémas à l'un ou l'autre de ces niveaux.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-192">This method does not cause the insertion or deletion of members or types, but rather adds additional data to the schemas at either of these levels.</span></span>  
  
 <span data-ttu-id="2e3e6-193">La méthode est surchargée et peut prendre un `Type` (paramètre `clrtype`) ou un <xref:System.Reflection.MemberInfo> (paramètre `memberInfo`).</span><span class="sxs-lookup"><span data-stu-id="2e3e6-193">The method is overloaded and can take either a `Type` (`clrtype` parameter) or <xref:System.Reflection.MemberInfo> (`memberInfo` parameter).</span></span> <span data-ttu-id="2e3e6-194">Le deuxième paramètre est toujours un `Type` (paramètre `dataContractType`).</span><span class="sxs-lookup"><span data-stu-id="2e3e6-194">The second parameter is always a `Type` (`dataContractType` parameter).</span></span> <span data-ttu-id="2e3e6-195">Cette méthode est appelée pour chaque membre et type du type `dataContractType` substitué.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-195">This method is called for every member and type of the surrogated `dataContractType` type.</span></span>  
  
 <span data-ttu-id="2e3e6-196">L'une ou l'autre de ces surcharges doit retourner `null` ou un objet sérialisable.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-196">Either of these overloads must return either `null` or a serializable object.</span></span> <span data-ttu-id="2e3e6-197">Un objet non null sera sérialisé comme annotation dans le schéma exporté.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-197">A non-null object will be serialized as annotation into the exported schema.</span></span> <span data-ttu-id="2e3e6-198">Pour la surcharge `Type`, chaque type exporté vers le schéma est envoyé à cette méthode dans le premier paramètre avec le type substitué comme paramètre `dataContractType`.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-198">For the `Type` overload, each type that is exported to schema is sent to this method in the first parameter along with the surrogated type as the `dataContractType` parameter.</span></span> <span data-ttu-id="2e3e6-199">Pour la surcharge `MemberInfo`, chaque membre exporté vers le schéma envoie ses informations comme paramètre `memberInfo` avec le type substitué dans le deuxième paramètre.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-199">For the `MemberInfo` overload, each member that is exported to schema sends its information as the `memberInfo` parameter with the surrogated type in the second parameter.</span></span>  
  
#### <a name="getcustomdatatoexport-method-type-type"></a><span data-ttu-id="2e3e6-200">Méthode GetCustomDataToExport (Type, Type)</span><span class="sxs-lookup"><span data-stu-id="2e3e6-200">GetCustomDataToExport Method (Type, Type)</span></span>  
 <span data-ttu-id="2e3e6-201">La méthode <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> est appelée pendant l'exportation de schéma pour chaque définition de type.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-201">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> method is called during schema export for every type definition.</span></span> <span data-ttu-id="2e3e6-202">La méthode ajoute des informations aux types dans le schéma lors de l'exportation.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-202">The method adds information to the types within the schema when exporting.</span></span> <span data-ttu-id="2e3e6-203">Chaque type défini est envoyé à cette méthode pour déterminer si des données supplémentaires doivent être incluses dans le schéma.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-203">Each type defined is sent to this method to determine whether there is any additional data that needs to be included in the schema.</span></span>  
  
#### <a name="getcustomdatatoexport-method-memberinfo-type"></a><span data-ttu-id="2e3e6-204">Méthode GetCustomDataToExport (MemberInfo, Type)</span><span class="sxs-lookup"><span data-stu-id="2e3e6-204">GetCustomDataToExport Method (MemberInfo, Type)</span></span>  
 <span data-ttu-id="2e3e6-205">Le <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType> est appelé pendant l'exportation pour chaque membre dans les types exportés.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-205">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType> is called during export for every member in the types that are exported.</span></span> <span data-ttu-id="2e3e6-206">Cette fonction vous permet de personnaliser tout commentaire pour les membres qui seront inclus dans le schéma lors de l'exportation.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-206">This function enables you to customize any comments for the members that will be included in the schema upon export.</span></span> <span data-ttu-id="2e3e6-207">Les informations pour chaque membre dans la classe sont envoyées à cette méthode afin de vérifier si des données supplémentaires doivent être ajoutées dans le schéma.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-207">The information for every member within the class is sent to this method to check whether any additional data need to be added in the schema.</span></span>  
  
 <span data-ttu-id="2e3e6-208">L'exemple suivant recherche dans le `dataContractType` pour chaque membre du substitut.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-208">The example above searches through the `dataContractType` for each member of the surrogate.</span></span> <span data-ttu-id="2e3e6-209">Il retourne ensuite le modificateur d’accès approprié pour chaque champ.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-209">It then returns the appropriate access modifier for each field.</span></span> <span data-ttu-id="2e3e6-210">Sans cette personnalisation, la valeur par défaut pour les modificateurs d’accès est publique.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-210">Without this customization, the default value for access modifiers is public.</span></span> <span data-ttu-id="2e3e6-211">Par conséquent, tous les membres seraient définis comme publics dans le code généré à l'aide du schéma exporté, quelles que soient leurs restrictions d'accès réelles.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-211">Therefore, all members would be defined as public in the code generated using the exported schema no matter what their actual access restrictions are.</span></span> <span data-ttu-id="2e3e6-212">Si cette implémentation n'était pas utilisée, le membre `numpens` serait public dans le schéma exporté bien qu'il ait été défini comme privé dans le substitut.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-212">When not using this implementation, the member `numpens` would be public in the exported schema even though it was defined in the surrogate as private.</span></span> <span data-ttu-id="2e3e6-213">Grâce à l'utilisation de cette méthode, dans le schéma exporté, le modificateur d'accès peut être généré comme privé.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-213">Through the use of this method, in the exported schema, the access modifier can be generated as private.</span></span>  
  
### <a name="getreferencedtypeonimport-method"></a><span data-ttu-id="2e3e6-214">Méthode GetReferencedTypeOnImport</span><span class="sxs-lookup"><span data-stu-id="2e3e6-214">GetReferencedTypeOnImport Method</span></span>  
 <span data-ttu-id="2e3e6-215">Cette méthode mappe le <xref:System.Type> du substitut au type d'origine.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-215">This method maps the <xref:System.Type> of the surrogate to the original type.</span></span> <span data-ttu-id="2e3e6-216">Cette méthode est facultative pour l'importation de schéma.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-216">This method is optional for schema importation.</span></span>  
  
 <span data-ttu-id="2e3e6-217">Lors de la création d’un substitut qui importe un schéma et génère le code pour celui-ci, la tâche suivante consiste à définir le type d’une instance de substitution à son type d’origine.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-217">When creating a surrogate that imports a schema and generates code for it, the next task is to define the type of a surrogate instance to its original type.</span></span>  
  
 <span data-ttu-id="2e3e6-218">Si le code généré doit faire référence à un type utilisateur existant, cette opération est effectuée en implémentant la méthode <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-218">If the generated code needs to reference an existing user type, this is done by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> method.</span></span>  
  
 <span data-ttu-id="2e3e6-219">Lors de l'importation d'un schéma, cette méthode est appelée pour chaque déclaration de type afin de mapper le contrat de données substitué à un type.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-219">When importing a schema, this method is called for every type declaration to map the surrogated data contract to a type.</span></span> <span data-ttu-id="2e3e6-220">Les paramètres chaîne `typeName` et `typeNamespace` définissent le nom et l'espace de noms du type substitué.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-220">The string parameters `typeName` and `typeNamespace` define the name and namespace of the surrogated type.</span></span> <span data-ttu-id="2e3e6-221">La valeur de retour pour <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> est utilisée pour déterminer si un nouveau type doit être généré.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-221">The return value for <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> is used to determine whether a new type needs to be generated.</span></span> <span data-ttu-id="2e3e6-222">Cette méthode doit retourner un type valide ou null.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-222">This method must return either a valid type or null.</span></span> <span data-ttu-id="2e3e6-223">Pour les types valides, le type retourné sera utilisé en tant que type référencé dans le code généré.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-223">For valid types, the type returned will be used as a referenced type in the generated code.</span></span> <span data-ttu-id="2e3e6-224">Si null est retourné, aucun type ne sera référencé et un nouveau type doit être créé.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-224">If null is returned, no type will be referenced and a new type must be created.</span></span> <span data-ttu-id="2e3e6-225">S'il existe plusieurs substituts, il est possible d'effectuer le mappage pour chaque type de substitution vers son type initial.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-225">If several surrogates exist, it is possible to perform the mapping for each surrogate type back to its initial type.</span></span>  
  
 <span data-ttu-id="2e3e6-226">Le paramètre `customData` est l'objet initialement retourné à partir de <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-226">The `customData` parameter is the object originally returned from <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A>.</span></span> <span data-ttu-id="2e3e6-227">Ce `customData` est utilisé lorsque des auteurs de substitution souhaitent insérer des données/conseils supplémentaires dans les métadonnées pour une utilisation pendant l'importation afin de générer le code.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-227">This `customData` is used when surrogate authors want to insert extra data/hints into the metadata to use during import to generate code.</span></span>  
  
### <a name="processimportedtype-method"></a><span data-ttu-id="2e3e6-228">Méthode ProcessImportedType</span><span class="sxs-lookup"><span data-stu-id="2e3e6-228">ProcessImportedType Method</span></span>  
 <span data-ttu-id="2e3e6-229">La méthode <xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> personnalise tout type créé à partir de l'importation de schéma.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-229">The <xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> method customizes any type created from schema importation.</span></span> <span data-ttu-id="2e3e6-230">Cette méthode est facultative.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-230">This method is optional.</span></span>  
  
 <span data-ttu-id="2e3e6-231">Lors de l'importation d'un schéma, cette méthode permet de personnaliser tout type importé et toute information de compilation.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-231">When importing a schema, this method allows for any imported type and compilation information to be customized.</span></span> <span data-ttu-id="2e3e6-232">Exemple :</span><span class="sxs-lookup"><span data-stu-id="2e3e6-232">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#7)]  
  
 <span data-ttu-id="2e3e6-233">Durant l'importation, cette méthode est appelée pour chaque type généré.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-233">During import, this method is called for every type generated.</span></span> <span data-ttu-id="2e3e6-234">Modifiez le <xref:System.CodeDom.CodeTypeDeclaration> spécifié ou modifiez le <xref:System.CodeDom.CodeCompileUnit>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-234">Change the specified <xref:System.CodeDom.CodeTypeDeclaration> or modify the <xref:System.CodeDom.CodeCompileUnit>.</span></span> <span data-ttu-id="2e3e6-235">Cela inclut la modification du nom, des membres, des attributs et de nombreuses autres propriétés du `CodeTypeDeclaration`.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-235">This includes changing the name, members, attributes, and many other properties of the `CodeTypeDeclaration`.</span></span> <span data-ttu-id="2e3e6-236">En traitant le `CodeCompileUnit`, il est possible de modifier les directives, espaces de noms, assemblys référencés et plusieurs autres aspects.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-236">By processing the `CodeCompileUnit`, it is possible to modify the directives, namespaces, referenced assemblies, and several other aspects.</span></span>  
  
 <span data-ttu-id="2e3e6-237">Le paramètre `CodeTypeDeclaration` contient la déclaration de type DOM de code.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-237">The `CodeTypeDeclaration` parameter contains the code DOM type declaration.</span></span> <span data-ttu-id="2e3e6-238">Le paramètre `CodeCompileUnit` autorise la modification pour le traitement du code.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-238">The `CodeCompileUnit` parameter allows for modification for processing the code.</span></span>  <span data-ttu-id="2e3e6-239">Le retour de `null` entraîne le rejet de la déclaration de type.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-239">Returning `null` results in the type declaration being discarded.</span></span> <span data-ttu-id="2e3e6-240">Inversement, lors du retour d'un `CodeTypeDeclaration`, les modifications sont conservées.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-240">Conversely, when returning a `CodeTypeDeclaration`, the modifications are preserved.</span></span>  
  
 <span data-ttu-id="2e3e6-241">Si des données personnalisées sont insérées pendant l'exportation des métadonnées, elles doivent être fournies à l'utilisateur pendant l'importation afin de pouvoir être utilisées.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-241">If custom data is inserted during metadata export, it needs to be provided to the user during import so that it can be used.</span></span> <span data-ttu-id="2e3e6-242">Ces données personnalisées peuvent être utilisées pour des conseils de modèle de programmation ou autres commentaires.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-242">This custom data can be used for programming model hints, or other comments.</span></span> <span data-ttu-id="2e3e6-243">Chaque instance `CodeTypeDeclaration` et <xref:System.CodeDom.CodeTypeMember> inclut des données personnalisées en tant que propriété <xref:System.CodeDom.CodeObject.UserData%2A>, faisant l'objet d'un cast en type `IDataContractSurrogate`.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-243">Each `CodeTypeDeclaration` and <xref:System.CodeDom.CodeTypeMember> instance includes custom data as the <xref:System.CodeDom.CodeObject.UserData%2A> property, cast to the `IDataContractSurrogate` type.</span></span>  
  
 <span data-ttu-id="2e3e6-244">L'exemple ci-dessus apporte des modifications au schéma importé.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-244">The example above performs some changes on the schema imported.</span></span> <span data-ttu-id="2e3e6-245">Le code conserve des membres privés du type d'origine en utilisant un substitut.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-245">The code preserves private members of the original type by using a surrogate.</span></span> <span data-ttu-id="2e3e6-246">Le modificateur d’accès par défaut lors de l’importation d’un schéma est `public`.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-246">The default access modifier when importing a schema is `public`.</span></span> <span data-ttu-id="2e3e6-247">Par conséquent, tous les membres du schéma de substitution seront publics à moins d'être modifiés, comme dans cet exemple.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-247">Therefore, all members of the surrogate schema will be public unless modified, as in this example.</span></span> <span data-ttu-id="2e3e6-248">Pendant l'exportation, des données personnalisées sont insérées dans les métadonnées à propos des membres privés.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-248">During export, custom data is inserted into the metadata about which members are private.</span></span> <span data-ttu-id="2e3e6-249">L’exemple consulte les données personnalisées, vérifie si le modificateur d’accès est privé, puis rend le membre approprié privé en définissant ses attributs.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-249">The example looks up the custom data, checks whether the access modifier is private, and then modifies the appropriate member to be private by setting its attributes.</span></span> <span data-ttu-id="2e3e6-250">Sans cette personnalisation, le membre `numpens` serait défini comme public au lieu de privé.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-250">Without this customization, the `numpens` member would be defined as public instead of private.</span></span>  
  
### <a name="getknowncustomdatatypes-method"></a><span data-ttu-id="2e3e6-251">Méthode GetKnownCustomDataTypes</span><span class="sxs-lookup"><span data-stu-id="2e3e6-251">GetKnownCustomDataTypes Method</span></span>  
 <span data-ttu-id="2e3e6-252">Cette méthode obtient des types de données personnalisés définis à partir du schéma.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-252">This method obtains custom data types defined from the schema.</span></span> <span data-ttu-id="2e3e6-253">Elle est facultative pour l'importation de schéma.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-253">The method is optional for schema importation.</span></span>  
  
 <span data-ttu-id="2e3e6-254">La méthode est appelée au début de l'exportation et de l'importation de schéma.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-254">The method is called at the beginning of schema export and import.</span></span> <span data-ttu-id="2e3e6-255">Elle retourne les types de données personnalisés utilisés dans le schéma exporté ou importé.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-255">The method returns the custom data types used in the schema exported or imported.</span></span> <span data-ttu-id="2e3e6-256">Un <xref:System.Collections.ObjectModel.Collection%601> (le paramètre `customDataTypes`), qui est une collection de types, est passé à la méthode.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-256">The method is passed a <xref:System.Collections.ObjectModel.Collection%601> (the `customDataTypes` parameter), which is a collection of types.</span></span> <span data-ttu-id="2e3e6-257">La méthode doit ajouter des types connus supplémentaires à cette collection.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-257">The method should add additional known types to this collection.</span></span> <span data-ttu-id="2e3e6-258">Les types de données personnalisés connus sont nécessaires pour activer la sérialisation et la désérialisation des données personnalisées à l’aide du <xref:System.Runtime.Serialization.DataContractSerializer>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-258">The known custom data types are needed to enable serialization and deserialization of custom data using the <xref:System.Runtime.Serialization.DataContractSerializer>.</span></span> <span data-ttu-id="2e3e6-259">Pour plus d’informations, consultez [Data Contract Known Types](../../../../docs/framework/wcf/feature-details/data-contract-known-types.md).</span><span class="sxs-lookup"><span data-stu-id="2e3e6-259">For more information, see [Data Contract Known Types](../../../../docs/framework/wcf/feature-details/data-contract-known-types.md).</span></span>  
  
## <a name="implementing-a-surrogate"></a><span data-ttu-id="2e3e6-260">Implémentation d'un substitut</span><span class="sxs-lookup"><span data-stu-id="2e3e6-260">Implementing a Surrogate</span></span>  
 <span data-ttu-id="2e3e6-261">Pour utiliser le substitut de contrat de données dans WCF, vous devez suivre certaines procédures spéciales.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-261">To use the data contract surrogate within WCF, you must follow a few special procedures.</span></span>  
  
### <a name="to-use-a-surrogate-for-serialization-and-deserialization"></a><span data-ttu-id="2e3e6-262">Pour utiliser un substitut pour la sérialisation et la désérialisation</span><span class="sxs-lookup"><span data-stu-id="2e3e6-262">To Use a Surrogate for Serialization and Deserialization</span></span>  
 <span data-ttu-id="2e3e6-263">Utilisez le <xref:System.Runtime.Serialization.DataContractSerializer> pour effectuer la sérialisation et la désérialisation des données avec le substitut.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-263">Use the <xref:System.Runtime.Serialization.DataContractSerializer> to perform serialization and deserialization of data with the surrogate.</span></span> <span data-ttu-id="2e3e6-264">Le <xref:System.Runtime.Serialization.DataContractSerializer> est créé par le <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-264">The <xref:System.Runtime.Serialization.DataContractSerializer> is created by the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>.</span></span> <span data-ttu-id="2e3e6-265">Le substitut doit également être spécifié.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-265">The surrogate must also be specified.</span></span>  
  
##### <a name="to-implement-serialization-and-deserialization"></a><span data-ttu-id="2e3e6-266">Pour implémenter la sérialisation et la désérialisation</span><span class="sxs-lookup"><span data-stu-id="2e3e6-266">To implement serialization and deserialization</span></span>  
  
1. <span data-ttu-id="2e3e6-267">Créez une instance du <xref:System.ServiceModel.ServiceHost> pour votre service.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-267">Create an instance of the <xref:System.ServiceModel.ServiceHost> for your service.</span></span> <span data-ttu-id="2e3e6-268">Pour obtenir des instructions complètes, consultez [programmation WCF de base](../../../../docs/framework/wcf/basic-wcf-programming.md).</span><span class="sxs-lookup"><span data-stu-id="2e3e6-268">For complete instructions, see [Basic WCF Programming](../../../../docs/framework/wcf/basic-wcf-programming.md).</span></span>  
  
2. <span data-ttu-id="2e3e6-269">Pour chaque <xref:System.ServiceModel.Description.ServiceEndpoint> de l'hôte de service spécifié, recherchez son <xref:System.ServiceModel.Description.OperationDescription>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-269">For every <xref:System.ServiceModel.Description.ServiceEndpoint> of the specified service host, find its <xref:System.ServiceModel.Description.OperationDescription>.</span></span>  
  
3. <span data-ttu-id="2e3e6-270">Parcourez les comportements d'opération pour déterminer si une instance du <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> est détectée.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-270">Search through the operation behaviors to determine if an instance of the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found.</span></span>  
  
4. <span data-ttu-id="2e3e6-271">Si un <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> est détecté, affectez à sa propriété <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> une nouvelle instance du substitut.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-271">If a <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, set its <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> property to a new instance of the surrogate.</span></span> <span data-ttu-id="2e3e6-272">Si aucun <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> n'est détecté, créez une instance et affectez au membre <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> du nouveau comportement une nouvelle instance du substitut.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-272">If no <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, then create a new instance and set the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> member of the new behavior to a new instance of the surrogate.</span></span>  
  
5. <span data-ttu-id="2e3e6-273">Pour finir, ajoutez ce nouveau comportement aux comportements d'opérations actuels, comme illustré dans l'exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="2e3e6-273">Finally, add this new behavior to the current operation behaviors, as shown in the following example:</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#8)]  
  
### <a name="to-use-a-surrogate-for-metadata-import"></a><span data-ttu-id="2e3e6-274">Pour utiliser un substitut pour l'importation de métadonnées</span><span class="sxs-lookup"><span data-stu-id="2e3e6-274">To Use a Surrogate for Metadata Import</span></span>  
 <span data-ttu-id="2e3e6-275">Lors de l'importation de métadonnées telles que WSDL et XSD pour générer le code côté client, le substitut doit être ajouté au composant responsable de la génération du code à partir du schéma XSD, <xref:System.Runtime.Serialization.XsdDataContractImporter>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-275">When importing metadata like WSDL and XSD to generate client-side code, the surrogate needs to be added to the component responsible for generating code from XSD schema, <xref:System.Runtime.Serialization.XsdDataContractImporter>.</span></span> <span data-ttu-id="2e3e6-276">Pour cela, modifiez directement le <xref:System.ServiceModel.Description.WsdlImporter> utilisé pour importer les métadonnées.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-276">To do this, directly modify the <xref:System.ServiceModel.Description.WsdlImporter> used to import metadata.</span></span>  
  
##### <a name="to-implement-a-surrogate-for-metadata-importation"></a><span data-ttu-id="2e3e6-277">Pour implémenter un substitut pour l'importation de métadonnées</span><span class="sxs-lookup"><span data-stu-id="2e3e6-277">To implement a surrogate for metadata importation</span></span>  
  
1. <span data-ttu-id="2e3e6-278">Importez les métadonnées à l'aide de la classe <xref:System.ServiceModel.Description.WsdlImporter>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-278">Import the metadata using the <xref:System.ServiceModel.Description.WsdlImporter> class.</span></span>  
  
2. <span data-ttu-id="2e3e6-279">Utilisez la méthode <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> pour vérifier si un <xref:System.Runtime.Serialization.XsdDataContractImporter> a été défini.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-279">Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method to check whether an <xref:System.Runtime.Serialization.XsdDataContractImporter> has been defined.</span></span>  
  
3. <span data-ttu-id="2e3e6-280">Si la méthode <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> retourne la valeur `false`, créez un <xref:System.Runtime.Serialization.XsdDataContractImporter> et affectez à sa propriété <xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> une nouvelle instance de la classe <xref:System.Runtime.Serialization.ImportOptions>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-280">If the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractImporter> and set its <xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class.</span></span> <span data-ttu-id="2e3e6-281">Autrement, utilisez l'importateur retourné par le paramètre `out` de la méthode <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-281">Otherwise, use the importer returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.</span></span>  
  
4. <span data-ttu-id="2e3e6-282">Si le <xref:System.Runtime.Serialization.XsdDataContractImporter> n'a aucun <xref:System.Runtime.Serialization.ImportOptions> défini, affectez à la propriété une nouvelle instance de la classe <xref:System.Runtime.Serialization.ImportOptions>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-282">If the <xref:System.Runtime.Serialization.XsdDataContractImporter> has no <xref:System.Runtime.Serialization.ImportOptions> defined, then set the property to be a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class.</span></span>  
  
5. <span data-ttu-id="2e3e6-283">Affectez à la propriété <xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> du <xref:System.Runtime.Serialization.ImportOptions> du <xref:System.Runtime.Serialization.XsdDataContractImporter> une nouvelle instance du substitut.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-283">Set the <xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ImportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractImporter> to a new instance of the surrogate.</span></span>  
  
6. <span data-ttu-id="2e3e6-284">Ajoutez le <xref:System.Runtime.Serialization.XsdDataContractImporter> à la collection retournée par la propriété <xref:System.ServiceModel.Description.MetadataExporter.State%2A> du <xref:System.ServiceModel.Description.WsdlImporter> (héritée de la classe <xref:System.ServiceModel.Description.MetadataExporter>.)</span><span class="sxs-lookup"><span data-stu-id="2e3e6-284">Add the <xref:System.Runtime.Serialization.XsdDataContractImporter> to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlImporter> (inherited from the <xref:System.ServiceModel.Description.MetadataExporter> class.)</span></span>  
  
7. <span data-ttu-id="2e3e6-285">Utilisez la méthode <xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> du <xref:System.ServiceModel.Description.WsdlImporter> pour importer tous les contrats de données dans le schéma.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-285">Use the <xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> method of the <xref:System.ServiceModel.Description.WsdlImporter> to import all of the data contracts within the schema.</span></span> <span data-ttu-id="2e3e6-286">Durant la dernière étape, le code est généré à partir des schémas chargés en appelant le substitut.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-286">During the last step, code is generated from the schemas loaded by calling into the surrogate.</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#9)]  
  
### <a name="to-use-a-surrogate-for-metadata-export"></a><span data-ttu-id="2e3e6-287">Pour utiliser un substitut pour l'exportation de métadonnées</span><span class="sxs-lookup"><span data-stu-id="2e3e6-287">To Use a surrogate for Metadata Export</span></span>  
 <span data-ttu-id="2e3e6-288">Par défaut, lors de l’exportation des métadonnées à partir de WCF pour un service, les schémas WSDL et XSD doit être généré.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-288">By default, when exporting metadata from WCF for a service, both WSDL and XSD schema needs to be generated.</span></span> <span data-ttu-id="2e3e6-289">Le substitut doit être ajouté au composant responsable de la génération du schéma XSD pour les types de contrat de données, <xref:System.Runtime.Serialization.XsdDataContractExporter>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-289">The surrogate needs to be added to the component responsible for generating XSD schema for data contract types, <xref:System.Runtime.Serialization.XsdDataContractExporter>.</span></span> <span data-ttu-id="2e3e6-290">Pour cela, utilisez un comportement qui implémente <xref:System.ServiceModel.Description.IWsdlExportExtension> pour modifier le <xref:System.ServiceModel.Description.WsdlExporter> ou modifiez directement le <xref:System.ServiceModel.Description.WsdlExporter> utilisé pour exporter les métadonnées.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-290">To do this, either use a behavior that implements <xref:System.ServiceModel.Description.IWsdlExportExtension> to modify the <xref:System.ServiceModel.Description.WsdlExporter>, or directly modify the <xref:System.ServiceModel.Description.WsdlExporter> used to export metadata.</span></span>  
  
##### <a name="to-use-a-surrogate-for-metadata-export"></a><span data-ttu-id="2e3e6-291">Pour utiliser un substitut pour l'exportation de métadonnées</span><span class="sxs-lookup"><span data-stu-id="2e3e6-291">To use a surrogate for metadata export</span></span>  
  
1. <span data-ttu-id="2e3e6-292">Créez un <xref:System.ServiceModel.Description.WsdlExporter> ou utilisez le paramètre `wsdlExporter` passé à la méthode <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-292">Create a new <xref:System.ServiceModel.Description.WsdlExporter> or use the `wsdlExporter` parameter passed to the <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A> method.</span></span>  
  
2. <span data-ttu-id="2e3e6-293">Utilisez la fonction <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> pour vérifier si un <xref:System.Runtime.Serialization.XsdDataContractExporter> a été défini.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-293">Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> function to check whether an <xref:System.Runtime.Serialization.XsdDataContractExporter> has been defined.</span></span>  
  
3. <span data-ttu-id="2e3e6-294">Si <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> retourne la valeur `false`, créez un <xref:System.Runtime.Serialization.XsdDataContractExporter> avec les schémas XML générés à partir du <xref:System.ServiceModel.Description.WsdlExporter> et ajoutez-le à la collection retournée par la propriété <xref:System.ServiceModel.Description.MetadataExporter.State%2A> du <xref:System.ServiceModel.Description.WsdlExporter>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-294">If <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractExporter> with the generated XML schemas from the <xref:System.ServiceModel.Description.WsdlExporter>, and add it to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlExporter>.</span></span> <span data-ttu-id="2e3e6-295">Autrement, utilisez l'exportateur retourné par le paramètre `out` de la méthode <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-295">Otherwise, use the exporter returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.</span></span>  
  
4. <span data-ttu-id="2e3e6-296">Si le <xref:System.Runtime.Serialization.XsdDataContractExporter> n'a aucun <xref:System.Runtime.Serialization.ExportOptions> défini, affectez à la propriété <xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> une nouvelle instance de la classe <xref:System.Runtime.Serialization.ExportOptions>.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-296">If the <xref:System.Runtime.Serialization.XsdDataContractExporter> has no <xref:System.Runtime.Serialization.ExportOptions> defined, then set the <xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ExportOptions> class.</span></span>  
  
5. <span data-ttu-id="2e3e6-297">Affectez à la propriété <xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> du <xref:System.Runtime.Serialization.ExportOptions> du <xref:System.Runtime.Serialization.XsdDataContractExporter> une nouvelle instance du substitut.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-297">Set the <xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ExportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractExporter> to a new instance of the surrogate.</span></span> <span data-ttu-id="2e3e6-298">Les étapes suivantes d'exportation des métadonnées ne requièrent pas de modifications.</span><span class="sxs-lookup"><span data-stu-id="2e3e6-298">Subsequent steps for exporting metadata do not require any changes.</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#10)]  
  
## <a name="see-also"></a><span data-ttu-id="2e3e6-299">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="2e3e6-299">See also</span></span>

- <xref:System.Runtime.Serialization.DataContractSerializer>
- <xref:System.Runtime.Serialization.IDataContractSurrogate>
- <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>
- <xref:System.Runtime.Serialization.ImportOptions>
- <xref:System.Runtime.Serialization.ExportOptions>
- [<span data-ttu-id="2e3e6-300">Utilisation de contrats de données</span><span class="sxs-lookup"><span data-stu-id="2e3e6-300">Using Data Contracts</span></span>](../../../../docs/framework/wcf/feature-details/using-data-contracts.md)

---
title: 'Procédure : importer des assertions de stratégie personnalisées'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 1f41d787-accb-4a10-bfc6-a807671d1581
ms.openlocfilehash: 4510eac2d9c1b3bb64420b0678b3a47a90887188
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/07/2019
ms.locfileid: "70795623"
---
# <a name="how-to-import-custom-policy-assertions"></a><span data-ttu-id="378e3-102">Procédure : importer des assertions de stratégie personnalisées</span><span class="sxs-lookup"><span data-stu-id="378e3-102">How to: Import Custom Policy Assertions</span></span>
<span data-ttu-id="378e3-103">Les assertions de stratégie décrivent les fonctions et les exigences d’un point de terminaison de service.</span><span class="sxs-lookup"><span data-stu-id="378e3-103">Policy assertions describe the capabilities and requirements of a service endpoint.</span></span>  <span data-ttu-id="378e3-104">Les applications clientes peuvent utiliser des assertions de stratégie dans les métadonnées de service pour configurer la liaison cliente ou personnaliser le contrat de service d’un point de terminaison de service.</span><span class="sxs-lookup"><span data-stu-id="378e3-104">Client applications can use policy assertions in service metadata to configure the client binding or to customize the service contract for a service endpoint.</span></span>  
  
 <span data-ttu-id="378e3-105">Les assertions de stratégie personnalisées sont importées en implémentant l'interface <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> et en passant cet objet au système de métadonnées ou en enregistrant le type d'implémentation dans le fichier de configuration de votre application.</span><span class="sxs-lookup"><span data-stu-id="378e3-105">Custom policy assertions are imported by implementing the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface and passing that object to the metadata system or by registering the implementation type in your application configuration file.</span></span>  <span data-ttu-id="378e3-106">Les implémentations de <xref:System.ServiceModel.Description.IPolicyImportExtension> l’interface doivent fournir un constructeur sans paramètre.</span><span class="sxs-lookup"><span data-stu-id="378e3-106">Implementations of the <xref:System.ServiceModel.Description.IPolicyImportExtension> interface must provide a parameterless constructor.</span></span>  
  
### <a name="to-import-custom-policy-assertions"></a><span data-ttu-id="378e3-107">Pour importer des assertions de stratégie personnalisées</span><span class="sxs-lookup"><span data-stu-id="378e3-107">To import custom policy assertions</span></span>  
  
1. <span data-ttu-id="378e3-108">Implémentez l'interface <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> sur une classe.</span><span class="sxs-lookup"><span data-stu-id="378e3-108">Implement the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface on a class.</span></span> <span data-ttu-id="378e3-109">Reportez-vous aux procédures ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="378e3-109">See the following procedures.</span></span>  
  
2. <span data-ttu-id="378e3-110">Insérez l'importateur de stratégie personnalisé selon l'une des méthodes suivantes :</span><span class="sxs-lookup"><span data-stu-id="378e3-110">Insert the custom policy importer either by:</span></span>  
  
3. <span data-ttu-id="378e3-111">Utilisation d'un fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="378e3-111">Using a configuration file.</span></span> <span data-ttu-id="378e3-112">Reportez-vous aux procédures ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="378e3-112">See the following procedures.</span></span>  
  
4. <span data-ttu-id="378e3-113">Utilisation d’un fichier de configuration avec l' [outil utilitaire de métadonnées ServiceModel (Svcutil. exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="378e3-113">Using a configuration file with [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span> <span data-ttu-id="378e3-114">Reportez-vous aux procédures ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="378e3-114">See the following procedures.</span></span>  
  
5. <span data-ttu-id="378e3-115">Insertion par programme de l'importateur de stratégie.</span><span class="sxs-lookup"><span data-stu-id="378e3-115">Programmatically inserting the policy importer.</span></span> <span data-ttu-id="378e3-116">Reportez-vous aux procédures ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="378e3-116">See the following procedures.</span></span>  
  
### <a name="to-implement-the-systemservicemodeldescriptionipolicyimportextension-interface-on-any-class"></a><span data-ttu-id="378e3-117">Pour implémenter l'interface System.ServiceModel.Description.IPolicyImportExtension sur une classe</span><span class="sxs-lookup"><span data-stu-id="378e3-117">To implement the System.ServiceModel.Description.IPolicyImportExtension interface on any class</span></span>  
  
1. <span data-ttu-id="378e3-118">Dans la méthode <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType>, recherchez, pour chaque sujet de stratégie qui vous intéresse, les assertions de stratégie que vous souhaitez importer en appelant la méthode appropriée (selon sur la portée de l'assertion de votre choix) sur l'objet <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> passé à la méthode.</span><span class="sxs-lookup"><span data-stu-id="378e3-118">In the <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> method, for each policy subject that you are interested in, find the policy assertions that you want to import by calling the appropriate method (depending upon the scope of the assertion that you want) on the <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> object passed to the method.</span></span> <span data-ttu-id="378e3-119">L’exemple de code suivant indique comment utiliser la méthode <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> pour localiser l’assertion de stratégie personnalisée et la supprimer de la collection en une étape.</span><span class="sxs-lookup"><span data-stu-id="378e3-119">The following code example shows how to use the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step.</span></span> <span data-ttu-id="378e3-120">Si vous utilisez la méthode de suppression pour localiser et supprimer l'assertion, l'étape 4 n'est pas nécessaire.</span><span class="sxs-lookup"><span data-stu-id="378e3-120">If you use the remove method to locate and remove the assertion, you do not have to perform step 4.</span></span>  
  
     [!code-csharp[CustomPolicySample#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/policyimporter.cs#9)]
     [!code-vb[CustomPolicySample#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/policyimporter.vb#9)]  
  
2. <span data-ttu-id="378e3-121">Traitez les assertions de stratégie.</span><span class="sxs-lookup"><span data-stu-id="378e3-121">Process the policy assertions.</span></span> <span data-ttu-id="378e3-122">Notez que le système de stratégie ne normalise pas les stratégies imbriquées et `wsp:optional`.</span><span class="sxs-lookup"><span data-stu-id="378e3-122">Note that the policy system does not normalize nested policies and `wsp:optional`.</span></span> <span data-ttu-id="378e3-123">Vous devez traiter ces constructions dans votre implémentation d'extension d'importation de stratégie.</span><span class="sxs-lookup"><span data-stu-id="378e3-123">You must process these constructs in your policy import extension implementation.</span></span>  
  
3. <span data-ttu-id="378e3-124">Exécutez la personnalisation sur la liaison ou le contrat qui prend en charge la fonction ou la spécification spécifiée par l’assertion de stratégie.</span><span class="sxs-lookup"><span data-stu-id="378e3-124">Perform the customization to the binding or contract that supports the capability or requirement specified by the policy assertion.</span></span> <span data-ttu-id="378e3-125">En général, les assertions indiquent qu’une liaison requiert une configuration particulière ou un élément de liaison spécifique.</span><span class="sxs-lookup"><span data-stu-id="378e3-125">Typically assertions indicate that a binding requires a particular configuration or a specific binding element.</span></span> <span data-ttu-id="378e3-126">Apportez ces modifications en accédant à la propriété <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="378e3-126">Make these modifications by accessing the <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="378e3-127">D'autres assertions requièrent la modification du contrat.</span><span class="sxs-lookup"><span data-stu-id="378e3-127">Other assertions require that you modify the contract.</span></span>  <span data-ttu-id="378e3-128">Vous pouvez accéder et modifier le contrat à l'aide de la propriété <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="378e3-128">You can access and modify the contract using the <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> property.</span></span>  <span data-ttu-id="378e3-129">Notez que votre importateur de stratégie peut être appelé plusieurs fois pour la même liaison et le même contrat, mais pour des alternatives de stratégie différentes en cas d’échec de l’importation d’une alternative de stratégie.</span><span class="sxs-lookup"><span data-stu-id="378e3-129">Note that your policy importer may get called multiple times for the same binding and contract, but different policy alternatives if importing a policy alternative fails.</span></span> <span data-ttu-id="378e3-130">Votre code doit être résilient à ce comportement.</span><span class="sxs-lookup"><span data-stu-id="378e3-130">Your code should be resilient to this behavior.</span></span>  
  
4. <span data-ttu-id="378e3-131">Supprimez l'assertion de stratégie personnalisée de la collection d'assertions.</span><span class="sxs-lookup"><span data-stu-id="378e3-131">Remove the custom policy assertion from the assertion collection.</span></span> <span data-ttu-id="378e3-132">Si vous ne supprimez pas l’assertion Windows Communication Foundation (WCF) suppose que l’importation de stratégie a échoué et n’importe pas la liaison associée.</span><span class="sxs-lookup"><span data-stu-id="378e3-132">If you do not remove the assertion Windows Communication Foundation (WCF) assumes that the policy import was unsuccessful and does not import the associated binding.</span></span> <span data-ttu-id="378e3-133">Si vous avez utilisé la méthode <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> pour localiser l’assertion de stratégie personnalisée et la supprimer de la collection en une étape, cette étape n’est pas nécessaire.</span><span class="sxs-lookup"><span data-stu-id="378e3-133">If you used the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step you do not have to perform this step.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-a-configuration-file"></a><span data-ttu-id="378e3-134">Pour insérer l'importateur de stratégie personnalisé dans le système de métadonnées à l'aide d'un fichier de configuration</span><span class="sxs-lookup"><span data-stu-id="378e3-134">To insert the custom policy importer into the metadata System using a configuration file</span></span>  
  
1. <span data-ttu-id="378e3-135">Ajoutez le type d’importateur à `<extensions>` l’élément à l’intérieur de l' [ \<élément policyImporters >](../../configure-apps/file-schema/wcf/policyimporters.md) dans le fichier de configuration client.</span><span class="sxs-lookup"><span data-stu-id="378e3-135">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the client configuration file.</span></span>  
  
     [!code-xml[CustomPolicySample#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.exe.config#7)]   
  
2. <span data-ttu-id="378e3-136">Dans l'application cliente, utilisez <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> ou <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> pour résoudre les métadonnées, l'importateur étant appelé automatiquement.</span><span class="sxs-lookup"><span data-stu-id="378e3-136">In the client application, use the <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> to resolve the metadata and the importer is invoked automatically.</span></span>  
  
     [!code-csharp[CustomPolicySample#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.cs#10)]
     [!code-vb[CustomPolicySample#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/client.vb#10)]  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-svcutilexe"></a><span data-ttu-id="378e3-137">Pour insérer l'importateur de stratégie personnalisé dans le système de métadonnées à l'aide de Svcutil.exe</span><span class="sxs-lookup"><span data-stu-id="378e3-137">To insert the custom policy importer into the metadata system using Svcutil.exe</span></span>  
  
1. <span data-ttu-id="378e3-138">Ajoutez le type d’importateur à `<extensions>` l’élément à l’intérieur de l' [ \<élément policyImporters >](../../configure-apps/file-schema/wcf/policyimporters.md) dans le fichier de configuration Svcutil. exe. config.</span><span class="sxs-lookup"><span data-stu-id="378e3-138">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the Svcutil.exe.config configuration file.</span></span> <span data-ttu-id="378e3-139">Vous pouvez également pointer Svcutil.exe pour charger les types d'importateur de stratégie enregistrés dans un autre fichier de configuration à l'aide de l'option `/svcutilConfig`.</span><span class="sxs-lookup"><span data-stu-id="378e3-139">You can also point Svcutil.exe to load policy importer types registered in a different configuration file by using the `/svcutilConfig` option.</span></span>  
  
2. <span data-ttu-id="378e3-140">Utilisez l' [outil ServiceModel Metadata Utility Tool (Svcutil. exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) pour importer les métadonnées et l’importateur est appelé automatiquement.</span><span class="sxs-lookup"><span data-stu-id="378e3-140">Use [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) to import the metadata and the importer is invoked automatically.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-programmatically"></a><span data-ttu-id="378e3-141">Pour insérer par programme l'importateur de stratégie personnalisé dans le système de métadonnées</span><span class="sxs-lookup"><span data-stu-id="378e3-141">To insert the custom policy importer into the metadata system programmatically</span></span>  
  
1. <span data-ttu-id="378e3-142">Ajoutez l'importateur à la propriété <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> (par exemple, si vous utilisez <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>) avant d'importer les métadonnées.</span><span class="sxs-lookup"><span data-stu-id="378e3-142">Add the importer to the <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> property (for example, if you are using the <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>) prior to importing the metadata.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="378e3-143">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="378e3-143">See also</span></span>

- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- [<span data-ttu-id="378e3-144">Extension du système de métadonnées</span><span class="sxs-lookup"><span data-stu-id="378e3-144">Extending the Metadata System</span></span>](extending-the-metadata-system.md)

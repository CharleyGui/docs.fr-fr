---
title: 'Procédure : remplacer le fournisseur de services de chiffrement par la clé privée d’un certificat X.509'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- cryptographic provider [WCF], changing
- cryptographic provider [WCF]
ms.assetid: b4254406-272e-4774-bd61-27e39bbb6c12
ms.openlocfilehash: 33d42f26407787b26e1447f8b8f619dd6fc15229
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/26/2020
ms.locfileid: "96262110"
---
# <a name="how-to-change-the-cryptographic-provider-for-an-x509-certificates-private-key"></a><span data-ttu-id="7e31f-102">Procédure : remplacer le fournisseur de services de chiffrement par la clé privée d’un certificat X.509</span><span class="sxs-lookup"><span data-stu-id="7e31f-102">How to: Change the Cryptographic Provider for an X.509 Certificate's Private Key</span></span>

<span data-ttu-id="7e31f-103">Cette rubrique montre comment modifier le fournisseur de services de chiffrement utilisé pour fournir la clé privée d’un certificat X. 509 et comment intégrer le fournisseur dans l’infrastructure de sécurité Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="7e31f-103">This topic shows how to change the cryptographic provider used to provide an X.509 certificate's private key and how to integrate the provider into the Windows Communication Foundation (WCF) security framework.</span></span> <span data-ttu-id="7e31f-104">Pour plus d’informations sur l’utilisation des certificats, consultez [utilisation des certificats](../feature-details/working-with-certificates.md).</span><span class="sxs-lookup"><span data-stu-id="7e31f-104">For more information about using certificates, see [Working with Certificates](../feature-details/working-with-certificates.md).</span></span>  
  
 <span data-ttu-id="7e31f-105">L’infrastructure de sécurité WCF offre un moyen d’introduire de nouveaux types de jetons de sécurité, comme décrit dans [How to : Create a Custom Token](how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="7e31f-105">The WCF security framework provides a way to introduce new security token types as described in [How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span> <span data-ttu-id="7e31f-106">Vous pouvez aussi utiliser un jeton personnalisé pour remplacer les types de jeton existants fournis par le système.</span><span class="sxs-lookup"><span data-stu-id="7e31f-106">It is also possible to use a custom token to replace existing system-provided token types.</span></span>  
  
 <span data-ttu-id="7e31f-107">Dans cette rubrique, le jeton de sécurité X.509 fourni par le système est remplacé par un jeton X.509 personnalisé qui fournit une implémentation différente pour la clé privée de certificat.</span><span class="sxs-lookup"><span data-stu-id="7e31f-107">In this topic, the system-provided X.509 security token is replaced by a custom X.509 token that provides a different implementation for the certificate private key.</span></span> <span data-ttu-id="7e31f-108">Cette opération est utile dans les scénarios où la clé privée à proprement dite est fournie par un fournisseur de services de chiffrement différent du fournisseur Windows par défaut.</span><span class="sxs-lookup"><span data-stu-id="7e31f-108">This is useful in scenarios where the actual private key is provided by a different cryptographic provider than the default Windows cryptographic provider.</span></span> <span data-ttu-id="7e31f-109">Parmi les exemples d'un autre fournisseur de services de chiffrement figure un module de la sécurité du matériel qui effectue toutes les opérations de chiffrement liées à la clé privée sans stocker les clés privées en mémoire, ce qui améliore la sécurité du système.</span><span class="sxs-lookup"><span data-stu-id="7e31f-109">One example of an alternative cryptographic provider is a hardware security module that performs all private key related cryptographic operations, and does not store the private keys in memory, thus improving security of the system.</span></span>  
  
 <span data-ttu-id="7e31f-110">L'exemple suivant est fourni à des fins de démonstration uniquement.</span><span class="sxs-lookup"><span data-stu-id="7e31f-110">The following example is for demonstration purposes only.</span></span> <span data-ttu-id="7e31f-111">Il ne remplace pas le fournisseur de services de chiffrement Windows par défaut, mais il montre comment intégrer ce type de fournisseur.</span><span class="sxs-lookup"><span data-stu-id="7e31f-111">It does not replace the default Windows cryptographic provider, but it shows where such a provider could be integrated.</span></span>  
  
## <a name="procedures"></a><span data-ttu-id="7e31f-112">Procédures</span><span class="sxs-lookup"><span data-stu-id="7e31f-112">Procedures</span></span>  

 <span data-ttu-id="7e31f-113">Chaque jeton de sécurité qui possède une clé ou des clés de sécurité associées doit implémenter la propriété <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> qui retourne une collection de clés issue de l’instance du jeton de sécurité.</span><span class="sxs-lookup"><span data-stu-id="7e31f-113">Every security token that has an associated security key or keys must implement the <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> property, which returns a collection of keys from the security token instance.</span></span> <span data-ttu-id="7e31f-114">Si le jeton est un jeton de sécurité X.509, la collection contient une instance unique de la classe <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> qui représente à la fois les clés privées et publiques associées au certificat.</span><span class="sxs-lookup"><span data-stu-id="7e31f-114">If the token is an X.509 security token, the collection contains a single instance of the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class that represents both public and private keys associated with the certificate.</span></span> <span data-ttu-id="7e31f-115">Pour remplacer le fournisseur de services de chiffrement par défaut utilisé pour fournir les clés du certificat, créez une nouvelle implémentation de cette classe.</span><span class="sxs-lookup"><span data-stu-id="7e31f-115">To replace the default cryptographic provider used to provide the certificate's keys, create a new implementation of this class.</span></span>  
  
#### <a name="to-create-a-custom-x509-asymmetric-key"></a><span data-ttu-id="7e31f-116">Pour créer une clé asymétrique X.509 personnalisée</span><span class="sxs-lookup"><span data-stu-id="7e31f-116">To create a custom X.509 asymmetric key</span></span>  
  
1. <span data-ttu-id="7e31f-117">Définissez une nouvelle classe dérivée de la classe <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey>.</span><span class="sxs-lookup"><span data-stu-id="7e31f-117">Define a new class derived from the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class.</span></span>  
  
2. <span data-ttu-id="7e31f-118">Substituez la propriété en lecture seule <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A>.</span><span class="sxs-lookup"><span data-stu-id="7e31f-118">Override the <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A> read-only property.</span></span> <span data-ttu-id="7e31f-119">Cette propriété retourne la taille de clé réelle de la paire de clés publique/privée du certificat.</span><span class="sxs-lookup"><span data-stu-id="7e31f-119">This property returns the actual key size of the certificate's public/private key pair.</span></span>  
  
3. <span data-ttu-id="7e31f-120">Remplacez la méthode <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A> .</span><span class="sxs-lookup"><span data-stu-id="7e31f-120">Override the <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A> method.</span></span> <span data-ttu-id="7e31f-121">Cette méthode est appelée par l’infrastructure de sécurité WCF pour déchiffrer une clé symétrique avec la clé privée du certificat.</span><span class="sxs-lookup"><span data-stu-id="7e31f-121">This method is called by the WCF security framework to decrypt a symmetric key with the certificate's private key.</span></span> <span data-ttu-id="7e31f-122">(La clé a été chiffrée précédemment avec la clé publique du certificat.)</span><span class="sxs-lookup"><span data-stu-id="7e31f-122">(The key was previously encrypted with the certificate's public key.)</span></span>  
  
4. <span data-ttu-id="7e31f-123">Remplacez la méthode <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A> .</span><span class="sxs-lookup"><span data-stu-id="7e31f-123">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A> method.</span></span> <span data-ttu-id="7e31f-124">Cette méthode est appelée par l’infrastructure de sécurité WCF pour obtenir une instance de la <xref:System.Security.Cryptography.AsymmetricAlgorithm> classe qui représente le fournisseur de services de chiffrement pour la clé privée ou publique du certificat, selon les paramètres passés à la méthode.</span><span class="sxs-lookup"><span data-stu-id="7e31f-124">This method is called by the WCF security framework to obtain an instance of the <xref:System.Security.Cryptography.AsymmetricAlgorithm> class that represents the cryptographic provider for either the certificate's private or public key, depending on the parameters passed to the method.</span></span>  
  
5. <span data-ttu-id="7e31f-125">facultatif.</span><span class="sxs-lookup"><span data-stu-id="7e31f-125">Optional.</span></span> <span data-ttu-id="7e31f-126">Remplacez la méthode <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A> .</span><span class="sxs-lookup"><span data-stu-id="7e31f-126">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A> method.</span></span> <span data-ttu-id="7e31f-127">Substituez cette méthode si une implémentation différente de la classe <xref:System.Security.Cryptography.HashAlgorithm> est requise.</span><span class="sxs-lookup"><span data-stu-id="7e31f-127">Override this method if a different implementation of the <xref:System.Security.Cryptography.HashAlgorithm> class is required.</span></span>  
  
6. <span data-ttu-id="7e31f-128">Remplacez la méthode <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A> .</span><span class="sxs-lookup"><span data-stu-id="7e31f-128">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A> method.</span></span> <span data-ttu-id="7e31f-129">Cette méthode retourne une instance de la classe <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> associée à la clé privée du certificat.</span><span class="sxs-lookup"><span data-stu-id="7e31f-129">This method returns an instance of the <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> class that is associated with the certificate's private key.</span></span>  
  
7. <span data-ttu-id="7e31f-130">Remplacez la méthode <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A> .</span><span class="sxs-lookup"><span data-stu-id="7e31f-130">Override the <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A> method.</span></span> <span data-ttu-id="7e31f-131">Cette méthode est utilisée pour indiquer si un algorithme de chiffrement particulier est pris en charge par l'implémentation de la clé de sécurité.</span><span class="sxs-lookup"><span data-stu-id="7e31f-131">This method is used to indicate whether a particular cryptographic algorithm is supported by the security key implementation.</span></span>  
  
     [!code-csharp[c_CustomX509Token#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#1)]
     [!code-vb[c_CustomX509Token#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#1)]  
  
 <span data-ttu-id="7e31f-132">La procédure suivante montre comment intégrer l’implémentation de la clé de sécurité asymétrique X. 509 personnalisée créée dans la procédure précédente avec l’infrastructure de sécurité WCF afin de remplacer le jeton de sécurité X. 509 fourni par le système.</span><span class="sxs-lookup"><span data-stu-id="7e31f-132">The following procedure shows how to integrate the custom X.509 asymmetric security key implementation created in the preceding procedure with the WCF security framework in order to replace the system-provided X.509 security token.</span></span>  
  
#### <a name="to-replace-the-system-provided-x509-security-token-with-a-custom-x509-asymmetric-security-key-token"></a><span data-ttu-id="7e31f-133">Pour remplacer le jeton de sécurité X.509 fourni par le système par un jeton de clé de sécurité asymétrique X.509 personnalisé</span><span class="sxs-lookup"><span data-stu-id="7e31f-133">To replace the system-provided X.509 security token with a custom X.509 asymmetric security key token</span></span>  
  
1. <span data-ttu-id="7e31f-134">Créez un jeton de sécurité X.509 personnalisé qui retourne la clé de sécurité asymétrique X.509 personnalisée au lieu de la clé de sécurité fournie par le système, comme indiqué dans l'exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="7e31f-134">Create a custom X.509 security token that returns the custom X.509 asymmetric security key instead of the system-provided security key, as shown in the following example.</span></span> <span data-ttu-id="7e31f-135">Pour plus d’informations sur les jetons de sécurité personnalisés, consultez [How to : Create a Custom Token](how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="7e31f-135">For more information about custom security tokens, see [How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#2)]
     [!code-vb[c_CustomX509Token#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#2)]  
  
2. <span data-ttu-id="7e31f-136">Créez un fournisseur de jetons de sécurité personnalisé qui retourne un jeton de sécurité X.509 personnalisé, comme indiqué dans l'exemple.</span><span class="sxs-lookup"><span data-stu-id="7e31f-136">Create a custom security token provider that returns a custom X.509 security token, as shown in the example.</span></span> <span data-ttu-id="7e31f-137">Pour plus d’informations sur les fournisseurs de jetons de sécurité personnalisés, consultez [Comment : créer un fournisseur de jetons de sécurité personnalisé](how-to-create-a-custom-security-token-provider.md).</span><span class="sxs-lookup"><span data-stu-id="7e31f-137">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](how-to-create-a-custom-security-token-provider.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#3)]
     [!code-vb[c_CustomX509Token#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#3)]  
  
3. <span data-ttu-id="7e31f-138">Si la clé de sécurité personnalisée doit être utilisée sur le côté d'initiateur, créez un gestionnaire de jetons de sécurité client personnalisé et des classes d'informations d'identification du client personnalisées, comme indiqué dans l'exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="7e31f-138">If the custom security key needs to be used on the initiator side, create a custom client security token manager and custom client credentials classes, as shown in the following example.</span></span> <span data-ttu-id="7e31f-139">Pour plus d’informations sur les informations d’identification client personnalisées et les gestionnaires de jetons de sécurité client, consultez [procédure pas à pas : création d’informations d’identification de client et de service personnalisées](walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="7e31f-139">For more information about custom client credentials and client security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#4)]
     [!code-vb[c_CustomX509Token#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#4)]  
  
     [!code-csharp[c_CustomX509Token#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#6)]
     [!code-vb[c_CustomX509Token#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#6)]  
  
4. <span data-ttu-id="7e31f-140">Si la clé de sécurité personnalisée doit être utilisée sur le côté destinataire, créez un gestionnaire de jetons de sécurité client personnalisé et des classes personnalisées d'informations d'identification du client, comme indiqué dans l'exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="7e31f-140">If the custom security key needs to be used on the recipient side, create a custom service security token manager and custom service credentials, as shown in the following example.</span></span> <span data-ttu-id="7e31f-141">Pour plus d’informations sur les informations d’identification de service personnalisées et les gestionnaires de jetons de sécurité de service, consultez [procédure pas à pas : création d’informations d’identification client et service personnalisées](walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="7e31f-141">For more information about custom service credentials and service security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#5)]
     [!code-vb[c_CustomX509Token#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#5)]  
  
     [!code-csharp[c_CustomX509Token#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#7)]
     [!code-vb[c_CustomX509Token#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#7)]  
  
## <a name="see-also"></a><span data-ttu-id="7e31f-142">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="7e31f-142">See also</span></span>

- <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey>
- <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey>
- <xref:System.IdentityModel.Tokens.SecurityKey>
- <xref:System.Security.Cryptography.AsymmetricAlgorithm>
- <xref:System.Security.Cryptography.HashAlgorithm>
- <xref:System.Security.Cryptography.AsymmetricSignatureFormatter>
- [<span data-ttu-id="7e31f-143">Procédure pas à pas : création d’informations d’identification de client et de service personnalisées</span><span class="sxs-lookup"><span data-stu-id="7e31f-143">Walkthrough: Creating Custom Client and Service Credentials</span></span>](walkthrough-creating-custom-client-and-service-credentials.md)
- [<span data-ttu-id="7e31f-144">Procédure : créer un authentificateur de jetons de sécurité personnalisé</span><span class="sxs-lookup"><span data-stu-id="7e31f-144">How to: Create a Custom Security Token Authenticator</span></span>](how-to-create-a-custom-security-token-authenticator.md)
- [<span data-ttu-id="7e31f-145">Procédure : créer un fournisseur de jetons de sécurité personnalisé</span><span class="sxs-lookup"><span data-stu-id="7e31f-145">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)
- [<span data-ttu-id="7e31f-146">Procédure : créer un jeton personnalisé</span><span class="sxs-lookup"><span data-stu-id="7e31f-146">How to: Create a Custom Token</span></span>](how-to-create-a-custom-token.md)

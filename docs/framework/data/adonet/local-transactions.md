---
title: Transactions locales
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 8ae3712f-ef5e-41a1-9ea9-b3d0399439f1
ms.openlocfilehash: a0cb72913c10712ece188a782095b93f98cdc0b2
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/22/2019
ms.locfileid: "69955772"
---
# <a name="local-transactions"></a><span data-ttu-id="7b7e6-102">Transactions locales</span><span class="sxs-lookup"><span data-stu-id="7b7e6-102">Local Transactions</span></span>
<span data-ttu-id="7b7e6-103">Les transactions dans ADO.NET sont utilisées lorsque vous souhaitez lier plusieurs tâches ensemble afin qu’elles s’exécutent comme une seule unité de travail.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-103">Transactions in ADO.NET are used when you want to bind multiple tasks together so that they execute as a single unit of work.</span></span> <span data-ttu-id="7b7e6-104">Par exemple, imaginez qu'une application effectue deux tâches.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-104">For example, imagine that an application performs two tasks.</span></span> <span data-ttu-id="7b7e6-105">Premièrement, elle met à jour une table avec des informations de commande.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-105">First, it updates a table with order information.</span></span> <span data-ttu-id="7b7e6-106">Deuxièmement, elle met à jour une table qui contient des informations de stock, en débitant les articles commandés.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-106">Second, it updates a table that contains inventory information, debiting the items ordered.</span></span> <span data-ttu-id="7b7e6-107">Si l’une des tâches échoue, les deux mises à jour sont annulées.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-107">If either task fails, then both updates are rolled back.</span></span>  
  
## <a name="determining-the-transaction-type"></a><span data-ttu-id="7b7e6-108">Détermination du type de transaction</span><span class="sxs-lookup"><span data-stu-id="7b7e6-108">Determining the Transaction Type</span></span>  
 <span data-ttu-id="7b7e6-109">Une transaction est considérée comme une transaction locale lorsqu’il s’agit d’une transaction en une seule phase et qu’elle est gérée directement par la base de données.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-109">A transaction is considered to be a local transaction when it is a single-phase transaction and is handled by the database directly.</span></span> <span data-ttu-id="7b7e6-110">Une transaction est considérée comme une transaction distribuée lorsqu’elle est coordonnée par un moniteur de transaction et utilise des mécanismes de prévention de défaillance (tels qu’une validation en deux phases) pour la résolution des transactions.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-110">A transaction is considered to be a distributed transaction when it is coordinated by a transaction monitor and uses fail-safe mechanisms (such as two-phase commit) for transaction resolution.</span></span>  
  
 <span data-ttu-id="7b7e6-111">Chaque fournisseur de données .NET Framework possède son propre `Transaction` objet pour effectuer des transactions locales.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-111">Each of the .NET Framework data providers has its own `Transaction` object for performing local transactions.</span></span> <span data-ttu-id="7b7e6-112">Si vous avez besoin qu’une transaction soit effectuée dans une base de données SQL Server, sélectionnez une transaction <xref:System.Data.SqlClient>.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-112">If you require a transaction to be performed in a SQL Server database, select a <xref:System.Data.SqlClient> transaction.</span></span> <span data-ttu-id="7b7e6-113">Pour une transaction Oracle, utilisez le fournisseur <xref:System.Data.OracleClient>.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-113">For an Oracle transaction, use the <xref:System.Data.OracleClient> provider.</span></span> <span data-ttu-id="7b7e6-114">En outre, il existe une <xref:System.Data.Common.DbTransaction> classe qui est disponible pour écrire du code indépendant du fournisseur qui requiert des transactions.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-114">In addition, there is a <xref:System.Data.Common.DbTransaction> class that is available for writing provider-independent code that requires transactions.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="7b7e6-115">Les transactions sont plus efficaces lorsqu’elles sont exécutées sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-115">Transactions are most efficient when they are performed on the server.</span></span> <span data-ttu-id="7b7e6-116">Si vous utilisez une base de données SQL Server qui utilise beaucoup des transactions explicites, envisagez de les écrire sous la forme de procédures stockées à l’aide de l’instruction Transact-SQL BEGIN TRANSACTION.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-116">If you are working with a SQL Server database that makes extensive use of explicit transactions, consider writing them as stored procedures using the Transact-SQL BEGIN TRANSACTION statement.</span></span>
  
## <a name="performing-a-transaction-using-a-single-connection"></a><span data-ttu-id="7b7e6-117">Exécution d’une transaction à l’aide d’une connexion unique</span><span class="sxs-lookup"><span data-stu-id="7b7e6-117">Performing a Transaction Using a Single Connection</span></span>  
 <span data-ttu-id="7b7e6-118">Dans ADO.net, vous contrôlez les transactions avec `Connection` l’objet.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-118">In ADO.NET, you control transactions with the `Connection` object.</span></span> <span data-ttu-id="7b7e6-119">Vous pouvez initier une transaction locale avec la méthode `BeginTransaction`.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-119">You can initiate a local transaction with the `BeginTransaction` method.</span></span> <span data-ttu-id="7b7e6-120">Après avoir commencé une transaction, vous pouvez inscrire une commande dans cette transaction avec la propriété `Transaction` d’un objet `Command`.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-120">Once you have begun a transaction, you can enlist a command in that transaction with the `Transaction` property of a `Command` object.</span></span> <span data-ttu-id="7b7e6-121">Vous pouvez ensuite valider ou annuler les modifications apportées à la source de données en fonction de la réussite ou de l’échec des composants de la transaction.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-121">You can then commit or roll back modifications made at the data source based on the success or failure of the components of the transaction.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="7b7e6-122">La méthode `EnlistDistributedTransaction` ne doit pas être utilisée pour une transaction locale.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-122">The `EnlistDistributedTransaction` method should not be used for a local transaction.</span></span>  
  
 <span data-ttu-id="7b7e6-123">La portée de la transaction est limitée à la connexion.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-123">The scope of the transaction is limited to the connection.</span></span> <span data-ttu-id="7b7e6-124">L’exemple suivant exécute une transaction explicite consistant en deux commandes distinctes dans le bloc `try`.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-124">The following example performs an explicit transaction that consists of two separate commands in the `try` block.</span></span> <span data-ttu-id="7b7e6-125">Les commandes exécutent des instructions INSERT sur la table production. ScrapReason de l’exemple de base de données AdventureWorks SQL Server, qui sont validées si aucune exception n’est levée.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-125">The commands execute INSERT statements against the Production.ScrapReason table in the AdventureWorks SQL Server sample database, which are committed if no exceptions are thrown.</span></span> <span data-ttu-id="7b7e6-126">Le code dans le bloc `catch` annule la transaction si une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-126">The code in the `catch` block rolls back the transaction if an exception is thrown.</span></span> <span data-ttu-id="7b7e6-127">En cas d'annulation de la transaction ou de fermeture de la connexion avant que la transaction ne soit terminée, celle-ci est automatiquement annulée.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-127">If the transaction is aborted or the connection is closed before the transaction has completed, it is automatically rolled back.</span></span>  
  
## <a name="example"></a><span data-ttu-id="7b7e6-128">Exemples</span><span class="sxs-lookup"><span data-stu-id="7b7e6-128">Example</span></span>  
 <span data-ttu-id="7b7e6-129">Procédez comme suit pour effectuer une transaction.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-129">Follow these steps to perform a transaction.</span></span>  
  
1. <span data-ttu-id="7b7e6-130">Appelez la méthode <xref:System.Data.SqlClient.SqlConnection.BeginTransaction%2A> de l’objet <xref:System.Data.SqlClient.SqlConnection> pour marquer le début de la transaction.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-130">Call the <xref:System.Data.SqlClient.SqlConnection.BeginTransaction%2A> method of the <xref:System.Data.SqlClient.SqlConnection> object to mark the start of the transaction.</span></span> <span data-ttu-id="7b7e6-131">La méthode <xref:System.Data.SqlClient.SqlConnection.BeginTransaction%2A> retourne une référence à la transaction.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-131">The <xref:System.Data.SqlClient.SqlConnection.BeginTransaction%2A> method returns a reference to the transaction.</span></span> <span data-ttu-id="7b7e6-132">Cette référence est affectée aux objets <xref:System.Data.SqlClient.SqlCommand> inscrits dans la transaction.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-132">This reference is assigned to the <xref:System.Data.SqlClient.SqlCommand> objects that are enlisted in the transaction.</span></span>  
  
2. <span data-ttu-id="7b7e6-133">Assignez l'objet `Transaction` à la propriété <xref:System.Data.SqlClient.SqlCommand.Transaction%2A> de l'objet <xref:System.Data.SqlClient.SqlCommand> à exécuter.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-133">Assign the `Transaction` object to the <xref:System.Data.SqlClient.SqlCommand.Transaction%2A> property of the <xref:System.Data.SqlClient.SqlCommand> to be executed.</span></span> <span data-ttu-id="7b7e6-134">Si une commande est exécutée sur une connexion sur laquelle une transaction est active et si l’objet `Transaction` n’a pas été affecté à la propriété `Transaction` de l’objet `Command`, une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-134">If a command is executed on a connection with an active transaction, and the `Transaction` object has not been assigned to the `Transaction` property of the `Command` object, an exception is thrown.</span></span>  
  
3. <span data-ttu-id="7b7e6-135">Exécutez les commandes requises.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-135">Execute the required commands.</span></span>  
  
4. <span data-ttu-id="7b7e6-136">Appelez la méthode <xref:System.Data.SqlClient.SqlTransaction.Commit%2A> de l'objet <xref:System.Data.SqlClient.SqlTransaction> pour effectuer la transaction ou la méthode <xref:System.Data.SqlClient.SqlTransaction.Rollback%2A> pour y mettre fin.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-136">Call the <xref:System.Data.SqlClient.SqlTransaction.Commit%2A> method of the <xref:System.Data.SqlClient.SqlTransaction> object to complete the transaction, or call the <xref:System.Data.SqlClient.SqlTransaction.Rollback%2A> method to end the transaction.</span></span> <span data-ttu-id="7b7e6-137">Si la connexion est fermée ou libérée avant que l’une des méthodes <xref:System.Data.SqlClient.SqlTransaction.Commit%2A> ou <xref:System.Data.SqlClient.SqlTransaction.Rollback%2A> ait été exécutée, la transaction est annulée.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-137">If the connection is closed or disposed before either the <xref:System.Data.SqlClient.SqlTransaction.Commit%2A> or <xref:System.Data.SqlClient.SqlTransaction.Rollback%2A> methods have been executed, the transaction is rolled back.</span></span>  
  
 <span data-ttu-id="7b7e6-138">L’exemple de code suivant illustre la logique transactionnelle à l’aide de ADO.NET avec Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7b7e6-138">The following code example demonstrates transactional logic using ADO.NET with Microsoft SQL Server.</span></span>  
  
 [!code-csharp[DataWorks SqlTransaction.Local#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlTransaction.Local/CS/source.cs#1)]
 [!code-vb[DataWorks SqlTransaction.Local#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlTransaction.Local/VB/source.vb#1)]  
  
## <a name="see-also"></a><span data-ttu-id="7b7e6-139">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="7b7e6-139">See also</span></span>

- [<span data-ttu-id="7b7e6-140">Transactions et accès concurrentiel</span><span class="sxs-lookup"><span data-stu-id="7b7e6-140">Transactions and Concurrency</span></span>](../../../../docs/framework/data/adonet/transactions-and-concurrency.md)
- [<span data-ttu-id="7b7e6-141">Transactions distribuées</span><span class="sxs-lookup"><span data-stu-id="7b7e6-141">Distributed Transactions</span></span>](../../../../docs/framework/data/adonet/distributed-transactions.md)
- [<span data-ttu-id="7b7e6-142">Intégration de System.Transactions à SQL Server</span><span class="sxs-lookup"><span data-stu-id="7b7e6-142">System.Transactions Integration with SQL Server</span></span>](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md)
- [<span data-ttu-id="7b7e6-143">Fournisseurs managés ADO.NET et centre de développement DataSet</span><span class="sxs-lookup"><span data-stu-id="7b7e6-143">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)

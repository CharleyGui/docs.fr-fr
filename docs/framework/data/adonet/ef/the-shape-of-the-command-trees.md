---
title: Forme des arborescences de commandes
ms.date: 03/30/2017
ms.assetid: 2215585e-ca47-45f8-98d4-8cb982f8c1d3
ms.openlocfilehash: 8368354049a77a56a5aa54ab500619576f41b0dc
ms.sourcegitcommit: 205b9a204742e9c77256d43ac9d94c3f82909808
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/10/2019
ms.locfileid: "70854266"
---
# <a name="the-shape-of-the-command-trees"></a><span data-ttu-id="79489-102">Forme des arborescences de commandes</span><span class="sxs-lookup"><span data-stu-id="79489-102">The Shape of the Command Trees</span></span>

<span data-ttu-id="79489-103">Le module de génération SQL est chargé de la génération d’une requête SQL spécifique principale basée sur une expression de l’arborescence de commandes de la requête d’entrée donnée.</span><span class="sxs-lookup"><span data-stu-id="79489-103">The SQL generation module is responsible for generating a backend specific SQL query based on a given input query command tree expression.</span></span> <span data-ttu-id="79489-104">Cette section traite des caractéristiques, des propriétés et de la structure des arborescences de commandes de requête.</span><span class="sxs-lookup"><span data-stu-id="79489-104">This section discusses the characteristics, properties, and structure of the query command trees.</span></span>

## <a name="query-command-trees-overview"></a><span data-ttu-id="79489-105">Vue d’ensemble des arborescences de commandes de requête</span><span class="sxs-lookup"><span data-stu-id="79489-105">Query Command Trees Overview</span></span>

<span data-ttu-id="79489-106">Une arborescence de commandes de requête est une représentation de modèle objet d'une requête.</span><span class="sxs-lookup"><span data-stu-id="79489-106">A query command tree is an object model representation of a query.</span></span> <span data-ttu-id="79489-107">Les arborescences de commandes de requête ont deux objectifs :</span><span class="sxs-lookup"><span data-stu-id="79489-107">Query command trees serve two purposes:</span></span>

- <span data-ttu-id="79489-108">Pour exprimer une requête d’entrée spécifiée par rapport au Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="79489-108">To express an input query that is specified against the Entity Framework.</span></span>

- <span data-ttu-id="79489-109">exprimer une requête de sortie qui est donnée à un fournisseur et décrire une requête par rapport au serveur.</span><span class="sxs-lookup"><span data-stu-id="79489-109">To express an output query that is given to a provider and describes a query against the backend.</span></span>

<span data-ttu-id="79489-110">Les arborescences de commandes de requête prennent en charge des sémantiques plus riches que les requêtes conformes SQL:1999, notamment l'utilisation des collections imbriquées et des opérations de type, telles que vérifier si une entité est d'un type particulier ou filtrer des jeux selon un type.</span><span class="sxs-lookup"><span data-stu-id="79489-110">Query command trees support richer semantics than SQL:1999 compliant queries, including support for working with nested collections and type operations, like checking whether an entity is of a particular type, or filtering sets based on a type.</span></span>

<span data-ttu-id="79489-111">La propriété DBQueryCommandTree.Query est la racine de l’arborescence d’expression qui décrit la logique de requête.</span><span class="sxs-lookup"><span data-stu-id="79489-111">The DBQueryCommandTree.Query property is the root of the expression tree that describes the query logic.</span></span> <span data-ttu-id="79489-112">La propriété DBQueryCommandTree.Parameters contient une liste des paramètres utilisés dans la requête.</span><span class="sxs-lookup"><span data-stu-id="79489-112">The DBQueryCommandTree.Parameters property contains a list of parameters that are used in the query.</span></span> <span data-ttu-id="79489-113">L'arborescence d'expression est composée d'objets DbExpression.</span><span class="sxs-lookup"><span data-stu-id="79489-113">The expression tree is composed of DbExpression objects.</span></span>

<span data-ttu-id="79489-114">Un objet DbExpression représente un calcul.</span><span class="sxs-lookup"><span data-stu-id="79489-114">A DbExpression object represents some computation.</span></span> <span data-ttu-id="79489-115">Plusieurs types d’expressions sont fournis par le Entity Framework pour composer des expressions de requête, y compris des constantes, des variables, des fonctions, des constructeurs et des opérateurs relationnels standard tels que Filter et Join.</span><span class="sxs-lookup"><span data-stu-id="79489-115">Several kinds of expressions are provided by the Entity Framework for composing query expressions, including constants, variables, functions, constructors, and standard relational operators like filter and join.</span></span> <span data-ttu-id="79489-116">Chaque objet DbExpression a une propriété ResultType qui représente le type du résultat produit par cette expression.</span><span class="sxs-lookup"><span data-stu-id="79489-116">Every DbExpression object has a ResultType property that represents the type of the result produced by that expression.</span></span> <span data-ttu-id="79489-117">Ce type est exprimé sous la forme d'un TypeUsage.</span><span class="sxs-lookup"><span data-stu-id="79489-117">This type is expressed as a TypeUsage.</span></span>

## <a name="shapes-of-the-output-query-command-tree"></a><span data-ttu-id="79489-118">Formes de l’arborescence de commandes de requête de sortie</span><span class="sxs-lookup"><span data-stu-id="79489-118">Shapes of the Output Query Command Tree</span></span>

<span data-ttu-id="79489-119">Les arborescences de commandes de requête de sortie représentent les requêtes relationnelles (SQL) précisément et adhèrent à des règles beaucoup plus strictes que celles qui s’appliquent aux arborescences de commandes de requête.</span><span class="sxs-lookup"><span data-stu-id="79489-119">Output query command trees closely represent relational (SQL) queries and adhere to much stricter rules than those that apply to query command trees.</span></span> <span data-ttu-id="79489-120">Elles contiennent en général des constructions qui se traduisent facilement en SQL.</span><span class="sxs-lookup"><span data-stu-id="79489-120">They typically contain constructs that are easily translated to SQL.</span></span>

<span data-ttu-id="79489-121">Les arborescences de commandes d’entrée sont exprimées par rapport au modèle conceptuel, qui prend en charge des propriétés de navigation, des associations entre entités et l’héritage.</span><span class="sxs-lookup"><span data-stu-id="79489-121">Input command trees are expressed against the conceptual model, which supports navigation properties, associations among entities, and inheritance.</span></span> <span data-ttu-id="79489-122">Les arborescences de commandes de sortie sont exprimées par rapport au modèle de stockage.</span><span class="sxs-lookup"><span data-stu-id="79489-122">Output command trees are expressed against the storage model.</span></span> <span data-ttu-id="79489-123">Les arborescences de commandes d’entrée vous permettent de projeter des collections imbriquées, contrairement aux arborescences de commandes de sortie.</span><span class="sxs-lookup"><span data-stu-id="79489-123">Input command trees allow you to project nested collections, but output command trees do not.</span></span>

<span data-ttu-id="79489-124">Les arborescences de commandes de requête de sortie sont construites à l'aide d'un sous-ensemble des objets DbExpression disponibles et même certaines expressions dans ce sous-ensemble ont une utilisation restreinte.</span><span class="sxs-lookup"><span data-stu-id="79489-124">Output query command trees are built using a subset of the available DbExpression objects and even some expressions in that subset have restricted usage.</span></span>

<span data-ttu-id="79489-125">Les opérations de type, telles que vérifier si une expression donnée est d’un type particulier ou les jeux de filtrage basés sur un type, ne sont pas présentes dans les arborescences de commandes de sortie.</span><span class="sxs-lookup"><span data-stu-id="79489-125">Type operations, like checking whether a given expression is of a particular type or filtering sets based on a type, are not present in output command trees.</span></span>

<span data-ttu-id="79489-126">Dans les arborescences de commandes de sortie, seules les expressions qui retournent des valeurs booléennes sont utilisées pour les projections et uniquement pour des prédicats dans les expressions qui requièrent un prédicat, comme un filtre ou une instruction de casse.</span><span class="sxs-lookup"><span data-stu-id="79489-126">In output command trees, only expressions that return Boolean values are used for projections and only for predicates in expressions requiring a predicate, like a filter or a case statement.</span></span>

<span data-ttu-id="79489-127">La racine d'une arborescence de commandes de requête de sortie est un objet DbProjectExpression.</span><span class="sxs-lookup"><span data-stu-id="79489-127">The root of an output query command trees is a DbProjectExpression object.</span></span>

### <a name="expression-types-not-present-in-output-query-command-trees"></a><span data-ttu-id="79489-128">Types d’expression non présents dans les arborescences de commandes de requête de sortie</span><span class="sxs-lookup"><span data-stu-id="79489-128">Expression Types Not Present in Output Query Command Trees</span></span>

<span data-ttu-id="79489-129">Les types d’expression suivants ne sont pas valides dans une arborescence de commandes de requête de sortie et n’ont pas besoin d’être gérés par les fournisseurs :</span><span class="sxs-lookup"><span data-stu-id="79489-129">The following expression types are not valid in an output query command tree and do not need to be handled by providers:</span></span>

- <span data-ttu-id="79489-130">DbDerefExpression</span><span class="sxs-lookup"><span data-stu-id="79489-130">DbDerefExpression</span></span>

- <span data-ttu-id="79489-131">DbEntityRefExpression</span><span class="sxs-lookup"><span data-stu-id="79489-131">DbEntityRefExpression</span></span>

- <span data-ttu-id="79489-132">DbRefKeyExpression</span><span class="sxs-lookup"><span data-stu-id="79489-132">DbRefKeyExpression</span></span>

- <span data-ttu-id="79489-133">DbIsOfExpression</span><span class="sxs-lookup"><span data-stu-id="79489-133">DbIsOfExpression</span></span>

- <span data-ttu-id="79489-134">DbOfTypeExpression</span><span class="sxs-lookup"><span data-stu-id="79489-134">DbOfTypeExpression</span></span>

- <span data-ttu-id="79489-135">DbRefExpression</span><span class="sxs-lookup"><span data-stu-id="79489-135">DbRefExpression</span></span>

- <span data-ttu-id="79489-136">DbRelationshipNavigationExpression</span><span class="sxs-lookup"><span data-stu-id="79489-136">DbRelationshipNavigationExpression</span></span>

- <span data-ttu-id="79489-137">DbTreatExpression</span><span class="sxs-lookup"><span data-stu-id="79489-137">DbTreatExpression</span></span>

### <a name="expression-restrictions-and-notes"></a><span data-ttu-id="79489-138">Limitations relatives aux expressions et remarques</span><span class="sxs-lookup"><span data-stu-id="79489-138">Expression Restrictions and Notes</span></span>

<span data-ttu-id="79489-139">De nombreuses expressions peuvent être utilisées uniquement de façon restreinte dans les arborescences de commandes de requête de sortie :</span><span class="sxs-lookup"><span data-stu-id="79489-139">Many expressions can only be used in a restricted manner in output query command trees:</span></span>

#### <a name="dbfunctionexpression"></a><span data-ttu-id="79489-140">DbFunctionExpression</span><span class="sxs-lookup"><span data-stu-id="79489-140">DbFunctionExpression</span></span>

<span data-ttu-id="79489-141">Les types de fonction suivants peuvent être passés :</span><span class="sxs-lookup"><span data-stu-id="79489-141">The following function types can be passed:</span></span>

- <span data-ttu-id="79489-142">Fonctions canoniques reconnues par l'espace de noms Edm.</span><span class="sxs-lookup"><span data-stu-id="79489-142">Canonical functions that are recognized by the Edm namespace.</span></span>

- <span data-ttu-id="79489-143">Fonctions intégrées (magasin) reconnues par le BuiltInAttribute.</span><span class="sxs-lookup"><span data-stu-id="79489-143">Built-in (store) functions that are recognized by the BuiltInAttribute.</span></span>

- <span data-ttu-id="79489-144">Fonctions définies par l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="79489-144">User-defined functions.</span></span>

<span data-ttu-id="79489-145">Les fonctions canoniques (consultez [fonctions canoniques](./language-reference/canonical-functions.md) pour plus d’informations) sont spécifiées dans le cadre de la Entity Framework, et les fournisseurs doivent fournir des implémentations pour les fonctions canoniques en fonction de ces spécifications.</span><span class="sxs-lookup"><span data-stu-id="79489-145">Canonical functions (see [Canonical Functions](./language-reference/canonical-functions.md) for more information) are specified as part of the Entity Framework, and providers should supply implementations for canonical functions based on those specifications.</span></span> <span data-ttu-id="79489-146">Les fonctions de magasin sont basées sur les spécifications présentes dans le manifeste du fournisseur correspondant.</span><span class="sxs-lookup"><span data-stu-id="79489-146">Store functions are based on the specifications in the corresponding provider manifest.</span></span> <span data-ttu-id="79489-147">Les fonctions définies par l'utilisateur sont basées sur les spécifications présentes dans le SSDL.</span><span class="sxs-lookup"><span data-stu-id="79489-147">User defined functions are based on specifications in the SSDL.</span></span>

<span data-ttu-id="79489-148">De plus, les fonctions qui ont l'attribut NiladicFunction n'ont pas d'arguments et doivent être traduites sans parenthèses à la fin.</span><span class="sxs-lookup"><span data-stu-id="79489-148">Also, functions having the NiladicFunction attribute have no arguments and should be translated without the parenthesis at the end.</span></span>  <span data-ttu-id="79489-149">Autrement dit, pour  *\<nomfonction >* au lieu de  *\<nomfonction > ()* .</span><span class="sxs-lookup"><span data-stu-id="79489-149">That is, to *\<functionName>* instead of *\<functionName>()*.</span></span>

#### <a name="dbnewinstanceexpression"></a><span data-ttu-id="79489-150">DbNewInstanceExpression</span><span class="sxs-lookup"><span data-stu-id="79489-150">DbNewInstanceExpression</span></span>

<span data-ttu-id="79489-151">DbNewInstanceExpression peut se produire uniquement dans les deux cas suivants :</span><span class="sxs-lookup"><span data-stu-id="79489-151">DbNewInstanceExpression can only occur in the following two cases:</span></span>

- <span data-ttu-id="79489-152">En tant que propriété Projection de DbProjectExpression.</span><span class="sxs-lookup"><span data-stu-id="79489-152">As the Projection property of DbProjectExpression.</span></span>  <span data-ttu-id="79489-153">Dans ce cas d'utilisation, les limitations suivantes s'appliquent :</span><span class="sxs-lookup"><span data-stu-id="79489-153">When used as such the following restrictions apply:</span></span>

  - <span data-ttu-id="79489-154">Le type de résultat doit être un type de ligne.</span><span class="sxs-lookup"><span data-stu-id="79489-154">The result type must be a row type.</span></span>

  - <span data-ttu-id="79489-155">Chacun de ses arguments est une expression qui produit un résultat avec un type primitif.</span><span class="sxs-lookup"><span data-stu-id="79489-155">Each of its arguments is an expression that produces a result with a primitive type.</span></span> <span data-ttu-id="79489-156">En général, chaque argument est une expression scalaire, comme un PropertyExpression sur un DbVariableReferenceExpression, un appel de fonction ou un calcul arithmétique de DbPropertyExpression sur un DbVariableReferenceExpression ou un appel de fonction.</span><span class="sxs-lookup"><span data-stu-id="79489-156">Typically, each argument is a scalar expression, like a PropertyExpression over a DbVariableReferenceExpression, a function invocation, or an arithmetic computation of the DbPropertyExpression over a DbVariableReferenceExpression or a function invocation.</span></span> <span data-ttu-id="79489-157">Toutefois, une expression qui représente une sous-requête scalaire peut également se produire dans la liste d'arguments pour un DbNewInstanceExpression.</span><span class="sxs-lookup"><span data-stu-id="79489-157">However, an expression representing a scalar subquery can also occur in the list of arguments for a DbNewInstanceExpression.</span></span> <span data-ttu-id="79489-158">Une expression qui représente une sous-requête scalaire est une arborescence d’expression qui représente une sous-requête qui retourne exactement une ligne et une colonne d’un type primitif avec une racine d’objet DbElementExpression</span><span class="sxs-lookup"><span data-stu-id="79489-158">An expression that represents a scalar subquery is an expression tree that represents a subquery that returns exactly one row and one column of a primitive type with a DbElementExpression object root</span></span>

- <span data-ttu-id="79489-159">Avec un type de retour de collection, auquel cas il définit une nouvelle collection des expressions fournies comme arguments.</span><span class="sxs-lookup"><span data-stu-id="79489-159">With a collection return type, in which case it defines a new collection of the expressions provided as arguments.</span></span>

#### <a name="dbvariablereferenceexpression"></a><span data-ttu-id="79489-160">DbVariableReferenceExpression</span><span class="sxs-lookup"><span data-stu-id="79489-160">DbVariableReferenceExpression</span></span>

<span data-ttu-id="79489-161">Un DbVariableReferenceExpression doit être l'enfant d'un nœud DbPropertyExpression.</span><span class="sxs-lookup"><span data-stu-id="79489-161">A DbVariableReferenceExpression has to be a child of DbPropertyExpression node.</span></span>

#### <a name="dbgroupbyexpression"></a><span data-ttu-id="79489-162">DbGroupByExpression</span><span class="sxs-lookup"><span data-stu-id="79489-162">DbGroupByExpression</span></span>

<span data-ttu-id="79489-163">La propriété Aggregates d'un DbGroupByExpression peut avoir uniquement des éléments de type DbFunctionAggregate.</span><span class="sxs-lookup"><span data-stu-id="79489-163">The Aggregates property of a DbGroupByExpression can only have elements of type DbFunctionAggregate.</span></span> <span data-ttu-id="79489-164">Il n'existe pas d'autres types d'agrégation.</span><span class="sxs-lookup"><span data-stu-id="79489-164">There are no other aggregate types.</span></span>

#### <a name="dblimitexpression"></a><span data-ttu-id="79489-165">DbLimitExpression</span><span class="sxs-lookup"><span data-stu-id="79489-165">DbLimitExpression</span></span>

<span data-ttu-id="79489-166">La propriété Limit peut être uniquement un DbConstantExpression ou un DbParameterReferenceExpression.</span><span class="sxs-lookup"><span data-stu-id="79489-166">The property Limit can only be a DbConstantExpression or a DbParameterReferenceExpression.</span></span> <span data-ttu-id="79489-167">De plus, la propriété WithTies a toujours la valeur False à partir de la version 3.5 du .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="79489-167">Also property WithTies is always false as of version 3.5 of the .NET Framework.</span></span>

#### <a name="dbscanexpression"></a><span data-ttu-id="79489-168">DbScanExpression</span><span class="sxs-lookup"><span data-stu-id="79489-168">DbScanExpression</span></span>

<span data-ttu-id="79489-169">Lorsqu’il est utilisé dans les arborescences de commandes de sortie, DbScanExpression représente efficacement une analyse sur une table, une vue ou une requête de magasin, représentée par EntitySetBase :: target.</span><span class="sxs-lookup"><span data-stu-id="79489-169">When used in output command trees, the DbScanExpression effectively represents a scan over a table, a view, or a store query, represented by EntitySetBase::Target.</span></span>

<span data-ttu-id="79489-170">Si la propriété de métadonnées « définition de la requête » de la cible n’est pas null, elle représente une requête, le texte de requête pour lequel est fourni dans cette propriété de métadonnées dans le langage spécifique du fournisseur (ou le dialecte) tel que spécifié dans la définition de schéma du magasin.</span><span class="sxs-lookup"><span data-stu-id="79489-170">If the metadata property "Defining Query" of the target is non-null, then it represents a query, the query text for which is provided in that metadata property in the provider’s specific language (or dialect) as specified in the store schema definition.</span></span>

<span data-ttu-id="79489-171">Sinon, la cible représente une table ou une vue.</span><span class="sxs-lookup"><span data-stu-id="79489-171">Otherwise, the target represents a table or a view.</span></span> <span data-ttu-id="79489-172">Son préfixe de schéma est soit dans la propriété de métadonnées « Schema », si elle n’est pas null, soit le nom du conteneur d’entités.</span><span class="sxs-lookup"><span data-stu-id="79489-172">Its schema prefix is either in the "Schema" metadata property, if not null, otherwise is the entity container name.</span></span>  <span data-ttu-id="79489-173">Le nom de la table ou de la vue est la propriété de métadonnées « table », si elle n’est pas null, sinon la propriété Name de la base du jeu d’entités.</span><span class="sxs-lookup"><span data-stu-id="79489-173">The table or view name is either the "Table" metadata property, if not null, otherwise the Name property of the entity set base.</span></span>

<span data-ttu-id="79489-174">Toutes ces propriétés proviennent de la définition de l'EntitySet correspondant dans le fichier de définition de schéma du magasin (SSDL).</span><span class="sxs-lookup"><span data-stu-id="79489-174">All these properties originate from the definition of the corresponding EntitySet in the store schema definition file (the SSDL).</span></span>

### <a name="using-primitive-types"></a><span data-ttu-id="79489-175">Utilisation de types primitifs</span><span class="sxs-lookup"><span data-stu-id="79489-175">Using Primitive Types</span></span>

<span data-ttu-id="79489-176">Lorsque les types primitifs sont référencés dans les arborescences de commandes de sortie, ils sont en général référencés dans les types primitifs du modèle conceptuel.</span><span class="sxs-lookup"><span data-stu-id="79489-176">When primitive types are referenced in output command trees, they are typically referenced in the conceptual model's primitive types.</span></span> <span data-ttu-id="79489-177">Toutefois, pour certaines expressions, les fournisseurs ont besoin du type primitif du magasin correspondant.</span><span class="sxs-lookup"><span data-stu-id="79489-177">However, for certain expressions, providers need the corresponding store primitive type.</span></span> <span data-ttu-id="79489-178">Les exemples de telles expressions sont notamment DbCastExpression et éventuellement DbNullExpression, si le fournisseur doit effectuer un cast de la valeur Null vers le type correspondant.</span><span class="sxs-lookup"><span data-stu-id="79489-178">Examples of such expressions include DbCastExpression and possibly DbNullExpression, if the provider needs to cast the null to the corresponding type.</span></span> <span data-ttu-id="79489-179">Dans ces cas, les fournisseurs doivent effectuer le mappage au type de fournisseur selon le type du type primitif et ses facettes.</span><span class="sxs-lookup"><span data-stu-id="79489-179">In these cases, providers should do the mapping to the provider type based on the primitive type kind and its facets.</span></span>

## <a name="see-also"></a><span data-ttu-id="79489-180">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="79489-180">See also</span></span>

- [<span data-ttu-id="79489-181">Génération SQL</span><span class="sxs-lookup"><span data-stu-id="79489-181">SQL Generation</span></span>](sql-generation.md)

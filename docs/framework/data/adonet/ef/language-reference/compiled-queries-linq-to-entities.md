---
title: Requêtes compilées (LINQ to Entities)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 8025ba1d-29c7-4407-841b-d5a3bed40b7a
ms.openlocfilehash: b8bed63cda505ad8c26c9c69d880a077053b8d2e
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/24/2020
ms.locfileid: "91153051"
---
# <a name="compiled-queries--linq-to-entities"></a><span data-ttu-id="61077-102">Requêtes compilées (LINQ to Entities)</span><span class="sxs-lookup"><span data-stu-id="61077-102">Compiled queries  (LINQ to Entities)</span></span>

<span data-ttu-id="61077-103">Lorsque vous possédez une application qui exécute de nombreuses fois des requêtes similaires d’un point de vue structurel dans Entity Framework, vous pouvez souvent améliorer les performances en compilant la requête une fois et en l’exécutant plusieurs fois avec des paramètres différents.</span><span class="sxs-lookup"><span data-stu-id="61077-103">When you have an application that executes structurally similar queries many times in the Entity Framework, you can frequently increase performance by compiling the query one time and executing it several times with different parameters.</span></span> <span data-ttu-id="61077-104">Par exemple, une application peut avoir besoin de récupérer tous les clients d'une ville spécifique ; la ville est spécifiée à l'exécution par l'utilisateur dans un formulaire.</span><span class="sxs-lookup"><span data-stu-id="61077-104">For example, an application might have to retrieve all the customers in a particular city; the city is specified at runtime by the user in a form.</span></span> <span data-ttu-id="61077-105">À cette fin, LINQ to Entities prend en charge l'utilisation des requêtes compilées.</span><span class="sxs-lookup"><span data-stu-id="61077-105">LINQ to Entities supports using compiled queries for this purpose.</span></span>  
  
 <span data-ttu-id="61077-106">À compter de .NET Framework 4,5, les requêtes LINQ sont automatiquement mises en cache.</span><span class="sxs-lookup"><span data-stu-id="61077-106">Starting with .NET Framework 4.5, LINQ queries are cached automatically.</span></span> <span data-ttu-id="61077-107">Cependant, vous pouvez toujours utiliser des requêtes LINQ compilées pour réduire ce coût dans les exécutions ultérieures et les requêtes compilées peuvent être plus efficaces que les requêtes LINQ qui sont automatiquement mises en cache.</span><span class="sxs-lookup"><span data-stu-id="61077-107">However, you can still use compiled LINQ queries to reduce this cost in later executions and compiled queries can be more efficient than LINQ queries that are automatically cached.</span></span> <span data-ttu-id="61077-108">LINQ to Entities les requêtes qui appliquent l' `Enumerable.Contains` opérateur aux collections en mémoire ne sont pas automatiquement mises en cache.</span><span class="sxs-lookup"><span data-stu-id="61077-108">LINQ to Entities queries that apply the `Enumerable.Contains` operator to in-memory collections are not automatically cached.</span></span> <span data-ttu-id="61077-109">En outre, le paramétrage des collections en mémoire dans les requêtes LINQ compilées n’est pas autorisé.</span><span class="sxs-lookup"><span data-stu-id="61077-109">Also, parameterizing in-memory collections in compiled LINQ queries is not allowed.</span></span>  
  
 <span data-ttu-id="61077-110">La classe <xref:System.Data.Objects.CompiledQuery> permet la compilation et la mise en cache des requêtes en vue de leur réutilisation.</span><span class="sxs-lookup"><span data-stu-id="61077-110">The <xref:System.Data.Objects.CompiledQuery> class provides compilation and caching of queries for reuse.</span></span> <span data-ttu-id="61077-111">Conceptuellement, cette classe contient une méthode <xref:System.Data.Objects.CompiledQuery>'s `Compile` avec plusieurs surcharges.</span><span class="sxs-lookup"><span data-stu-id="61077-111">Conceptually, this class contains a <xref:System.Data.Objects.CompiledQuery>'s `Compile` method with several overloads.</span></span> <span data-ttu-id="61077-112">Appelez la méthode `Compile` pour créer un nouveau délégué pour représenter la requête compilée.</span><span class="sxs-lookup"><span data-stu-id="61077-112">Call the `Compile` method to create a new delegate to represent the compiled query.</span></span> <span data-ttu-id="61077-113">Les méthodes `Compile`, fournies avec un objet <xref:System.Data.Objects.ObjectContext> et des valeurs de paramètres, retournent un délégué qui produit un résultat (tel qu'une instance de <xref:System.Linq.IQueryable%601>).</span><span class="sxs-lookup"><span data-stu-id="61077-113">The `Compile` methods, provided with a <xref:System.Data.Objects.ObjectContext> and parameter values, return a delegate that produces some result (such as an <xref:System.Linq.IQueryable%601> instance).</span></span> <span data-ttu-id="61077-114">La requête compile une fois durant la première exécution uniquement.</span><span class="sxs-lookup"><span data-stu-id="61077-114">The query compiles once during only the first execution.</span></span> <span data-ttu-id="61077-115">Les options de fusion définies pour la requête au moment de la compilation ne peuvent pas être modifiées ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="61077-115">The merge options set for the query at the time of the compilation cannot be changed later.</span></span> <span data-ttu-id="61077-116">Une fois la requête compilée, vous pouvez uniquement fournir des paramètres de type primitif, mais vous ne pouvez pas remplacer des parties de la requête qui modifieraient le SQL généré.</span><span class="sxs-lookup"><span data-stu-id="61077-116">Once the query is compiled, you can only supply parameters of primitive type but you cannot replace parts of the query that would change the generated SQL.</span></span> <span data-ttu-id="61077-117">Pour plus d’informations, consultez [options de fusion EF et requêtes compilées](/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries).</span><span class="sxs-lookup"><span data-stu-id="61077-117">For more information, see [EF Merge Options and Compiled Queries](/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries).</span></span>
  
 <span data-ttu-id="61077-118">L’expression de requête LINQ to Entities que <xref:System.Data.Objects.CompiledQuery> la `Compile` méthode Compile est représentée par l’un des `Func` délégués génériques, tels que <xref:System.Func%605> .</span><span class="sxs-lookup"><span data-stu-id="61077-118">The LINQ to Entities query expression that the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method compiles is represented by one of the generic `Func` delegates, such as <xref:System.Func%605>.</span></span> <span data-ttu-id="61077-119">Au maximum, l'expression de requête peut encapsuler un paramètre `ObjectContext`, un paramètre de retour et seize paramètres de requête.</span><span class="sxs-lookup"><span data-stu-id="61077-119">At most, the query expression can encapsulate an `ObjectContext` parameter, a return parameter, and 16 query parameters.</span></span> <span data-ttu-id="61077-120">Si plus de seize paramètres de requête sont requis, vous pouvez créer une structure dont les propriétés représentent des paramètres de requête.</span><span class="sxs-lookup"><span data-stu-id="61077-120">If more than 16 query parameters are required, you can create a structure whose properties represent query parameters.</span></span> <span data-ttu-id="61077-121">Vous pouvez alors utiliser les propriétés sur la structure dans l'expression de requête une fois les propriétés définies.</span><span class="sxs-lookup"><span data-stu-id="61077-121">You can then use the properties on the structure in the query expression after you set the properties.</span></span>  
  
## <a name="example-1"></a><span data-ttu-id="61077-122">Exemple 1</span><span class="sxs-lookup"><span data-stu-id="61077-122">Example 1</span></span>  

 <span data-ttu-id="61077-123">L'exemple suivant compile puis appelle une requête qui accepte un paramètre d'entrée <xref:System.Decimal> et retourne une séquence de commandes où le montant total dû est supérieur à 200,00 $ :</span><span class="sxs-lookup"><span data-stu-id="61077-123">The following example compiles and then invokes a query that accepts a <xref:System.Decimal> input parameter and returns a sequence of orders where the total due is greater than or equal to $200.00:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query 2](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery2)]
 [!code-vb[DP L2E Conceptual Examples - compiled query2](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery2)]  
  
## <a name="example-2"></a><span data-ttu-id="61077-124">Exemple 2</span><span class="sxs-lookup"><span data-stu-id="61077-124">Example 2</span></span>  

 <span data-ttu-id="61077-125">L'exemple suivant compile puis appelle une requête qui retourne une instance de <xref:System.Data.Objects.ObjectQuery%601> :</span><span class="sxs-lookup"><span data-stu-id="61077-125">The following example compiles and then invokes a query that returns an <xref:System.Data.Objects.ObjectQuery%601> instance:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query1_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery1_mq)]
 [!code-vb[DP L2E Conceptual Examples - compiled query1_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery1_mq)]  
  
## <a name="example-3"></a><span data-ttu-id="61077-126">Exemple 3</span><span class="sxs-lookup"><span data-stu-id="61077-126">Example 3</span></span>  

 <span data-ttu-id="61077-127">L'exemple suivant compile puis appelle une requête qui retourne la moyenne des prix courants des produits sous la forme d'une valeur <xref:System.Decimal> :</span><span class="sxs-lookup"><span data-stu-id="61077-127">The following example compiles and then invokes a query that returns the average of the product list prices as a <xref:System.Decimal> value:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query3_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery3_mq)]
 [!code-vb[DP L2E Conceptual Examples - compiled query3_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery3_mq)]  
  
## <a name="example-4"></a><span data-ttu-id="61077-128">Exemple 4</span><span class="sxs-lookup"><span data-stu-id="61077-128">Example 4</span></span>  

 <span data-ttu-id="61077-129">L’exemple suivant compile puis appelle une requête qui accepte un <xref:System.String> paramètre d’entrée, puis retourne une `Contact` dont l’adresse de messagerie commence par la chaîne spécifiée :</span><span class="sxs-lookup"><span data-stu-id="61077-129">The following example compiles and then invokes a query that accepts a <xref:System.String> input parameter and then returns a `Contact` whose email address starts with the specified string:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query4_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery4_mq)]
 [!code-vb[DP L2E Conceptual Examples - compiled query4_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery4_mq)]  
  
## <a name="example-5"></a><span data-ttu-id="61077-130">Exemple 5</span><span class="sxs-lookup"><span data-stu-id="61077-130">Example 5</span></span>  

 <span data-ttu-id="61077-131">L'exemple suivant compile puis appelle une requête qui accepte les paramètres d'entrée <xref:System.DateTime> et <xref:System.Decimal> et retourne une séquence de commandes où la date de commande est ultérieure au 8 mars 2003 et le montant total dû est inférieur à 300,00 $ :</span><span class="sxs-lookup"><span data-stu-id="61077-131">The following example compiles and then invokes a query that accepts <xref:System.DateTime> and <xref:System.Decimal> input parameters and returns a sequence of orders where the order date is later than March 8, 2003, and the total due is less than $300.00:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query5](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery5)]
 [!code-vb[DP L2E Conceptual Examples - compiled query5](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery5)]  
  
## <a name="example-6"></a><span data-ttu-id="61077-132">Exemple 6</span><span class="sxs-lookup"><span data-stu-id="61077-132">Example 6</span></span>  

 <span data-ttu-id="61077-133">L'exemple suivant compile puis appelle une requête qui accepte un paramètre d'entrée <xref:System.DateTime> et retourne une séquence de commandes dont la date de commande est postérieure au 8 mars 2004.</span><span class="sxs-lookup"><span data-stu-id="61077-133">The following example compiles and then invokes a query that accepts a <xref:System.DateTime> input parameter and returns a sequence of orders where the order date is later than March 8, 2004.</span></span> <span data-ttu-id="61077-134">Cette requête retourne les informations de commande sous la forme d'une séquence de types anonymes.</span><span class="sxs-lookup"><span data-stu-id="61077-134">This query returns the order information as a sequence of anonymous types.</span></span> <span data-ttu-id="61077-135">Les types anonymes sont déduits par le compilateur, si bien que vous ne pouvez pas spécifier les paramètres de type dans la méthode <xref:System.Data.Objects.CompiledQuery> de `Compile` et le type est défini dans la requête elle-même.</span><span class="sxs-lookup"><span data-stu-id="61077-135">Anonymous types are inferred by the compiler, so you cannot specify type parameters in the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method and the type is defined in the query itself.</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery6)]
 [!code-vb[DP L2E Conceptual Examples - compiled query6](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery6)]  
  
## <a name="example-7"></a><span data-ttu-id="61077-136">Exemple 7</span><span class="sxs-lookup"><span data-stu-id="61077-136">Example 7</span></span>  

 <span data-ttu-id="61077-137">L'exemple suivant compile puis appelle une requête qui accepte un paramètre d'entrée de la structure définie par l'utilisateur, puis retourne une séquence de commandes.</span><span class="sxs-lookup"><span data-stu-id="61077-137">The following example compiles and then invokes a query that accepts a user-defined structure input parameter and returns a sequence of orders.</span></span> <span data-ttu-id="61077-138">La structure définit les paramètres de requête de date de début, de date de fin et de montant total dû, et la requête retourne les commandes expédiées entre le 3 mars et le 8 mars 2003 dont le montant total dû est supérieur à 700,00 $.</span><span class="sxs-lookup"><span data-stu-id="61077-138">The structure defines start date, end date, and total due query parameters, and the query returns orders shipped between March 3 and March 8, 2003 with a total due greater than $700.00.</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query7](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery7)]
 [!code-vb[DP L2E Conceptual Examples - compiled query7](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery7)]  
  
 <span data-ttu-id="61077-139">La structure qui définit les paramètres de requête :</span><span class="sxs-lookup"><span data-stu-id="61077-139">The structure that defines the query parameters:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - MyParamsStruct](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#myparamsstruct)]
 [!code-vb[DP L2E Conceptual Examples - MyParamsStruct](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#myparamsstruct)]  
  
## <a name="see-also"></a><span data-ttu-id="61077-140">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="61077-140">See also</span></span>

- [<span data-ttu-id="61077-141">ADO.NET Entity Framework</span><span class="sxs-lookup"><span data-stu-id="61077-141">ADO.NET Entity Framework</span></span>](../index.md)
- [<span data-ttu-id="61077-142">LINQ to Entities</span><span class="sxs-lookup"><span data-stu-id="61077-142">LINQ to Entities</span></span>](linq-to-entities.md)
- [<span data-ttu-id="61077-143">Options de fusion EF et requêtes compilées</span><span class="sxs-lookup"><span data-stu-id="61077-143">EF Merge Options and Compiled Queries</span></span>](/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries)

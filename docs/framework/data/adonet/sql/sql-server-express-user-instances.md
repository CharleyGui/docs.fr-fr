---
title: Instances utilisateur SQL Server Express
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 00c12376-cb26-4317-86ad-e6e9c089be57
ms.openlocfilehash: fabd9b94b8c0a3f0e0db220e84d6c2eca3537c50
ms.sourcegitcommit: 5ae5a1a9520b8b8b6164ad728d396717f30edafc
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/11/2019
ms.locfileid: "70894421"
---
# <a name="sql-server-express-user-instances"></a><span data-ttu-id="17fc6-102">Instances utilisateur SQL Server Express</span><span class="sxs-lookup"><span data-stu-id="17fc6-102">SQL Server Express User Instances</span></span>
<span data-ttu-id="17fc6-103">Microsoft SQL Server Express Edition (SQL Server Express) prend en charge une nouvelle fonctionnalité, l’instance utilisateur, disponible uniquement avec le fournisseur de données .NET Framework pour SQL Server (`SqlClient`).</span><span class="sxs-lookup"><span data-stu-id="17fc6-103">Microsoft SQL Server Express Edition (SQL Server Express) supports the user instance feature, which is only available when using the .NET Framework Data Provider for SQL Server (`SqlClient`).</span></span> <span data-ttu-id="17fc6-104">Une instance utilisateur est une instance séparée du moteur de base de données SQL Server Express qui est générée par une instance parente.</span><span class="sxs-lookup"><span data-stu-id="17fc6-104">A user instance is a separate instance of the SQL Server Express Database Engine that is generated by a parent instance.</span></span> <span data-ttu-id="17fc6-105">Les instances utilisateur permettent aux utilisateurs qui ne sont pas des administrateurs système sur leur ordinateur local de s'attacher et de se connecter aux bases de données SQL Server Express.</span><span class="sxs-lookup"><span data-stu-id="17fc6-105">User instances allow users who are not administrators on their local computers to attach and connect to SQL Server Express databases.</span></span> <span data-ttu-id="17fc6-106">Chaque instance s'exécute dans le contexte de sécurité de l'utilisateur individuel, sur la base d'une instance par utilisateur.</span><span class="sxs-lookup"><span data-stu-id="17fc6-106">Each instance runs under the security context of the individual user, on a one-instance-per-user basis.</span></span>  
  
## <a name="user-instance-capabilities"></a><span data-ttu-id="17fc6-107">Fonctionnalités de l'instance utilisateur</span><span class="sxs-lookup"><span data-stu-id="17fc6-107">User Instance Capabilities</span></span>  
 <span data-ttu-id="17fc6-108">Les instances utilisateur sont utiles aux utilisateurs qui exécutent Windows sous un compte avec les privilèges minimum (LUA) car elles leur permettent d'exécuter des privilèges (`sysadmin`) d'administrateur système SQL Server sur l'instance de leur ordinateur sans avoir à s'exécuter également en tant qu'administrateur Windows.</span><span class="sxs-lookup"><span data-stu-id="17fc6-108">User instances are useful for users who are running Windows under a least-privilege user account (LUA) because each user has SQL Server system administrator (`sysadmin`) privileges over the instance running on her computer without needing to run as a Windows administrator as well.</span></span> <span data-ttu-id="17fc6-109">Les logiciels qui s'exécutent sur une instance utilisateur avec des autorisations limitées ne peuvent pas effectuer de modifications au niveau du système parce que l'instance de SQL Server Express s'exécute sous le compte Windows non-administrateur de l'utilisateur, pas en tant que service.</span><span class="sxs-lookup"><span data-stu-id="17fc6-109">Software executing on a user instance with limited permissions cannot make system-wide changes because the instance of SQL Server Express is running under the non-administrator Windows account of the user, not as a service.</span></span> <span data-ttu-id="17fc6-110">Chaque instance utilisateur est isolée de son instance parente et des autres instances utilisateur en cours d'exécution sur le même ordinateur.</span><span class="sxs-lookup"><span data-stu-id="17fc6-110">Each user instance is isolated from its parent instance and from any other user instances running on the same computer.</span></span> <span data-ttu-id="17fc6-111">Les bases de données qui s'exécutent sur une instance utilisateur sont ouvertes en mode mono-utilisateur uniquement ; plusieurs utilisateurs ne peuvent pas se connecter à ces bases de données.</span><span class="sxs-lookup"><span data-stu-id="17fc6-111">Databases running on a user instance are opened in single-user mode only, and it is not possible for multiple users to connect to databases running on a user instance.</span></span> <span data-ttu-id="17fc6-112">La réplication et les requêtes distribuées sont également désactivées pour les instances utilisateur.</span><span class="sxs-lookup"><span data-stu-id="17fc6-112">Replication and distributed queries are also disabled for user instances.</span></span>  
  
 <span data-ttu-id="17fc6-113">Pour plus d'informations, voir « Instances utilisateur » dans la documentation en ligne de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="17fc6-113">For more information, see "User Instances" in SQL Server Books Online.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="17fc6-114">Les instances utilisateur ne sont pas nécessaires pour les utilisateurs qui sont déjà administrateurs sur leur propre ordinateur ou pour les scénarios qui impliquent plusieurs utilisateurs de base de données.</span><span class="sxs-lookup"><span data-stu-id="17fc6-114">User instances are not needed for users who are already administrators on their own computers, or for scenarios involving multiple database users.</span></span>  
  
## <a name="enabling-user-instances"></a><span data-ttu-id="17fc6-115">Activation des instances utilisateur</span><span class="sxs-lookup"><span data-stu-id="17fc6-115">Enabling User Instances</span></span>  
 <span data-ttu-id="17fc6-116">Pour générer des instances utilisateur, une instance parente de SQL Server Express doit être en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="17fc6-116">To generate user instances, a parent instance of SQL Server Express must be running.</span></span> <span data-ttu-id="17fc6-117">Les instances utilisateur sont activées par défaut lors de l’installation de SQL Server Express, et elles peuvent être activées ou désactivées de manière explicite par un administrateur système qui exécute la procédure stockée système **sp_configure** sur l’instance parente.</span><span class="sxs-lookup"><span data-stu-id="17fc6-117">User instances are enabled by default when SQL Server Express is installed, and they can be explicitly enabled or disabled by a system administrator executing the **sp_configure** system stored procedure on the parent instance.</span></span>  
  
```sql  
-- Enable user instances.  
sp_configure 'user instances enabled','1'
  
-- Disable user instances.  
sp_configure 'user instances enabled','0'  
```  
  
 <span data-ttu-id="17fc6-118">Le protocole réseau pour les instances utilisateur doit être canaux nommés locaux.</span><span class="sxs-lookup"><span data-stu-id="17fc6-118">The network protocol for user instances must be local Named Pipes.</span></span> <span data-ttu-id="17fc6-119">Une instance utilisateur ne peut pas être démarrée sur une instance distante de SQL Server et les connexions SQL Server ne sont pas autorisées.</span><span class="sxs-lookup"><span data-stu-id="17fc6-119">A user instance cannot be started on a remote instance of SQL Server, and SQL Server logins are not allowed.</span></span>  
  
## <a name="connecting-to-a-user-instance"></a><span data-ttu-id="17fc6-120">Connexion à une instance utilisateur</span><span class="sxs-lookup"><span data-stu-id="17fc6-120">Connecting to a User Instance</span></span>  
 <span data-ttu-id="17fc6-121">Les `User Instance` mots `AttachDBFilename` clés et <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A> permettent <xref:System.Data.SqlClient.SqlConnection> à un de se connecter à une instance utilisateur.</span><span class="sxs-lookup"><span data-stu-id="17fc6-121">The `User Instance` and `AttachDBFilename`<xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A> keywords allow a <xref:System.Data.SqlClient.SqlConnection> to connect to a user instance.</span></span> <span data-ttu-id="17fc6-122">Les instances utilisateur sont également prises en charge par les propriétés <xref:System.Data.SqlClient.SqlConnectionStringBuilder>`UserInstance` et `AttachDBFilename`.</span><span class="sxs-lookup"><span data-stu-id="17fc6-122">User instances are also supported by the <xref:System.Data.SqlClient.SqlConnectionStringBuilder>`UserInstance` and `AttachDBFilename` properties.</span></span>  
  
 <span data-ttu-id="17fc6-123">Notez les éléments suivants sur l'exemple de chaîne de connexion ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="17fc6-123">Note the following about the sample connection string shown below:</span></span>  
  
- <span data-ttu-id="17fc6-124">Le mot clé `Data Source` fait référence à l'instance parente de SQL Server Express qui génère l'instance utilisateur.</span><span class="sxs-lookup"><span data-stu-id="17fc6-124">The `Data Source` keyword refers to the parent instance of SQL Server Express that is generating the user instance.</span></span> <span data-ttu-id="17fc6-125">L'instance par défaut est .\sqlexpress.</span><span class="sxs-lookup"><span data-stu-id="17fc6-125">The default instance is .\sqlexpress.</span></span>  
  
- <span data-ttu-id="17fc6-126">`Integrated Security` a la valeur `true`.</span><span class="sxs-lookup"><span data-stu-id="17fc6-126">`Integrated Security` is set to `true`.</span></span> <span data-ttu-id="17fc6-127">Pour vous connecter à une instance utilisateur, l'authentification Windows est nécessaire ; les connexions SQL Server ne sont pas prises en charge.</span><span class="sxs-lookup"><span data-stu-id="17fc6-127">To connect to a user instance, Windows Authentication is required; SQL Server logins are not supported.</span></span>  
  
- <span data-ttu-id="17fc6-128">`User Instance` a la valeur `true` qui appelle une instance utilisateur.</span><span class="sxs-lookup"><span data-stu-id="17fc6-128">The `User Instance` is set to `true`, which invokes a user instance.</span></span> <span data-ttu-id="17fc6-129">(La valeur par défaut est `false`).</span><span class="sxs-lookup"><span data-stu-id="17fc6-129">(The default is `false`.)</span></span>  
  
- <span data-ttu-id="17fc6-130">Le mot clé de la chaîne de connexion `AttachDbFileName` est utilisé pour joindre le fichier (.mdf) de base de données primaire, qui doit inclure le chemin d’accès complet.</span><span class="sxs-lookup"><span data-stu-id="17fc6-130">The `AttachDbFileName` connection string keyword is used to attach the primary database file (.mdf), which must include the full path name.</span></span> <span data-ttu-id="17fc6-131">`AttachDbFileName` correspond aussi aux clés « extended properties » et « initial file name » dans une chaîne de connexion <xref:System.Data.SqlClient.SqlConnection>.</span><span class="sxs-lookup"><span data-stu-id="17fc6-131">`AttachDbFileName` also corresponds to the "extended properties" and "initial file name" keys within a <xref:System.Data.SqlClient.SqlConnection> connection string.</span></span>  
  
- <span data-ttu-id="17fc6-132">La chaîne de substitution `|DataDirectory|` placée entre deux barres verticales fait référence au répertoire des données de l'application qui ouvre la connexion et fournit un chemin d'accès relatif à l'emplacement des fichiers journaux et de base de données .mdf et .ldf.</span><span class="sxs-lookup"><span data-stu-id="17fc6-132">The `|DataDirectory|` substitution string enclosed in the pipe symbols refers to the data directory of the application opening the connection and provides a relative path indicating the location of the .mdf and .ldf database and log files.</span></span> <span data-ttu-id="17fc6-133">Si vous souhaitez placer ces fichiers ailleurs, vous devez indiquer le chemin d’accès complet des fichiers.</span><span class="sxs-lookup"><span data-stu-id="17fc6-133">If you want to locate these files elsewhere, you must provide the full path to the files.</span></span>  
  
```text
Data Source=.\\SQLExpress;Integrated Security=true;  
User Instance=true;AttachDBFilename=|DataDirectory|\InstanceDB.mdf;  
Initial Catalog=InstanceDB;  
```  
  
> [!NOTE]
> <span data-ttu-id="17fc6-134">Vous pouvez également utiliser les propriétés <xref:System.Data.SqlClient.SqlConnectionStringBuilder><xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserInstance%2A> et <xref:System.Data.SqlClient.SqlConnectionStringBuilder.AttachDBFilename%2A> pour créer une chaîne de connexion au moment de l'exécution.</span><span class="sxs-lookup"><span data-stu-id="17fc6-134">You can also use the <xref:System.Data.SqlClient.SqlConnectionStringBuilder><xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserInstance%2A> and <xref:System.Data.SqlClient.SqlConnectionStringBuilder.AttachDBFilename%2A> properties to build a connection string at run time.</span></span>  
  
### <a name="using-the-124datadirectory124-substitution-string"></a><span data-ttu-id="17fc6-135">Utilisation de &#124;la&#124; chaîne de substitution DataDirectory</span><span class="sxs-lookup"><span data-stu-id="17fc6-135">Using the &#124;DataDirectory&#124; Substitution String</span></span>  
 <span data-ttu-id="17fc6-136">`AttachDbFileName` a été étendu dans ADO.NET 2.0 avec l'introduction de la chaîne de substitution `|DataDirectory|` (dans les symboles de barre verticale).</span><span class="sxs-lookup"><span data-stu-id="17fc6-136">`AttachDbFileName` was extended in ADO.NET 2.0 with the introduction of the `|DataDirectory|` (enclosed in pipe symbols) substitution string.</span></span> <span data-ttu-id="17fc6-137">`DataDirectory` est utilisé conjointement à `AttachDbFileName` pour indiquer un chemin d'accès relatif à un fichier de données, ce qui permet aux développeurs de créer des chaînes de connexion basées sur un chemin d'accès relatif à la source de données au lieu de devoir spécifier un chemin d'accès complet.</span><span class="sxs-lookup"><span data-stu-id="17fc6-137">`DataDirectory` is used in conjunction with `AttachDbFileName` to indicate a relative path to a data file, allowing developers to create connection strings that are based on a relative path to the data source instead of being required to specify a full path.</span></span>  
  
 <span data-ttu-id="17fc6-138">L'emplacement physique que désigne `DataDirectory` varie en fonction du type d'application.</span><span class="sxs-lookup"><span data-stu-id="17fc6-138">The physical location that `DataDirectory` points to depends on the type of application.</span></span> <span data-ttu-id="17fc6-139">Dans cet exemple, le fichier Northwind.mdf à joindre se trouve dans le dossier \app_data de l’application.</span><span class="sxs-lookup"><span data-stu-id="17fc6-139">In this example, the Northwind.mdf file to be attached is located in the application's \app_data folder.</span></span>  
  
```text
Data Source=.\\SQLExpress;Integrated Security=true;  
User Instance=true;  
AttachDBFilename=|DataDirectory|\app_data\Northwind.mdf;  
Initial Catalog=Northwind;  
```  
  
 <span data-ttu-id="17fc6-140">Lorsque `DataDirectory` est utilisé, le chemin d’accès du fichier résultant ne peut pas se trouver plus haut dans la structure des répertoires que le répertoire vers lequel pointe la chaîne de substitution.</span><span class="sxs-lookup"><span data-stu-id="17fc6-140">When `DataDirectory` is used, the resulting file path cannot be higher in the directory structure than the directory pointed to by the substitution string.</span></span> <span data-ttu-id="17fc6-141">Par exemple, si le `DataDirectory` complètement étendu est C:\AppDirectory\app_data, la chaîne de connexion dans l'exemple ci-dessus fonctionne car elle est située sous c:\AppDirectory.</span><span class="sxs-lookup"><span data-stu-id="17fc6-141">For example, if the fully expanded `DataDirectory` is C:\AppDirectory\app_data, then the sample connection string shown above works because it is below c:\AppDirectory.</span></span> <span data-ttu-id="17fc6-142">Cependant, si vous tentez de spécifier `DataDirectory` sous la forme de `|DataDirectory|\..\data`, il en résulte une erreur car \data n'est pas un sous-répertoire de \AppDirectory.</span><span class="sxs-lookup"><span data-stu-id="17fc6-142">However, attempting to specify `DataDirectory` as `|DataDirectory|\..\data` will result in an error because \data is not a subdirectory of \AppDirectory.</span></span>  
  
 <span data-ttu-id="17fc6-143">Si la chaîne de connexion a une chaîne de substitution dont la mise en forme est incorrecte, une exception <xref:System.ArgumentException> sera levée.</span><span class="sxs-lookup"><span data-stu-id="17fc6-143">If the connection string has an improperly formatted substitution string, an <xref:System.ArgumentException> will be thrown.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="17fc6-144"><xref:System.Data.SqlClient> résout les chaînes de substitution en chemins d'accès complets sur le système de fichiers de l'ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="17fc6-144"><xref:System.Data.SqlClient> resolves the substitution strings into full paths against the local computer file system.</span></span> <span data-ttu-id="17fc6-145">Par conséquent, les noms de chemin d’accès de serveur distant, HTTP et UNC ne sont pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="17fc6-145">Therefore, remote server, HTTP, and UNC path names are not supported.</span></span> <span data-ttu-id="17fc6-146">Une exception est levée si la connexion est ouverte lorsque le serveur n'est pas situé sur l'ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="17fc6-146">An exception is thrown when the connection is opened if the server is not located on the local computer.</span></span>  
  
 <span data-ttu-id="17fc6-147">Lorsque <xref:System.Data.SqlClient.SqlConnection> est ouvert, il est redirigé depuis l'instance SQL Server Express par défaut vers une instance initiée au moment de l'exécution et qui s'exécute sous le compte de l'appelant.</span><span class="sxs-lookup"><span data-stu-id="17fc6-147">When the <xref:System.Data.SqlClient.SqlConnection> is opened, it is redirected from the default SQL Server Express instance to a run-time initiated instance running under the caller's account.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="17fc6-148">Vous devrez peut-être augmenter la valeur <xref:System.Data.SqlClient.SqlConnection.ConnectionTimeout%2A> car le chargement des instances utilisateur peut nécessiter plus de temps que les instances normales.</span><span class="sxs-lookup"><span data-stu-id="17fc6-148">It may be necessary to increase the <xref:System.Data.SqlClient.SqlConnection.ConnectionTimeout%2A> value since user instances may take longer to load than regular instances.</span></span>  
  
 <span data-ttu-id="17fc6-149">Le fragment de code suivant ouvre une nouvelle `SqlConnection`, affiche la chaîne de connexion dans la fenêtre de console puis ferme la connexion lorsque le bloc de code `using` n'est plus utilisé.</span><span class="sxs-lookup"><span data-stu-id="17fc6-149">The following code fragment opens a new `SqlConnection`, displays the connection string in the console window, and then closes the connection when exiting the `using` code block.</span></span>  
  
```vb  
Private Sub OpenSqlConnection()  
    ' Retrieve the connection string.  
    Dim connectionString As String = GetConnectionString()  
  
    Using connection As New SqlConnection(connectionString)  
        connection.Open()  
        Console.WriteLine("ConnectionString: {0}", _  
           connection.ConnectionString)  
    End Using  
End Sub  
```  
  
```csharp  
private static void OpenSqlConnection()  
{  
    // Retrieve the connection string.  
    string connectionString = GetConnectionString();  
  
    using (SqlConnection connection =   
        new SqlConnection(connectionString))  
    {  
        connection.Open();  
        Console.WriteLine("ConnectionString: {0}",   
             connection.ConnectionString);  
    }  
}  
```  
  
> [!NOTE]
> <span data-ttu-id="17fc6-150">Les instances utilisateur ne sont pas prises en charge par le code CLR (Common Language Runtime) qui s'exécute dans SQL Server.</span><span class="sxs-lookup"><span data-stu-id="17fc6-150">User instances are not supported in common language runtime (CLR) code that is running inside of SQL Server.</span></span> <span data-ttu-id="17fc6-151">Une exception <xref:System.InvalidOperationException> est levée si `Open` est appelé sur une <xref:System.Data.SqlClient.SqlConnection> qui contient `User Instance=true` dans la chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="17fc6-151">An <xref:System.InvalidOperationException> is thrown if `Open` is called on a <xref:System.Data.SqlClient.SqlConnection> that has `User Instance=true` in the connection string.</span></span>  
  
## <a name="lifetime-of-a-user-instance-connection"></a><span data-ttu-id="17fc6-152">Durée de vie d'une connexion à une instance utilisateur</span><span class="sxs-lookup"><span data-stu-id="17fc6-152">Lifetime of a User Instance Connection</span></span>  
 <span data-ttu-id="17fc6-153">Contrairement aux versions SQL Server qui s'exécutent en tant que service, il n'est pas nécessaire de démarrer et d'arrêter manuellement les instances de SQL Server Express.</span><span class="sxs-lookup"><span data-stu-id="17fc6-153">Unlike versions of SQL Server that run as a service, SQL Server Express instances do not need to be manually started and stopped.</span></span> <span data-ttu-id="17fc6-154">Chaque fois qu'un utilisateur ouvre une session et se connecte à une instance utilisateur, celle-ci est démarrée si elle n'est pas déjà en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="17fc6-154">Each time a user logs in and connects to a user instance, the user instance is started if it is not already running.</span></span> <span data-ttu-id="17fc6-155">L'option `AutoClose` des bases de données d'instance utilisateur est définie de telle sorte que la base de données s'arrête automatiquement après une période d'inactivité.</span><span class="sxs-lookup"><span data-stu-id="17fc6-155">User instance databases have the `AutoClose` option set so that the database is automatically shut down after a period of inactivity.</span></span> <span data-ttu-id="17fc6-156">Le processus sqlservr.exe qui est démarré continue de s'exécuter durant une période limitée après la fermeture de la dernière connexion à l'instance. De cette manière, il n'est pas nécessaire de le redémarrer en cas d'ouverture d'une autre connexion avant l'expiration du délai d'attente.</span><span class="sxs-lookup"><span data-stu-id="17fc6-156">The sqlservr.exe process that is started is kept running for a limited time-out period after the last connection to the instance is closed, so it does not need to be restarted if another connection is opened before the time-out has expired.</span></span> <span data-ttu-id="17fc6-157">L'instance utilisateur s'arrête automatiquement si aucune nouvelle connexion ne s'ouvre avant l'expiration de cette période de délai d'attente.</span><span class="sxs-lookup"><span data-stu-id="17fc6-157">The user instance automatically shuts down if no new connection opens before that time-out period has expired.</span></span> <span data-ttu-id="17fc6-158">Un administrateur système sur l’instance parente peut définir la durée du délai d’attente pour une instance utilisateur à l’aide de **sp_configure** pour modifier l’option délai d’expiration de l' **instance utilisateur** .</span><span class="sxs-lookup"><span data-stu-id="17fc6-158">A system administrator on the parent instance can set the duration of the time-out period for a user instance by using **sp_configure** to change the **user instance timeout** option.</span></span> <span data-ttu-id="17fc6-159">La valeur par défaut est 60 minutes.</span><span class="sxs-lookup"><span data-stu-id="17fc6-159">The default is 60 minutes.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="17fc6-160">Si `Min Pool Size` est utilisé dans la chaîne de connexion avec une valeur supérieure à zéro, le dispositif de regroupement maintient toujours quelques connexions ouvertes pour ne pas que l'instance utilisateur ne se ferme automatiquement.</span><span class="sxs-lookup"><span data-stu-id="17fc6-160">If `Min Pool Size` is used in the connection string with a value greater than zero, the connection pooler will always maintain a few opened connections, and the user instance will not automatically shut down.</span></span>  
  
## <a name="how-user-instances-work"></a><span data-ttu-id="17fc6-161">Fonctionnement des instances utilisateur</span><span class="sxs-lookup"><span data-stu-id="17fc6-161">How User Instances Work</span></span>  
 <span data-ttu-id="17fc6-162">La première fois qu’une instance utilisateur est générée pour chaque utilisateur, les bases de données système **Master** et **msdb** sont copiées du dossier de données du modèle vers un chemin d’accès sous le répertoire de stockage des données de l’application locale de l’utilisateur pour une utilisation exclusive par l’instance utilisateur.</span><span class="sxs-lookup"><span data-stu-id="17fc6-162">The first time a user instance is generated for each user, the **master** and **msdb** system databases are copied from the Template Data folder to a path under the user's local application data repository directory for exclusive use by the user instance.</span></span> <span data-ttu-id="17fc6-163">Ce chemin d'accès est généralement `C:\Documents and Settings\<UserName>\Local Settings\Application Data\Microsoft\Microsoft SQL Server Data\SQLEXPRESS`.</span><span class="sxs-lookup"><span data-stu-id="17fc6-163">This path is typically `C:\Documents and Settings\<UserName>\Local Settings\Application Data\Microsoft\Microsoft SQL Server Data\SQLEXPRESS`.</span></span> <span data-ttu-id="17fc6-164">Lors du démarrage d’une instance utilisateur, les fichiers **tempdb**, log et de trace sont également écrits dans ce répertoire.</span><span class="sxs-lookup"><span data-stu-id="17fc6-164">When a user instance starts up, the **tempdb**, log, and trace files are also written to this directory.</span></span> <span data-ttu-id="17fc6-165">Un nom est généré pour l'instance, ce qui garantit un nom unique pour chaque utilisateur.</span><span class="sxs-lookup"><span data-stu-id="17fc6-165">A name is generated for the instance, which is guaranteed to be unique for each user.</span></span>  
  
 <span data-ttu-id="17fc6-166">Par défaut, tous les membres du groupe Builtin\Users de Windows reçoivent les autorisations de se connecter à l'instance locale ainsi que les autorisations en lecture et en écriture sur les binaires SQL Server.</span><span class="sxs-lookup"><span data-stu-id="17fc6-166">By default all members of the Windows Builtin\Users group are granted permissions to connect on the local instance as well as read and execute permissions on the SQL Server binaries.</span></span> <span data-ttu-id="17fc6-167">Une fois que les informations d'identification de l'utilisateur appelant qui héberge l'instance utilisateur ont été vérifiées, cet utilisateur devient `sysadmin` sur cette instance.</span><span class="sxs-lookup"><span data-stu-id="17fc6-167">Once the credentials of the calling user hosting the user instance have been verified, that user becomes the `sysadmin` on that instance.</span></span> <span data-ttu-id="17fc6-168">Seule la mémoire partagée est activée pour les instances utilisateur, ce qui signifie que seules les opérations sur l'ordinateur local sont possibles.</span><span class="sxs-lookup"><span data-stu-id="17fc6-168">Only shared memory is enabled for user instances, which means that only operations on the local machine are possible.</span></span>  
  
 <span data-ttu-id="17fc6-169">Les utilisateurs doivent recevoir les autorisations en lecture et en écriture sur les fichiers .mdf et .ldf spécifiés dans la chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="17fc6-169">Users must be granted both read and write permissions on the .mdf and .ldf files specified in the connection string.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="17fc6-170">Les fichiers .mdf et .ldf représentent les fichiers de base de données et du journal, respectivement.</span><span class="sxs-lookup"><span data-stu-id="17fc6-170">The .mdf and .ldf files represent the database and log files, respectively.</span></span> <span data-ttu-id="17fc6-171">Ces deux fichiers forment une paire, les opérations de sauvegarde et de restauration doivent donc s'effectuer avec prudence.</span><span class="sxs-lookup"><span data-stu-id="17fc6-171">These two files are a matched set, so care must be taken during backup and restore operations.</span></span> <span data-ttu-id="17fc6-172">Le fichier de base de données contient des informations sur la version exacte du fichier journal, et la base de données ne s'ouvre pas si elle est associée au mauvais fichier journal.</span><span class="sxs-lookup"><span data-stu-id="17fc6-172">The database file contains information about the exact version of the log file, and the database will not open if it is coupled with the wrong log file.</span></span>  
  
 <span data-ttu-id="17fc6-173">Pour éviter d'endommager les données, une base de données dans l'instance utilisateur est ouverte avec un accès exclusif.</span><span class="sxs-lookup"><span data-stu-id="17fc6-173">To avoid data corruption, a database in the user instance is opened with exclusive access.</span></span> <span data-ttu-id="17fc6-174">Si deux instances utilisateur différentes partagent la même base de données sur le même ordinateur, l'utilisateur sur la première instance doit refermer la base de données pour qu'elle puisse être ouverte sur une deuxième instance.</span><span class="sxs-lookup"><span data-stu-id="17fc6-174">If two different user instances share the same database on the same computer, the user on the first instance must close the database before it can be opened in a second instance.</span></span>  
  
## <a name="user-instance-scenarios"></a><span data-ttu-id="17fc6-175">Scénarios d'instance utilisateur</span><span class="sxs-lookup"><span data-stu-id="17fc6-175">User Instance Scenarios</span></span>  
 <span data-ttu-id="17fc6-176">Les instances utilisateur fournissent aux développeurs d'applications de base de données un magasin de données SQL Server qui ne nécessite pas que les développeurs disposent de comptes d'administration sur leurs ordinateurs de développement.</span><span class="sxs-lookup"><span data-stu-id="17fc6-176">User instances provide developers of database applications with a SQL Server data store that does not depend on developers having administrative accounts on their development computers.</span></span> <span data-ttu-id="17fc6-177">Les instances utilisateur sont basées sur le modèle Access/Jet selon lequel il suffit que l'application de base de données se connecte à un fichier pour que l'utilisateur dispose automatiquement de toutes les autorisations sur tous les objets de base de données sans que l'intervention d'un administrateur système ne soit nécessaire.</span><span class="sxs-lookup"><span data-stu-id="17fc6-177">User instances are based on the Access/Jet model, where the database application simply connects to a file, and the user automatically has full permissions on all of the database objects without needing the intervention of a system administrator to grant permissions.</span></span> <span data-ttu-id="17fc6-178">Ce modèle convient lorsque l'utilisateur s'exécute sous un compte avec les privilèges minimum (LUA) sans disposer de privilèges d'administration sur l'ordinateur local ou le serveur et qu'il a besoin de créer des objets et des applications de base de données.</span><span class="sxs-lookup"><span data-stu-id="17fc6-178">It is intended to work in situations where the user is running under a least-privilege user account (LUA) and does not have administrative privileges on the server or local machine, yet needs to create database objects and applications.</span></span> <span data-ttu-id="17fc6-179">Les instances utilisateur permettent aux utilisateurs de créer des instances au moment de l'exécution qui s'exécutent sous le contexte de sécurité de l'utilisateur au lieu du contexte de sécurité d'un service système plus privilégié.</span><span class="sxs-lookup"><span data-stu-id="17fc6-179">User instances allow users to create instances at run time that run under the user's own security context, and not in the security context of a more privileged system service.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="17fc6-180">Les instances utilisateur doivent uniquement servir dans les scénarios où toutes les applications qui les utilisent sont totalement fiables.</span><span class="sxs-lookup"><span data-stu-id="17fc6-180">User instances should only be used in scenarios where all the applications using it are fully trusted.</span></span>  
  
 <span data-ttu-id="17fc6-181">Les scénarios d'instance utilisateur sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="17fc6-181">User instance scenarios include:</span></span>  
  
- <span data-ttu-id="17fc6-182">Toute application mono-utilisateur où le partage des données n'est pas requis.</span><span class="sxs-lookup"><span data-stu-id="17fc6-182">Any single-user application where sharing data is not required.</span></span>  
  
- <span data-ttu-id="17fc6-183">Déploiement ClickOnce</span><span class="sxs-lookup"><span data-stu-id="17fc6-183">ClickOnce deployment.</span></span> <span data-ttu-id="17fc6-184">Si le .NET Framework 2.0 (ou version ultérieure) et SQL Server Express sont déjà installés sur l'ordinateur cible, le package d'installation téléchargé suite à une action ClickOnce peut être installé et utilisé par des utilisateurs qui ne sont pas administrateurs.</span><span class="sxs-lookup"><span data-stu-id="17fc6-184">If the .NET Framework 2.0 (or later) and SQL Server Express are already installed on the target computer, the installation package downloaded as a result of a ClickOnce action can be installed and used by non-administrator users.</span></span> <span data-ttu-id="17fc6-185">Notez qu'un administrateur doit installer SQL Server Express si cette édition fait partie de l'installation.</span><span class="sxs-lookup"><span data-stu-id="17fc6-185">Note that an administrator must install SQL Server Express if that is part of the setup.</span></span> <span data-ttu-id="17fc6-186">Pour plus d’informations, consultez [déploiement ClickOnce pour Windows Forms](../../../winforms/clickonce-deployment-for-windows-forms.md).</span><span class="sxs-lookup"><span data-stu-id="17fc6-186">For more information, see [ClickOnce Deployment for Windows Forms](../../../winforms/clickonce-deployment-for-windows-forms.md).</span></span>
  
- <span data-ttu-id="17fc6-187">Hébergement ASP.NET dédié à l'aide de l'authentification Windows.</span><span class="sxs-lookup"><span data-stu-id="17fc6-187">Dedicated ASP.NET hosting using Windows Authentication.</span></span> <span data-ttu-id="17fc6-188">Une seule instance SQL Server Express peut être hébergée sur un intranet.</span><span class="sxs-lookup"><span data-stu-id="17fc6-188">A single SQL Server Express instance can be hosted on an intranet.</span></span> <span data-ttu-id="17fc6-189">L'application se connecte à l'aide du compte Windows ASPNET, et non à l'aide de l'emprunt d'identité.</span><span class="sxs-lookup"><span data-stu-id="17fc6-189">The application connects using the ASPNET Windows account, not by using impersonation.</span></span> <span data-ttu-id="17fc6-190">Les instances utilisateur ne doivent pas être utilisées dans les scénarios d'hébergement partagés ou tiers dans lesquels toutes les applications doivent partager la même instance utilisateur et ne plus être indépendantes les unes des autres.</span><span class="sxs-lookup"><span data-stu-id="17fc6-190">User instances should not be used for third-party or shared hosting scenarios where all applications would share the same user instance and would no longer remain isolated from each other.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="17fc6-191">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="17fc6-191">See also</span></span>

- [<span data-ttu-id="17fc6-192">SQL Server et ADO.NET</span><span class="sxs-lookup"><span data-stu-id="17fc6-192">SQL Server and ADO.NET</span></span>](index.md)
- [<span data-ttu-id="17fc6-193">Chaînes de connexion</span><span class="sxs-lookup"><span data-stu-id="17fc6-193">Connection Strings</span></span>](../connection-strings.md)
- [<span data-ttu-id="17fc6-194">Connexion à une source de données</span><span class="sxs-lookup"><span data-stu-id="17fc6-194">Connecting to a Data Source</span></span>](../connecting-to-a-data-source.md)
- [<span data-ttu-id="17fc6-195">Vue d’ensemble d’ADO.NET</span><span class="sxs-lookup"><span data-stu-id="17fc6-195">ADO.NET Overview</span></span>](../ado-net-overview.md)

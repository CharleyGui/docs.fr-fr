---
title: Gestion des autorisations avec les procédures stockées dans SQL Server
description: Découvrez comment restreindre l’accès à vos données et objets de base de données en implémentant l’accès à l’aide de procédures stockées ou de fonctions définies par l’utilisateur.
ms.date: 03/30/2017
ms.assetid: 08fa34e8-2ffa-470d-ba62-e511a5f8558e
ms.openlocfilehash: 44f6a0c3ca6b913c8998c4e5ddb60eab2b64e71b
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/24/2020
ms.locfileid: "91172721"
---
# <a name="managing-permissions-with-stored-procedures-in-sql-server"></a><span data-ttu-id="1953c-103">Gestion des autorisations avec les procédures stockées dans SQL Server</span><span class="sxs-lookup"><span data-stu-id="1953c-103">Managing Permissions with Stored Procedures in SQL Server</span></span>

<span data-ttu-id="1953c-104">Une méthode pour créer plusieurs lignes de défense autour de votre base de données consiste à implémenter tous les accès aux données à l'aide de procédures stockées ou de fonctions définies par l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="1953c-104">One method of creating multiple lines of defense around your database is to implement all data access using stored procedures or user-defined functions.</span></span> <span data-ttu-id="1953c-105">Vous révoquez ou refusez toutes les autorisations sur les objets sous-jacents, tels que les tables, et accordez les autorisations EXECUTE sur les procédures stockées</span><span class="sxs-lookup"><span data-stu-id="1953c-105">You revoke or deny all permissions to underlying objects, such as tables, and grant EXECUTE permissions on stored procedures.</span></span> <span data-ttu-id="1953c-106">De cette manière, vous créez un périmètre de sécurité autour vos objets de données et de base de données.</span><span class="sxs-lookup"><span data-stu-id="1953c-106">This effectively creates a security perimeter around your data and database objects.</span></span>  
  
## <a name="stored-procedure-benefits"></a><span data-ttu-id="1953c-107">Avantages des procédures stockées</span><span class="sxs-lookup"><span data-stu-id="1953c-107">Stored Procedure Benefits</span></span>  

 <span data-ttu-id="1953c-108">Les procédures stockées ont les avantages suivants :</span><span class="sxs-lookup"><span data-stu-id="1953c-108">Stored procedures have the following benefits:</span></span>  
  
- <span data-ttu-id="1953c-109">Les règles d'entreprise et la logique des données peuvent être encapsulées de telle sorte que les utilisateurs ont accès aux données et aux objets uniquement selon les méthodes définies par les développeurs et les administrateurs de bases de données. </span><span class="sxs-lookup"><span data-stu-id="1953c-109">Data logic and business rules can be encapsulated so that users can access data and objects only in ways that developers and database administrators intend.</span></span>  
  
- <span data-ttu-id="1953c-110">Des procédures stockées paramétrées et chargées de valider toutes les entrées d'utilisateur peuvent servir à contrer les attaques par injection SQL.</span><span class="sxs-lookup"><span data-stu-id="1953c-110">Parameterized stored procedures that validate all user input can be used to thwart SQL injection attacks.</span></span> <span data-ttu-id="1953c-111">Si vous utilisez du code SQL dynamique, veillez à paramétrer vos commandes et n'incluez jamais de valeurs de paramètre directement dans une chaîne de requête.</span><span class="sxs-lookup"><span data-stu-id="1953c-111">If you use dynamic SQL, be sure to parameterize your commands, and never include parameter values directly into a query string.</span></span>  
  
- <span data-ttu-id="1953c-112">Les modifications des requêtes et des données ad hoc peuvent être interdites.</span><span class="sxs-lookup"><span data-stu-id="1953c-112">Ad hoc queries and data modifications can be disallowed.</span></span> <span data-ttu-id="1953c-113">Ainsi, les utilisateurs ne peuvent pas, par inadvertance ou par malveillance, détruire des données ou exécuter des requêtes qui nuisent aux performances sur le serveur ou le réseau.</span><span class="sxs-lookup"><span data-stu-id="1953c-113">This prevents users from maliciously or inadvertently destroying data or executing queries that impair performance on the server or the network.</span></span>  
  
- <span data-ttu-id="1953c-114">Les erreurs peuvent être traitées dans le code de procédure sans passer directement dans les applications clientes.</span><span class="sxs-lookup"><span data-stu-id="1953c-114">Errors can be handled in procedure code without being passed directly to client applications.</span></span> <span data-ttu-id="1953c-115">Cela empêche le retour de messages d'erreur, ce qui peut contribuer à une attaque de détection.</span><span class="sxs-lookup"><span data-stu-id="1953c-115">This prevents error messages from being returned that could aid in a probing attack.</span></span> <span data-ttu-id="1953c-116">Enregistrez les erreurs et traitez-les sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="1953c-116">Log errors and handle them on the server.</span></span>  
  
- <span data-ttu-id="1953c-117">Les procédures stockées peuvent être écrites une seule fois et sont accessibles par de nombreuses applications.</span><span class="sxs-lookup"><span data-stu-id="1953c-117">Stored procedures can be written once, and accessed by many applications.</span></span>  
  
- <span data-ttu-id="1953c-118">Les applications clientes n'ont pas besoin de recevoir des informations sur les structures de données sous-jacentes.</span><span class="sxs-lookup"><span data-stu-id="1953c-118">Client applications do not need to know anything about the underlying data structures.</span></span> <span data-ttu-id="1953c-119">Le code des procédures stockées peut être modifié sans nécessiter des changements dans les applications clientes à condition que ces changements ne concernent pas les listes de paramètres ou les types de données retournés.</span><span class="sxs-lookup"><span data-stu-id="1953c-119">Stored procedure code can be changed without requiring changes in client applications as long as the changes do not affect parameter lists or returned data types.</span></span>  
  
- <span data-ttu-id="1953c-120">Les procédures stockées peuvent réduire le trafic réseau en associant plusieurs opérations dans un appel de procédure.</span><span class="sxs-lookup"><span data-stu-id="1953c-120">Stored procedures can reduce network traffic by combining multiple operations into one procedure call.</span></span>  
  
## <a name="stored-procedure-execution"></a><span data-ttu-id="1953c-121">Exécution des procédures stockées</span><span class="sxs-lookup"><span data-stu-id="1953c-121">Stored Procedure Execution</span></span>  

 <span data-ttu-id="1953c-122">Les procédures stockées tirent parti du chaînage des propriétés permettant de fournir l'accès aux données pour ne pas que les utilisateurs aient l'autorisation explicite d'accéder aux objets de base de données.</span><span class="sxs-lookup"><span data-stu-id="1953c-122">Stored procedures take advantage of ownership chaining to provide access to data so that users do not need to have explicit permission to access database objects.</span></span> <span data-ttu-id="1953c-123">Une chaîne de propriétés existe lorsque les objets qui sont accessibles les uns aux autres de manière séquentielle sont détenus par le même utilisateur.</span><span class="sxs-lookup"><span data-stu-id="1953c-123">An ownership chain exists when objects that access each other sequentially are owned by the same user.</span></span> <span data-ttu-id="1953c-124">Par exemple, une procédure stockée peut appeler d'autres procédures stockées, ou une procédure stockée peut accéder à plusieurs tables.</span><span class="sxs-lookup"><span data-stu-id="1953c-124">For example, a stored procedure can call other stored procedures, or a stored procedure can access multiple tables.</span></span> <span data-ttu-id="1953c-125">Si tous les objets dans la chaîne d'exécution ont le même propriétaire, SQL Server se contente de vérifier l'autorisation EXECUTE pour l'appelant, et non les autorisations de l'appelant sur d'autres objets.</span><span class="sxs-lookup"><span data-stu-id="1953c-125">If all objects in the chain of execution have the same owner, then SQL Server only checks the EXECUTE permission for the caller, not the caller's permissions on other objects.</span></span> <span data-ttu-id="1953c-126">Par conséquent, il vous suffit d'accorder les autorisations EXECUTE sur les procédures stockées ; vous pouvez révoquer ou refuser toutes les autorisations sur les tables sous-jacentes. </span><span class="sxs-lookup"><span data-stu-id="1953c-126">Therefore you need to grant only EXECUTE permissions on stored procedures; you can revoke or deny all permissions on the underlying tables.</span></span>  
  
## <a name="best-practices"></a><span data-ttu-id="1953c-127">Bonnes pratiques</span><span class="sxs-lookup"><span data-stu-id="1953c-127">Best Practices</span></span>  

 <span data-ttu-id="1953c-128">La simple écriture de procédures stockées ne suffit pas à sécuriser votre application de façon adéquate.</span><span class="sxs-lookup"><span data-stu-id="1953c-128">Simply writing stored procedures isn't enough to adequately secure your application.</span></span> <span data-ttu-id="1953c-129">Vous devez également envisager les défaillances de sécurité potentielles suivantes.</span><span class="sxs-lookup"><span data-stu-id="1953c-129">You should also consider the following potential security holes.</span></span>  
  
- <span data-ttu-id="1953c-130">Accordez les autorisations EXECUTE sur les procédures stockées pour les rôles de base de données que vous souhaitez faire accéder aux données.</span><span class="sxs-lookup"><span data-stu-id="1953c-130">Grant EXECUTE permissions on the stored procedures for database roles you want to be able to access the data.</span></span>  
  
- <span data-ttu-id="1953c-131">Révoquez ou refusez toutes les autorisations sur les tables sous-jacentes pour tous les rôles et les utilisateurs de la base de données, y compris le rôle `public`.</span><span class="sxs-lookup"><span data-stu-id="1953c-131">Revoke or deny all permissions to the underlying tables for all roles and users in the database, including the `public` role.</span></span> <span data-ttu-id="1953c-132">Tous les utilisateurs héritent des autorisations de public.</span><span class="sxs-lookup"><span data-stu-id="1953c-132">All users inherit permissions from public.</span></span> <span data-ttu-id="1953c-133">Par conséquent, le refus des autorisations à `public` signifient que seuls les membres et les propriétaires `sysadmin` ont un accès ; tous les autres utilisateurs ne pourront pas hériter des autorisations issues des appartenances d'autres rôles.</span><span class="sxs-lookup"><span data-stu-id="1953c-133">Therefore denying permissions to `public` means that only owners and `sysadmin` members have access; all other users will be unable to inherit permissions from membership in other roles.</span></span>  
  
- <span data-ttu-id="1953c-134">N'ajoutez pas d'utilisateurs ou de rôles aux rôles `sysadmin` ou `db_owner`.</span><span class="sxs-lookup"><span data-stu-id="1953c-134">Do not add users or roles to the `sysadmin` or `db_owner` roles.</span></span> <span data-ttu-id="1953c-135">Les administrateurs système et les propriétaires de bases de données peuvent accéder à tous les objets de base de données.</span><span class="sxs-lookup"><span data-stu-id="1953c-135">System administrators and database owners can access all database objects.</span></span>  
  
- <span data-ttu-id="1953c-136">Désactivez le compte `guest`.</span><span class="sxs-lookup"><span data-stu-id="1953c-136">Disable the `guest` account.</span></span> <span data-ttu-id="1953c-137">Cela empêche les utilisateurs anonymes de se connecter à la base de données.</span><span class="sxs-lookup"><span data-stu-id="1953c-137">This will prevent anonymous users from connecting to the database.</span></span> <span data-ttu-id="1953c-138">Le compte invité est désactivé par défaut dans les nouvelles bases de données.</span><span class="sxs-lookup"><span data-stu-id="1953c-138">The guest account is disabled by default in new databases.</span></span>  
  
- <span data-ttu-id="1953c-139">Implémentez la gestion des erreurs et enregistrez les erreurs.</span><span class="sxs-lookup"><span data-stu-id="1953c-139">Implement error handling and log errors.</span></span>  
  
- <span data-ttu-id="1953c-140">Créez des procédures stockées paramétrées qui valident toutes les entrées d'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="1953c-140">Create parameterized stored procedures that validate all user input.</span></span> <span data-ttu-id="1953c-141">Traitez toutes les entrées d'utilisateur comme non approuvées.</span><span class="sxs-lookup"><span data-stu-id="1953c-141">Treat all user input as untrusted.</span></span>  
  
- <span data-ttu-id="1953c-142">Évitez d'utiliser le code SQL dynamique, sauf si cela est absolument nécessaire.</span><span class="sxs-lookup"><span data-stu-id="1953c-142">Avoid dynamic SQL unless absolutely necessary.</span></span> <span data-ttu-id="1953c-143">Utilisez la fonction Transact-SQL QUOTENAME() pour délimiter une valeur de chaîne et échapper à toute occurrence du délimiteur dans la chaîne d'entrée.</span><span class="sxs-lookup"><span data-stu-id="1953c-143">Use the Transact-SQL QUOTENAME() function to delimit a string value and escape any occurrence of the delimiter in the input string.</span></span>  
  
## <a name="external-resources"></a><span data-ttu-id="1953c-144">Ressources externes</span><span class="sxs-lookup"><span data-stu-id="1953c-144">External Resources</span></span>  

 <span data-ttu-id="1953c-145">Pour plus d'informations, consultez les ressources ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="1953c-145">For more information, see the following resources.</span></span>  
  
|<span data-ttu-id="1953c-146">Ressource</span><span class="sxs-lookup"><span data-stu-id="1953c-146">Resource</span></span>|<span data-ttu-id="1953c-147">Description</span><span class="sxs-lookup"><span data-stu-id="1953c-147">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="1953c-148">[Procédures stockées](/sql/relational-databases/stored-procedures/stored-procedures-database-engine) et [injection SQL](/sql/relational-databases/security/sql-injection)</span><span class="sxs-lookup"><span data-stu-id="1953c-148">[Stored Procedures](/sql/relational-databases/stored-procedures/stored-procedures-database-engine) and [SQL Injection](/sql/relational-databases/security/sql-injection)</span></span>|<span data-ttu-id="1953c-149">Les articles décrivent comment créer des procédures stockées et comment fonctionne l’injection SQL.</span><span class="sxs-lookup"><span data-stu-id="1953c-149">Articles describe how to create stored procedures and how SQL Injection works.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="1953c-150">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="1953c-150">See also</span></span>

- [<span data-ttu-id="1953c-151">Sécurisation des applications ADO.NET</span><span class="sxs-lookup"><span data-stu-id="1953c-151">Securing ADO.NET Applications</span></span>](../securing-ado-net-applications.md)
- [<span data-ttu-id="1953c-152">Vue d'ensemble de la sécurité SQL Server</span><span class="sxs-lookup"><span data-stu-id="1953c-152">Overview of SQL Server Security</span></span>](overview-of-sql-server-security.md)
- [<span data-ttu-id="1953c-153">Scénarios de sécurité des applications dans SQL Server</span><span class="sxs-lookup"><span data-stu-id="1953c-153">Application Security Scenarios in SQL Server</span></span>](application-security-scenarios-in-sql-server.md)
- [<span data-ttu-id="1953c-154">Écriture d’une instruction SQL dynamique sécurisée dans SQL Server</span><span class="sxs-lookup"><span data-stu-id="1953c-154">Writing Secure Dynamic SQL in SQL Server</span></span>](writing-secure-dynamic-sql-in-sql-server.md)
- [<span data-ttu-id="1953c-155">Signature de procédures stockées dans SQL Server</span><span class="sxs-lookup"><span data-stu-id="1953c-155">Signing Stored Procedures in SQL Server</span></span>](signing-stored-procedures-in-sql-server.md)
- [<span data-ttu-id="1953c-156">Personnalisation des autorisations avec l'emprunt d'identité dans SQL Server</span><span class="sxs-lookup"><span data-stu-id="1953c-156">Customizing Permissions with Impersonation in SQL Server</span></span>](customizing-permissions-with-impersonation-in-sql-server.md)
- [<span data-ttu-id="1953c-157">Modification des données avec les procédures stockées</span><span class="sxs-lookup"><span data-stu-id="1953c-157">Modifying Data with Stored Procedures</span></span>](../modifying-data-with-stored-procedures.md)
- [<span data-ttu-id="1953c-158">Vue d'ensemble d’ADO.NET</span><span class="sxs-lookup"><span data-stu-id="1953c-158">ADO.NET Overview</span></span>](../ado-net-overview.md)

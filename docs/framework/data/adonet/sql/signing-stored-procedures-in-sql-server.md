---
title: Signature de procédures stockées dans SQL Server
ms.date: 01/05/2018
ms.assetid: eeed752c-0084-48e5-9dca-381353007a0d
ms.openlocfilehash: 8dc62527be7273d3ce3222d4d261b81bc40b1e19
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/07/2019
ms.locfileid: "70791812"
---
# <a name="signing-stored-procedures-in-sql-server"></a><span data-ttu-id="3a005-102">Signature de procédures stockées dans SQL Server</span><span class="sxs-lookup"><span data-stu-id="3a005-102">Signing Stored Procedures in SQL Server</span></span>

<span data-ttu-id="3a005-103">Une signature numérique est un condensat des données qui est chiffré avec la clé privée du signataire.</span><span class="sxs-lookup"><span data-stu-id="3a005-103">A digital signature is a data digest encrypted with the private key of the signer.</span></span> <span data-ttu-id="3a005-104">La clé privée garantit que la signature numérique est unique à son porteur ou propriétaire.</span><span class="sxs-lookup"><span data-stu-id="3a005-104">The private key ensures that the digital signature is unique to its bearer or owner.</span></span> <span data-ttu-id="3a005-105">Vous pouvez signer des procédures stockées, des fonctions (à l’exception des fonctions table incluses), des déclencheurs et des assemblys.</span><span class="sxs-lookup"><span data-stu-id="3a005-105">You can sign stored procedures, functions (except for inline table-valued functions), triggers, and assemblies.</span></span>

<span data-ttu-id="3a005-106">Vous pouvez signer une procédure stockée avec un certificat ou une clé asymétrique.</span><span class="sxs-lookup"><span data-stu-id="3a005-106">You can sign a stored procedure with a certificate or an asymmetric key.</span></span> <span data-ttu-id="3a005-107">Cela est très utile lorsque des autorisations ne peuvent pas être héritées par le biais du chaînage des propriétés ou lorsque ce dernier est rompu, comme avec SQL dynamique.</span><span class="sxs-lookup"><span data-stu-id="3a005-107">This is designed for scenarios when permissions cannot be inherited through ownership chaining or when the ownership chain is broken, such as dynamic SQL.</span></span> <span data-ttu-id="3a005-108">Vous pouvez ensuite créer un utilisateur mappé au certificat, en accordant au certificat des autorisations d’utilisateur sur les objets auxquels la procédure stockée doit accéder.</span><span class="sxs-lookup"><span data-stu-id="3a005-108">You can then create a user mapped to the certificate, granting the certificate user permissions on the objects the stored procedure needs to access.</span></span>

<span data-ttu-id="3a005-109">Vous pouvez également créer une connexion mappée sur le même certificat, puis accorder les autorisations de niveau serveur nécessaires à cette connexion, ou ajouter la connexion à un ou plusieurs rôles serveur fixes.</span><span class="sxs-lookup"><span data-stu-id="3a005-109">You can also create a login mapped to the same certificate, and then grant any necessary server-level permissions to that login, or add the login to one or more of the fixed server roles.</span></span> <span data-ttu-id="3a005-110">Cela est conçu pour éviter d’activer `TRUSTWORTHY` le paramètre de base de données pour les scénarios dans lesquels des autorisations de niveau supérieur sont nécessaires.</span><span class="sxs-lookup"><span data-stu-id="3a005-110">This is designed to avoid enabling the `TRUSTWORTHY` database setting for scenarios in which higher level permissions are needed.</span></span>

<span data-ttu-id="3a005-111">Lorsque la procédure stockée est exécutée, SQL Server associe les autorisations de l’utilisateur et/ou de la connexion du certificat à celles de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="3a005-111">When the stored procedure is executed, SQL Server combines the permissions of the certificate user and/or login with those of the caller.</span></span> <span data-ttu-id="3a005-112">Contrairement à `EXECUTE AS` la clause, elle ne modifie pas le contexte d’exécution de la procédure.</span><span class="sxs-lookup"><span data-stu-id="3a005-112">Unlike the `EXECUTE AS` clause, it does not change the execution context of the procedure.</span></span> <span data-ttu-id="3a005-113">Les fonctions intégrées qui retournent les noms d'accès et d'utilisateur retournent le non de l'appelant, et non celui de l'utilisateur du certificat.</span><span class="sxs-lookup"><span data-stu-id="3a005-113">Built-in functions that return login and user names return the name of the caller, not the certificate user name.</span></span>

## <a name="creating-certificates"></a><span data-ttu-id="3a005-114">Création de certificats</span><span class="sxs-lookup"><span data-stu-id="3a005-114">Creating Certificates</span></span>

<span data-ttu-id="3a005-115">Lorsque vous signez une procédure stockée avec un certificat ou une clé asymétrique, un résumé des données composé du hachage chiffré du code de la procédure stockée, ainsi que de l’utilisateur Execute-As, est créé à l’aide de la clé privée.</span><span class="sxs-lookup"><span data-stu-id="3a005-115">When you sign a stored procedure with a certificate or asymmetric key, a data digest consisting of the encrypted hash of the stored procedure code, along with the execute-as user, is created using the private key.</span></span> <span data-ttu-id="3a005-116">Au moment de l’exécution, le condensat des données est chiffré avec la clé publique et comparée à la valeur de hachage de la procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="3a005-116">At run time, the data digest is decrypted with the public key and compared with the hash value of the stored procedure.</span></span> <span data-ttu-id="3a005-117">La modification de l’utilisateur Execute-As invalide la valeur de hachage afin que la signature numérique ne corresponde plus.</span><span class="sxs-lookup"><span data-stu-id="3a005-117">Changing the execute-as user invalidates the hash value so that the digital signature no longer matches.</span></span> <span data-ttu-id="3a005-118">La modification de la procédure stockée supprime entièrement la signature, ce qui empêche une personne qui n’a pas accès à la clé privée de modifier le code de la procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="3a005-118">Modifying the stored procedure drops the signature entirely, which prevents someone who does not have access to the private key from changing the stored procedure code.</span></span> <span data-ttu-id="3a005-119">Dans les deux cas, vous devez signer à nouveau la procédure chaque fois que vous modifiez le code ou l’utilisateur exécuter en tant que.</span><span class="sxs-lookup"><span data-stu-id="3a005-119">In either case, you must re-sign the procedure each time you change the code or the execute-as user.</span></span>

<span data-ttu-id="3a005-120">Deux étapes sont nécessaires pour la signature d’un module :</span><span class="sxs-lookup"><span data-stu-id="3a005-120">There are two required steps involved in signing a module:</span></span>

1. <span data-ttu-id="3a005-121">Créez un certificat à l'aide de l'instruction Transact-SQL `CREATE CERTIFICATE [certificateName]`.</span><span class="sxs-lookup"><span data-stu-id="3a005-121">Create a certificate using the Transact-SQL `CREATE CERTIFICATE [certificateName]` statement.</span></span> <span data-ttu-id="3a005-122">Cette instruction possède plusieurs options permettant de définir une date de début et de fin, de même qu'un mot de passe.</span><span class="sxs-lookup"><span data-stu-id="3a005-122">This statement has several options for setting a start and end date and a password.</span></span> <span data-ttu-id="3a005-123">La date d’expiration par défaut est d’un an.</span><span class="sxs-lookup"><span data-stu-id="3a005-123">The default expiration date is one year.</span></span>

1. <span data-ttu-id="3a005-124">Signez la procédure avec le certificat en utilisant l'instruction Transact-SQL `ADD SIGNATURE TO [procedureName] BY CERTIFICATE [certificateName]`.</span><span class="sxs-lookup"><span data-stu-id="3a005-124">Sign the procedure with the certificate using the Transact-SQL `ADD SIGNATURE TO [procedureName] BY CERTIFICATE [certificateName]` statement.</span></span>

<span data-ttu-id="3a005-125">Une fois le module signé, vous devez créer un ou plusieurs principaux afin de conserver les autorisations supplémentaires qui doivent être associées au certificat.</span><span class="sxs-lookup"><span data-stu-id="3a005-125">Once the module has been signed, one or more principals needs to be created in order to hold the additional permissions that should be associated with the certificate.</span></span>

<span data-ttu-id="3a005-126">Si le module a besoin d’autorisations supplémentaires au niveau de la base de données :</span><span class="sxs-lookup"><span data-stu-id="3a005-126">If the module needs additional database-level permissions:</span></span>

1. <span data-ttu-id="3a005-127">Créez un utilisateur de base de données associé à ce certificat à l'aide de l'instruction Transact-SQL `CREATE USER [userName] FROM CERTIFICATE [certificateName]`.</span><span class="sxs-lookup"><span data-stu-id="3a005-127">Create a database user associated with that certificate using the Transact-SQL `CREATE USER [userName] FROM CERTIFICATE [certificateName]` statement.</span></span> <span data-ttu-id="3a005-128">Cet utilisateur existe uniquement dans la base de données et n’est pas associé à une connexion, sauf si un compte de connexion a été créé à partir de ce même certificat.</span><span class="sxs-lookup"><span data-stu-id="3a005-128">This user exists in the database only and is not associated with a login unless a login has also been created from that same certificate.</span></span>

1. <span data-ttu-id="3a005-129">Accordez à l’utilisateur du certificat les autorisations requises au niveau de la base de données.</span><span class="sxs-lookup"><span data-stu-id="3a005-129">Grant the certificate user the required database-level permissions.</span></span>

<span data-ttu-id="3a005-130">Si le module a besoin d’autorisations supplémentaires au niveau du serveur :</span><span class="sxs-lookup"><span data-stu-id="3a005-130">If the module needs additional server-level permissions:</span></span>

1. <span data-ttu-id="3a005-131">Copiez le certificat dans `master` la base de données.</span><span class="sxs-lookup"><span data-stu-id="3a005-131">Copy the certificate to the `master` database.</span></span>

1. <span data-ttu-id="3a005-132">Créez une connexion associée à ce certificat à l’aide de l' `CREATE LOGIN [userName] FROM CERTIFICATE [certificateName]` instruction Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="3a005-132">Create a login associated with that certificate using the Transact-SQL `CREATE LOGIN [userName] FROM CERTIFICATE [certificateName]` statement.</span></span>

1. <span data-ttu-id="3a005-133">Accordez au certificat de connexion les autorisations requises au niveau du serveur.</span><span class="sxs-lookup"><span data-stu-id="3a005-133">Grant the certificate login the required server-level permissions.</span></span>

> [!NOTE]
> <span data-ttu-id="3a005-134">Un certificat ne permet pas d'accorder des autorisations à un utilisateur dont les autorisations ont été révoquées à l'aide de l'instruction DENY.</span><span class="sxs-lookup"><span data-stu-id="3a005-134">A certificate cannot grant permissions to a user that has had permissions revoked using the DENY statement.</span></span> <span data-ttu-id="3a005-135">L'instruction DENY a toujours priorité sur l'instruction GRANT, ce qui empêche l'appelant d'hériter des autorisations accordées à l'utilisateur du certificat.</span><span class="sxs-lookup"><span data-stu-id="3a005-135">DENY always takes precedence over GRANT, preventing the caller from inheriting permissions granted to the certificate user.</span></span>

## <a name="external-resources"></a><span data-ttu-id="3a005-136">Ressources externes</span><span class="sxs-lookup"><span data-stu-id="3a005-136">External Resources</span></span>

<span data-ttu-id="3a005-137">Pour plus d'informations, voir les ressources ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="3a005-137">For more information, see the following resources.</span></span>

|<span data-ttu-id="3a005-138">Ressource</span><span class="sxs-lookup"><span data-stu-id="3a005-138">Resource</span></span>|<span data-ttu-id="3a005-139">Description</span><span class="sxs-lookup"><span data-stu-id="3a005-139">Description</span></span>|
|--------------|-----------------|
|<span data-ttu-id="3a005-140">[Connexion au Module](https://go.microsoft.com/fwlink/?LinkId=98590) documentation en ligne de SQL Server</span><span class="sxs-lookup"><span data-stu-id="3a005-140">[Module Signing](https://go.microsoft.com/fwlink/?LinkId=98590) in SQL Server Books Online</span></span>|<span data-ttu-id="3a005-141">Décrit la signature de module, en fournissant un exemple de scénario et des liens vers les rubriques pertinentes relatives à Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="3a005-141">Describes module signing, providing a sample scenario and links to the relevant Transact-SQL topics.</span></span>|
|<span data-ttu-id="3a005-142">[Signature de procédures stockées à l’aide d’un certificat](/sql/relational-databases/tutorial-signing-stored-procedures-with-a-certificate) dans documentation en ligne de SQL Server</span><span class="sxs-lookup"><span data-stu-id="3a005-142">[Signing Stored Procedures with a Certificate](/sql/relational-databases/tutorial-signing-stored-procedures-with-a-certificate) in SQL Server Books Online</span></span>|<span data-ttu-id="3a005-143">Propose un didacticiel de signature d'une procédure stockée à l'aide d'un certificat.</span><span class="sxs-lookup"><span data-stu-id="3a005-143">Provides a tutorial for signing a stored procedure with a certificate.</span></span>|

## <a name="see-also"></a><span data-ttu-id="3a005-144">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="3a005-144">See also</span></span>

- [<span data-ttu-id="3a005-145">Sécurisation des applications ADO.NET</span><span class="sxs-lookup"><span data-stu-id="3a005-145">Securing ADO.NET Applications</span></span>](../securing-ado-net-applications.md)
- [<span data-ttu-id="3a005-146">Vue d’ensemble de la sécurité SQL Server</span><span class="sxs-lookup"><span data-stu-id="3a005-146">Overview of SQL Server Security</span></span>](overview-of-sql-server-security.md)
- [<span data-ttu-id="3a005-147">Scénarios de sécurité des applications dans SQL Server</span><span class="sxs-lookup"><span data-stu-id="3a005-147">Application Security Scenarios in SQL Server</span></span>](application-security-scenarios-in-sql-server.md)
- [<span data-ttu-id="3a005-148">Gestion des autorisations avec les procédures stockées dans SQL Server</span><span class="sxs-lookup"><span data-stu-id="3a005-148">Managing Permissions with Stored Procedures in SQL Server</span></span>](managing-permissions-with-stored-procedures-in-sql-server.md)
- [<span data-ttu-id="3a005-149">Écriture de code SQL dynamique sécurisé dans SQL Server</span><span class="sxs-lookup"><span data-stu-id="3a005-149">Writing Secure Dynamic SQL in SQL Server</span></span>](writing-secure-dynamic-sql-in-sql-server.md)
- [<span data-ttu-id="3a005-150">Personnalisation des autorisations avec l’emprunt d’identité dans SQL Server</span><span class="sxs-lookup"><span data-stu-id="3a005-150">Customizing Permissions with Impersonation in SQL Server</span></span>](customizing-permissions-with-impersonation-in-sql-server.md)
- [<span data-ttu-id="3a005-151">Modification des données avec les procédures stockées</span><span class="sxs-lookup"><span data-stu-id="3a005-151">Modifying Data with Stored Procedures</span></span>](../modifying-data-with-stored-procedures.md)
- [<span data-ttu-id="3a005-152">Vue d’ensemble d’ADO.NET</span><span class="sxs-lookup"><span data-stu-id="3a005-152">ADO.NET Overview</span></span>](../ado-net-overview.md)

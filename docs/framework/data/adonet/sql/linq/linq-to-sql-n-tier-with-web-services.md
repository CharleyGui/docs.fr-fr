---
title: Applications multicouches LINQ to SQL avec les services Web
ms.date: 03/30/2017
ms.assetid: 9cb10eb8-957f-4beb-a271-5f682016fed2
ms.openlocfilehash: 279907aeaaa83d6901621c03231068d61045ec5c
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/07/2019
ms.locfileid: "70781328"
---
# <a name="linq-to-sql-n-tier-with-web-services"></a><span data-ttu-id="855e4-102">Applications multicouches LINQ to SQL avec les services Web</span><span class="sxs-lookup"><span data-stu-id="855e4-102">LINQ to SQL N-Tier with Web Services</span></span>
[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]<span data-ttu-id="855e4-103">est conçu spécialement pour une utilisation sur la couche intermédiaire dans une couche d’accès aux données (DAL) faiblement couplée, comme un service Web.</span><span class="sxs-lookup"><span data-stu-id="855e4-103">is designed especially for use on the middle tier in a loosely-coupled data access layer (DAL) such as a Web service.</span></span> <span data-ttu-id="855e4-104">Si la couche Présentation est une page web ASP.NET, vous utilisez le contrôle serveur web <xref:System.Web.UI.WebControls.LinqDataSource> pour gérer le transfert de données entre l’interface utilisateur et [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] sur la couche intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="855e4-104">If the presentation tier is an ASP.NET Web page, then you use the <xref:System.Web.UI.WebControls.LinqDataSource> Web server control to manage the data transfer between the user interface and [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] on the middle-tier.</span></span> <span data-ttu-id="855e4-105">Si la couche de présentation n’est pas une page ASP.NET, la couche intermédiaire et la couche de présentation doivent exécuter des tâches supplémentaires pour gérer la sérialisation et la désérialisation des données.</span><span class="sxs-lookup"><span data-stu-id="855e4-105">If the presentation tier is not an ASP.NET page, then both the middle-tier and the presentation tier must do some additional work to manage the serialization and deserialization of data.</span></span>  
  
## <a name="setting-up-linq-to-sql-on-the-middle-tier"></a><span data-ttu-id="855e4-106">Configuration de LINQ to SQL sur la couche intermédiaire</span><span class="sxs-lookup"><span data-stu-id="855e4-106">Setting up LINQ to SQL on the Middle Tier</span></span>  
 <span data-ttu-id="855e4-107">Dans un service Web ou une application multicouche, la couche intermédiaire contient le contexte des données et les classes d'entité.</span><span class="sxs-lookup"><span data-stu-id="855e4-107">In a Web service or n-tier application, the middle tier contains the data context and the entity classes.</span></span> <span data-ttu-id="855e4-108">Vous pouvez créer ces classes manuellement, ou à l’aide de SQLMetal. exe ou du Concepteur Objet Relationnel, comme décrit dans la documentation.</span><span class="sxs-lookup"><span data-stu-id="855e4-108">You can create these classes manually, or by using either SQLMetal.exe or the Object Relational Designer as described elsewhere in the documentation.</span></span> <span data-ttu-id="855e4-109">Au moment du design, vous pouvez choisir de rendre les classes d'entité sérialisables.</span><span class="sxs-lookup"><span data-stu-id="855e4-109">At design time, you have the option to make the entity classes serializable.</span></span> <span data-ttu-id="855e4-110">Pour plus d’informations, consultez [Guide pratique pour Rendre les entités sérialisables](how-to-make-entities-serializable.md).</span><span class="sxs-lookup"><span data-stu-id="855e4-110">For more information, see [How to: Make Entities Serializable](how-to-make-entities-serializable.md).</span></span> <span data-ttu-id="855e4-111">Vous avez également la possibilité de créer un ensemble de classes distinct qui encapsule les données à sérialiser, puis de le projeter en types sérialisables lorsque vous retournez les données dans vos requêtes [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)].</span><span class="sxs-lookup"><span data-stu-id="855e4-111">Another option is to create a separate set of classes that encapsulate the data to be serialized, and then project into those serializable types when you return data in your [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] queries.</span></span>  
  
 <span data-ttu-id="855e4-112">Vous définissez ensuite l'interface avec les méthodes que les clients appelleront pour extraire, insérer et mettre à jour les données.</span><span class="sxs-lookup"><span data-stu-id="855e4-112">You then define the interface with the methods that the clients will call to retrieve, insert and update data.</span></span> <span data-ttu-id="855e4-113">Ces méthodes d'interface encapsulent vos requêtes [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)].</span><span class="sxs-lookup"><span data-stu-id="855e4-113">The interface methods wrap your [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] queries.</span></span> <span data-ttu-id="855e4-114">Vous pouvez utiliser tout type de mécanisme de sérialisation pour gérer les appels de méthode distants et la sérialisation de données.</span><span class="sxs-lookup"><span data-stu-id="855e4-114">You can use any kind of serialization mechanism to handle the remote method calls and the serialization of data.</span></span> <span data-ttu-id="855e4-115">La seule contrainte à respecter est la suivante : si votre modèle objet comporte des relations circulaires ou bidirectionnelles, comme entre Customers et Orders dans le modèle objet Northwind standard, vous devez utiliser un sérialiseur qui le prend en charge.</span><span class="sxs-lookup"><span data-stu-id="855e4-115">The only requirement is that if you have cyclic or bi-directional relationships in your object model, such as that between Customers and Orders in the standard Northwind object model, then you must use a serializer that supports it.</span></span> <span data-ttu-id="855e4-116">Windows Communication Foundation (WCF) <xref:System.Runtime.Serialization.DataContractSerializer> prend en charge les relations bidirectionnelles, mais ce n'est pas le cas de XmlSerializer qui est utilisé avec des services Web autres que WCF.</span><span class="sxs-lookup"><span data-stu-id="855e4-116">The Windows Communication Foundation (WCF) <xref:System.Runtime.Serialization.DataContractSerializer> supports bi-directional relationships but the XmlSerializer that is used with non-WCF Web services does not.</span></span> <span data-ttu-id="855e4-117">Si vous choisissez d'utiliser le XmlSerializer, vous devez vous assurer que votre modèle objet ne comporte pas de relations cycliques.</span><span class="sxs-lookup"><span data-stu-id="855e4-117">If you select to use the XmlSerializer, then you must make sure that your object model has no cyclic relationships.</span></span>  
  
 <span data-ttu-id="855e4-118">Pour plus d’informations sur la Windows Communication Foundation, consultez [Windows Communication Foundation services et WCF Data Services dans Visual Studio](/visualstudio/data-tools/windows-communication-foundation-services-and-wcf-data-services-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="855e4-118">For more information about Windows Communication Foundation, see [Windows Communication Foundation Services and WCF Data Services in Visual Studio](/visualstudio/data-tools/windows-communication-foundation-services-and-wcf-data-services-in-visual-studio).</span></span>  
  
 <span data-ttu-id="855e4-119">Implémentez vos règles métier ou toute autre logique spécifique au domaine en utilisant les classes et méthodes partielles sur <xref:System.Data.Linq.DataContext> et les classes d'entité pour le raccordement aux événements d'exécution de [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)].</span><span class="sxs-lookup"><span data-stu-id="855e4-119">Implement your business rules or other domain-specific logic by using the partial classes and methods on the <xref:System.Data.Linq.DataContext> and entity classes to hook into [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] runtime events.</span></span> <span data-ttu-id="855e4-120">Pour plus d’informations, consultez Implémentation de la [logique métier multicouche](implementing-business-logic-linq-to-sql.md).</span><span class="sxs-lookup"><span data-stu-id="855e4-120">For more information, see [Implementing N-Tier Business Logic](implementing-business-logic-linq-to-sql.md).</span></span>  
  
## <a name="defining-the-serializable-types"></a><span data-ttu-id="855e4-121">Définition des types sérialisables</span><span class="sxs-lookup"><span data-stu-id="855e4-121">Defining the Serializable Types</span></span>  
 <span data-ttu-id="855e4-122">Le niveau client ou la couche Présentation doit comporter des définitions de type pour les classes qu'elle recevra de la couche intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="855e4-122">The client or presentation tier must have type definitions for the classes that it will be receiving from the middle tier.</span></span> <span data-ttu-id="855e4-123">Ces types peuvent être les classes d'entité elles-mêmes ou des classes spéciales qui encapsulent uniquement certains champs des classes d'entité pour la communication à distance.</span><span class="sxs-lookup"><span data-stu-id="855e4-123">Those types may be the entity classes themselves, or special classes that wrap only certain fields from the entity classes for remoting.</span></span> <span data-ttu-id="855e4-124">Dans tous les cas [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] , est complètement sans souci quant à la façon dont la couche présentation acquiert ces définitions de type.</span><span class="sxs-lookup"><span data-stu-id="855e4-124">In any case, [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] is completely unconcerned about how the presentation tier acquires those type definitions.</span></span> <span data-ttu-id="855e4-125">Par exemple, la couche de présentation peut utiliser WCF pour générer les types automatiquement, ou elle peut posséder une copie d'une DLL dans laquelle ces types sont définis, ou elle peut simplement définir sa propre version des types.</span><span class="sxs-lookup"><span data-stu-id="855e4-125">For example, the presentation tier could use WCF to generate the types automatically, or it could have a copy of a DLL in which those types are defined, or it could just define its own versions of the types.</span></span>  
  
## <a name="retrieving-and-inserting-data"></a><span data-ttu-id="855e4-126">Récupération et insertion de données</span><span class="sxs-lookup"><span data-stu-id="855e4-126">Retrieving and Inserting Data</span></span>  
 <span data-ttu-id="855e4-127">La couche intermédiaire définit une interface qui spécifie la manière dont la couche Présentation accède aux données.</span><span class="sxs-lookup"><span data-stu-id="855e4-127">The middle tier defines an interface that specifies how the presentation tier accesses the data.</span></span> <span data-ttu-id="855e4-128">Par exemple, `GetProductByID(int productID)` ou `GetCustomers()`.</span><span class="sxs-lookup"><span data-stu-id="855e4-128">For example `GetProductByID(int productID)`, or `GetCustomers()`.</span></span> <span data-ttu-id="855e4-129">Sur la couche intermédiaire, le corps de méthode crée en général une nouvelle instance du <xref:System.Data.Linq.DataContext>, exécute une requête sur une ou plusieurs de ses tables.</span><span class="sxs-lookup"><span data-stu-id="855e4-129">On the middle tier, the method body typically creates a new instance of the <xref:System.Data.Linq.DataContext>, executes a query against one or more of its table.</span></span> <span data-ttu-id="855e4-130">La couche intermédiaire retourne ensuite le résultat sous la forme de <xref:System.Collections.Generic.IEnumerable%601>, où `T` est une classe d'entité ou un autre type utilisé pour la sérialisation.</span><span class="sxs-lookup"><span data-stu-id="855e4-130">The middle tier then returns the result as an <xref:System.Collections.Generic.IEnumerable%601>, where `T` is either an entity class or another type that is used for serialization.</span></span> <span data-ttu-id="855e4-131">La couche Présentation n'envoie ni ne reçoit jamais directement de variables de requête vers la couche intermédiaire ou à partir de celle-ci.</span><span class="sxs-lookup"><span data-stu-id="855e4-131">The presentation tier never sends or receives query variables directly to or from the middle tier.</span></span> <span data-ttu-id="855e4-132">Les deux couches échangent des valeurs, des objets et des collections de données concrètes.</span><span class="sxs-lookup"><span data-stu-id="855e4-132">The two tiers exchange values, objects, and collections of concrete data.</span></span> <span data-ttu-id="855e4-133">Après qu’elle a reçu une collection, la couche Présentation peut utiliser [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] to Objects pour effectuer des requêtes si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="855e4-133">After it has received a collection, the presentation tier can use [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] to Objects to query it if necessary.</span></span>  
  
 <span data-ttu-id="855e4-134">Lors de l'insertion de données, la couche Présentation peut générer un nouvel objet et l'envoyer à la couche intermédiaire, ou peut donner à la couche intermédiaire l'instruction de créer l'objet d'après les valeurs qu'elle fournit.</span><span class="sxs-lookup"><span data-stu-id="855e4-134">When inserting data, the presentation tier can construct a new object and send it to the middle tier, or it can have the middle tier construct the object based on values that it provides.</span></span> <span data-ttu-id="855e4-135">En général, la récupération et l'insertion de données dans les applications multicouches ne diffèrent pas beaucoup du processus exécuté dans les applications à deux couches.</span><span class="sxs-lookup"><span data-stu-id="855e4-135">In general, retrieving and inserting data in n-tier applications does not differ much from the process in 2-tier applications.</span></span> <span data-ttu-id="855e4-136">Pour plus d’informations, consultez [interrogation de la base de données](querying-the-database.md) et [création et envoi de modifications de données](making-and-submitting-data-changes.md).</span><span class="sxs-lookup"><span data-stu-id="855e4-136">For more information, see [Querying the Database](querying-the-database.md) and [Making and Submitting Data Changes](making-and-submitting-data-changes.md).</span></span>  
  
## <a name="tracking-changes-for-updates-and-deletes"></a><span data-ttu-id="855e4-137">Suivi des modifications pour les mises à jour et les suppressions</span><span class="sxs-lookup"><span data-stu-id="855e4-137">Tracking Changes for Updates and Deletes</span></span>  
 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="855e4-138">prend en charge l'accès concurrentiel optimiste selon les horodatages (également nommés RowVersions) et les valeurs d'origine.</span><span class="sxs-lookup"><span data-stu-id="855e4-138">supports optimistic concurrency based on timestamps (also named RowVersions) and on original values.</span></span> <span data-ttu-id="855e4-139">Si les tables de base de données contiennent des horodatages, les mises à jour et les suppressions requièrent peu de tâches supplémentaires sur la couche intermédiaire et la couche Présentation.</span><span class="sxs-lookup"><span data-stu-id="855e4-139">If the database tables have timestamps, then updates and deletions require little extra work on either the middle-tier or presentation tier.</span></span> <span data-ttu-id="855e4-140">Toutefois, si vous devez utiliser des valeurs d'origine pour les contrôles d'accès concurrentiel optimiste, la couche Présentation est chargée du suivi de ces valeurs et de leur renvoi en cas de mises à jour.</span><span class="sxs-lookup"><span data-stu-id="855e4-140">However, if you must use original values for optimistic concurrency checks, then the presentation tier is responsible for tracking those values and sending them back when it makes updates.</span></span> <span data-ttu-id="855e4-141">En effet, les modifications apportées aux entités sur la couche Présentation ne sont pas suivies sur la couche intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="855e4-141">This is because changes that were made to entities on the presentation tier are not tracked on the middle tier.</span></span> <span data-ttu-id="855e4-142">En fait, la récupération initiale d'une entité et sa mise à jour éventuelle sont généralement effectuées par deux instances entièrement distinctes du <xref:System.Data.Linq.DataContext>.</span><span class="sxs-lookup"><span data-stu-id="855e4-142">In fact, the original retrieval of an entity, and the eventual update made to it are typically performed by two completely separate instances of the <xref:System.Data.Linq.DataContext>.</span></span>  
  
 <span data-ttu-id="855e4-143">Plus le nombre des modifications effectuées par la couche Présentation est élevé, plus le suivi de ces modifications et leur renvoi sur la couche intermédiaire sont complexes.</span><span class="sxs-lookup"><span data-stu-id="855e4-143">The greater the number of changes that the presentation tier makes, the more complex it becomes to track those changes and package them back to the middle tier.</span></span> <span data-ttu-id="855e4-144">L'implémentation d'un mécanisme permettant de communiquer les modifications est entièrement à la charge de l'application.</span><span class="sxs-lookup"><span data-stu-id="855e4-144">The implementation of a mechanism for communicating changes is completely up to the application.</span></span> <span data-ttu-id="855e4-145">La seule exigence est que les valeurs d’origine requises pour les contrôles d’accès concurrentiel optimiste doivent être fournies à [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)].</span><span class="sxs-lookup"><span data-stu-id="855e4-145">The only requirement is that [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] must be given those original values that are required for optimistic concurrency checks.</span></span>  
  
 <span data-ttu-id="855e4-146">Pour plus d’informations, consultez [extraction de données et opérations CUD dans les applications multicouches (LINQ to SQL)](data-retrieval-and-cud-operations-in-n-tier-applications.md).</span><span class="sxs-lookup"><span data-stu-id="855e4-146">For more information, see [Data Retrieval and CUD Operations in N-Tier Applications (LINQ to SQL)](data-retrieval-and-cud-operations-in-n-tier-applications.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="855e4-147">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="855e4-147">See also</span></span>

- [<span data-ttu-id="855e4-148">Applications multicouches et distantes avec LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="855e4-148">N-Tier and Remote Applications with LINQ to SQL</span></span>](n-tier-and-remote-applications-with-linq-to-sql.md)
- <span data-ttu-id="855e4-149">[Vue d’ensemble du contrôle serveur Web LinqDataSource](https://docs.microsoft.com/previous-versions/aspnet/bb547113(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="855e4-149">[LinqDataSource Web Server Control Overview](https://docs.microsoft.com/previous-versions/aspnet/bb547113(v=vs.100))</span></span>

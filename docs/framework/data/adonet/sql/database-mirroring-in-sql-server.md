---
title: Mise en miroir de bases de données dans SQL Server
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 89befaff-bb46-4290-8382-e67cdb0e3de9
ms.openlocfilehash: 31fb8af4653cefc8027f4061b46b9a29d8d07f8c
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/22/2019
ms.locfileid: "69963985"
---
# <a name="database-mirroring-in-sql-server"></a><span data-ttu-id="8b556-102">Mise en miroir de bases de données dans SQL Server</span><span class="sxs-lookup"><span data-stu-id="8b556-102">Database Mirroring in SQL Server</span></span>
<span data-ttu-id="8b556-103">La mise en miroir des bases de données dans SQL Server vous permet de conserver une copie, ou miroir, d'une base de données SQL Server sur un serveur en veille.</span><span class="sxs-lookup"><span data-stu-id="8b556-103">Database mirroring in SQL Server allows you to keep a copy, or mirror, of a SQL Server database on a standby server.</span></span> <span data-ttu-id="8b556-104">La mise en miroir garantit que deux copies distinctes des données existent en permanence, en offrant une haute disponibilité et une redondance complète des données.</span><span class="sxs-lookup"><span data-stu-id="8b556-104">Mirroring ensures that two separate copies of the data exist at all times, providing high availability and complete data redundancy.</span></span> <span data-ttu-id="8b556-105">Le fournisseur de données .NET pour SQL Server offre une prise en charge implicite de la mise en miroir de base de données, de façon à ce que le développeur ne doive pas exécuter d'action ni écrire de code une fois qu'il a été configuré pour une base de données SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8b556-105">The .NET Data Provider for SQL Server provides implicit support for database mirroring, so that the developer does not need to take any action or write any code once it has been configured for a SQL Server database.</span></span> <span data-ttu-id="8b556-106">En outre, l'objet <xref:System.Data.SqlClient.SqlConnection> prend en charge un mode de connexion explicite qui permet la fourniture du nom d'un serveur partenaire de basculement dans la propriété <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span><span class="sxs-lookup"><span data-stu-id="8b556-106">In addition, the <xref:System.Data.SqlClient.SqlConnection> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
 <span data-ttu-id="8b556-107">La séquence d'événements simplifiée suivante se produit pour un objet <xref:System.Data.SqlClient.SqlConnection> qui vise une base de données configurée pour la mise en miroir :</span><span class="sxs-lookup"><span data-stu-id="8b556-107">The following simplified sequence of events occurs for a <xref:System.Data.SqlClient.SqlConnection> object that targets a database configured for mirroring:</span></span>  
  
1. <span data-ttu-id="8b556-108">L'application cliente se connecte avec succès à la base de données principale et le serveur renvoie le nom du serveur partenaire, qui est ensuite mis en cache sur le client.</span><span class="sxs-lookup"><span data-stu-id="8b556-108">The client application successfully connects to the principal database, and the server sends back the name of the partner server, which is then cached on the client.</span></span>  
  
2. <span data-ttu-id="8b556-109">En cas d’échec du serveur contenant la base de données principale ou d’interruption de la connectivité, l’état de la connexion et de la transaction est perdu.</span><span class="sxs-lookup"><span data-stu-id="8b556-109">If the server containing the principal database fails or connectivity is interrupted, connection and transaction state is lost.</span></span> <span data-ttu-id="8b556-110">L'application cliente tente de rétablir une connexion à la base de données principale et échoue.</span><span class="sxs-lookup"><span data-stu-id="8b556-110">The client application attempts to re-establish a connection to the principal database and fails.</span></span>  
  
3. <span data-ttu-id="8b556-111">L'application cliente tente ensuite de façon transparente d'établir une connexion avec la base de données miroir sur le serveur partenaire.</span><span class="sxs-lookup"><span data-stu-id="8b556-111">The client application then transparently attempts to establish a connection to the mirror database on the partner server.</span></span> <span data-ttu-id="8b556-112">Si elle réussit, la connexion est redirigée vers la base de données miroir qui devient alors la nouvelle base de données principale.</span><span class="sxs-lookup"><span data-stu-id="8b556-112">If it succeeds, the connection is redirected to the mirror database, which then becomes the new principal database.</span></span>  
  
## <a name="specifying-the-failover-partner-in-the-connection-string"></a><span data-ttu-id="8b556-113">Spécification du partenaire de basculement dans la chaîne de connexion</span><span class="sxs-lookup"><span data-stu-id="8b556-113">Specifying the Failover Partner in the Connection String</span></span>  
 <span data-ttu-id="8b556-114">Si vous fournissez le nom d'un serveur partenaire de basculement dans la chaîne de connexion, le client essaie d'établir de façon transparente une connexion avec ce partenaire si la base de données principale est indisponible lors de la première connexion de l'application cliente.</span><span class="sxs-lookup"><span data-stu-id="8b556-114">If you supply the name of a failover partner server in the connection string, the client will transparently attempt a connection with the failover partner if the principal database is unavailable when the client application first connects.</span></span>  
  
```  
";Failover Partner=PartnerServerName"  
```  
  
 <span data-ttu-id="8b556-115">Si vous omettez le nom du serveur partenaire de basculement et que la base de données principale est indisponible lors de la première connexion de l'application cliente, un <xref:System.Data.SqlClient.SqlException> est déclenché.</span><span class="sxs-lookup"><span data-stu-id="8b556-115">If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <xref:System.Data.SqlClient.SqlException> is raised.</span></span>  
  
 <span data-ttu-id="8b556-116">Lorsqu'un <xref:System.Data.SqlClient.SqlConnection> est correctement ouvert, le nom du partenaire de basculement est retourné par le serveur et remplace toute valeur fournie dans la chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="8b556-116">When a <xref:System.Data.SqlClient.SqlConnection> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="8b556-117">Vous devez spécifier explicitement le nom de catalogue ou de base de données initial dans la chaîne de connexion pour les scénarios de mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="8b556-117">You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios.</span></span> <span data-ttu-id="8b556-118">Si le client reçoit des informations de basculement sur une connexion qui n'a pas de base de données ou de catalogue initial spécifié explicitement, les informations de basculement ne sont pas mises en cache et l'application ne tente pas de basculer en cas d'échec du serveur principal.</span><span class="sxs-lookup"><span data-stu-id="8b556-118">If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails.</span></span> <span data-ttu-id="8b556-119">Si une chaîne de connexion a une valeur pour le partenaire de basculement, mais pas de valeur pour la base de donneés ou le catalogue initial, un `InvalidArgumentException` est déclenché.</span><span class="sxs-lookup"><span data-stu-id="8b556-119">If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.</span></span>  
  
## <a name="retrieving-the-current-server-name"></a><span data-ttu-id="8b556-120">Extraction du nom de serveur actuel</span><span class="sxs-lookup"><span data-stu-id="8b556-120">Retrieving the Current Server Name</span></span>  
 <span data-ttu-id="8b556-121">En cas de basculement, vous pouvez extraire le nom du serveur auquel la connexion actuelle est réellement connectée en utilisant la propriété <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> d'un objet <xref:System.Data.SqlClient.SqlConnection>.</span><span class="sxs-lookup"><span data-stu-id="8b556-121">In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> property of a <xref:System.Data.SqlClient.SqlConnection> object.</span></span> <span data-ttu-id="8b556-122">Le fragment de code suivant extrait le nom du serveur actif, en partant de l'hypothèse que la variable de connexion fait référence à un <xref:System.Data.SqlClient.SqlConnection> ouvert.</span><span class="sxs-lookup"><span data-stu-id="8b556-122">The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <xref:System.Data.SqlClient.SqlConnection>.</span></span>  
  
 <span data-ttu-id="8b556-123">Lorsqu’un événement de basculement se produit et que la connexion est basculée vers le serveur miroir, la propriété **DataSource** est mise à jour pour refléter le nom du miroir.</span><span class="sxs-lookup"><span data-stu-id="8b556-123">When a failover event occurs and the connection is switched to the mirror server, the **DataSource** property is updated to reflect the mirror name.</span></span>  
  
```vb  
Dim activeServer As String = connection.DataSource  
```  
  
```csharp  
string activeServer = connection.DataSource;  
```  
  
## <a name="sqlclient-mirroring-behavior"></a><span data-ttu-id="8b556-124">Comportement de mise en miroir de SqlClient</span><span class="sxs-lookup"><span data-stu-id="8b556-124">SqlClient Mirroring Behavior</span></span>  
 <span data-ttu-id="8b556-125">Le client tente toujours de se connecter au serveur principal actuel.</span><span class="sxs-lookup"><span data-stu-id="8b556-125">The client always tries to connect to the current principal server.</span></span> <span data-ttu-id="8b556-126">S'il échoue, il essaie le partenaire de basculement.</span><span class="sxs-lookup"><span data-stu-id="8b556-126">If it fails, it tries the failover partner.</span></span> <span data-ttu-id="8b556-127">Si la base de données miroir a déjà été basculée vers le rôle principal sur le serveur partenaire, la connexion réussit et le nouveau mappage miroir-principal est envoyé au client et mis en cache pendant la durée de l'appel <xref:System.AppDomain>.</span><span class="sxs-lookup"><span data-stu-id="8b556-127">If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <xref:System.AppDomain>.</span></span> <span data-ttu-id="8b556-128">Il n’est pas stocké dans un stockage persistant et n’est pas disponible pour les connexions suivantes dans un **AppDomain** ou processus différent.</span><span class="sxs-lookup"><span data-stu-id="8b556-128">It is not stored in persistent storage and is not available for subsequent connections in a different **AppDomain** or process.</span></span> <span data-ttu-id="8b556-129">Toutefois, il est disponible pour les connexions suivantes dans le même **AppDomain**.</span><span class="sxs-lookup"><span data-stu-id="8b556-129">However, it is available for subsequent connections within the same **AppDomain**.</span></span> <span data-ttu-id="8b556-130">Notez qu’un autre **AppDomain** ou processus s’exécutant sur le même ordinateur ou sur un autre ordinateur dispose toujours d’un pool de connexions et que ces connexions ne sont pas réinitialisées.</span><span class="sxs-lookup"><span data-stu-id="8b556-130">Note that another **AppDomain** or process running on the same or a different computer always has its pool of connections, and those connections are not reset.</span></span> <span data-ttu-id="8b556-131">Dans ce cas, si la base de données primaire tombe en panne, chaque processus ou **AppDomain** échoue une fois et le pool est automatiquement effacé.</span><span class="sxs-lookup"><span data-stu-id="8b556-131">In that case, if the primary database goes down, each process or **AppDomain** fails once, and the pool is automatically cleared.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="8b556-132">La prise en charge de la mise en miroir sur le serveur est configurée pour chaque base de données.</span><span class="sxs-lookup"><span data-stu-id="8b556-132">Mirroring support on the server is configured on a per-database basis.</span></span> <span data-ttu-id="8b556-133">Si des opérations de manipulation des données sont exécutées sur d'autres bases de données non incluses dans l'ensemble principal/miroir, soit en utilisant des noms multipart, soit en modifiant la base de données en cours, les modifications apportées à ces autres bases de données ne sont pas propagées en cas d'échec.</span><span class="sxs-lookup"><span data-stu-id="8b556-133">If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure.</span></span> <span data-ttu-id="8b556-134">Aucune erreur n'est générée en cas de modification des données d'une base de données non mise en miroir.</span><span class="sxs-lookup"><span data-stu-id="8b556-134">No error is generated when data is modified in a database that is not mirrored.</span></span> <span data-ttu-id="8b556-135">Le développeur doit évoluer l'impact possible de telles opérations.</span><span class="sxs-lookup"><span data-stu-id="8b556-135">The developer must evaluate the possible impact of such operations.</span></span>  
  
## <a name="database-mirroring-resources"></a><span data-ttu-id="8b556-136">Ressources relatives à la mise en miroir de bases de données</span><span class="sxs-lookup"><span data-stu-id="8b556-136">Database Mirroring Resources</span></span>  
 <span data-ttu-id="8b556-137">Pour obtenir de la documentation conceptuelle et des informations sur la configuration, le déploiement et l’administration de la mise en miroir, consultez les ressources suivantes dans SQL Server Documentation.</span><span class="sxs-lookup"><span data-stu-id="8b556-137">For conceptual documentation and information on configuring, deploying and administering mirroring, see the following resources in SQL Server documentation.</span></span>  
  
|<span data-ttu-id="8b556-138">Ressource</span><span class="sxs-lookup"><span data-stu-id="8b556-138">Resource</span></span>|<span data-ttu-id="8b556-139">Description</span><span class="sxs-lookup"><span data-stu-id="8b556-139">Description</span></span>|  
|--------------|-----------------|  
|[<span data-ttu-id="8b556-140">Mise en miroir de bases de données</span><span class="sxs-lookup"><span data-stu-id="8b556-140">Database Mirroring</span></span>](/sql/database-engine/database-mirroring/database-mirroring-sql-server)|<span data-ttu-id="8b556-141">Décrit comment installer et configurer la mise en miroir dans SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8b556-141">Describes how to set up and configure mirroring in SQL Server.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="8b556-142">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="8b556-142">See also</span></span>

- [<span data-ttu-id="8b556-143">Fournisseurs managés ADO.NET et centre de développement DataSet</span><span class="sxs-lookup"><span data-stu-id="8b556-143">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)

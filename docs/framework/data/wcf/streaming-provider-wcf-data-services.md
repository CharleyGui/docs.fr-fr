---
title: Fournisseurs de diffusion en continu (WCF Data Services)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, providers
- WCF Data Services, binary data
- streaming data provider [WCF Data Services]
- WCF Data Services, streams
ms.assetid: f0978fe4-5f9f-42aa-a5c2-df395d7c9495
ms.openlocfilehash: a5793eae92ffdfa65872c93273bd7cfefdc6f674
ms.sourcegitcommit: 79a2d6a07ba4ed08979819666a0ee6927bbf1b01
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74568808"
---
# <a name="streaming-provider-wcf-data-services"></a><span data-ttu-id="bd33f-102">Fournisseurs de diffusion en continu (WCF Data Services)</span><span class="sxs-lookup"><span data-stu-id="bd33f-102">Streaming Provider (WCF Data Services)</span></span>

<span data-ttu-id="bd33f-103">Un service de données peut exposer des données Large Object Binary.</span><span class="sxs-lookup"><span data-stu-id="bd33f-103">A data service can expose large object binary data.</span></span> <span data-ttu-id="bd33f-104">Ces données binaires peuvent représenter des flux vidéo et audio, des images, des fichiers de document ou d'autres types de supports binaires.</span><span class="sxs-lookup"><span data-stu-id="bd33f-104">This binary data might represent video and audio streams, images, document files, or other types of binary media.</span></span> <span data-ttu-id="bd33f-105">Lorsqu'une entité du modèle de données inclut une ou plusieurs propriétés binaires, le service de données retourne ces données binaires encodées en Base 64 au sein de l'entrée dans le flux de réponse.</span><span class="sxs-lookup"><span data-stu-id="bd33f-105">When an entity in the data model includes one or more binary properties, the data service returns this binary data encoded as base-64 inside the entry in the response feed.</span></span> <span data-ttu-id="bd33f-106">Étant donné que le chargement et la sérialisation de données binaires volumineuses de cette manière peuvent affecter les performances, le Open Data Protocol (OData) définit un mécanisme de récupération des données binaires indépendantes de l’entité à laquelle elles appartiennent.</span><span class="sxs-lookup"><span data-stu-id="bd33f-106">Because loading and serializing large binary data in this manner can affect performance, the Open Data Protocol (OData) defines a mechanism for retrieving binary data independent of the entity to which it belongs.</span></span> <span data-ttu-id="bd33f-107">Cela s'effectue en séparant l'entité et les données binaires de l'entité dans un ou plusieurs flux de données</span><span class="sxs-lookup"><span data-stu-id="bd33f-107">This is accomplished by separating the binary data from the entity into one or more data streams.</span></span>

- <span data-ttu-id="bd33f-108">Ressource multimédia : données binaires qui appartiennent à une entité, telle qu'une vidéo, du son, une image ou d'autres types de flux de ressources multimédias.</span><span class="sxs-lookup"><span data-stu-id="bd33f-108">Media resource - binary data that belongs to an entity, such as a video, audio, image or other type of media resource stream.</span></span>

- <span data-ttu-id="bd33f-109">Entrée de lien média : une entité ayant une référence à un flux de ressources multimédias associé.</span><span class="sxs-lookup"><span data-stu-id="bd33f-109">Media link entry - an entity that has a reference to a related media resource stream.</span></span>

<span data-ttu-id="bd33f-110">Avec WCF Data Services, vous définissez un flux de ressources binaires en implémentant un fournisseur de données de streaming.</span><span class="sxs-lookup"><span data-stu-id="bd33f-110">With WCF Data Services, you define a binary resource stream by implementing a streaming data provider.</span></span> <span data-ttu-id="bd33f-111">L’implémentation du fournisseur de diffusion en continu fournit le service de données avec le flux de ressources multimédia associé à une entité spécifique sous la forme d’un objet <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="bd33f-111">The streaming provider implementation supplies the data service with the media resource stream associated with a specific entity as an <xref:System.IO.Stream> object.</span></span> <span data-ttu-id="bd33f-112">Cette implémentation permet au service de données d'accepter et de retourner les ressources multimédias sur HTTP sous forme de flux de données binaires d'un type MIME spécifié.</span><span class="sxs-lookup"><span data-stu-id="bd33f-112">This implementation enables the data service to accept and return media resources over HTTP as binary data streams of a specified MIME type.</span></span>

<span data-ttu-id="bd33f-113">La configuration d'un service de données afin de prendre en charge la diffusion en continu de données binaires requiert les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="bd33f-113">Configuring a data service to support the streaming of binary data requires the following steps:</span></span>

1. <span data-ttu-id="bd33f-114">Attribuer une ou plusieurs entités dans le modèle de données comme entrées de lien média.</span><span class="sxs-lookup"><span data-stu-id="bd33f-114">Attribute one or more entities in the data model as a media link entry.</span></span> <span data-ttu-id="bd33f-115">Ces entités ne doivent pas inclure les données binaires à transmettre en continu.</span><span class="sxs-lookup"><span data-stu-id="bd33f-115">These entities should not include the binary data to be streamed.</span></span> <span data-ttu-id="bd33f-116">Les propriétés binaires d'une entité sont toujours retournées dans l'entrée comme des données binaires encodées Base 64.</span><span class="sxs-lookup"><span data-stu-id="bd33f-116">Any binary properties of an entity are always returned in the entry as base-64 encoded binary.</span></span>

2. <span data-ttu-id="bd33f-117">Implémentation de l'interface T:System.Data.Services.Providers.IDataServiceStreamProvider</span><span class="sxs-lookup"><span data-stu-id="bd33f-117">Implement the T:System.Data.Services.Providers.IDataServiceStreamProvider interface.</span></span>

3. <span data-ttu-id="bd33f-118">Définir un service de données qui implémente l'interface <xref:System.IServiceProvider>.</span><span class="sxs-lookup"><span data-stu-id="bd33f-118">Define a data service that implements the <xref:System.IServiceProvider> interface.</span></span> <span data-ttu-id="bd33f-119">Le service de données utilise l'implémentation <xref:System.IServiceProvider.GetService%2A> pour accéder à l'implémentation du fournisseur de données en continu.</span><span class="sxs-lookup"><span data-stu-id="bd33f-119">The data service uses the <xref:System.IServiceProvider.GetService%2A> implementation to access the streaming data provider implementation.</span></span> <span data-ttu-id="bd33f-120">Cette méthode retourne l'implémentation de fournisseur de données en continu appropriée.</span><span class="sxs-lookup"><span data-stu-id="bd33f-120">This method returns the appropriate streaming provider implementation.</span></span>

4. <span data-ttu-id="bd33f-121">Autoriser des flux de messages volumineux dans la configuration de l'application Web.</span><span class="sxs-lookup"><span data-stu-id="bd33f-121">Enable large message streams in the Web application configuration.</span></span>

5. <span data-ttu-id="bd33f-122">Activer l'accès aux ressources binaires sur le serveur ou dans une source de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-122">Enable access to binary resources on the server or in a data source.</span></span>

<span data-ttu-id="bd33f-123">Les exemples de cette rubrique sont basés sur un exemple de service de diffusion de photos en continu, qui est abordé en détail dans la série publication de fournisseurs de diffusion en continu [Data Services : implémentation d’un fournisseur de diffusion en continu (partie 1)](https://go.microsoft.com/fwlink/?LinkID=198989).</span><span class="sxs-lookup"><span data-stu-id="bd33f-123">The examples in this topic are based on a sample streaming photo service, which is discussed in depth in the post [Data Services Streaming Provider Series: Implementing a Streaming Provider (Part 1)](https://go.microsoft.com/fwlink/?LinkID=198989).</span></span> <span data-ttu-id="bd33f-124">Le code source de cet exemple de service est disponible sur la page de l' [exemple streaming photo service](https://go.microsoft.com/fwlink/?LinkID=198988) dans la Galerie de code MSDN.</span><span class="sxs-lookup"><span data-stu-id="bd33f-124">The source code for this sample service is available on the [Streaming Photo Data Service Sample page](https://go.microsoft.com/fwlink/?LinkID=198988) on MSDN Code Gallery.</span></span>

## <a name="defining-a-media-link-entry-in-the-data-model"></a><span data-ttu-id="bd33f-125">Définition d'une entrée de lien média dans le modèle de données</span><span class="sxs-lookup"><span data-stu-id="bd33f-125">Defining a Media Link Entry in the Data Model</span></span>

<span data-ttu-id="bd33f-126">Le fournisseur de sources de données détermine la façon dont une entité est définie comme une entrée de lien média dans le modèle de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-126">The data source provider determines the way that an entity is defined as a media link entry in the data model.</span></span>

<span data-ttu-id="bd33f-127">**Fournisseur Entity Framework**</span><span class="sxs-lookup"><span data-stu-id="bd33f-127">**Entity Framework Provider**</span></span>

<span data-ttu-id="bd33f-128">Pour indiquer qu'une entité est une entrée de lien média, ajoutez l'attribut `HasStream` à la définition du type d'entité dans le modèle conceptuel, comme dans l'exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="bd33f-128">To indicate that an entity is a media link entry, add the `HasStream` attribute to the entity type definition in the conceptual model, as in the following example:</span></span>

[!code-xml[Astoria Photo Streaming Service#HasStream](../../../../samples/snippets/xml/VS_Snippets_Misc/astoria_photo_streaming_service/xml/photodata.edmx#hasstream)]

<span data-ttu-id="bd33f-129">Vous devez également ajouter l'espace de noms `xmlns:m=http://schemas.microsoft.com/ado/2007/08/dataservices/metadata` à l'entité ou à la racine du fichier .edmx ou .csdl qui définit le modèle de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-129">You must also add the namespace `xmlns:m=http://schemas.microsoft.com/ado/2007/08/dataservices/metadata` either to the entity or to the root of the .edmx or .csdl file that defines the data model.</span></span>

<span data-ttu-id="bd33f-130">Pour obtenir un exemple de service de données qui utilise le fournisseur de Entity Framework et expose une ressource multimédia, consultez la [série publication de fournisseurs de diffusion en continu Data Services : implémentation d’un fournisseur de diffusion en continu (partie 1)](https://go.microsoft.com/fwlink/?LinkID=198989).</span><span class="sxs-lookup"><span data-stu-id="bd33f-130">For an example of a data service that uses the Entity Framework provider and exposes a media resource, see the post [Data Services Streaming Provider Series: Implementing a Streaming Provider (Part 1)](https://go.microsoft.com/fwlink/?LinkID=198989).</span></span>

<span data-ttu-id="bd33f-131">**Fournisseur de réflexion**</span><span class="sxs-lookup"><span data-stu-id="bd33f-131">**Reflection Provider**</span></span>

<span data-ttu-id="bd33f-132">Pour indiquer qu'une entité est une entrée de lien média, ajoutez l'objet <xref:System.Data.Services.Common.HasStreamAttribute> à la classe qui définit le type d'entité dans le fournisseur de réflexion.</span><span class="sxs-lookup"><span data-stu-id="bd33f-132">To indicate that an entity is a media link entry, add the <xref:System.Data.Services.Common.HasStreamAttribute> to the class that defines the entity type in the reflection provider.</span></span>

<span data-ttu-id="bd33f-133">**Fournisseur de services de données personnalisé**</span><span class="sxs-lookup"><span data-stu-id="bd33f-133">**Custom Data Service Provider**</span></span>

<span data-ttu-id="bd33f-134">Lorsque vous utilisez des fournisseurs de services personnalisés, vous implémentez l'interface <xref:System.Data.Services.Providers.IDataServiceMetadataProvider> pour définir les métadonnées pour votre service de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-134">When using custom service providers, you implement the <xref:System.Data.Services.Providers.IDataServiceMetadataProvider> interface to define the metadata for your data service.</span></span> <span data-ttu-id="bd33f-135">Pour plus d’informations, consultez [fournisseurs de services de données personnalisés](custom-data-service-providers-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="bd33f-135">For more information, see [Custom Data Service Providers](custom-data-service-providers-wcf-data-services.md).</span></span> <span data-ttu-id="bd33f-136">Vous indiquez qu'un flux de ressources binaires appartient à <xref:System.Data.Services.Providers.ResourceType> en définissant la propriété <xref:System.Data.Services.Providers.ResourceType.IsMediaLinkEntry%2A> sur `true` sur le <xref:System.Data.Services.Providers.ResourceType> qui représente le type d'entité, qui est une entrée de lien média.</span><span class="sxs-lookup"><span data-stu-id="bd33f-136">You indicate that a binary resource stream belongs to a <xref:System.Data.Services.Providers.ResourceType> by setting the <xref:System.Data.Services.Providers.ResourceType.IsMediaLinkEntry%2A> property to `true` on the <xref:System.Data.Services.Providers.ResourceType> that represents the entity type, which is a media link entry.</span></span>

## <a name="implementing-the-idataservicestreamprovider-interface"></a><span data-ttu-id="bd33f-137">Implémentation de l'interface IDataServiceStreamProvider</span><span class="sxs-lookup"><span data-stu-id="bd33f-137">Implementing the IDataServiceStreamProvider Interface</span></span>

<span data-ttu-id="bd33f-138">Pour créer un service de données qui prend en charge les flux de données binaires, vous devez implémenter l'interface <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span><span class="sxs-lookup"><span data-stu-id="bd33f-138">To create a data service that supports binary data streams, you must implement the <xref:System.Data.Services.Providers.IDataServiceStreamProvider> interface.</span></span> <span data-ttu-id="bd33f-139">Cette implémentation permet au service de données de retourner les données binaires comme un flux de données au client et de consommer les données binaires comme un flux de données transmis par le client.</span><span class="sxs-lookup"><span data-stu-id="bd33f-139">This implementation enables the data service to return binary data as a stream to the client and consume binary data as a stream sent from the client.</span></span> <span data-ttu-id="bd33f-140">Ce service de données crée une instance de cette interface chaque fois qu'il doit accéder aux données binaires sous forme de flux de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-140">The data service creates an instance of this interface whenever it needs to access binary data as a stream.</span></span> <span data-ttu-id="bd33f-141">L'interface <xref:System.Data.Services.Providers.IDataServiceStreamProvider> spécifie les membres suivants.</span><span class="sxs-lookup"><span data-stu-id="bd33f-141">The <xref:System.Data.Services.Providers.IDataServiceStreamProvider> interface specifies the following members:</span></span>

|<span data-ttu-id="bd33f-142">Nom du membre</span><span class="sxs-lookup"><span data-stu-id="bd33f-142">Member name</span></span>|<span data-ttu-id="bd33f-143">Description</span><span class="sxs-lookup"><span data-stu-id="bd33f-143">Description</span></span>|
|-----------------|-----------------|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>|<span data-ttu-id="bd33f-144">Cette méthode est appelée par le service de données pour supprimer la ressource multimédia correspondante lorsque son entrée de lien média est supprimée.</span><span class="sxs-lookup"><span data-stu-id="bd33f-144">This method is invoked by the data service to delete the corresponding media resource when its media link entry is deleted.</span></span> <span data-ttu-id="bd33f-145">Lorsque vous implémentez <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, cette méthode contient le code qui supprime la ressource multimédia associé à l'entrée de lien média fournie.</span><span class="sxs-lookup"><span data-stu-id="bd33f-145">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, this method contains the code that deletes the media resource associated with the supplied media link entry.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A>|<span data-ttu-id="bd33f-146">Cette méthode est appelée par le service de données pour retourner une ressource multimédia sous forme de flux de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-146">This method is invoked by the data service to return a media resource as a stream.</span></span> <span data-ttu-id="bd33f-147">Lorsque vous implémentez <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, cette méthode contient le code qui fournit un flux de données utilisé par le service de données pour retourner la ressource multimédia associée à l'entrée de lien média fournie.</span><span class="sxs-lookup"><span data-stu-id="bd33f-147">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, this method contains the code that provides a stream that is used by the data service to the return media resource that is associated with the provided media link entry.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStreamUri%2A>|<span data-ttu-id="bd33f-148">Cette méthode est appelée par le service de données pour retourner l'URI utilisé pour demander la ressource multimédia pour l'entrée de lien média.</span><span class="sxs-lookup"><span data-stu-id="bd33f-148">This method is invoked by the data service to return the URI that is used to request the media resource for the media link entry.</span></span> <span data-ttu-id="bd33f-149">Cette valeur est utilisée pour créer l'attribut `src` dans l'élément de contenu de l'entrée de lien média et qui est utilisé pour demander le flux de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-149">This value is used to create the `src` attribute in the content element of the media link entry and that is used to request the data stream.</span></span> <span data-ttu-id="bd33f-150">Lorsque cette méthode retourne `null`, le service de données détermine automatiquement l'URI.</span><span class="sxs-lookup"><span data-stu-id="bd33f-150">When this method returns `null`, the data service automatically determines the URI.</span></span> <span data-ttu-id="bd33f-151">Utilisez cette méthode lorsque vous devez fournir aux clients un accès direct aux données binaires sans utiliser le fournisseur de flux.</span><span class="sxs-lookup"><span data-stu-id="bd33f-151">Use this method when you need to provide clients with direct access to binary data without using the steam provider.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetStreamContentType%2A>|<span data-ttu-id="bd33f-152">Cette méthode est appelée par le service de données pour retourner la valeur Content-Type de la ressource multimédia associée à l'entrée de lien média spécifiée.</span><span class="sxs-lookup"><span data-stu-id="bd33f-152">This method is invoked by the data service to return the Content-Type value of the media resource that is associated with the specified media link entry.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetStreamETag%2A>|<span data-ttu-id="bd33f-153">Cette méthode est appelée par le service de données pour retourner l'eTag du flux de données associé à l'entité spécifiée.</span><span class="sxs-lookup"><span data-stu-id="bd33f-153">This method is invoked by the data service to return the eTag of the data stream that is associated with the specified entity.</span></span> <span data-ttu-id="bd33f-154">Cette méthode est utilisée lorsque vous gérez l'accès concurrentiel des données binaires.</span><span class="sxs-lookup"><span data-stu-id="bd33f-154">This method is used when you manage concurrency for the binary data.</span></span> <span data-ttu-id="bd33f-155">Lorsque cette méthode retourne la valeur null, le service de données ne suit pas l'accès concurrentiel.</span><span class="sxs-lookup"><span data-stu-id="bd33f-155">When this method returns null, the data service does not track concurrency.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A>|<span data-ttu-id="bd33f-156">Cette méthode est appelée par le service de données pour obtenir le flux de données utilisé lors de la réception du flux de données transmis par le client.</span><span class="sxs-lookup"><span data-stu-id="bd33f-156">This method is invoked by the data service to obtain the stream that is used when receiving the stream sent from the client.</span></span> <span data-ttu-id="bd33f-157">Lorsque vous implémentez <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, vous devez retourner un flux de données accessible en écriture sur lequel le service de données écrit le flux de données reçues.</span><span class="sxs-lookup"><span data-stu-id="bd33f-157">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, you must return a writable stream to which the data service writes received stream data.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.ResolveType%2A>|<span data-ttu-id="bd33f-158">Retourne un nom de type qualifié par un espace de noms qui représente le type que le runtime du service de données doit créer pour l'entrée de lien média associée au flux de données pour la ressource multimédia insérée.</span><span class="sxs-lookup"><span data-stu-id="bd33f-158">Returns a namespace-qualified type name that represents the type that the data service runtime must create for the media link entry that is associated with the data stream for the media resource that is being inserted.</span></span>|

## <a name="creating-the-streaming-data-service"></a><span data-ttu-id="bd33f-159">Création du service de données en continu</span><span class="sxs-lookup"><span data-stu-id="bd33f-159">Creating the Streaming Data Service</span></span>

<span data-ttu-id="bd33f-160">Pour permettre au runtime WCF Data Services d’accéder à l’implémentation de <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, le service de données que vous créez doit également implémenter l’interface <xref:System.IServiceProvider>.</span><span class="sxs-lookup"><span data-stu-id="bd33f-160">To provide the WCF Data Services runtime with access to the <xref:System.Data.Services.Providers.IDataServiceStreamProvider> implementation, the data service that you create must also implement the <xref:System.IServiceProvider> interface.</span></span> <span data-ttu-id="bd33f-161">L'exemple de code suivant illustre l'implémentation de la méthode <xref:System.IServiceProvider.GetService%2A> pour retourner une instance de classe `PhotoServiceStreamProvider` qui implémente <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span><span class="sxs-lookup"><span data-stu-id="bd33f-161">The following example shows how to implement the <xref:System.IServiceProvider.GetService%2A> method to return an instance of the `PhotoServiceStreamProvider` class that implements <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span></span>

[!code-csharp[Astoria Photo Streaming Service#PhotoServiceStreamingProvider](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_service/cs/photodata.svc.cs#photoservicestreamingprovider)]
[!code-vb[Astoria Photo Streaming Service#PhotoServiceStreamingProvider](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_service/vb/photodata.svc.vb#photoservicestreamingprovider)]

<span data-ttu-id="bd33f-162">Pour obtenir des informations générales sur la création d’un service de données, consultez [configuration du service de données](configuring-the-data-service-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="bd33f-162">For general information about how to create a data service, see [Configuring the Data Service](configuring-the-data-service-wcf-data-services.md).</span></span>

## <a name="enabling-large-binary-streams-in-the-hosting-environment"></a><span data-ttu-id="bd33f-163">Activation de flux binaires volumineux dans l'environnement d'hébergement</span><span class="sxs-lookup"><span data-stu-id="bd33f-163">Enabling Large Binary Streams in the Hosting Environment</span></span>

<span data-ttu-id="bd33f-164">Lorsque vous créez un service de données dans une application Web ASP.NET, Windows Communication Foundation (WCF) est utilisé pour fournir l’implémentation du protocole HTTP.</span><span class="sxs-lookup"><span data-stu-id="bd33f-164">When you create a data service in an ASP.NET Web application, Windows Communication Foundation (WCF) is used to provide the HTTP protocol implementation.</span></span> <span data-ttu-id="bd33f-165">Par défaut, WCF limite la taille des messages HTTP à 65 kilo-octets.</span><span class="sxs-lookup"><span data-stu-id="bd33f-165">By default, WCF limits the size of HTTP messages to only 65K bytes.</span></span> <span data-ttu-id="bd33f-166">Pour pouvoir transmettre en continu des données binaires volumineuses depuis et vers le service de données, vous devez également configurer l'application Web pour autoriser les fichiers binaires volumineux et utiliser des flux de données pour le transfert.</span><span class="sxs-lookup"><span data-stu-id="bd33f-166">To be able to stream large binary data to and from the data service, you must also configure the Web application to enable large binary files and to use streams for transfer.</span></span> <span data-ttu-id="bd33f-167">Pour cela, ajoutez les éléments suivants dans l'élément `<configuration />` du fichier Web.config de l'application :</span><span class="sxs-lookup"><span data-stu-id="bd33f-167">To do this, add the following in the `<configuration />` element of the application's Web.config file:</span></span>

> [!NOTE]
> <span data-ttu-id="bd33f-168">Vous devez utiliser un mode de transfert <xref:System.ServiceModel.TransferMode.Streamed?displayProperty=nameWithType> pour vous assurer que les données binaires dans les messages de demande et de réponse sont diffusées en continu et ne sont pas mises en mémoire tampon par WCF.</span><span class="sxs-lookup"><span data-stu-id="bd33f-168">You must use a <xref:System.ServiceModel.TransferMode.Streamed?displayProperty=nameWithType> transfer mode to ensure that the binary data in both the request and response messages are streamed and not buffered by WCF.</span></span>

<span data-ttu-id="bd33f-169">Pour plus d’informations, consultez [transfert de messages en continu](../../wcf/feature-details/streaming-message-transfer.md) et quotas de [transport](../../wcf/feature-details/transport-quotas.md).</span><span class="sxs-lookup"><span data-stu-id="bd33f-169">For more information, see [Streaming Message Transfer](../../wcf/feature-details/streaming-message-transfer.md) and [Transport Quotas](../../wcf/feature-details/transport-quotas.md).</span></span>

<span data-ttu-id="bd33f-170">Par défaut, Internet Information Services (IIS) limite également la taille des demandes à 4 Mo.</span><span class="sxs-lookup"><span data-stu-id="bd33f-170">By default, Internet Information Services (IIS) also limits the size of requests to 4MB.</span></span> <span data-ttu-id="bd33f-171">Pour permettre à votre service de données de recevoir des flux d’une taille supérieure à 4 Mo lorsqu’ils s’exécutent sur IIS, vous devez également définir l’attribut `maxRequestLength` de l' [élément httpRuntime (schéma des paramètres ASP.net)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/e1f13641(v=vs.100)) dans la section de configuration `<system.web />`, comme indiqué dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="bd33f-171">To enable your data service to receive streams larger than 4MB when running on IIS, you must also set the `maxRequestLength` attribute of the [httpRuntime Element (ASP.NET Settings Schema)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/e1f13641(v=vs.100)) in the `<system.web />` configuration section, as shown in the following example:</span></span>

## <a name="using-data-streams-in-a-client-application"></a><span data-ttu-id="bd33f-172">Utilisation de flux de données en continu dans une application cliente</span><span class="sxs-lookup"><span data-stu-id="bd33f-172">Using Data Streams in a Client Application</span></span>

<span data-ttu-id="bd33f-173">La bibliothèque cliente WCF Data Services vous permet de récupérer et de mettre à jour ces ressources exposées sous forme de flux binaires sur le client.</span><span class="sxs-lookup"><span data-stu-id="bd33f-173">The WCF Data Services client library enables you to both retrieve and update these exposed resources as binary streams on the client.</span></span> <span data-ttu-id="bd33f-174">Pour plus d’informations, consultez [utilisation de données binaires](working-with-binary-data-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="bd33f-174">For more information, see [Working with Binary Data](working-with-binary-data-wcf-data-services.md).</span></span>

## <a name="considerations-for-working-with-a-streaming-provider"></a><span data-ttu-id="bd33f-175">Remarques sur l'utilisation d'un fournisseur de diffusion en continu</span><span class="sxs-lookup"><span data-stu-id="bd33f-175">Considerations for Working with a Streaming Provider</span></span>

<span data-ttu-id="bd33f-176">Les éléments suivants sont à prendre en compte lorsque vous implémentez un fournisseur de diffusion en continu et lorsque vous accédez aux ressources multimédias d'un service de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-176">The following are things to consider when you implement a streaming provider and when you access media resources from a data service.</span></span>

- <span data-ttu-id="bd33f-177">Les demandes MERGE ne sont pas prises en charge pour les ressources multimédias.</span><span class="sxs-lookup"><span data-stu-id="bd33f-177">MERGE requests are not supported for media resources.</span></span> <span data-ttu-id="bd33f-178">Utilisez une demande PUT pour modifier la ressource multimédia d'une entité existante.</span><span class="sxs-lookup"><span data-stu-id="bd33f-178">Use a PUT request to change the media resource of an existing entity.</span></span>

- <span data-ttu-id="bd33f-179">Une requête POST ne peut pas être utilisée pour créer une entrée de lien média.</span><span class="sxs-lookup"><span data-stu-id="bd33f-179">A POST request cannot be used to create a new media link entry.</span></span> <span data-ttu-id="bd33f-180">Vous devez plutôt émettre une requête POST pour créer une ressource multimédia. Le service de données crée alors une entrée de lien média avec les valeurs par défaut.</span><span class="sxs-lookup"><span data-stu-id="bd33f-180">Instead, you must issue a POST request to create a new media resource, and the data service creates a new media link entry with default values.</span></span> <span data-ttu-id="bd33f-181">Cette nouvelle entité peut être mise à jour par une demande MERGE ou PUT ultérieure.</span><span class="sxs-lookup"><span data-stu-id="bd33f-181">This new entity can be updated by a subsequent MERGE or PUT request.</span></span> <span data-ttu-id="bd33f-182">Vous pouvez également envisager de mettre en cache l'entité et de faire des mises à jour dans le dispositif de nettoyage, par exemple d'affecter à la propriété la valeur de l'en-tête Slug dans la requête POST.</span><span class="sxs-lookup"><span data-stu-id="bd33f-182">You may also consider caching the entity and make updates in the disposer, such as setting the property value to the value of the Slug header in the POST request.</span></span>

- <span data-ttu-id="bd33f-183">Lorsqu'une requête POST est reçue, le service de données appelle la méthode <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> pour créer la ressource multimédia avant d'appeler la méthode <xref:System.Data.Services.IUpdatable.SaveChanges%2A> pour créer l'entrée de lien média.</span><span class="sxs-lookup"><span data-stu-id="bd33f-183">When a POST request is received, the data service calls <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> to create the media resource before it calls <xref:System.Data.Services.IUpdatable.SaveChanges%2A> to create the media link entry.</span></span>

- <span data-ttu-id="bd33f-184">Une implémentation de la méthode <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> ne doit pas retourner d'objet <xref:System.IO.MemoryStream>.</span><span class="sxs-lookup"><span data-stu-id="bd33f-184">An implementation of <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> should not return a <xref:System.IO.MemoryStream> object.</span></span> <span data-ttu-id="bd33f-185">Si vous utilisez ce type de flux de données, des problèmes de ressource mémoire se produiront lorsque le service recevra des flux de données très volumineux.</span><span class="sxs-lookup"><span data-stu-id="bd33f-185">When you use this kind of stream, memory resource issues will occur when the service receives very large data streams.</span></span>

- <span data-ttu-id="bd33f-186">Voici des éléments à prendre en compte lors du stockage de ressources multimédias dans une base de données :</span><span class="sxs-lookup"><span data-stu-id="bd33f-186">The following are things to consider when storing media resources in a database:</span></span>

  - <span data-ttu-id="bd33f-187">Une propriété binaire qui est une ressource multimédia ne doit pas être incluse dans le modèle de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-187">A binary property that is a media resource should not be included in the data model.</span></span> <span data-ttu-id="bd33f-188">Toutes les propriétés exposées dans un modèle de données sont retournées dans l'entrée dans un flux de réponse.</span><span class="sxs-lookup"><span data-stu-id="bd33f-188">All properties exposed in a data model are returned in the entry in a response feed.</span></span>

  - <span data-ttu-id="bd33f-189">Pour améliorer les performances avec des flux binaires volumineux, nous vous conseillons de créer une classe de flux de données personnalisée pour stocker les données binaires dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-189">To improve performance with a large binary stream, we recommend that you create a custom stream class to store binary data in the database.</span></span> <span data-ttu-id="bd33f-190">Cette classe est retournée par votre implémentation de <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> et transmet les données binaires à la base de données par segments.</span><span class="sxs-lookup"><span data-stu-id="bd33f-190">This class is returned by your <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> implementation and sends the binary data to the database in chunks.</span></span> <span data-ttu-id="bd33f-191">Pour une base de données SQL Server, nous vous recommandons d’utiliser un FILESTREAM pour diffuser en continu des données dans la base de données lorsque la taille des données binaires est supérieure à 1 Mo.</span><span class="sxs-lookup"><span data-stu-id="bd33f-191">For a SQL Server database, we recommend that you use a FILESTREAM to stream data into the database when the binary data is larger than 1MB.</span></span>

  - <span data-ttu-id="bd33f-192">Vérifiez que votre base de données est conçue pour stocker les flux de données binaires volumineux qui seront reçus par votre service de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-192">Ensure that your database is designed to store the binary large streams that are to be received by your data service.</span></span>

  - <span data-ttu-id="bd33f-193">Lorsqu'un client envoie une requête POST pour insérer une entrée de lien média avec une ressource multimédia dans une demande unique, la méthode <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> est appelée pour obtenir le flux de données avant que le service de données n'insère la nouvelle entité dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-193">When a client sends a POST request to insert a media link entry with a media resource in a single request, <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> is called to obtain the stream before the data service inserts the new entity into the database.</span></span> <span data-ttu-id="bd33f-194">Une implémentation de fournisseur de diffusion en continu doit pouvoir gérer ce comportement de service de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-194">A streaming provider implementation must be able to handle this data service behavior.</span></span> <span data-ttu-id="bd33f-195">Envisagez d'utiliser une table de données distincte pour stocker les données binaires ou stockez le flux de données dans un fichier jusqu'à ce que l'entité soit insérée dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="bd33f-195">Consider using a separate data table to store the binary data or store the data stream in a file until after the entity has been inserted into the database.</span></span>

- <span data-ttu-id="bd33f-196">Lorsque vous implémentez les méthodes <xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>, <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A>ou <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A>, vous devez utiliser les valeurs eTag et Content-Type fournies comme paramètres de méthode.</span><span class="sxs-lookup"><span data-stu-id="bd33f-196">When you implement the <xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>, <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A>, or <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> methods, you must use the eTag and Content-Type values that are supplied as method parameters.</span></span> <span data-ttu-id="bd33f-197">Ne définissez pas d'en-tête eTag ou Content-Type dans votre implémentation de fournisseur <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span><span class="sxs-lookup"><span data-stu-id="bd33f-197">Do not set eTag or Content-Type headers in your <xref:System.Data.Services.Providers.IDataServiceStreamProvider> provider implementation.</span></span>

- <span data-ttu-id="bd33f-198">Par défaut, le client transmet les flux binaires volumineux à l'aide d'un encodage de transfert HTTP segmenté.</span><span class="sxs-lookup"><span data-stu-id="bd33f-198">By default, the client sends large binary streams by using a chunked HTTP Transfer-Encoding.</span></span> <span data-ttu-id="bd33f-199">Étant donné que le Serveur de développement ASP.NET ne prend pas en charge ce type d’encodage, vous ne pouvez pas utiliser ce serveur Web pour héberger un service de données en continu qui doit accepter des flux binaires volumineux.</span><span class="sxs-lookup"><span data-stu-id="bd33f-199">Because the ASP.NET Development Server does not support this kind of encoding, you cannot use this Web server to host a streaming data service that must accept large binary streams.</span></span> <span data-ttu-id="bd33f-200">Pour plus d’informations sur les Serveur de développement ASP.NET, consultez [serveurs Web dans Visual Studio pour les projets web ASP.net](https://docs.microsoft.com/previous-versions/aspnet/58wxa9w5(v=vs.120)).</span><span class="sxs-lookup"><span data-stu-id="bd33f-200">For more information on ASP.NET Development Server, see [Web Servers in Visual Studio for ASP.NET Web Projects](https://docs.microsoft.com/previous-versions/aspnet/58wxa9w5(v=vs.120)).</span></span>

<a name="versioning"></a>

## <a name="versioning-requirements"></a><span data-ttu-id="bd33f-201">Exigences pour le contrôle de version</span><span class="sxs-lookup"><span data-stu-id="bd33f-201">Versioning Requirements</span></span>

<span data-ttu-id="bd33f-202">Le fournisseur de diffusion en continu a les spécifications de contrôle de version de protocole OData suivantes :</span><span class="sxs-lookup"><span data-stu-id="bd33f-202">The streaming provider has the following OData protocol versioning requirements:</span></span>

- <span data-ttu-id="bd33f-203">Le fournisseur de diffusion en continu requiert que le service de données prenne en charge la version 2,0 du protocole OData et les versions ultérieures.</span><span class="sxs-lookup"><span data-stu-id="bd33f-203">The streaming provider requires that the data service support version 2.0 of the OData protocol and later versions.</span></span>

<span data-ttu-id="bd33f-204">Pour plus d’informations, consultez contrôle de [version des services de données](data-service-versioning-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="bd33f-204">For more information, see [Data Service Versioning](data-service-versioning-wcf-data-services.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="bd33f-205">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="bd33f-205">See also</span></span>

- [<span data-ttu-id="bd33f-206">Fournisseurs de services de données</span><span class="sxs-lookup"><span data-stu-id="bd33f-206">Data Services Providers</span></span>](data-services-providers-wcf-data-services.md)
- [<span data-ttu-id="bd33f-207">Fournisseurs de services de données personnalisés</span><span class="sxs-lookup"><span data-stu-id="bd33f-207">Custom Data Service Providers</span></span>](custom-data-service-providers-wcf-data-services.md)
- [<span data-ttu-id="bd33f-208">Utilisation des données binaires</span><span class="sxs-lookup"><span data-stu-id="bd33f-208">Working with Binary Data</span></span>](working-with-binary-data-wcf-data-services.md)

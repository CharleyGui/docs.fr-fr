---
title: Utilisation de données binaires (services de données WCF)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, binary data
- WCF Data Services, streams
ms.assetid: aeccc45c-d5c5-4671-ad63-a492ac8043ac
ms.openlocfilehash: 3c391e641df52d9143630406a40e17c6bc853865
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/15/2020
ms.locfileid: "90551749"
---
# <a name="working-with-binary-data-wcf-data-services"></a><span data-ttu-id="56810-102">Utilisation de données binaires (services de données WCF)</span><span class="sxs-lookup"><span data-stu-id="56810-102">Working with Binary Data (WCF Data Services)</span></span>

<span data-ttu-id="56810-103">La bibliothèque cliente WCF Data Services vous permet de récupérer et de mettre à jour des données binaires à partir d’un flux Open Data Protocol (OData) de l’une des manières suivantes :</span><span class="sxs-lookup"><span data-stu-id="56810-103">The WCF Data Services client library enables you to retrieve and update binary data from an Open Data Protocol (OData) feed in one of the following ways:</span></span>

- <span data-ttu-id="56810-104">Comme une propriété de type primitif d'entité.</span><span class="sxs-lookup"><span data-stu-id="56810-104">As a primitive type property of an entity.</span></span> <span data-ttu-id="56810-105">Il s'agit de la méthode conseillée lors de l'utilisation de petits objets de données binaires, faciles à charger en mémoire.</span><span class="sxs-lookup"><span data-stu-id="56810-105">This is the recommended method for working with small binary data objects that can be easily loaded into memory.</span></span> <span data-ttu-id="56810-106">Dans ce cas, la propriété binaire est une propriété d'entité exposée par le modèle de données, et le service de données sérialise les données binaires sous forme de XML binaire encodé Base 64 dans le message de réponse.</span><span class="sxs-lookup"><span data-stu-id="56810-106">In this case, the binary property is an entity property exposed by the data model, and the data service serializes the binary data as base-64 binary encoded XML in the response message.</span></span>

- <span data-ttu-id="56810-107">Comme un flux distinct de ressources binaires.</span><span class="sxs-lookup"><span data-stu-id="56810-107">As a separate binary resource stream.</span></span> <span data-ttu-id="56810-108">Ceci est la méthode conseillée pour l'accès et la modification de données d'objet BLOB (binary large object) qui peuvent représenter des photos, des vidéos ou tout autre type de données binaires encodées.</span><span class="sxs-lookup"><span data-stu-id="56810-108">This is the recommended method for accessing and changing binary large object (BLOB) data that may represent a photo, video, or any other type of binary encoded data.</span></span>

<span data-ttu-id="56810-109">WCF Data Services implémente la diffusion en continu de données binaires à l’aide du protocole HTTP, tel que défini dans OData.</span><span class="sxs-lookup"><span data-stu-id="56810-109">WCF Data Services implements the streaming of binary data by using HTTP as defined in the OData.</span></span> <span data-ttu-id="56810-110">Dans ce mécanisme, les données binaires sont traitées comme une ressource multimédia distincte mais liée à une entité, appelée une entrée de lien média.</span><span class="sxs-lookup"><span data-stu-id="56810-110">In this mechanism, binary data is treated as a media resource that is separate from but related to an entity, which is called a media link entry.</span></span> <span data-ttu-id="56810-111">Pour plus d’informations, consultez la page [fournisseur de streaming](streaming-provider-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="56810-111">For more information, see [Streaming Provider](streaming-provider-wcf-data-services.md).</span></span>

> [!TIP]
> <span data-ttu-id="56810-112">Pour obtenir un exemple pas à pas de création d’une application cliente Windows Presentation Foundation (WPF) qui télécharge des fichiers image binaires à partir d’un service OData qui stocke des photos, consultez la série publication d’un [fournisseur de diffusion en continu Data Services, partie 2 : accès à un flux de ressources multimédia à partir du client](/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span><span class="sxs-lookup"><span data-stu-id="56810-112">For a step-by-step example of how to create a Windows Presentation Foundation (WPF) client application that downloads binary image files from an OData service that stores photos, see the post [Data Services Streaming Provider Series-Part 2: Accessing a Media Resource Stream from the Client](/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span></span> <span data-ttu-id="56810-113">Pour télécharger l’exemple de code pour le service Stream Photo service dans le billet de blog, consultez l' [exemple streaming photo service](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) dans github.</span><span class="sxs-lookup"><span data-stu-id="56810-113">To download the sample code for the stream photo data service featured in the blog post, see the [Streaming Photo Data Service Sample](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) in GitHub.</span></span>

## <a name="entity-metadata"></a><span data-ttu-id="56810-114">Métadonnées d'entité</span><span class="sxs-lookup"><span data-stu-id="56810-114">Entity Metadata</span></span>

<span data-ttu-id="56810-115">Une entité qui possède un flux de ressources multimédia lié est signalée dans les métadonnées du service de données par l'attribut `HasStream` appliqué à un type d'entité qui est l'entrée de lien média.</span><span class="sxs-lookup"><span data-stu-id="56810-115">An entity that has a related media resource stream is indicated in the data service metadata by the `HasStream` attribute applied to an entity type that is the media link entry.</span></span> <span data-ttu-id="56810-116">Dans l’exemple suivant, l' `PhotoInfo` entité est une entrée de lien média qui a une ressource multimédia associée, indiquée par l' `HasStream` attribut.</span><span class="sxs-lookup"><span data-stu-id="56810-116">In the following example, the `PhotoInfo` entity is a media link entry that has a related media resource, indicated by the `HasStream` attribute.</span></span>

[!code-xml[Astoria Photo Streaming Service#HasStream](../../../../samples/snippets/xml/VS_Snippets_Misc/astoria_photo_streaming_service/xml/photodata.edmx#hasstream)]

<span data-ttu-id="56810-117">Les autres exemples de cette rubrique indiquent comment accéder et modifier le flux de ressources multimédia.</span><span class="sxs-lookup"><span data-stu-id="56810-117">The remaining examples in this topic show how to access and change the media resource stream.</span></span> <span data-ttu-id="56810-118">Pour obtenir un exemple complet de consommation d’un flux de ressources multimédia dans une application cliente .NET Framework à l’aide de la WCF Data Services bibliothèque cliente, consultez la publication [accès à un flux de ressources multimédia à partir du client](/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span><span class="sxs-lookup"><span data-stu-id="56810-118">For a complete example of how to consume a media resource stream in a .NET Framework client application by using the WCF Data Services client library, see the post [Accessing a Media Resource Stream from the Client](/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span></span>

## <a name="accessing-the-binary-resource-stream"></a><span data-ttu-id="56810-119">Accès au flux de ressources binaires</span><span class="sxs-lookup"><span data-stu-id="56810-119">Accessing the Binary Resource Stream</span></span>

<span data-ttu-id="56810-120">La bibliothèque cliente WCF Data Services fournit des méthodes permettant d’accéder aux flux de ressources binaires à partir d’un service de données basé sur OData.</span><span class="sxs-lookup"><span data-stu-id="56810-120">The WCF Data Services client library provides methods for accessing binary resource streams from an OData-based data service.</span></span> <span data-ttu-id="56810-121">Lors du téléchargement d'une ressource multimédia, vous pouvez utiliser l'URI de la ressource multimédia ou bien vous pouvez obtenir un flux binaire qui contient les données de la ressource multimédia elle-même.</span><span class="sxs-lookup"><span data-stu-id="56810-121">When downloading a media resource, you can either use the URI of the media resource or you can get a binary stream that contains the media resource data itself.</span></span> <span data-ttu-id="56810-122">Vous pouvez également télécharger les données de la ressource multimédia sous la forme d'un flux binaire.</span><span class="sxs-lookup"><span data-stu-id="56810-122">You can also upload media resource data as a binary stream.</span></span>

> [!TIP]
> <span data-ttu-id="56810-123">Pour obtenir un exemple pas à pas de création d’une application cliente Windows Presentation Foundation (WPF) qui télécharge des fichiers image binaires à partir d’un service OData qui stocke des photos, consultez la série publication d’un [fournisseur de diffusion en continu Data Services, partie 2 : accès à un flux de ressources multimédia à partir du client](/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span><span class="sxs-lookup"><span data-stu-id="56810-123">For a step-by-step example of how to create a Windows Presentation Foundation (WPF) client application that downloads binary image files from an OData service that stores photos, see the post [Data Services Streaming Provider Series-Part 2: Accessing a Media Resource Stream from the Client](/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span></span> <span data-ttu-id="56810-124">Pour télécharger l’exemple de code pour le service Stream Photo service dans le billet de blog, consultez l' [exemple streaming photo service](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) dans github.</span><span class="sxs-lookup"><span data-stu-id="56810-124">To download the sample code for the stream photo data service featured in the blog post, see the [Streaming Photo Data Service Sample](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) in GitHub.</span></span>

### <a name="getting-the-uri-of-the-binary-stream"></a><span data-ttu-id="56810-125">Obtenir l'URI du flux binaire</span><span class="sxs-lookup"><span data-stu-id="56810-125">Getting the URI of the Binary Stream</span></span>

<span data-ttu-id="56810-126">Lorsque vous récupérez certains types de ressources multimédia, tels que des images et d'autres fichiers multimédia, il est souvent plus facile d'utiliser l'URI de la ressource média de votre application que le flux de données binaires lui-même.</span><span class="sxs-lookup"><span data-stu-id="56810-126">When retrieving certain types of media resources, such as images and other media files, it is often easier to use the URI of the media resource in your application than handling the binary data stream itself.</span></span> <span data-ttu-id="56810-127">Pour obtenir l'URI d'un flux de ressources associé à une entrée de lien média donnée, vous devez appeler la méthode <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> sur l'instance <xref:System.Data.Services.Client.DataServiceContext> qui suit l'entité.</span><span class="sxs-lookup"><span data-stu-id="56810-127">To get the URI of a resource stream associated with a give media link entry, you must call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the entity.</span></span> <span data-ttu-id="56810-128">L'exemple suivant illustre comment appeler la méthode <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> pour obtenir l'URI d'un flux de ressources multimédia utilisé pour créer une nouvelle image sur le client :</span><span class="sxs-lookup"><span data-stu-id="56810-128">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> method to get the URI of a media resource stream that is used to create a new image on the client:</span></span>

[!code-csharp[Astoria Photo Streaming Client#GetReadStreamUri](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_client/cs/photowindow.xaml.cs#getreadstreamuri)]
[!code-vb[Astoria Photo Streaming Client#GetReadStreamUri](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_client/vb/photowindow.xaml.vb#getreadstreamuri)]

### <a name="downloading-the-binary-resource-stream"></a><span data-ttu-id="56810-129">Téléchargement d'un flux de ressources binaires</span><span class="sxs-lookup"><span data-stu-id="56810-129">Downloading the Binary Resource Stream</span></span>

<span data-ttu-id="56810-130">Lorsque vous récupérez un flux de ressources binaires, vous devez appeler la méthode <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> sur l'instance <xref:System.Data.Services.Client.DataServiceContext> qui effectue le suivi de l'entrée de lien média.</span><span class="sxs-lookup"><span data-stu-id="56810-130">When retrieving a binary resource stream, you must call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the media link entry.</span></span> <span data-ttu-id="56810-131">Cette méthode envoie une demande au service de données qui retourne un objet <xref:System.Data.Services.Client.DataServiceStreamResponse>, lequel possède une référence au flux de données qui contient la ressource.</span><span class="sxs-lookup"><span data-stu-id="56810-131">This method sends a request to the data service that returns a <xref:System.Data.Services.Client.DataServiceStreamResponse> object, which has a reference to the stream that contains the resource.</span></span> <span data-ttu-id="56810-132">Utilisez cette méthode lorsque votre application nécessite que la ressource binaire soit un <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="56810-132">Use this method when your application requires the binary resource as a <xref:System.IO.Stream>.</span></span> <span data-ttu-id="56810-133">L'exemple suivant illustre comment appeler la méthode <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> pour récupérer un flux utilisé pour créer une nouvelle image sur le client :</span><span class="sxs-lookup"><span data-stu-id="56810-133">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method to retrieve a stream that is used to create a new image on the client:</span></span>

[!code-csharp[Astoria Streaming Client#GetReadStreamClient](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_streaming_client/cs/customerphotowindow.xaml.cs#getreadstreamclient)]
[!code-vb[Astoria Streaming Client#GetReadStreamClient](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_streaming_client/vb/customerphotowindow.xaml.vb#getreadstreamclient)]

> [!NOTE]
> <span data-ttu-id="56810-134">L'en-tête Content-Length du message de réponse qui contient le flux binaire en continu n'est pas défini par le service de données.</span><span class="sxs-lookup"><span data-stu-id="56810-134">The Content-Length header in the response message that contains the binary steam is not set by the data service.</span></span> <span data-ttu-id="56810-135">Cette valeur ne peut pas refléter la longueur réelle du flux de données binaires en continu.</span><span class="sxs-lookup"><span data-stu-id="56810-135">This value may not reflect the actual length of the binary data stream.</span></span>

### <a name="uploading-a-media-resource-as-a-stream"></a><span data-ttu-id="56810-136">Téléchargement d'une ressource multimédia comme un flux</span><span class="sxs-lookup"><span data-stu-id="56810-136">Uploading a Media Resource as a Stream</span></span>

<span data-ttu-id="56810-137">Pour insérer ou mettre à jour une ressource multimédia, appelez la méthode <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> sur l'instance <xref:System.Data.Services.Client.DataServiceContext> qui effectue le suivi de l'entité.</span><span class="sxs-lookup"><span data-stu-id="56810-137">To insert or update a media resource, call the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the entity.</span></span> <span data-ttu-id="56810-138">Cette méthode envoie une demande au service de données qui contient la ressource multimédia lue depuis le flux de données fourni.</span><span class="sxs-lookup"><span data-stu-id="56810-138">This method sends a request to the data service that contains the media resource read from the supplied stream.</span></span> <span data-ttu-id="56810-139">L'exemple suivant indique comment appeler la méthode <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> pour envoyer une image au service de données :</span><span class="sxs-lookup"><span data-stu-id="56810-139">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method to send an image to the data service:</span></span>

[!code-csharp[Astoria Photo Streaming Client#SetSaveStream](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_client/cs/photodetailswindow.xaml.cs#setsavestream)]
[!code-vb[Astoria Photo Streaming Client#SetSaveStream](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_client/vb/photodetailswindow.xaml.vb#setsavestream)]

<span data-ttu-id="56810-140">Dans cet exemple, la méthode <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> est appelée en fournissant une valeur `true` pour le paramètre `closeStream`.</span><span class="sxs-lookup"><span data-stu-id="56810-140">In this example, the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method is called by supplying a value of `true` for the `closeStream` parameter.</span></span> <span data-ttu-id="56810-141">Cela garantit que l'objet <xref:System.Data.Services.Client.DataServiceContext> ferme le flux de données une fois les données binaires téléchargées sur le service de données.</span><span class="sxs-lookup"><span data-stu-id="56810-141">This guarantees that the <xref:System.Data.Services.Client.DataServiceContext> closes the stream after the binary data is uploaded to the data service.</span></span>

> [!NOTE]
> <span data-ttu-id="56810-142">Lorsque vous appelez <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A>, le flux n'est pas transmis au service de données jusqu'à ce que la méthode <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> soit appelée.</span><span class="sxs-lookup"><span data-stu-id="56810-142">When you call <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A>, the stream is not sent to the data service until <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> is called.</span></span>

## <a name="see-also"></a><span data-ttu-id="56810-143">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="56810-143">See also</span></span>

- [<span data-ttu-id="56810-144">Bibliothèque client services de données WCF</span><span class="sxs-lookup"><span data-stu-id="56810-144">WCF Data Services Client Library</span></span>](wcf-data-services-client-library.md)
- [<span data-ttu-id="56810-145">Liaison de données à des contrôles</span><span class="sxs-lookup"><span data-stu-id="56810-145">Binding Data to Controls</span></span>](binding-data-to-controls-wcf-data-services.md)

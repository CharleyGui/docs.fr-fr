---
title: Opérations de service (services de données WCF)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- service operations [WCF Data Services]
- WCF Data Services, service operations
ms.assetid: 583a690a-e60f-4990-8991-d6efce069d76
ms.openlocfilehash: f905eb90b47cb5ab20fd912b1cbcc62947361992
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/07/2019
ms.locfileid: "70779774"
---
# <a name="service-operations-wcf-data-services"></a><span data-ttu-id="4a5d7-102">Opérations de service (services de données WCF)</span><span class="sxs-lookup"><span data-stu-id="4a5d7-102">Service Operations (WCF Data Services)</span></span>

[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] <span data-ttu-id="4a5d7-103">vous permet de définir des opérations de service sur un service de données pour exposer des méthodes sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-103">enables you to define service operations on a data service to expose methods on the server.</span></span> <span data-ttu-id="4a5d7-104">Comme d'autres ressources du service des données, les opérations de service sont adressées par les URI.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-104">Like other data service resources, service operations are addressed by URIs.</span></span> <span data-ttu-id="4a5d7-105">Les opérations de service vous permettent d'exposer la logique métier dans un service de données, comme d'implémenter la logique de validation, pour appliquer la sécurité basée sur les rôles, ou exposer des fonctions d'interrogation spécialisées.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-105">Service operations enable you to expose business logic in a data service, such as to implement validation logic, to apply role-based security, or to expose specialized querying capabilities.</span></span> <span data-ttu-id="4a5d7-106">Les opérations de service sont des méthodes ajoutées à la classe de service de données dérivée de <xref:System.Data.Services.DataService%601>.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-106">Service operations are methods added to the data service class that derives from <xref:System.Data.Services.DataService%601>.</span></span> <span data-ttu-id="4a5d7-107">Comme pour toutes les autres ressources du service de données, vous pouvez fournir des paramètres à la méthode d'opération de service.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-107">Like all other data service resources, you can supply parameters to the service operation method.</span></span> <span data-ttu-id="4a5d7-108">Par exemple, l’URI d’opération de service suivant (basé sur le service de données de [démarrage rapide](quickstart-wcf-data-services.md) ) `city` passe la valeur `London` au paramètre :</span><span class="sxs-lookup"><span data-stu-id="4a5d7-108">For example, the following service operation URI (based on the [quickstart](quickstart-wcf-data-services.md) data service) passes the value `London` to the `city` parameter:</span></span>

```
http://localhost:12345/Northwind.svc/GetOrdersByCity?city='London'
```

<span data-ttu-id="4a5d7-109">La définition de cette opération de service est la suivante :</span><span class="sxs-lookup"><span data-stu-id="4a5d7-109">The definition for this service operation is as follows:</span></span>

[!code-csharp[Astoria Northwind Service#ServiceOperationDef](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_service/cs/northwind2.svc.cs#serviceoperationdef)]
[!code-vb[Astoria Northwind Service#ServiceOperationDef](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_service/vb/northwind2.svc.vb#serviceoperationdef)]

<span data-ttu-id="4a5d7-110">Vous pouvez utiliser la <xref:System.Data.Services.DataService%601.CurrentDataSource%2A> du <xref:System.Data.Services.DataService%601> pour accéder directement à la source de données que le service de données utilise.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-110">You can use the <xref:System.Data.Services.DataService%601.CurrentDataSource%2A> of the <xref:System.Data.Services.DataService%601> to directly access the data source that the data service is using.</span></span> <span data-ttu-id="4a5d7-111">Pour plus d'informations, voir [Procédure : Définir une opération](how-to-define-a-service-operation-wcf-data-services.md)de service.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-111">For more information, see [How to: Define a Service Operation](how-to-define-a-service-operation-wcf-data-services.md).</span></span>

<span data-ttu-id="4a5d7-112">Pour plus d’informations sur l’appel d’une opération de service à partir d’une application cliente .NET Framework, consultez [appel des opérations de service](calling-service-operations-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="4a5d7-112">For information on how to call a service operation from a .NET Framework client application, see [Calling Service Operations](calling-service-operations-wcf-data-services.md).</span></span>

## <a name="service-operation-requirements"></a><span data-ttu-id="4a5d7-113">Spécifications des opérations de service</span><span class="sxs-lookup"><span data-stu-id="4a5d7-113">Service Operation Requirements</span></span>

<span data-ttu-id="4a5d7-114">Les spécifications suivantes s'appliquent lors de la définition d'opérations de service sur le service de données.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-114">The following requirements apply when defining service operations on the data service.</span></span> <span data-ttu-id="4a5d7-115">Si une méthode ne respecte pas ces spécifications définies, elle ne sera pas exposée en tant qu'opération de service pour le service de données.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-115">If a method does not meet these requirements, it will not be exposed as a service operation for the data service.</span></span>

- <span data-ttu-id="4a5d7-116">L'opération doit être une méthode d'instance publique qui est un membre de la classe du service des données.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-116">The operation must be a public instance method that is a member of the data service class.</span></span>

- <span data-ttu-id="4a5d7-117">La méthode d'opération peut accepter des paramètres d'entrée uniquement.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-117">The operation method may only accept input parameters.</span></span> <span data-ttu-id="4a5d7-118">Les données envoyées dans le corps du message ne sont pas accessibles par le service de données.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-118">Data sent in the message body cannot be accessed by the data service.</span></span>

- <span data-ttu-id="4a5d7-119">Si des paramètres sont définis, le type de chaque paramètre doit être un type primitif.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-119">If parameters are defined, the type of each parameter must be a primitive type.</span></span> <span data-ttu-id="4a5d7-120">Toutes les données d'un type non primitif doivent être sérialisées et passées dans un paramètre de chaîne.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-120">Any data of a non-primitive type must be serialized and passed into a string parameter.</span></span>

- <span data-ttu-id="4a5d7-121">La méthode doit retourner un des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="4a5d7-121">The method must return one of the following:</span></span>

  - <span data-ttu-id="4a5d7-122">`void` (`Nothing` en Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="4a5d7-122">`void` (`Nothing` in Visual Basic)</span></span>

  - <xref:System.Collections.Generic.IEnumerable%601>

  - <xref:System.Linq.IQueryable%601>

  - <span data-ttu-id="4a5d7-123">Un type d'entité dans le modèle de données que le service des données expose. .</span><span class="sxs-lookup"><span data-stu-id="4a5d7-123">An entity type in the data model that the data service exposes.</span></span>

  - <span data-ttu-id="4a5d7-124">Une classe primitive telle qu'un entier ou une chaîne.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-124">A primitive class such as integer or string.</span></span>

- <span data-ttu-id="4a5d7-125">Afin de prendre en charge les options de requêtes telles que le tri, la pagination et le filtrage, les méthodes d'opération de service doivent retourner <xref:System.Linq.IQueryable%601>.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-125">In order to support query options such as sorting, paging, and filtering, service operation methods should return <xref:System.Linq.IQueryable%601>.</span></span> <span data-ttu-id="4a5d7-126">Les demande aux opérations de services qui incluent des options de requête sont rejetées pour les opérations qui retournent uniquement <xref:System.Collections.Generic.IEnumerable%601>.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-126">Requests to service operations that include query options are rejected for operations that only return <xref:System.Collections.Generic.IEnumerable%601>.</span></span>

- <span data-ttu-id="4a5d7-127">Afin de prendre en charge l'accès aux entités connexes à l'aide de propriétés de navigation, l'opération de service doit retourner <xref:System.Linq.IQueryable%601>.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-127">In order to support accessing related entities by using navigation properties, the service operation must return <xref:System.Linq.IQueryable%601>.</span></span>

- <span data-ttu-id="4a5d7-128">La méthode doit être annotée avec l’attribut `[WebGet]` ou `[WebInvoke]`.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-128">The method must be annotated with the `[WebGet]` or `[WebInvoke]` attribute.</span></span>

  - <span data-ttu-id="4a5d7-129">`[WebGet]` permet d'appeler la méthode à l'aide d'une demande GET.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-129">`[WebGet]` enables the method to be invoked by using a GET request.</span></span>

  - <span data-ttu-id="4a5d7-130">`[WebInvoke(Method = "POST")]` permet d'appeler la méthode à l'aide d'une demande POST.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-130">`[WebInvoke(Method = "POST")]` enables the method to be invoked by using a POST request.</span></span> <span data-ttu-id="4a5d7-131">Les autres méthodes <xref:System.ServiceModel.Web.WebInvokeAttribute> ne sont pas prises en charge.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-131">Other <xref:System.ServiceModel.Web.WebInvokeAttribute> methods are not supported.</span></span>

- <span data-ttu-id="4a5d7-132">Une opération de service peut être annotée avec le <xref:System.Data.Services.SingleResultAttribute>, qui spécifie que la valeur de retour de la méthode est une entité unique plutôt qu'une collection d'entités.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-132">A service operation may be annotated with the <xref:System.Data.Services.SingleResultAttribute> that specifies that the return value from the method is a single entity rather than a collection of entities.</span></span> <span data-ttu-id="4a5d7-133">Cette distinction détermine la sérialisation résultante de la réponse et le mode de représentation des parcours de propriété de navigation supplémentaires dans l'URI.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-133">This distinction dictates the resulting serialization of the response and the manner in which additional navigation property traversals are represented in the URI.</span></span> <span data-ttu-id="4a5d7-134">Par exemple, lors de l'utilisation de la sérialisation AtomPub, une instance de type de ressource unique est représentée en tant qu'élément d'entrée et un jeu d'instances est représenté en tant qu'élément « feed ».</span><span class="sxs-lookup"><span data-stu-id="4a5d7-134">For example, when using AtomPub serialization, a single resource type instance is represented as an entry element and a set of instances as a feed element.</span></span>

## <a name="addressing-service-operations"></a><span data-ttu-id="4a5d7-135">Adressage d'opérations de service</span><span class="sxs-lookup"><span data-stu-id="4a5d7-135">Addressing Service Operations</span></span>

<span data-ttu-id="4a5d7-136">Vous pouvez adresser des opérations de service en plaçant le nom de la méthode dans le premier segment de chemin d’accès d’un URI.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-136">You can address service operations by placing the name of the method in the first path segment of a URI.</span></span> <span data-ttu-id="4a5d7-137">Par exemple, l'URI suivant accède à une opération `GetOrdersByState` qui retourne une collection <xref:System.Linq.IQueryable%601> d'objets `Orders`.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-137">As an example, the following URI accesses a `GetOrdersByState` operation that returns an <xref:System.Linq.IQueryable%601> collection of `Orders` objects.</span></span>

```
http://localhost:12345/Northwind.svc/GetOrdersByState?state='CA'&includeItems=true
```

<span data-ttu-id="4a5d7-138">En appelant une opération de service, les paramètres sont fournis comme options de requête.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-138">When calling a service operation, parameters are supplied as query options.</span></span> <span data-ttu-id="4a5d7-139">L'opération de service précédente accepte un paramètre de chaîne `state` et une paramètre booléen `includeItems` qui indique s'il faut inclure les objets associés `Order_Detail` dans la réponse.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-139">The previous service operation accepts both a string parameter `state` and a Boolean parameter `includeItems` that indicates whether to include related `Order_Detail` objects in the response.</span></span>

<span data-ttu-id="4a5d7-140">Voici les types de retour valides pour une opération de service :</span><span class="sxs-lookup"><span data-stu-id="4a5d7-140">The following are valid return types for a service operation:</span></span>

|<span data-ttu-id="4a5d7-141">Types de retour valides</span><span class="sxs-lookup"><span data-stu-id="4a5d7-141">Valid Return Types</span></span>|<span data-ttu-id="4a5d7-142">Règles d'URI</span><span class="sxs-lookup"><span data-stu-id="4a5d7-142">URI Rules</span></span>|
|------------------------|---------------|
|<span data-ttu-id="4a5d7-143">`void` (`Nothing` en Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="4a5d7-143">`void` (`Nothing` in Visual Basic)</span></span><br /><br /> <span data-ttu-id="4a5d7-144">ou</span><span class="sxs-lookup"><span data-stu-id="4a5d7-144">-or-</span></span><br /><br /> <span data-ttu-id="4a5d7-145">Types d'entité</span><span class="sxs-lookup"><span data-stu-id="4a5d7-145">Entity types</span></span><br /><br /> <span data-ttu-id="4a5d7-146">ou</span><span class="sxs-lookup"><span data-stu-id="4a5d7-146">-or-</span></span><br /><br /> <span data-ttu-id="4a5d7-147">Types primitifs</span><span class="sxs-lookup"><span data-stu-id="4a5d7-147">Primitive types</span></span>|<span data-ttu-id="4a5d7-148">L’URI doit être un segment de chemin d’accès unique qui est le nom de l’opération de service.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-148">The URI must be a single path segment that is the name of the service operation.</span></span> <span data-ttu-id="4a5d7-149">Les options de requête ne sont pas autorisées.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-149">Query options are not allowed.</span></span>|
|<xref:System.Collections.Generic.IEnumerable%601>|<span data-ttu-id="4a5d7-150">L’URI doit être un segment de chemin d’accès unique qui est le nom de l’opération de service.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-150">The URI must be a single path segment that is the name of the service operation.</span></span> <span data-ttu-id="4a5d7-151">Comme le type de résultat n'est pas un type <xref:System.Linq.IQueryable%601>, les options de requête ne sont pas autorisées.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-151">Because the result type is not an <xref:System.Linq.IQueryable%601> type, query options are not allowed.</span></span>|
|<xref:System.Linq.IQueryable%601>|<span data-ttu-id="4a5d7-152">Les segments de chemin d’accès, en plus du chemin d’accès qui est le nom de l’opération de service, sont autorisés.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-152">Query path segments in addition to the path that is the name of the service operation are allowed.</span></span> <span data-ttu-id="4a5d7-153">Les options de requête sont aussi autorisées.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-153">Query options are also allowed.</span></span>|

<span data-ttu-id="4a5d7-154">Des segments de chemin d'accès ou des options de requêtes supplémentaires peuvent être ajoutés à l'URI en fonction du type de retour de l'opération de service.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-154">Additional path segments or query options may be added to the URI depending on the return type of the service operation.</span></span> <span data-ttu-id="4a5d7-155">Par exemple, l’URI suivant accède à une opération `GetOrdersByCity` qui retourne une collection <xref:System.Linq.IQueryable%601> d’objets `Orders`, classée par `RequiredDate` dans l’ordre décroissant, avec les objets `Order_Details` connexes :</span><span class="sxs-lookup"><span data-stu-id="4a5d7-155">For example, the following URI accesses a `GetOrdersByCity` operation that returns an <xref:System.Linq.IQueryable%601> collection of `Orders` objects, ordered by `RequiredDate` in descending order, along with the related `Order_Details` objects:</span></span>

```
http://localhost:12345/Northwind.svc/GetOrdersByCity?city='London'&$expand=Order_Details&$orderby=RequiredDate desc
```

## <a name="service-operations-access-control"></a><span data-ttu-id="4a5d7-156">Contrôle d'accès des opérations de service</span><span class="sxs-lookup"><span data-stu-id="4a5d7-156">Service Operations Access Control</span></span>

<span data-ttu-id="4a5d7-157">La visibilité des opérations de service à l'échelle du service est contrôlée par la méthode <xref:System.Data.Services.IDataServiceConfiguration.SetServiceOperationAccessRule%2A> sur la classe <xref:System.Data.Services.IDataServiceConfiguration> d'une manière qui s'apparente au contrôle de la visibilité du jeu d'entités à l'aide de la méthode <xref:System.Data.Services.IDataServiceConfiguration.SetEntitySetAccessRule%2A>.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-157">Service-wide visibility of service operations is controlled by the <xref:System.Data.Services.IDataServiceConfiguration.SetServiceOperationAccessRule%2A> method on the <xref:System.Data.Services.IDataServiceConfiguration> class in much the same way that entity set visibility is controlled by using the <xref:System.Data.Services.IDataServiceConfiguration.SetEntitySetAccessRule%2A> method.</span></span> <span data-ttu-id="4a5d7-158">Par exemple, la ligne de code suivante dans la définition du service de données permet l'accès à l'opération de service `CustomersByCity`.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-158">For example, the following line of code in the data service definition enables access to the `CustomersByCity` service operation.</span></span>

[!code-csharp[Astoria Northwind Service#ServiceOperationConfig](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_service/cs/northwind2.svc.cs#serviceoperationconfig)]
[!code-vb[Astoria Northwind Service#ServiceOperationConfig](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_service/vb/northwind2.svc.vb#serviceoperationconfig)]

> [!NOTE]
> <span data-ttu-id="4a5d7-159">Si une opération de service possède un type de retour qui est masqué en restreignant l’accès sur les jeux d’entités sous-jacents, l’opération de service ne sera pas disponible pour les applications clientes.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-159">If a service operation has a return type that has been hidden by restricting access on the underlying entity sets, then the service operation will not be available to client applications.</span></span>

<span data-ttu-id="4a5d7-160">Pour plus d'informations, voir [Procédure : Définir une opération](how-to-define-a-service-operation-wcf-data-services.md)de service.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-160">For more information, see [How to: Define a Service Operation](how-to-define-a-service-operation-wcf-data-services.md).</span></span>

## <a name="raising-exceptions"></a><span data-ttu-id="4a5d7-161">Déclenchement des exceptions</span><span class="sxs-lookup"><span data-stu-id="4a5d7-161">Raising Exceptions</span></span>

<span data-ttu-id="4a5d7-162">Nous vous recommandons d'utiliser la classe <xref:System.Data.Services.DataServiceException> chaque fois que vous déclenchez une exception dans l'exécution du service de données.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-162">We recommend that you use the <xref:System.Data.Services.DataServiceException> class whenever you raise an exception in the data service execution.</span></span> <span data-ttu-id="4a5d7-163">Cela est dû fait que l'exécution du service de données sait mapper des propriétés de cet objet exception correctement au message de réponse HTTP.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-163">This is because the data service runtime knows how to map properties of this exception object correctly to the HTTP response message.</span></span> <span data-ttu-id="4a5d7-164">Lorsque vous déclenchez <xref:System.Data.Services.DataServiceException> dans une opération de service, l'exception renvoyée est encapsulée dans <xref:System.Reflection.TargetInvocationException>.</span><span class="sxs-lookup"><span data-stu-id="4a5d7-164">When you raise a <xref:System.Data.Services.DataServiceException> in a service operation, the returned exception is wrapped in a <xref:System.Reflection.TargetInvocationException>.</span></span> <span data-ttu-id="4a5d7-165">Pour retourner la base <xref:System.Data.Services.DataServiceException> sans <xref:System.Reflection.TargetInvocationException>englobant, vous devez substituer la méthode <xref:System.Data.Services.DataService%601.HandleException%2A> dans <xref:System.Data.Services.DataService%601>, extraire<xref:System.Data.Services.DataServiceException> à partir de <xref:System.Reflection.TargetInvocationException>, et le retourner comme erreur de niveau supérieur, comme dans l'exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="4a5d7-165">To return the base <xref:System.Data.Services.DataServiceException> without the enclosing <xref:System.Reflection.TargetInvocationException>, you must override the <xref:System.Data.Services.DataService%601.HandleException%2A> method in the <xref:System.Data.Services.DataService%601>, extract the <xref:System.Data.Services.DataServiceException> from the <xref:System.Reflection.TargetInvocationException>, and return it as the top-level error, as in the following example:</span></span>

[!code-csharp[Astoria Northwind Service#HandleExceptions](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_service/cs/northwind2.svc.cs#handleexceptions)]
[!code-vb[Astoria Northwind Service#HandleExceptions](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_service/vb/northwind2.svc.vb#handleexceptions)]

## <a name="see-also"></a><span data-ttu-id="4a5d7-166">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="4a5d7-166">See also</span></span>

- [<span data-ttu-id="4a5d7-167">Intercepteurs</span><span class="sxs-lookup"><span data-stu-id="4a5d7-167">Interceptors</span></span>](interceptors-wcf-data-services.md)

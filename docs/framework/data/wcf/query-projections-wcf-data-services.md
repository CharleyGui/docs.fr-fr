---
title: Projections de requête (services de données WCF)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- projection [WCF Data Services]
- WCF Data Services, projection
- query projection [WCF Data Services]
- WCF Data Services, querying
ms.assetid: a09f4985-9f0d-48c8-b183-83d67a3dfe5f
ms.openlocfilehash: 764ea6a77ba267e691d48bc72d17c02f6b3c18ca
ms.sourcegitcommit: 7088f87e9a7da144266135f4b2397e611cf0a228
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/11/2020
ms.locfileid: "75900969"
---
# <a name="query-projections-wcf-data-services"></a><span data-ttu-id="e9934-102">Projections de requête (services de données WCF)</span><span class="sxs-lookup"><span data-stu-id="e9934-102">Query Projections (WCF Data Services)</span></span>

<span data-ttu-id="e9934-103">La projection fournit un mécanisme dans le Open Data Protocol (OData) pour réduire la quantité de données dans le flux retourné par une requête en spécifiant que seules certaines propriétés d’une entité sont retournées dans la réponse.</span><span class="sxs-lookup"><span data-stu-id="e9934-103">Projection provides a mechanism in the Open Data Protocol (OData) to reduce the amount of data in the feed returned by a query by specifying that only certain properties of an entity are returned in the response.</span></span> <span data-ttu-id="e9934-104">Pour plus d’informations, consultez la section 4,8.</span><span class="sxs-lookup"><span data-stu-id="e9934-104">For more information, see section 4.8.</span></span> <span data-ttu-id="e9934-105">Sélectionnez l’option de requête système ($select) dans [conventions d’URI (OData Version 2,0)](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span><span class="sxs-lookup"><span data-stu-id="e9934-105">Select System Query Option ($select) in [URI Conventions (OData Version 2.0)](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span></span>

<span data-ttu-id="e9934-106">Cette rubrique décrit comment définir une projection de requête, quelles sont les exigences pour les types d’entité et de non-entité, la mise à jour des résultats projetés, la création des types projetés et répertorie des considérations relatives à la projection.</span><span class="sxs-lookup"><span data-stu-id="e9934-106">This topic describes how to define a query projection, what the requirements are for entity and non-entity types, making updates to projected results, creating projected types, and lists some projection considerations.</span></span>

## <a name="defining-a-query-projection"></a><span data-ttu-id="e9934-107">Définition d'une projection de requête</span><span class="sxs-lookup"><span data-stu-id="e9934-107">Defining a Query Projection</span></span>

<span data-ttu-id="e9934-108">Vous pouvez ajouter une clause de projection à une requête soit à l’aide de l’option de requête `$select` dans un URI, soit à l’aide de la clause [Select](../../../csharp/language-reference/keywords/select-clause.md) ([Select](../../../visual-basic/language-reference/queries/select-clause.md) in Visual Basic) dans une requête LINQ.</span><span class="sxs-lookup"><span data-stu-id="e9934-108">You can add a projection clause to a query either by using the `$select` query option in a URI or by using the [select](../../../csharp/language-reference/keywords/select-clause.md) clause ([Select](../../../visual-basic/language-reference/queries/select-clause.md) in Visual Basic) in a LINQ query.</span></span> <span data-ttu-id="e9934-109">Les données d'entité retournées peuvent être projetées dans des types d'entités ou de non-entités sur le client.</span><span class="sxs-lookup"><span data-stu-id="e9934-109">Returned entity data can be projected into either entity types or non-entity types on the client.</span></span> <span data-ttu-id="e9934-110">Les exemples de cette rubrique montrent comment utiliser la clause `select` dans une requête LINQ.</span><span class="sxs-lookup"><span data-stu-id="e9934-110">Examples in this topic demonstrate how to use the `select` clause in a LINQ query.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e9934-111">Une perte de données peut survenir dans le service de données lorsque vous enregistrez des mises à jour apportées aux types projetés.</span><span class="sxs-lookup"><span data-stu-id="e9934-111">Data loss might occur in the data service when you save updates that were made to projected types.</span></span> <span data-ttu-id="e9934-112">Pour plus d’informations, consultez [Considérations sur la projection](#considerations).</span><span class="sxs-lookup"><span data-stu-id="e9934-112">For more information, see [Projection Considerations](#considerations).</span></span>

## <a name="requirements-for-entity-and-non-entity-types"></a><span data-ttu-id="e9934-113">Conditions requises pour les types d'entité et de non-entité</span><span class="sxs-lookup"><span data-stu-id="e9934-113">Requirements for Entity and Non-Entity Types</span></span>

<span data-ttu-id="e9934-114">Les types d'entité doivent avoir une ou plusieurs propriétés d'identité qui composent la clé d'entité.</span><span class="sxs-lookup"><span data-stu-id="e9934-114">Entity types must have one or more identity properties that make up the entity key.</span></span> <span data-ttu-id="e9934-115">Les types d'entité sont définis sur les clients de l'une des manières suivantes :</span><span class="sxs-lookup"><span data-stu-id="e9934-115">Entity types are defined on clients in one of the following ways:</span></span>

- <span data-ttu-id="e9934-116">En appliquant <xref:System.Data.Services.Common.DataServiceKeyAttribute> ou <xref:System.Data.Services.Common.DataServiceEntityAttribute> au type.</span><span class="sxs-lookup"><span data-stu-id="e9934-116">By applying the <xref:System.Data.Services.Common.DataServiceKeyAttribute> or <xref:System.Data.Services.Common.DataServiceEntityAttribute> to the type.</span></span>

- <span data-ttu-id="e9934-117">Lorsque le type a une propriété appelée `ID`.</span><span class="sxs-lookup"><span data-stu-id="e9934-117">When the type has a property named `ID`.</span></span>

- <span data-ttu-id="e9934-118">Lorsque le type a une propriété nommée *type*`ID`, où *type* est le nom du type.</span><span class="sxs-lookup"><span data-stu-id="e9934-118">When the type has a property named *type*`ID`, where *type* is the name of the type.</span></span>

<span data-ttu-id="e9934-119">Par défaut, lorsque vous projetez des résultats de requête dans un type défini sur le client, les propriétés demandées dans la projection doivent exister dans le type de client.</span><span class="sxs-lookup"><span data-stu-id="e9934-119">By default, when you project query results into a type defined at the client, the properties requested in the projection must exist in the client type.</span></span> <span data-ttu-id="e9934-120">Toutefois, lorsque vous spécifiez une valeur `true` pour la propriété <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> de <xref:System.Data.Services.Client.DataServiceContext>, il n'est pas requis que les propriétés spécifiées dans la projection se produisent dans le type de client.</span><span class="sxs-lookup"><span data-stu-id="e9934-120">However, when you specify a value of `true` for the <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> property of the <xref:System.Data.Services.Client.DataServiceContext>, properties specified in the projection are not required to occur in the client type.</span></span>

### <a name="making-updates-to-projected-results"></a><span data-ttu-id="e9934-121">Mise à jour des résultats projetés</span><span class="sxs-lookup"><span data-stu-id="e9934-121">Making Updates to Projected Results</span></span>

<span data-ttu-id="e9934-122">Lorsque vous projetez des résultats de requête dans des types d'entité sur le client, <xref:System.Data.Services.Client.DataServiceContext> peut suivre ces objets avec les mises à jour à renvoyer au service de données lorsque la méthode <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> est appelée.</span><span class="sxs-lookup"><span data-stu-id="e9934-122">When you project query results into entity types on the client, the <xref:System.Data.Services.Client.DataServiceContext> can track those objects with updates to be sent back to the data service when the <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> method is called.</span></span> <span data-ttu-id="e9934-123">Toutefois, les mises à jour apportées aux données projetées dans des types de non-entité sur le client ne peuvent pas être renvoyées au service de données.</span><span class="sxs-lookup"><span data-stu-id="e9934-123">However, updates that are made to data projected into non-entity types on the client cannot be sent back to the data service.</span></span> <span data-ttu-id="e9934-124">La cause est que sans une clé pour identifier l'instance d'entité, le service de données ne peut pas mettre à jour l'entité correcte dans la source de données.</span><span class="sxs-lookup"><span data-stu-id="e9934-124">This is because without a key to identify the entity instance, the data service cannot update the correct entity in the data source.</span></span> <span data-ttu-id="e9934-125">Les types de non-entité ne sont pas joints à <xref:System.Data.Services.Client.DataServiceContext>.</span><span class="sxs-lookup"><span data-stu-id="e9934-125">Non-entity types are not attached to the <xref:System.Data.Services.Client.DataServiceContext>.</span></span>

<span data-ttu-id="e9934-126">Lorsqu'une ou plusieurs propriétés d'un type d'entité défini dans le service de données ne se produit pas dans le type de client dans lequel l'entité est projetée, les insertions de nouvelles entités ne contiennent pas ces propriétés manquantes.</span><span class="sxs-lookup"><span data-stu-id="e9934-126">When one or more properties of an entity type defined in the data service do not occur in the client type into which the entity is projected, inserts of new entities will not contain these missing properties.</span></span> <span data-ttu-id="e9934-127">Dans ce cas, les mises à jour apportées aux entités existantes n’incluent pas non **plus** ces propriétés manquantes.</span><span class="sxs-lookup"><span data-stu-id="e9934-127">In this case, updates that are made to existing entities will **also** not include these missing properties.</span></span> <span data-ttu-id="e9934-128">Lorsqu'une valeur existe pour une telle propriété, la mise à jour rétablit la valeur par défaut de la propriété, comme défini dans la source de données.</span><span class="sxs-lookup"><span data-stu-id="e9934-128">When a value exists for such a property, the update resets it to the default value for the property, as defined in the data source.</span></span>

### <a name="creating-projected-types"></a><span data-ttu-id="e9934-129">Création de types projetés</span><span class="sxs-lookup"><span data-stu-id="e9934-129">Creating Projected Types</span></span>

<span data-ttu-id="e9934-130">L'exemple suivant utilise une requête LINQ anonyme qui projette les propriétés associées à l'adresse du type `Customers` dans un nouveau type `CustomerAddress`, qui est défini sur le client et est attribué comme un type d'entité :</span><span class="sxs-lookup"><span data-stu-id="e9934-130">The following example uses an anonymous LINQ query that projects the address-related properties of the `Customers` type into a new `CustomerAddress` type, which is defined on the client and is attributed as an entity type:</span></span>

[!code-csharp[Astoria Northwind Client#SelectCustomerAddressSpecific](~/samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#selectcustomeraddressspecific)]
[!code-vb[Astoria Northwind Client#SelectCustomerAddressSpecific](~/samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#selectcustomeraddressspecific)]

<span data-ttu-id="e9934-131">Dans cet exemple, le modèle de l’initialiseur d’objet est utilisé pour créer une nouvelle instance de type `CustomerAddress` au lieu d’appeler un constructeur.</span><span class="sxs-lookup"><span data-stu-id="e9934-131">In this example, the object initializer pattern is used to create a new instance of the `CustomerAddress` type instead of calling a constructor.</span></span> <span data-ttu-id="e9934-132">Les constructeurs ne sont pas pris en charge lors de la projection dans des types d'entité, mais ils peuvent être utilisés pour les projections dans des types de non-entité et anonymes.</span><span class="sxs-lookup"><span data-stu-id="e9934-132">Constructors are not supported when projecting into entity types, but they can be used when projecting into non-entity and anonymous types.</span></span> <span data-ttu-id="e9934-133">Étant donné que `CustomerAddress` est un type d'entité, les modifications peuvent être apportées et renvoyées au service de données.</span><span class="sxs-lookup"><span data-stu-id="e9934-133">Because `CustomerAddress` is an entity type, changes can be made and sent back to the data service.</span></span>

<span data-ttu-id="e9934-134">De même, les données de type `Customer` sont projetées dans une instance du type d'entité `CustomerAddress` au lieu d'un type anonyme.</span><span class="sxs-lookup"><span data-stu-id="e9934-134">Also, the data from the `Customer` type is projected into an instance of the `CustomerAddress` entity type instead of an anonymous type.</span></span> <span data-ttu-id="e9934-135">La projection dans des types anonymes est prise en charge, mais les données sont en lecture seule parce que les types anonymes sont traités comme des types de non-entité.</span><span class="sxs-lookup"><span data-stu-id="e9934-135">Projection into anonymous types is supported, but the data is read-only because anonymous types are treated as non-entity types.</span></span>

<span data-ttu-id="e9934-136">Les paramètres de <xref:System.Data.Services.Client.MergeOption> de <xref:System.Data.Services.Client.DataServiceContext> sont utilisés pour la résolution de l’identité pendant la projection de la requête.</span><span class="sxs-lookup"><span data-stu-id="e9934-136">The <xref:System.Data.Services.Client.MergeOption> settings of the <xref:System.Data.Services.Client.DataServiceContext> are used for identity resolution during query projection.</span></span> <span data-ttu-id="e9934-137">Cela signifie que si une instance de type `Customer` existe déjà dans <xref:System.Data.Services.Client.DataServiceContext>, une instance `CustomerAddress` avec la même identité suit les règles de résolution de l'identité définies par <xref:System.Data.Services.Client.MergeOption></span><span class="sxs-lookup"><span data-stu-id="e9934-137">This means that if an instance of the `Customer` type already exists in the <xref:System.Data.Services.Client.DataServiceContext>, an instance of `CustomerAddress` with the same identity will follow the identity resolution rules set by the <xref:System.Data.Services.Client.MergeOption></span></span>

<span data-ttu-id="e9934-138">Les éléments suivants décrivent les comportements lors de la projection de résultats dans des types d’entité et non d’entité :</span><span class="sxs-lookup"><span data-stu-id="e9934-138">The following describes the behaviors when projecting results into entity and non-entity types:</span></span>

<span data-ttu-id="e9934-139">**Création d’une nouvelle instance projetée à l’aide d’initialiseurs**</span><span class="sxs-lookup"><span data-stu-id="e9934-139">**Creating a new projected instance by using initializers**</span></span>

- <span data-ttu-id="e9934-140">Exemple :</span><span class="sxs-lookup"><span data-stu-id="e9934-140">Example:</span></span>

   [!code-csharp[Astoria Northwind Client#ProjectWithInitializer](~/samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#projectwithinitializer)]
   [!code-vb[Astoria Northwind Client#ProjectWithInitializer](~/samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#projectwithinitializer)]

- <span data-ttu-id="e9934-141">Type d’entité : pris en charge</span><span class="sxs-lookup"><span data-stu-id="e9934-141">Entity type: Supported</span></span>

- <span data-ttu-id="e9934-142">Type non-entité : pris en charge</span><span class="sxs-lookup"><span data-stu-id="e9934-142">Non-entity type: Supported</span></span>

<span data-ttu-id="e9934-143">**Création d’une nouvelle instance projetée à l’aide de constructeurs**</span><span class="sxs-lookup"><span data-stu-id="e9934-143">**Creating a new projected instance by using constructors**</span></span>

- <span data-ttu-id="e9934-144">Exemple :</span><span class="sxs-lookup"><span data-stu-id="e9934-144">Example:</span></span>

   [!code-csharp[Astoria Northwind Client#ProjectWithConstructor](~/samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#projectwithconstructor)]
   [!code-vb[Astoria Northwind Client#ProjectWithConstructor](~/samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#projectwithconstructor)]

- <span data-ttu-id="e9934-145">Type d’entité : un <xref:System.NotSupportedException> est déclenché.</span><span class="sxs-lookup"><span data-stu-id="e9934-145">Entity type: A <xref:System.NotSupportedException> is raised.</span></span>

- <span data-ttu-id="e9934-146">Type non-entité : pris en charge</span><span class="sxs-lookup"><span data-stu-id="e9934-146">Non-entity type: Supported</span></span>

<span data-ttu-id="e9934-147">**Utilisation de la projection pour transformer une valeur de propriété**</span><span class="sxs-lookup"><span data-stu-id="e9934-147">**Using projection to transform a property value**</span></span>

- <span data-ttu-id="e9934-148">Exemple :</span><span class="sxs-lookup"><span data-stu-id="e9934-148">Example:</span></span>

   [!code-csharp[Astoria Northwind Client#ProjectWithTransform](~/samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#projectwithtransform)]
   [!code-vb[Astoria Northwind Client#ProjectWithTransform](~/samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#projectwithtransform)]

- <span data-ttu-id="e9934-149">Type d’entité : cette transformation n’est pas prise en charge pour les types d’entité, car elle peut entraîner des confusions et remplacer potentiellement les données de la source de données qui appartiennent à une autre entité.</span><span class="sxs-lookup"><span data-stu-id="e9934-149">Entity type: This transformation is not supported for entity types because it can lead to confusion and potentially overwriting the data in the data source that belongs to another entity.</span></span> <span data-ttu-id="e9934-150"><xref:System.NotSupportedException> est levée.</span><span class="sxs-lookup"><span data-stu-id="e9934-150">A <xref:System.NotSupportedException> is raised.</span></span>

- <span data-ttu-id="e9934-151">Type non-entité : pris en charge</span><span class="sxs-lookup"><span data-stu-id="e9934-151">Non-entity type: Supported</span></span>

<a name="considerations"></a>

## <a name="projection-considerations"></a><span data-ttu-id="e9934-152">Considérations sur la projection</span><span class="sxs-lookup"><span data-stu-id="e9934-152">Projection Considerations</span></span>

<span data-ttu-id="e9934-153">Les considérations supplémentaires suivantes s'appliquent à la définition d'une projection de requête.</span><span class="sxs-lookup"><span data-stu-id="e9934-153">The following additional considerations apply when defining a query projection.</span></span>

- <span data-ttu-id="e9934-154">Lorsque vous définissez des flux personnalisés au format Atom, vous devez vérifier que toutes les propriétés de l'entité qui ont des mappages personnalisés définis sont incluses dans la projection.</span><span class="sxs-lookup"><span data-stu-id="e9934-154">When you define custom feeds for the Atom format, you must make sure that all entity properties that have custom mappings defined are included in the projection.</span></span> <span data-ttu-id="e9934-155">Lorsqu'une propriété d'entité mappée n'est pas incluse dans la projection, une perte de données peut se produire.</span><span class="sxs-lookup"><span data-stu-id="e9934-155">When a mapped entity property is not included in the projection, data loss might occur.</span></span> <span data-ttu-id="e9934-156">Pour plus d’informations, consultez [Personnalisation des flux](feed-customization-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="e9934-156">For more information, see [Feed Customization](feed-customization-wcf-data-services.md).</span></span>

- <span data-ttu-id="e9934-157">Lorsque des insertions sont apportées à un type projeté qui ne contient pas toutes les propriétés de l'entité du modèle de données du service de données, les propriétés non incluses dans la projection sur le client sont définies sur les valeurs par défaut.</span><span class="sxs-lookup"><span data-stu-id="e9934-157">When inserts are made to a projected type that does not contain all of the properties of the entity in the data model of the data service, the properties not included in the projection at the client are set to their default values.</span></span>

- <span data-ttu-id="e9934-158">Lorsque des mises à jour sont apportées à un type projeté qui ne contient pas toutes les propriétés de l'entité du modèle de données du service de données, les valeurs existantes non incluses dans la projection sur le client sont remplacées par les valeurs par défaut non initialisées.</span><span class="sxs-lookup"><span data-stu-id="e9934-158">When updates are made to a projected type that does not contain all of the properties of the entity in the data model of the data service, existing values not included in the projection on the client will be overwritten with uninitialized default values.</span></span>

- <span data-ttu-id="e9934-159">Lorsqu'une projection inclut une propriété complexe, l'objet complexe entier doit être retourné.</span><span class="sxs-lookup"><span data-stu-id="e9934-159">When a projection includes a complex property, the entire complex object must be returned.</span></span>

- <span data-ttu-id="e9934-160">Lorsqu'une projection inclut une propriété de navigation, les objets connexes sont chargés implicitement sans devoir appeler la méthode <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A>.</span><span class="sxs-lookup"><span data-stu-id="e9934-160">When a projection includes a navigation property, the related objects are loaded implicitly without having to call the <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> method.</span></span> <span data-ttu-id="e9934-161">La méthode <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> n'est pas prise en charge pour une utilisation dans une requête projetée.</span><span class="sxs-lookup"><span data-stu-id="e9934-161">The <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> method is not supported for use in a projected query.</span></span>

- <span data-ttu-id="e9934-162">Les requêtes de projections de requête sur le client sont traduites pour utiliser l'option de requête `$select` dans l'URI de requête.</span><span class="sxs-lookup"><span data-stu-id="e9934-162">Query projections queries on the client are translated to use the `$select` query option in the request URI.</span></span> <span data-ttu-id="e9934-163">Lorsqu’une requête avec projection est exécutée sur une version antérieure de WCF Data Services qui ne prend pas en charge l’option de requête `$select`, une erreur est retournée.</span><span class="sxs-lookup"><span data-stu-id="e9934-163">When a query with projection is executed against a previous version of WCF Data Services that does not support the `$select` query option, an error is returned.</span></span> <span data-ttu-id="e9934-164">Cela peut également arriver lorsque <xref:System.Data.Services.DataServiceBehavior.MaxProtocolVersion%2A> de <xref:System.Data.Services.DataServiceBehavior> pour le service de données est défini sur une valeur <xref:System.Data.Services.Common.DataServiceProtocolVersion.V1>.</span><span class="sxs-lookup"><span data-stu-id="e9934-164">This can also happen when the <xref:System.Data.Services.DataServiceBehavior.MaxProtocolVersion%2A> of the <xref:System.Data.Services.DataServiceBehavior> for the data service is set to a value of <xref:System.Data.Services.Common.DataServiceProtocolVersion.V1>.</span></span> <span data-ttu-id="e9934-165">Pour plus d’informations, consultez contrôle de [version des services de données](data-service-versioning-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="e9934-165">For more information, see [Data Service Versioning](data-service-versioning-wcf-data-services.md).</span></span>

<span data-ttu-id="e9934-166">Pour plus d’informations, consultez Guide pratique [pour projeter des résultats de requête](how-to-project-query-results-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="e9934-166">For more information, see [How to: Project Query Results](how-to-project-query-results-wcf-data-services.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="e9934-167">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="e9934-167">See also</span></span>

- [<span data-ttu-id="e9934-168">Interrogation du service de données</span><span class="sxs-lookup"><span data-stu-id="e9934-168">Querying the Data Service</span></span>](querying-the-data-service-wcf-data-services.md)

---
title: Remontée de la gestion des transactions
description: En savoir plus sur la remontée de la gestion des transactions dans .NET, qui est le processus de migration d’une transaction d’un des composants d’un gestionnaire de transactions vers un autre.
ms.date: 03/30/2017
ms.assetid: 1e96331e-31b6-4272-bbbd-29ed1e110460
ms.openlocfilehash: 83abca2e2c9acf53ce3f72d6bc55a82964b99cb5
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/24/2020
ms.locfileid: "91155437"
---
# <a name="transaction-management-escalation"></a><span data-ttu-id="8c4c8-103">Remontée de la gestion des transactions</span><span class="sxs-lookup"><span data-stu-id="8c4c8-103">Transaction Management Escalation</span></span>

<span data-ttu-id="8c4c8-104">Windows héberge un ensemble de services et de modules qui constituent ensemble un gestionnaire de transactions.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-104">Windows hosts a set of services and modules that together constitute a transaction manager.</span></span> <span data-ttu-id="8c4c8-105">La remontée de la gestion des transactions décrit le processus de migration d'une transaction de l'un des composants du gestionnaire de transactions à un autre.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-105">Transaction management escalation describes the process of migrating a transaction from one of the transaction manager's components to another.</span></span>  
  
 <span data-ttu-id="8c4c8-106"><xref:System.Transactions> comprend un composant de gestionnaire de transactions qui coordonne une transaction impliquant au maximum une seule ressource durable ou plusieurs ressources volatiles.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-106"><xref:System.Transactions> includes a transaction manager component that coordinates a transaction involving at most, a single durable resource or multiple volatile resources.</span></span> <span data-ttu-id="8c4c8-107">Le gestionnaire de transactions n'utilise que des appels intra-domaines d'application, il offre donc d'excellentes performances.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-107">Because the transaction manager uses only intra-application domain calls, it yields the best performance.</span></span> <span data-ttu-id="8c4c8-108">Les développeurs n'ont pas besoin d'interagir directement avec le gestionnaire de transactions.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-108">Developers need not interact with the transaction manager directly.</span></span> <span data-ttu-id="8c4c8-109">À la place, l'espace de noms <xref:System.Transactions> fournit une infrastructure commune qui définit les interfaces, le comportement commun et les classes d'assistance.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-109">Instead, a common infrastructure that defines interfaces, common behavior, and helper classes is provided by the <xref:System.Transactions> namespace.</span></span>  
  
 <span data-ttu-id="8c4c8-110">Lorsque vous souhaitez fournir la transaction à un objet dans un autre domaine d’application (y compris au-delà des limites du processus et de l’ordinateur) sur le même ordinateur, l' <xref:System.Transactions> infrastructure remonte automatiquement la transaction à gérer par le Microsoft Distributed Transaction Coordinator (MSDTC).</span><span class="sxs-lookup"><span data-stu-id="8c4c8-110">When you want to provide the transaction to an object in another application domain (including across process and machine boundaries) on the same computer, the <xref:System.Transactions> infrastructure automatically escalates the transaction to be managed by the Microsoft Distributed Transaction Coordinator (MSDTC).</span></span> <span data-ttu-id="8c4c8-111">La remontée se produit également en cas d'inscription à un autre gestionnaire de ressources durables.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-111">The escalation also occurs if you enlist another durable resource manager.</span></span> <span data-ttu-id="8c4c8-112">Une fois remontée, la transaction reste managée à son état élevé jusqu'à ce qu'elle soit terminée.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-112">When escalated, the transaction remains managed in its elevated state until its completion.</span></span>  
  
 <span data-ttu-id="8c4c8-113">Entre la transaction <xref:System.Transactions> et la transaction MSDTC, il existe un type intermédiaire de transaction disponible via la PSPE (Promotable Single Phase Enlistment).</span><span class="sxs-lookup"><span data-stu-id="8c4c8-113">Between the <xref:System.Transactions> transaction and MSDTC transaction, there is an intermediary type of transaction that is made available through the Promotable Single Phase Enlistment (PSPE).</span></span> <span data-ttu-id="8c4c8-114">La PSPE est un autre mécanisme important de <xref:System.Transactions>, conçu pour l'optimisation des performances.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-114">PSPE is another important mechanism in <xref:System.Transactions> for performance optimization.</span></span> <span data-ttu-id="8c4c8-115">Il permet à une ressource durable distante, située dans un domaine d'application, un processus ou un ordinateur différent, de participer à une transaction <xref:System.Transactions> sans la faire remonter vers une transaction MSDTC.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-115">It allows a remote durable resource, located in a different application domain, process or computer, to participate in a <xref:System.Transactions> transaction without causing it to be escalated to an MSDTC transaction.</span></span> <span data-ttu-id="8c4c8-116">Pour plus d’informations sur PSPE, consultez [inscription de ressources en tant que participants dans une transaction](enlisting-resources-as-participants-in-a-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="8c4c8-116">For more information about PSPE, see [Enlisting Resources as Participants in a Transaction](enlisting-resources-as-participants-in-a-transaction.md).</span></span>  
  
## <a name="how-escalation-is-initiated"></a><span data-ttu-id="8c4c8-117">Initialisation de la remontée</span><span class="sxs-lookup"><span data-stu-id="8c4c8-117">How Escalation is Initiated</span></span>  

 <span data-ttu-id="8c4c8-118">La remontée de transactions réduit les performances car le MSDTC réside dans un processus séparé et remonter une transaction vers le MSDTC entraîne l'envoi de messages entre les processus.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-118">Transaction escalation reduces performance because the MSDTC resides in a separate process, and escalating a transaction to the MSDTC results in messages being sent across process.</span></span> <span data-ttu-id="8c4c8-119">Pour améliorer les performances, vous devez différer ou éviter toute remontée vers le MSDTC ; vous devez donc connaître la méthode et l'heure d'initialisation de la remontée.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-119">To improve performance, you should delay or avoid escalation to MSDTC; thus, you need to know how and when the escalation is initiated.</span></span>  
  
 <span data-ttu-id="8c4c8-120">Tant que l'infrastructure <xref:System.Transactions> gère plusieurs ressources volatiles et au moins une ressource durable qui prend en charge les notifications à phase unique, la transaction reste la propriété de l'infrastructure <xref:System.Transactions>.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-120">As long as the <xref:System.Transactions> infrastructure handles volatile resources and at most one durable resource that supports single-phase notifications, the transaction remains in the ownership of the <xref:System.Transactions> infrastructure.</span></span> <span data-ttu-id="8c4c8-121">Le gestionnaire de transactions ne se rend disponible que pour les ressources qui appartiennent au même domaine d'application et pour lesquelles aucune connexion (écriture du résultat de la transaction sur le disque) n'est requise.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-121">The transaction manager avails itself only to those resources that live in the same application domain and for which logging (writing the transaction outcome to disk) is not required.</span></span> <span data-ttu-id="8c4c8-122">Une remontée qui provoque le transfert de la propriété de la transaction vers le MSDTC par l'infrastructure <xref:System.Transactions> se produit :</span><span class="sxs-lookup"><span data-stu-id="8c4c8-122">An escalation that results in the <xref:System.Transactions> infrastructure transferring the ownership of the transaction to MSDTC happens when:</span></span>  
  
- <span data-ttu-id="8c4c8-123">lorsqu'au moins une ressource durable qui ne prend pas en charge les notifications à phase unique est inscrite pour la transaction.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-123">At least one durable resource that does not support single-phase notifications is enlisted in the transaction.</span></span>  
  
- <span data-ttu-id="8c4c8-124">lorsqu'au moins deux ressources durables qui prennent en charge les notifications à phase unique sont inscrites pour la transaction.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-124">At least two durable resources that support single-phase notifications are enlisted in the transaction.</span></span> <span data-ttu-id="8c4c8-125">Par exemple, l’inscription d’une connexion unique avec SQL Server 2005 ne provoque pas la promotion d’une transaction.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-125">For example, enlisting a single connection with SQL Server 2005 does not cause a transaction to be promoted.</span></span> <span data-ttu-id="8c4c8-126">Toutefois, chaque fois que vous ouvrez une deuxième connexion à une base de données SQL Server 2005, ce qui entraîne l’inscription de la base de données, l' <xref:System.Transactions> infrastructure détecte qu’il s’agit de la deuxième ressource durable de la transaction et la transmet à une transaction MSDTC.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-126">However, whenever you open a second connection to a SQL Server 2005 database causing the database to enlist, the <xref:System.Transactions> infrastructure detects that it is the second durable resource in the transaction, and escalates it to an MSDTC transaction.</span></span>  
  
- <span data-ttu-id="8c4c8-127">Une requête visant à « marshaler » la transaction vers un domaine d'application ou un processus différent est appelée.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-127">A request to "marshal" the transaction to a different application domain or different process is invoked.</span></span> <span data-ttu-id="8c4c8-128">Par exemple, la sérialisation de l'objet de transaction au-delà d'une limite de domaine d'application.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-128">For example, the serialization of the transaction object across an application domain boundary.</span></span> <span data-ttu-id="8c4c8-129">L'objet de transaction est marshalé par valeur, ce qui signifie que chaque tentative de passage au-delà d'une limite de domaine d'application (même au sein d'un même processus) entraîne la sérialisation de l'objet de transaction.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-129">The transaction object is marshaled-by-value, meaning that any attempt to pass it across an application domain boundary (even in the same process) results in serialization of the transaction object.</span></span> <span data-ttu-id="8c4c8-130">Vous pouvez passer les objets de transaction en appelant une méthode distante qui utilise <xref:System.Transactions.Transaction> en tant que paramètre ou tenter d'accéder à un composant distant pris en charge par transaction.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-130">You can pass the transaction objects by making a call on a remote method that takes a <xref:System.Transactions.Transaction> as a parameter or you can try to access a remote transactional-serviced component.</span></span> <span data-ttu-id="8c4c8-131">Cette opération entraîne la sérialisation de l'objet de transaction et provoque une remontée, comme lorsqu'une transaction est sérialisée au-delà d'un domaine d'application.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-131">This serializes the transaction object and results in an escalation, as when a transaction is serialized across an application domain.</span></span> <span data-ttu-id="8c4c8-132">Il est distribué et le gestionnaire de transactions local devient inadapté.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-132">It is being distributed and the local transaction manager is no longer adequate.</span></span>  
  
 <span data-ttu-id="8c4c8-133">Le tableau suivant répertorie toutes les exceptions susceptibles d'être levées lors de la remontée.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-133">The following table lists all the possible exceptions that can be thrown during escalation.</span></span>  
  
|<span data-ttu-id="8c4c8-134">Type d'exception</span><span class="sxs-lookup"><span data-stu-id="8c4c8-134">Exception type</span></span>|<span data-ttu-id="8c4c8-135">Condition</span><span class="sxs-lookup"><span data-stu-id="8c4c8-135">Condition</span></span>|  
|--------------------|---------------|  
|<xref:System.InvalidOperationException>|<span data-ttu-id="8c4c8-136">Tentative de remontée d'une transaction avec un niveau d'isolation égal à <xref:System.Transactions.IsolationLevel.Snapshot>.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-136">An attempt to escalate a transaction with isolation level equal to <xref:System.Transactions.IsolationLevel.Snapshot>.</span></span>|  
|<xref:System.Transactions.TransactionAbortedException>|<span data-ttu-id="8c4c8-137">Le gestionnaire de transactions est arrêté.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-137">The transaction manager is down.</span></span>|  
|<xref:System.Transactions.TransactionException>|<span data-ttu-id="8c4c8-138">La remontée échoue et l'application est abandonnée.</span><span class="sxs-lookup"><span data-stu-id="8c4c8-138">The escalation fails and the application is aborted.</span></span>|

---
title: Clichés instantanés d'assemblys
ms.date: 03/30/2017
helpviewer_keywords:
- assemblies [.NET Framework], shadow copying
- application domains, shadow copying assemblies
- shadow copying assemblies
ms.assetid: de8b8759-fca7-4260-896b-5a4973157672
ms.openlocfilehash: 9fc8a4aeeeca40f71ed9114a9db40b9a56e5fe6b
ms.sourcegitcommit: 81ad1f09b93f3b3e6706a7f2e4ddf50ef229ea3d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/20/2019
ms.locfileid: "74204570"
---
# <a name="shadow-copying-assemblies"></a><span data-ttu-id="0d8ab-102">Clichés instantanés d'assemblys</span><span class="sxs-lookup"><span data-stu-id="0d8ab-102">Shadow Copying Assemblies</span></span>

<span data-ttu-id="0d8ab-103">Les clichés instantanés permettent aux assemblys qui sont utilisés dans un domaine d'application d'être mis à jour sans décharger le domaine d'application.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-103">Shadow copying enables assemblies that are used in an application domain to be updated without unloading the application domain.</span></span> <span data-ttu-id="0d8ab-104">Ceci est particulièrement utile pour les applications qui doivent être disponibles en permanence, comme des sites ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-104">This is particularly useful for applications that must be available continuously, such as ASP.NET sites.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="0d8ab-105">Shadow copying is not supported in Windows 8.x Store apps.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-105">Shadow copying is not supported in Windows 8.x Store apps.</span></span>

<span data-ttu-id="0d8ab-106">Le common language runtime verrouille un fichier d'assembly quand l'assembly est chargé, de sorte que le fichier ne peut pas être mis à jour jusqu'à ce que l'assembly soit déchargé.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-106">The common language runtime locks an assembly file when the assembly is loaded, so the file cannot be updated until the assembly is unloaded.</span></span> <span data-ttu-id="0d8ab-107">La seule façon de décharger un assembly d'un domaine d'application est de décharger le domaine d'application. Donc, dans des circonstances normales, un assembly ne peut pas être mis à jour sur le disque tant que tous les domaines d'application qui l'utilisent n'ont pas été déchargés.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-107">The only way to unload an assembly from an application domain is by unloading the application domain, so under normal circumstances, an assembly cannot be updated on disk until all the application domains that are using it have been unloaded.</span></span>

<span data-ttu-id="0d8ab-108">Quand un domaine d'application est configuré pour effectuer un cliché instantané des fichiers, les assemblys du chemin d'accès de l'application sont copiés vers un autre emplacement et chargés à partir de cet emplacement.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-108">When an application domain is configured to shadow copy files, assemblies from the application path are copied to another location and loaded from that location.</span></span> <span data-ttu-id="0d8ab-109">La copie est verrouillée, mais le fichier d'assembly d'origine est déverrouillé et peut être mis à jour.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-109">The copy is locked, but the original assembly file is unlocked and can be updated.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="0d8ab-110">Les seuls assemblys qui peuvent faire l'objet de clichés instantanés sont ceux qui sont stockés dans le répertoire de l'application ou dans ses sous-répertoires, spécifiés par les propriétés <xref:System.AppDomainSetup.ApplicationBase%2A> et <xref:System.AppDomainSetup.PrivateBinPath%2A> quand le domaine d'application est configuré.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-110">The only assemblies that can be shadow copied are those stored in the application directory or its subdirectories, specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties when the application domain is configured.</span></span> <span data-ttu-id="0d8ab-111">Les assemblys stockés dans le Global Assembly Cache ne sont pas l'objet de clichés instantanés.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-111">Assemblies stored in the global assembly cache are not shadow copied.</span></span>

<span data-ttu-id="0d8ab-112">Cet article contient les sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="0d8ab-112">This article contains the following sections:</span></span>

- <span data-ttu-id="0d8ab-113">[Activation et utilisation des clichés instantanés](#EnablingAndUsing) décrit l’utilisation de base et les options disponibles pour les clichés instantanés.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-113">[Enabling and Using Shadow Copying](#EnablingAndUsing) describes the basic use and the options that are available for shadow copying.</span></span>

- <span data-ttu-id="0d8ab-114">[Performances du démarrage](#StartupPerformance) décrit les changements apportés aux clichés instantanés dans .NET Framework 4 pour améliorer les performances du démarrage, et comment rétablir le comportement des versions antérieures.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-114">[Startup Performance](#StartupPerformance) describes the changes that are made to shadow copying in the .NET Framework 4 to improve startup performance, and how to revert to the behavior of earlier versions.</span></span>

- <span data-ttu-id="0d8ab-115">[Méthodes obsolètes](#ObsoleteMethods) décrit les changements apportés aux propriétés et aux méthodes qui contrôlent les clichés instantanés dans .NET Framework 2.0.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-115">[Obsolete Methods](#ObsoleteMethods) describes the changes that were made to the properties and methods that control shadow copying in the .NET Framework 2.0.</span></span>

<a name="EnablingAndUsing"></a>

## <a name="enabling-and-using-shadow-copying"></a><span data-ttu-id="0d8ab-116">Activation et utilisation des clichés instantanés</span><span class="sxs-lookup"><span data-stu-id="0d8ab-116">Enabling and Using Shadow Copying</span></span>

<span data-ttu-id="0d8ab-117">Vous pouvez utiliser les propriétés de la classe <xref:System.AppDomainSetup> comme suit pour configurer un domaine d'application pour les clichés instantanés :</span><span class="sxs-lookup"><span data-stu-id="0d8ab-117">You can use the properties of the <xref:System.AppDomainSetup> class as follows to configure an application domain for shadow copying:</span></span>

- <span data-ttu-id="0d8ab-118">Activez les clichés instantanés en définissant la propriété <xref:System.AppDomainSetup.ShadowCopyFiles%2A> à la valeur de chaîne `"true"`.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-118">Enable shadow copying by setting the <xref:System.AppDomainSetup.ShadowCopyFiles%2A> property to the string value `"true"`.</span></span>

  <span data-ttu-id="0d8ab-119">Par défaut, cette valeur fait que tous les assemblys dans le chemin d'accès de l'application sont copiés vers un cache de téléchargement avant leur chargement.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-119">By default, this setting causes all assemblies in the application path to be copied to a download cache before they are loaded.</span></span> <span data-ttu-id="0d8ab-120">Il s'agit du même cache que celui qui est géré par le common language runtime pour stocker les fichiers téléchargés à partir d'autres ordinateurs. Le common language runtime supprime automatiquement les fichiers quand ils ne sont plus nécessaires.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-120">This is the same cache maintained by the common language runtime to store files downloaded from other computers, and the common language runtime automatically deletes the files when they are no longer needed.</span></span>

- <span data-ttu-id="0d8ab-121">Vous pouvez aussi définir un emplacement personnalisé pour les fichiers des clichés instantanés en utilisant les propriétés <xref:System.AppDomainSetup.CachePath%2A> et <xref:System.AppDomainSetup.ApplicationName%2A>.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-121">Optionally set a custom location for shadow copied files by using the <xref:System.AppDomainSetup.CachePath%2A> property and the <xref:System.AppDomainSetup.ApplicationName%2A> property.</span></span>

  <span data-ttu-id="0d8ab-122">Le chemin d'accès de base de l'emplacement est formé en concaténant la propriété <xref:System.AppDomainSetup.ApplicationName%2A> et la propriété <xref:System.AppDomainSetup.CachePath%2A> comme sous-répertoire.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-122">The base path for the location is formed by concatenating the <xref:System.AppDomainSetup.ApplicationName%2A> property to the <xref:System.AppDomainSetup.CachePath%2A> property as a subdirectory.</span></span> <span data-ttu-id="0d8ab-123">Les clichés instantanés des assemblys sont copiés vers des sous-répertoires de ce chemin d'accès, et non pas dans le chemin d'accès de base lui-même.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-123">Assemblies are shadow copied to subdirectories of this path, not to the base path itself.</span></span>

  > [!NOTE]
  > <span data-ttu-id="0d8ab-124">Si la propriété <xref:System.AppDomainSetup.ApplicationName%2A> n'est pas définie, la propriété <xref:System.AppDomainSetup.CachePath%2A> est ignorée et le cache de téléchargement est utilisé.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-124">If the <xref:System.AppDomainSetup.ApplicationName%2A> property is not set, the <xref:System.AppDomainSetup.CachePath%2A> property is ignored and the download cache is used.</span></span> <span data-ttu-id="0d8ab-125">Aucune exception n'est levée.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-125">No exception is thrown.</span></span>

  <span data-ttu-id="0d8ab-126">Si vous spécifiez un emplacement personnalisé, vous devez vous charger de nettoyer les répertoires et les fichiers copiés quand ils ne sont plus nécessaires.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-126">If you specify a custom location, you are responsible for cleaning up the directories and copied files when they are no longer needed.</span></span> <span data-ttu-id="0d8ab-127">Ils ne sont pas supprimés automatiquement.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-127">They are not deleted automatically.</span></span>

  <span data-ttu-id="0d8ab-128">Il existe plusieurs raisons pour lesquelles vous voudrez peut-être définir un emplacement personnalisé pour les fichiers de clichés instantanés.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-128">There are a few reasons why you might want to set a custom location for shadow copied files.</span></span> <span data-ttu-id="0d8ab-129">Vous pouvez souhaiter définir un emplacement personnalisé pour les fichiers de clichés instantanés si votre application génère un grand nombre de copies.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-129">You might want to set a custom location for shadow copied files if your application generates a large number of copies.</span></span> <span data-ttu-id="0d8ab-130">Le cache de téléchargement est limité en taille, pas quant à la durée de vie : il est donc possible que le common language runtime tente de supprimer un fichier qui est toujours en cours d'utilisation.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-130">The download cache is limited by size, not by lifetime, so it is possible that the common language runtime will attempt to delete a file that is still in use.</span></span> <span data-ttu-id="0d8ab-131">Une autre raison pour définir un emplacement personnalisé est quand des utilisateurs exécutant votre application n'ont pas d'accès en écriture à l'emplacement du répertoire utilisé par common language runtime pour le cache de téléchargement.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-131">Another reason to set a custom location is when users running your application do not have write access to the directory location the common language runtime uses for the download cache.</span></span>

- <span data-ttu-id="0d8ab-132">Limitez éventuellement les assemblys qui font l'objet de clichés instantanés en utilisant la propriété <xref:System.AppDomainSetup.ShadowCopyDirectories%2A>.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-132">Optionally limit the assemblies that are shadow copied by using the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property.</span></span>

  <span data-ttu-id="0d8ab-133">Quand vous activez les clichés instantanés pour un domaine d'application, le comportement par défaut est de copier tous les assemblys dans le chemin d'accès de l'application, c'est-à-dire dans les répertoires spécifiés par les propriétés <xref:System.AppDomainSetup.ApplicationBase%2A> et <xref:System.AppDomainSetup.PrivateBinPath%2A>.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-133">When you enable shadow copying for an application domain, the default is to copy all assemblies in the application path — that is, in the directories specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties.</span></span> <span data-ttu-id="0d8ab-134">Vous pouvez limiter la copie vers les répertoires sélectionnés en créant une chaîne qui contient seulement les répertoires pour lesquels vous voulez effectuer des clichés instantanés, et en l'affectant à la propriété <xref:System.AppDomainSetup.ShadowCopyDirectories%2A>.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-134">You can limit the copying to selected directories by creating a string that contains only those directories you want to shadow copy, and assigning the string to the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property.</span></span> <span data-ttu-id="0d8ab-135">Séparez les répertoires par des points-virgules.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-135">Separate the directories with semicolons.</span></span> <span data-ttu-id="0d8ab-136">Les seuls assemblys qui font l'objet de clichés instantanés sont alors ceux des répertoires sélectionnés.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-136">The only assemblies that are shadow copied are the ones in the selected directories.</span></span>

  > [!NOTE]
  > <span data-ttu-id="0d8ab-137">Si vous n'affectez pas une chaîne à la propriété <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> ou si vous définissez cette propriété à `null`, tous les assemblys dans les répertoires spécifiés par les propriétés <xref:System.AppDomainSetup.ApplicationBase%2A> et <xref:System.AppDomainSetup.PrivateBinPath%2A> font l'objet d'un cliché instantané.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-137">If you don’t assign a string to the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property, or if you set this property to `null`, all assemblies in the directories specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties are shadow copied.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="0d8ab-138">Les chemins d'accès des répertoires ne doivent pas contenir de points-virgules, car le point-virgule est le caractère délimiteur.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-138">Directory paths must not contain semicolons, because the semicolon is the delimiter character.</span></span> <span data-ttu-id="0d8ab-139">Il n'existe pas de caractère d'échappement pour les points-virgules.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-139">There is no escape character for semicolons.</span></span>

<a name="StartupPerformance"></a>

## <a name="startup-performance"></a><span data-ttu-id="0d8ab-140">Performances du démarrage</span><span class="sxs-lookup"><span data-stu-id="0d8ab-140">Startup Performance</span></span>

<span data-ttu-id="0d8ab-141">Quand un domaine d'application qui utilise des clichés instantanés démarre, un certain délai est nécessaire pour que les assemblys du répertoire de l'application soient copiés dans le répertoire des clichés instantanés, ou pour qu'ils soient vérifiés s'ils se trouvent déjà à cet emplacement.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-141">When an application domain that uses shadow copying starts, there is a delay while assemblies in the application directory are copied to the shadow copy directory, or verified if they are already in that location.</span></span> <span data-ttu-id="0d8ab-142">Avant .NET Framework 4, tous les assemblys étaient copiés dans un répertoire temporaire.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-142">Before the .NET Framework 4, all assemblies were copied to a temporary directory.</span></span> <span data-ttu-id="0d8ab-143">Chaque assembly était ouvert pour vérifier le nom de l'assembly et le nom fort était validé.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-143">Each assembly was opened to verify the assembly name, and the strong name was validated.</span></span> <span data-ttu-id="0d8ab-144">Chaque assembly était vérifié pour voir s'il avait été mis à jour plus récemment que la copie du répertoire des clichés instantanés.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-144">Each assembly was checked to see whether it had been updated more recently than the copy in the shadow copy directory.</span></span> <span data-ttu-id="0d8ab-145">Le cas échéant, il était copié dans le répertoire des clichés instantanés.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-145">If so, it was copied to the shadow copy directory.</span></span> <span data-ttu-id="0d8ab-146">Enfin, les copies temporaires étaient effacées.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-146">Finally, the temporary copies were discarded.</span></span>

<span data-ttu-id="0d8ab-147">Depuis .NET Framework 4, le comportement par défaut au démarrage est de comparer directement la date et l’heure du fichier de chaque assembly du répertoire de l’application à la date et l’heure du fichier de la copie du répertoire des clichés instantanés.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-147">Beginning with the .NET Framework 4, the default startup behavior is to directly compare the file date and time of each assembly in the application directory with the file date and time of the copy in the shadow copy directory.</span></span> <span data-ttu-id="0d8ab-148">Si l’assembly a été mis à jour, il est copié selon la même procédure que dans les versions antérieures du .NET Framework ; dans le cas contraire, la copie du répertoire des clichés instantanés est chargée.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-148">If the assembly has been updated, it is copied by using the same procedure as in earlier versions of the .NET Framework; otherwise, the copy in the shadow copy directory is loaded.</span></span>

<span data-ttu-id="0d8ab-149">L'amélioration des performances qui en résulte est plus importante pour les applications dans lesquelles les assemblys ne changent pas souvent et où les modifications se produisent généralement dans un petit sous-ensemble d'assemblys.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-149">The resulting performance improvement is largest for applications in which assemblies do not change frequently and changes usually occur in a small subset of assemblies.</span></span> <span data-ttu-id="0d8ab-150">Si une majorité des assemblys d'une application sont fréquemment modifiés, le nouveau comportement par défaut peut provoquer une régression des performances.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-150">If a majority of assemblies in an application change frequently, the new default behavior might cause a performance regression.</span></span> <span data-ttu-id="0d8ab-151">Vous pouvez restaurer le comportement du démarrage des versions antérieures du .NET Framework en ajoutant l’élément [\<shadowCopyVerifyByTimestamp>](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md) au fichier de configuration, avec `enabled="false"`.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-151">You can restore the startup behavior of previous versions of the .NET Framework by adding the [\<shadowCopyVerifyByTimestamp> element](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md) to the configuration file, with `enabled="false"`.</span></span>

<a name="ObsoleteMethods"></a>

## <a name="obsolete-methods"></a><span data-ttu-id="0d8ab-152">Méthodes obsolètes</span><span class="sxs-lookup"><span data-stu-id="0d8ab-152">Obsolete Methods</span></span>

<span data-ttu-id="0d8ab-153">La classe <xref:System.AppDomain> a plusieurs méthodes, comme <xref:System.AppDomain.SetShadowCopyFiles%2A> et <xref:System.AppDomain.ClearShadowCopyPath%2A>, qui peuvent être utilisées pour contrôler les clichés instantanés sur un domaine d'application, mais celles-ci ont été marquées comme étant obsolètes dans le .NET Framework version 2.0.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-153">The <xref:System.AppDomain> class has several methods, such as <xref:System.AppDomain.SetShadowCopyFiles%2A> and <xref:System.AppDomain.ClearShadowCopyPath%2A>, that can be used to control shadow copying on an application domain, but these have been marked obsolete in the .NET Framework version 2.0.</span></span> <span data-ttu-id="0d8ab-154">La méthode recommandée pour configurer un domaine d'application pour les clichés instantanés est d'utiliser les propriétés de la classe <xref:System.AppDomainSetup>.</span><span class="sxs-lookup"><span data-stu-id="0d8ab-154">The recommended way to configure an application domain for shadow copying is to use the properties of the <xref:System.AppDomainSetup> class.</span></span>

## <a name="see-also"></a><span data-ttu-id="0d8ab-155">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="0d8ab-155">See also</span></span>

- <xref:System.AppDomainSetup.ShadowCopyFiles%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.CachePath%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.ApplicationName%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.ShadowCopyDirectories%2A?displayProperty=nameWithType>
- [<span data-ttu-id="0d8ab-156">Élément \<shadowCopyVerifyByTimestamp></span><span class="sxs-lookup"><span data-stu-id="0d8ab-156">\<shadowCopyVerifyByTimestamp> Element</span></span>](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md)

---
title: 'Procédure : recevoir des notifications des exceptions de première chance'
description: Obtenir des notifications d’exceptions de première chance dans .NET via l’événement FirstChanceException de la classe AppDomain, avant que le CLR ne recherche des gestionnaires d’exceptions.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- first-chance exception notifications
- exceptions, first chance notifications
ms.assetid: 66f002b8-a97d-4a6e-a503-2cec01689113
ms.openlocfilehash: e8b5ae5fb69c7befd329316aee11523f79d73fcd
ms.sourcegitcommit: 1c37a894c923bea021a3cc38ce7cba946357bbe1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/19/2020
ms.locfileid: "85104744"
---
# <a name="how-to-receive-first-chance-exception-notifications"></a><span data-ttu-id="f3c32-103">Procédure : recevoir des notifications des exceptions de première chance</span><span class="sxs-lookup"><span data-stu-id="f3c32-103">How to: Receive First-Chance Exception Notifications</span></span>
<span data-ttu-id="f3c32-104">L’événement <xref:System.AppDomain.FirstChanceException> de la classe <xref:System.AppDomain> vous permet de recevoir la notification qu’une exception a été levée, avant que le Common Language Runtime n’ait commencé à rechercher des gestionnaires d’exceptions.</span><span class="sxs-lookup"><span data-stu-id="f3c32-104">The <xref:System.AppDomain.FirstChanceException> event of the <xref:System.AppDomain> class lets you receive a notification that an exception has been thrown, before the common language runtime has begun searching for exception handlers.</span></span>

 <span data-ttu-id="f3c32-105">L’événement est déclenché au niveau du domaine d’application.</span><span class="sxs-lookup"><span data-stu-id="f3c32-105">The event is raised at the application domain level.</span></span> <span data-ttu-id="f3c32-106">Étant donné qu’un thread d’exécution peut traverser plusieurs domaines d’application, une exception qui n’est pas gérée dans un domaine d’application pourrait être gérée dans un autre domaine d’application.</span><span class="sxs-lookup"><span data-stu-id="f3c32-106">A thread of execution can pass through multiple application domains, so an exception that is unhandled in one application domain could be handled in another application domain.</span></span> <span data-ttu-id="f3c32-107">La notification se produit dans chaque domaine d’application qui a ajouté un gestionnaire pour l’événement, jusqu’à ce qu’un domaine d’application gère l’exception.</span><span class="sxs-lookup"><span data-stu-id="f3c32-107">The notification occurs in each application domain that has added a handler for the event, until an application domain handles the exception.</span></span>

 <span data-ttu-id="f3c32-108">Les procédures et exemples dans cet article indiquent comment recevoir des notifications des exceptions de première chance dans un programme simple qui a un domaine d’application, et dans un domaine d’application que vous créez.</span><span class="sxs-lookup"><span data-stu-id="f3c32-108">The procedures and examples in this article show how to receive first-chance exception notifications in a simple program that has one application domain, and in an application domain that you create.</span></span>

 <span data-ttu-id="f3c32-109">Pour obtenir un exemple plus complexe qui couvre plusieurs domaines d’application, consultez l’exemple de l’événement <xref:System.AppDomain.FirstChanceException>.</span><span class="sxs-lookup"><span data-stu-id="f3c32-109">For a more complex example that spans several application domains, see the example for the <xref:System.AppDomain.FirstChanceException> event.</span></span>

## <a name="receiving-first-chance-exception-notifications-in-the-default-application-domain"></a><span data-ttu-id="f3c32-110">Réception de notifications des exceptions de première chance dans le domaine d’application par défaut</span><span class="sxs-lookup"><span data-stu-id="f3c32-110">Receiving First-Chance Exception Notifications in the Default Application Domain</span></span>
 <span data-ttu-id="f3c32-111">Dans la procédure suivante, le point d’entrée de l’application (la méthode `Main()`) s’exécute dans le domaine d’application par défaut.</span><span class="sxs-lookup"><span data-stu-id="f3c32-111">In the following procedure, the entry point for the application, the `Main()` method, runs in the default application domain.</span></span>

#### <a name="to-demonstrate-first-chance-exception-notifications-in-the-default-application-domain"></a><span data-ttu-id="f3c32-112">Pour illustrer les notifications des exceptions de première chance dans le domaine d’application par défaut</span><span class="sxs-lookup"><span data-stu-id="f3c32-112">To demonstrate first-chance exception notifications in the default application domain</span></span>

1. <span data-ttu-id="f3c32-113">Définissez un gestionnaire d’événements pour l’événement <xref:System.AppDomain.FirstChanceException>, à l’aide d’une fonction lambda, et attachez-le à l’événement.</span><span class="sxs-lookup"><span data-stu-id="f3c32-113">Define an event handler for the <xref:System.AppDomain.FirstChanceException> event, using a lambda function, and attach it to the event.</span></span> <span data-ttu-id="f3c32-114">Dans cet exemple, le gestionnaire d’événements imprime le nom du domaine d’application où l’événement a été géré, ainsi que la propriété <xref:System.Exception.Message%2A> de l’exception.</span><span class="sxs-lookup"><span data-stu-id="f3c32-114">In this example, the event handler prints the name of the application domain where the event was handled and the exception's <xref:System.Exception.Message%2A> property.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto_simple#2](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/cs/example.cs#2)]
     [!code-vb[System.AppDomain.FirstChanceException_howto_simple#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/vb/example.vb#2)]

2. <span data-ttu-id="f3c32-115">Levez une exception et interceptez-la.</span><span class="sxs-lookup"><span data-stu-id="f3c32-115">Throw an exception and catch it.</span></span> <span data-ttu-id="f3c32-116">Avant que le runtime ne trouve le gestionnaire d’exceptions, l’événement <xref:System.AppDomain.FirstChanceException> est déclenché et affiche un message.</span><span class="sxs-lookup"><span data-stu-id="f3c32-116">Before the runtime locates the exception handler, the <xref:System.AppDomain.FirstChanceException> event is raised and displays a message.</span></span> <span data-ttu-id="f3c32-117">Ce message est suivi du message affiché par le gestionnaire d’exceptions.</span><span class="sxs-lookup"><span data-stu-id="f3c32-117">This message is followed by the message that is displayed by the exception handler.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto_simple#3](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/cs/example.cs#3)]
     [!code-vb[System.AppDomain.FirstChanceException_howto_simple#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/vb/example.vb#3)]

3. <span data-ttu-id="f3c32-118">Levez une exception mais ne l’interceptez pas.</span><span class="sxs-lookup"><span data-stu-id="f3c32-118">Throw an exception, but do not catch it.</span></span> <span data-ttu-id="f3c32-119">Avant que le runtime ne recherche le gestionnaire d’exceptions, l’événement <xref:System.AppDomain.FirstChanceException> est déclenché et affiche un message.</span><span class="sxs-lookup"><span data-stu-id="f3c32-119">Before the runtime looks for an exception handler, the <xref:System.AppDomain.FirstChanceException> event is raised and displays a message.</span></span> <span data-ttu-id="f3c32-120">Comme il n’y a aucun gestionnaire d’exceptions, l’application s’arrête.</span><span class="sxs-lookup"><span data-stu-id="f3c32-120">There is no exception handler, so the application terminates.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto_simple#4](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/cs/example.cs#4)]
     [!code-vb[System.AppDomain.FirstChanceException_howto_simple#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/vb/example.vb#4)]

     <span data-ttu-id="f3c32-121">Le code affiché aux trois premières étapes de cette procédure forme une application console complète.</span><span class="sxs-lookup"><span data-stu-id="f3c32-121">The code that is shown in the first three steps of this procedure forms a complete console application.</span></span> <span data-ttu-id="f3c32-122">La sortie de l’application varie en fonction du nom du fichier .exe, car le nom du domaine d’application par défaut se compose du nom et de l’extension du fichier .exe.</span><span class="sxs-lookup"><span data-stu-id="f3c32-122">The output from the application varies, depending on the name of the .exe file, because the name of the default application domain consists of the name and extension of the .exe file.</span></span> <span data-ttu-id="f3c32-123">Vous trouverez ci-dessous un exemple de sortie.</span><span class="sxs-lookup"><span data-stu-id="f3c32-123">See the following for sample output.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto_simple#5](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/cs/example.cs#5)]
     [!code-vb[System.AppDomain.FirstChanceException_howto_simple#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/vb/example.vb#5)]

## <a name="receiving-first-chance-exception-notifications-in-another-application-domain"></a><span data-ttu-id="f3c32-124">Réception de notifications des exceptions de première chance dans un autre domaine d’application</span><span class="sxs-lookup"><span data-stu-id="f3c32-124">Receiving First-Chance Exception Notifications in Another Application Domain</span></span>
 <span data-ttu-id="f3c32-125">Si votre programme contient plusieurs domaines d’application, vous pouvez choisir ceux qui reçoivent des notifications.</span><span class="sxs-lookup"><span data-stu-id="f3c32-125">If your program contains more than one application domain, you can choose which application domains receive notifications.</span></span>

#### <a name="to-receive-first-chance-exception-notifications-in-an-application-domain-that-you-create"></a><span data-ttu-id="f3c32-126">Pour recevoir des notifications des exceptions de première chance dans un domaine d’application que vous créez</span><span class="sxs-lookup"><span data-stu-id="f3c32-126">To receive first-chance exception notifications in an application domain that you create</span></span>

1. <span data-ttu-id="f3c32-127">Définissez un gestionnaire d’événements pour l’événement <xref:System.AppDomain.FirstChanceException>.</span><span class="sxs-lookup"><span data-stu-id="f3c32-127">Define an event handler for the <xref:System.AppDomain.FirstChanceException> event.</span></span> <span data-ttu-id="f3c32-128">Cet exemple utilise une méthode `static` (méthode `Shared` en Visual Basic) qui imprime le nom du domaine d’application où l’événement a été géré, ainsi que la propriété <xref:System.Exception.Message%2A> de l’exception.</span><span class="sxs-lookup"><span data-stu-id="f3c32-128">This example uses a `static` method (`Shared` method in Visual Basic) that prints the name of the application domain where the event was handled and the exception's <xref:System.Exception.Message%2A> property.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#3](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#3)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#3)]

2. <span data-ttu-id="f3c32-129">Créez un domaine d’application et ajoutez le gestionnaire d’événements à l’événement <xref:System.AppDomain.FirstChanceException> pour ce domaine d’application.</span><span class="sxs-lookup"><span data-stu-id="f3c32-129">Create an application domain and add the event handler to the <xref:System.AppDomain.FirstChanceException> event for that application domain.</span></span> <span data-ttu-id="f3c32-130">Dans cet exemple, le domaine d’application se nomme `AD1`.</span><span class="sxs-lookup"><span data-stu-id="f3c32-130">In this example, the application domain is named `AD1`.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#2](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#2)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#2)]

     <span data-ttu-id="f3c32-131">Vous pouvez gérer cet événement dans le domaine d’application par défaut de la même façon.</span><span class="sxs-lookup"><span data-stu-id="f3c32-131">You can handle this event in the default application domain in the same way.</span></span> <span data-ttu-id="f3c32-132">Utilisez la propriété `static` (`Shared` en Visual Basic) <xref:System.AppDomain.CurrentDomain%2A?displayProperty=nameWithType> dans `Main()` pour obtenir une référence au domaine d’application par défaut.</span><span class="sxs-lookup"><span data-stu-id="f3c32-132">Use the `static` (`Shared` in Visual Basic) <xref:System.AppDomain.CurrentDomain%2A?displayProperty=nameWithType> property in `Main()` to get a reference to the default application domain.</span></span>

#### <a name="to-demonstrate-first-chance-exception-notifications-in-the-application-domain"></a><span data-ttu-id="f3c32-133">Pour illustrer les notifications des exceptions de première chance dans le domaine d’application</span><span class="sxs-lookup"><span data-stu-id="f3c32-133">To demonstrate first-chance exception notifications in the application domain</span></span>

1. <span data-ttu-id="f3c32-134">Créez un objet `Worker` dans le domaine d’application que vous avez créé lors de la procédure précédente.</span><span class="sxs-lookup"><span data-stu-id="f3c32-134">Create a `Worker` object in the application domain that you created in the previous procedure.</span></span> <span data-ttu-id="f3c32-135">La classe `Worker` doit être publique et doit dériver de <xref:System.MarshalByRefObject>, comme indiqué dans l’exemple complet à la fin de cet article.</span><span class="sxs-lookup"><span data-stu-id="f3c32-135">The `Worker` class must be public, and must derive from <xref:System.MarshalByRefObject>, as shown in the complete example at the end of this article.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#4](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#4)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#4)]

2. <span data-ttu-id="f3c32-136">Appelez une méthode de l’objet `Worker` qui lève une exception.</span><span class="sxs-lookup"><span data-stu-id="f3c32-136">Call a method of the `Worker` object that throws an exception.</span></span> <span data-ttu-id="f3c32-137">Dans cet exemple, la méthode `Thrower` est appelée deux fois.</span><span class="sxs-lookup"><span data-stu-id="f3c32-137">In this example, the `Thrower` method is called twice.</span></span> <span data-ttu-id="f3c32-138">La première fois, l’argument de méthode est `true`. La méthode intercepte donc sa propre exception.</span><span class="sxs-lookup"><span data-stu-id="f3c32-138">The first time, the method argument is `true`, which causes the method to catch its own exception.</span></span> <span data-ttu-id="f3c32-139">La deuxième fois, l’argument est `false`, et la méthode `Main()` intercepte l’exception dans le domaine d’application par défaut.</span><span class="sxs-lookup"><span data-stu-id="f3c32-139">The second time, the argument is `false`, and the `Main()` method catches the exception in the default application domain.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#6](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#6)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#6)]

3. <span data-ttu-id="f3c32-140">Placez le code dans la méthode `Thrower` pour contrôler si la méthode gère sa propre exception.</span><span class="sxs-lookup"><span data-stu-id="f3c32-140">Place code in the `Thrower` method to control whether the method handles its own exception.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#5](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#5)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#5)]

## <a name="example"></a><span data-ttu-id="f3c32-141">Exemple</span><span class="sxs-lookup"><span data-stu-id="f3c32-141">Example</span></span>
 <span data-ttu-id="f3c32-142">L’exemple suivant crée un domaine d’application nommé `AD1` et ajoute un gestionnaire d’événements à l’événement <xref:System.AppDomain.FirstChanceException> du domaine d’application.</span><span class="sxs-lookup"><span data-stu-id="f3c32-142">The following example creates an application domain named `AD1` and adds an event handler to the application domain's <xref:System.AppDomain.FirstChanceException> event.</span></span> <span data-ttu-id="f3c32-143">L’exemple crée une instance de la classe `Worker` dans le domaine d’application et appelle une méthode nommée `Thrower` qui lève une <xref:System.ArgumentException>.</span><span class="sxs-lookup"><span data-stu-id="f3c32-143">The example creates an instance of the `Worker` class in the application domain, and calls a method named `Thrower` that throws an <xref:System.ArgumentException>.</span></span> <span data-ttu-id="f3c32-144">En fonction de la valeur de son argument, la méthode intercepte l’exception ou ne parvient pas à la gérer.</span><span class="sxs-lookup"><span data-stu-id="f3c32-144">Depending on the value of its argument, the method either catches the exception or fails to handle it.</span></span>

 <span data-ttu-id="f3c32-145">Chaque fois que la méthode `Thrower` lève une exception dans `AD1`, l’événement <xref:System.AppDomain.FirstChanceException> est déclenché dans `AD1`, et le gestionnaire d’événements affiche un message.</span><span class="sxs-lookup"><span data-stu-id="f3c32-145">Each time the `Thrower` method throws an exception in `AD1`, the <xref:System.AppDomain.FirstChanceException> event is raised in `AD1`, and the event handler displays a message.</span></span> <span data-ttu-id="f3c32-146">Le runtime recherche ensuite un gestionnaire d’exceptions.</span><span class="sxs-lookup"><span data-stu-id="f3c32-146">The runtime then looks for an exception handler.</span></span> <span data-ttu-id="f3c32-147">Dans le premier cas, le gestionnaire d’exceptions est trouvé dans `AD1`.</span><span class="sxs-lookup"><span data-stu-id="f3c32-147">In the first case, the exception handler is found in `AD1`.</span></span> <span data-ttu-id="f3c32-148">Dans le deuxième cas, l’exception n’est pas gérée dans `AD1` ; elle est interceptée dans le domaine d’application par défaut.</span><span class="sxs-lookup"><span data-stu-id="f3c32-148">In the second case, the exception is unhandled in `AD1`, and instead is caught in the default application domain.</span></span>

> [!NOTE]
> <span data-ttu-id="f3c32-149">Le nom du domaine d’application par défaut est identique au nom de l’exécutable.</span><span class="sxs-lookup"><span data-stu-id="f3c32-149">The name of the default application domain is the same as the name of the executable.</span></span>

 <span data-ttu-id="f3c32-150">Si vous ajoutez un gestionnaire pour l’événement <xref:System.AppDomain.FirstChanceException> au domaine d’application par défaut, l’événement est déclenché et géré avant que le domaine d’application par défaut ne gère l’exception.</span><span class="sxs-lookup"><span data-stu-id="f3c32-150">If you add a handler for the <xref:System.AppDomain.FirstChanceException> event to the default application domain, the event is raised and handled before the default application domain handles the exception.</span></span> <span data-ttu-id="f3c32-151">Pour afficher cela, ajoutez le code C# `AppDomain.CurrentDomain.FirstChanceException += FirstChanceException;` (en Visual Basic, `AddHandler AppDomain.CurrentDomain.FirstChanceException, FirstChanceException`) au début de `Main()`.</span><span class="sxs-lookup"><span data-stu-id="f3c32-151">To see this, add the C# code `AppDomain.CurrentDomain.FirstChanceException += FirstChanceException;` (in Visual Basic, `AddHandler AppDomain.CurrentDomain.FirstChanceException, FirstChanceException`) at the beginning of `Main()`.</span></span>

 [!code-csharp[System.AppDomain.FirstChanceException_howto#1](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#1)]
 [!code-vb[System.AppDomain.FirstChanceException_howto#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#1)]

## <a name="see-also"></a><span data-ttu-id="f3c32-152">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="f3c32-152">See also</span></span>

- <xref:System.AppDomain.FirstChanceException>

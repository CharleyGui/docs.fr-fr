---
title: Rendre une image plus facile à déboguer dans .NET
description: Découvrez comment configurer une image exécutable pour faciliter le débogage à l’aide de commutateurs IDE et d’options de ligne de commande.
ms.date: 08/30/2018
helpviewer_keywords:
- images [.NET Framework], debugging
- executable image for debugging
- debugging [.NET Framework], executable images for
ms.assetid: 7d90ea7a-150f-4f97-98a7-f9c26541b9a3
ms.openlocfilehash: a3305dc864e7852c2336009503732a51868410d2
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/15/2020
ms.locfileid: "90558509"
---
# <a name="making-an-image-easier-to-debug-in-net"></a><span data-ttu-id="96b1c-103">Rendre une image plus facile à déboguer dans .NET</span><span class="sxs-lookup"><span data-stu-id="96b1c-103">Making an image easier to debug in .NET</span></span>

<span data-ttu-id="96b1c-104">Lors de la compilation de code non managé, vous pouvez configurer une image exécutable pour le débogage en définissant des commutateurs ou des options de ligne de commande de l’IDE.</span><span class="sxs-lookup"><span data-stu-id="96b1c-104">When compiling unmanaged code, you can configure an executable image for debugging by setting IDE switches or command-line options.</span></span> <span data-ttu-id="96b1c-105">Par exemple, vous pouvez utiliser l’option de ligne de commande /**Zi** dans Visual C++ pour lui demander de produire des fichiers de symboles de débogage (extension de fichier .pdb).</span><span class="sxs-lookup"><span data-stu-id="96b1c-105">For example, you can use the /**Zi** command-line option in Visual C++ to ask it to emit debug symbol files (file extension .pdb).</span></span> <span data-ttu-id="96b1c-106">De même, l’option de ligne de commande /**Od** indique au compilateur de désactiver l’optimisation.</span><span class="sxs-lookup"><span data-stu-id="96b1c-106">Similarly, the /**Od** command-line option tells the compiler to disable optimization.</span></span> <span data-ttu-id="96b1c-107">Le code résultant s’exécute plus lentement, mais il est plus facile à déboguer, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="96b1c-107">The resulting code runs more slowly, but it's easier to debug, should this be necessary.</span></span>

<span data-ttu-id="96b1c-108">Lors de la compilation d' .NET Framework code managé, les compilateurs tels que Visual C++, Visual Basic et C# compilent leur programme source en langage MSIL (Microsoft Intermediate Language).</span><span class="sxs-lookup"><span data-stu-id="96b1c-108">When compiling .NET Framework managed code, compilers such as Visual C++, Visual Basic, and C# compile their source program into Microsoft intermediate language (MSIL).</span></span> <span data-ttu-id="96b1c-109">MSIL est ensuite compilé juste-à-temps, juste avant l’exécution, dans le code machine natif.</span><span class="sxs-lookup"><span data-stu-id="96b1c-109">MSIL is then JIT-compiled, just before execution, into native machine code.</span></span> <span data-ttu-id="96b1c-110">Comme avec le code non managé, vous pouvez configurer une image exécutable pour le débogage en définissant des commutateurs ou des options de ligne de commande de l’IDE.</span><span class="sxs-lookup"><span data-stu-id="96b1c-110">As with unmanaged code, you can configure an executable image for debugging by setting IDE switches or command-line options.</span></span> <span data-ttu-id="96b1c-111">Vous pouvez également configurer la compilation juste-à-temps pour le débogage de la même façon.</span><span class="sxs-lookup"><span data-stu-id="96b1c-111">You can also configure the JIT compilation for debugging in much the same way.</span></span>

<span data-ttu-id="96b1c-112">Cette configuration JIT a deux aspects :</span><span class="sxs-lookup"><span data-stu-id="96b1c-112">This JIT configuration has two aspects:</span></span>

- <span data-ttu-id="96b1c-113">Vous pouvez demander au compilateur JIT de générer des informations de suivi.</span><span class="sxs-lookup"><span data-stu-id="96b1c-113">You can request the JIT compiler to generate tracking information.</span></span> <span data-ttu-id="96b1c-114">Ceci permet au débogueur de faire correspondre une chaîne d’instructions MSIL à son équivalent en code machine, et d’effectuer le suivi des emplacements de stockage des variables locales et des arguments de fonction.</span><span class="sxs-lookup"><span data-stu-id="96b1c-114">This makes it possible for the debugger to match up a chain of MSIL with its machine code counterpart, and to track where local variables and function arguments are stored.</span></span> <span data-ttu-id="96b1c-115">À partir de la version .NET Framework 2,0, le compilateur JIT génère toujours des informations de suivi. il n’est donc pas nécessaire de le demander.</span><span class="sxs-lookup"><span data-stu-id="96b1c-115">Starting with the .NET Framework version 2.0, the JIT compiler always generates tracking information, so there is no need to request it.</span></span>

- <span data-ttu-id="96b1c-116">Vous pouvez demander au compilateur JIT de ne pas optimiser le code machine résultant.</span><span class="sxs-lookup"><span data-stu-id="96b1c-116">You can request the JIT compiler to not optimize the resulting machine code.</span></span>

<span data-ttu-id="96b1c-117">Normalement, le compilateur qui génère le code MSIL définit ces options du compilateur JIT de manière appropriée, en fonction des commutateurs IDE ou des options de ligne de commande que vous spécifiez, par exemple/**OD**.</span><span class="sxs-lookup"><span data-stu-id="96b1c-117">Normally, the compiler that generates the MSIL sets these JIT compiler options appropriately, based upon the IDE switches or command-line options you specify, for example, /**Od**.</span></span>

<span data-ttu-id="96b1c-118">Dans certains cas, vous pouvez changer le comportement du compilateur JIT afin que le code machine généré soit plus facile à déboguer.</span><span class="sxs-lookup"><span data-stu-id="96b1c-118">In some cases, you might want to change the behavior of the JIT compiler so that the machine code it generates is easier to debug.</span></span> <span data-ttu-id="96b1c-119">Par exemple, vous pouvez générer des informations de suivi JIT pour une version commerciale ou pour l’optimisation du contrôle.</span><span class="sxs-lookup"><span data-stu-id="96b1c-119">For example, you might want to generate JIT tracking information for a retail build or control optimization.</span></span> <span data-ttu-id="96b1c-120">Vous pouvez faire cela avec un fichier d’initialisation (.ini).</span><span class="sxs-lookup"><span data-stu-id="96b1c-120">You can do so with an initialization (.ini) file.</span></span>

<span data-ttu-id="96b1c-121">Par exemple, si l’assembly que vous souhaitez déboguer est appelé *MyApp.exe*, vous pouvez créer un fichier texte nommé *MyApp.ini*, dans le même dossier que *MyApp.exe*, qui contient ces trois lignes :</span><span class="sxs-lookup"><span data-stu-id="96b1c-121">For example, if the assembly you want to debug is called *MyApp.exe*, then you can create a text file named *MyApp.ini*, in the same folder as *MyApp.exe*, which contains these three lines:</span></span>

```ini
[.NET Framework Debugging Control]
GenerateTrackingInfo=1
AllowOptimize=0
```

<span data-ttu-id="96b1c-122">Vous pouvez définir la valeur de chaque option sur 0 ou 1. Les options absentes ont 0 comme valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="96b1c-122">You can set the value of each option to 0 or 1, and any absent option defaults to 0.</span></span> <span data-ttu-id="96b1c-123">La définition de `GenerateTrackingInfo` sur 1 et de `AllowOptimize` sur 0 est ce qui permet le débogage le plus facile.</span><span class="sxs-lookup"><span data-stu-id="96b1c-123">Setting `GenerateTrackingInfo` to 1 and `AllowOptimize` to 0 provides the easiest debugging.</span></span>

<span data-ttu-id="96b1c-124">À partir de la version .NET Framework 2,0, le compilateur JIT génère toujours des informations de suivi, quelle que soit la valeur de `GenerateTrackingInfo` ; Toutefois, la `AllowOptimize` valeur est toujours un effet.</span><span class="sxs-lookup"><span data-stu-id="96b1c-124">Starting with the .NET Framework version 2.0, the JIT compiler always generates tracking information regardless of the value for `GenerateTrackingInfo`; however, the `AllowOptimize` value still has an effect.</span></span> <span data-ttu-id="96b1c-125">Quand vous utilisez le générateur d’images natives [Ngen.exe (Native Image Generator)](../tools/ngen-exe-native-image-generator.md) pour précompiler l’image native sans optimisation, le fichier .ini doit être présent dans le dossier cible avec `AllowOptimize=0` quand Ngen.exe s’exécute.</span><span class="sxs-lookup"><span data-stu-id="96b1c-125">When using the [Ngen.exe (Native Image Generator)](../tools/ngen-exe-native-image-generator.md) to precompile the native image without optimization, the .ini file must be present in the target folder with `AllowOptimize=0` when Ngen.exe executes.</span></span> <span data-ttu-id="96b1c-126">Si vous avez précompilé un assembly sans optimisation, vous devez supprimer le code précompilé à l’aide de NGen.exe option **/Uninstall** avant de réexécuter Ngen.exe pour précompiler le code comme optimisé.</span><span class="sxs-lookup"><span data-stu-id="96b1c-126">If you have precompiled an assembly without optimization, you must remove the precompiled code using NGen.exe **/uninstall** option before rerunning Ngen.exe to precompile the code as optimized.</span></span> <span data-ttu-id="96b1c-127">Si le fichier. ini n’est pas présent dans le dossier, par défaut Ngen.exe précompile le code comme étant optimisé.</span><span class="sxs-lookup"><span data-stu-id="96b1c-127">If the .ini file isn't present in the folder, by default Ngen.exe precompiles the code as optimized.</span></span>

<span data-ttu-id="96b1c-128"><xref:System.Diagnostics.DebuggableAttribute?displayProperty=nameWithType> contrôle les paramètres pour un assembly.</span><span class="sxs-lookup"><span data-stu-id="96b1c-128">The <xref:System.Diagnostics.DebuggableAttribute?displayProperty=nameWithType> controls the settings for an assembly.</span></span> <span data-ttu-id="96b1c-129">**DebuggableAttribute** comprend deux champs qui contrôlent si le compilateur JIT doit optimiser et/ou générer des informations de suivi.</span><span class="sxs-lookup"><span data-stu-id="96b1c-129">**DebuggableAttribute** includes two fields that control whether the JIT compiler should optimize and/or generate tracking information.</span></span> <span data-ttu-id="96b1c-130">À partir de la version .NET Framework 2,0, le compilateur JIT génère toujours des informations de suivi.</span><span class="sxs-lookup"><span data-stu-id="96b1c-130">Starting with the .NET Framework version 2.0, the JIT compiler always generates tracking information.</span></span>

<span data-ttu-id="96b1c-131">Pour une version commerciale, les compilateurs ne définissent pas **DebuggableAttribute**.</span><span class="sxs-lookup"><span data-stu-id="96b1c-131">For a retail build, compilers don't set any **DebuggableAttribute**.</span></span> <span data-ttu-id="96b1c-132">Par défaut, le compilateur JIT génère les performances les plus élevées et le plus difficile pour déboguer le code machine.</span><span class="sxs-lookup"><span data-stu-id="96b1c-132">By default, the JIT compiler generates the highest performance, hardest to debug machine code.</span></span> <span data-ttu-id="96b1c-133">L’activation du suivi dans JIT diminue légèrement les performances, tandis que la désactivation de l’optimisation les réduit considérablement.</span><span class="sxs-lookup"><span data-stu-id="96b1c-133">Enabling JIT tracking lowers performance a little, and disabling optimization lowers performance a lot.</span></span>

<span data-ttu-id="96b1c-134">**DebuggableAttribute** s’applique à la totalité d’un assembly, et non pas à des modules individuels dans l’assembly.</span><span class="sxs-lookup"><span data-stu-id="96b1c-134">The **DebuggableAttribute** applies to a whole assembly at a time, not to individual modules within the assembly.</span></span> <span data-ttu-id="96b1c-135">Les outils de développement doivent donc attacher des attributs personnalisés au jeton de métadonnées de l’assembly si un assembly a déjà été créé, ou à la classe appelée **System.Runtime.CompilerServices.AssemblyAttributesGoHere**.</span><span class="sxs-lookup"><span data-stu-id="96b1c-135">Development tools must therefore attach custom attributes to the assembly metadata token, if an assembly has already been created, or to the class called **System.Runtime.CompilerServices.AssemblyAttributesGoHere**.</span></span> <span data-ttu-id="96b1c-136">L’outil ALink promeut ensuite ces attributs **DebuggableAttribute** de chaque module vers l’assembly dont ils font partie.</span><span class="sxs-lookup"><span data-stu-id="96b1c-136">The ALink tool then promotes these **DebuggableAttribute** attributes from each module to the assembly they become a part of.</span></span> <span data-ttu-id="96b1c-137">En cas de conflit, l’opération ALink échoue.</span><span class="sxs-lookup"><span data-stu-id="96b1c-137">If there's a conflict, the ALink operation fails.</span></span>

> [!NOTE]
> <span data-ttu-id="96b1c-138">Dans la version 1.0 du .NET Framework, le compilateur Microsoft Visual C++ ajoute **DebuggableAttribute** quand les options du compilateur **/clr** et **/Zi** sont spécifiées.</span><span class="sxs-lookup"><span data-stu-id="96b1c-138">In version 1.0 of the .NET Framework, the Microsoft Visual C++ compiler adds the **DebuggableAttribute** when the **/clr** and **/Zi** compiler options are specified.</span></span> <span data-ttu-id="96b1c-139">Dans la version 1,1 de la .NET Framework, vous devez ajouter **DebuggableAttribute** manuellement dans votre code ou utiliser l’option de l’éditeur de liens **/ASSEMBLYDEBUG** .</span><span class="sxs-lookup"><span data-stu-id="96b1c-139">In version 1.1 of the .NET Framework, you must either add the **DebuggableAttribute** manually in your code or use the **/ASSEMBLYDEBUG** linker option.</span></span>

## <a name="see-also"></a><span data-ttu-id="96b1c-140">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="96b1c-140">See also</span></span>

- [<span data-ttu-id="96b1c-141">Débogage, traçage et profilage</span><span class="sxs-lookup"><span data-stu-id="96b1c-141">Debugging, Tracing, and Profiling</span></span>](index.md)
- [<span data-ttu-id="96b1c-142">Activation du débogage JIT-attach</span><span class="sxs-lookup"><span data-stu-id="96b1c-142">Enabling JIT-Attach Debugging</span></span>](enabling-jit-attach-debugging.md)
- <span data-ttu-id="96b1c-143">[Activation du profilage](/previous-versions/dotnet/netframework-4.0/s5ec0es1(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="96b1c-143">[Enabling Profiling](/previous-versions/dotnet/netframework-4.0/s5ec0es1(v=vs.100))</span></span>

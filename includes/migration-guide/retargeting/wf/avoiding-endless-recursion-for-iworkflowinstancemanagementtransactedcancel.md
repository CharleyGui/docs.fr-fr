---
ms.openlocfilehash: ab9431780422dfece5dcf8007d13e6d584f5118f
ms.sourcegitcommit: 721c3e4bdbb1ea0bb420818ec944c538fe5c513a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/01/2020
ms.locfileid: "96477522"
---
### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a><span data-ttu-id="6a7dd-101">Éviter la récursivité infinie pour IWorkflowInstanceManagement.TransactedCancel et IWorkflowInstanceManagement.TransactedTerminate</span><span class="sxs-lookup"><span data-stu-id="6a7dd-101">Avoiding endless recursion for IWorkflowInstanceManagement.TransactedCancel and IWorkflowInstanceManagement.TransactedTerminate</span></span>

#### <a name="details"></a><span data-ttu-id="6a7dd-102">Détails</span><span class="sxs-lookup"><span data-stu-id="6a7dd-102">Details</span></span>

<span data-ttu-id="6a7dd-103">Lorsque les API <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> ou <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> sont utilisées pour annuler ou terminer une instance de service de workflow, il peut arriver que l’instance de workflow rencontre un dépassement de la capacité de la pile à cause d’une récursivité infinie si le runtime `Workflow` tente de conserver l’instance de service dans le cadre du traitement de la demande.</span><span class="sxs-lookup"><span data-stu-id="6a7dd-103">Under some circumstances when using <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> APIs to cancel or terminate a workflow service instance, the workflow instance may encounter a stack overflow due to endless recursion when the `Workflow` runtime attempts to persist the service instance as part of processing the request.</span></span> <span data-ttu-id="6a7dd-104">Le problème se produit si l’instance de workflow est dans un État où elle attend la fin d’une autre demande WCF en suspens vers un autre service.</span><span class="sxs-lookup"><span data-stu-id="6a7dd-104">The problem occurs if the workflow instance is in a state where it is waiting for some other outstanding WCF request to another service to complete.</span></span> <span data-ttu-id="6a7dd-105">Les `TransactedCancel` `TransactedTerminate` opérations et créent des éléments de travail mis en file d’attente pour l’instance de service de Workflow.</span><span class="sxs-lookup"><span data-stu-id="6a7dd-105">The `TransactedCancel` and `TransactedTerminate` operations create work items that are queued for the workflow service instance.</span></span> <span data-ttu-id="6a7dd-106">Ces éléments de travail ne sont pas exécutés dans le cadre du traitement de la demande `TransactedCancel/TransactedTerminate`.</span><span class="sxs-lookup"><span data-stu-id="6a7dd-106">These work items are not executed as part of the processing of the `TransactedCancel/TransactedTerminate` request.</span></span> <span data-ttu-id="6a7dd-107">Étant donné que l’instance de service de workflow attend que soit effectuée l’autre demande WCF en suspens, l’élément de travail créé reste dans la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="6a7dd-107">Because the workflow service instance is busy waiting for the other outstanding WCF request to complete, the work item created remains queued.</span></span> <span data-ttu-id="6a7dd-108">L’opération `TransactedCancel/TransactedTerminate` est effectuée, puis le contrôle est retourné au client.</span><span class="sxs-lookup"><span data-stu-id="6a7dd-108">The `TransactedCancel/TransactedTerminate` operation completes and control is returned back to the client.</span></span> <span data-ttu-id="6a7dd-109">Lors de sa validation, la transaction associée à l’opération `TransactedCancel/TransactedTerminate` doit conserver l’état de l’instance de service de workflow.</span><span class="sxs-lookup"><span data-stu-id="6a7dd-109">When the transaction associated with the `TransactedCancel/TransactedTerminate` operation attempts to commit, it needs to persist the workflow service instance state.</span></span> <span data-ttu-id="6a7dd-110">Toutefois, comme il existe une demande `WCF` en suspens pour l’instance, le runtime du workflow ne peut pas conserver l’instance de service de workflow, et une boucle de récursivité infinie entraîne le dépassement de la capacité de la pile. Étant donné que `TransactedCancel` et `TransactedTerminate` créent uniquement un élément de travail en mémoire, le fait qu’une transaction existe n’a aucun effet.</span><span class="sxs-lookup"><span data-stu-id="6a7dd-110">But because there is an outstanding `WCF` request for the instance, the Workflow runtime cannot persist the workflow service instance, and an endless recursion loop leads to the stack overflow.Because `TransactedCancel` and `TransactedTerminate` only create a work item in memory, the fact that a transaction exists doesn't have any effect.</span></span> <span data-ttu-id="6a7dd-111">Une restauration de la transaction n’abandonne pas l’élément de travail. Pour résoudre ce problème, à compter de .NET Framework 4.7.2, nous avons introduit un `AppSetting` qui peut être ajouté au fichier `web.config/app.config` du service de workflow qui lui indique d’ignorer les transactions pour `TransactedCancel` et `TransactedTerminate`.</span><span class="sxs-lookup"><span data-stu-id="6a7dd-111">A rollback of the transaction does not discard the work item.To address this issue, starting in .NET Framework 4.7.2, we have introduced an `AppSetting` that can be added to the `web.config/app.config` of the workflow service that tells it to ignore transactions for `TransactedCancel` and `TransactedTerminate`.</span></span> <span data-ttu-id="6a7dd-112">Cela permet à la transaction d’être validée sans attendre la conservation de l’instance de flux de travail.</span><span class="sxs-lookup"><span data-stu-id="6a7dd-112">This allows the transaction to commit without waiting for the workflow instance to persist.</span></span> <span data-ttu-id="6a7dd-113">Le AppSetting pour cette fonctionnalité est nommé `microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate` .</span><span class="sxs-lookup"><span data-stu-id="6a7dd-113">The AppSetting for this feature is named `microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate`.</span></span> <span data-ttu-id="6a7dd-114">La valeur `true` indique que la transaction doit être ignorée, évitant ainsi le dépassement de la capacité de la pile.</span><span class="sxs-lookup"><span data-stu-id="6a7dd-114">A value of `true` indicates that the transaction should be ignored, thus avoiding the stack overflow.</span></span> <span data-ttu-id="6a7dd-115">La valeur par défaut de cet AppSetting étant `false`, les instances de service de workflow existantes ne sont pas affectées.</span><span class="sxs-lookup"><span data-stu-id="6a7dd-115">The default value of this AppSetting is `false`, so existing workflow service instances are not affected.</span></span>

#### <a name="suggestion"></a><span data-ttu-id="6a7dd-116">Suggestion</span><span class="sxs-lookup"><span data-stu-id="6a7dd-116">Suggestion</span></span>

<span data-ttu-id="6a7dd-117">Si vous utilisez AppFabric ou un autre client <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> et qu’un dépassement de la capacité de la pile se produit dans l’instance de service de workflow quand vous essayez d’annuler ou de terminer une instance de workflow, vous pouvez ajouter le code suivant à la section `<appSettings>` du fichier web.config/app.config du service de workflow :</span><span class="sxs-lookup"><span data-stu-id="6a7dd-117">If you are using AppFabric or another <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> client and are encountering a stack overflow in the workflow service instance when trying to cancel or terminate a workflow instance, you can add the following to the `<appSettings>` section of the web.config/app.config file for the workflow service:</span></span>

<pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre>

<span data-ttu-id="6a7dd-118">Si vous ne rencontrez pas ce problème, il est inutile d’effectuer cette opération.</span><span class="sxs-lookup"><span data-stu-id="6a7dd-118">If you are not encountering the problem, you do not need to do this.</span></span>

| <span data-ttu-id="6a7dd-119">Nom</span><span class="sxs-lookup"><span data-stu-id="6a7dd-119">Name</span></span>    | <span data-ttu-id="6a7dd-120">Valeur</span><span class="sxs-lookup"><span data-stu-id="6a7dd-120">Value</span></span>       |
|:--------|:------------|
| <span data-ttu-id="6a7dd-121">Étendue</span><span class="sxs-lookup"><span data-stu-id="6a7dd-121">Scope</span></span>   | <span data-ttu-id="6a7dd-122">Edge</span><span class="sxs-lookup"><span data-stu-id="6a7dd-122">Edge</span></span>        |
| <span data-ttu-id="6a7dd-123">Version</span><span class="sxs-lookup"><span data-stu-id="6a7dd-123">Version</span></span> | <span data-ttu-id="6a7dd-124">4.7.2</span><span class="sxs-lookup"><span data-stu-id="6a7dd-124">4.7.2</span></span>       |
| <span data-ttu-id="6a7dd-125">Type</span><span class="sxs-lookup"><span data-stu-id="6a7dd-125">Type</span></span>    | <span data-ttu-id="6a7dd-126">Reciblage</span><span class="sxs-lookup"><span data-stu-id="6a7dd-126">Retargeting</span></span> |

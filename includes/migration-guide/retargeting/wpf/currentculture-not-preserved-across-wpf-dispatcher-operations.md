---
ms.openlocfilehash: bd656478a55856e676853e57f3e7386ea0aa0211
ms.sourcegitcommit: e02d17b2cf9c1258dadda4810a5e6072a0089aee
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/01/2020
ms.locfileid: "85614545"
---
### <a name="currentculture-is-not-preserved-across-wpf-dispatcher-operations"></a><span data-ttu-id="77aec-101">CurrentCulture n’est pas conservé d’une opération de répartiteur WPF à l’autre</span><span class="sxs-lookup"><span data-stu-id="77aec-101">CurrentCulture is not preserved across WPF Dispatcher operations</span></span>

#### <a name="details"></a><span data-ttu-id="77aec-102">Détails</span><span class="sxs-lookup"><span data-stu-id="77aec-102">Details</span></span>

<span data-ttu-id="77aec-103">À compter du .NET Framework 4.6, les changements apportés à <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> ou <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> dans un <xref:System.Windows.Threading.Dispatcher?displayProperty=fullName> sont perdus à la fin de l’opération de ce répartiteur.</span><span class="sxs-lookup"><span data-stu-id="77aec-103">Beginning in the .NET Framework 4.6, changes to <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> made within a <xref:System.Windows.Threading.Dispatcher?displayProperty=fullName> will be lost at the end of that dispatcher operation.</span></span> <span data-ttu-id="77aec-104">De même, les changements apportés à <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> ou <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> en dehors d’une opération de répartiteur peuvent ne pas être reflétés quand cette opération s’exécute. Concrètement, cela signifie que les changements <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> et <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> peuvent ne pas circuler entre les rappels d’IU WPF et tout autre code dans une application WPF. Cela est dû à un changement dans <xref:System.Threading.ExecutionContext?displayProperty=fullName> qui provoque le stockage de <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> et de <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> dans le contexte d’exécution à compter des applications ciblant le .NET Framework 4.6.</span><span class="sxs-lookup"><span data-stu-id="77aec-104">Similarly, changes to <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> made outside of a Dispatcher operation may not be reflected when that operation executes.Practically speaking, this means that <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> changes may not flow between WPF UI callbacks and other code in a WPF application.This is due to a change in <xref:System.Threading.ExecutionContext?displayProperty=fullName> that causes <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> to be stored in the execution context beginning with apps targeting the .NET Framework 4.6.</span></span> <span data-ttu-id="77aec-105">Les opérations de répartiteur WPF stockent le contexte d’exécution utilisé pour commencer l’opération et restaurer le contexte précédent lorsque l’opération est terminée.</span><span class="sxs-lookup"><span data-stu-id="77aec-105">WPF dispatcher operations store the execution context used to begin the operation and restore the previous context when the operation is completed.</span></span> <span data-ttu-id="77aec-106">Étant donné que <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> et <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> font désormais partie de ce contexte, les modifications qui leur sont apportées dans une opération de répartiteur ne sont pas conservées en dehors de cette opération.</span><span class="sxs-lookup"><span data-stu-id="77aec-106">Because <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> are now part of that context, changes to them within a dispatcher operation are not persisted outside of the operation.</span></span>

#### <a name="suggestion"></a><span data-ttu-id="77aec-107">Suggestion</span><span class="sxs-lookup"><span data-stu-id="77aec-107">Suggestion</span></span>

<span data-ttu-id="77aec-108">Si vos applications sont affectées par ce changement, vous pouvez le contourner en stockant la valeur <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> ou <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> souhaitée dans un champ, puis en vérifiant dans tous les corps d’opérations de répartiteur (notamment les gestionnaires de rappels d’événements de l’interface utilisateur) que les bons <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> et <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> sont définis.</span><span class="sxs-lookup"><span data-stu-id="77aec-108">Apps affected by this change may work around it by storing the desired <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> in a field and checking in all Dispatcher operation bodies (including UI event callback handlers) that the correct <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> are set.</span></span> <span data-ttu-id="77aec-109">Étant donné que le changement d’ExecutionContext sous-jacent à ce changement WPF affecte uniquement les applications qui ciblent le .NET Framework 4.6 ou ultérieur, vous pouvez éviter le problème en ciblant le .NET Framework 4.5.2. Pour les applications qui ciblent le .NET Framework 4.6 ou ultérieur, vous pouvez également contourner ce changement en définissant le commutateur de compatibilité suivant :</span><span class="sxs-lookup"><span data-stu-id="77aec-109">Alternatively, because the ExecutionContext change underlying this WPF change only affects apps targeting the .NET Framework 4.6 or newer, this break can be avoided by targeting the .NET Framework 4.5.2.Apps that target .NET Framework 4.6 or later can also work around this by setting the following compatibility switch:</span></span>

<pre><code class="lang-csharp">AppContext.SetSwitch(&quot;Switch.System.Globalization.NoAsyncCurrentCulture&quot;, true);&#13;&#10;</code></pre>

<span data-ttu-id="77aec-110">Ce problème a été résolu par WPF dans le .NET Framework 4.6.2.</span><span class="sxs-lookup"><span data-stu-id="77aec-110">This issue has been fixed by WPF in .NET Framework 4.6.2.</span></span> <span data-ttu-id="77aec-111">Il a également été résolu dans .NET Framework versions 4.6 et 4.6.1 par le biais du correctif décrit dans [l’article 3139549 de la Base de connaissances](https://support.microsoft.com/kb/3139549).</span><span class="sxs-lookup"><span data-stu-id="77aec-111">It has also been fixed in .NET Frameworks 4.6, 4.6.1 through [KB 3139549](https://support.microsoft.com/kb/3139549).</span></span> <span data-ttu-id="77aec-112">Les applications qui ciblent .NET Framework 4.6 ou ultérieur obtiennent automatiquement le comportement approprié dans les applications WPF. <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName>/<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> est conservé d’une opération de répartiteur à l’autre.</span><span class="sxs-lookup"><span data-stu-id="77aec-112">Applications targeting .NET Framework 4.6 or later will automatically get the right behavior in WPF applications - <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName>/<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName>) would be preserved across Dispatcher operations.</span></span>

| <span data-ttu-id="77aec-113">Nom</span><span class="sxs-lookup"><span data-stu-id="77aec-113">Name</span></span>    | <span data-ttu-id="77aec-114">Valeur</span><span class="sxs-lookup"><span data-stu-id="77aec-114">Value</span></span>       |
|:--------|:------------|
| <span data-ttu-id="77aec-115">Étendue</span><span class="sxs-lookup"><span data-stu-id="77aec-115">Scope</span></span>   | <span data-ttu-id="77aec-116">Secondaire</span><span class="sxs-lookup"><span data-stu-id="77aec-116">Minor</span></span>       |
| <span data-ttu-id="77aec-117">Version</span><span class="sxs-lookup"><span data-stu-id="77aec-117">Version</span></span> | <span data-ttu-id="77aec-118">4.6</span><span class="sxs-lookup"><span data-stu-id="77aec-118">4.6</span></span>         |
| <span data-ttu-id="77aec-119">Type</span><span class="sxs-lookup"><span data-stu-id="77aec-119">Type</span></span>    | <span data-ttu-id="77aec-120">Reciblage</span><span class="sxs-lookup"><span data-stu-id="77aec-120">Retargeting</span></span> |
